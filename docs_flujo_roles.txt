FLUJO DE ROLES Y ACCESOS (Frontend + Backend)
Fecha: 2025-09-20

Resumen
Este documento describe el flujo por rol y los accesos principales dentro del sistema CRM GeoFal, incluyendo las páginas clave del frontend, acciones permitidas y notas respecto a guardas/roles del backend.

1) Admin
- Acceso a:
  - Dashboard (/dashboard)
  - Usuarios (/usuarios)
  - Clientes (/clientes)
  - Proyectos (/proyectos) + Historial (/historial-proyectos)
  - Cotizaciones (listado /cotizaciones, lista comercial /cotizaciones/lista, detalle /cotizaciones/:id, nueva LEM /cotizaciones/nueva/lem)
  - Variantes de Cotización (/variantes-cotizacion), Ítems de Cotización (/items-cotizacion)
  - Adjuntos (/adjuntos)
  - Tickets (/tickets) + Historial Tickets (/historial-tickets)
  - Evidencias (/evidencias)
  - Servicios (/servicios) y Subservicios (/subservicios)
  - Categorías (/categorias) y Subcategorías (/subcategorias)
  - Facturas (/facturas)
  - Auditoría (/auditoria)
  - Exportaciones (/exportaciones)
- Operaciones típicas:
  - CRUD de entidades base (usuarios, clientes, proyectos, categorías/subcategorías, servicios/subservicios)
  - Gestión de cotizaciones completas (crear, editar, clonar, exportar, gestionar ítems)
  - Visualizar y operar tickets/evidencias.
- Notas backend:
  - RequireRole habilita todas las rutas para Admin.

2) Comercial
2.1) Jefa Comercial
- Acceso a:
  - Dashboard (/dashboard)
  - Clientes (/clientes)
  - Proyectos (/proyectos)
  - Cotizaciones (listado /cotizaciones y lista comercial /cotizaciones/lista)
  - Reportes (/reportes)
  - Notificaciones WhatsApp (/notificaciones-whatsapp)
    - Facturas (/facturas)
- Operaciones típicas:
  - Gestionar cartera de clientes y sus proyectos.
  - Visualizar y filtrar cotizaciones comerciales (estado/fecha/cliente/proyecto), clonar/exportar.

2.2) Vendedor Comercial
- Acceso a:
  - Dashboard (/dashboard)
  - Clientes (/clientes)
  - Proyectos (/proyectos)
  - Cotizaciones (listado /cotizaciones y lista comercial /cotizaciones/lista)
  - Tickets (/tickets)
- Operaciones típicas:
  - Similar a Jefa en clientes/proyectos/cotizaciones.
  - Reportar incidencias vía Tickets.

3) Laboratorio
3.1) Jefe de Laboratorio
- Acceso a:
  - Dashboard (/dashboard)
  - Variantes Cotización (/variantes-cotizacion)
  - Ítems Cotización (/items-cotizacion)
  - Servicios (/servicios) y Subservicios (/subservicios)
  - Nueva Cotización LEM (/cotizaciones/nueva/lem)
  - Evidencias (/evidencias)
- Operaciones típicas:
  - Mantención de catálogo técnico (variantes, ítems, servicios, subservicios).
  - Generar cotizaciones LEM.
  - Cargar evidencias asociadas a proyectos.

3.2) Usuario de Laboratorio
- Acceso a:
  - Dashboard (/dashboard)
  - Nueva Cotización LEM (/cotizaciones/nueva/lem)
  - Evidencias (/evidencias)
- Operaciones típicas:
  - Registrar cotizaciones LEM según flujos definidos.
  - Subir evidencias.

4) Soporte
- Acceso a:
  - Dashboard (/dashboard)
  - Tickets (/tickets)
  - Historial Tickets (/historial-tickets)
- Operaciones típicas:
  - Recepción y tratamiento de incidencias.
  - Cambio de estado de tickets (según permisos backend).
- Notas backend:
  - Endpoint PUT /api/tickets/:id/status actualmente restringido a rol "sistemas". Se puede ampliar a "soporte" y/o "admin" si se requiere.

5) Gerencia
- Acceso a:
  - Dashboard (/dashboard)
  - Reportes (/reportes)
  - Clientes (/clientes)
  - Proyectos (/proyectos)
  - Cotizaciones (lista comercial /cotizaciones/lista y detalle /cotizaciones/:id en sólo lectura)
- Operaciones típicas:
  - Seguimiento gerencial de indicadores, cartera y cotizaciones.

Detalles de Frontend actualizados
- Cotizaciones (lista comercial /cotizaciones/lista):
  - Filtros por cliente, proyecto, estado, rango de fechas (con presets Hoy/7 días/Este mes).
  - Acciones: Ver/Editar, Clonar, Exportar PDF/Excel.
  - Insignias de color por estado.

- Tickets (/tickets):
  - Listado con filtros (estado, prioridad), paginación.
  - Crear ticket con adjunto (multipart/form-data).
  - Cambio de estado en línea (dropdown por fila). Backend debe permitirlo por rol.

- Evidencias (/evidencias):
  - Listado con filtros (cliente -> proyecto; tipo), paginación.
  - Subir evidencia (multipart/form-data).
  - Muestra el nombre del proyecto en vez del ID.

- Categorías/Subcategorías:
  - CRUD con búsqueda y paginación (subcategorías filtradas por categoría).

- Servicios/Subservicios:
  - Servicios: listar, crear, editar, eliminar (filtro por área). Roles: admin, jefe_laboratorio, jefa_comercial.
  - Subservicios: listar por servicio, crear, editar, eliminar. Roles: admin, jefe_laboratorio, jefa_comercial.

- Facturas (/facturas):
  - Listado con filtro por estado de pago, paginación.
  - Cambio de estado inline.
  - Crear factura (modal simple). Acceso: jefa_comercial y admin.

Componentes y servicios reutilizables
- Toolbar, Toast, FloatingInput, TableEmpty, CompanySelect.
- Servicios API por módulo (quotes, tickets, evidences, categories, subcategories, services, subservices, companies, projects).
- apiFetch maneja tokens y multipart sin duplicar cabeceras.

Pendientes y mejoras rápidas
- Añadir update/delete en backend para servicios/subservicios y habilitar en frontend.
- Ampliar permisos en PUT /api/tickets/:id/status para permitir soporte/admin (si aplica al negocio).
- Mostrar nombres de facturas en Evidencias (cuando estén disponibles en backend).
- Unificar más pantallas con FloatingInput y validaciones.
- Insignias y toolbar compacta en Cotizaciones lista (hecho para insignias; toolbar compacta opcional).

Notas de ejecución
- Backend: cd backend; npm install; npm run dev
- Frontend: cd frontend; npm install; npm run dev
- Producción (frontend): cd frontend; npm run build

Fin del documento.
