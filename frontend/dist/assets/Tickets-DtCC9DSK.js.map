{"version":3,"file":"Tickets-DtCC9DSK.js","sources":["../../src/pages/Tickets.jsx"],"sourcesContent":["import React, { useState, useMemo } from 'react';\r\nimport { Button, Badge, Row, Col, Card, Container } from 'react-bootstrap';\r\nimport { \r\n  FiPlus, FiEdit, FiTrash2, FiMessageSquare, FiClock, \r\n  FiCheckCircle, FiX, FiAlertTriangle, FiUser, FiCalendar,\r\n  FiEye, FiFlag\r\n} from 'react-icons/fi';\r\nimport PageHeader from '../components/common/PageHeader';\r\nimport DataTable from '../components/common/DataTable';\r\nimport ModalForm from '../components/common/ModalForm';\r\nimport StatsCard from '../components/common/StatsCard';\r\nimport { listTickets, createTicket, updateTicketStatus } from '../services/tickets';\r\nimport { useQuery, useMutation, useQueryClient } from 'react-query';\r\n\r\nconst emptyForm = { title: '', description: '', priority: 'media' };\r\n\r\nexport default function Tickets() {\r\n  const [showModal, setShowModal] = useState(false);\r\n  const [editingTicket, setEditingTicket] = useState(null);\r\n  const [deletingTicket, setDeletingTicket] = useState(null);\r\n\r\n  const queryClient = useQueryClient();\r\n\r\n  const { data, isLoading } = useQuery(\r\n    ['tickets'],\r\n    () => listTickets(),\r\n    { keepPreviousData: true }\r\n  );\r\n\r\n  const createMutation = useMutation(createTicket, {\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries('tickets');\r\n      setShowModal(false);\r\n      setEditingTicket(null);\r\n    },\r\n    onError: (error) => console.error('Error creating ticket:', error)\r\n  });\r\n\r\n  const updateMutation = useMutation(updateTicketStatus, {\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries('tickets');\r\n    },\r\n    onError: (error) => console.error('Error updating ticket:', error)\r\n  });\r\n\r\n  // const deleteMutation = useMutation(deleteTicket, {\r\n  //   onSuccess: () => {\r\n  //     queryClient.invalidateQueries('tickets');\r\n  //     setDeletingTicket(null);\r\n  //   },\r\n  //   onError: (error) => console.error('Error deleting ticket:', error)\r\n  // });\r\n\r\n  const handleCreate = () => {\r\n    setEditingTicket(emptyForm);\r\n    setShowModal(true);\r\n  };\r\n\r\n  const handleEdit = (ticket) => {\r\n    setEditingTicket(ticket);\r\n    setShowModal(true);\r\n  };\r\n\r\n  // const handleDelete = (ticket) => {\r\n  //   if (window.confirm(`¿Estás seguro de que quieres eliminar el ticket \"${ticket.title}\"?`)) {\r\n  //     deleteMutation.mutate(ticket.id);\r\n  //   }\r\n  // };\r\n\r\n  const handleStatusChange = (ticket, newStatus) => {\r\n    updateMutation.mutate({ id: ticket.id, status: newStatus });\r\n  };\r\n\r\n  const handleSubmit = async (formData) => {\r\n    if (editingTicket.id) {\r\n      await updateMutation.mutateAsync({ id: editingTicket.id, ...formData });\r\n    } else {\r\n      await createMutation.mutateAsync(formData);\r\n    }\r\n  };\r\n\r\n  const getStatusBadge = (status) => {\r\n    const statusConfig = {\r\n      'abierto': { bg: 'primary', text: 'Abierto', icon: FiMessageSquare },\r\n      'en_progreso': { bg: 'warning', text: 'En Progreso', icon: FiClock },\r\n      'resuelto': { bg: 'success', text: 'Resuelto', icon: FiCheckCircle },\r\n      'cerrado': { bg: 'secondary', text: 'Cerrado', icon: FiX }\r\n    };\r\n    \r\n    const config = statusConfig[status] || { bg: 'secondary', text: status, icon: FiMessageSquare };\r\n    const Icon = config.icon;\r\n    \r\n    return (\r\n      <Badge bg={config.bg} className=\"status-badge d-flex align-items-center\">\r\n        <Icon size={12} className=\"me-1\" />\r\n        {config.text}\r\n      </Badge>\r\n    );\r\n  };\r\n\r\n  const getPriorityBadge = (priority) => {\r\n    const priorityConfig = {\r\n      'baja': { bg: 'success', text: 'Baja', icon: FiFlag },\r\n      'media': { bg: 'warning', text: 'Media', icon: FiAlertTriangle },\r\n      'alta': { bg: 'danger', text: 'Alta', icon: FiAlertTriangle }\r\n    };\r\n    \r\n    const config = priorityConfig[priority] || { bg: 'secondary', text: priority, icon: FiFlag };\r\n    const Icon = config.icon;\r\n    \r\n    return (\r\n      <Badge bg={config.bg} className=\"status-badge d-flex align-items-center\">\r\n        <Icon size={12} className=\"me-1\" />\r\n        {config.text}\r\n      </Badge>\r\n    );\r\n  };\r\n\r\n  const columns = [\r\n    {\r\n      header: 'ID',\r\n      accessor: 'id',\r\n      width: '80px'\r\n    },\r\n    {\r\n      header: 'Título',\r\n      accessor: 'title',\r\n      render: (value, row) => (\r\n        <div>\r\n          <div className=\"fw-medium\">{row.title}</div>\r\n          <small className=\"text-muted\">\r\n            <FiUser size={12} className=\"me-1\" />\r\n            {row.user?.name || 'Usuario'}\r\n          </small>\r\n        </div>\r\n      )\r\n    },\r\n    {\r\n      header: 'Descripción',\r\n      accessor: 'description',\r\n      render: (value) => (\r\n        <div className=\"text-truncate\" style={{ maxWidth: '200px' }} title={value}>\r\n          {value}\r\n        </div>\r\n      )\r\n    },\r\n    {\r\n      header: 'Prioridad',\r\n      accessor: 'priority',\r\n      render: (value) => getPriorityBadge(value)\r\n    },\r\n    {\r\n      header: 'Estado',\r\n      accessor: 'status',\r\n      render: (value) => getStatusBadge(value)\r\n    },\r\n    {\r\n      header: 'Fecha',\r\n      accessor: 'created_at',\r\n      render: (value) => (\r\n        <div className=\"d-flex align-items-center\">\r\n          <FiCalendar size={12} className=\"me-1 text-muted\" />\r\n          <small>{new Date(value).toLocaleDateString('es-ES')}</small>\r\n        </div>\r\n      )\r\n    }\r\n  ];\r\n\r\n  const formFields = [\r\n    {\r\n      name: 'title',\r\n      label: 'Título',\r\n      type: 'text',\r\n      required: true,\r\n      placeholder: 'Ingresa el título del ticket'\r\n    },\r\n    {\r\n      name: 'description',\r\n      label: 'Descripción',\r\n      type: 'textarea',\r\n      required: true,\r\n      placeholder: 'Describe el problema o solicitud',\r\n      rows: 4\r\n    },\r\n    {\r\n      name: 'priority',\r\n      label: 'Prioridad',\r\n      type: 'select',\r\n      required: true,\r\n      options: [\r\n        { value: 'baja', label: 'Baja' },\r\n        { value: 'media', label: 'Media' },\r\n        { value: 'alta', label: 'Alta' }\r\n      ]\r\n    }\r\n  ];\r\n\r\n  // Calcular estadísticas\r\n  const stats = useMemo(() => {\r\n    const tickets = data?.tickets || [];\r\n    return {\r\n      total: tickets.length,\r\n      abiertos: tickets.filter(t => t.status === 'abierto').length,\r\n      enProgreso: tickets.filter(t => t.status === 'en_progreso').length,\r\n      resueltos: tickets.filter(t => t.status === 'resuelto').length,\r\n      cerrados: tickets.filter(t => t.status === 'cerrado').length,\r\n      alta: tickets.filter(t => t.priority === 'alta').length,\r\n      media: tickets.filter(t => t.priority === 'media').length,\r\n      baja: tickets.filter(t => t.priority === 'baja').length\r\n    };\r\n  }, [data]);\r\n\r\n  return (\r\n    <Container fluid className=\"py-4\">\r\n      <div className=\"fade-in\">\r\n        <PageHeader\r\n          title=\"Gestión de Tickets\"\r\n          subtitle=\"Crear, editar y gestionar tickets de soporte\"\r\n          icon={FiMessageSquare}\r\n          actions={\r\n            <Button variant=\"primary\" onClick={handleCreate}>\r\n              <FiPlus className=\"me-2\" />\r\n              Nuevo Ticket\r\n            </Button>\r\n          }\r\n        />\r\n\r\n        {/* Estadísticas */}\r\n        <Row className=\"g-4 mb-4\">\r\n          <Col md={6} lg={3}>\r\n            <StatsCard\r\n              title=\"Total Tickets\"\r\n              value={stats.total}\r\n              icon={FiMessageSquare}\r\n              color=\"primary\"\r\n              subtitle=\"Tickets registrados\"\r\n            />\r\n          </Col>\r\n          <Col md={6} lg={3}>\r\n            <StatsCard\r\n              title=\"Abiertos\"\r\n              value={stats.abiertos}\r\n              icon={FiClock}\r\n              color=\"warning\"\r\n              subtitle=\"Pendientes de atención\"\r\n            />\r\n          </Col>\r\n          <Col md={6} lg={3}>\r\n            <StatsCard\r\n              title=\"En Progreso\"\r\n              value={stats.enProgreso}\r\n              icon={FiAlertTriangle}\r\n              color=\"info\"\r\n              subtitle=\"En proceso de resolución\"\r\n            />\r\n          </Col>\r\n          <Col md={6} lg={3}>\r\n            <StatsCard\r\n              title=\"Resueltos\"\r\n              value={stats.resueltos}\r\n              icon={FiCheckCircle}\r\n              color=\"success\"\r\n              subtitle=\"Completados\"\r\n            />\r\n          </Col>\r\n        </Row>\r\n\r\n        {/* Tabla de tickets */}\r\n        <Card className=\"shadow-sm border-0\">\r\n          <Card.Header className=\"bg-white border-bottom\">\r\n            <div className=\"d-flex justify-content-between align-items-center\">\r\n              <h5 className=\"mb-0\">\r\n                <FiMessageSquare className=\"me-2 text-primary\" />\r\n                Lista de Tickets\r\n              </h5>\r\n              <Badge bg=\"light\" text=\"dark\" className=\"px-3 py-2\">\r\n                {stats.total} tickets\r\n              </Badge>\r\n            </div>\r\n          </Card.Header>\r\n          <Card.Body className=\"p-0\">\r\n            <DataTable\r\n              data={data?.tickets || []}\r\n              columns={columns}\r\n              loading={isLoading}\r\n              onEdit={handleEdit}\r\n              emptyMessage=\"No hay tickets registrados\"\r\n            />\r\n          </Card.Body>\r\n        </Card>\r\n\r\n      <ModalForm\r\n        show={showModal}\r\n        onHide={() => setShowModal(false)}\r\n        title={editingTicket?.id ? 'Editar Ticket' : 'Nuevo Ticket'}\r\n        data={editingTicket || emptyForm}\r\n        fields={formFields}\r\n        onSubmit={handleSubmit}\r\n        loading={createMutation.isLoading || updateMutation.isLoading}\r\n        submitText={editingTicket?.id ? 'Actualizar' : 'Crear'}\r\n      />\r\n      </div>\r\n    </Container>\r\n  );\r\n};\r\n"],"names":["emptyForm","Tickets","showModal","setShowModal","useState","editingTicket","setEditingTicket","deletingTicket","setDeletingTicket","queryClient","useQueryClient","data","isLoading","useQuery","listTickets","createMutation","useMutation","createTicket","error","updateMutation","updateTicketStatus","handleCreate","handleEdit","ticket","handleSubmit","formData","getStatusBadge","status","config","FiMessageSquare","FiClock","FiCheckCircle","FiX","Icon","Badge","jsx","getPriorityBadge","priority","FiFlag","FiAlertTriangle","columns","value","row","jsxs","FiUser","_a","FiCalendar","formFields","stats","useMemo","tickets","t","Container","PageHeader","Button","FiPlus","Row","Col","StatsCard","Card","DataTable","ModalForm"],"mappings":"mhBAcA,MAAMA,EAAY,CAAE,MAAO,GAAI,YAAa,GAAI,SAAU,OAAA,EAE1D,SAAwBC,IAAU,CAChC,KAAM,CAACC,EAAWC,CAAY,EAAIC,EAAAA,SAAS,EAAK,EAC1C,CAACC,EAAeC,CAAgB,EAAIF,EAAAA,SAAS,IAAI,EACjD,CAACG,EAAgBC,CAAiB,EAAIJ,EAAAA,SAAS,IAAI,EAEnDK,EAAcC,EAAA,EAEd,CAAE,KAAAC,EAAM,UAAAC,CAAA,EAAcC,EAC1B,CAAC,SAAS,EACV,IAAMC,EAAA,EACN,CAAE,iBAAkB,EAAA,CAAK,EAGrBC,EAAiBC,EAAYC,EAAc,CAC/C,UAAW,IAAM,CACfR,EAAY,kBAAkB,SAAS,EACvCN,EAAa,EAAK,EAClBG,EAAiB,IAAI,CACvB,EACA,QAAUY,GAAU,QAAQ,MAAM,yBAA0BA,CAAK,CAAA,CAClE,EAEKC,EAAiBH,EAAYI,EAAoB,CACrD,UAAW,IAAM,CACfX,EAAY,kBAAkB,SAAS,CACzC,EACA,QAAUS,GAAU,QAAQ,MAAM,yBAA0BA,CAAK,CAAA,CAClE,EAUKG,EAAe,IAAM,CACzBf,EAAiBN,CAAS,EAC1BG,EAAa,EAAI,CACnB,EAEMmB,EAAcC,GAAW,CAC7BjB,EAAiBiB,CAAM,EACvBpB,EAAa,EAAI,CACnB,EAYMqB,EAAe,MAAOC,GAAa,CACnCpB,EAAc,GAChB,MAAMc,EAAe,YAAY,CAAE,GAAId,EAAc,GAAI,GAAGoB,EAAU,EAEtE,MAAMV,EAAe,YAAYU,CAAQ,CAE7C,EAEMC,EAAkBC,GAAW,CAQjC,MAAMC,EAPe,CACnB,QAAW,CAAE,GAAI,UAAW,KAAM,UAAW,KAAMC,CAAA,EACnD,YAAe,CAAE,GAAI,UAAW,KAAM,cAAe,KAAMC,CAAA,EAC3D,SAAY,CAAE,GAAI,UAAW,KAAM,WAAY,KAAMC,CAAA,EACrD,QAAW,CAAE,GAAI,YAAa,KAAM,UAAW,KAAMC,CAAA,CAAI,EAG/BL,CAAM,GAAK,CAAE,GAAI,YAAa,KAAMA,EAAQ,KAAME,CAAA,EACxEI,EAAOL,EAAO,KAEpB,cACGM,EAAA,CAAM,GAAIN,EAAO,GAAI,UAAU,yCAC9B,SAAA,CAAAO,EAAAA,IAACF,EAAA,CAAK,KAAM,GAAI,UAAU,OAAO,EAChCL,EAAO,IAAA,EACV,CAEJ,EAEMQ,EAAoBC,GAAa,CAOrC,MAAMT,EANiB,CACrB,KAAQ,CAAE,GAAI,UAAW,KAAM,OAAQ,KAAMU,CAAA,EAC7C,MAAS,CAAE,GAAI,UAAW,KAAM,QAAS,KAAMC,CAAA,EAC/C,KAAQ,CAAE,GAAI,SAAU,KAAM,OAAQ,KAAMA,CAAA,CAAgB,EAGhCF,CAAQ,GAAK,CAAE,GAAI,YAAa,KAAMA,EAAU,KAAMC,CAAA,EAC9EL,EAAOL,EAAO,KAEpB,cACGM,EAAA,CAAM,GAAIN,EAAO,GAAI,UAAU,yCAC9B,SAAA,CAAAO,EAAAA,IAACF,EAAA,CAAK,KAAM,GAAI,UAAU,OAAO,EAChCL,EAAO,IAAA,EACV,CAEJ,EAEMY,EAAU,CACd,CACE,OAAQ,KACR,SAAU,KACV,MAAO,MAAA,EAET,CACE,OAAQ,SACR,SAAU,QACV,OAAQ,CAACC,EAAOC,IAAA,qBACb,MAAA,CACC,SAAA,CAAAP,EAAAA,IAAC,MAAA,CAAI,UAAU,YAAa,SAAAO,EAAI,MAAM,EACtCC,EAAAA,KAAC,QAAA,CAAM,UAAU,aACf,SAAA,CAAAR,EAAAA,IAACS,EAAA,CAAO,KAAM,GAAI,UAAU,OAAO,IAClCC,EAAAH,EAAI,OAAJ,YAAAG,EAAU,OAAQ,SAAA,CAAA,CACrB,CAAA,CAAA,CACF,EAAA,EAGJ,CACE,OAAQ,cACR,SAAU,cACV,OAASJ,GACPN,EAAAA,IAAC,OAAI,UAAU,gBAAgB,MAAO,CAAE,SAAU,OAAA,EAAW,MAAOM,EACjE,SAAAA,CAAA,CACH,CAAA,EAGJ,CACE,OAAQ,YACR,SAAU,WACV,OAASA,GAAUL,EAAiBK,CAAK,CAAA,EAE3C,CACE,OAAQ,SACR,SAAU,SACV,OAASA,GAAUf,EAAee,CAAK,CAAA,EAEzC,CACE,OAAQ,QACR,SAAU,aACV,OAASA,GACPE,EAAAA,KAAC,MAAA,CAAI,UAAU,4BACb,SAAA,CAAAR,EAAAA,IAACW,EAAA,CAAW,KAAM,GAAI,UAAU,kBAAkB,EAClDX,MAAC,SAAO,SAAA,IAAI,KAAKM,CAAK,EAAE,mBAAmB,OAAO,CAAA,CAAE,CAAA,CAAA,CACtD,CAAA,CAEJ,EAGIM,EAAa,CACjB,CACE,KAAM,QACN,MAAO,SACP,KAAM,OACN,SAAU,GACV,YAAa,8BAAA,EAEf,CACE,KAAM,cACN,MAAO,cACP,KAAM,WACN,SAAU,GACV,YAAa,mCACb,KAAM,CAAA,EAER,CACE,KAAM,WACN,MAAO,YACP,KAAM,SACN,SAAU,GACV,QAAS,CACP,CAAE,MAAO,OAAQ,MAAO,MAAA,EACxB,CAAE,MAAO,QAAS,MAAO,OAAA,EACzB,CAAE,MAAO,OAAQ,MAAO,MAAA,CAAO,CACjC,CACF,EAIIC,EAAQC,EAAAA,QAAQ,IAAM,CAC1B,MAAMC,GAAUvC,GAAA,YAAAA,EAAM,UAAW,CAAA,EACjC,MAAO,CACL,MAAOuC,EAAQ,OACf,SAAUA,EAAQ,UAAYC,EAAE,SAAW,SAAS,EAAE,OACtD,WAAYD,EAAQ,UAAYC,EAAE,SAAW,aAAa,EAAE,OAC5D,UAAWD,EAAQ,UAAYC,EAAE,SAAW,UAAU,EAAE,OACxD,SAAUD,EAAQ,UAAYC,EAAE,SAAW,SAAS,EAAE,OACtD,KAAMD,EAAQ,UAAYC,EAAE,WAAa,MAAM,EAAE,OACjD,MAAOD,EAAQ,UAAYC,EAAE,WAAa,OAAO,EAAE,OACnD,KAAMD,EAAQ,UAAYC,EAAE,WAAa,MAAM,EAAE,MAAA,CAErD,EAAG,CAACxC,CAAI,CAAC,EAET,OACEwB,EAAAA,IAACiB,GAAU,MAAK,GAAC,UAAU,OACzB,SAAAT,EAAAA,KAAC,MAAA,CAAI,UAAU,UACb,SAAA,CAAAR,EAAAA,IAACkB,EAAA,CACC,MAAM,qBACN,SAAS,+CACT,KAAMxB,EACN,QACEc,EAAAA,KAACW,EAAA,CAAO,QAAQ,UAAU,QAASjC,EACjC,SAAA,CAAAc,EAAAA,IAACoB,EAAA,CAAO,UAAU,MAAA,CAAO,EAAE,cAAA,CAAA,CAE7B,CAAA,CAAA,EAKJZ,EAAAA,KAACa,EAAA,CAAI,UAAU,WACb,SAAA,CAAArB,EAAAA,IAACsB,EAAA,CAAI,GAAI,EAAG,GAAI,EACd,SAAAtB,EAAAA,IAACuB,EAAA,CACC,MAAM,gBACN,MAAOV,EAAM,MACb,KAAMnB,EACN,MAAM,UACN,SAAS,qBAAA,CAAA,EAEb,EACAM,EAAAA,IAACsB,EAAA,CAAI,GAAI,EAAG,GAAI,EACd,SAAAtB,EAAAA,IAACuB,EAAA,CACC,MAAM,WACN,MAAOV,EAAM,SACb,KAAMlB,EACN,MAAM,UACN,SAAS,wBAAA,CAAA,EAEb,EACAK,EAAAA,IAACsB,EAAA,CAAI,GAAI,EAAG,GAAI,EACd,SAAAtB,EAAAA,IAACuB,EAAA,CACC,MAAM,cACN,MAAOV,EAAM,WACb,KAAMT,EACN,MAAM,OACN,SAAS,0BAAA,CAAA,EAEb,EACAJ,EAAAA,IAACsB,EAAA,CAAI,GAAI,EAAG,GAAI,EACd,SAAAtB,EAAAA,IAACuB,EAAA,CACC,MAAM,YACN,MAAOV,EAAM,UACb,KAAMjB,EACN,MAAM,UACN,SAAS,aAAA,CAAA,CACX,CACF,CAAA,EACF,EAGAY,EAAAA,KAACgB,EAAA,CAAK,UAAU,qBACd,SAAA,CAAAxB,EAAAA,IAACwB,EAAK,OAAL,CAAY,UAAU,yBACrB,SAAAhB,EAAAA,KAAC,MAAA,CAAI,UAAU,oDACb,SAAA,CAAAA,EAAAA,KAAC,KAAA,CAAG,UAAU,OACZ,SAAA,CAAAR,EAAAA,IAACN,EAAA,CAAgB,UAAU,mBAAA,CAAoB,EAAE,kBAAA,EAEnD,SACCK,EAAA,CAAM,GAAG,QAAQ,KAAK,OAAO,UAAU,YACrC,SAAA,CAAAc,EAAM,MAAM,UAAA,CAAA,CACf,CAAA,CAAA,CACF,CAAA,CACF,EACAb,EAAAA,IAACwB,EAAK,KAAL,CAAU,UAAU,MACnB,SAAAxB,EAAAA,IAACyB,EAAA,CACC,MAAMjD,GAAA,YAAAA,EAAM,UAAW,CAAA,EACvB,QAAA6B,EACA,QAAS5B,EACT,OAAQU,EACR,aAAa,4BAAA,CAAA,CACf,CACF,CAAA,EACF,EAEFa,EAAAA,IAAC0B,EAAA,CACC,KAAM3D,EACN,OAAQ,IAAMC,EAAa,EAAK,EAChC,MAAOE,GAAA,MAAAA,EAAe,GAAK,gBAAkB,eAC7C,KAAMA,GAAiBL,EACvB,OAAQ+C,EACR,SAAUvB,EACV,QAAST,EAAe,WAAaI,EAAe,UACpD,WAAYd,GAAA,MAAAA,EAAe,GAAK,aAAe,OAAA,CAAA,CACjD,CAAA,CACA,CAAA,CACF,CAEJ"}