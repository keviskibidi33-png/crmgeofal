{"version":3,"file":"attachments-Da5n6gEq.js","sources":["../../src/services/attachments.js"],"sourcesContent":["import apiFetch from './api';\r\n\r\n// Servicios para adjuntos de proyectos\r\nexport const listProjectAttachments = (projectId) => {\r\n  return apiFetch(`/api/attachments/${projectId}/attachments`);\r\n};\r\n\r\n// Obtener todos los adjuntos con información completa\r\nexport const getAllAttachments = (params = {}) => {\r\n  const sp = new URLSearchParams();\r\n  if (params.page) sp.set('page', params.page);\r\n  if (params.limit) sp.set('limit', params.limit);\r\n  if (params.search) sp.set('search', params.search);\r\n  if (params.project_id) sp.set('project_id', params.project_id);\r\n  if (params.file_type) sp.set('file_type', params.file_type);\r\n  \r\n  const qs = sp.toString();\r\n  const path = qs ? `/api/attachments/all?${qs}` : '/api/attachments/all';\r\n  \r\n  console.log('🔍 getAllAttachments - Llamando a:', path);\r\n  \r\n  return apiFetch(path).then(data => {\r\n    console.log('✅ getAllAttachments - Respuesta recibida:', data);\r\n    return data;\r\n  }).catch(error => {\r\n    console.error('❌ getAllAttachments - Error:', error);\r\n    throw error;\r\n  });\r\n};\r\n\r\nexport const getAttachmentById = (id) => {\r\n  return apiFetch(`/api/attachments/${id}`);\r\n};\r\n\r\nexport const uploadAttachment = (projectId, formData) => {\r\n  return apiFetch(`/api/attachments/${projectId}/attachments`, {\r\n    method: 'POST',\r\n    body: formData, // FormData para archivos\r\n  });\r\n};\r\n\r\nexport const updateAttachment = (id, data) => {\r\n  // Si data es FormData, no agregar Content-Type header\r\n  const options = {\r\n    method: 'PUT',\r\n    body: data,\r\n  };\r\n  \r\n  // Solo agregar Content-Type si no es FormData\r\n  if (!(data instanceof FormData)) {\r\n    options.headers = {\r\n      'Content-Type': 'application/json',\r\n    };\r\n    options.body = JSON.stringify(data);\r\n  }\r\n  \r\n  return apiFetch(`/api/attachments/${id}`, options);\r\n};\r\n\r\nexport const deleteAttachment = (id) => {\r\n  return apiFetch(`/api/attachments/${id}`, {\r\n    method: 'DELETE',\r\n  });\r\n};\r\n\r\nexport const downloadAttachment = (id) => {\r\n  return apiFetch(`/api/attachments/${id}/download`, {\r\n    method: 'GET',\r\n  });\r\n};\r\n\r\n// Función para descargar archivo\r\nexport const downloadFile = async (attachment) => {\r\n  try {\r\n    const response = await fetch(`/api/attachments/${attachment.id}/download`, {\r\n      method: 'GET',\r\n      headers: {\r\n        'Authorization': `Bearer ${localStorage.getItem('token')}`,\r\n      },\r\n    });\r\n\r\n    if (!response.ok) {\r\n      throw new Error('Error al descargar el archivo');\r\n    }\r\n\r\n    const blob = await response.blob();\r\n    const url = window.URL.createObjectURL(blob);\r\n    const link = document.createElement('a');\r\n    link.href = url;\r\n    link.download = attachment.original_name;\r\n    document.body.appendChild(link);\r\n    link.click();\r\n    document.body.removeChild(link);\r\n    window.URL.revokeObjectURL(url);\r\n  } catch (error) {\r\n    console.error('Error al descargar archivo:', error);\r\n    throw error;\r\n  }\r\n};"],"names":["listProjectAttachments","projectId","apiFetch","getAllAttachments","params","sp","qs","path","data","error","uploadAttachment","formData","updateAttachment","id","options","deleteAttachment","downloadFile","attachment","response","blob","url","link"],"mappings":"wCAGY,MAACA,EAA0BC,GAC9BC,EAAS,oBAAoBD,CAAS,cAAc,EAIhDE,EAAoB,CAACC,EAAS,KAAO,CAChD,MAAMC,EAAK,IAAI,gBACXD,EAAO,MAAMC,EAAG,IAAI,OAAQD,EAAO,IAAI,EACvCA,EAAO,OAAOC,EAAG,IAAI,QAASD,EAAO,KAAK,EAC1CA,EAAO,QAAQC,EAAG,IAAI,SAAUD,EAAO,MAAM,EAC7CA,EAAO,YAAYC,EAAG,IAAI,aAAcD,EAAO,UAAU,EACzDA,EAAO,WAAWC,EAAG,IAAI,YAAaD,EAAO,SAAS,EAE1D,MAAME,EAAKD,EAAG,WACRE,EAAOD,EAAK,wBAAwBA,CAAE,GAAK,uBAEjD,eAAQ,IAAI,qCAAsCC,CAAI,EAE/CL,EAASK,CAAI,EAAE,KAAKC,IACzB,QAAQ,IAAI,4CAA6CA,CAAI,EACtDA,EACR,EAAE,MAAMC,GAAS,CAChB,cAAQ,MAAM,+BAAgCA,CAAK,EAC7CA,CACR,CAAC,CACH,EAMaC,EAAmB,CAACT,EAAWU,IACnCT,EAAS,oBAAoBD,CAAS,eAAgB,CAC3D,OAAQ,OACR,KAAMU,CACV,CAAG,EAGUC,EAAmB,CAACC,EAAIL,IAAS,CAE5C,MAAMM,EAAU,CACd,OAAQ,MACR,KAAMN,CACV,EAGE,OAAMA,aAAgB,WACpBM,EAAQ,QAAU,CAChB,eAAgB,kBACtB,EACIA,EAAQ,KAAO,KAAK,UAAUN,CAAI,GAG7BN,EAAS,oBAAoBW,CAAE,GAAIC,CAAO,CACnD,EAEaC,EAAoBF,GACxBX,EAAS,oBAAoBW,CAAE,GAAI,CACxC,OAAQ,QACZ,CAAG,EAUUG,EAAe,MAAOC,GAAe,CAChD,GAAI,CACF,MAAMC,EAAW,MAAM,MAAM,oBAAoBD,EAAW,EAAE,YAAa,CACzE,OAAQ,MACR,QAAS,CACP,cAAiB,UAAU,aAAa,QAAQ,OAAO,CAAC,EAChE,CACA,CAAK,EAED,GAAI,CAACC,EAAS,GACZ,MAAM,IAAI,MAAM,+BAA+B,EAGjD,MAAMC,EAAO,MAAMD,EAAS,OACtBE,EAAM,OAAO,IAAI,gBAAgBD,CAAI,EACrCE,EAAO,SAAS,cAAc,GAAG,EACvCA,EAAK,KAAOD,EACZC,EAAK,SAAWJ,EAAW,cAC3B,SAAS,KAAK,YAAYI,CAAI,EAC9BA,EAAK,MAAK,EACV,SAAS,KAAK,YAAYA,CAAI,EAC9B,OAAO,IAAI,gBAAgBD,CAAG,CAChC,OAASX,EAAO,CACd,cAAQ,MAAM,8BAA+BA,CAAK,EAC5CA,CACR,CACF"}