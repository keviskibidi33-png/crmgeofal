import{j as e,r as n}from"./index-9t0StVp5.js";import{M as P}from"./ModuloBase-CyF10Bqq.js";const D={position:"fixed",top:0,left:0,width:"100vw",height:"100vh",background:"rgba(0,0,0,0.18)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center"},U={background:"#fff",borderRadius:12,boxShadow:"0 2px 16px #0002",padding:"2rem 2.5rem",minWidth:340,maxWidth:420};function A({open:i,onClose:m,children:s}){return i?e.jsx("div",{style:D,onClick:m,children:e.jsx("div",{style:U,onClick:o=>o.stopPropagation(),children:s})}):null}const q="";function J(){const i=localStorage.getItem("token");return i?{Authorization:`Bearer ${i}`}:{}}async function x(i,m={}){const s={"Content-Type":"application/json",...J(),...m.headers||{}},o=await fetch(`${q}${i}`,{...m,headers:s}),d=await o.text();let a=null;try{a=d?JSON.parse(d):null}catch{a=d}if(!o.ok){const u=a&&a.error||a&&a.message||o.statusText||"Error en la petición",c=new Error(u);throw c.status=o.status,c.body=a,c}return a}const k=20,O=()=>{const[i,m]=n.useState([]),[s,o]=n.useState(null),[d,a]=n.useState(null),[u,c]=n.useState(null),[S,B]=n.useState(0),[E,w]=n.useState(!0),[v,I]=n.useState(null),[h,g]=n.useState(1),[b,T]=n.useState(""),[f,W]=n.useState(""),[_,y]=n.useState(!1),R=[{value:"",label:"Todos los roles"},{value:"admin",label:"Admin"},{value:"jefa_comercial",label:"Jefa Comercial"},{value:"vendedor_comercial",label:"Vendedor Comercial"},{value:"jefe_laboratorio",label:"Jefe Laboratorio"},{value:"usuario_laboratorio",label:"Usuario Laboratorio"},{value:"user",label:"User"}];return n.useEffect(()=>{w(!0),(async()=>{try{const r=[];r.push(`page=${h}`),r.push(`limit=${k}`),b&&r.push(`search=${encodeURIComponent(b)}`),f&&r.push(`role=${encodeURIComponent(f)}`);const j=`/api/users?${r.join("&")}`,t=await x(j);m(t.data||[]),B(t.total||0)}catch(r){I(r.message||"Error al cargar usuarios")}finally{w(!1)}})()},[h,b,f,_]),e.jsxs(P,{titulo:"Gestión de Usuarios",descripcion:"Activa o desactiva el acceso de los agentes, gestiona sus contraseñas y filtra por nombre o área.",children:[e.jsxs("div",{style:{display:"flex",gap:"1rem",marginBottom:"1.5rem",alignItems:"center"},children:[e.jsx("input",{type:"text",placeholder:"Buscar por nombre...",value:b,onChange:r=>{T(r.target.value),g(1)},style:{padding:"0.5rem 1rem",border:"1px solid #ddd",borderRadius:6,minWidth:220}}),e.jsx("select",{value:f,onChange:r=>{W(r.target.value),g(1)},style:{padding:"0.5rem",borderRadius:6,background:"#f5f5f5",fontWeight:500},children:R.map(r=>e.jsx("option",{value:r.value,children:r.label},r.value))})]}),E&&e.jsx("p",{children:"Cargando..."}),v&&e.jsx("p",{style:{color:"red"},children:v}),!E&&!v&&e.jsxs(e.Fragment,{children:[e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",marginBottom:"1rem",background:"#fff",boxShadow:"0 2px 8px #0001",borderRadius:8},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{background:"#f5f5f5"},children:[e.jsx("th",{style:{textAlign:"center",padding:"0.7rem"},children:"Nombre"}),e.jsx("th",{style:{textAlign:"center",padding:"0.7rem"},children:"Apellido"}),e.jsx("th",{style:{textAlign:"center",padding:"0.7rem"},children:"Correo"}),e.jsx("th",{style:{textAlign:"center",padding:"0.7rem"},children:"Rol"}),e.jsx("th",{style:{textAlign:"center",padding:"0.7rem"},children:"Área"}),e.jsx("th",{style:{textAlign:"center",padding:"0.7rem"},children:"Estado"}),e.jsx("th",{style:{textAlign:"center",padding:"0.7rem"},children:"Acceso"}),e.jsx("th",{style:{textAlign:"center",padding:"0.7rem"},children:"Acciones"})]})}),e.jsxs("tbody",{children:[i.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:7,style:{textAlign:"center",padding:"1.5rem"},children:"Sin usuarios"})}),i.map(r=>{var j;return e.jsxs("tr",{style:{borderBottom:"1px solid #f0f0f0"},children:[e.jsx("td",{style:{fontWeight:600,textAlign:"center"},children:r.name}),e.jsx("td",{style:{textAlign:"center"},children:r.apellido||"-"}),e.jsx("td",{style:{textAlign:"center"},children:r.email}),e.jsx("td",{style:{textAlign:"center"},children:e.jsx("span",{style:{background:r.role==="admin"?"#ffe58f":r.role==="jefa_comercial"?"#ffd6e7":r.role==="vendedor_comercial"?"#e6f7ff":r.role==="jefe_laboratorio"?"#d9f7be":r.role==="usuario_laboratorio"?"#f4ffb8":"#f5f5f5",color:r.role==="admin"?"#ad8b00":r.role==="jefa_comercial"?"#c41d7f":r.role==="vendedor_comercial"?"#096dd9":r.role==="jefe_laboratorio"?"#389e0d":r.role==="usuario_laboratorio"?"#b7a200":"#222",borderRadius:8,padding:"0.2rem 0.7rem",fontSize:13,fontWeight:600,display:"inline-block"},children:((j=R.find(t=>t.value===r.role))==null?void 0:j.label)||r.role})}),e.jsx("td",{style:{textAlign:"center"},children:r.area||"-"}),e.jsx("td",{style:{textAlign:"center"},children:e.jsxs("label",{style:{display:"inline-flex",alignItems:"center",cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:r.active,onChange:async t=>{try{await x(`/api/users/${r.id}`,{method:"PATCH",body:JSON.stringify({active:t.target.checked})}),y(l=>!l)}catch(l){alert(l.message||"Error al actualizar estado")}},style:{marginRight:8}}),e.jsx("span",{style:{fontWeight:600,color:r.active?"#0a7d2c":"#c0392b"},children:r.active?"Activo":"Inactivo"})]})}),e.jsxs("td",{style:{textAlign:"center"},children:[e.jsx("button",{title:"Editar",style:{background:"none",border:"1px solid #bbb",borderRadius:4,padding:"0.2rem 0.5rem",cursor:"pointer",marginRight:8},onClick:()=>o(r),children:e.jsx("span",{role:"img","aria-label":"edit",style:{color:"#fa8c16"},children:"✏️"})}),e.jsx("button",{title:"Restablecer contraseña",style:{background:"none",border:"none",cursor:"pointer",marginRight:8},onClick:()=>c(r),children:e.jsx("span",{role:"img","aria-label":"reset",style:{color:"#faad14"},children:"🔑"})}),e.jsx("button",{title:"Eliminar",style:{background:"none",border:"none",color:"#e74c3c",cursor:"pointer"},onClick:()=>a(r),children:e.jsx("span",{role:"img","aria-label":"delete",children:"🗑️"})})]}),e.jsx(A,{open:!!s,onClose:()=>o(null),children:s&&e.jsxs("form",{onSubmit:async t=>{t.preventDefault();const l=t.target,p=l.nombre.value.trim(),M=l.apellido.value.trim(),$=l.email.value.trim(),L=l.rol.value,N=l.area.value.trim();try{await x(`/api/users/${s.id}`,{method:"PATCH",body:JSON.stringify({name:p,apellido:M,email:$,role:L,area:N})}),o(null),y(C=>!C)}catch(C){alert(C.message||"Error al editar usuario")}},children:[e.jsx("h2",{style:{marginBottom:8},children:"Editar Usuario"}),e.jsx("div",{style:{color:"#888",marginBottom:18},children:"Actualiza los datos del usuario."}),e.jsxs("div",{style:{display:"flex",gap:"1rem",marginBottom:18},children:[e.jsxs("div",{style:{flex:1},children:[e.jsx("label",{children:"Nombre"}),e.jsx("input",{name:"nombre",defaultValue:s.name,style:{width:"100%",padding:"0.6rem",borderRadius:8,border:"2px solid #222",marginTop:4,fontWeight:600},required:!0})]}),e.jsxs("div",{style:{flex:1},children:[e.jsx("label",{children:"Apellido"}),e.jsx("input",{name:"apellido",defaultValue:s.apellido,style:{width:"100%",padding:"0.6rem",borderRadius:8,border:"1px solid #ccc",marginTop:4},required:!0})]}),e.jsxs("div",{style:{flex:1},children:[e.jsx("label",{children:"Área"}),e.jsx("input",{name:"area",defaultValue:s.area,style:{width:"100%",padding:"0.6rem",borderRadius:8,border:"1px solid #ccc",marginTop:4},required:!0})]})]}),e.jsxs("div",{style:{marginBottom:18},children:[e.jsx("label",{children:"Correo Electrónico"}),e.jsx("input",{name:"email",defaultValue:s.email,style:{width:"100%",padding:"0.6rem",borderRadius:8,border:"1px solid #ccc",marginTop:4},required:!0})]}),e.jsxs("div",{style:{marginBottom:24},children:[e.jsx("label",{children:"Rol"}),e.jsx("select",{name:"rol",defaultValue:s.role,style:{width:"100%",padding:"0.6rem",borderRadius:8,border:"1px solid #ccc",marginTop:4},children:R.filter(t=>t.value).map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"1rem"},children:[e.jsx("button",{type:"button",onClick:()=>o(null),style:{background:"#fff",border:"2px solid #222",borderRadius:8,padding:"0.7rem 2.2rem",fontWeight:600},children:"Cancelar"}),e.jsx("button",{type:"submit",style:{background:"#222",color:"#fff",border:"none",borderRadius:8,padding:"0.7rem 2.2rem",fontWeight:600},children:"Guardar Cambios"})]})]})}),e.jsx(A,{open:!!u,onClose:()=>c(null),children:u&&e.jsxs("form",{onSubmit:async t=>{t.preventDefault();const l=t.target.password.value.trim();if(l.length<6){alert("La contraseña debe tener al menos 6 caracteres");return}try{await x(`/api/users/${u.id}/reset-password`,{method:"POST",body:JSON.stringify({password:l})}),c(null),y(p=>!p)}catch(p){alert(p.message||"Error al restablecer contraseña")}},children:[e.jsx("h2",{style:{marginBottom:8},children:"Restablecer contraseña"}),e.jsxs("div",{style:{color:"#888",marginBottom:18},children:["Escribe la nueva contraseña para el usuario ",e.jsx("b",{children:u.name}),". Debe tener al menos 6 caracteres."]}),e.jsxs("div",{style:{marginBottom:18},children:[e.jsx("label",{children:"Nueva contraseña"}),e.jsx("input",{name:"password",type:"password",minLength:6,style:{width:"100%",padding:"0.6rem",borderRadius:8,border:"1px solid #ccc",marginTop:4},required:!0})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"1rem"},children:[e.jsx("button",{type:"button",onClick:()=>c(null),style:{background:"#fff",border:"2px solid #222",borderRadius:8,padding:"0.7rem 2.2rem",fontWeight:600},children:"Cancelar"}),e.jsx("button",{type:"submit",style:{background:"#222",color:"#fff",border:"none",borderRadius:8,padding:"0.7rem 2.2rem",fontWeight:600},children:"Restablecer"})]})]})}),e.jsx(A,{open:!!d,onClose:()=>a(null),children:d&&e.jsxs("form",{onSubmit:async t=>{if(t.preventDefault(),t.target.confirm.value==="ELIMINAR")try{await x(`/api/users/${d.id}`,{method:"DELETE"}),a(null),y(l=>!l)}catch(l){alert(l.message||"Error al eliminar usuario")}else alert("Debes escribir ELIMINAR para confirmar")},children:[e.jsx("h2",{style:{marginBottom:8},children:"¿Estás absolutamente seguro?"}),e.jsxs("div",{style:{color:"#888",marginBottom:18},children:["Esta acción no se puede deshacer. Esto eliminará permanentemente al usuario ",e.jsx("b",{children:d.name})," y todos sus datos asociados."]}),e.jsxs("div",{style:{marginBottom:18},children:[e.jsxs("label",{children:["Por favor, escribe ",e.jsx("b",{children:"ELIMINAR"})," para confirmar."]}),e.jsx("input",{name:"confirm",style:{width:"100%",padding:"0.6rem",borderRadius:8,border:"1px solid #ccc",marginTop:4},required:!0})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"1rem"},children:[e.jsx("button",{type:"button",onClick:()=>a(null),style:{background:"#fff",border:"2px solid #222",borderRadius:8,padding:"0.7rem 2.2rem",fontWeight:600},children:"Cancelar"}),e.jsx("button",{type:"submit",style:{background:"#e74c3c",color:"#fff",border:"none",borderRadius:8,padding:"0.7rem 2.2rem",fontWeight:600},children:"Sí, eliminar usuario"})]})]})})]},r.id)})]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("button",{disabled:h===1,onClick:()=>g(r=>r-1),children:"Anterior"}),e.jsxs("span",{children:["Página ",h," de ",Math.ceil(S/k)||1]}),e.jsx("button",{disabled:h*k>=S,onClick:()=>g(r=>r+1),children:"Siguiente"})]})]})]})};export{O as default};
//# sourceMappingURL=Usuarios-BjiYPv6X.js.map
