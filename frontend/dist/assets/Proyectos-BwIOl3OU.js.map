{"version":3,"file":"Proyectos-BwIOl3OU.js","sources":["../../src/pages/Proyectos.jsx"],"sourcesContent":["import React, { useState, useMemo } from 'react';\nimport { useQuery, useMutation, useQueryClient } from 'react-query';\nimport { useNavigate } from 'react-router-dom';\nimport { Button, Badge, Row, Col, Card, Container } from 'react-bootstrap';\nimport { FiPlus, FiEdit, FiTrash2, FiHome, FiMapPin, FiCalendar, FiUser, FiCheckCircle, FiClock, FiX } from 'react-icons/fi';\nimport PageHeader from '../components/common/PageHeader';\nimport DataTable from '../components/common/DataTable';\nimport ModalForm from '../components/common/ModalForm';\nimport StatsCard from '../components/common/StatsCard';\nimport { listProjects, createProject, updateProject, deleteProject } from '../services/projects';\n\nconst emptyForm = { company_id: '', name: '', location: '', vendedor_id: '', laboratorio_id: '' };\n\nexport default function Proyectos() {\n  const [showModal, setShowModal] = useState(false);\n  const [editingProject, setEditingProject] = useState(null);\n  const [deletingProject, setDeletingProject] = useState(null);\n  const navigate = useNavigate();\n\n  const queryClient = useQueryClient();\n\n  const { data, isLoading } = useQuery(\n    ['projects'],\n    () => listProjects(),\n    { keepPreviousData: true }\n  );\n\n  const handleMutationSuccess = (message) => {\n    queryClient.invalidateQueries('projects');\n    setShowModal(false);\n    setEditingProject(null);\n    setDeletingProject(null);\n  };\n\n  const createMutation = useMutation(createProject, {\n    onSuccess: () => handleMutationSuccess('Proyecto creado exitosamente'),\n    onError: (error) => console.error('Error creating project:', error)\n  });\n\n  const updateMutation = useMutation(updateProject, {\n    onSuccess: () => handleMutationSuccess('Proyecto actualizado exitosamente'),\n    onError: (error) => console.error('Error updating project:', error)\n  });\n\n  const deleteMutation = useMutation(deleteProject, {\n    onSuccess: () => handleMutationSuccess('Proyecto eliminado exitosamente'),\n    onError: (error) => console.error('Error deleting project:', error)\n  });\n\n  const handleCreate = () => {\n    setEditingProject(emptyForm);\n    setShowModal(true);\n  };\n\n  const handleEdit = (project) => {\n    setEditingProject(project);\n    setShowModal(true);\n  };\n\n  const handleDelete = (project) => {\n    if (window.confirm(`¿Estás seguro de que quieres eliminar el proyecto \"${project.name}\"?`)) {\n      deleteMutation.mutate(project.id);\n    }\n  };\n\n  const handleSubmit = async (formData) => {\n    if (editingProject.id) {\n      await updateMutation.mutateAsync({ id: editingProject.id, ...formData });\n    } else {\n      await createMutation.mutateAsync(formData);\n    }\n  };\n\n  const getStatusBadge = (status) => {\n    const statusConfig = {\n      'activo': { bg: 'success', text: 'Activo' },\n      'pendiente': { bg: 'warning', text: 'Pendiente' },\n      'completado': { bg: 'primary', text: 'Completado' },\n      'cancelado': { bg: 'danger', text: 'Cancelado' }\n    };\n    \n    const config = statusConfig[status] || { bg: 'secondary', text: status };\n    return <Badge bg={config.bg} className=\"status-badge\">{config.text}</Badge>;\n  };\n\n  const columns = [\n    {\n      header: 'ID',\n      accessor: 'id',\n      width: '80px'\n    },\n    {\n      header: 'Proyecto',\n      accessor: 'name',\n      render: (value, row) => (\n        <div>\n          <div className=\"fw-medium\">{row.name}</div>\n          {row.location && (\n            <small className=\"text-muted\">\n              <FiMapPin size={12} className=\"me-1\" />\n              {row.location}\n            </small>\n          )}\n        </div>\n      )\n    },\n    {\n      header: 'Empresa',\n      accessor: 'company',\n      render: (value, row) => (\n        <div>\n          <div className=\"fw-medium\">{row.company?.name || 'Sin empresa'}</div>\n          {row.company?.ruc && (\n            <small className=\"text-muted\">RUC: {row.company.ruc}</small>\n          )}\n        </div>\n      )\n    },\n    {\n      header: 'Estado',\n      accessor: 'status',\n      render: (value) => getStatusBadge(value || 'activo')\n    },\n    {\n      header: 'Asignado a',\n      accessor: 'vendedor',\n      render: (value, row) => (\n        <div>\n          {row.vendedor && (\n            <div className=\"d-flex align-items-center\">\n              <FiUser size={14} className=\"me-1 text-muted\" />\n              <span>{row.vendedor.name}</span>\n            </div>\n          )}\n          {row.laboratorio && (\n            <div className=\"d-flex align-items-center mt-1\">\n              <FiHome size={14} className=\"me-1 text-muted\" />\n              <span className=\"small text-muted\">{row.laboratorio.name}</span>\n            </div>\n          )}\n        </div>\n      )\n    },\n    {\n      header: 'Fecha Creación',\n      accessor: 'created_at',\n      type: 'date'\n    }\n  ];\n\n  const formFields = [\n    {\n      name: 'company_id',\n      label: 'Empresa',\n      type: 'select',\n      required: true,\n      options: data?.companies?.map(company => ({\n        value: company.id,\n        label: `${company.name} (${company.ruc})`\n      })) || []\n    },\n    {\n      name: 'name',\n      label: 'Nombre del Proyecto',\n      type: 'text',\n      required: true,\n      placeholder: 'Ingresa el nombre del proyecto'\n    },\n    {\n      name: 'location',\n      label: 'Ubicación',\n      type: 'text',\n      placeholder: 'Ingresa la ubicación del proyecto'\n    },\n    {\n      name: 'vendedor_id',\n      label: 'Vendedor Asignado',\n      type: 'select',\n      options: data?.users?.filter(user => \n        ['vendedor_comercial', 'jefa_comercial'].includes(user.role)\n      ).map(user => ({\n        value: user.id,\n        label: `${user.name} ${user.apellido}`\n      })) || []\n    },\n    {\n      name: 'laboratorio_id',\n      label: 'Responsable de Laboratorio',\n      type: 'select',\n      options: data?.users?.filter(user => \n        ['jefe_laboratorio', 'usuario_laboratorio', 'laboratorio'].includes(user.role)\n      ).map(user => ({\n        value: user.id,\n        label: `${user.name} ${user.apellido}`\n      })) || []\n    }\n  ];\n\n  // Calcular estadísticas\n  const stats = useMemo(() => {\n    const projects = data?.projects || [];\n    return {\n      total: projects.length,\n      activos: projects.filter(p => p.status === 'activo').length,\n      completados: projects.filter(p => p.status === 'completado').length,\n      pendientes: projects.filter(p => p.status === 'pendiente').length,\n      cancelados: projects.filter(p => p.status === 'cancelado').length\n    };\n  }, [data]);\n\n  return (\n    <Container fluid className=\"py-4\">\n      <div className=\"fade-in\">\n        <PageHeader\n          title=\"Gestión de Proyectos\"\n          subtitle=\"Crear, editar y gestionar proyectos del sistema\"\n          icon={FiHome}\n          actions={\n            <Button variant=\"primary\" onClick={handleCreate}>\n              <FiPlus className=\"me-2\" />\n              Nuevo Proyecto\n            </Button>\n          }\n        />\n\n        {/* Estadísticas */}\n        <Row className=\"g-4 mb-4\">\n          <Col md={6} lg={3}>\n            <StatsCard\n              title=\"Total Proyectos\"\n              value={stats.total}\n              icon={FiHome}\n              color=\"primary\"\n              subtitle=\"Proyectos registrados\"\n            />\n          </Col>\n          <Col md={6} lg={3}>\n            <StatsCard\n              title=\"Proyectos Activos\"\n              value={stats.activos}\n              icon={FiCheckCircle}\n              color=\"success\"\n              subtitle=\"En desarrollo\"\n            />\n          </Col>\n          <Col md={6} lg={3}>\n            <StatsCard\n              title=\"Completados\"\n              value={stats.completados}\n              icon={FiCheckCircle}\n              color=\"info\"\n              subtitle=\"Finalizados\"\n            />\n          </Col>\n          <Col md={6} lg={3}>\n            <StatsCard\n              title=\"Pendientes\"\n              value={stats.pendientes}\n              icon={FiClock}\n              color=\"warning\"\n              subtitle=\"Por iniciar\"\n            />\n          </Col>\n        </Row>\n\n        {/* Tabla de proyectos */}\n        <Card className=\"shadow-sm border-0\">\n          <Card.Header className=\"bg-white border-bottom\">\n            <div className=\"d-flex justify-content-between align-items-center\">\n              <h5 className=\"mb-0\">\n                <FiHome className=\"me-2 text-primary\" />\n                Lista de Proyectos\n              </h5>\n              <Badge bg=\"light\" text=\"dark\" className=\"px-3 py-2\">\n                {stats.total} proyectos\n              </Badge>\n            </div>\n          </Card.Header>\n          <Card.Body className=\"p-0\">\n            <DataTable\n              data={data?.projects || []}\n              columns={columns}\n              loading={isLoading}\n              onEdit={handleEdit}\n              onDelete={handleDelete}\n              emptyMessage=\"No hay proyectos registrados\"\n            />\n          </Card.Body>\n        </Card>\n\n      <ModalForm\n        show={showModal}\n        onHide={() => setShowModal(false)}\n        title={editingProject?.id ? 'Editar Proyecto' : 'Nuevo Proyecto'}\n        data={editingProject || emptyForm}\n        fields={formFields}\n        onSubmit={handleSubmit}\n        loading={createMutation.isLoading || updateMutation.isLoading}\n        submitText={editingProject?.id ? 'Actualizar' : 'Crear'}\n      />\n      </div>\n    </Container>\n  );\n};"],"names":["emptyForm","Proyectos","showModal","setShowModal","useState","editingProject","setEditingProject","deletingProject","setDeletingProject","useNavigate","queryClient","useQueryClient","data","isLoading","useQuery","listProjects","handleMutationSuccess","message","createMutation","useMutation","createProject","error","updateMutation","updateProject","deleteMutation","deleteProject","handleCreate","handleEdit","project","handleDelete","handleSubmit","formData","getStatusBadge","status","config","jsx","Badge","columns","value","row","jsxs","FiMapPin","_a","_b","FiUser","FiHome","formFields","company","user","_c","stats","useMemo","projects","p","Container","PageHeader","Button","FiPlus","Row","Col","StatsCard","FiCheckCircle","FiClock","Card","DataTable","ModalForm"],"mappings":"uhBAWA,MAAMA,EAAY,CAAE,WAAY,GAAI,KAAM,GAAI,SAAU,GAAI,YAAa,GAAI,eAAgB,EAAA,EAE7F,SAAwBC,IAAY,WAClC,KAAM,CAACC,EAAWC,CAAY,EAAIC,EAAAA,SAAS,EAAK,EAC1C,CAACC,EAAgBC,CAAiB,EAAIF,EAAAA,SAAS,IAAI,EACnD,CAACG,GAAiBC,CAAkB,EAAIJ,EAAAA,SAAS,IAAI,EAC1CK,EAAA,EAEjB,MAAMC,EAAcC,EAAA,EAEd,CAAE,KAAAC,EAAM,UAAAC,CAAA,EAAcC,EAC1B,CAAC,UAAU,EACX,IAAMC,EAAA,EACN,CAAE,iBAAkB,EAAA,CAAK,EAGrBC,EAAyBC,GAAY,CACzCP,EAAY,kBAAkB,UAAU,EACxCP,EAAa,EAAK,EAClBG,EAAkB,IAAI,EACtBE,EAAmB,IAAI,CACzB,EAEMU,EAAiBC,EAAYC,EAAe,CAChD,UAAW,IAAMJ,EAAoD,EACrE,QAAUK,GAAU,QAAQ,MAAM,0BAA2BA,CAAK,CAAA,CACnE,EAEKC,EAAiBH,EAAYI,EAAe,CAChD,UAAW,IAAMP,EAAyD,EAC1E,QAAUK,GAAU,QAAQ,MAAM,0BAA2BA,CAAK,CAAA,CACnE,EAEKG,EAAiBL,EAAYM,EAAe,CAChD,UAAW,IAAMT,EAAuD,EACxE,QAAUK,GAAU,QAAQ,MAAM,0BAA2BA,CAAK,CAAA,CACnE,EAEKK,EAAe,IAAM,CACzBpB,EAAkBN,CAAS,EAC3BG,EAAa,EAAI,CACnB,EAEMwB,EAAcC,GAAY,CAC9BtB,EAAkBsB,CAAO,EACzBzB,EAAa,EAAI,CACnB,EAEM0B,EAAgBD,GAAY,CAC5B,OAAO,QAAQ,sDAAsDA,EAAQ,IAAI,IAAI,GACvFJ,EAAe,OAAOI,EAAQ,EAAE,CAEpC,EAEME,EAAe,MAAOC,GAAa,CACnC1B,EAAe,GACjB,MAAMiB,EAAe,YAAY,CAAE,GAAIjB,EAAe,GAAI,GAAG0B,EAAU,EAEvE,MAAMb,EAAe,YAAYa,CAAQ,CAE7C,EAEMC,EAAkBC,GAAW,CAQjC,MAAMC,EAPe,CACnB,OAAU,CAAE,GAAI,UAAW,KAAM,QAAA,EACjC,UAAa,CAAE,GAAI,UAAW,KAAM,WAAA,EACpC,WAAc,CAAE,GAAI,UAAW,KAAM,YAAA,EACrC,UAAa,CAAE,GAAI,SAAU,KAAM,WAAA,CAAY,EAGrBD,CAAM,GAAK,CAAE,GAAI,YAAa,KAAMA,CAAA,EAChE,OAAOE,MAACC,GAAM,GAAIF,EAAO,GAAI,UAAU,eAAgB,WAAO,IAAA,CAAK,CACrE,EAEMG,EAAU,CACd,CACE,OAAQ,KACR,SAAU,KACV,MAAO,MAAA,EAET,CACE,OAAQ,WACR,SAAU,OACV,OAAQ,CAACC,EAAOC,WACb,MAAA,CACC,SAAA,CAAAJ,EAAAA,IAAC,MAAA,CAAI,UAAU,YAAa,SAAAI,EAAI,KAAK,EACpCA,EAAI,UACHC,OAAC,QAAA,CAAM,UAAU,aACf,SAAA,CAAAL,EAAAA,IAACM,EAAA,CAAS,KAAM,GAAI,UAAU,OAAO,EACpCF,EAAI,QAAA,CAAA,CACP,CAAA,CAAA,CAEJ,CAAA,EAGJ,CACE,OAAQ,UACR,SAAU,UACV,OAAQ,CAACD,EAAOC,IAAA,uBACb,MAAA,CACC,SAAA,CAAAJ,MAAC,OAAI,UAAU,YAAa,WAAAO,EAAAH,EAAI,UAAJ,YAAAG,EAAa,OAAQ,cAAc,IAC9DC,EAAAJ,EAAI,UAAJ,YAAAI,EAAa,MACZH,EAAAA,KAAC,QAAA,CAAM,UAAU,aAAa,SAAA,CAAA,QAAMD,EAAI,QAAQ,GAAA,CAAA,CAAI,CAAA,CAAA,CAExD,EAAA,EAGJ,CACE,OAAQ,SACR,SAAU,SACV,OAASD,GAAUN,EAAeM,GAAS,QAAQ,CAAA,EAErD,CACE,OAAQ,aACR,SAAU,WACV,OAAQ,CAACA,EAAOC,WACb,MAAA,CACE,SAAA,CAAAA,EAAI,UACHC,OAAC,MAAA,CAAI,UAAU,4BACb,SAAA,CAAAL,EAAAA,IAACS,EAAA,CAAO,KAAM,GAAI,UAAU,kBAAkB,EAC9CT,EAAAA,IAAC,OAAA,CAAM,SAAAI,EAAI,SAAS,IAAA,CAAK,CAAA,EAC3B,EAEDA,EAAI,aACHC,OAAC,MAAA,CAAI,UAAU,iCACb,SAAA,CAAAL,EAAAA,IAACU,EAAA,CAAO,KAAM,GAAI,UAAU,kBAAkB,QAC7C,OAAA,CAAK,UAAU,mBAAoB,SAAAN,EAAI,YAAY,IAAA,CAAK,CAAA,CAAA,CAC3D,CAAA,CAAA,CAEJ,CAAA,EAGJ,CACE,OAAQ,iBACR,SAAU,aACV,KAAM,MAAA,CACR,EAGIO,EAAa,CACjB,CACE,KAAM,aACN,MAAO,UACP,KAAM,SACN,SAAU,GACV,UAASJ,EAAA9B,GAAA,YAAAA,EAAM,YAAN,YAAA8B,EAAiB,IAAIK,IAAY,CACxC,MAAOA,EAAQ,GACf,MAAO,GAAGA,EAAQ,IAAI,KAAKA,EAAQ,GAAG,GAAA,MACjC,CAAA,CAAC,EAEV,CACE,KAAM,OACN,MAAO,sBACP,KAAM,OACN,SAAU,GACV,YAAa,gCAAA,EAEf,CACE,KAAM,WACN,MAAO,YACP,KAAM,OACN,YAAa,mCAAA,EAEf,CACE,KAAM,cACN,MAAO,oBACP,KAAM,SACN,UAASJ,EAAA/B,GAAA,YAAAA,EAAM,QAAN,YAAA+B,EAAa,UACpB,CAAC,qBAAsB,gBAAgB,EAAE,SAASK,EAAK,IAAI,GAC3D,IAAIA,IAAS,CACb,MAAOA,EAAK,GACZ,MAAO,GAAGA,EAAK,IAAI,IAAIA,EAAK,QAAQ,EAAA,MAC/B,CAAA,CAAC,EAEV,CACE,KAAM,iBACN,MAAO,6BACP,KAAM,SACN,UAASC,EAAArC,GAAA,YAAAA,EAAM,QAAN,YAAAqC,EAAa,OAAOD,GAC3B,CAAC,mBAAoB,sBAAuB,aAAa,EAAE,SAASA,EAAK,IAAI,GAC7E,IAAIA,IAAS,CACb,MAAOA,EAAK,GACZ,MAAO,GAAGA,EAAK,IAAI,IAAIA,EAAK,QAAQ,EAAA,MAC/B,CAAA,CAAC,CACV,EAIIE,EAAQC,EAAAA,QAAQ,IAAM,CAC1B,MAAMC,GAAWxC,GAAA,YAAAA,EAAM,WAAY,CAAA,EACnC,MAAO,CACL,MAAOwC,EAAS,OAChB,QAASA,EAAS,UAAYC,EAAE,SAAW,QAAQ,EAAE,OACrD,YAAaD,EAAS,UAAYC,EAAE,SAAW,YAAY,EAAE,OAC7D,WAAYD,EAAS,UAAYC,EAAE,SAAW,WAAW,EAAE,OAC3D,WAAYD,EAAS,UAAYC,EAAE,SAAW,WAAW,EAAE,MAAA,CAE/D,EAAG,CAACzC,CAAI,CAAC,EAET,OACEuB,EAAAA,IAACmB,GAAU,MAAK,GAAC,UAAU,OACzB,SAAAd,EAAAA,KAAC,MAAA,CAAI,UAAU,UACb,SAAA,CAAAL,EAAAA,IAACoB,EAAA,CACC,MAAM,uBACN,SAAS,kDACT,KAAMV,EACN,QACEL,EAAAA,KAACgB,EAAA,CAAO,QAAQ,UAAU,QAAS9B,EACjC,SAAA,CAAAS,EAAAA,IAACsB,EAAA,CAAO,UAAU,MAAA,CAAO,EAAE,gBAAA,CAAA,CAE7B,CAAA,CAAA,EAKJjB,EAAAA,KAACkB,EAAA,CAAI,UAAU,WACb,SAAA,CAAAvB,EAAAA,IAACwB,EAAA,CAAI,GAAI,EAAG,GAAI,EACd,SAAAxB,EAAAA,IAACyB,EAAA,CACC,MAAM,kBACN,MAAOV,EAAM,MACb,KAAML,EACN,MAAM,UACN,SAAS,uBAAA,CAAA,EAEb,EACAV,EAAAA,IAACwB,EAAA,CAAI,GAAI,EAAG,GAAI,EACd,SAAAxB,EAAAA,IAACyB,EAAA,CACC,MAAM,oBACN,MAAOV,EAAM,QACb,KAAMW,EACN,MAAM,UACN,SAAS,eAAA,CAAA,EAEb,EACA1B,EAAAA,IAACwB,EAAA,CAAI,GAAI,EAAG,GAAI,EACd,SAAAxB,EAAAA,IAACyB,EAAA,CACC,MAAM,cACN,MAAOV,EAAM,YACb,KAAMW,EACN,MAAM,OACN,SAAS,aAAA,CAAA,EAEb,EACA1B,EAAAA,IAACwB,EAAA,CAAI,GAAI,EAAG,GAAI,EACd,SAAAxB,EAAAA,IAACyB,EAAA,CACC,MAAM,aACN,MAAOV,EAAM,WACb,KAAMY,EACN,MAAM,UACN,SAAS,aAAA,CAAA,CACX,CACF,CAAA,EACF,EAGAtB,EAAAA,KAACuB,EAAA,CAAK,UAAU,qBACd,SAAA,CAAA5B,EAAAA,IAAC4B,EAAK,OAAL,CAAY,UAAU,yBACrB,SAAAvB,EAAAA,KAAC,MAAA,CAAI,UAAU,oDACb,SAAA,CAAAA,EAAAA,KAAC,KAAA,CAAG,UAAU,OACZ,SAAA,CAAAL,EAAAA,IAACU,EAAA,CAAO,UAAU,mBAAA,CAAoB,EAAE,oBAAA,EAE1C,SACCT,EAAA,CAAM,GAAG,QAAQ,KAAK,OAAO,UAAU,YACrC,SAAA,CAAAc,EAAM,MAAM,YAAA,CAAA,CACf,CAAA,CAAA,CACF,CAAA,CACF,EACAf,EAAAA,IAAC4B,EAAK,KAAL,CAAU,UAAU,MACnB,SAAA5B,EAAAA,IAAC6B,EAAA,CACC,MAAMpD,GAAA,YAAAA,EAAM,WAAY,CAAA,EACxB,QAAAyB,EACA,QAASxB,EACT,OAAQc,EACR,SAAUE,EACV,aAAa,8BAAA,CAAA,CACf,CACF,CAAA,EACF,EAEFM,EAAAA,IAAC8B,EAAA,CACC,KAAM/D,EACN,OAAQ,IAAMC,EAAa,EAAK,EAChC,MAAOE,GAAA,MAAAA,EAAgB,GAAK,kBAAoB,iBAChD,KAAMA,GAAkBL,EACxB,OAAQ8C,EACR,SAAUhB,EACV,QAASZ,EAAe,WAAaI,EAAe,UACpD,WAAYjB,GAAA,MAAAA,EAAgB,GAAK,aAAe,OAAA,CAAA,CAClD,CAAA,CACA,CAAA,CACF,CAEJ"}