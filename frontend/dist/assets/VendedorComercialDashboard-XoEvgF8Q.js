import{r as d,u as G,b as J,j as e,aq as u,B as b,A as K,y as O,h as y,t as C,a0 as z,$ as Q,l as T,C as x}from"./index-_ax5caxz.js";import{P as W}from"./PageHeader-D9ORK77W.js";import{S as o}from"./StatsCard-yUry652J.js";import{C as w,R as c}from"./Row-DUT7dzcT.js";import{S as h}from"./Spinner-CWz_2665.js";import{A as N}from"./Alert-e0x4JDT9.js";import{C as i}from"./Col-DhWa0-63.js";import{C as t}from"./Card-DX68ND5N.js";function te(){var D,A,$,L,k,B;const[s,U]=d.useState(null),[V,E]=d.useState(!0),[g,j]=d.useState(null),[S,R]=d.useState(!1),[r,M]=d.useState(null),[F,m]=d.useState(null),[P,q]=d.useState(null),v=G();d.useEffect(()=>{_()},[]);const _=async(a=!1)=>{try{a?R(!0):E(!0),j(null),m(null);const l=await J("/api/role-dashboard/vendedor-comercial");if(!l)throw new Error("No se recibieron datos del servidor");U(l),q(new Date),a&&(m("Datos actualizados correctamente"),setTimeout(()=>m(null),3e3))}catch(l){console.error("Error fetching dashboard data:",l);const n=l.message||"Error al cargar los datos del dashboard. Por favor, inténtalo de nuevo.";j(n)}finally{E(!1),R(!1)}},I=()=>{_(!0)},p=async(a,l)=>{try{switch(M(a),j(null),m(null),await new Promise(n=>setTimeout(n,1e3)),a){case"nueva-cotizacion":v("/cotizaciones/inteligente");break;case"ver-clientes":v("/clientes");break;case"ver-proyectos":v("/proyectos");break;case"enviar-comprobante":v("/comprobantes-pago");break;default:throw new Error(`Acción ${a} no implementada`)}m(`${l} ejecutado correctamente`),setTimeout(()=>m(null),2e3)}catch(n){console.error(`Error en acción ${a}:`,n);const f=n.message||`Error al ejecutar ${l}. Por favor, inténtalo de nuevo.`;j(f)}finally{M(null)}};return V?e.jsx(w,{fluid:!0,className:"p-4",children:e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{height:"400px"},children:e.jsx(h,{animation:"border",size:"lg"})})}):g?e.jsx(w,{fluid:!0,className:"p-4",children:e.jsx(N,{variant:"danger",children:g})}):e.jsxs(w,{fluid:!0,className:"p-4",children:[e.jsx(W,{title:"Mi Dashboard Comercial",subtitle:"Métricas personales y rendimiento",icon:u,children:e.jsxs("div",{className:"d-flex align-items-center",children:[P&&e.jsxs("small",{className:"text-muted me-3",children:["Última actualización: ",P.toLocaleTimeString("es-PE")]}),e.jsx(b,{variant:"outline-primary",size:"sm",onClick:I,disabled:S,children:S?e.jsxs(e.Fragment,{children:[e.jsx(h,{size:"sm",className:"me-2"}),"Actualizando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(K,{className:"me-2"}),"Actualizar"]})})]})}),g&&e.jsxs(N,{variant:"danger",dismissible:!0,onClose:()=>j(null),className:"mb-4",children:[e.jsx(N.Heading,{children:"⚠️ Error"}),g]}),F&&e.jsxs(N,{variant:"success",dismissible:!0,onClose:()=>m(null),className:"mb-4",children:[e.jsx(N.Heading,{children:"✅ Éxito"}),F]}),e.jsx(c,{className:"mb-4",children:e.jsx(i,{children:e.jsxs(t,{className:"shadow-sm",children:[e.jsx(t.Header,{children:e.jsx("h5",{className:"mb-0",children:"⚡ Acciones Rápidas"})}),e.jsx(t.Body,{children:e.jsxs(c,{className:"g-3",children:[e.jsx(i,{md:3,children:e.jsxs(b,{variant:"primary",className:"w-100 d-flex align-items-center justify-content-center",onClick:()=>p("nueva-cotizacion","Nueva Cotización"),disabled:r==="nueva-cotizacion",children:[r==="nueva-cotizacion"?e.jsx(h,{size:"sm",className:"me-2"}):e.jsx(O,{className:"me-2"}),"Nueva Cotización"]})}),e.jsx(i,{md:3,children:e.jsxs(b,{variant:"info",className:"w-100 d-flex align-items-center justify-content-center",onClick:()=>p("ver-clientes","Ver Clientes"),disabled:r==="ver-clientes",children:[r==="ver-clientes"?e.jsx(h,{size:"sm",className:"me-2"}):e.jsx(y,{className:"me-2"}),"Ver Clientes"]})}),e.jsx(i,{md:3,children:e.jsxs(b,{variant:"success",className:"w-100 d-flex align-items-center justify-content-center",onClick:()=>p("ver-proyectos","Ver Proyectos"),disabled:r==="ver-proyectos",children:[r==="ver-proyectos"?e.jsx(h,{size:"sm",className:"me-2"}):e.jsx(C,{className:"me-2"}),"Ver Proyectos"]})}),e.jsx(i,{md:3,children:e.jsxs(b,{variant:"warning",className:"w-100 d-flex align-items-center justify-content-center",onClick:()=>p("enviar-comprobante","Enviar Comprobante"),disabled:r==="enviar-comprobante",children:[r==="enviar-comprobante"?e.jsx(h,{size:"sm",className:"me-2"}):e.jsx(z,{className:"me-2"}),"Enviar Comprobante"]})})]})})]})})}),e.jsx(c,{className:"mb-4 g-3",children:e.jsx(i,{children:e.jsxs("h4",{className:"text-primary mb-3",children:[e.jsx(u,{className:"me-2"}),"Resumen de tu actividad comercial"]})})}),e.jsxs(c,{className:"mb-4 g-3",children:[e.jsx(i,{lg:3,md:6,children:e.jsx(o,{title:"Mis Cotizaciones",value:(s==null?void 0:s.misCotizaciones)||0,icon:u,color:"primary",subtitle:`${(s==null?void 0:s.cotizacionesAprobadas)||0} aprobadas`,size:"normal"})}),e.jsx(i,{lg:3,md:6,children:e.jsx(o,{title:"Clientes",value:(s==null?void 0:s.totalClientes)||0,icon:y,color:"info",subtitle:`${(s==null?void 0:s.clientesNuevosEsteMes)||0} nuevos este mes`,size:"normal"})}),e.jsx(i,{lg:3,md:6,children:e.jsx(o,{title:"Ingresos Generados",value:`$${((s==null?void 0:s.ingresosGenerados)||0).toLocaleString()}`,icon:z,color:"success",subtitle:`${(s==null?void 0:s.cotizacionesFacturadas)||0} facturadas`,size:"normal"})}),e.jsx(i,{lg:3,md:6,children:e.jsx(o,{title:"Tasa de Conversión",value:`${(s==null?void 0:s.conversionRate)||0}%`,icon:Q,color:"warning",subtitle:"Cotizaciones aprobadas",size:"normal"})})]}),e.jsx(c,{className:"mb-4 g-3",children:e.jsx(i,{children:e.jsxs("h4",{className:"text-info mb-3",children:[e.jsx(T,{className:"me-2"}),"Métricas mensuales y proyectos"]})})}),e.jsxs(c,{className:"mb-4 g-3",children:[e.jsx(i,{lg:3,md:6,children:e.jsx(o,{title:"Proyectos Activos",value:(s==null?void 0:s.proyectosActivos)||0,icon:C,color:"primary",subtitle:`${(s==null?void 0:s.proyectosCompletados)||0} completados`,size:"normal"})}),e.jsx(i,{lg:3,md:6,children:e.jsx(o,{title:"Cotizaciones Este Mes",value:(s==null?void 0:s.cotizacionesEsteMes)||0,icon:T,color:"info",subtitle:"Nuevas cotizaciones",size:"normal"})}),e.jsx(i,{lg:3,md:6,children:e.jsx(o,{title:"Ingresos Este Mes",value:`$${((s==null?void 0:s.ingresosEsteMes)||0).toLocaleString()}`,icon:z,color:"success",subtitle:"Ingresos del mes actual",size:"normal"})}),e.jsx(i,{lg:3,md:6,children:e.jsx(o,{title:"Clientes Nuevos",value:(s==null?void 0:s.clientesNuevosEsteMes)||0,icon:y,color:"warning",subtitle:"Este mes",size:"normal"})})]}),e.jsx(c,{className:"mb-4",children:e.jsx(i,{children:e.jsxs("h4",{className:"text-success mb-3",children:[e.jsx(u,{className:"me-2"}),"Actividad reciente"]})})}),e.jsxs(c,{className:"mb-4",children:[e.jsx(i,{lg:6,children:e.jsxs(t,{className:"shadow-sm",children:[e.jsxs(t.Header,{className:"d-flex justify-content-between align-items-center",children:[e.jsx("h5",{className:"mb-0",children:"📋 Mis Cotizaciones Recientes"}),e.jsx(x,{bg:"primary",children:((D=s==null?void 0:s.cotizacionesRecientes)==null?void 0:D.length)||0})]}),e.jsx(t.Body,{children:((A=s==null?void 0:s.cotizacionesRecientes)==null?void 0:A.length)>0?e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-sm table-hover",children:[e.jsx("thead",{className:"table-light",children:e.jsxs("tr",{children:[e.jsx("th",{children:"Código"}),e.jsx("th",{children:"Cliente"}),e.jsx("th",{children:"Monto"}),e.jsx("th",{children:"Estado"}),e.jsx("th",{children:"Fecha"})]})}),e.jsx("tbody",{children:s.cotizacionesRecientes.map((a,l)=>{var n,f,H;return e.jsxs("tr",{children:[e.jsxs("td",{children:[e.jsx("code",{className:"text-primary",children:a.quote_number}),((n=a.distinctive_info)==null?void 0:n.variant)&&e.jsx("div",{children:e.jsx(x,{bg:"primary",size:"sm",children:a.distinctive_info.variant})})]}),e.jsxs("td",{children:[e.jsx("div",{className:"fw-medium",children:a.client_contact}),a.project_name&&e.jsx("div",{className:"text-muted small",children:a.project_name})]}),e.jsxs("td",{children:[e.jsxs("span",{className:"fw-bold text-success",children:["S/ ",((f=a.total_amount)==null?void 0:f.toLocaleString("es-PE",{minimumFractionDigits:2,maximumFractionDigits:2}))||"0.00"]}),((H=a.distinctive_info)==null?void 0:H.delivery_days)&&e.jsxs("div",{className:"text-muted small",children:[a.distinctive_info.delivery_days," días hábiles"]})]}),e.jsx("td",{children:e.jsx(x,{bg:a.status==="aprobada"?"success":a.status==="facturada"?"primary":a.status==="pendiente"?"warning":a.status==="borrador"?"secondary":"info",className:"text-capitalize",children:a.status||"nueva"})}),e.jsx("td",{children:e.jsx("small",{className:"text-muted",children:new Date(a.created_at).toLocaleDateString("es-PE")})})]},l)})})]})}):e.jsxs("div",{className:"text-center py-4",children:[e.jsx(u,{size:48,className:"text-muted mb-3"}),e.jsx("p",{className:"text-muted mb-0",children:"No tienes cotizaciones recientes"}),e.jsx("small",{className:"text-muted",children:'Crea tu primera cotización usando el botón "Nueva Cotización"'})]})})]})}),e.jsx(i,{lg:6,children:e.jsxs(t,{className:"shadow-sm",children:[e.jsxs(t.Header,{className:"d-flex justify-content-between align-items-center",children:[e.jsx("h5",{className:"mb-0",children:"👥 Mis Clientes Recientes"}),e.jsx(x,{bg:"info",children:(($=s==null?void 0:s.clientesRecientes)==null?void 0:$.length)||0})]}),e.jsx(t.Body,{children:((L=s==null?void 0:s.clientesRecientes)==null?void 0:L.length)>0?e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-sm table-hover",children:[e.jsx("thead",{className:"table-light",children:e.jsxs("tr",{children:[e.jsx("th",{children:"Empresa"}),e.jsx("th",{children:"RUC"}),e.jsx("th",{children:"Última Cotización"})]})}),e.jsx("tbody",{children:s.clientesRecientes.map((a,l)=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("div",{className:"fw-medium",children:a.name})}),e.jsx("td",{children:e.jsx("code",{className:"text-muted",children:a.ruc})}),e.jsx("td",{children:e.jsx("small",{className:"text-muted",children:new Date(a.ultima_cotizacion).toLocaleDateString("es-PE")})})]},l))})]})}):e.jsxs("div",{className:"text-center py-4",children:[e.jsx(y,{size:48,className:"text-muted mb-3"}),e.jsx("p",{className:"text-muted mb-0",children:"No tienes clientes recientes"}),e.jsx("small",{className:"text-muted",children:"Los clientes aparecerán aquí cuando crees cotizaciones"})]})})]})})]}),e.jsx(c,{children:e.jsx(i,{children:e.jsxs(t,{className:"shadow-sm",children:[e.jsxs(t.Header,{className:"d-flex justify-content-between align-items-center",children:[e.jsx("h5",{className:"mb-0",children:"📁 Mis Proyectos Recientes"}),e.jsx(x,{bg:"success",children:((k=s==null?void 0:s.proyectosRecientes)==null?void 0:k.length)||0})]}),e.jsx(t.Body,{children:((B=s==null?void 0:s.proyectosRecientes)==null?void 0:B.length)>0?e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-sm table-hover",children:[e.jsx("thead",{className:"table-light",children:e.jsxs("tr",{children:[e.jsx("th",{children:"Proyecto"}),e.jsx("th",{children:"Empresa"}),e.jsx("th",{children:"Estado"}),e.jsx("th",{children:"Fecha Creación"})]})}),e.jsx("tbody",{children:s.proyectosRecientes.map((a,l)=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("div",{className:"fw-medium",children:a.name})}),e.jsx("td",{children:e.jsx("div",{className:"text-muted",children:a.company_name})}),e.jsx("td",{children:e.jsx(x,{bg:a.status==="activo"?"success":a.status==="completado"?"primary":a.status==="pendiente"?"warning":a.status==="en_progreso"?"info":"secondary",className:"text-capitalize",children:a.status})}),e.jsx("td",{children:e.jsx("small",{className:"text-muted",children:new Date(a.created_at).toLocaleDateString("es-PE")})})]},l))})]})}):e.jsxs("div",{className:"text-center py-4",children:[e.jsx(C,{size:48,className:"text-muted mb-3"}),e.jsx("p",{className:"text-muted mb-0",children:"No tienes proyectos recientes"}),e.jsx("small",{className:"text-muted",children:"Los proyectos aparecerán aquí cuando crees cotizaciones"})]})})]})})})]})}export{te as default};
//# sourceMappingURL=VendedorComercialDashboard-XoEvgF8Q.js.map
