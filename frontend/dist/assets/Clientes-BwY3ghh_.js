import{r as t,j as e}from"./index-BFrTSJXc.js";import{M as q}from"./ModuloBase-BXjPI6cD.js";import{M as k}from"./Modal-B5At1RZR.js";import{T as F,a as P}from"./Toolbar-CsECCMO9.js";import{T as B}from"./Toast-BbbM5Ntr.js";import{l as G,d as L,u as U,c as z}from"./companies-CU1Nz5ws.js";const j=20,b={type:"empresa",ruc:"",dni:"",name:"",address:"",email:"",phone:"",contact_name:""},Q=()=>{const[g,w]=t.useState([]),[f,I]=t.useState(0),[T,y]=t.useState(!0),[N,v]=t.useState(""),[r,c]=t.useState(1),[d,R]=t.useState(""),[C,o]=t.useState(!1),[i,m]=t.useState(null),[a,l]=t.useState(b),[u,S]=t.useState(!1),[E,h]=t.useState({message:"",type:"success"}),p=async()=>{y(!0),v("");try{const s=await G({page:r,limit:j,search:d});w((s==null?void 0:s.data)||[]),I(Number((s==null?void 0:s.total)||0))}catch(s){v(s.message||"Error al cargar clientes")}finally{y(!1)}};t.useEffect(()=>{p()},[r,d]);const D=()=>{m(null),l(b),o(!0)},A=s=>{m(s),l({type:s.type||"empresa",ruc:s.ruc||"",dni:s.dni||"",name:s.name||"",address:s.address||"",email:s.email||"",phone:s.phone||"",contact_name:s.contact_name||""}),o(!0)},M=async s=>{if(window.prompt(`Para eliminar al cliente "${s.name}", escribe ELIMINAR`)==="ELIMINAR")try{await L(s.id),await p()}catch(x){alert(x.message||"Error al eliminar cliente")}},_=async s=>{s.preventDefault();const n={...a};if(n.type==="empresa"){if(!n.ruc)return alert("RUC es obligatorio para empresa");n.dni=""}else{if(!n.dni)return alert("DNI es obligatorio para persona natural");n.ruc=""}try{S(!0),i?await U(i.id,n):await z(n),o(!1),m(null),l(b),await p(),h({message:i?"Cliente actualizado":"Cliente creado",type:"success"})}catch(x){h({message:x.message||"Error al guardar",type:"error"})}finally{S(!1)}};return e.jsxs(q,{titulo:"Gestión de Clientes",descripcion:"Administra clientes: empresas o personas naturales, contactos y datos de facturación.",children:[e.jsx(F,{left:e.jsxs(e.Fragment,{children:[e.jsx("input",{placeholder:"Buscar por nombre, RUC o DNI",value:d,onChange:s=>{R(s.target.value),c(1)},style:{padding:"0.6rem 0.8rem",border:"1px solid #ddd",borderRadius:8,minWidth:260}}),T&&e.jsx("span",{style:{color:"#888"},children:"Cargando..."}),N&&e.jsx("span",{style:{color:"red"},children:N})]}),right:e.jsx("button",{onClick:D,className:"btn btn-primary",children:"+ Agregar cliente"})}),e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-striped align-middle",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"ID"}),e.jsx("th",{children:"Tipo"}),e.jsx("th",{children:"RUC/DNI"}),e.jsx("th",{children:"Nombre"}),e.jsx("th",{children:"Contacto"}),e.jsx("th",{children:"Email"}),e.jsx("th",{children:"Teléfono"}),e.jsx("th",{children:"Dirección"}),e.jsx("th",{children:"Acciones"})]})}),e.jsxs("tbody",{children:[g.length===0&&e.jsx(P,{colSpan:9,message:"Sin clientes"}),g.map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:s.id}),e.jsx("td",{children:s.type}),e.jsx("td",{children:s.type==="empresa"?s.ruc||"-":s.dni||"-"}),e.jsx("td",{children:s.name}),e.jsx("td",{children:s.contact_name||"-"}),e.jsx("td",{children:s.email}),e.jsx("td",{children:s.phone}),e.jsx("td",{style:{maxWidth:260},children:s.address}),e.jsxs("td",{children:[e.jsx("button",{className:"btn btn-sm btn-secondary me-1",onClick:()=>A(s),children:"Editar"}),e.jsx("button",{className:"btn btn-sm btn-danger",onClick:()=>M(s),children:"Eliminar"})]})]},s.id))]})]})}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("button",{className:"btn btn-outline-secondary",disabled:r===1,onClick:()=>c(s=>s-1),children:"Anterior"}),e.jsxs("span",{children:["Página ",r," de ",Math.ceil((f||0)/j)||1]}),e.jsx("button",{className:"btn btn-outline-secondary",disabled:r*j>=f,onClick:()=>c(s=>s+1),children:"Siguiente"})]}),C&&e.jsx(k,{open:C,onClose:()=>o(!1),children:e.jsxs("form",{onSubmit:_,children:[e.jsx("h3",{style:{marginBottom:8},children:i?"Editar cliente":"Nuevo cliente"}),e.jsx("div",{style:{color:"#888",marginBottom:16},children:i?"Actualiza los datos del cliente.":"Completa los datos del nuevo cliente."}),e.jsxs("div",{className:"row g-3",children:[e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label",children:"Tipo"}),e.jsxs("select",{className:"form-select",value:a.type,onChange:s=>l({...a,type:s.target.value}),children:[e.jsx("option",{value:"empresa",children:"Empresa"}),e.jsx("option",{value:"persona_natural",children:"Persona Natural"})]})]}),a.type==="empresa"?e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label",children:"RUC"}),e.jsx("input",{className:"form-control",value:a.ruc,onChange:s=>l({...a,ruc:s.target.value}),required:!0})]}):e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label",children:"DNI"}),e.jsx("input",{className:"form-control",value:a.dni,onChange:s=>l({...a,dni:s.target.value}),required:!0})]}),e.jsxs("div",{className:"col-md-8",children:[e.jsx("label",{className:"form-label",children:"Nombre / Razón Social"}),e.jsx("input",{className:"form-control",value:a.name,onChange:s=>l({...a,name:s.target.value}),required:!0})]}),e.jsxs("div",{className:"col-md-12",children:[e.jsx("label",{className:"form-label",children:"Dirección"}),e.jsx("input",{className:"form-control",value:a.address,onChange:s=>l({...a,address:s.target.value}),required:!0})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"Correo"}),e.jsx("input",{type:"email",className:"form-control",value:a.email,onChange:s=>l({...a,email:s.target.value}),required:!0})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"Teléfono"}),e.jsx("input",{className:"form-control",value:a.phone,onChange:s=>l({...a,phone:s.target.value}),required:!0})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"Contacto"}),e.jsx("input",{className:"form-control",value:a.contact_name,onChange:s=>l({...a,contact_name:s.target.value}),required:!0})]})]}),e.jsxs("div",{className:"mt-3 d-flex justify-content-end gap-2",children:[e.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>o(!1),disabled:u,children:"Cancelar"}),e.jsx("button",{type:"submit",className:"btn btn-success",disabled:u,children:u?"Guardando...":"Guardar"})]})]})}),e.jsx(B,{message:E.message,type:E.type,onClose:()=>h({message:"",type:"success"})})]})};export{Q as default};
//# sourceMappingURL=Clientes-BwY3ghh_.js.map
