import{r as s,a as _,j as e}from"./index-BFrTSJXc.js";import{M as O}from"./ModuloBase-BXjPI6cD.js";import{T as Q,a as H}from"./Toolbar-CsECCMO9.js";import{T as J}from"./Toast-BbbM5Ntr.js";import{l as K,c as U,u as V,d as W}from"./services-f6-NAC_H.js";import{F as L}from"./FloatingInput-eCZ0aVQo.js";import{M as X}from"./Modal-B5At1RZR.js";function oe(){var A;const[x,q]=s.useState([]),[S,D]=s.useState(0),[n,j]=s.useState(1),[C]=s.useState(10),[v,k]=s.useState(!1),[i,z]=s.useState(""),[c,l]=s.useState({show:!1,variant:"success",message:""}),[B,d]=s.useState(!1),[p,E]=s.useState(""),[g,M]=s.useState("laboratorio"),[o,r]=s.useState({open:!1,id:null,name:"",area:"laboratorio"}),[f,G]=s.useState(""),[m,u]=s.useState({open:!1,row:null}),{user:N}=_(),h=["admin","jefe_laboratorio","jefa_comercial"].includes(N==null?void 0:N.role),b=async()=>{try{k(!0);const a=await K({page:n,limit:C,area:i||void 0,q:f||void 0}),t=Array.isArray(a==null?void 0:a.data)?a.data:(a==null?void 0:a.rows)||a||[];q(t),D((a==null?void 0:a.total)??t.length)}catch(a){l({show:!0,variant:"danger",message:a.message||"No se pudo cargar"})}finally{k(!1)}};s.useEffect(()=>{b()},[n,i,f]);const R=async a=>{a.preventDefault();try{if((x||[]).some(T=>String(T.name).trim().toLowerCase()===String(p).trim().toLowerCase()&&(i?T.area===g:!0))){l({show:!0,variant:"warning",message:"Ya existe un servicio con ese nombre"});return}await U({name:p,area:g}),l({show:!0,variant:"success",message:"Servicio creado"}),d(!1),E(""),M("laboratorio"),b()}catch(t){l({show:!0,variant:"danger",message:t.message||"Error al crear"})}},w=Math.max(1,Math.ceil((S||0)/C)),F=a=>{r({open:!0,id:a.id,name:a.name||"",area:a.area||"laboratorio"})},I=async()=>{try{if((x||[]).some(t=>t.id!==o.id&&String(t.name).trim().toLowerCase()===String(o.name).trim().toLowerCase()&&t.area===o.area)){l({show:!0,variant:"warning",message:"Ya existe un servicio con ese nombre"});return}await V(o.id,{name:o.name,area:o.area}),l({show:!0,variant:"success",message:"Servicio actualizado"}),r({open:!1,id:null,name:"",area:"laboratorio"}),b()}catch(a){l({show:!0,variant:"danger",message:a.message||"Error al actualizar"})}},P=a=>u({open:!0,row:a}),Y=async()=>{if(m.row)try{await W(m.row.id),l({show:!0,variant:"success",message:"Servicio eliminado"}),u({open:!1,row:null}),b()}catch(a){l({show:!0,variant:"danger",message:a.message||"Error al eliminar"})}},y=x||[];return e.jsxs(O,{titulo:"Gestión de Servicios",descripcion:"Aquí podrás ver, crear, editar y eliminar servicios.",children:[e.jsx(Q,{left:e.jsxs("div",{className:"row g-2 w-100",children:[e.jsxs("div",{className:"col-sm-4",children:[e.jsx("label",{className:"form-label",children:"Área"}),e.jsxs("select",{className:"form-select",value:i,onChange:a=>{z(a.target.value),j(1)},children:[e.jsx("option",{value:"",children:"Todas"}),e.jsx("option",{value:"laboratorio",children:"Laboratorio"}),e.jsx("option",{value:"comercial",children:"Comercial"}),e.jsx("option",{value:"soporte",children:"Soporte"})]})]}),e.jsxs("div",{className:"col-sm-4",children:[e.jsx("label",{className:"form-label",children:"Buscar"}),e.jsx("input",{className:"form-control",placeholder:"Buscar por nombre",value:f,onChange:a=>G(a.target.value)})]})]}),right:e.jsx("button",{className:"btn btn-primary",onClick:()=>d(!0),disabled:!h,children:"+ Agregar servicio"})}),e.jsx("div",{className:"table-responsive mt-3",children:e.jsxs("table",{className:"table table-striped align-middle",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"ID"}),e.jsx("th",{children:"Nombre"}),e.jsx("th",{children:"Área"}),e.jsx("th",{style:{width:140},children:"Acciones"})]})}),e.jsxs("tbody",{children:[(y||[]).map(a=>e.jsxs("tr",{children:[e.jsx("td",{children:a.id}),e.jsx("td",{children:a.name}),e.jsx("td",{className:"text-capitalize",children:a.area}),e.jsxs("td",{className:"d-flex gap-2",children:[e.jsx("button",{className:"btn btn-sm btn-outline-secondary",onClick:()=>F(a),disabled:!h,children:"Editar"}),e.jsx("button",{className:"btn btn-sm btn-outline-danger",onClick:()=>P(a),disabled:!h,children:"Eliminar"})]})]},a.id)),(!y||y.length===0)&&!v&&e.jsx(H,{colSpan:4,label:"Sin servicios"})]})]})}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{className:"text-muted small",children:["Total: ",S]}),e.jsxs("div",{className:"btn-group",children:[e.jsx("button",{className:"btn btn-outline-secondary",disabled:n<=1,onClick:()=>j(a=>Math.max(1,a-1)),children:"Anterior"}),e.jsxs("span",{className:"btn btn-outline-secondary disabled",children:[n,"/",w]}),e.jsx("button",{className:"btn btn-outline-secondary",disabled:n>=w,onClick:()=>j(a=>Math.min(w,a+1)),children:"Siguiente"})]})]}),B&&e.jsx("div",{className:"modal fade show",style:{display:"block"},children:e.jsx("div",{className:"modal-dialog",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h5",{className:"modal-title",children:"Nuevo servicio"}),e.jsx("button",{type:"button",className:"btn-close",onClick:()=>d(!1)})]}),e.jsxs("form",{onSubmit:R,children:[e.jsxs("div",{className:"modal-body",children:[e.jsx("div",{className:"mb-3",children:e.jsx(L,{id:"service-name",label:"Nombre",value:p,onChange:a=>E(a.target.value),required:!0})}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Área"}),e.jsxs("select",{className:"form-select",value:g,onChange:a=>M(a.target.value),children:[e.jsx("option",{value:"laboratorio",children:"Laboratorio"}),e.jsx("option",{value:"comercial",children:"Comercial"}),e.jsx("option",{value:"soporte",children:"Soporte"})]})]})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>d(!1),children:"Cancelar"}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:v,children:v?"Guardando...":"Crear"})]})]})]})})}),o.open&&e.jsx("div",{className:"modal fade show",style:{display:"block"},children:e.jsx("div",{className:"modal-dialog",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h5",{className:"modal-title",children:"Editar servicio"}),e.jsx("button",{type:"button",className:"btn-close",onClick:()=>r({open:!1,id:null,name:"",area:"laboratorio"})})]}),e.jsxs("div",{className:"modal-body",children:[e.jsx("div",{className:"mb-3",children:e.jsx(L,{id:"edit-service-name",label:"Nombre",value:o.name,onChange:a=>r(t=>({...t,name:a.target.value})),required:!0})}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Área"}),e.jsxs("select",{className:"form-select",value:o.area,onChange:a=>r(t=>({...t,area:a.target.value})),children:[e.jsx("option",{value:"laboratorio",children:"Laboratorio"}),e.jsx("option",{value:"comercial",children:"Comercial"}),e.jsx("option",{value:"soporte",children:"Soporte"})]})]})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>r({open:!1,id:null,name:"",area:"laboratorio"}),children:"Cancelar"}),e.jsx("button",{type:"button",className:"btn btn-primary",onClick:I,children:"Guardar"})]})]})})}),e.jsx(J,{show:c.show,variant:c.variant,onClose:()=>l({...c,show:!1}),children:c.message}),e.jsxs(X,{open:m.open,onClose:()=>u({open:!1,row:null}),children:[e.jsx("h5",{children:"Confirmar eliminación"}),e.jsxs("p",{children:['¿Seguro que deseas eliminar el servicio "',(A=m.row)==null?void 0:A.name,'"?']}),e.jsxs("div",{style:{display:"flex",gap:8,justifyContent:"flex-end"},children:[e.jsx("button",{className:"btn btn-outline-secondary",onClick:()=>u({open:!1,row:null}),children:"Cancelar"}),e.jsx("button",{className:"btn btn-danger",onClick:Y,disabled:!h,children:"Eliminar"})]})]})]})}export{oe as default};
//# sourceMappingURL=Servicios-TrgcCLBE.js.map
