import{b as k,a as B,c as E,r as u,e as T,j as s,B as o,F as D,C as m,o as P,m as Q}from"./index-Bcrgukx7.js";import{C as v,R as i}from"./Row-B5ljKXp5.js";import{S as L}from"./Spinner-jUAz7otr.js";import{A as R}from"./Alert-C1-1JEUj.js";import{C as n}from"./Col-C5Zwr_ej.js";import{F as $}from"./Form-DBWuP9iW.js";import{C as j}from"./Card-C96hNOBG.js";import"./ElementChildren-BWXp08bt.js";const M=async(c={})=>{try{const r=new URLSearchParams;c.status&&r.append("status",c.status),c.page&&r.append("page",c.page),c.limit&&r.append("limit",c.limit);const x=r.toString(),a=`/api/quote-approval/my-quotes${x?`?${x}`:""}`;return await k(a)}catch(r){throw console.error("Error getting my quotes:",r),r}},J=()=>{var C;const{user:c}=B();E();const[r,x]=u.useState({status:"",page:1,limit:20}),[a,N]=u.useState(null),[A,p]=u.useState(!1),{data:h,isLoading:F,error:y,refetch:S}=T(["myQuotes",r],()=>M(r),{enabled:!!c,refetchOnWindowFocus:!1}),w=e=>{const{name:t,value:l}=e.target;x(g=>({...g,[t]:l,page:1}))},b=e=>{x(t=>({...t,page:e}))},f=e=>{const l={borrador:{variant:"warning",text:"Borrador"},aprobada:{variant:"success",text:"Aprobada"},facturada:{variant:"info",text:"Facturada"}}[e]||{variant:"secondary",text:e};return s.jsx(m,{bg:l.variant,children:l.text})},z=e=>{const t=[];return t.push(s.jsxs(o,{variant:"primary",size:"sm",onClick:()=>{N(e),p(!0)},children:[s.jsx(Q,{className:"me-1"}),"Ver m치s"]},"view-more")),t};if(F)return s.jsx(v,{className:"py-4",children:s.jsxs("div",{className:"text-center",children:[s.jsx(L,{animation:"border"}),s.jsx("p",{className:"mt-2",children:"Cargando mis cotizaciones..."})]})});if(y)return s.jsx(v,{className:"py-4",children:s.jsxs(R,{variant:"danger",children:["Error cargando cotizaciones: ",y.message]})});const _=(h==null?void 0:h.data)||[],d=(h==null?void 0:h.pagination)||{};return s.jsxs(v,{className:"py-4",children:[s.jsx(i,{className:"mb-4",children:s.jsxs(n,{children:[s.jsx("h2",{children:"Mis Cotizaciones"}),s.jsx("p",{className:"text-muted",children:"Gestiona tus cotizaciones de forma aut칩noma"})]})}),s.jsxs(i,{className:"mb-4",children:[s.jsx(n,{md:4,children:s.jsxs($.Select,{name:"status",value:r.status,onChange:w,children:[s.jsx("option",{value:"",children:"Todos los estados"}),s.jsx("option",{value:"borrador",children:"Borrador"}),s.jsx("option",{value:"aprobada",children:"Aprobada"}),s.jsx("option",{value:"facturada",children:"Facturada"})]})}),s.jsx(n,{md:4,children:s.jsx(o,{variant:"outline-secondary",onClick:()=>S(),children:"游댃 Actualizar"})})]}),s.jsx(i,{children:_.length===0?s.jsx(n,{children:s.jsx(j,{children:s.jsxs(j.Body,{className:"text-center py-5",children:[s.jsx(D,{size:48,className:"text-muted mb-3"}),s.jsx("h5",{children:"No hay cotizaciones"}),s.jsx("p",{className:"text-muted",children:r.status?`No se encontraron cotizaciones en estado "${r.status}"`:"No tienes cotizaciones registradas"})]})})}):_.map(e=>{var t,l,g;return s.jsx(n,{md:6,lg:4,className:"mb-3",children:s.jsxs(j,{children:[s.jsxs(j.Header,{className:"d-flex justify-content-between align-items-center",children:[s.jsx("strong",{children:e.quote_number||`COT-${e.id}`}),f(e.status)]}),s.jsxs(j.Body,{children:[s.jsxs("div",{className:"mb-2",children:[s.jsx("strong",{children:"Cliente:"})," ",e.company_name||"N/A"]}),s.jsxs("div",{className:"mb-2",children:[s.jsx("strong",{children:"Proyecto:"})," ",e.project_name||"N/A"]}),((t=e.distinctive_info)==null?void 0:t.variant)&&s.jsxs("div",{className:"mb-2",children:[s.jsx("strong",{children:"Variante:"}),s.jsx(m,{bg:"primary",className:"ms-2",children:e.distinctive_info.variant})]}),((l=e.distinctive_info)==null?void 0:l.delivery_days)&&s.jsxs("div",{className:"mb-2",children:[s.jsx("strong",{children:"D칤as h치biles:"}),s.jsx(m,{bg:"success",className:"ms-2",children:e.distinctive_info.delivery_days})]}),s.jsxs("div",{className:"mb-2",children:[s.jsx("strong",{children:"Total:"})," S/ ",parseFloat(e.total||0).toFixed(2)]}),s.jsxs("div",{className:"mb-2",children:[s.jsx("strong",{children:"Autor:"})," ",e.created_by_name||"N/A",e.created_by_role&&s.jsx(m,{bg:"info",className:"ms-2",children:e.created_by_role})]}),((g=e.meta)==null?void 0:g.file_name)&&s.jsxs("div",{className:"mb-2",children:[s.jsx("strong",{children:"Archivo:"})," ",e.meta.file_name]}),s.jsxs("div",{className:"mb-3",children:[s.jsx("strong",{children:"Fecha:"})," ",new Date(e.created_at).toLocaleDateString()]}),s.jsx("div",{className:"d-flex gap-2 flex-wrap",children:z(e)})]})]})},e.id)})}),d.pages>1&&s.jsx(i,{className:"mt-4",children:s.jsx(n,{children:s.jsx("div",{className:"d-flex justify-content-center",children:s.jsxs("div",{className:"btn-group",children:[s.jsx(o,{variant:"outline-secondary",disabled:d.page===1,onClick:()=>b(d.page-1),children:"Anterior"}),s.jsxs(o,{variant:"outline-secondary",disabled:!0,children:["P치gina ",d.page," de ",d.pages]}),s.jsx(o,{variant:"outline-secondary",disabled:d.page===d.pages,onClick:()=>b(d.page+1),children:"Siguiente"})]})})})}),A&&a&&s.jsx("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.5)"},children:s.jsx("div",{className:"modal-dialog modal-lg",children:s.jsxs("div",{className:"modal-content",children:[s.jsxs("div",{className:"modal-header",children:[s.jsx("h5",{className:"modal-title",children:"Detalles de Cotizaci칩n"}),s.jsx(o,{variant:"outline-secondary",onClick:()=>p(!1),children:s.jsx(P,{})})]}),s.jsxs("div",{className:"modal-body",children:[s.jsxs(i,{children:[s.jsxs(n,{md:6,children:[s.jsx("strong",{children:"N칰mero:"})," ",a.quote_number||`COT-${a.id}`]}),s.jsxs(n,{md:6,children:[s.jsx("strong",{children:"Estado:"})," ",f(a.status)]})]}),s.jsx("hr",{}),s.jsxs(i,{children:[s.jsxs(n,{md:6,children:[s.jsx("strong",{children:"Cliente:"})," ",a.company_name||"N/A"]}),s.jsxs(n,{md:6,children:[s.jsx("strong",{children:"RUC:"})," ",a.company_ruc||"N/A"]})]}),s.jsxs(i,{children:[s.jsxs(n,{md:6,children:[s.jsx("strong",{children:"Proyecto:"})," ",a.project_name||"N/A"]}),s.jsxs(n,{md:6,children:[s.jsx("strong",{children:"Total:"})," S/ ",parseFloat(a.total||0).toFixed(2)]})]}),((C=a.distinctive_info)==null?void 0:C.variant)&&s.jsxs(i,{children:[s.jsxs(n,{md:6,children:[s.jsx("strong",{children:"Variante:"}),s.jsx(m,{bg:"primary",className:"ms-2",children:a.distinctive_info.variant})]}),s.jsxs(n,{md:6,children:[s.jsx("strong",{children:"D칤as h치biles:"}),s.jsx(m,{bg:"success",className:"ms-2",children:a.distinctive_info.delivery_days})]})]}),s.jsxs(i,{children:[s.jsxs(n,{md:6,children:[s.jsx("strong",{children:"Autor:"})," ",a.created_by_name||"N/A",a.created_by_role&&s.jsx(m,{bg:"info",className:"ms-2",children:a.created_by_role})]}),s.jsxs(n,{md:6,children:[s.jsx("strong",{children:"Contacto:"})," ",a.client_contact||"N/A"]})]}),s.jsxs(i,{children:[s.jsxs(n,{md:6,children:[s.jsx("strong",{children:"Email:"})," ",a.client_email||"N/A"]}),s.jsxs(n,{md:6,children:[s.jsx("strong",{children:"Tel칠fono:"})," ",a.client_phone||"N/A"]})]}),s.jsx("hr",{}),s.jsxs(i,{children:[s.jsxs(n,{md:6,children:[s.jsx("strong",{children:"Fecha de creaci칩n:"})," ",new Date(a.created_at).toLocaleString()]}),s.jsxs(n,{md:6,children:[s.jsx("strong",{children:"칔ltima actualizaci칩n:"})," ",new Date(a.updated_at).toLocaleString()]})]})]}),s.jsx("div",{className:"modal-footer",children:s.jsx(o,{variant:"secondary",onClick:()=>p(!1),children:"Cerrar"})})]})})})]})};export{J as default};
//# sourceMappingURL=MisCotizaciones-DJTWcb95.js.map
