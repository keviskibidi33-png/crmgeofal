import{c as N,r as a,j as e}from"./index-HaxW7Nk-.js";import{M as f}from"./ModuloBase-BOonBI6V.js";import{g as v,b as y}from"./quotes-Dd9vJWvI.js";function E(){var m;const{id:i}=N(),[t,u]=a.useState(null),[c,p]=a.useState([]),[b,d]=a.useState(!0),[o,x]=a.useState("");a.useEffect(()=>{(async()=>{try{d(!0),x("");const[s,r]=await Promise.all([v(i),y(i)]);u(s),p(Array.isArray(r==null?void 0:r.data)?r.data:r||[])}catch(s){x(s.message||"No se pudo cargar la cotización")}finally{d(!1)}})()},[i]);const n=a.useMemo(()=>c.reduce((s,r)=>s+Number(r.partial_price||0),0),[c]),l=a.useMemo(()=>Number((t==null?void 0:t.igv)||0),[t]),g=a.useMemo(()=>Number((t==null?void 0:t.total)||n+l),[t,n,l]),h=s=>{const r="http://localhost:4000/api".replace(/\/$/,"")||"",j=`/api/quotes/${i}/export/${s}`;return r&&/\/api$/i.test(r)?`${r}${j.replace(/^\/api/,"")}`:`${r}${j}`};return e.jsxs(f,{titulo:`Cotización #${i}`,descripcion:"Detalle y edición básica de la cotización",children:[b&&e.jsx("div",{children:"Cargando..."}),o&&e.jsx("div",{className:"alert alert-danger",children:o}),t&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"row g-3",children:[e.jsxs("div",{className:"col-md-4",children:[e.jsx("strong",{children:"Proyecto:"})," ",t.project_name||t.project_id]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx("strong",{children:"Emisión:"})," ",(m=t.issue_date)==null?void 0:m.slice(0,10)]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx("strong",{children:"Estado:"})," ",t.status]})]}),e.jsx("div",{className:"table-responsive mt-3",children:e.jsxs("table",{className:"table table-bordered align-middle",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Código"}),e.jsx("th",{children:"Descripción"}),e.jsx("th",{children:"Norma"}),e.jsx("th",{children:"Unitario"}),e.jsx("th",{children:"Cantidad"}),e.jsx("th",{children:"Parcial"})]})}),e.jsxs("tbody",{children:[c.map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:s.code}),e.jsx("td",{children:s.description}),e.jsx("td",{children:s.norm}),e.jsxs("td",{children:["S/ ",Number(s.unit_price||0).toFixed(2)]}),e.jsx("td",{children:s.quantity}),e.jsxs("td",{children:["S/ ",Number(s.partial_price||0).toFixed(2)]})]},s.id)),c.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"text-center text-muted",children:"Sin ítems"})})]})]})}),e.jsxs("div",{className:"d-flex justify-content-end gap-4",children:[e.jsxs("div",{className:"text-end",children:[e.jsxs("div",{children:["Subtotal: S/ ",n.toFixed(2)]}),e.jsxs("div",{children:["IGV: S/ ",l.toFixed(2)]}),e.jsx("div",{children:e.jsxs("strong",{children:["Total: S/ ",g.toFixed(2)]})})]}),e.jsx("a",{className:"btn btn-outline-secondary",href:h("pdf"),target:"_blank",rel:"noreferrer",children:"PDF"}),e.jsx("a",{className:"btn btn-outline-secondary",href:h("excel"),target:"_blank",rel:"noreferrer",children:"Excel"})]})]})]})}export{E as default};
//# sourceMappingURL=DetalleCotizacion-C_JGiOeY.js.map
