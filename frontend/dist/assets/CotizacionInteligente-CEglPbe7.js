import{r as s,e as oa,j as e,C as he,F as na,a0 as sa,ac as ca,o as ra,S as la,a8 as Se,K as ia,n as da,a1 as ma,B as se,a9 as ua,y as Ae,ad as pa,a7 as ha}from"./index-ACE2z3o6.js";import{M as ga}from"./ModuloBase-DJCq87Ze.js";import{g as xa,u as ja,c as fa}from"./quotes-BGok9agS.js";import{s as Pe,l as ba,c as Na}from"./projects-DQRiAtIF.js";import{l as ya,j as va}from"./companies-B_TeJKU-.js";import{s as _a}from"./subservices-BBeH8QhR.js";import{S as ge}from"./Spinner-CGz_3N-E.js";import{F as we}from"./Form-DLwAlTjb.js";import{S as Ca}from"./SuccessModal-DEg6DjsV.js";import{M as Z}from"./Modal-C3w-lbxe.js";import{A as ce}from"./Alert-ChgNCOQW.js";import{L as De}from"./ListGroup-8hR11myv.js";/* empty css                     */import"./ElementChildren-DF5xNtl2.js";import"./Col-DolGQwSC.js";const Ea=({value:f="",onChange:h,onSelect:d,placeholder:A="Buscar servicio...",disabled:Y=!1,size:w="sm"})=>{const[y,c]=s.useState(f),[u,m]=s.useState(!1),[D,r]=s.useState({top:0,left:0,width:0}),x=s.useRef(null),_=s.useRef(null),[P,k]=s.useState(y);s.useEffect(()=>{const i=setTimeout(()=>k(y),400);return()=>clearTimeout(i)},[y]);const{data:R,isLoading:T}=oa(["subservices",P],()=>_a(P),{enabled:P.length>=2,staleTime:10*60*1e3,keepPreviousData:!0,refetchOnWindowFocus:!1}),l=(R==null?void 0:R.data)||[],C=()=>{if(x.current&&u){const i=x.current.getBoundingClientRect();r({top:i.bottom+window.scrollY+2,left:i.left+window.scrollX,width:i.width})}};s.useEffect(()=>{if(u){C();const i=()=>{u&&C()},S=()=>{u&&C()};return window.addEventListener("scroll",i,!0),window.addEventListener("resize",S),()=>{window.removeEventListener("scroll",i,!0),window.removeEventListener("resize",S)}}},[u]);const Q=i=>{const S=i.target.value;c(S),h==null||h(S),S.length>=2?m(!0):m(!1)},H=()=>{y.length>=2&&(m(!0),C())},re=i=>{c(i.display_text),m(!1),d==null||d(i)},xe=()=>{c(""),m(!1),h==null||h(""),d==null||d(null)};s.useEffect(()=>{const i=S=>{x.current&&!x.current.contains(S.target)&&_.current&&!_.current.contains(S.target)&&m(!1)};if(u)return document.addEventListener("mousedown",i),()=>document.removeEventListener("mousedown",i)},[u]);const ee=i=>i===0?"Sujeto a evaluaci√≥n":`S/ ${i.toFixed(2)}`,je=i=>({"ENSAYO EST√ÅNDAR":"primary","ENSAYOS ESPECIALES":"success","ENSAYOS DE CAMPO":"info","ENSAYO AGREGADO":"warning"})[i]||"secondary",X=u&&y.length>=2&&e.jsxs("div",{ref:_,style:{position:"absolute",top:`${D.top}px`,left:`${D.left}px`,width:`${D.width}px`,zIndex:999999,maxHeight:"300px",overflowY:"auto",backgroundColor:"white",border:"1px solid #dee2e6",borderRadius:"4px",boxShadow:"0 4px 12px rgba(0,0,0,0.15)"},onMouseDown:i=>i.preventDefault(),children:[T&&e.jsxs("div",{className:"p-3 text-center text-muted",children:[e.jsx(ge,{animation:"border",size:"sm",className:"me-2"}),e.jsx("small",{children:"Buscando..."})]}),!T&&l.length===0&&e.jsx("div",{className:"p-3 text-center text-muted",children:e.jsx("small",{children:"No se encontraron resultados"})}),!T&&l.length>0&&l.map(i=>e.jsx("div",{className:"p-2 border-bottom",onClick:()=>re(i),style:{cursor:"pointer",transition:"background-color 0.15s"},onMouseEnter:S=>S.currentTarget.style.backgroundColor="#f8f9fa",onMouseLeave:S=>S.currentTarget.style.backgroundColor="white",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-start",children:[e.jsxs("div",{className:"flex-grow-1",children:[e.jsx("div",{className:"d-flex align-items-center gap-2 mb-1",children:e.jsx(he,{bg:je(i.service_name),className:"small",children:i.codigo})}),e.jsx("div",{className:"fw-bold small text-dark",children:i.descripcion}),i.norma&&i.norma!=="-"&&e.jsxs("div",{className:"text-muted",style:{fontSize:"0.75rem"},children:[e.jsx(na,{size:10,className:"me-1"}),i.norma]})]}),e.jsx("div",{className:"text-end ms-2",children:e.jsxs("div",{className:"fw-bold text-success small",children:[e.jsx(sa,{size:12}),ee(i.precio)]})})]})},i.id))]});return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"position-relative",children:e.jsx(we.Group,{className:"mb-0",children:e.jsxs("div",{className:"position-relative",children:[e.jsx(we.Control,{ref:x,type:"text",value:y,onChange:Q,onFocus:H,placeholder:A,disabled:Y,size:w,className:"pe-5",autoComplete:"off"}),e.jsxs("div",{className:"position-absolute top-50 end-0 translate-middle-y pe-3 d-flex align-items-center gap-2",children:[T&&e.jsx(ge,{animation:"border",size:"sm",variant:"primary"}),!T&&y&&e.jsx(ra,{className:"text-muted",onClick:xe,onMouseDown:i=>i.preventDefault(),style:{cursor:"pointer"}}),!T&&!y&&e.jsx(la,{className:"text-muted"})]})]})})}),typeof document<"u"&&X&&ca.createPortal(X,document.body)]})},Sa=({show:f,onHide:h,projectName:d,companyId:A,onSelectExisting:Y,onCreateNew:w})=>{const[y,c]=s.useState([]),[u,m]=s.useState(!1),[D,r]=s.useState(null);s.useEffect(()=>{console.log("üîç ProjectSelectionModal - useEffect triggered:",{show:f,projectName:d,companyId:A}),f&&d&&d.trim().length>=2&&x()},[f,d,A]);const x=async()=>{try{console.log("üîç ProjectSelectionModal - Iniciando b√∫squeda:",{projectName:d,companyId:A}),m(!0),r(null);const l=await Pe(d,A);console.log("‚úÖ ProjectSelectionModal - Proyectos encontrados:",l),c(l||[])}catch(l){console.error("‚ùå ProjectSelectionModal - Error searching projects:",l),r("Error al buscar proyectos existentes")}finally{m(!1)}},_=l=>{Y(l),h()},P=()=>{w(),h()},k=()=>{const l=y.length+1,C=`${d} (${l})`;w(C),h()},R=l=>{const C=prompt(`Editar nombre del proyecto "${l.name}":`,l.name);C&&C.trim()!==l.name&&(console.log("Editar proyecto:",l.id,"nuevo nombre:",C),alert(`Funcionalidad de edici√≥n en desarrollo. Proyecto: ${l.name} ‚Üí ${C}`))},T=l=>new Date(l).toLocaleDateString("es-PE");return e.jsxs(Z,{show:f,onHide:h,size:"lg",centered:!0,style:{zIndex:9999},children:[e.jsx(Z.Header,{closeButton:!0,children:e.jsxs(Z.Title,{children:[e.jsx(Se,{className:"me-2"}),'Proyectos Existentes: "',d,'"']})}),e.jsxs(Z.Body,{children:[u&&e.jsxs("div",{className:"text-center py-4",children:[e.jsx(ge,{animation:"border"}),e.jsx("p",{className:"mt-2",children:"Buscando proyectos existentes..."})]}),D&&e.jsx(ce,{variant:"danger",children:D}),!u&&!D&&y.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(ce,{variant:"warning",className:"mb-3",children:e.jsxs("div",{children:[e.jsxs("strong",{children:["‚ö†Ô∏è Se encontraron ",y.length,' proyecto(s) con el nombre "',d,'" en esta empresa.']}),e.jsx("br",{}),"Para evitar confusiones, el sistema sugiere diferenciarlos autom√°ticamente."]})}),e.jsx(ce,{variant:"info",className:"mb-3",children:e.jsxs("div",{children:[e.jsx("strong",{children:"üí° Opciones disponibles:"}),e.jsxs("ul",{className:"mb-0 mt-2",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Continuar con proyecto existente:"})," Usar uno de los proyectos listados"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Crear nuevo diferenciado:"}),' El sistema agregar√° autom√°ticamente "(2)", "(3)", etc.']}),e.jsxs("li",{children:[e.jsx("strong",{children:"Editar manualmente:"})," Puedes cambiar el nombre despu√©s de crear el proyecto"]})]})]})}),e.jsx(De,{children:y.map(l=>e.jsxs(De.Item,{className:"d-flex justify-content-between align-items-start",style:{cursor:"pointer"},onClick:()=>_(l),children:[e.jsxs("div",{className:"ms-2 me-auto",children:[e.jsxs("div",{className:"fw-bold",children:[e.jsx(Se,{className:"me-1"}),l.name]}),e.jsxs("div",{className:"text-muted small",children:[e.jsx("strong",{children:"Empresa:"})," ",l.company_name," (RUC: ",l.company_ruc,")"]}),e.jsxs("div",{className:"text-muted small",children:[e.jsx(ia,{className:"me-1"}),l.location||"Sin ubicaci√≥n"]}),e.jsxs("div",{className:"text-muted small",children:[e.jsx(da,{className:"me-1"}),"Vendedor: ",l.vendedor_name||"No asignado"]}),e.jsxs("div",{className:"text-muted small",children:[e.jsx(ma,{className:"me-1"}),"Creado: ",T(l.created_at)]})]}),e.jsxs("div",{className:"text-end",children:[e.jsx("div",{className:"mb-2",children:e.jsxs(se,{variant:"outline-secondary",size:"sm",onClick:C=>{C.stopPropagation(),R(l)},title:"Editar nombre para unificar proyectos",children:[e.jsx(ua,{className:"me-1"}),"Editar"]})}),e.jsxs("div",{children:[e.jsxs(he,{bg:"secondary",className:"me-2",children:[l.quotes_count," cotizaci√≥n(es)"]}),e.jsx(he,{bg:l.status==="activo"?"success":"warning",children:l.status})]})]})]},l.id))})]}),!u&&!D&&y.length===0&&e.jsxs(ce,{variant:"success",children:[e.jsx("strong",{children:"No se encontraron proyectos con ese nombre."}),e.jsx("br",{}),"Puedes crear un nuevo proyecto sin problemas."]})]}),e.jsxs(Z.Footer,{children:[e.jsx(se,{variant:"outline-secondary",onClick:h,children:"Cancelar"}),e.jsxs(se,{variant:"warning",onClick:k,children:[e.jsx(Ae,{className:"me-1"}),'Crear "',d," (",y.length+1,')"']}),e.jsxs(se,{variant:"primary",onClick:P,children:[e.jsx(Ae,{className:"me-1"}),"Crear Nuevo (Nombre Original)"]})]})]})},me={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1},Oe={company_name:"",ruc:"",contact_name:"",contact_phone:"",contact_email:"",project_location:"",project_name:""},Aa={request_date:"",issue_date:"",commercial_name:"",commercial_phone:"",payment_terms:"adelantado",reference:"",reference_type:["email","phone"],igv:!0,delivery_days:4,category_main:"laboratorio"},ue={code:"",description:"",norm:"",unit_price:0,quantity:1};function Ie(f){const h=Number(f.unit_price||0),d=Number(f.quantity||0);return Number((h*d).toFixed(2))}function wa(){const f=new Date().getFullYear(),h=String(new Date().getMonth()+1).padStart(2,"0"),d=String(new Date().getDate()).padStart(2,"0"),A=Math.floor(Math.random()*1e3).toString().padStart(3,"0");return`COT-${f}${h}${d}-${A}`}const M=(f="")=>(f||"").normalize("NFD").replace(/[\u0300-\u036f]/g,"").toUpperCase().trim(),pe={[M("MUESTRA DE SUELO Y AGREGADO")]:`CONDICIONES ESPEC√çFICAS:
- El cliente debe enviar al laboratorio, para los ensayo en suelo y agregados, la cantidad minima de 100 kg por cada muestra.
- El cliente deber√° de entregar las muestras debidamente identificadas.
- El cliente deber√° especificar la Norma a ser utilizada para la ejecuci√≥n del ensayo, caso contrario se considera Norma ASTM o NTP vigente de acuerdo con el alcance del laboratorio.
- El cliente deber√° entregar las muestras en las instalaciones del LEM, ubicado en la Av. Mara√±√≥n N¬∞ 763, Los Olivos, Lima.`,[M("PROBETAS")]:`CONDICIONES ESPEC√çFICAS:
- El cliente debe proporcionar las probetas antes del ingreso a obra.
- El cliente deber√° de entregar las muestras debidamente identificadas.
- El cliente deber√° especificar la Norma a ser utilizada para la ejecuci√≥n del ensayo, caso contrario se considera Norma ASTM o NTP vigente de acuerdo con el alcance del laboratorio.
- El cliente deber√° entregar las muestras en las instalaciones del LEM, ubicado en la Av. Mara√±√≥n N¬∞ 763, Los Olivos, Lima.`,[M("DENSIDAD DE CAMPO Y MUESTREO")]:`CONDICIONES ESPEC√çFICAS:
- El cliente deber√° enviar al laboratorio, para los ensayo en suelo y agregados, la cantidad minima de 100 kg por cada muestra.
- Para el ensayo de Densidad de campo, la cantidad de puntos/salida minimo 4 und.
- El cliente deber√° de programar el servicio, Densidad de campo, con 24 horas de anticipaci√≥n.
- El cliente deber√° especificar la Norma a ser utilizada para la ejecuci√≥n del ensayo, caso contrario se considera Norma ASTM o NTP vigente de acuerdo con el alcance del laboratorio.
- El cliente deber√° entregar las muestras en las instalaciones del LEM, ubicado en la Av. Mara√±√≥n N¬∞ 763, Los Olivos, Lima.`,[M("EXTRACCI√ìN DE DIAMANTINA")]:`CONDICIONES ESPEC√çFICAS:
- Movilizaci√≥n y desmovilizaci√≥n de equipos y del personal t√©cnico, estara a cargo de GEOFAL.
- Resane de estructura de concreto con sika rep 500 y Sikadur 32, estara a cargo de GEOFAL.
- El servicio no incluye trabajos de acabados como pintura, mayolica y otros.
- El area de trabajo, zona de extracci√≥n de diamantina, tiene que estar libre de interferencia.
- La extracci√≥n de diamantina se realizara en 2 dia en campo, en laboratorio se realizar√° el tallado y refrentado de diamantina, el ensayo de resistencia a la compresi√≥n de testigo de diamantina se realizara en 5 dias (el tiempo de ensayo obedece a la normativa vigente).
- Costo de resane insumos 250 soles, este costo se distribuira de acuerdo con el numero de perforaciones Donde se hara las extracciones de diamantina`,[M("DIAMANTINA PARA PASES")]:`CONDICIONES ESPEC√çFICAS:
- El cliente deber√° de programar el servicio, Extracci√≥n diamantina, con 24 horas de anticipaci√≥n.
- El area de trabajo, zona de extraccion de diamantina, debera estar libre de interferencia.
- Para extraer la diamantina, se ubicara el acero con un escaneador.
- Movilizacion y desmovilizacion de equipos y del personal tecnico, estara a cargo de Geofal.`,[M("ALBA√ëILER√çA")]:`CONDICIONES ESPEC√çFICAS:
- El cliente deber√° enviar al laboratorio, 20 ladrillo de cada tipo, en buen estado y sin presentar fisuras.
- El cliente deber√° de entregar las muestras debidamente identificadas.
- El cliente deber√° especificar la Norma a ser utilizada para la ejecuci√≥n del ensayo, caso contrario se considera Norma ASTM o NTP vigente de acuerdo con el alcance del laboratorio.
- El cliente deber√° entregar las muestras en las instalaciones del LEM, ubicado en la Av. Mara√±√≥n N¬∞ 763, Los Olivos, Lima`,[M("VIGA BECKELMAN")]:`CONDICIONES ESPEC√çFICAS:
- El cliente deber√° de programar el servicio, Ensayo de Deflexi√≥n, con 24 horas de anticipaci√≥n.
- El area de trabajo tiene que estar habilitado.
- El cliente deber√° especificar la Norma a ser utilizada para la ejecuci√≥n del ensayo, caso contrario se considera Norma ASTM o NTP o MTC vigente de acuerdo con el alcance del laboratorio.
- Especificar las caracteristicas del camion`,[M("CONTROL DE CALIDAD DE CONCRETO FRESCO EN OBRA")]:`CONDICIONES ESPEC√çFICAS:
- El cliente deber√° de programar el servicio, con 24 horas de anticipaci√≥n.
- Para el ensayo de control de calidad de concreto fresco en obra, se moldeara 6 probetas, ensayo slump, control de temperatura, en laboratorio las probetas se colocara en camara de curado, el ensayo de compresi√≥n de las probetas seran 3 a 7 dias y 3 a 28 dias.
- El control de calidad del concreto fresco se sacara cada 50m3 a uno de los mixer donde se hara todos los ensayos respectivos mencionados, o por dia asi no se halla llegado los 50m3.
- El cliente deber√° especificar la Norma a ser utilizada para la ejecuci√≥n del ensayo, caso contrario se considera Norma ASTM o NTP vigente de acuerdo con el alcance del laboratorio.`},L=f=>{const h=M((f==null?void 0:f.title)||"");if(pe[h])return pe[h];const d=Object.entries(pe).find(([A])=>h.includes(A)||A.includes(h));return d?d[1]:""};function Ya(){var Ee;const[f]=pa(),h=ha(),d=f.get("edit"),[A,Y]=s.useState([]),[w,y]=s.useState(""),[c,u]=s.useState(Oe),[m,D]=s.useState({company_id:null,project_id:null,company:null,project:null}),[r,x]=s.useState(Aa),[_,P]=s.useState([{...ue}]),[k,R]=s.useState(!1),[T,l]=s.useState(""),[C,Q]=s.useState(""),[H,re]=s.useState(null),[xe,ee]=s.useState([]),[je,X]=s.useState([]),[i,S]=s.useState(!1),[Te,Da]=s.useState(""),[Le,fe]=s.useState(!1),[O,be]=s.useState(null),[F,Ne]=s.useState([]),[q,ye]=s.useState([]),[ae,$]=s.useState(""),[I,z]=s.useState(null),[ve,K]=s.useState(!1),[Me,_e]=s.useState(!1),[Re,Fe]=s.useState(null),[ze,Ce]=s.useState(!1),[ke,qe]=s.useState(""),[$e,Ve]=s.useState(null),[le,Oa]=s.useState(null),[J,V]=s.useState(null);s.useEffect(()=>{const a=[{id:"V1",code:"V1",title:"MUESTRA DE SUELO Y AGREGADO",description:L({title:"MUESTRA DE SUELO Y AGREGADO"})},{id:"V2",code:"V2",title:"PROBETAS",description:L({title:"PROBETAS"})},{id:"V3",code:"V3",title:"DENSIDAD DE CAMPO Y MUESTREO",description:L({title:"DENSIDAD DE CAMPO Y MUESTREO"})},{id:"V4",code:"V4",title:"EXTRACCI√ìN DE DIAMANTINA",description:L({title:"EXTRACCI√ìN DE DIAMANTINA"})},{id:"V5",code:"V5",title:"DIAMANTINA PARA PASES",description:L({title:"DIAMANTINA PARA PASES"})},{id:"V6",code:"V6",title:"ALBA√ëILER√çA",description:L({title:"ALBA√ëILER√çA"})},{id:"V7",code:"V7",title:"VIGA BECKELMAN",description:L({title:"VIGA BECKELMAN"})},{id:"V8",code:"V8",title:"CONTROL DE CALIDAD DE CONCRETO FRESCO EN OBRA",description:L({title:"CONTROL DE CALIDAD DE CONCRETO FRESCO EN OBRA"})}];Y(a)},[]),s.useEffect(()=>{(async()=>{try{const o=(await ba({page:1,limit:100})).data||[];ee(o),X(o)}catch(a){console.warn("No se pudieron cargar proyectos existentes:",a),ee([]),X([])}})()},[]),s.useEffect(()=>{m.company&&u(a=>{var o,n;return{...a,company_name:m.company.name||a.company_name,ruc:m.company.ruc||a.ruc,contact_name:m.company.contact_name||a.contact_name,contact_phone:m.company.phone||a.contact_phone,contact_email:m.company.email||a.contact_email,project_location:((o=m.project)==null?void 0:o.location)||a.project_location,project_name:((n=m.project)==null?void 0:n.name)||a.project_name}})},[m.company,m.project]),s.useEffect(()=>{(async()=>{try{const o=localStorage.getItem("token");if(!o)return;const n=await fetch("http://localhost:4000/api/auth/me",{headers:{Authorization:`Bearer ${o}`}});if(n.ok){const t=await n.json();t.user&&(be(t.user),x(b=>({...b,commercial_name:t.user.name||b.commercial_name,commercial_phone:t.user.phone||b.commercial_phone,issue_date:b.issue_date||new Date().toISOString().slice(0,10),request_date:b.request_date||new Date().toISOString().slice(0,10)})))}}catch(o){console.warn("No se pudo obtener datos del usuario:",o)}})()},[]),s.useEffect(()=>{if(!w)return;const a=(A||[]).find(t=>String(t.id)===String(w));if(!a)return;const o=a.conditions||{};x(t=>({...t,payment_terms:o.default_payment_terms||t.payment_terms,igv:typeof o.default_igv=="boolean"?o.default_igv:t.igv,reference:o.default_reference||t.reference}));const n=L(a)||a.description||"";n&&Q(n)},[w]);const U=s.useMemo(()=>_.reduce((a,o)=>a+Ie(o),0),[_]),te=s.useMemo(()=>r.igv?Number((U*.18).toFixed(2)):0,[U,r.igv]),ie=s.useMemo(()=>Number((U+te).toFixed(2)),[U,te]),Ue=()=>P([..._,{...ue}]),Be=a=>P(_.filter((o,n)=>n!==a)),B=(a,o)=>P(_.map((n,t)=>t===a?{...n,...o}:n)),Ge=async()=>{try{console.log("üîç fetchClients - Llamando a /api/companies");const a=await ya({limit:500});console.log("üîç fetchClients - Respuesta recibida:",a);const o=(a==null?void 0:a.data)||a||[];console.log("üîç fetchClients - Lista de clientes:",o.length,"clientes"),Ne(o)}catch(a){console.error("‚ùå Error fetching clients:",a),l("Error al cargar los clientes: "+(a.message||"Error desconocido")),Ne([])}},Ye=a=>{if(console.log("üîç handleClientSearch - T√©rmino de b√∫squeda:",a),$(a),!a.trim()){ye([]),K(!1);return}const o=a.toLowerCase();console.log("üîç handleClientSearch - B√∫squeda en min√∫sculas:",o);const n=F.filter(t=>{var N,G,oe,ne,W;const b=(N=t.name)==null?void 0:N.toLowerCase().includes(o),E=(G=t.ruc)==null?void 0:G.toLowerCase().includes(o),p=(oe=t.email)==null?void 0:oe.toLowerCase().includes(o),j=(ne=t.phone)==null?void 0:ne.toLowerCase().includes(o),g=(W=t.name)==null?void 0:W.toLowerCase().split(" ").some(de=>de.includes(o)),v=b||E||p||j||g;return v&&console.log("‚úÖ Cliente encontrado:",t.name,"- Match:",{nameMatch:b,nameWordsMatch:g,rucMatch:E,emailMatch:p,phoneMatch:j}),v});console.log("üîç handleClientSearch - Resultados encontrados:",n.length),ye(n),K(!0)},Qe=a=>{console.log("üîç handleClientSelect - Cliente seleccionado:",a.name,"ID:",a.id),z(a),$(a.name),K(!1),u(o=>({...o,company_name:a.name||"",ruc:a.ruc||"",contact_name:a.contact_name||"",contact_phone:a.phone||"",contact_email:a.email||"",project_location:a.address||""})),console.log("‚úÖ Campos del cliente llenados autom√°ticamente:",{company_name:a.name,ruc:a.ruc,contact_name:a.contact_name,contact_phone:a.phone,contact_email:a.email,project_location:a.address})},Xe=()=>{console.log("üîç handleClientClear - Limpiando selecci√≥n de cliente"),z(null),$(""),K(!1),u(Oe)};s.useEffect(()=>{d&&F.length>0&&Ke(d)},[d,F]);const Ke=async a=>{var o,n;fe(!0);try{console.log("üîÑ Cargando cotizaci√≥n existente:",a);const t=await xa(a);if(console.log("‚úÖ Cotizaci√≥n cargada:",t),!O)try{const p=localStorage.getItem("token");if(p){const j=await fetch("http://localhost:4000/api/auth/me",{headers:{Authorization:`Bearer ${p}`}});if(j.ok){const g=await j.json();g.user&&(be(g.user),console.log("‚úÖ Usuario cargado para edici√≥n:",g.user))}}}catch(p){console.warn("No se pudo obtener datos del usuario para edici√≥n:",p)}if(t.meta&&typeof t.meta=="string")try{t.meta=JSON.parse(t.meta),console.log("‚úÖ Meta parseado correctamente:",t.meta)}catch(p){console.error("‚ùå Error parseando meta:",p),t.meta={}}if(t.client_contact||t.company_name){const p=t.company_name||t.client_company||t.client_contact||"",j=t.client_contact||"";u(v=>({...v,company_name:p,ruc:t.company_ruc||t.client_ruc||"",contact_name:j,contact_phone:t.client_phone||"",contact_email:t.client_email||"",project_location:t.project_location||"",project_name:t.project_name||""})),$(p),console.log("üîç Configurando b√∫squeda de cliente:",p),console.log("üîç RUC del cliente:",t.company_ruc||t.client_ruc),console.log("üîç Tel√©fono del cliente:",t.client_phone);const g=t.company_ruc||t.client_ruc;if(g){console.log("üîç Buscando cliente por RUC:",g);const v=F.find(N=>N.ruc===g);if(v)console.log("‚úÖ Cliente encontrado:",v),z(v);else{console.log("‚ùå Cliente no encontrado en la lista, creando cliente simulado");const N={id:"existing",name:p,ruc:g||"",email:t.client_email||"",phone:t.client_phone||"",contact_name:j,address:t.project_location||""};z(N),console.log("‚úÖ Cliente simulado creado:",N)}}else{const v={id:"existing",name:p,ruc:"",email:t.client_email||"",phone:t.client_phone||"",contact_name:j,address:t.project_location||""};z(v),console.log("‚úÖ Cliente simulado creado (sin RUC):",v)}}const b=((n=(o=t.meta)==null?void 0:o.quote)==null?void 0:n.delivery_days)||t.delivery_days||4;x(p=>{var j,g;return{...p,request_date:((g=(j=t.meta)==null?void 0:j.quote)==null?void 0:g.request_date)||t.request_date||new Date().toISOString().slice(0,10),issue_date:t.issue_date||new Date().toISOString().slice(0,10),commercial_name:t.commercial_name||(O==null?void 0:O.name)||"",commercial_phone:t.commercial_phone||(O==null?void 0:O.phone)||"",payment_terms:t.payment_terms||"adelantado",reference:t.reference||"",reference_type:t.reference_type||["email","phone"],igv:t.igv!==!1,delivery_days:b,category_main:t.category_main||"laboratorio"}});let E=[];t.meta&&t.meta.items&&t.meta.items.length>0?(E=t.meta.items,console.log("‚úÖ Cargando √≠tems desde meta.items:",E.length)):t.items&&t.items.length>0&&(E=t.items,console.log("‚úÖ Cargando √≠tems desde items directo:",E.length)),E.length>0?(P(E),console.log("üì¶ √çtems cargados para edici√≥n:",E)):(console.log("üì¶ No hay √≠tems para cargar, usando √≠tem vac√≠o por defecto"),P([{...ue}])),t.variant_id&&(y(t.variant_id),console.log("üîÑ Variante cargada:",t.variant_id)),t.meta&&t.meta.conditions_text&&(Q(t.meta.conditions_text),console.log("üìù Condiciones espec√≠ficas cargadas")),t.project_id&&(D(p=>({...p,project_id:t.project_id})),console.log("‚úÖ Project ID cargado para edici√≥n:",t.project_id)),console.log("‚úÖ Datos de cotizaci√≥n cargados para edici√≥n")}catch(t){console.error("‚ùå Error cargando cotizaci√≥n:",t),l("Error al cargar la cotizaci√≥n existente: "+(t.message||"Error desconocido"))}finally{fe(!1)}};s.useEffect(()=>{Ge()},[]),s.useEffect(()=>{var a;if((a=h.state)!=null&&a.selectedClient&&F.length>0){const o=h.state.selectedClient;console.log("üéØ Cliente pre-seleccionado desde navegaci√≥n:",o);const n=F.find(t=>t.id===o.id);n?(console.log("‚úÖ Cliente encontrado en la lista, pre-llenando datos"),z(n),$(n.name),u(t=>({...t,company_name:n.name||"",ruc:n.ruc||n.dni||"",contact_name:n.contact_name||"",contact_phone:n.phone||"",contact_email:n.email||"",project_location:n.address||""}))):(console.log("‚ö†Ô∏è Cliente no encontrado en la lista, usando datos de navegaci√≥n"),z(o),$(o.name),u(t=>({...t,company_name:o.name||"",ruc:o.ruc||o.dni||"",contact_name:o.contact_name||"",contact_phone:o.phone||"",contact_email:o.email||"",project_location:o.address||""})))}},[(Ee=h.state)==null?void 0:Ee.selectedClient,F]),s.useEffect(()=>()=>{le&&clearTimeout(le)},[le]);const Je=async a=>{var o,n,t;a.preventDefault(),R(!0),l("");try{if(!c.company_name)throw new Error("Debe ingresar al menos el nombre de la empresa");let b=((o=m.project)==null?void 0:o.id)||m.project_id,E=(n=m.company)==null?void 0:n.id;if(!E){if(!c.ruc)throw new Error("Debe ingresar el RUC de la empresa");const N=await va({type:"empresa",ruc:c.ruc,name:c.company_name,address:c.project_location||"",email:c.contact_email||"",phone:c.contact_phone||"",contact_name:c.contact_name||"",city:c.project_location||"",sector:"servicios"});E=N.id,console.log("‚úÖ Empresa obtenida/creada:",N)}if(!b){const N=await Na({company_id:E,name:c.project_name||`Proyecto ${c.company_name}`,location:c.project_location||"Por definir",contact_name:c.contact_name,contact_phone:c.contact_phone,contact_email:c.contact_email,status:"activo",priority:"normal",vendedor_id:(O==null?void 0:O.id)||null,requiere_laboratorio:r.category_main==="laboratorio",laboratorio_status:r.category_main==="laboratorio"?"pendiente":"no_requerido"});b=N.id,console.log("‚úÖ Proyecto creado autom√°ticamente:",N),console.log("üë§ Vendedor asignado:",O==null?void 0:O.name)}const p=wa(),j={project_id:b,variant_id:w||null,client_contact:c.contact_name,client_email:c.contact_email,client_phone:c.contact_phone,client_company:c.company_name,client_ruc:c.ruc,project_name:c.project_name,project_location:c.project_location,request_date:r.request_date||new Date().toISOString().slice(0,10),issue_date:r.issue_date||new Date().toISOString().slice(0,10),subtotal:U,igv:te,total:ie,status:"borrador",reference:r.reference,reference_type:JSON.stringify(r.reference_type),category_main:r.category_main,quote_code:p,meta:JSON.stringify({customer:c,quote:{...r,request_date:r.request_date||new Date().toISOString().slice(0,10),delivery_days:r.delivery_days||4,reference:r.reference,category_main:r.category_main,quote_code:p},items:_,conditions_text:C,payment_terms:r.payment_terms,file_name:Te||`Cotizaci√≥n ${new Date().getFullYear()}-${String(new Date().getMonth()+1).padStart(2,"0")}${String(new Date().getDate()).padStart(2,"0")} LEM-GEOFAL-${((t=c.company_name)==null?void 0:t.toUpperCase())||"CLIENTE"}`})};let g,v;d?(g=await ja(d,j),v="Cotizaci√≥n actualizada exitosamente",console.log("‚úÖ Cotizaci√≥n actualizada:",g)):(g=await fa(j),v="Cotizaci√≥n creada exitosamente",console.log("‚úÖ Nueva cotizaci√≥n creada:",g)),Fe({code:p,category:r.category_main==="laboratorio"?"üß™ Laboratorio":"‚öôÔ∏è Ingenier√≠a",itemsCount:_.length,total:ie.toLocaleString(),isEdit:!!d,message:v}),_e(!0),re(g.id)}catch(b){console.error("Error:",b),l(b.message||"Error al crear cotizaci√≥n")}finally{R(!1)}},We=async()=>{var a;try{const o=H;if(!o)return alert("Guarde la cotizaci√≥n antes de generar el borrador");const n=((a=me==null?void 0:me.VITE_API_URL)==null?void 0:a.replace(/\/$/,""))||"",t=`/api/quotes/${o}/export/pdf-draft`,b=n&&/\/api$/i.test(n)?`${n}${t.replace(/^\/api/,"")}`:`${n}${t}`,E=localStorage.getItem("token");if(!E)throw new Error("No se encontr√≥ token de autenticaci√≥n");const p={variant_id:w,delivery_days:r.delivery_days,meta:{customer:c,quote:{...r,delivery_days:r.delivery_days,variant_id:w},items:_,conditions_text:C,payment_terms:r.payment_terms},items:_};console.log("üîç exportDraft - Enviando datos:",p);const j=await fetch(b,{method:"POST",headers:{Authorization:`Bearer ${E}`,"Content-Type":"application/json"},body:JSON.stringify(p)});if(!j.ok)throw new Error(`Error ${j.status}: ${j.statusText}`);const g=await j.blob(),v=window.URL.createObjectURL(g),N=document.createElement("a");N.href=v;const G=new Date,oe=String(G.getDate()).padStart(2,"0"),ne=String(G.getMonth()+1).padStart(2,"0"),W=String(G.getFullYear()).slice(-2),de=`COT-${oe}${ne}${W}-${W}.pdf`;N.download=de,document.body.appendChild(N),N.click(),document.body.removeChild(N),window.URL.revokeObjectURL(v)}catch(o){console.error("Error al exportar borrador:",o),alert(`No se pudo exportar borrador: ${o.message}`)}},Ze=a=>{var o;if(u({...c,project_name:a}),a&&a.trim().length>=3){const n=((o=m.company)==null?void 0:o.id)||(I==null?void 0:I.id);n&&He(a.trim(),n)}},He=async(a,o)=>{try{const n=await Pe(a,o);n&&n.length>0?V({count:n.length,suggestedName:`${a} (${n.length+1})`}):V(null)}catch(n){console.error("Error verificando proyectos duplicados:",n),V(null)}},ea=async()=>{var n,t;const a=(n=c.project_name)==null?void 0:n.trim();if(!a||a.length<3){alert("Por favor ingresa al menos 3 caracteres en el nombre del proyecto");return}let o=(t=m.company)==null?void 0:t.id;if(!o&&I&&(o=I.id),!o){alert("Por favor selecciona una empresa primero usando el buscador de clientes");return}console.log("üîç Verificando proyectos existentes para:",a,"empresa:",o),console.log("üîç selectedClient:",I),console.log("üîç selection.company:",m.company),qe(a),Ve(o),Ce(!0)},aa=a=>{console.log("üîÑ Seleccionando proyecto existente:",a),D(o=>({...o,project:a,project_id:a.id})),u(o=>({...o,project_name:a.name,project_location:a.location||o.project_location})),V(null),console.log("‚úÖ Proyecto existente seleccionado y estado actualizado:",a)},ta=(a=null)=>{console.log("üîÑ Creando nuevo proyecto:",a),D(o=>({...o,project:null,project_id:null})),a?(u(o=>({...o,project_name:a})),console.log("‚úÖ Se crear√° un nuevo proyecto con nombre diferenciado:",a)):console.log("‚úÖ Se crear√° un nuevo proyecto con nombre original"),V(null)};return e.jsxs(ga,{titulo:d?"üìù Editar Cotizaci√≥n":"üìã Cotizaci√≥n Inteligente",descripcion:d?"Edita una cotizaci√≥n existente con nueva fecha":"Formulario unificado para crear cotizaciones de forma r√°pida e intuitiva",children:[Le&&e.jsx("div",{className:"alert alert-info",children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"spinner-border spinner-border-sm me-2",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Cargando..."})}),"Cargando cotizaci√≥n existente..."]})}),T&&e.jsx("div",{className:"alert alert-danger",children:T}),e.jsxs("form",{onSubmit:Je,className:"intelligent-quote-form",children:[e.jsxs("div",{className:"alert alert-light border mt-3 intelligent-intro",children:[e.jsx("h5",{children:"üöÄ Flujo Simplificado"}),e.jsx("p",{className:"mb-0",children:'Completa los datos del cliente, proyecto y cotizaci√≥n. Usa el bot√≥n "üíæ GUARDAR COTIZACI√ìN" para guardar tu trabajo.'})]}),e.jsxs("div",{className:"intelligent-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("span",{className:"section-icon",children:"üè¢"}),e.jsx("h4",{children:"CLIENTE"}),e.jsx("span",{className:"section-status",children:c.company_name?"‚úÖ Cliente configurado":"‚è≥ Pendiente"})]}),e.jsxs("div",{className:"section-content",children:[e.jsx("div",{className:"row g-3 mb-4",children:e.jsxs("div",{className:"col-md-12",children:[e.jsx("label",{className:"form-label",children:"Buscar Cliente Existente"}),e.jsxs("div",{className:"position-relative",children:[e.jsx("input",{type:"text",className:"form-control",value:ae,onChange:a=>Ye(a.target.value),onFocus:()=>K(!0),placeholder:"Buscar por nombre, RUC, email o tel√©fono..."}),I&&e.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm position-absolute end-0 top-50 translate-middle-y me-2",onClick:Xe,children:"‚úï"})]}),ae&&ve&&q.length>0&&e.jsxs("div",{className:"border rounded mt-2",style:{maxHeight:"200px",overflowY:"auto"},children:[e.jsx("div",{className:"p-2 bg-light border-bottom",children:e.jsxs("small",{className:"text-muted",children:[q.length," cliente",q.length!==1?"s":""," encontrado",q.length!==1?"s":""]})}),q.map(a=>e.jsxs("div",{className:"p-2 border-bottom cursor-pointer hover-bg-light",onClick:()=>Qe(a),style:{cursor:"pointer"},children:[e.jsx("div",{className:"fw-bold",children:a.name}),e.jsxs("small",{className:"text-muted",children:["RUC: ",a.ruc," | Email: ",a.email,a.phone&&` | Tel: ${a.phone}`]})]},a.id))]}),ae&&ve&&q.length===0&&e.jsx("div",{className:"border rounded mt-2 p-3 text-center",children:e.jsxs("small",{className:"text-muted",children:['No se encontraron clientes con "',ae,'"']})}),I&&e.jsxs("div",{className:"mt-2 p-2 bg-light rounded",children:[e.jsx("strong",{children:"Cliente seleccionado:"})," ",I.name,e.jsx("br",{}),e.jsxs("small",{className:"text-muted",children:["RUC: ",I.ruc," | Email: ",I.email,I.phone&&` | Tel: ${I.phone}`]})]})]})}),e.jsxs("div",{className:"row g-3",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"Empresa"}),e.jsx("input",{className:"form-control",value:c.company_name,onChange:a=>u({...c,company_name:a.target.value}),required:!0,placeholder:"Nombre de la empresa"})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"R.U.C. *"}),e.jsx("input",{className:"form-control",value:c.ruc,onChange:a=>u({...c,ruc:a.target.value}),placeholder:"RUC de la empresa",required:!0})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"Contacto"}),e.jsx("input",{className:"form-control",value:c.contact_name,onChange:a=>u({...c,contact_name:a.target.value}),required:!0,placeholder:"Nombre del contacto"})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"Tel√©fono"}),e.jsx("input",{className:"form-control",value:c.contact_phone,onChange:a=>u({...c,contact_phone:a.target.value}),placeholder:"Tel√©fono del contacto"})]}),e.jsxs("div",{className:"col-md-12",children:[e.jsx("label",{className:"form-label",children:"Correo"}),e.jsx("input",{type:"email",className:"form-control",value:c.contact_email,onChange:a=>u({...c,contact_email:a.target.value}),placeholder:"Correo del contacto"})]})]})]})]}),e.jsxs("div",{className:"intelligent-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("span",{className:"section-icon",children:"üìÅ"}),e.jsx("h4",{children:"PROYECTO"}),e.jsx("span",{className:"section-status",children:c.project_name?"‚úÖ Proyecto configurado":"‚è≥ Pendiente"})]}),e.jsx("div",{className:"section-content",children:e.jsxs("div",{className:"row g-3",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsxs("label",{className:"form-label",children:["Nombre del Proyecto",m.project&&e.jsx("span",{className:"badge bg-success ms-2",children:"‚úÖ Proyecto existente seleccionado"})]}),e.jsxs("div",{className:"input-group",children:[e.jsx("input",{className:`form-control ${J?"is-warning":m.project?"is-success":""}`,value:c.project_name,onChange:a=>Ze(a.target.value),required:!0,placeholder:"Nombre del proyecto"}),e.jsx("button",{type:"button",className:"btn btn-outline-info",onClick:ea,title:"Verificar si ya existen proyectos con este nombre",children:"üîç Verificar"})]}),J&&e.jsxs("div",{className:"alert alert-warning mt-2 mb-0",children:[e.jsx("strong",{children:"‚ö†Ô∏è Advertencia:"})," Se encontraron ",J.count," proyecto(s) con este nombre.",e.jsx("br",{}),e.jsxs("small",{children:["Sugerencia: ",e.jsx("code",{children:J.suggestedName}),e.jsx("button",{type:"button",className:"btn btn-sm btn-outline-warning ms-2",onClick:()=>{u(a=>({...a,project_name:J.suggestedName})),V(null)},children:"Usar sugerencia"})]})]}),m.project&&e.jsx("div",{className:"alert alert-success mt-2 mb-0",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-start",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"‚úÖ Proyecto existente seleccionado:"})," ",m.project.name,e.jsx("br",{}),e.jsxs("small",{children:["Ubicaci√≥n: ",m.project.location||"No especificada"," | Vendedor: ",m.project.vendedor_name||"No asignado"," | Cotizaciones: ",m.project.quotes_count||0]})]}),e.jsx("button",{type:"button",className:"btn btn-sm btn-outline-danger",onClick:()=>{D(a=>({...a,project:null,project_id:null})),console.log("üîÑ Proyecto existente deseleccionado")},title:"Deseleccionar proyecto existente",children:"‚úï"})]})})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"Ubicaci√≥n"}),e.jsx("input",{className:"form-control",value:c.project_location,onChange:a=>u({...c,project_location:a.target.value}),placeholder:"Ubicaci√≥n del proyecto"})]})]})})]}),e.jsxs("div",{className:"intelligent-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("span",{className:"section-icon",children:"üìã"}),e.jsx("h4",{children:"COTIZACI√ìN"}),e.jsx("span",{className:"section-status",children:w?"‚úÖ Variante seleccionada":"‚è≥ Pendiente"})]}),e.jsxs("div",{className:"section-content",children:[e.jsxs("div",{className:"row g-3",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"Fecha de Solicitud"}),e.jsx("input",{type:"date",className:"form-control",value:r.request_date,onChange:a=>x({...r,request_date:a.target.value})})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"Fecha de Emisi√≥n"}),e.jsx("input",{type:"date",className:"form-control",value:r.issue_date,onChange:a=>x({...r,issue_date:a.target.value})})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"Comercial"}),e.jsx("input",{className:"form-control",value:r.commercial_name,onChange:a=>x({...r,commercial_name:a.target.value}),placeholder:"Nombre del comercial"})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"Tel√©fono Comercial"}),e.jsx("input",{type:"tel",className:"form-control",value:r.commercial_phone,onChange:a=>x({...r,commercial_phone:a.target.value}),required:!0,placeholder:"Tel√©fono del comercial"})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"Variante"}),e.jsxs("select",{className:"form-select",value:w,onChange:a=>y(a.target.value),children:[e.jsx("option",{value:"",children:"Seleccionar variante"}),(A||[]).map(a=>e.jsxs("option",{value:a.id,children:[a.code," - ",a.title]},a.id))]})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"Forma de Pago"}),e.jsxs("select",{className:"form-select",value:r.payment_terms,onChange:a=>x({...r,payment_terms:a.target.value}),children:[e.jsx("option",{value:"adelantado",children:"Adelantado"}),e.jsx("option",{value:"50%",children:"Adelanto 50% y saldo previo al informe"}),e.jsx("option",{value:"credito7",children:"Cr√©dito 7 d√≠as con OS"}),e.jsx("option",{value:"credito15",children:"Cr√©dito 15 d√≠as con OS"}),e.jsx("option",{value:"credito30",children:"Cr√©dito 30 d√≠as con OS"})]})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"D√≠as H√°biles"}),e.jsx("input",{type:"number",className:"form-control",value:r.delivery_days||4,onChange:a=>{const o=parseInt(a.target.value)||4;x(n=>({...n,delivery_days:o}))},min:"1",max:"30"},`delivery-days-${r.delivery_days}`),e.jsxs("small",{className:"text-muted",children:["Estado actual: ",r.delivery_days]})]}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"form-check mt-4",children:[e.jsx("input",{className:"form-check-input",type:"checkbox",id:"igv",checked:r.igv,onChange:a=>x({...r,igv:a.target.checked})}),e.jsx("label",{className:"form-check-label",htmlFor:"igv",children:"Aplicar IGV 18%"})]})})]}),e.jsxs("div",{className:"mt-3",children:[e.jsx("label",{className:"form-label",children:"Referencia"}),e.jsx("input",{className:"form-control",value:r.reference,onChange:a=>x({...r,reference:a.target.value}),placeholder:"SEG√öN LO SOLICITADO V√çA CORREO ELECTR√ìNICO / LLAMADA TELEF√ìNICA"})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"form-label",children:"Categor√≠a Principal"}),e.jsxs("div",{className:"row g-3",children:[e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"form-check",children:[e.jsx("input",{className:"form-check-input",type:"radio",name:"categoryMain",id:"laboratorio",value:"laboratorio",checked:r.category_main==="laboratorio",onChange:a=>x({...r,category_main:a.target.value})}),e.jsx("label",{className:"form-check-label",htmlFor:"laboratorio",children:"üß™ Laboratorio"})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"form-check",children:[e.jsx("input",{className:"form-check-input",type:"radio",name:"categoryMain",id:"ingenieria",value:"ingenieria",checked:r.category_main==="ingenieria",onChange:a=>x({...r,category_main:a.target.value})}),e.jsx("label",{className:"form-check-label",htmlFor:"ingenieria",children:"‚öôÔ∏è Ingenier√≠a"})]})})]}),e.jsx("div",{className:"alert alert-info mt-2",children:e.jsxs("small",{children:[e.jsx("strong",{children:"üí° Importante:"})," Selecciona la categor√≠a principal para que el sistema pueda categorizar autom√°ticamente los √≠tems y alimentar el embudo de ventas."]})})]}),e.jsxs("div",{className:"mt-3",children:[e.jsx("label",{className:"form-label",children:"Condiciones Espec√≠ficas"}),e.jsx("textarea",{className:"form-control",rows:4,placeholder:"Las condiciones se auto-completan seg√∫n la variante seleccionada",value:C,onChange:a=>Q(a.target.value)})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"form-label",children:"√çtems de la Cotizaci√≥n"}),e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-bordered table-striped",children:[e.jsx("thead",{className:"table-dark",children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:"10%"},children:"C√≥digo"}),e.jsx("th",{style:{width:"35%"},children:"Descripci√≥n"}),e.jsx("th",{style:{width:"15%"},children:"Norma"}),e.jsx("th",{style:{width:"12%"},children:"Precio Unit."}),e.jsx("th",{style:{width:"10%"},children:"Cantidad"}),e.jsx("th",{style:{width:"12%"},children:"Parcial"}),e.jsx("th",{style:{width:"6%"}})]})}),e.jsx("tbody",{children:_.map((a,o)=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("input",{className:"form-control form-control-sm",value:a.code,onChange:n=>B(o,{code:n.target.value}),placeholder:"C√≥digo"})}),e.jsx("td",{children:e.jsx(Ea,{value:a.description,onChange:n=>B(o,{description:n}),onSelect:n=>{n&&B(o,{code:n.codigo,description:n.descripcion,norm:n.norma,unit_price:n.precio})},placeholder:"Buscar servicio...",size:"sm"})}),e.jsx("td",{children:e.jsx("input",{className:"form-control form-control-sm",value:a.norm,onChange:n=>B(o,{norm:n.target.value}),placeholder:"Norma"})}),e.jsx("td",{children:e.jsx("input",{type:"number",step:"0.01",className:"form-control form-control-sm",value:a.unit_price,onChange:n=>B(o,{unit_price:n.target.value}),placeholder:"0.00"})}),e.jsx("td",{children:e.jsx("input",{type:"number",className:"form-control form-control-sm",value:a.quantity,onChange:n=>B(o,{quantity:n.target.value}),min:"1"})}),e.jsx("td",{children:e.jsxs("span",{className:"fw-bold text-success",children:["S/ ",Ie(a).toFixed(2)]})}),e.jsx("td",{children:e.jsx("button",{type:"button",className:"btn btn-sm btn-outline-danger",onClick:()=>Be(o),disabled:_.length===1,title:"Eliminar √≠tem",children:"üóëÔ∏è"})})]},o))})]})}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center mt-3",children:[e.jsx("button",{type:"button",className:"btn btn-outline-primary",onClick:Ue,children:"‚ûï Agregar √≠tem"}),e.jsxs("div",{className:"text-end",children:[e.jsxs("div",{className:"h6 mb-1",children:["Subtotal: ",e.jsxs("span",{className:"text-primary",children:["S/ ",U.toFixed(2)]})]}),e.jsxs("div",{className:"h6 mb-1",children:["IGV 18%: ",e.jsxs("span",{className:"text-primary",children:["S/ ",te.toFixed(2)]})]}),e.jsxs("div",{className:"h5 mb-0",children:["Total: ",e.jsxs("span",{className:"text-success fw-bold",children:["S/ ",ie.toFixed(2)]})]})]})]})]})]})]}),e.jsxs("div",{className:"intelligent-actions",children:[e.jsx("button",{type:"submit",className:"btn btn-success btn-lg",disabled:k||!c.company_name||!c.ruc,children:k?d?"üîÑ Actualizando...":"üíæ Guardando...":d?"üîÑ GUARDAR CAMBIOS":"üíæ CREAR COTIZACI√ìN"}),e.jsx("button",{type:"button",className:"btn btn-outline-warning btn-lg",onClick:We,disabled:!H,children:"üìÑ Generar cotizaci√≥n"})]})]}),e.jsx(Ca,{show:Me,onHide:()=>_e(!1),data:Re,buttonText:"Aceptar"}),e.jsx(Sa,{show:ze,onHide:()=>Ce(!1),projectName:ke,companyId:$e,onSelectExisting:aa,onCreateNew:ta})]})}export{Ya as default};
//# sourceMappingURL=CotizacionInteligente-CEglPbe7.js.map
