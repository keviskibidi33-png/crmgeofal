import{r as n,Q as B,c as R,R as y,j as e,U as q,e as l,B as z,V as L,a2 as k,a6 as x,d as N,y as h,H as Q,a7 as C,x as H,a8 as I}from"./index-o7c7tdkB.js";import{P as U,R as _,C as d}from"./PageHeader-C0hqpNJa.js";import{D as G}from"./DataTable-BnIKqI-b.js";import{M as V}from"./ModalForm-BYW2MbvZ.js";import{S as u}from"./StatsCard-Sqt5gmwc.js";import{c as W,u as X,l as J}from"./tickets-D4kLk3Yp.js";import{C as p}from"./Card-B7TGPdeB.js";import"./InputGroup-CsBCMGWc.js";import"./Form-CNH_JlrK.js";import"./Spinner-H_v7OS2w.js";const v={title:"",description:"",priority:"media"};function le(){const[T,c]=n.useState(!1),[i,m]=n.useState(null),[K,O]=n.useState(null),b=B(),{data:r,isLoading:w}=R(["tickets"],()=>J(),{keepPreviousData:!0}),j=y(W,{onSuccess:()=>{b.invalidateQueries("tickets"),c(!1),m(null)},onError:t=>console.error("Error creating ticket:",t)}),f=y(X,{onSuccess:()=>{b.invalidateQueries("tickets")},onError:t=>console.error("Error updating ticket:",t)}),E=()=>{m(v),c(!0)},S=t=>{m(t),c(!0)},F=async t=>{i.id?await f.mutateAsync({id:i.id,...t}):await j.mutateAsync(t)},M=t=>{const a={abierto:{bg:"primary",text:"Abierto",icon:l},en_progreso:{bg:"warning",text:"En Progreso",icon:k},resuelto:{bg:"success",text:"Resuelto",icon:N},cerrado:{bg:"secondary",text:"Cerrado",icon:Q}}[t]||{bg:"secondary",text:t,icon:l},g=a.icon;return e.jsxs(h,{bg:a.bg,className:"status-badge d-flex align-items-center",children:[e.jsx(g,{size:12,className:"me-1"}),a.text]})},P=t=>{const a={baja:{bg:"success",text:"Baja",icon:C},media:{bg:"warning",text:"Media",icon:x},alta:{bg:"danger",text:"Alta",icon:x}}[t]||{bg:"secondary",text:t,icon:C},g=a.icon;return e.jsxs(h,{bg:a.bg,className:"status-badge d-flex align-items-center",children:[e.jsx(g,{size:12,className:"me-1"}),a.text]})},D=[{header:"ID",accessor:"id",width:"80px"},{header:"Título",accessor:"title",render:(t,s)=>{var a;return e.jsxs("div",{children:[e.jsx("div",{className:"fw-medium",children:s.title}),e.jsxs("small",{className:"text-muted",children:[e.jsx(H,{size:12,className:"me-1"}),((a=s.user)==null?void 0:a.name)||"Usuario"]})]})}},{header:"Descripción",accessor:"description",render:t=>e.jsx("div",{className:"text-truncate",style:{maxWidth:"200px"},title:t,children:t})},{header:"Prioridad",accessor:"priority",render:t=>P(t)},{header:"Estado",accessor:"status",render:t=>M(t)},{header:"Fecha",accessor:"created_at",render:t=>e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx(I,{size:12,className:"me-1 text-muted"}),e.jsx("small",{children:new Date(t).toLocaleDateString("es-ES")})]})}],A=[{name:"title",label:"Título",type:"text",required:!0,placeholder:"Ingresa el título del ticket"},{name:"description",label:"Descripción",type:"textarea",required:!0,placeholder:"Describe el problema o solicitud",rows:4},{name:"priority",label:"Prioridad",type:"select",required:!0,options:[{value:"baja",label:"Baja"},{value:"media",label:"Media"},{value:"alta",label:"Alta"}]}],o=n.useMemo(()=>{const t=(r==null?void 0:r.tickets)||[];return{total:t.length,abiertos:t.filter(s=>s.status==="abierto").length,enProgreso:t.filter(s=>s.status==="en_progreso").length,resueltos:t.filter(s=>s.status==="resuelto").length,cerrados:t.filter(s=>s.status==="cerrado").length,alta:t.filter(s=>s.priority==="alta").length,media:t.filter(s=>s.priority==="media").length,baja:t.filter(s=>s.priority==="baja").length}},[r]);return e.jsx(q,{fluid:!0,className:"py-4",children:e.jsxs("div",{className:"fade-in",children:[e.jsx(U,{title:"Gestión de Tickets",subtitle:"Crear, editar y gestionar tickets de soporte",icon:l,actions:e.jsxs(z,{variant:"primary",onClick:E,children:[e.jsx(L,{className:"me-2"}),"Nuevo Ticket"]})}),e.jsxs(_,{className:"g-4 mb-4",children:[e.jsx(d,{md:6,lg:3,children:e.jsx(u,{title:"Total Tickets",value:o.total,icon:l,color:"primary",subtitle:"Tickets registrados"})}),e.jsx(d,{md:6,lg:3,children:e.jsx(u,{title:"Abiertos",value:o.abiertos,icon:k,color:"warning",subtitle:"Pendientes de atención"})}),e.jsx(d,{md:6,lg:3,children:e.jsx(u,{title:"En Progreso",value:o.enProgreso,icon:x,color:"info",subtitle:"En proceso de resolución"})}),e.jsx(d,{md:6,lg:3,children:e.jsx(u,{title:"Resueltos",value:o.resueltos,icon:N,color:"success",subtitle:"Completados"})})]}),e.jsxs(p,{className:"shadow-sm border-0",children:[e.jsx(p.Header,{className:"bg-white border-bottom",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("h5",{className:"mb-0",children:[e.jsx(l,{className:"me-2 text-primary"}),"Lista de Tickets"]}),e.jsxs(h,{bg:"light",text:"dark",className:"px-3 py-2",children:[o.total," tickets"]})]})}),e.jsx(p.Body,{className:"p-0",children:e.jsx(G,{data:(r==null?void 0:r.tickets)||[],columns:D,loading:w,onEdit:S,emptyMessage:"No hay tickets registrados"})})]}),e.jsx(V,{show:T,onHide:()=>c(!1),title:i!=null&&i.id?"Editar Ticket":"Nuevo Ticket",data:i||v,fields:A,onSubmit:F,loading:j.isLoading||f.isLoading,submitText:i!=null&&i.id?"Actualizar":"Crear"})]})})}export{le as default};
//# sourceMappingURL=Tickets-mb0KVCrt.js.map
