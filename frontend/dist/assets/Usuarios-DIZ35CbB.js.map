{"version":3,"file":"Usuarios-DIZ35CbB.js","sources":["../../src/services/users.js","../../src/pages/Usuarios.jsx"],"sourcesContent":["import { apiFetch } from './api';\r\n\r\nexport const listUsers = (params = {}) => {\r\n  const searchParams = new URLSearchParams();\r\n  if (params.page) searchParams.set('page', params.page);\r\n  if (params.limit) searchParams.set('limit', params.limit);\r\n  if (params.search) searchParams.set('search', params.search);\r\n  if (params.area) searchParams.set('area', params.area);\r\n  if (params.role) searchParams.set('role', params.role);\r\n  const qs = searchParams.toString();\r\n  const path = qs ? `/api/users?${qs}` : '/api/users';\r\n  return apiFetch(path);\r\n};\r\n\r\nexport const createUser = (payload) =>\r\n  apiFetch('/api/users', {\r\n    method: 'POST',\r\n    body: JSON.stringify(payload),\r\n  });\r\n\r\nexport const updateUser = (id, payload) =>\r\n  apiFetch(`/api/users/${id}`, {\r\n    method: 'PATCH',\r\n    body: JSON.stringify(payload),\r\n  });\r\n\r\nexport const deleteUser = (id) =>\r\n  apiFetch(`/api/users/${id}`, { method: 'DELETE' });\r\n\r\nexport const resetPassword = (id, password) =>\r\n  apiFetch(`/api/users/${id}/reset-password`, {\r\n    method: 'POST',\r\n    body: JSON.stringify({ password }),\r\n  });\r\n\r\nexport const setNotificationEnabled = (id, enabled) =>\r\n  apiFetch(`/api/users/${id}/notification`, {\r\n    method: 'PATCH',\r\n    body: JSON.stringify({ enabled }),\r\n  });\r\n\r\nexport default {\r\n  listUsers,\r\n  createUser,\r\n  updateUser,\r\n  deleteUser,\r\n  resetPassword,\r\n  setNotificationEnabled,\r\n};\r\n","import React from 'react';\r\nimport ModuloBase from '../components/ModuloBase';\r\nimport DataTable from '../components/DataTable';\r\nimport Toolbar from '../components/Toolbar';\r\nimport Toast from '../components/Toast';\r\nimport { listUsers, createUser } from '../services/users';\r\nimport { useQuery } from 'react-query';\r\n\r\nexport default function Usuarios() {\r\n  const [q, setQ] = React.useState('');\r\n  const [role, setRole] = React.useState('');\r\n  const [page, setPage] = React.useState(1);\r\n  const [limit] = React.useState(10);\r\n  const [toast, setToast] = React.useState({ show: false, variant: 'success', message: '' });\r\n  const [createOpen, setCreateOpen] = React.useState(false);\r\n  const [form, setForm] = React.useState({ name: '', email: '', password: '', role: '' });\r\n  const { data, isLoading, isError, error } = useQuery(\r\n    ['users', { page, limit, q, role }],\r\n    async () => {\r\n      const resp = await listUsers({ page, limit, search: q, role });\r\n      const rows = Array.isArray(resp?.data) ? resp.data : (resp?.rows || resp || []);\r\n      const total = resp?.total ?? rows.length;\r\n      return { rows, total };\r\n    }\r\n  );\r\n\r\n  React.useEffect(() => {\r\n    if (isError && error) {\r\n      setToast({ show: true, variant: 'danger', message: error.message || 'No se pudo cargar usuarios' });\r\n    }\r\n  }, [isError, error]);\r\n\r\n  const onCreate = () => {\r\n    // TODO: abrir modal crear usuario\r\n    alert('Crear usuario (pendiente)');\r\n  };\r\n  const onClear = () => { setQ(''); setRole(''); setPage(1); };\r\n\r\n  const total = data?.total || 0;\r\n  const rows = data?.rows || [];\r\n  const totalPages = Math.max(1, Math.ceil(total / limit));\r\n\r\n  return (\r\n    <ModuloBase titulo=\"Gestión de Usuarios\" descripcion=\"Crear, editar y eliminar usuarios del sistema.\">\r\n      <Toolbar\r\n        compact\r\n        left={(\r\n          <>\r\n            <input\r\n              className=\"form-control\"\r\n              style={{ minWidth: 220 }}\r\n              placeholder=\"Buscar por nombre o email\"\r\n              value={q}\r\n              onChange={e => { setQ(e.target.value); setPage(1); }}\r\n            />\r\n            <select className=\"form-select\" value={role} onChange={e => { setRole(e.target.value); setPage(1); }}>\r\n              <option value=\"\">Todos los roles</option>\r\n              <option value=\"admin\">Admin</option>\r\n              <option value=\"soporte\">Soporte</option>\r\n              <option value=\"jefa_comercial\">Jefa Comercial</option>\r\n              <option value=\"vendedor_comercial\">Vendedor</option>\r\n              <option value=\"laboratorio\">Laboratorio</option>\r\n              <option value=\"gerencia\">Gerencia</option>\r\n            </select>\r\n          </>\r\n        )}\r\n        right={(\r\n          <>\r\n            <button className=\"btn btn-primary\" onClick={() => setCreateOpen(true)}>Crear Usuario</button>\r\n            <button className=\"btn btn-outline-secondary\" onClick={onClear}>Limpiar</button>\r\n          </>\r\n        )}\r\n      />\r\n      <DataTable\r\n        columns={[\r\n          { header: 'ID', key: 'id', width: 80 },\r\n          { header: 'Nombre', key: 'name' },\r\n          { header: 'Email', key: 'email' },\r\n          { header: 'Rol', key: 'role' },\r\n          { header: 'Acciones', key: 'actions', render: () => null, width: 120 },\r\n        ]}\r\n        rows={rows}\r\n        loading={isLoading}\r\n      />\r\n\r\n      <div className=\"d-flex justify-content-between align-items-center\">\r\n        <div className=\"text-muted small\">Total: {total}</div>\r\n        <div className=\"btn-group\">\r\n          <button className=\"btn btn-outline-secondary\" disabled={page<=1} onClick={()=>setPage(p=>Math.max(1,p-1))}>Anterior</button>\r\n          <span className=\"btn btn-outline-secondary disabled\">{page}/{totalPages}</span>\r\n          <button className=\"btn btn-outline-secondary\" disabled={page>=totalPages} onClick={()=>setPage(p=>Math.min(totalPages,p+1))}>Siguiente</button>\r\n        </div>\r\n      </div>\r\n\r\n      <Toast show={toast.show} variant={toast.variant} onClose={()=>setToast({ ...toast, show: false })}>\r\n        {toast.message}\r\n      </Toast>\r\n\r\n      {createOpen && (\r\n        <div className=\"modal d-block\" tabIndex=\"-1\" role=\"dialog\" style={{ background: 'rgba(0,0,0,0.35)' }}>\r\n          <div className=\"modal-dialog\">\r\n            <div className=\"modal-content\">\r\n              <div className=\"modal-header\">\r\n                <h5 className=\"modal-title\">Crear Usuario</h5>\r\n                <button type=\"button\" className=\"btn-close\" onClick={()=>setCreateOpen(false)}></button>\r\n              </div>\r\n              <form onSubmit={async (e)=>{\r\n                e.preventDefault();\r\n                try {\r\n                  await createUser(form);\r\n                  setToast({ show: true, variant: 'success', message: 'Usuario creado' });\r\n                  setCreateOpen(false);\r\n                  setForm({ name: '', email: '', password: '', role: '' });\r\n                } catch (err) {\r\n                  setToast({ show: true, variant: 'danger', message: err.message || 'Error al crear usuario' });\r\n                }\r\n              }}>\r\n                <div className=\"modal-body\">\r\n                  <div className=\"mb-2\">\r\n                    <label className=\"form-label\">Nombre</label>\r\n                    <input className=\"form-control\" value={form.name} onChange={e=>setForm(f=>({ ...f, name: e.target.value }))} required />\r\n                  </div>\r\n                  <div className=\"mb-2\">\r\n                    <label className=\"form-label\">Email</label>\r\n                    <input type=\"email\" className=\"form-control\" value={form.email} onChange={e=>setForm(f=>({ ...f, email: e.target.value }))} required />\r\n                  </div>\r\n                  <div className=\"mb-2\">\r\n                    <label className=\"form-label\">Contraseña</label>\r\n                    <input type=\"password\" className=\"form-control\" value={form.password} onChange={e=>setForm(f=>({ ...f, password: e.target.value }))} required />\r\n                  </div>\r\n                  <div className=\"mb-2\">\r\n                    <label className=\"form-label\">Rol</label>\r\n                    <select className=\"form-select\" value={form.role} onChange={e=>setForm(f=>({ ...f, role: e.target.value }))} required>\r\n                      <option value=\"\">Seleccione</option>\r\n                      <option value=\"admin\">Admin</option>\r\n                      <option value=\"soporte\">Soporte</option>\r\n                      <option value=\"jefa_comercial\">Jefa Comercial</option>\r\n                      <option value=\"vendedor_comercial\">Vendedor</option>\r\n                      <option value=\"laboratorio\">Laboratorio</option>\r\n                      <option value=\"gerencia\">Gerencia</option>\r\n                    </select>\r\n                  </div>\r\n                </div>\r\n                <div className=\"modal-footer\">\r\n                  <button type=\"button\" className=\"btn btn-outline-secondary\" onClick={()=>setCreateOpen(false)}>Cancelar</button>\r\n                  <button type=\"submit\" className=\"btn btn-primary\">Crear</button>\r\n                </div>\r\n              </form>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </ModuloBase>\r\n  );\r\n}\r\n"],"names":["listUsers","params","searchParams","qs","path","apiFetch","createUser","payload","Usuarios","q","setQ","React","role","setRole","page","setPage","limit","toast","setToast","createOpen","setCreateOpen","form","setForm","data","isLoading","isError","error","useQuery","resp","rows","total","onClear","totalPages","jsxs","ModuloBase","jsx","Toolbar","Fragment","e","DataTable","p","Toast","err","f"],"mappings":"4QAEO,MAAMA,EAAY,CAACC,EAAS,KAAO,CACxC,MAAMC,EAAe,IAAI,gBACrBD,EAAO,MAAMC,EAAa,IAAI,OAAQD,EAAO,IAAI,EACjDA,EAAO,OAAOC,EAAa,IAAI,QAASD,EAAO,KAAK,EACpDA,EAAO,QAAQC,EAAa,IAAI,SAAUD,EAAO,MAAM,EACvDA,EAAO,MAAMC,EAAa,IAAI,OAAQD,EAAO,IAAI,EACjDA,EAAO,MAAMC,EAAa,IAAI,OAAQD,EAAO,IAAI,EACrD,MAAME,EAAKD,EAAa,WAClBE,EAAOD,EAAK,cAAcA,CAAE,GAAK,aACvC,OAAOE,EAASD,CAAI,CACtB,EAEaE,EAAcC,GACzBF,EAAS,aAAc,CACrB,OAAQ,OACR,KAAM,KAAK,UAAUE,CAAO,CAChC,CAAG,ECVH,SAAwBC,GAAW,CACjC,KAAM,CAACC,EAAGC,CAAI,EAAIC,EAAM,SAAS,EAAE,EAC7B,CAACC,EAAMC,CAAO,EAAIF,EAAM,SAAS,EAAE,EACnC,CAACG,EAAMC,CAAO,EAAIJ,EAAM,SAAS,CAAC,EAClC,CAACK,CAAK,EAAIL,EAAM,SAAS,EAAE,EAC3B,CAACM,EAAOC,CAAQ,EAAIP,EAAM,SAAS,CAAE,KAAM,GAAO,QAAS,UAAW,QAAS,GAAI,EACnF,CAACQ,EAAYC,CAAa,EAAIT,EAAM,SAAS,EAAK,EAClD,CAACU,EAAMC,CAAO,EAAIX,EAAM,SAAS,CAAE,KAAM,GAAI,MAAO,GAAI,SAAU,GAAI,KAAM,GAAI,EAChF,CAAE,KAAAY,EAAM,UAAAC,EAAW,QAAAC,EAAS,MAAAC,GAAUC,EAC1C,CAAC,QAAS,CAAE,KAAAb,EAAM,MAAAE,EAAO,EAAAP,EAAG,KAAAG,EAAM,EAClC,SAAY,CACV,MAAMgB,EAAO,MAAM5B,EAAU,CAAE,KAAAc,EAAM,MAAAE,EAAO,OAAQP,EAAG,KAAAG,EAAM,EACvDiB,EAAO,MAAM,QAAQD,GAAA,YAAAA,EAAM,IAAI,EAAIA,EAAK,MAAQA,GAAA,YAAAA,EAAM,OAAQA,GAAQ,CAAA,EACtEE,GAAQF,GAAA,YAAAA,EAAM,QAASC,EAAK,OAClC,MAAO,CAAE,KAAAA,EAAM,MAAAC,CAAAA,CACjB,CAAA,EAGFnB,EAAM,UAAU,IAAM,CAChBc,GAAWC,GACbR,EAAS,CAAE,KAAM,GAAM,QAAS,SAAU,QAASQ,EAAM,SAAW,6BAA8B,CAEtG,EAAG,CAACD,EAASC,CAAK,CAAC,EAMnB,MAAMK,EAAU,IAAM,CAAErB,EAAK,EAAE,EAAGG,EAAQ,EAAE,EAAGE,EAAQ,CAAC,CAAG,EAErDe,GAAQP,GAAA,YAAAA,EAAM,QAAS,EACvBM,GAAON,GAAA,YAAAA,EAAM,OAAQ,CAAA,EACrBS,EAAa,KAAK,IAAI,EAAG,KAAK,KAAKF,EAAQd,CAAK,CAAC,EAEvD,OACEiB,EAAAA,KAACC,EAAA,CAAW,OAAO,sBAAsB,YAAY,iDACnD,SAAA,CAAAC,EAAAA,IAACC,EAAA,CACC,QAAO,GACP,KACEH,EAAAA,KAAAI,WAAA,CACE,SAAA,CAAAF,EAAAA,IAAC,QAAA,CACC,UAAU,eACV,MAAO,CAAE,SAAU,GAAA,EACnB,YAAY,4BACZ,MAAO1B,EACP,SAAU6B,GAAK,CAAE5B,EAAK4B,EAAE,OAAO,KAAK,EAAGvB,EAAQ,CAAC,CAAG,CAAA,CAAA,SAEpD,SAAA,CAAO,UAAU,cAAc,MAAOH,EAAM,SAAU0B,GAAK,CAAEzB,EAAQyB,EAAE,OAAO,KAAK,EAAGvB,EAAQ,CAAC,CAAG,EACjG,SAAA,CAAAoB,EAAAA,IAAC,SAAA,CAAO,MAAM,GAAG,SAAA,kBAAe,EAChCA,EAAAA,IAAC,SAAA,CAAO,MAAM,QAAQ,SAAA,QAAK,EAC3BA,EAAAA,IAAC,SAAA,CAAO,MAAM,UAAU,SAAA,UAAO,EAC/BA,EAAAA,IAAC,SAAA,CAAO,MAAM,iBAAiB,SAAA,iBAAc,EAC7CA,EAAAA,IAAC,SAAA,CAAO,MAAM,qBAAqB,SAAA,WAAQ,EAC3CA,EAAAA,IAAC,SAAA,CAAO,MAAM,cAAc,SAAA,cAAW,EACvCA,EAAAA,IAAC,SAAA,CAAO,MAAM,WAAW,SAAA,UAAA,CAAQ,CAAA,CAAA,CACnC,CAAA,EACF,EAEF,MACEF,EAAAA,KAAAI,WAAA,CACE,SAAA,CAAAF,EAAAA,IAAC,SAAA,CAAO,UAAU,kBAAkB,QAAS,IAAMf,EAAc,EAAI,EAAG,SAAA,eAAA,CAAa,QACpF,SAAA,CAAO,UAAU,4BAA4B,QAASW,EAAS,SAAA,SAAA,CAAO,CAAA,CAAA,CACzE,CAAA,CAAA,EAGJI,EAAAA,IAACI,EAAA,CACC,QAAS,CACP,CAAE,OAAQ,KAAM,IAAK,KAAM,MAAO,EAAA,EAClC,CAAE,OAAQ,SAAU,IAAK,MAAA,EACzB,CAAE,OAAQ,QAAS,IAAK,OAAA,EACxB,CAAE,OAAQ,MAAO,IAAK,MAAA,EACtB,CAAE,OAAQ,WAAY,IAAK,UAAW,OAAQ,IAAM,KAAM,MAAO,GAAA,CAAI,EAEvE,KAAAV,EACA,QAASL,CAAA,CAAA,EAGXS,EAAAA,KAAC,MAAA,CAAI,UAAU,oDACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,mBAAmB,SAAA,CAAA,UAAQH,CAAA,EAAM,EAChDG,EAAAA,KAAC,MAAA,CAAI,UAAU,YACb,SAAA,CAAAE,MAAC,UAAO,UAAU,4BAA4B,SAAUrB,GAAM,EAAG,QAAS,IAAIC,EAAQyB,GAAG,KAAK,IAAI,EAAEA,EAAE,CAAC,CAAC,EAAG,SAAA,WAAQ,EACnHP,EAAAA,KAAC,OAAA,CAAK,UAAU,qCAAsC,SAAA,CAAAnB,EAAK,IAAEkB,CAAA,EAAW,QACvE,SAAA,CAAO,UAAU,4BAA4B,SAAUlB,GAAMkB,EAAY,QAAS,IAAIjB,EAAQyB,GAAG,KAAK,IAAIR,EAAWQ,EAAE,CAAC,CAAC,EAAG,SAAA,WAAA,CAAS,CAAA,CAAA,CACxI,CAAA,EACF,QAECC,EAAA,CAAM,KAAMxB,EAAM,KAAM,QAASA,EAAM,QAAS,QAAS,IAAIC,EAAS,CAAE,GAAGD,EAAO,KAAM,GAAO,EAC7F,WAAM,QACT,EAECE,SACE,MAAA,CAAI,UAAU,gBAAgB,SAAS,KAAK,KAAK,SAAS,MAAO,CAAE,WAAY,oBAC9E,SAAAgB,EAAAA,IAAC,MAAA,CAAI,UAAU,eACb,SAAAF,EAAAA,KAAC,MAAA,CAAI,UAAU,gBACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,eACb,SAAA,CAAAE,EAAAA,IAAC,KAAA,CAAG,UAAU,cAAc,SAAA,gBAAa,EACzCA,EAAAA,IAAC,SAAA,CAAO,KAAK,SAAS,UAAU,YAAY,QAAS,IAAIf,EAAc,EAAK,CAAA,CAAG,CAAA,EACjF,EACAa,EAAAA,KAAC,OAAA,CAAK,SAAU,MAAOK,GAAI,CACzBA,EAAE,eAAA,EACF,GAAI,CACF,MAAMhC,EAAWe,CAAI,EACrBH,EAAS,CAAE,KAAM,GAAM,QAAS,UAAW,QAAS,iBAAkB,EACtEE,EAAc,EAAK,EACnBE,EAAQ,CAAE,KAAM,GAAI,MAAO,GAAI,SAAU,GAAI,KAAM,GAAI,CACzD,OAASoB,EAAK,CACZxB,EAAS,CAAE,KAAM,GAAM,QAAS,SAAU,QAASwB,EAAI,SAAW,yBAA0B,CAC9F,CACF,EACE,SAAA,CAAAT,EAAAA,KAAC,MAAA,CAAI,UAAU,aACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,OACb,SAAA,CAAAE,EAAAA,IAAC,QAAA,CAAM,UAAU,aAAa,SAAA,SAAM,EACpCA,MAAC,SAAM,UAAU,eAAe,MAAOd,EAAK,KAAM,SAAUiB,GAAGhB,MAAY,CAAE,GAAGqB,EAAG,KAAML,EAAE,OAAO,OAAQ,EAAG,SAAQ,EAAA,CAAC,CAAA,EACxH,EACAL,EAAAA,KAAC,MAAA,CAAI,UAAU,OACb,SAAA,CAAAE,EAAAA,IAAC,QAAA,CAAM,UAAU,aAAa,SAAA,QAAK,EACnCA,EAAAA,IAAC,SAAM,KAAK,QAAQ,UAAU,eAAe,MAAOd,EAAK,MAAO,SAAUiB,GAAGhB,EAAQqB,IAAI,CAAE,GAAGA,EAAG,MAAOL,EAAE,OAAO,KAAA,EAAQ,EAAG,SAAQ,EAAA,CAAC,CAAA,EACvI,EACAL,EAAAA,KAAC,MAAA,CAAI,UAAU,OACb,SAAA,CAAAE,EAAAA,IAAC,QAAA,CAAM,UAAU,aAAa,SAAA,aAAU,EACxCA,EAAAA,IAAC,SAAM,KAAK,WAAW,UAAU,eAAe,MAAOd,EAAK,SAAU,SAAUiB,GAAGhB,EAAQqB,IAAI,CAAE,GAAGA,EAAG,SAAUL,EAAE,OAAO,KAAA,EAAQ,EAAG,SAAQ,EAAA,CAAC,CAAA,EAChJ,EACAL,EAAAA,KAAC,MAAA,CAAI,UAAU,OACb,SAAA,CAAAE,EAAAA,IAAC,QAAA,CAAM,UAAU,aAAa,SAAA,MAAG,EACjCF,EAAAA,KAAC,UAAO,UAAU,cAAc,MAAOZ,EAAK,KAAM,SAAUiB,GAAGhB,MAAY,CAAE,GAAGqB,EAAG,KAAML,EAAE,OAAO,KAAA,EAAQ,EAAG,SAAQ,GACnH,SAAA,CAAAH,EAAAA,IAAC,SAAA,CAAO,MAAM,GAAG,SAAA,aAAU,EAC3BA,EAAAA,IAAC,SAAA,CAAO,MAAM,QAAQ,SAAA,QAAK,EAC3BA,EAAAA,IAAC,SAAA,CAAO,MAAM,UAAU,SAAA,UAAO,EAC/BA,EAAAA,IAAC,SAAA,CAAO,MAAM,iBAAiB,SAAA,iBAAc,EAC7CA,EAAAA,IAAC,SAAA,CAAO,MAAM,qBAAqB,SAAA,WAAQ,EAC3CA,EAAAA,IAAC,SAAA,CAAO,MAAM,cAAc,SAAA,cAAW,EACvCA,EAAAA,IAAC,SAAA,CAAO,MAAM,WAAW,SAAA,UAAA,CAAQ,CAAA,CAAA,CACnC,CAAA,CAAA,CACF,CAAA,EACF,EACAF,EAAAA,KAAC,MAAA,CAAI,UAAU,eACb,SAAA,CAAAE,EAAAA,IAAC,SAAA,CAAO,KAAK,SAAS,UAAU,4BAA4B,QAAS,IAAIf,EAAc,EAAK,EAAG,SAAA,UAAA,CAAQ,QACtG,SAAA,CAAO,KAAK,SAAS,UAAU,kBAAkB,SAAA,OAAA,CAAK,CAAA,CAAA,CACzD,CAAA,CAAA,CACF,CAAA,CAAA,CACF,EACF,CAAA,CACF,CAAA,EAEJ,CAEJ"}