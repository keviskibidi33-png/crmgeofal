{"version":3,"file":"FacturacionProyectos-X2wxHKu7.js","sources":["../../src/pages/FacturacionProyectos.jsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { Container, Row, Col, Card, Badge, Button, Form, Spinner, Alert, Table, Modal } from 'react-bootstrap';\r\nimport { FiEye, FiFileText, FiUser, FiCalendar, FiDollarSign, FiTrendingUp, FiRefreshCw, FiUpload, FiCheck, FiDownload } from 'react-icons/fi';\r\nimport { useAuth } from '../contexts/AuthContext';\r\nimport api from '../services/api';\r\n\r\nconst FacturacionProyectos = () => {\r\n  const { user } = useAuth();\r\n  const [projects, setProjects] = useState([]);\r\n  const [quotes, setQuotes] = useState([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState(null);\r\n  const [filters, setFilters] = useState({\r\n    status: '',\r\n    vendedor: '',\r\n    cliente: ''\r\n  });\r\n\r\n  // Modal para adjuntar factura\r\n  const [showInvoiceModal, setShowInvoiceModal] = useState(false);\r\n  const [selectedProject, setSelectedProject] = useState(null);\r\n  const [invoiceFile, setInvoiceFile] = useState(null);\r\n  const [invoiceData, setInvoiceData] = useState({\r\n    invoice_number: '',\r\n    invoice_date: new Date().toISOString().split('T')[0],\r\n    invoice_amount: '',\r\n    notes: ''\r\n  });\r\n\r\n  useEffect(() => {\r\n    fetchData();\r\n  }, []);\r\n\r\n  const fetchData = async () => {\r\n    try {\r\n      setLoading(true);\r\n      setError(null);\r\n\r\n      // Obtener proyectos para facturaci√≥n\r\n      const projectsData = await api('/api/projects/for-invoicing');\r\n      setProjects(projectsData || []);\r\n\r\n      // Obtener cotizaciones relacionadas\r\n      const quotesData = await api('/api/quotes/with-projects');\r\n      setQuotes(quotesData || []);\r\n\r\n    } catch (error) {\r\n      console.error('Error fetching data:', error);\r\n      setError('Error al cargar los datos: ' + (error.message || 'Error desconocido'));\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const getStatusBadge = (status) => {\r\n    const statusConfig = {\r\n      'borrador': { variant: 'warning', text: 'Borrador' },\r\n      'aprobada': { variant: 'success', text: 'Aprobada' },\r\n      'facturada': { variant: 'info', text: 'Facturada' },\r\n      'activo': { variant: 'primary', text: 'Activo' },\r\n      'completado': { variant: 'success', text: 'Completado' }\r\n    };\r\n    \r\n    const config = statusConfig[status] || { variant: 'secondary', text: status };\r\n    return <Badge bg={config.variant}>{config.text}</Badge>;\r\n  };\r\n\r\n  const getProjectStatus = (project) => {\r\n    // Determinar estado del proyecto basado en sus cotizaciones\r\n    const projectQuotes = quotes.filter(q => q.project_id === project.id);\r\n    \r\n    if (projectQuotes.length === 0) return 'sin_cotizaciones';\r\n    if (projectQuotes.some(q => q.status === 'facturada')) return 'completado';\r\n    if (projectQuotes.some(q => q.status === 'aprobada')) return 'en_proceso';\r\n    if (projectQuotes.some(q => q.status === 'borrador')) return 'pendiente';\r\n    \r\n    return 'activo';\r\n  };\r\n\r\n  const getProjectMetrics = (project) => {\r\n    const projectQuotes = quotes.filter(q => q.project_id === project.id);\r\n    \r\n    return {\r\n      totalQuotes: projectQuotes.length,\r\n      approvedQuotes: projectQuotes.filter(q => q.status === 'aprobada').length,\r\n      invoicedQuotes: projectQuotes.filter(q => q.status === 'facturada').length,\r\n      totalAmount: projectQuotes.reduce((sum, q) => sum + (q.total || 0), 0),\r\n      lastActivity: projectQuotes.length > 0 ? \r\n        new Date(Math.max(...projectQuotes.map(q => new Date(q.updated_at)))) : \r\n        new Date(project.updated_at)\r\n    };\r\n  };\r\n\r\n  const filteredProjects = projects.filter(project => {\r\n    if (filters.status && getProjectStatus(project) !== filters.status) return false;\r\n    if (filters.vendedor && !project.created_by_name?.toLowerCase().includes(filters.vendedor.toLowerCase())) return false;\r\n    if (filters.cliente && !project.company_name?.toLowerCase().includes(filters.cliente.toLowerCase())) return false;\r\n    return true;\r\n  });\r\n\r\n  const handleInvoiceUpload = async () => {\r\n    try {\r\n      setLoading(true);\r\n      setError(null);\r\n\r\n      const formData = new FormData();\r\n      formData.append('project_id', selectedProject.id);\r\n      formData.append('invoice_number', invoiceData.invoice_number);\r\n      formData.append('invoice_date', invoiceData.invoice_date);\r\n      formData.append('invoice_amount', invoiceData.invoice_amount);\r\n      formData.append('notes', invoiceData.notes);\r\n      if (invoiceFile) {\r\n        formData.append('invoice_file', invoiceFile);\r\n      }\r\n\r\n      await api('/api/projects/upload-invoice', {\r\n        method: 'POST',\r\n        body: formData\r\n      });\r\n\r\n      setShowInvoiceModal(false);\r\n      setSelectedProject(null);\r\n      setInvoiceFile(null);\r\n      setInvoiceData({\r\n        invoice_number: '',\r\n        invoice_date: new Date().toISOString().split('T')[0],\r\n        invoice_amount: '',\r\n        notes: ''\r\n      });\r\n\r\n      // Recargar datos\r\n      await fetchData();\r\n\r\n    } catch (error) {\r\n      setError('Error al subir factura: ' + (error.message || 'Error desconocido'));\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const openInvoiceModal = (project) => {\r\n    setSelectedProject(project);\r\n    const metrics = getProjectMetrics(project);\r\n    setInvoiceData(prev => ({\r\n      ...prev,\r\n      invoice_amount: metrics.totalAmount.toString()\r\n    }));\r\n    setShowInvoiceModal(true);\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <Container className=\"py-4\">\r\n        <div className=\"text-center\">\r\n          <Spinner animation=\"border\" />\r\n          <p className=\"mt-2\">Cargando proyectos para facturaci√≥n...</p>\r\n        </div>\r\n      </Container>\r\n    );\r\n  }\r\n\r\n  if (error) {\r\n    return (\r\n      <Container className=\"py-4\">\r\n        <Alert variant=\"danger\">\r\n          {error}\r\n        </Alert>\r\n      </Container>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <Container className=\"py-4\">\r\n      <Row className=\"mb-4\">\r\n        <Col>\r\n          <h2>üí∞ Facturaci√≥n de Proyectos</h2>\r\n          <p className=\"text-muted\">Proyectos listos para facturar</p>\r\n        </Col>\r\n        <Col md=\"auto\">\r\n          <Button variant=\"outline-secondary\" onClick={fetchData}>\r\n            <FiRefreshCw className=\"me-2\" />\r\n            Actualizar\r\n          </Button>\r\n        </Col>\r\n      </Row>\r\n\r\n      {/* Filtros */}\r\n      <Row className=\"mb-4\">\r\n        <Col md={3}>\r\n          <Form.Select\r\n            value={filters.status}\r\n            onChange={(e) => setFilters(prev => ({ ...prev, status: e.target.value }))}\r\n          >\r\n            <option value=\"\">Todos los estados</option>\r\n            <option value=\"pendiente\">Pendiente</option>\r\n            <option value=\"en_proceso\">En Proceso</option>\r\n            <option value=\"completado\">Completado</option>\r\n            <option value=\"sin_cotizaciones\">Sin Cotizaciones</option>\r\n          </Form.Select>\r\n        </Col>\r\n        <Col md={3}>\r\n          <Form.Control\r\n            type=\"text\"\r\n            placeholder=\"Filtrar por vendedor...\"\r\n            value={filters.vendedor}\r\n            onChange={(e) => setFilters(prev => ({ ...prev, vendedor: e.target.value }))}\r\n          />\r\n        </Col>\r\n        <Col md={3}>\r\n          <Form.Control\r\n            type=\"text\"\r\n            placeholder=\"Filtrar por cliente...\"\r\n            value={filters.cliente}\r\n            onChange={(e) => setFilters(prev => ({ ...prev, cliente: e.target.value }))}\r\n          />\r\n        </Col>\r\n        <Col md={3}>\r\n          <div className=\"d-flex gap-2\">\r\n            <Button\r\n              variant=\"outline-secondary\"\r\n              onClick={() => setFilters({ status: '', vendedor: '', cliente: '' })}\r\n            >\r\n              Limpiar\r\n            </Button>\r\n          </div>\r\n        </Col>\r\n      </Row>\r\n\r\n      {/* Resumen de m√©tricas */}\r\n      <Row className=\"mb-4\">\r\n        <Col md={3}>\r\n          <Card className=\"text-center\">\r\n            <Card.Body>\r\n              <FiFileText size={24} className=\"text-primary mb-2\" />\r\n              <h4>{projects.length}</h4>\r\n              <small className=\"text-muted\">Total Proyectos</small>\r\n            </Card.Body>\r\n          </Card>\r\n        </Col>\r\n        <Col md={3}>\r\n          <Card className=\"text-center\">\r\n            <Card.Body>\r\n              <FiTrendingUp size={24} className=\"text-success mb-2\" />\r\n              <h4>{projects.filter(p => getProjectStatus(p) === 'en_proceso').length}</h4>\r\n              <small className=\"text-muted\">En Proceso</small>\r\n            </Card.Body>\r\n          </Card>\r\n        </Col>\r\n        <Col md={3}>\r\n          <Card className=\"text-center\">\r\n            <Card.Body>\r\n              <FiDollarSign size={24} className=\"text-info mb-2\" />\r\n              <h4>S/ {projects.reduce((sum, p) => {\r\n                const metrics = getProjectMetrics(p);\r\n                return sum + metrics.totalAmount;\r\n              }, 0).toFixed(2)}</h4>\r\n              <small className=\"text-muted\">Monto Total</small>\r\n            </Card.Body>\r\n          </Card>\r\n        </Col>\r\n        <Col md={3}>\r\n          <Card className=\"text-center\">\r\n            <Card.Body>\r\n              <FiUser size={24} className=\"text-warning mb-2\" />\r\n              <h4>{new Set(projects.map(p => p.created_by_name)).size}</h4>\r\n              <small className=\"text-muted\">Vendedores Asignados</small>\r\n            </Card.Body>\r\n          </Card>\r\n        </Col>\r\n      </Row>\r\n\r\n      {/* Lista de proyectos */}\r\n      <Row>\r\n        {filteredProjects.length === 0 ? (\r\n          <Col>\r\n            <Card>\r\n              <Card.Body className=\"text-center py-5\">\r\n                <FiFileText size={48} className=\"text-muted mb-3\" />\r\n                <h5>No hay proyectos</h5>\r\n                <p className=\"text-muted\">\r\n                  {Object.values(filters).some(f => f) \r\n                    ? 'No se encontraron proyectos con los filtros aplicados'\r\n                    : 'No hay proyectos listos para facturar'\r\n                  }\r\n                </p>\r\n              </Card.Body>\r\n            </Card>\r\n          </Col>\r\n        ) : (\r\n          filteredProjects.map((project) => {\r\n            const metrics = getProjectMetrics(project);\r\n            const status = getProjectStatus(project);\r\n            const projectQuotes = quotes.filter(q => q.project_id === project.id);\r\n\r\n            return (\r\n              <Col key={project.id} md={6} lg={4} className=\"mb-3\">\r\n                <Card>\r\n                  <Card.Header className=\"d-flex justify-content-between align-items-center\">\r\n                    <strong>{project.name}</strong>\r\n                    {getStatusBadge(status)}\r\n                  </Card.Header>\r\n                  <Card.Body>\r\n                    <div className=\"mb-2\">\r\n                      <strong>Cliente:</strong> {project.company_name || 'N/A'}\r\n                    </div>\r\n                    <div className=\"mb-2\">\r\n                      <strong>Vendedor:</strong> {project.created_by_name || 'N/A'}\r\n                    </div>\r\n                    <div className=\"mb-2\">\r\n                      <strong>Ubicaci√≥n:</strong> {project.location || 'N/A'}\r\n                    </div>\r\n                    <div className=\"mb-2\">\r\n                      <strong>Descripci√≥n:</strong> {project.description || 'Sin descripci√≥n'}\r\n                    </div>\r\n                    \r\n                    <hr />\r\n                    \r\n                    <div className=\"mb-2\">\r\n                      <strong>Cotizaciones:</strong> {metrics.totalQuotes}\r\n                    </div>\r\n                    <div className=\"mb-2\">\r\n                      <strong>Monto Total:</strong> S/ {metrics.totalAmount.toFixed(2)}\r\n                    </div>\r\n                    <div className=\"mb-2\">\r\n                      <strong>√öltima Actividad:</strong> {metrics.lastActivity.toLocaleDateString()}\r\n                    </div>\r\n\r\n                    {projectQuotes.length > 0 && (\r\n                      <div className=\"mt-3\">\r\n                        <h6>Cotizaciones del Proyecto:</h6>\r\n                        <Table size=\"sm\">\r\n                          <thead>\r\n                            <tr>\r\n                              <th>N√∫mero</th>\r\n                              <th>Estado</th>\r\n                              <th>Monto</th>\r\n                            </tr>\r\n                          </thead>\r\n                          <tbody>\r\n                            {projectQuotes.map((quote) => (\r\n                              <tr key={quote.id}>\r\n                                <td>{quote.quote_number || `COT-${quote.id}`}</td>\r\n                                <td>{getStatusBadge(quote.status)}</td>\r\n                                <td>S/ {quote.total?.toFixed(2) || '0.00'}</td>\r\n                              </tr>\r\n                            ))}\r\n                          </tbody>\r\n                        </Table>\r\n                      </div>\r\n                    )}\r\n\r\n                    <div className=\"d-flex gap-2 mt-3\">\r\n                      <Button\r\n                        variant=\"outline-primary\"\r\n                        size=\"sm\"\r\n                        onClick={() => {\r\n                          // Navegar a detalles del proyecto\r\n                          window.location.href = `/proyectos/${project.id}`;\r\n                        }}\r\n                      >\r\n                        <FiEye className=\"me-1\" />\r\n                        Ver Detalles\r\n                      </Button>\r\n                      {status === 'en_proceso' && (\r\n                        <Button\r\n                          variant=\"success\"\r\n                          size=\"sm\"\r\n                          onClick={() => openInvoiceModal(project)}\r\n                        >\r\n                          <FiUpload className=\"me-1\" />\r\n                          Adjuntar Factura\r\n                        </Button>\r\n                      )}\r\n                    </div>\r\n                  </Card.Body>\r\n                </Card>\r\n              </Col>\r\n            );\r\n          })\r\n        )}\r\n      </Row>\r\n\r\n      {/* Modal para adjuntar factura */}\r\n      <Modal show={showInvoiceModal} onHide={() => setShowInvoiceModal(false)} size=\"lg\">\r\n        <Modal.Header closeButton>\r\n          <Modal.Title>Adjuntar Factura</Modal.Title>\r\n        </Modal.Header>\r\n        <Modal.Body>\r\n          {selectedProject && (\r\n            <div className=\"mb-3\">\r\n              <h6>Proyecto: {selectedProject.name}</h6>\r\n              <p className=\"text-muted\">Cliente: {selectedProject.company_name}</p>\r\n            </div>\r\n          )}\r\n          \r\n          <Row>\r\n            <Col md={6}>\r\n              <Form.Group className=\"mb-3\">\r\n                <Form.Label>N√∫mero de Factura *</Form.Label>\r\n                <Form.Control\r\n                  type=\"text\"\r\n                  value={invoiceData.invoice_number}\r\n                  onChange={(e) => setInvoiceData(prev => ({ ...prev, invoice_number: e.target.value }))}\r\n                  required\r\n                />\r\n              </Form.Group>\r\n            </Col>\r\n            <Col md={6}>\r\n              <Form.Group className=\"mb-3\">\r\n                <Form.Label>Fecha de Factura *</Form.Label>\r\n                <Form.Control\r\n                  type=\"date\"\r\n                  value={invoiceData.invoice_date}\r\n                  onChange={(e) => setInvoiceData(prev => ({ ...prev, invoice_date: e.target.value }))}\r\n                  required\r\n                />\r\n              </Form.Group>\r\n            </Col>\r\n          </Row>\r\n          \r\n          <Row>\r\n            <Col md={6}>\r\n              <Form.Group className=\"mb-3\">\r\n                <Form.Label>Monto de Factura (S/) *</Form.Label>\r\n                <Form.Control\r\n                  type=\"number\"\r\n                  step=\"0.01\"\r\n                  value={invoiceData.invoice_amount}\r\n                  onChange={(e) => setInvoiceData(prev => ({ ...prev, invoice_amount: e.target.value }))}\r\n                  required\r\n                />\r\n              </Form.Group>\r\n            </Col>\r\n            <Col md={6}>\r\n              <Form.Group className=\"mb-3\">\r\n                <Form.Label>Archivo de Factura</Form.Label>\r\n                <Form.Control\r\n                  type=\"file\"\r\n                  accept=\".pdf,.jpg,.jpeg,.png\"\r\n                  onChange={(e) => setInvoiceFile(e.target.files[0])}\r\n                />\r\n              </Form.Group>\r\n            </Col>\r\n          </Row>\r\n          \r\n          <Row>\r\n            <Col>\r\n              <Form.Group className=\"mb-3\">\r\n                <Form.Label>Notas</Form.Label>\r\n                <Form.Control\r\n                  as=\"textarea\"\r\n                  rows={3}\r\n                  value={invoiceData.notes}\r\n                  onChange={(e) => setInvoiceData(prev => ({ ...prev, notes: e.target.value }))}\r\n                />\r\n              </Form.Group>\r\n            </Col>\r\n          </Row>\r\n        </Modal.Body>\r\n        <Modal.Footer>\r\n          <Button variant=\"secondary\" onClick={() => setShowInvoiceModal(false)}>\r\n            Cancelar\r\n          </Button>\r\n          <Button variant=\"success\" onClick={handleInvoiceUpload} disabled={loading}>\r\n            {loading ? (\r\n              <>\r\n                <Spinner size=\"sm\" className=\"me-2\" />\r\n                Subiendo...\r\n              </>\r\n            ) : (\r\n              <>\r\n                <FiUpload className=\"me-2\" />\r\n                Adjuntar Factura\r\n              </>\r\n            )}\r\n          </Button>\r\n        </Modal.Footer>\r\n      </Modal>\r\n    </Container>\r\n  );\r\n};\r\n\r\nexport default FacturacionProyectos;\r\n"],"names":["FacturacionProyectos","user","useAuth","projects","setProjects","useState","quotes","setQuotes","loading","setLoading","error","setError","filters","setFilters","showInvoiceModal","setShowInvoiceModal","selectedProject","setSelectedProject","invoiceFile","setInvoiceFile","invoiceData","setInvoiceData","useEffect","fetchData","projectsData","api","quotesData","getStatusBadge","status","config","Badge","getProjectStatus","project","projectQuotes","q","getProjectMetrics","sum","filteredProjects","_a","_b","handleInvoiceUpload","formData","openInvoiceModal","metrics","prev","Container","jsxs","jsx","Spinner","Alert","Row","Col","Button","FiRefreshCw","Form","e","Card","FiFileText","FiTrendingUp","p","FiDollarSign","FiUser","f","Table","quote","FiEye","FiUpload","Modal","Fragment"],"mappings":"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"}