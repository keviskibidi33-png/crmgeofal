{"version":3,"file":"companies-DRAjyTKu.js","sources":["../../src/services/companies.js"],"sourcesContent":["import { apiFetch } from './api';\r\n\r\nexport const listCompanies = (params = {}) => {\r\n  const sp = new URLSearchParams();\r\n  if (params.page) sp.set('page', params.page);\r\n  if (params.limit) sp.set('limit', params.limit);\r\n  if (params.search) sp.set('search', params.search);\r\n  if (params.type) sp.set('type', params.type);\r\n  if (params.city) sp.set('city', params.city);\r\n  if (params.sector) sp.set('sector', params.sector);\r\n  \r\n  // Agregar timestamp para evitar cache del navegador\r\n  sp.set('_t', Date.now().toString());\r\n  \r\n  const qs = sp.toString();\r\n  const path = qs ? `/api/companies?${qs}` : '/api/companies';\r\n  \r\n  console.log('🔍 listCompanies - Llamando a:', path);\r\n  console.log('🔍 listCompanies - Token:', localStorage.getItem('token') ? 'Presente' : 'Ausente');\r\n  \r\n  return apiFetch(path).then(data => {\r\n    console.log('✅ listCompanies - Respuesta recibida:', data);\r\n    return data;\r\n  }).catch(error => {\r\n    console.error('❌ listCompanies - Error:', error);\r\n    throw error;\r\n  });\r\n};\r\n\r\nexport const listCompaniesWithTotals = (params = {}) => {\r\n  const sp = new URLSearchParams();\r\n  if (params.page) sp.set('page', params.page);\r\n  if (params.limit) sp.set('limit', params.limit);\r\n  if (params.search) sp.set('search', params.search);\r\n  if (params.type) sp.set('type', params.type);\r\n  if (params.city) sp.set('city', params.city);\r\n  if (params.sector) sp.set('sector', params.sector);\r\n  if (params.status) sp.set('status', params.status);\r\n  if (params.priority) sp.set('priority', params.priority);\r\n  if (params.sortBy) sp.set('sortBy', params.sortBy);\r\n  if (params.sortOrder) sp.set('sortOrder', params.sortOrder);\r\n  \r\n  // Incluir totales\r\n  sp.set('includeTotals', 'true');\r\n  \r\n  // Agregar timestamp para evitar cache del navegador\r\n  sp.set('_t', Date.now().toString());\r\n  \r\n  const qs = sp.toString();\r\n  const path = qs ? `/api/companies?${qs}` : '/api/companies';\r\n  \r\n  console.log('💰 listCompaniesWithTotals - Llamando a:', path);\r\n  console.log('💰 listCompaniesWithTotals - Token:', localStorage.getItem('token') ? 'Presente' : 'Ausente');\r\n  \r\n  return apiFetch(path).then(data => {\r\n    console.log('✅ listCompaniesWithTotals - Respuesta recibida:', data);\r\n    return data;\r\n  }).catch(error => {\r\n    console.error('❌ listCompaniesWithTotals - Error:', error);\r\n    throw error;\r\n  });\r\n};\r\n\r\nexport const getCompany = (id) => apiFetch(`/api/companies/${id}`);\r\nexport const getCompanyById = (id) => apiFetch(`/api/companies/${id}`);\r\n\r\nexport const getCompanyWithTotals = (id) => {\r\n  console.log('💰 getCompanyWithTotals - Obteniendo cliente con totales:', id);\r\n  return apiFetch(`/api/companies/${id}?includeTotals=true`);\r\n};\r\n\r\nexport const getCompanyStats = () => {\r\n  console.log('📊 getCompanyStats - Llamando a: /api/companies/stats');\r\n  console.log('📊 getCompanyStats - Token:', localStorage.getItem('token') ? 'Presente' : 'Ausente');\r\n  \r\n  return apiFetch('/api/companies/stats').then(data => {\r\n    console.log('✅ getCompanyStats - Respuesta recibida:', data);\r\n    return data;\r\n  }).catch(error => {\r\n    console.error('❌ getCompanyStats - Error:', error);\r\n    throw error;\r\n  });\r\n};\r\n\r\nexport const getCompanyFilterOptions = () => {\r\n  console.log('🔍 getCompanyFilterOptions - Llamando a: /api/companies/filter-options');\r\n  console.log('🔍 getCompanyFilterOptions - Token:', localStorage.getItem('token') ? 'Presente' : 'Ausente');\r\n  \r\n  return apiFetch('/api/companies/filter-options').then(data => {\r\n    console.log('✅ getCompanyFilterOptions - Respuesta recibida:', {\r\n      success: data.success,\r\n      hasData: !!data.data,\r\n      dataKeys: data.data ? Object.keys(data.data) : [],\r\n      typesCount: data.data?.types?.length || 0,\r\n      sectorsCount: data.data?.sectors?.length || 0,\r\n      citiesCount: data.data?.cities?.length || 0\r\n    });\r\n    return data;\r\n  }).catch(error => {\r\n    console.error('❌ getCompanyFilterOptions - Error:', error);\r\n    throw error;\r\n  });\r\n};\r\n\r\nexport const createCompany = (payload) =>\r\n  apiFetch('/api/companies', {\r\n    method: 'POST',\r\n    body: JSON.stringify(payload),\r\n  });\r\n\r\nexport const getOrCreateCompany = (payload) => {\r\n  console.log('🔍 getOrCreateCompany - Llamando a: /api/companies/get-or-create');\r\n  console.log('🔍 getOrCreateCompany - Payload:', payload);\r\n  \r\n  return apiFetch('/api/companies/get-or-create', {\r\n    method: 'POST',\r\n    body: JSON.stringify(payload),\r\n  }).then(data => {\r\n    console.log('✅ getOrCreateCompany - Respuesta recibida:', data);\r\n    return data;\r\n  }).catch(error => {\r\n    console.error('❌ getOrCreateCompany - Error:', error);\r\n    throw error;\r\n  });\r\n};\r\n\r\nexport const updateCompany = (id, payload) => {\r\n  console.log('📝 updateCompany - Actualizando cliente:', id, payload);\r\n  return apiFetch(`/api/companies/${id}`, {\r\n    method: 'PUT',\r\n    body: JSON.stringify(payload),\r\n  }).then(response => {\r\n    console.log('✅ updateCompany - Cliente actualizado:', response);\r\n    return response;\r\n  }).catch(error => {\r\n    console.error('❌ updateCompany - Error:', error);\r\n    throw error;\r\n  });\r\n};\r\n\r\nexport const deleteCompany = (id) =>\r\n  apiFetch(`/api/companies/${id}`, {\r\n    method: 'DELETE',\r\n  });\r\n\r\nexport const updateClientStatus = (id, status) => {\r\n  console.log(`🔄 updateClientStatus - Llamando a: /api/companies/${id}/status`);\r\n  console.log(`🔄 updateClientStatus - Estado: ${status}`);\r\n  console.log(`🔄 updateClientStatus - Token:`, localStorage.getItem('token') ? 'Presente' : 'Ausente');\r\n  \r\n  return apiFetch(`/api/companies/${id}/status`, {\r\n    method: 'PATCH',\r\n    body: JSON.stringify({ status }),\r\n  }).then(data => {\r\n    console.log('✅ updateClientStatus - Respuesta recibida:', data);\r\n    return data;\r\n  }).catch(error => {\r\n    console.error('❌ updateClientStatus - Error:', error);\r\n    throw error;\r\n  });\r\n};\r\n\r\nexport const updateClientManager = (id, managed_by) =>\r\n  apiFetch(`/api/companies/${id}/manager`, {\r\n    method: 'PATCH',\r\n    body: JSON.stringify({ managed_by }),\r\n  });\r\n\r\nexport const getClientHistory = (id) =>\r\n  apiFetch(`/api/companies/${id}/history`);\r\n\r\nexport default { \r\n  listCompanies, \r\n  getCompany, \r\n  createCompany, \r\n  updateCompany, \r\n  deleteCompany,\r\n  updateClientStatus,\r\n  updateClientManager,\r\n  getClientHistory\r\n};\r\n"],"names":["listCompanies","params","sp","qs","path","apiFetch","data","error","listCompaniesWithTotals","getCompanyById","id","getCompanyWithTotals","getCompanyStats","getCompanyFilterOptions","_b","_a","_d","_c","_f","_e","createCompany","payload","getOrCreateCompany","updateCompany","response","deleteCompany","updateClientStatus","status","getClientHistory"],"mappings":"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"}