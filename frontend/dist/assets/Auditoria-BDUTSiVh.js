import{r as C,az as Qe,j as e,aA as Ve,b as k,e as K,a2 as W,B as f,z as V,Q as fe,a1 as pe,C as y,o as M,m as we,aa as ge,n as R,N as O,K as We,l as B,_ as D,I as ee,J as q,G as _,H as Ne,aB as ve,X as Ae,T as Xe,h as se,ao as Ce,ay as Ke,c as Ye,x as Ze,A as le,f as Se,aC as es,y as ye}from"./index-CDayYYh0.js";import{a as ss}from"./users-DCI6J8CV.js";import{P as as}from"./PageHeader-TwGN4X1N.js";import{C as l}from"./Card-DxGUdTXm.js";import{R as T}from"./Row-CeY1UBxE.js";import{C as h}from"./Col-Bcdl2XMD.js";import{F as m}from"./Form-CukTEVnv.js";import{I as H}from"./InputGroup-BfugZ8Gm.js";import{M as U}from"./Modal-DfQWsS-G.js";import{L as I}from"./ListGroup-CR-eR_Zo.js";import{A as ae}from"./Alert-pvqi0VvY.js";import{P as X}from"./ProgressBar-8Pr9xEDL.js";import{S as te}from"./Spinner-BFSKMpy4.js";import"./ElementChildren-DjJrrPtR.js";const de=C.forwardRef(({bsPrefix:s,size:n,vertical:t=!1,className:c,role:g="group",as:N="div",...b},u)=>{const j=Qe(s,"btn-group");let p=j;return t&&(p=`${j}-vertical`),e.jsx(N,{...b,ref:u,role:g,className:Ve(c,p,n&&`${j}-${n}`)})});de.displayName="ButtonGroup";const Ee=(s={})=>{const n=new URLSearchParams;s.page&&n.set("page",s.page),s.limit&&n.set("limit",s.limit),s.search&&n.set("search",s.search),s.action&&s.action!=="all"&&n.set("action",s.action),s.user&&s.user!=="all"&&n.set("user",s.user),s.date&&s.date!=="all"&&n.set("date",s.date),s.dateStart&&n.set("dateStart",s.dateStart),s.dateEnd&&n.set("dateEnd",s.dateEnd),s.timeStart&&n.set("timeStart",s.timeStart),s.timeEnd&&n.set("timeEnd",s.timeEnd);const t=n.toString(),c=t?`/api/audit?${t}`:"/api/audit";return k(c)},ts=async(s,n)=>await k(`/api/audit/${s}`,{method:"PUT",body:JSON.stringify(n)}),ns=async s=>await k(`/api/audit/${s}`,{method:"DELETE"}),rs=async s=>await k("/api/audit/bulk-delete",{method:"POST",body:JSON.stringify({ids:s})}),is=async s=>await k("/api/audit/archive",{method:"POST",body:JSON.stringify({ids:s})}),cs=async(s={})=>{const n=new URLSearchParams;return Object.keys(s).forEach(c=>{s[c]&&s[c]!=="all"&&n.append(c,s[c])}),await k(`/api/audit/analytics?${n.toString()}`)},ls=async()=>await k("/api/audit/active-users"),ds=async(s=24)=>await k("/api/audit/cleanup",{method:"POST",body:JSON.stringify({hours:s})}),os=async()=>await k("/api/audit/cleanup-stats"),ms=async(s=24)=>await k(`/api/audit/hourly-distribution?hours=${s}`),xs=()=>K(["audit-stats-global"],async()=>{try{const[s,n]=await Promise.all([cs().catch(()=>null),ls().catch(()=>null)]);if(s&&s.data)return{...s.data,activeUsers:(n==null?void 0:n.data)||[]};const t=await Ee({page:1,limit:1e4}),c=Array.isArray(t==null?void 0:t.data)?t.data:(t==null?void 0:t.rows)||t||[],g=Number((t==null?void 0:t.total)||c.length||0),N=new Date;N.setHours(0,0,0,0);const b=c.filter(d=>new Date(d.performed_at||d.created_at)>=N).length,u=[...new Set(c.map(d=>d.user_name||d.performed_by||d.user_id))].length,j=[...new Set(c.map(d=>d.action))].length,p=c.reduce((d,F)=>(d[F.action]=(d[F.action]||0)+1,d),{}),x=Object.entries(p).reduce((d,F)=>p[d[0]]>p[F[0]]?d:F,["N/A",0]),i=new Date;i.setHours(i.getHours()-24);const w=c.filter(d=>new Date(d.performed_at||d.created_at)>=i).length,A=new Date;A.setDate(A.getDate()-7);const z=c.filter(d=>new Date(d.performed_at||d.created_at)>=A).length,o=(n==null?void 0:n.data)||[];return{total:g,todayActivities:b,uniqueUsers:u,uniqueActions:j,mostCommonAction:x[0],mostCommonCount:x[1],recentActivities:w,weekActivities:z,actionCounts:p,activeUsers:o}}catch(s){return console.error("Error obteniendo estadísticas:",s),{total:0,todayActivities:0,uniqueUsers:0,uniqueActions:0,mostCommonAction:"N/A",mostCommonCount:0,recentActivities:0,weekActivities:0,actionCounts:{},activeUsers:[]}}},{staleTime:0,cacheTime:1*60*1e3,refetchOnWindowFocus:!0,refetchOnMount:!0}),be=async(s={})=>{const n=new URLSearchParams;return Object.keys(s).forEach(c=>{s[c]&&s[c]!=="all"&&n.append(c,s[c])}),await k(`/api/audit/export/excel?${n.toString()}`,{method:"GET",responseType:"blob"})},hs=async(s={})=>{const n=new URLSearchParams;return Object.keys(s).forEach(c=>{s[c]&&s[c]!=="all"&&n.append(c,s[c])}),await k(`/api/audit/export/pdf?${n.toString()}`,{method:"GET",responseType:"blob"})},us=async(s={})=>{const n=new URLSearchParams;return Object.keys(s).forEach(c=>{s[c]&&s[c]!=="all"&&n.append(c,s[c])}),await k(`/api/audit/export/csv?${n.toString()}`,{method:"GET",responseType:"blob"})},Z=(s,n)=>{const t=window.URL.createObjectURL(s),c=document.createElement("a");c.href=t,c.download=n,document.body.appendChild(c),c.click(),document.body.removeChild(c),window.URL.revokeObjectURL(t)};function js({filters:s,onFiltersChange:n,onClearFilters:t,uniqueUsers:c=[],uniqueActions:g=[]}){const[N,b]=C.useState(!1),u=(i,w)=>{n({...s,[i]:w})},j=(i,w)=>{const A={...s};i==="start"?A.dateStart=w:i==="end"&&(A.dateEnd=w),n(A)},x=(()=>{let i=0;return s.search&&s.search!==""&&i++,s.action&&s.action!=="all"&&i++,s.user&&s.user!=="all"&&i++,s.dateStart&&i++,s.dateEnd&&i++,s.dateRange&&s.dateRange!=="all"&&i++,i})();return e.jsxs(l,{className:"mb-4",children:[e.jsxs(l.Header,{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("h6",{className:"mb-0",children:[e.jsx(W,{className:"me-2"}),"Filtros de Auditoría",x>0&&e.jsxs(y,{bg:"primary",className:"ms-2",children:[x," activos"]})]}),e.jsxs("div",{children:[e.jsxs(f,{variant:"outline-secondary",size:"sm",onClick:()=>b(!N),className:"me-2",children:[e.jsx(V,{className:"me-1"}),N?"Ocultar":"Avanzados"]}),x>0&&e.jsxs(f,{variant:"outline-danger",size:"sm",onClick:t,children:[e.jsx(M,{className:"me-1"}),"Limpiar"]})]})]}),e.jsxs(l.Body,{children:[e.jsxs(T,{className:"mb-3",children:[e.jsx(h,{md:4,children:e.jsxs(m.Group,{children:[e.jsx(m.Label,{children:"Buscar:"}),e.jsxs(H,{children:[e.jsx(H.Text,{children:e.jsx(fe,{})}),e.jsx(m.Control,{type:"text",placeholder:"Buscar en auditoría...",value:s.search||"",onChange:i=>u("search",i.target.value)})]})]})}),e.jsx(h,{md:2,children:e.jsxs(m.Group,{children:[e.jsx(m.Label,{children:"Acción:"}),e.jsxs(m.Select,{value:s.action||"all",onChange:i=>u("action",i.target.value),children:[e.jsx("option",{value:"all",children:"Todas"}),g.map(i=>e.jsx("option",{value:i,children:i},i))]})]})}),e.jsx(h,{md:2,children:e.jsxs(m.Group,{children:[e.jsx(m.Label,{children:"Usuario:"}),e.jsxs(m.Select,{value:s.user||"all",onChange:i=>u("user",i.target.value),children:[e.jsx("option",{value:"all",children:"Todos"}),c.map(i=>e.jsx("option",{value:i,children:i},i))]})]})}),e.jsx(h,{md:2,children:e.jsxs(m.Group,{children:[e.jsx(m.Label,{children:"Rango de Fecha:"}),e.jsxs(m.Select,{value:s.dateRange||"all",onChange:i=>u("dateRange",i.target.value),children:[e.jsx("option",{value:"all",children:"Todas"}),e.jsx("option",{value:"today",children:"Hoy"}),e.jsx("option",{value:"yesterday",children:"Ayer"}),e.jsx("option",{value:"week",children:"Esta semana"}),e.jsx("option",{value:"month",children:"Este mes"}),e.jsx("option",{value:"quarter",children:"Este trimestre"}),e.jsx("option",{value:"year",children:"Este año"}),e.jsx("option",{value:"custom",children:"Personalizado"})]})]})}),e.jsx(h,{md:2,className:"d-flex align-items-end",children:e.jsx(de,{className:"w-100",children:e.jsxs(f,{variant:"outline-primary",onClick:()=>b(!N),children:[e.jsx(W,{className:"me-1"}),N?"Menos":"Más"]})})})]}),N&&e.jsxs(T,{className:"border-top pt-3",children:[e.jsx(h,{md:3,children:e.jsxs(m.Group,{children:[e.jsx(m.Label,{children:"Fecha Inicio:"}),e.jsxs(H,{children:[e.jsx(H.Text,{children:e.jsx(pe,{})}),e.jsx(m.Control,{type:"date",value:s.dateStart||"",onChange:i=>j("start",i.target.value)})]})]})}),e.jsx(h,{md:3,children:e.jsxs(m.Group,{children:[e.jsx(m.Label,{children:"Fecha Fin:"}),e.jsxs(H,{children:[e.jsx(H.Text,{children:e.jsx(pe,{})}),e.jsx(m.Control,{type:"date",value:s.dateEnd||"",onChange:i=>j("end",i.target.value)})]})]})}),e.jsx(h,{md:2,children:e.jsxs(m.Group,{children:[e.jsx(m.Label,{children:"Hora Inicio:"}),e.jsx(m.Control,{type:"time",value:s.timeStart||"",onChange:i=>u("timeStart",i.target.value)})]})}),e.jsx(h,{md:2,children:e.jsxs(m.Group,{children:[e.jsx(m.Label,{children:"Hora Fin:"}),e.jsx(m.Control,{type:"time",value:s.timeEnd||"",onChange:i=>u("timeEnd",i.target.value)})]})}),e.jsx(h,{md:2,className:"d-flex align-items-end",children:e.jsxs(f,{variant:"outline-success",className:"w-100",onClick:()=>{console.log("Aplicando filtros personalizados...")},children:[e.jsx(W,{className:"me-1"}),"Aplicar"]})})]}),x>0&&e.jsx(T,{className:"mt-3",children:e.jsx(h,{children:e.jsxs("div",{className:"d-flex flex-wrap gap-2",children:[e.jsx("small",{className:"text-muted me-2",children:"Filtros activos:"}),s.search&&e.jsxs(y,{bg:"info",className:"d-flex align-items-center",children:["Búsqueda: ",s.search,e.jsx(M,{className:"ms-1",style:{cursor:"pointer"},onClick:()=>u("search","")})]}),s.action&&s.action!=="all"&&e.jsxs(y,{bg:"primary",className:"d-flex align-items-center",children:["Acción: ",s.action,e.jsx(M,{className:"ms-1",style:{cursor:"pointer"},onClick:()=>u("action","all")})]}),s.user&&s.user!=="all"&&e.jsxs(y,{bg:"success",className:"d-flex align-items-center",children:["Usuario: ",s.user,e.jsx(M,{className:"ms-1",style:{cursor:"pointer"},onClick:()=>u("user","all")})]}),s.dateStart&&e.jsxs(y,{bg:"warning",className:"d-flex align-items-center",children:["Desde: ",s.dateStart,e.jsx(M,{className:"ms-1",style:{cursor:"pointer"},onClick:()=>u("dateStart","")})]}),s.dateEnd&&e.jsxs(y,{bg:"warning",className:"d-flex align-items-center",children:["Hasta: ",s.dateEnd,e.jsx(M,{className:"ms-1",style:{cursor:"pointer"},onClick:()=>u("dateEnd","")})]})]})})})]})]})}function ps({show:s,onHide:n,auditRecord:t,onExport:c,onEdit:g,onDelete:N}){if(!t)return null;const b=x=>x?new Date(x).toLocaleString("es-ES",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"}):"—",u=x=>{switch(x){case"crear":case"create":return e.jsx(ee,{className:"text-success"});case"actualizar":case"update":return e.jsx(ee,{className:"text-primary"});case"eliminar":case"delete":return e.jsx(q,{className:"text-danger"});case"login":return e.jsx(R,{className:"text-info"});case"logout":return e.jsx(R,{className:"text-secondary"});case"actualizar_estado":return e.jsx(B,{className:"text-warning"});case"actualizar_categorias":return e.jsx(B,{className:"text-info"});default:return e.jsx(B,{className:"text-muted"})}},j=x=>{switch(x){case"crear":case"create":return"success";case"actualizar":case"update":return"primary";case"eliminar":case"delete":return"danger";case"login":return"info";case"logout":return"secondary";case"actualizar_estado":return"warning";case"actualizar_categorias":return"info";default:return"dark"}},p=x=>({crear:"creó",create:"creó",actualizar:"actualizó",update:"actualizó",eliminar:"eliminó",delete:"eliminó",login:"inició sesión",logout:"cerró sesión",actualizar_estado:"actualizó el estado",actualizar_categorias:"actualizó las categorías",marcar_proyecto:"marcó el proyecto",exportar:"exportó",importar:"importó",configurar:"configuró",asignar:"asignó",desasignar:"desasignó"})[x]||x;return e.jsxs(U,{show:s,onHide:n,size:"lg",centered:!0,children:[e.jsx(U.Header,{closeButton:!0,children:e.jsxs(U.Title,{children:[e.jsx(we,{className:"me-2"}),"Detalles de Auditoría"]})}),e.jsxs(U.Body,{children:[e.jsxs(T,{children:[e.jsx(h,{md:8,children:e.jsxs(l,{className:"mb-3",children:[e.jsx(l.Header,{children:e.jsxs("h6",{className:"mb-0",children:[e.jsx(ge,{className:"me-2"}),"Información del Registro"]})}),e.jsx(l.Body,{children:e.jsxs(T,{children:[e.jsxs(h,{md:6,children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"ID del Registro:"}),e.jsxs("div",{className:"text-muted",children:["#",t.id]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"Acción Realizada:"}),e.jsxs("div",{className:"d-flex align-items-center mt-1",children:[u(t.action),e.jsx(y,{bg:j(t.action),className:"ms-2",children:p(t.action)})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"Usuario:"}),e.jsxs("div",{className:"d-flex align-items-center mt-1",children:[e.jsx(R,{className:"me-2 text-muted"}),e.jsx("span",{children:t.user_name||t.performed_by||t.user_id||"Sistema"})]})]})]}),e.jsxs(h,{md:6,children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"Fecha y Hora:"}),e.jsxs("div",{className:"d-flex align-items-center mt-1",children:[e.jsx(O,{className:"me-2 text-muted"}),e.jsx("span",{children:b(t.performed_at||t.created_at)})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"IP del Usuario:"}),e.jsx("div",{className:"text-muted",children:t.ip_address||"No disponible"})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"User Agent:"}),e.jsx("div",{className:"text-muted small",children:t.user_agent||"No disponible"})]})]})]})})]})}),e.jsx(h,{md:4,children:e.jsxs(l,{className:"mb-3",children:[e.jsx(l.Header,{children:e.jsxs("h6",{className:"mb-0",children:[e.jsx(We,{className:"me-2"}),"Contexto"]})}),e.jsx(l.Body,{children:e.jsxs(I,{variant:"flush",children:[e.jsxs(I.Item,{className:"d-flex justify-content-between",children:[e.jsx("span",{children:"Módulo:"}),e.jsx(y,{bg:"info",children:t.module||"Sistema"})]}),e.jsxs(I.Item,{className:"d-flex justify-content-between",children:[e.jsx("span",{children:"Entidad:"}),e.jsx(y,{bg:"secondary",children:t.entity||"N/A"})]}),e.jsxs(I.Item,{className:"d-flex justify-content-between",children:[e.jsx("span",{children:"ID Entidad:"}),e.jsx(y,{bg:"light",text:"dark",children:t.entity_id||"N/A"})]}),e.jsxs(I.Item,{className:"d-flex justify-content-between",children:[e.jsx("span",{children:"Estado:"}),e.jsx(y,{bg:"success",children:"Completado"})]})]})})]})})]}),e.jsxs(l,{children:[e.jsx(l.Header,{children:e.jsxs("h6",{className:"mb-0",children:[e.jsx(B,{className:"me-2"}),"Detalles Adicionales"]})}),e.jsxs(l.Body,{children:[t.notes?e.jsxs("div",{children:[e.jsx("strong",{children:"Notas:"}),e.jsx("div",{className:"mt-2 p-3 bg-light rounded",children:t.notes})]}):e.jsxs(ae,{variant:"info",className:"mb-0",children:[e.jsx(ge,{className:"me-2"}),"No hay notas adicionales para este registro."]}),t.changes&&e.jsxs("div",{className:"mt-3",children:[e.jsx("strong",{children:"Cambios Realizados:"}),e.jsx("div",{className:"mt-2",children:e.jsx("pre",{className:"bg-light p-3 rounded small",children:JSON.stringify(t.changes,null,2)})})]})]})]})]}),e.jsxs(U.Footer,{children:[e.jsxs(f,{variant:"outline-secondary",onClick:n,children:[e.jsx(M,{className:"me-1"}),"Cerrar"]}),e.jsxs(f,{variant:"outline-primary",onClick:()=>c&&c(t),children:[e.jsx(D,{className:"me-1"}),"Exportar"]}),g&&e.jsxs(f,{variant:"outline-warning",onClick:()=>g(t),children:[e.jsx(ee,{className:"me-1"}),"Editar"]}),N&&e.jsxs(f,{variant:"outline-danger",onClick:()=>N(t),children:[e.jsx(q,{className:"me-1"}),"Eliminar"]})]})]})}function gs({selectedItems:s=[],onBulkExport:n,onBulkDelete:t,onBulkArchive:c,onClearSelection:g}){const[N,b]=C.useState(!1),[u,j]=C.useState(null),[p,x]=C.useState(!1),[i,w]=C.useState(0),A=s.length,z=async S=>{A!==0&&(j(S),b(!0))},o=async()=>{if(u){x(!0),w(0);try{const S=setInterval(()=>{w(L=>L>=100?(clearInterval(S),x(!1),b(!1),j(null),100):L+10)},200);switch(u){case"export":await(n==null?void 0:n(s));break;case"delete":await(t==null?void 0:t(s));break;case"archive":await(c==null?void 0:c(s));break}g==null||g()}catch(S){console.error("Error en acción masiva:",S),x(!1)}}},d=S=>{switch(S){case"export":return"Exportar Registros Seleccionados";case"delete":return"Eliminar Registros Seleccionados";case"archive":return"Archivar Registros Seleccionados";default:return"Acción Masiva"}},F=S=>{switch(S){case"export":return`Se exportarán ${A} registros de auditoría en formato Excel.`;case"delete":return`Se eliminarán permanentemente ${A} registros de auditoría. Esta acción no se puede deshacer.`;case"archive":return`Se archivarán ${A} registros de auditoría. Los registros archivados no aparecerán en las búsquedas normales.`;default:return""}},ne=S=>{switch(S){case"export":return e.jsx(D,{className:"text-success"});case"delete":return e.jsx(q,{className:"text-danger"});case"archive":return e.jsx(ve,{className:"text-warning"});default:return e.jsx(Ne,{})}};return A===0?null:e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"d-flex align-items-center gap-2 mb-3",children:[e.jsxs(y,{bg:"primary",className:"fs-6",children:[A," seleccionado",A!==1?"s":""]}),e.jsxs(_,{children:[e.jsxs(_.Toggle,{variant:"outline-primary",size:"sm",children:[e.jsx(Ne,{className:"me-1"}),"Acciones Masivas"]}),e.jsxs(_.Menu,{children:[e.jsxs(_.Item,{onClick:()=>z("export"),children:[e.jsx(D,{className:"me-2"}),"Exportar Seleccionados"]}),e.jsxs(_.Item,{onClick:()=>z("archive"),children:[e.jsx(ve,{className:"me-2"}),"Archivar Seleccionados"]}),e.jsx(_.Divider,{}),e.jsxs(_.Item,{onClick:()=>z("delete"),className:"text-danger",children:[e.jsx(q,{className:"me-2"}),"Eliminar Seleccionados"]})]})]}),e.jsxs(f,{variant:"outline-secondary",size:"sm",onClick:g,children:[e.jsx(M,{className:"me-1"}),"Limpiar Selección"]})]}),e.jsxs(U,{show:N,onHide:()=>b(!1),centered:!0,children:[e.jsx(U.Header,{closeButton:!0,children:e.jsxs(U.Title,{children:[ne(u),e.jsx("span",{className:"ms-2",children:d(u)})]})}),e.jsxs(U.Body,{children:[e.jsxs(ae,{variant:"info",className:"mb-3",children:[e.jsx(Ae,{className:"me-2"}),F(u)]}),p&&e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"d-flex justify-content-between mb-2",children:[e.jsx("span",{children:"Procesando..."}),e.jsxs("span",{children:[i,"%"]})]}),e.jsx(X,{now:i,animated:!0})]}),e.jsxs("div",{className:"text-muted small",children:[e.jsx("strong",{children:"Registros seleccionados:"}),e.jsxs("ul",{className:"mt-2 mb-0",children:[s.slice(0,5).map((S,L)=>e.jsxs("li",{children:["#",S.id," - ",S.action," - ",S.user_name||S.user_id]},L)),s.length>5&&e.jsxs("li",{children:["... y ",s.length-5," más"]})]})]})]}),e.jsxs(U.Footer,{children:[e.jsxs(f,{variant:"outline-secondary",onClick:()=>b(!1),disabled:p,children:[e.jsx(M,{className:"me-1"}),"Cancelar"]}),e.jsx(f,{variant:u==="delete"?"danger":"primary",onClick:o,disabled:p,children:p?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"spinner-border spinner-border-sm me-1",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Procesando..."})}),"Procesando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Xe,{className:"me-1"}),"Confirmar"]})})]})]})]})}function Ns({analyticsData:s={},isLoading:n=!1}){const{total:t=0,todayActivities:c=0,weekActivities:g=0,uniqueUsers:N=0,uniqueActions:b=0,recentActivities:u=0,actionCounts:j={},activeUsers:p=[]}=s,{data:x,isLoading:i}=K(["audit-hourly-distribution"],()=>ms(24),{staleTime:5*60*1e3,cacheTime:10*60*1e3}),w=Object.entries(j).map(([o,d])=>({name:o,count:d})).sort((o,d)=>d.count-o.count).slice(0,5),A=p.map(o=>({name:o.name||o.user_name||o.username||`Usuario ${o.id}`,actions:o.action_count||0})).sort((o,d)=>d.actions-o.actions).slice(0,5),z=(x==null?void 0:x.data)||Array.from({length:24},(o,d)=>({hour:d,count:0}));return n?e.jsx(T,{children:[1,2,3,4].map(o=>e.jsx(h,{md:3,className:"mb-3",children:e.jsx(l,{children:e.jsx(l.Body,{className:"text-center",children:e.jsx("div",{className:"spinner-border spinner-border-sm text-primary",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Cargando..."})})})})},o))}):e.jsxs("div",{children:[e.jsxs(T,{className:"mb-4",children:[e.jsx(h,{md:3,children:e.jsx(l,{className:"text-center border-primary",children:e.jsxs(l.Body,{children:[e.jsx(B,{className:"text-primary mb-2",size:24}),e.jsx("h5",{className:"mb-1",children:t.toLocaleString()}),e.jsx("small",{className:"text-muted",children:"Total de Acciones"}),e.jsx("div",{className:"mt-2",children:e.jsxs(y,{bg:"info",className:"fs-6",children:[c," hoy"]})})]})})}),e.jsx(h,{md:3,children:e.jsx(l,{className:"text-center border-success",children:e.jsxs(l.Body,{children:[e.jsx(se,{className:"text-success mb-2",size:24}),e.jsx("h5",{className:"mb-1",children:N}),e.jsx("small",{className:"text-muted",children:"Usuarios Activos"}),e.jsx("div",{className:"mt-2",children:e.jsx(y,{bg:"success",className:"fs-6",children:"Únicos"})})]})})}),e.jsx(h,{md:3,children:e.jsx(l,{className:"text-center border-info",children:e.jsxs(l.Body,{children:[e.jsx(Ce,{className:"text-info mb-2",size:24}),e.jsx("h5",{className:"mb-1",children:g}),e.jsx("small",{className:"text-muted",children:"Esta Semana"}),e.jsx("div",{className:"mt-2",children:e.jsxs(y,{bg:"info",className:"fs-6",children:["+",Math.round(g/7*100)/100,"/día"]})})]})})}),e.jsx(h,{md:3,children:e.jsx(l,{className:"text-center border-warning",children:e.jsxs(l.Body,{children:[e.jsx(O,{className:"text-warning mb-2",size:24}),e.jsx("h5",{className:"mb-1",children:u}),e.jsx("small",{className:"text-muted",children:"Últimas 24h"}),e.jsx("div",{className:"mt-2",children:e.jsx(y,{bg:"warning",className:"fs-6",children:"Activo"})})]})})})]}),e.jsxs(T,{children:[e.jsx(h,{md:6,className:"mb-4",children:e.jsxs(l,{children:[e.jsx(l.Header,{children:e.jsxs("h6",{className:"mb-0",children:[e.jsx(Ke,{className:"me-2"}),"Acciones Más Frecuentes"]})}),e.jsx(l.Body,{children:w.length>0?e.jsx(I,{variant:"flush",children:w.map((o,d)=>e.jsxs(I.Item,{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx(y,{bg:"primary",className:"me-2",children:d+1}),e.jsx("span",{className:"fw-medium",children:o.name})]}),e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"me-3",children:e.jsx(X,{now:o.count/w[0].count*100,style:{width:"100px",height:"8px"},variant:"primary"})}),e.jsx(y,{bg:"secondary",children:o.count})]})]},d))}):e.jsxs("div",{className:"text-center text-muted py-3",children:[e.jsx(B,{size:32,className:"mb-2"}),e.jsx("p",{className:"mb-0",children:"No hay datos de acciones disponibles"})]})})]})}),e.jsx(h,{md:6,className:"mb-4",children:e.jsxs(l,{children:[e.jsx(l.Header,{children:e.jsxs("h6",{className:"mb-0",children:[e.jsx(se,{className:"me-2"}),"Actividad por Usuario"]})}),e.jsx(l.Body,{children:A.length>0?e.jsx(I,{variant:"flush",children:A.map((o,d)=>e.jsxs(I.Item,{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx(y,{bg:"success",className:"me-2",children:d+1}),e.jsx("span",{className:"fw-medium",children:o.name})]}),e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"me-3",children:e.jsx(X,{now:o.actions/A[0].actions*100,style:{width:"100px",height:"8px"},variant:"success"})}),e.jsx(y,{bg:"secondary",children:o.actions})]})]},d))}):e.jsxs("div",{className:"text-center text-muted py-3",children:[e.jsx(se,{size:32,className:"mb-2"}),e.jsx("p",{className:"mb-0",children:"No hay datos de usuarios disponibles"})]})})]})})]}),e.jsx(T,{children:e.jsx(h,{md:12,children:e.jsxs(l,{children:[e.jsx(l.Header,{children:e.jsxs("h6",{className:"mb-0",children:[e.jsx(O,{className:"me-2"}),"Distribución de Actividad por Hora (Datos Reales)",i&&e.jsx(te,{animation:"border",size:"sm",className:"ms-2"})]})}),e.jsx(l.Body,{children:i?e.jsxs("div",{className:"text-center py-4",children:[e.jsx(te,{animation:"border",variant:"primary"}),e.jsx("p",{className:"mt-2 text-muted",children:"Cargando distribución horaria..."})]}):z.length>0?e.jsx("div",{className:"row",children:z.map((o,d)=>e.jsx("div",{className:"col-md-2 mb-3",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"fw-medium",children:[o.hour,":00"]}),e.jsx("div",{className:"mt-2",children:e.jsx(X,{now:o.count/Math.max(...z.map(F=>F.count),1)*100,variant:"info",style:{height:"20px"}})}),e.jsx("div",{className:"text-muted small mt-1",children:o.count})]})},d))}):e.jsxs("div",{className:"text-center text-muted py-3",children:[e.jsx(O,{size:32,className:"mb-2"}),e.jsx("p",{className:"mb-0",children:"No hay datos de distribución horaria disponibles"})]})})]})})})]})}function vs(){const[s,n]=C.useState(!1),[t,c]=C.useState(0),g=Ye(),{data:N,isLoading:b}=K(["cleanup-stats"],os,{refetchInterval:3e4,staleTime:0}),u=Ze(ds,{onSuccess:()=>{g.invalidateQueries(["audit"]),g.invalidateQueries(["audit-stats-global"]),n(!1),c(0)},onError:x=>{console.error("Error en limpieza:",x),n(!1),c(0)}}),j=async(x=24)=>{n(!0),c(0);const i=setInterval(()=>{c(w=>w>=100?(clearInterval(i),100):w+10)},200);try{await u.mutateAsync(x)}catch(w){console.error("Error en limpieza:",w)}},p=(N==null?void 0:N.data)||{};return e.jsxs(l,{className:"mb-4",children:[e.jsx(l.Header,{children:e.jsxs("h6",{className:"mb-0",children:[e.jsx(q,{className:"me-2"}),"Limpieza Automática de Registros"]})}),e.jsxs(l.Body,{children:[e.jsxs(T,{children:[e.jsx(h,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx("h6",{children:"Estado del Sistema"}),b?e.jsx("div",{className:"text-center",children:e.jsx("div",{className:"spinner-border spinner-border-sm text-primary",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Cargando..."})})}):e.jsxs("div",{children:[e.jsxs("div",{className:"d-flex justify-content-between mb-2",children:[e.jsx("span",{children:"Registros antiguos (>24h):"}),e.jsx(y,{bg:"warning",children:p.oldRecords||0})]}),e.jsxs("div",{className:"d-flex justify-content-between mb-2",children:[e.jsx("span",{children:"Registros totales:"}),e.jsx(y,{bg:"info",children:p.totalRecords||0})]}),e.jsxs("div",{className:"d-flex justify-content-between mb-2",children:[e.jsx("span",{children:"Última limpieza:"}),e.jsx(y,{bg:"secondary",children:p.lastCleanup?new Date(p.lastCleanup).toLocaleString():"Nunca"})]})]})]})}),e.jsx(h,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx("h6",{children:"Acciones de Limpieza"}),e.jsxs("div",{className:"d-grid gap-2",children:[e.jsx(f,{variant:"outline-danger",size:"sm",onClick:()=>j(24),disabled:s,children:s?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"spinner-border spinner-border-sm me-1",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Limpiando..."})}),"Limpiando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"me-1"}),"Limpiar registros >24h"]})}),e.jsxs(f,{variant:"outline-warning",size:"sm",onClick:()=>j(168),disabled:s,children:[e.jsx(O,{className:"me-1"}),"Limpiar registros >7 días"]}),e.jsxs(f,{variant:"outline-info",size:"sm",onClick:()=>j(720),disabled:s,children:[e.jsx(O,{className:"me-1"}),"Limpiar registros >30 días"]})]})]})})]}),s&&e.jsxs(ae,{variant:"info",className:"mt-3",children:[e.jsxs("div",{className:"d-flex align-items-center mb-2",children:[e.jsx(le,{className:"me-2"}),e.jsx("strong",{children:"Limpiando registros antiguos..."})]}),e.jsx(X,{now:t,animated:!0}),e.jsxs("small",{className:"text-muted mt-1",children:[t,"% completado"]})]}),e.jsxs(ae,{variant:"warning",className:"mt-3",children:[e.jsx(Ae,{className:"me-2"}),e.jsx("strong",{children:"Nota:"})," La limpieza automática elimina permanentemente los registros antiguos. Esta acción no se puede deshacer. Se recomienda hacer una copia de seguridad antes de proceder."]}),e.jsx("div",{className:"mt-3",children:e.jsxs("small",{className:"text-muted",children:[e.jsx(Se,{className:"me-1"}),"La limpieza automática se ejecuta cada 24 horas para mantener el sistema optimizado."]})})]})]})}function Ps(){const[s,n]=C.useState(1),[t,c]=C.useState(20),[g,N]=C.useState(""),[b,u]=C.useState("all"),[j,p]=C.useState("all"),[x,i]=C.useState("all"),[w,A]=C.useState(!1),[z,o]=C.useState([]),[d,F]=C.useState(!1),[ne,S]=C.useState(null),[L,oe]=C.useState({search:"",action:"all",user:"all",dateRange:"all",dateStart:"",dateEnd:"",timeStart:"",timeEnd:""}),{data:E,isLoading:re,refetch:$,isFetching:me}=K(["audit",{page:s,limit:t,searchQuery:g,actionFilter:b,userFilter:j,dateFilter:x,filters:L}],async()=>{const a={page:s,limit:t,search:g,action:b!=="all"?b:void 0,user:j!=="all"?j:void 0,date:x!=="all"?x:void 0,dateStart:L.dateStart,dateEnd:L.dateEnd,timeStart:L.timeStart,timeEnd:L.timeEnd};Object.keys(a).forEach(ce=>{(a[ce]===void 0||a[ce]==="")&&delete a[ce]});const r=await Ee(a),v=Array.isArray(r==null?void 0:r.data)?r.data:(r==null?void 0:r.rows)||r||[],ie=Number((r==null?void 0:r.total)||v.length||0);return{rows:v,total:ie}},{keepPreviousData:!0,refetchOnWindowFocus:!0,refetchOnMount:!0}),{data:xe}=K(["users-for-audit"],ss,{staleTime:5*60*1e3,cacheTime:10*60*1e3}),{data:P}=xs(),Fe=a=>{switch(a){case"crear":case"create":return e.jsx(ye,{className:"text-success"});case"actualizar":case"update":return e.jsx(ee,{className:"text-primary"});case"eliminar":case"delete":return e.jsx(q,{className:"text-danger"});case"login":return e.jsx(R,{className:"text-info"});case"logout":return e.jsx(R,{className:"text-secondary"});case"actualizar_estado":return e.jsx(V,{className:"text-warning"});case"actualizar_categorias":return e.jsx(V,{className:"text-info"});case"marcar_proyecto":return e.jsx(Se,{className:"text-primary"});case"exportar":return e.jsx(D,{className:"text-success"});case"importar":return e.jsx(ye,{className:"text-info"});case"configurar":return e.jsx(V,{className:"text-warning"});case"asignar":return e.jsx(R,{className:"text-primary"});case"desasignar":return e.jsx(es,{className:"text-secondary"});default:return e.jsx(B,{className:"text-muted"})}},ze=a=>({crear:"creó",create:"creó",actualizar:"actualizó",update:"actualizó",eliminar:"eliminó",delete:"eliminó",login:"inició sesión",logout:"cerró sesión",actualizar_estado:"actualizó el estado",actualizar_categorias:"actualizó las categorías",marcar_proyecto:"marcó el proyecto",exportar:"exportó",importar:"importó",configurar:"configuró",asignar:"asignó",desasignar:"desasignó"})[a]||a,_e=a=>{if(a.user_name&&a.user_name!==a.user_id)return a.user_name;if(a.performed_by)return a.performed_by;if(a.user_id&&xe){const r=xe.find(v=>v.id===a.user_id);if(r)return r.name||r.full_name||r.username||`Usuario ${a.user_id}`}return a.user_id&&typeof a.user_id=="number"?{1:"Administrador",2:"Jefe de Laboratorio",3:"Jefa Comercial",4:"Gerencia",5:"Sistemas",6:"Admin",7:"Usuario",8:"Operador"}[a.user_id]||`Usuario ${a.user_id}`:"Sistema"},ke=a=>{switch(a){case"crear":case"create":return"success";case"actualizar":case"update":return"primary";case"eliminar":case"delete":return"danger";case"login":return"info";case"logout":return"dark";case"actualizar_estado":return"warning";case"actualizar_categorias":return"info";case"marcar_proyecto":return"primary";case"exportar":return"success";case"importar":return"info";case"configurar":return"warning";case"asignar":return"primary";case"desasignar":return"secondary";default:return"dark"}},Le=a=>a?new Date(a).toLocaleString("es-ES",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}):"—",he=C.useMemo(()=>{var r;return[...new Set(((r=E==null?void 0:E.rows)==null?void 0:r.map(v=>v.action))||[])].sort()},[E==null?void 0:E.rows]),ue=C.useMemo(()=>{var r;return[...new Set(((r=E==null?void 0:E.rows)==null?void 0:r.map(v=>v.user_name||v.performed_by||v.user_id))||[])].sort()},[E==null?void 0:E.rows]),J=(E==null?void 0:E.total)||0,G=(E==null?void 0:E.rows)||[],Y=Math.max(1,Math.ceil(J/t)),Te=(P==null?void 0:P.total)||0,Pe=(P==null?void 0:P.uniqueUsers)||0,Be=(P==null?void 0:P.uniqueActions)||0,je=()=>{N(""),u("all"),p("all"),i("all")},Ue=()=>{$()},Me=a=>{oe(a),N(a.search||""),u(a.action||"all"),p(a.user||"all"),i(a.dateRange||"all")},De=()=>{oe({search:"",action:"all",user:"all",dateRange:"all",dateStart:"",dateEnd:"",timeStart:"",timeEnd:""}),N(""),u("all"),p("all"),i("all")},Q=async(a="excel")=>{try{let r;const v={search:g,action:b,user:j,date:x,...L};switch(a){case"excel":r=await be(v),Z(r,`auditoria_${new Date().toISOString().split("T")[0]}.xlsx`);break;case"pdf":r=await hs(v),Z(r,`auditoria_${new Date().toISOString().split("T")[0]}.pdf`);break;case"csv":r=await us(v),Z(r,`auditoria_${new Date().toISOString().split("T")[0]}.csv`);break}}catch(r){console.error("Error al exportar:",r)}},Ie=a=>{S(a),F(!0)},He=(a,r)=>{o(r?v=>[...v,a]:v=>v.filter(ie=>ie.id!==a.id))},Oe=a=>{o(a?G:[])},Re=async a=>{try{const r=await be({selectedIds:a.map(v=>v.id)});Z(r,`auditoria_seleccionados_${new Date().toISOString().split("T")[0]}.xlsx`)}catch(r){console.error("Error en exportación masiva:",r)}},qe=async a=>{if(window.confirm(`¿Estás seguro de eliminar ${a.length} registros? Esta acción no se puede deshacer.`))try{const r=a.map(v=>v.id);await rs(r),$(),o([])}catch(r){console.error("Error eliminando elementos:",r)}},$e=async a=>{try{const r=a.map(v=>v.id);await is(r),$(),o([])}catch(r){console.error("Error archivando elementos:",r)}},Ge=async(a,r)=>{try{await ts(a.id,r),$(),F(!1)}catch(v){console.error("Error editando registro:",v)}},Je=async a=>{if(window.confirm(`¿Estás seguro de eliminar el registro #${a.id}?`))try{await ns(a.id),$(),F(!1)}catch(r){console.error("Error eliminando registro:",r)}};return e.jsxs("div",{className:"fade-in",children:[e.jsx(as,{title:"Auditoría del Sistema",subtitle:"Registro completo de actividades y acciones del sistema",icon:B,actions:e.jsxs("div",{className:"d-flex gap-2",children:[e.jsxs(_,{children:[e.jsxs(_.Toggle,{variant:"outline-success",size:"sm",children:[e.jsx(D,{className:"me-1"}),"Exportar"]}),e.jsxs(_.Menu,{children:[e.jsxs(_.Item,{onClick:()=>Q("excel"),children:[e.jsx(D,{className:"me-2"}),"Excel (.xlsx)"]}),e.jsxs(_.Item,{onClick:()=>Q("pdf"),children:[e.jsx(D,{className:"me-2"}),"PDF"]}),e.jsxs(_.Item,{onClick:()=>Q("csv"),children:[e.jsx(D,{className:"me-2"}),"CSV"]})]})]}),e.jsxs(f,{variant:"outline-info",size:"sm",onClick:()=>A(!w),children:[e.jsx(Ce,{className:"me-1"}),w?"Ocultar":"Analytics"]}),e.jsx(f,{variant:"outline-primary",onClick:Ue,disabled:me,children:me?e.jsxs(e.Fragment,{children:[e.jsx(te,{animation:"border",size:"sm",className:"me-1"}),"Actualizando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(le,{className:"me-1"}),"Actualizar"]})})]})}),w&&e.jsx("div",{className:"mb-4",children:e.jsx(Ns,{analyticsData:P,isLoading:!P})}),e.jsx(vs,{}),e.jsx(js,{filters:L,onFiltersChange:Me,onClearFilters:De,uniqueUsers:ue,uniqueActions:he}),e.jsx(gs,{selectedItems:z,onBulkExport:Re,onBulkDelete:qe,onBulkArchive:$e,onClearSelection:()=>o([])}),e.jsxs(T,{className:"mb-4",children:[e.jsx(h,{md:3,children:e.jsx(l,{className:"text-center border-primary",children:e.jsxs(l.Body,{children:[e.jsx(B,{className:"text-primary mb-2",size:24}),e.jsx("h5",{className:"mb-1",children:Te}),e.jsx("small",{className:"text-muted",children:"Total de Acciones"})]})})}),e.jsx(h,{md:3,children:e.jsx(l,{className:"text-center border-success",children:e.jsxs(l.Body,{children:[e.jsx(se,{className:"text-success mb-2",size:24}),e.jsx("h5",{className:"mb-1",children:Pe}),e.jsx("small",{className:"text-muted",children:"Usuarios Activos"})]})})}),e.jsx(h,{md:3,children:e.jsx(l,{className:"text-center border-info",children:e.jsxs(l.Body,{children:[e.jsx(V,{className:"text-info mb-2",size:24}),e.jsx("h5",{className:"mb-1",children:Be}),e.jsx("small",{className:"text-muted",children:"Tipos de Acciones"})]})})}),e.jsx(h,{md:3,children:e.jsx(l,{className:"text-center border-warning",children:e.jsxs(l.Body,{children:[e.jsx(O,{className:"text-warning mb-2",size:24}),e.jsx("h5",{className:"mb-1",children:Math.ceil(J/t)}),e.jsx("small",{className:"text-muted",children:"Páginas"})]})})})]}),e.jsxs(l,{className:"mb-4",children:[e.jsx(l.Header,{children:e.jsxs("h6",{className:"mb-0",children:[e.jsx(W,{className:"me-2"}),"Filtros y Búsqueda"]})}),e.jsx(l.Body,{children:e.jsxs(T,{children:[e.jsx(h,{md:4,children:e.jsxs(m.Group,{children:[e.jsx(m.Label,{children:"Buscar en auditoría:"}),e.jsxs(H,{children:[e.jsx(H.Text,{children:e.jsx(fe,{})}),e.jsx(m.Control,{type:"text",placeholder:"Buscar por acción, usuario, notas...",value:g,onChange:a=>N(a.target.value)})]})]})}),e.jsx(h,{md:2,children:e.jsxs(m.Group,{children:[e.jsx(m.Label,{children:"Tipo de acción:"}),e.jsxs(m.Select,{value:b,onChange:a=>u(a.target.value),children:[e.jsx("option",{value:"all",children:"Todas las acciones"}),he.map(a=>e.jsx("option",{value:a,children:a},a))]})]})}),e.jsx(h,{md:2,children:e.jsxs(m.Group,{children:[e.jsx(m.Label,{children:"Usuario:"}),e.jsxs(m.Select,{value:j,onChange:a=>p(a.target.value),children:[e.jsx("option",{value:"all",children:"Todos los usuarios"}),ue.map(a=>e.jsx("option",{value:a,children:a},a))]})]})}),e.jsx(h,{md:2,children:e.jsxs(m.Group,{children:[e.jsx(m.Label,{children:"Fecha:"}),e.jsxs(m.Select,{value:x,onChange:a=>i(a.target.value),children:[e.jsx("option",{value:"all",children:"Todas las fechas"}),e.jsx("option",{value:"today",children:"Hoy"}),e.jsx("option",{value:"week",children:"Esta semana"}),e.jsx("option",{value:"month",children:"Este mes"})]})]})}),e.jsx(h,{md:2,className:"d-flex align-items-end",children:e.jsxs(de,{className:"w-100",children:[e.jsxs(f,{variant:"outline-secondary",onClick:je,children:[e.jsx(W,{className:"me-1"}),"Limpiar"]}),e.jsxs(f,{variant:"outline-primary",onClick:()=>$(),children:[e.jsx(le,{className:"me-1"}),"Actualizar"]})]})})]})})]}),e.jsxs(l,{children:[e.jsxs(l.Header,{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("h6",{className:"mb-0",children:[e.jsx(B,{className:"me-2"}),"Registro de Actividades",e.jsxs(y,{bg:"info",className:"ms-2",children:[G.length," de ",J," registros"]})]}),e.jsx("div",{children:e.jsxs(f,{variant:"outline-success",size:"sm",onClick:Q,children:[e.jsx(D,{className:"me-1"}),"Exportar"]})})]}),e.jsx(l.Body,{children:re?e.jsxs("div",{className:"text-center py-4",children:[e.jsx(te,{animation:"border",variant:"primary"}),e.jsx("p",{className:"mt-2 text-muted",children:"Cargando registros de auditoría..."})]}):G.length>0?e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-hover",children:[e.jsx("thead",{className:"table-light",children:e.jsxs("tr",{children:[e.jsx("th",{width:"5%",children:e.jsx(m.Check,{type:"checkbox",checked:z.length===G.length&&G.length>0,onChange:a=>Oe(a.target.checked)})}),e.jsx("th",{width:"8%",children:"ID"}),e.jsx("th",{width:"20%",children:"Acción"}),e.jsx("th",{width:"15%",children:"Usuario"}),e.jsx("th",{width:"20%",children:"Fecha y Hora"}),e.jsx("th",{width:"25%",children:"Notas"}),e.jsx("th",{width:"12%",children:"Acciones"})]})}),e.jsx("tbody",{children:G.map(a=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx(m.Check,{type:"checkbox",checked:z.some(r=>r.id===a.id),onChange:r=>He(a,r.target.checked)})}),e.jsx("td",{children:e.jsxs(y,{bg:"secondary",className:"fs-6",children:["#",a.id]})}),e.jsx("td",{children:e.jsxs("div",{className:"d-flex align-items-center",children:[Fe(a.action),e.jsx(y,{bg:ke(a.action),className:"ms-2 fs-6",children:ze(a.action)})]})}),e.jsx("td",{children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx(R,{className:"me-2 text-muted"}),e.jsx("span",{className:"fw-medium",children:_e(a)})]})}),e.jsx("td",{children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx(O,{className:"me-2 text-muted"}),e.jsx("small",{className:"text-muted",children:Le(a.performed_at||a.created_at)})]})}),e.jsx("td",{children:e.jsx("span",{className:"text-muted",children:a.notes||"Sin notas adicionales"})}),e.jsx("td",{children:e.jsxs(f,{variant:"outline-primary",size:"sm",onClick:()=>Ie(a),children:[e.jsx(we,{className:"me-1"}),"Ver"]})})]},a.id))})]})}):e.jsxs("div",{className:"text-center py-4",children:[e.jsx(B,{size:48,className:"text-muted mb-3"}),e.jsx("h6",{className:"text-muted",children:"No hay registros de auditoría"}),e.jsx("p",{className:"text-muted small",children:g||b!=="all"||j!=="all"||x!=="all"?"No se encontraron registros con los filtros aplicados.":"Los registros de auditoría aparecerán aquí cuando se realicen acciones en el sistema."}),(g||b!=="all"||j!=="all"||x!=="all")&&e.jsx(f,{variant:"outline-primary",onClick:je,children:"Limpiar filtros"})]})})]}),Y>1&&e.jsx(l,{className:"mt-3",children:e.jsx(l.Body,{className:"py-2",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{className:"text-muted",children:["Mostrando ",(s-1)*t+1," a ",Math.min(s*t,J)," de ",J," registros"]}),e.jsxs("div",{className:"btn-group",children:[e.jsx(f,{variant:"outline-secondary",disabled:s<=1||re,onClick:()=>n(a=>Math.max(1,a-1)),children:"Anterior"}),e.jsxs(f,{variant:"outline-secondary",disabled:!0,children:[s," de ",Y]}),e.jsx(f,{variant:"outline-secondary",disabled:s>=Y||re,onClick:()=>n(a=>Math.min(Y,a+1)),children:"Siguiente"})]})]})})}),e.jsx(ps,{show:d,onHide:()=>F(!1),auditRecord:ne,onExport:a=>Q("excel"),onEdit:Ge,onDelete:Je})]})}export{Ps as default};
//# sourceMappingURL=Auditoria-BDUTSiVh.js.map
