import{r as o,c as T,j as e}from"./index-BFrTSJXc.js";import{M as S}from"./ModuloBase-BXjPI6cD.js";import{T as M,a as A}from"./Toolbar-CsECCMO9.js";import{T as E}from"./Toast-BbbM5Ntr.js";import{l as P,c as z,u as D}from"./tickets-DxqGWiv9.js";import{u as y}from"./useMutation-C7qXQuB0.js";import{u as Q}from"./useQuery-C56LzOWb.js";function I(){const[r,d]=o.useState(1),[h]=o.useState(10),[l,N]=o.useState({status:"",priority:""}),[u,n]=o.useState({show:!1,variant:"success",message:""}),[w,m]=o.useState(!1),[t,c]=o.useState({title:"",description:"",priority:"media",file:null}),f=T(),{data:i,isLoading:x}=Q(["tickets",{page:r,limit:h,status:l.status,priority:l.priority}],async()=>{const s=await P({page:r,limit:h,...l}),a=Array.isArray(s==null?void 0:s.data)?s.data:(s==null?void 0:s.rows)||s||[],v=Number((s==null?void 0:s.total)||a.length||0);return{rows:a,total:v}},{keepPreviousData:!0}),j=y(z,{onSuccess:()=>{n({show:!0,variant:"success",message:"Ticket creado"}),f.invalidateQueries("tickets")},onError:s=>n({show:!0,variant:"danger",message:s.message||"Error al crear"})}),C=y(({id:s,status:a})=>D(s,a),{onSuccess:()=>{n({show:!0,variant:"success",message:"Estado actualizado"}),f.invalidateQueries("tickets")},onError:s=>n({show:!0,variant:"danger",message:s.message||"No se pudo actualizar"})}),p=(i==null?void 0:i.rows)||[],g=(i==null?void 0:i.total)||0,b=Math.max(1,Math.ceil(g/h)),k=async s=>{s.preventDefault(),await j.mutateAsync(t),m(!1),c({title:"",description:"",priority:"media",file:null})};return e.jsxs(S,{titulo:"Gestión de Tickets",descripcion:"Aquí podrás ver, crear y gestionar tickets de soporte.",children:[e.jsx(M,{left:e.jsxs("div",{className:"row g-2 w-100",children:[e.jsxs("div",{className:"col-sm-3",children:[e.jsx("label",{className:"form-label",children:"Estado"}),e.jsxs("select",{className:"form-select",value:l.status,onChange:s=>{d(1),N({...l,status:s.target.value})},children:[e.jsx("option",{value:"",children:"Todos"}),e.jsx("option",{value:"abierto",children:"Abierto"}),e.jsx("option",{value:"en_proceso",children:"En proceso"}),e.jsx("option",{value:"resuelto",children:"Resuelto"}),e.jsx("option",{value:"cerrado",children:"Cerrado"})]})]}),e.jsxs("div",{className:"col-sm-3",children:[e.jsx("label",{className:"form-label",children:"Prioridad"}),e.jsxs("select",{className:"form-select",value:l.priority,onChange:s=>{d(1),N({...l,priority:s.target.value})},children:[e.jsx("option",{value:"",children:"Todas"}),e.jsx("option",{value:"baja",children:"Baja"}),e.jsx("option",{value:"media",children:"Media"}),e.jsx("option",{value:"alta",children:"Alta"})]})]})]}),right:e.jsx("button",{className:"btn btn-primary",onClick:()=>m(!0),children:"+ Nuevo ticket"})}),e.jsx("div",{className:"table-responsive mt-3",children:e.jsxs("table",{className:"table table-striped align-middle",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"ID"}),e.jsx("th",{children:"Título"}),e.jsx("th",{children:"Prioridad"}),e.jsx("th",{children:"Estado"}),e.jsx("th",{children:"Creado"})]})}),e.jsxs("tbody",{children:[(p||[]).map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:s.id}),e.jsx("td",{children:s.title}),e.jsx("td",{className:"text-capitalize",children:s.priority}),e.jsx("td",{children:e.jsxs("select",{className:"form-select form-select-sm text-capitalize",value:s.status||"",onChange:async a=>{const v=a.target.value;await C.mutateAsync({id:s.id,status:v})},children:[e.jsx("option",{value:"abierto",children:"Abierto"}),e.jsx("option",{value:"en_proceso",children:"En proceso"}),e.jsx("option",{value:"resuelto",children:"Resuelto"}),e.jsx("option",{value:"cerrado",children:"Cerrado"})]})}),e.jsx("td",{children:s.created_at?String(s.created_at).slice(0,19).replace("T"," "):""})]},s.id)),(!p||p.length===0)&&!x&&e.jsx(A,{colSpan:5,label:"Sin tickets"})]})]})}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{className:"text-muted small",children:["Total: ",g]}),e.jsxs("div",{className:"btn-group",children:[e.jsx("button",{className:"btn btn-outline-secondary",disabled:r<=1||x,onClick:()=>d(s=>Math.max(1,s-1)),children:"Anterior"}),e.jsxs("span",{className:"btn btn-outline-secondary disabled",children:[r,"/",b]}),e.jsx("button",{className:"btn btn-outline-secondary",disabled:r>=b||x,onClick:()=>d(s=>Math.min(b,s+1)),children:"Siguiente"})]})]}),w&&e.jsx("div",{className:"modal fade show",style:{display:"block"},children:e.jsx("div",{className:"modal-dialog",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h5",{className:"modal-title",children:"Nuevo ticket"}),e.jsx("button",{type:"button",className:"btn-close",onClick:()=>m(!1)})]}),e.jsxs("form",{onSubmit:k,children:[e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Título"}),e.jsx("input",{className:"form-control",value:t.title,onChange:s=>c({...t,title:s.target.value}),required:!0})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Descripción"}),e.jsx("textarea",{className:"form-control",rows:4,value:t.description,onChange:s=>c({...t,description:s.target.value})})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Prioridad"}),e.jsxs("select",{className:"form-select",value:t.priority,onChange:s=>c({...t,priority:s.target.value}),children:[e.jsx("option",{value:"baja",children:"Baja"}),e.jsx("option",{value:"media",children:"Media"}),e.jsx("option",{value:"alta",children:"Alta"})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Adjunto (opcional)"}),e.jsx("input",{type:"file",className:"form-control",onChange:s=>{var a;return c({...t,file:((a=s.target.files)==null?void 0:a[0])||null})}})]})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>m(!1),children:"Cancelar"}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:j.isLoading,children:j.isLoading?"Guardando...":"Crear"})]})]})]})})}),e.jsx(E,{show:u.show,variant:u.variant,onClose:()=>n({...u,show:!1}),children:u.message})]})}export{I as default};
//# sourceMappingURL=Tickets-DK4Swa_5.js.map
