import{r as c,e as na,j as e,C as me,ac as sa,F as ca,y as je,a0 as ra,ad as la,o as ia,Q as da,b as ma,a8 as Ae,K as ua,n as pa,a1 as ha,B as le,a9 as ga,ae as xa,a7 as ja}from"./index-CDayYYh0.js";import{M as fa}from"./ModuloBase-BzOcH9cf.js";import{g as Na,u as ba,c as ya}from"./quotes-D_hj9GKZ.js";import{s as Le,l as va,c as _a}from"./projects-DJh1lR4x.js";import{l as Ca,j as Ea}from"./companies-DRAjyTKu.js";import{s as Sa}from"./subservices-bsaXAJwY.js";import{S as fe}from"./Spinner-BFSKMpy4.js";import{F as De}from"./Form-CukTEVnv.js";import{S as wa}from"./SuccessModal-BLX1mEvO.js";import{M as H}from"./Modal-DfQWsS-G.js";import{A as ie}from"./Alert-pvqi0VvY.js";import{L as Ie}from"./ListGroup-CR-eR_Zo.js";/* empty css                     */import"./ElementChildren-DjJrrPtR.js";import"./Col-Bcdl2XMD.js";function Oe(u){if(!u||typeof u!="string")return[];const p=[],d=/\b([A-Z]{2}\d{2,3})\b/g;let j;for(;(j=d.exec(u))!==null;){const T=j[1];T&&!p.includes(T)&&p.push(T)}return p}function Aa(u){if(!u||u.length===0)return"";if(u.length===1)return`Requiere: ${u[0].codigo}`;if(u.length<=3)return`Requiere: ${u.map(T=>T.codigo).join(", ")}`;const p=u.slice(0,3).map(j=>j.codigo).join(", "),d=u.length-3;return`Requiere: ${p} y ${d} mÃ¡s`}const Da=({value:u="",onChange:p,onSelect:d,onDependenciesSelect:j,placeholder:T="Buscar servicio...",disabled:D=!1,size:L="sm"})=>{const[s,g]=c.useState(u),[m,S]=c.useState(!1),[r,_]=c.useState({top:0,left:0,width:0}),y=c.useRef(null),P=c.useRef(null),[F,U]=c.useState(s);c.useEffect(()=>{const l=setTimeout(()=>U(s),400);return()=>clearTimeout(l)},[s]);const{data:z,isLoading:i}=na(["subservices",F],()=>Sa(F),{enabled:F.length>=2,staleTime:10*60*1e3,keepPreviousData:!0,refetchOnWindowFocus:!1}),w=(z==null?void 0:z.data)||[],k=()=>{if(y.current&&m){const l=y.current.getBoundingClientRect();_({top:l.bottom+window.scrollY+2,left:l.left+window.scrollX,width:l.width})}};c.useEffect(()=>{if(m){k();const l=()=>{m&&k()},v=()=>{m&&k()};return window.addEventListener("scroll",l,!0),window.addEventListener("resize",v),()=>{window.removeEventListener("scroll",l,!0),window.removeEventListener("resize",v)}}},[m]);const ee=l=>{const v=l.target.value;g(v),p==null||p(v),v.length>=2?S(!0):S(!1)},ue=()=>{s.length>=2&&(S(!0),k())},Ne=async l=>{if(console.log("ðŸŽ¯ Item seleccionado:",l),console.log("ðŸ“Š Datos completos del item:",JSON.stringify(l,null,2)),g(l.display_text),S(!1),d==null||d(l),console.log("ðŸ” Verificando dependencias..."),console.log("onDependenciesSelect existe?",!!j),console.log("item.comentarios existe?",!!l.comentarios),console.log("item.comentarios valor:",l.comentarios),j&&l.comentarios){console.log("ðŸ” Analizando dependencias para:",l.codigo),console.log("ðŸ“ Comentario:",l.comentarios);const v=Oe(l.comentarios);if(console.log("ðŸ”— Dependencias encontradas:",v),v.length>0){console.log("ðŸ” Buscando ensayos dependientes individualmente...");const $=[];for(const I of v)try{console.log(`ðŸ” Buscando: ${I}`);const q=await ma(`/subservices/search?q=${I}&limit=1`);if(q.data&&q.data.length>0){const A=q.data[0];console.log(`âœ… Encontrado: ${I}`,A),$.push(A)}else console.log(`âŒ No encontrado: ${I}`)}catch(q){console.error(`âŒ Error buscando ${I}:`,q)}console.log("ðŸ“‹ Items dependientes encontrados:",$),$.length>0&&j($)}}else console.log("âŒ No se pueden procesar dependencias:",{hasOnDependenciesSelect:!!j,hasComentarios:!!l.comentarios,comentariosValue:l.comentarios})},ae=()=>{g(""),S(!1),p==null||p(""),d==null||d(null)};c.useEffect(()=>{const l=v=>{y.current&&!y.current.contains(v.target)&&P.current&&!P.current.contains(v.target)&&S(!1)};if(m)return document.addEventListener("mousedown",l),()=>document.removeEventListener("mousedown",l)},[m]);const be=l=>l===0?"Sujeto a evaluaciÃ³n":`S/ ${l.toFixed(2)}`,te=l=>({"ENSAYO ESTÃNDAR":"primary","ENSAYOS ESPECIALES":"success","ENSAYOS DE CAMPO":"info","ENSAYO AGREGADO":"warning"})[l]||"secondary",pe=m&&s.length>=2&&e.jsxs("div",{ref:P,style:{position:"absolute",top:`${r.top}px`,left:`${r.left}px`,width:`${r.width}px`,zIndex:999999,maxHeight:"300px",overflowY:"auto",backgroundColor:"white",border:"1px solid #dee2e6",borderRadius:"4px",boxShadow:"0 4px 12px rgba(0,0,0,0.15)"},onMouseDown:l=>l.preventDefault(),children:[i&&e.jsxs("div",{className:"p-3 text-center text-muted",children:[e.jsx(fe,{animation:"border",size:"sm",className:"me-2"}),e.jsx("small",{children:"Buscando..."})]}),!i&&w.length===0&&e.jsx("div",{className:"p-3 text-center text-muted",children:e.jsx("small",{children:"No se encontraron resultados"})}),!i&&w.length>0&&w.map(l=>{const v=Oe(l.comentarios),$=v.length>0;return e.jsx("div",{className:"p-2 border-bottom",onClick:()=>Ne(l),style:{cursor:"pointer",transition:"background-color 0.15s"},onMouseEnter:I=>I.currentTarget.style.backgroundColor="#f8f9fa",onMouseLeave:I=>I.currentTarget.style.backgroundColor="white",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-start",children:[e.jsxs("div",{className:"flex-grow-1",children:[e.jsxs("div",{className:"d-flex align-items-center gap-2 mb-1",children:[e.jsx(me,{bg:te(l.service_name),className:"small",children:l.codigo}),$&&e.jsxs(me,{bg:"warning",text:"dark",className:"small",children:[e.jsx(sa,{size:10,className:"me-1"}),"Con dependencias"]})]}),e.jsx("div",{className:"fw-bold small text-dark",children:l.descripcion}),l.norma&&l.norma!=="-"&&e.jsxs("div",{className:"text-muted",style:{fontSize:"0.75rem"},children:[e.jsx(ca,{size:10,className:"me-1"}),l.norma]}),$&&e.jsxs("div",{className:"text-info mt-1",style:{fontSize:"0.7rem"},children:[e.jsx(je,{size:8,className:"me-1"}),Aa(v.map(I=>({codigo:I})))]})]}),e.jsx("div",{className:"text-end ms-2",children:e.jsxs("div",{className:"fw-bold text-success small",children:[e.jsx(ra,{size:12}),be(l.precio)]})})]})},l.id)})]});return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"position-relative",children:e.jsx(De.Group,{className:"mb-0",children:e.jsxs("div",{className:"position-relative",children:[e.jsx(De.Control,{ref:y,type:"text",value:s,onChange:ee,onFocus:ue,placeholder:T,disabled:D,size:L,className:"pe-5",autoComplete:"off"}),e.jsxs("div",{className:"position-absolute top-50 end-0 translate-middle-y pe-3 d-flex align-items-center gap-2",children:[i&&e.jsx(fe,{animation:"border",size:"sm",variant:"primary"}),!i&&s&&e.jsx(ia,{className:"text-muted",onClick:ae,onMouseDown:l=>l.preventDefault(),style:{cursor:"pointer"}}),!i&&!s&&e.jsx(da,{className:"text-muted"})]})]})})}),typeof document<"u"&&pe&&la.createPortal(pe,document.body)]})},Ia=({show:u,onHide:p,projectName:d,companyId:j,onSelectExisting:T,onCreateNew:D})=>{const[L,s]=c.useState([]),[g,m]=c.useState(!1),[S,r]=c.useState(null);c.useEffect(()=>{console.log("ðŸ” ProjectSelectionModal - useEffect triggered:",{show:u,projectName:d,companyId:j}),u&&d&&d.trim().length>=2&&_()},[u,d,j]);const _=async()=>{try{console.log("ðŸ” ProjectSelectionModal - Iniciando bÃºsqueda:",{projectName:d,companyId:j}),m(!0),r(null);const i=await Le(d,j);console.log("âœ… ProjectSelectionModal - Proyectos encontrados:",i),s(i||[])}catch(i){console.error("âŒ ProjectSelectionModal - Error searching projects:",i),r("Error al buscar proyectos existentes")}finally{m(!1)}},y=i=>{T(i),p()},P=()=>{D(),p()},F=()=>{const i=L.length+1,w=`${d} (${i})`;D(w),p()},U=i=>{const w=prompt(`Editar nombre del proyecto "${i.name}":`,i.name);w&&w.trim()!==i.name&&(console.log("Editar proyecto:",i.id,"nuevo nombre:",w),alert(`Funcionalidad de ediciÃ³n en desarrollo. Proyecto: ${i.name} â†’ ${w}`))},z=i=>new Date(i).toLocaleDateString("es-PE");return e.jsxs(H,{show:u,onHide:p,size:"lg",centered:!0,style:{zIndex:9999},children:[e.jsx(H.Header,{closeButton:!0,children:e.jsxs(H.Title,{children:[e.jsx(Ae,{className:"me-2"}),'Proyectos Existentes: "',d,'"']})}),e.jsxs(H.Body,{children:[g&&e.jsxs("div",{className:"text-center py-4",children:[e.jsx(fe,{animation:"border"}),e.jsx("p",{className:"mt-2",children:"Buscando proyectos existentes..."})]}),S&&e.jsx(ie,{variant:"danger",children:S}),!g&&!S&&L.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(ie,{variant:"warning",className:"mb-3",children:e.jsxs("div",{children:[e.jsxs("strong",{children:["âš ï¸ Se encontraron ",L.length,' proyecto(s) con el nombre "',d,'" en esta empresa.']}),e.jsx("br",{}),"Para evitar confusiones, el sistema sugiere diferenciarlos automÃ¡ticamente."]})}),e.jsx(ie,{variant:"info",className:"mb-3",children:e.jsxs("div",{children:[e.jsx("strong",{children:"ðŸ’¡ Opciones disponibles:"}),e.jsxs("ul",{className:"mb-0 mt-2",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Continuar con proyecto existente:"})," Usar uno de los proyectos listados"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Crear nuevo diferenciado:"}),' El sistema agregarÃ¡ automÃ¡ticamente "(2)", "(3)", etc.']}),e.jsxs("li",{children:[e.jsx("strong",{children:"Editar manualmente:"})," Puedes cambiar el nombre despuÃ©s de crear el proyecto"]})]})]})}),e.jsx(Ie,{children:L.map(i=>e.jsxs(Ie.Item,{className:"d-flex justify-content-between align-items-start",style:{cursor:"pointer"},onClick:()=>y(i),children:[e.jsxs("div",{className:"ms-2 me-auto",children:[e.jsxs("div",{className:"fw-bold",children:[e.jsx(Ae,{className:"me-1"}),i.name]}),e.jsxs("div",{className:"text-muted small",children:[e.jsx("strong",{children:"Empresa:"})," ",i.company_name," (RUC: ",i.company_ruc,")"]}),e.jsxs("div",{className:"text-muted small",children:[e.jsx(ua,{className:"me-1"}),i.location||"Sin ubicaciÃ³n"]}),e.jsxs("div",{className:"text-muted small",children:[e.jsx(pa,{className:"me-1"}),"Vendedor: ",i.vendedor_name||"No asignado"]}),e.jsxs("div",{className:"text-muted small",children:[e.jsx(ha,{className:"me-1"}),"Creado: ",z(i.created_at)]})]}),e.jsxs("div",{className:"text-end",children:[e.jsx("div",{className:"mb-2",children:e.jsxs(le,{variant:"outline-secondary",size:"sm",onClick:w=>{w.stopPropagation(),U(i)},title:"Editar nombre para unificar proyectos",children:[e.jsx(ga,{className:"me-1"}),"Editar"]})}),e.jsxs("div",{children:[e.jsxs(me,{bg:"secondary",className:"me-2",children:[i.quotes_count," cotizaciÃ³n(es)"]}),e.jsx(me,{bg:i.status==="activo"?"success":"warning",children:i.status})]})]})]},i.id))})]}),!g&&!S&&L.length===0&&e.jsxs(ie,{variant:"success",children:[e.jsx("strong",{children:"No se encontraron proyectos con ese nombre."}),e.jsx("br",{}),"Puedes crear un nuevo proyecto sin problemas."]})]}),e.jsxs(H.Footer,{children:[e.jsx(le,{variant:"outline-secondary",onClick:p,children:"Cancelar"}),e.jsxs(le,{variant:"warning",onClick:F,children:[e.jsx(je,{className:"me-1"}),'Crear "',d," (",L.length+1,')"']}),e.jsxs(le,{variant:"primary",onClick:P,children:[e.jsx(je,{className:"me-1"}),"Crear Nuevo (Nombre Original)"]})]})]})},Pe={company_name:"",ruc:"",contact_name:"",contact_phone:"",contact_email:"",project_location:"",project_name:""},Oa={request_date:"",issue_date:"",commercial_name:"",commercial_phone:"",payment_terms:"adelantado",reference:"",reference_type:["email","phone"],igv:!0,delivery_days:4,category_main:"laboratorio"},de={code:"",description:"",norm:"",unit_price:0,quantity:1};function Te(u){const p=Number(u.unit_price||0),d=Number(u.quantity||0);return Number((p*d).toFixed(2))}function Pa(){const u=new Date().getFullYear(),p=String(new Date().getMonth()+1).padStart(2,"0"),d=String(new Date().getDate()).padStart(2,"0"),j=Math.floor(Math.random()*1e3).toString().padStart(3,"0");return`COT-${u}${p}${d}-${j}`}const R=(u="")=>(u||"").normalize("NFD").replace(/[\u0300-\u036f]/g,"").toUpperCase().trim(),xe={[R("MUESTRA DE SUELO Y AGREGADO")]:`CONDICIONES ESPECÃFICAS:
- El cliente debe enviar al laboratorio, para los ensayo en suelo y agregados, la cantidad minima de 100 kg por cada muestra.
- El cliente deberÃ¡ de entregar las muestras debidamente identificadas.
- El cliente deberÃ¡ especificar la Norma a ser utilizada para la ejecuciÃ³n del ensayo, caso contrario se considera Norma ASTM o NTP vigente de acuerdo con el alcance del laboratorio.
- El cliente deberÃ¡ entregar las muestras en las instalaciones del LEM, ubicado en la Av. MaraÃ±Ã³n NÂ° 763, Los Olivos, Lima.`,[R("PROBETAS")]:`CONDICIONES ESPECÃFICAS:
- El cliente debe proporcionar las probetas antes del ingreso a obra.
- El cliente deberÃ¡ de entregar las muestras debidamente identificadas.
- El cliente deberÃ¡ especificar la Norma a ser utilizada para la ejecuciÃ³n del ensayo, caso contrario se considera Norma ASTM o NTP vigente de acuerdo con el alcance del laboratorio.
- El cliente deberÃ¡ entregar las muestras en las instalaciones del LEM, ubicado en la Av. MaraÃ±Ã³n NÂ° 763, Los Olivos, Lima.`,[R("DENSIDAD DE CAMPO Y MUESTREO")]:`CONDICIONES ESPECÃFICAS:
- El cliente deberÃ¡ enviar al laboratorio, para los ensayo en suelo y agregados, la cantidad minima de 100 kg por cada muestra.
- Para el ensayo de Densidad de campo, la cantidad de puntos/salida minimo 4 und.
- El cliente deberÃ¡ de programar el servicio, Densidad de campo, con 24 horas de anticipaciÃ³n.
- El cliente deberÃ¡ especificar la Norma a ser utilizada para la ejecuciÃ³n del ensayo, caso contrario se considera Norma ASTM o NTP vigente de acuerdo con el alcance del laboratorio.
- El cliente deberÃ¡ entregar las muestras en las instalaciones del LEM, ubicado en la Av. MaraÃ±Ã³n NÂ° 763, Los Olivos, Lima.`,[R("EXTRACCIÃ“N DE DIAMANTINA")]:`CONDICIONES ESPECÃFICAS:
- MovilizaciÃ³n y desmovilizaciÃ³n de equipos y del personal tÃ©cnico, estara a cargo de GEOFAL.
- Resane de estructura de concreto con sika rep 500 y Sikadur 32, estara a cargo de GEOFAL.
- El servicio no incluye trabajos de acabados como pintura, mayolica y otros.
- El area de trabajo, zona de extracciÃ³n de diamantina, tiene que estar libre de interferencia.
- La extracciÃ³n de diamantina se realizara en 2 dia en campo, en laboratorio se realizarÃ¡ el tallado y refrentado de diamantina, el ensayo de resistencia a la compresiÃ³n de testigo de diamantina se realizara en 5 dias (el tiempo de ensayo obedece a la normativa vigente).
- Costo de resane insumos 250 soles, este costo se distribuira de acuerdo con el numero de perforaciones Donde se hara las extracciones de diamantina`,[R("DIAMANTINA PARA PASES")]:`CONDICIONES ESPECÃFICAS:
- El cliente deberÃ¡ de programar el servicio, ExtracciÃ³n diamantina, con 24 horas de anticipaciÃ³n.
- El area de trabajo, zona de extraccion de diamantina, debera estar libre de interferencia.
- Para extraer la diamantina, se ubicara el acero con un escaneador.
- Movilizacion y desmovilizacion de equipos y del personal tecnico, estara a cargo de Geofal.`,[R("ALBAÃ‘ILERÃA")]:`CONDICIONES ESPECÃFICAS:
- El cliente deberÃ¡ enviar al laboratorio, 20 ladrillo de cada tipo, en buen estado y sin presentar fisuras.
- El cliente deberÃ¡ de entregar las muestras debidamente identificadas.
- El cliente deberÃ¡ especificar la Norma a ser utilizada para la ejecuciÃ³n del ensayo, caso contrario se considera Norma ASTM o NTP vigente de acuerdo con el alcance del laboratorio.
- El cliente deberÃ¡ entregar las muestras en las instalaciones del LEM, ubicado en la Av. MaraÃ±Ã³n NÂ° 763, Los Olivos, Lima`,[R("VIGA BECKELMAN")]:`CONDICIONES ESPECÃFICAS:
- El cliente deberÃ¡ de programar el servicio, Ensayo de DeflexiÃ³n, con 24 horas de anticipaciÃ³n.
- El area de trabajo tiene que estar habilitado.
- El cliente deberÃ¡ especificar la Norma a ser utilizada para la ejecuciÃ³n del ensayo, caso contrario se considera Norma ASTM o NTP o MTC vigente de acuerdo con el alcance del laboratorio.
- Especificar las caracteristicas del camion`,[R("CONTROL DE CALIDAD DE CONCRETO FRESCO EN OBRA")]:`CONDICIONES ESPECÃFICAS:
- El cliente deberÃ¡ de programar el servicio, con 24 horas de anticipaciÃ³n.
- Para el ensayo de control de calidad de concreto fresco en obra, se moldeara 6 probetas, ensayo slump, control de temperatura, en laboratorio las probetas se colocara en camara de curado, el ensayo de compresiÃ³n de las probetas seran 3 a 7 dias y 3 a 28 dias.
- El control de calidad del concreto fresco se sacara cada 50m3 a uno de los mixer donde se hara todos los ensayos respectivos mencionados, o por dia asi no se halla llegado los 50m3.
- El cliente deberÃ¡ especificar la Norma a ser utilizada para la ejecuciÃ³n del ensayo, caso contrario se considera Norma ASTM o NTP vigente de acuerdo con el alcance del laboratorio.`},M=u=>{const p=R((u==null?void 0:u.title)||"");if(xe[p])return xe[p];const d=Object.entries(xe).find(([j])=>p.includes(j)||j.includes(p));return d?d[1]:""};function Ja(){var we;const[u]=xa(),p=ja(),d=u.get("edit"),[j,T]=c.useState([]),[D,L]=c.useState(""),[s,g]=c.useState(Pe),[m,S]=c.useState({company_id:null,project_id:null,company:null,project:null}),[r,_]=c.useState(Oa),[y,P]=c.useState([{...de}]),[F,U]=c.useState(!1),[z,i]=c.useState(""),[w,k]=c.useState(""),[ee,ue]=c.useState(null),[Ne,ae]=c.useState([]),[be,te]=c.useState([]),[pe,l]=c.useState(!1),[v,$]=c.useState(""),[I,q]=c.useState(!1),[A,ye]=c.useState(null),[V,ve]=c.useState([]),[G,_e]=c.useState([]),[oe,Y]=c.useState(""),[O,B]=c.useState(null),[Ce,K]=c.useState(!1),[Me,Ee]=c.useState(!1),[Re,Fe]=c.useState(null),[ze,Se]=c.useState(!1),[ke,$e]=c.useState(""),[qe,Ve]=c.useState(null),[he,Ta]=c.useState(null),[W,Q]=c.useState(null);c.useEffect(()=>{const a=[{id:"V1",code:"V1",title:"MUESTRA DE SUELO Y AGREGADO",description:M({title:"MUESTRA DE SUELO Y AGREGADO"})},{id:"V2",code:"V2",title:"PROBETAS",description:M({title:"PROBETAS"})},{id:"V3",code:"V3",title:"DENSIDAD DE CAMPO Y MUESTREO",description:M({title:"DENSIDAD DE CAMPO Y MUESTREO"})},{id:"V4",code:"V4",title:"EXTRACCIÃ“N DE DIAMANTINA",description:M({title:"EXTRACCIÃ“N DE DIAMANTINA"})},{id:"V5",code:"V5",title:"DIAMANTINA PARA PASES",description:M({title:"DIAMANTINA PARA PASES"})},{id:"V6",code:"V6",title:"ALBAÃ‘ILERÃA",description:M({title:"ALBAÃ‘ILERÃA"})},{id:"V7",code:"V7",title:"VIGA BECKELMAN",description:M({title:"VIGA BECKELMAN"})},{id:"V8",code:"V8",title:"CONTROL DE CALIDAD DE CONCRETO FRESCO EN OBRA",description:M({title:"CONTROL DE CALIDAD DE CONCRETO FRESCO EN OBRA"})}];T(a)},[]),c.useEffect(()=>{(async()=>{try{const o=(await va({page:1,limit:100})).data||[];ae(o),te(o)}catch(a){console.warn("No se pudieron cargar proyectos existentes:",a),ae([]),te([])}})()},[]),c.useEffect(()=>{m.company&&g(a=>{var o,n;return{...a,company_name:m.company.name||a.company_name,ruc:m.company.ruc||a.ruc,contact_name:m.company.contact_name||a.contact_name,contact_phone:m.company.phone||a.contact_phone,contact_email:m.company.email||a.contact_email,project_location:((o=m.project)==null?void 0:o.location)||a.project_location,project_name:((n=m.project)==null?void 0:n.name)||a.project_name}})},[m.company,m.project]),c.useEffect(()=>{(async()=>{try{const o=localStorage.getItem("token");if(!o)return;const n=await fetch("http://localhost:4000/api/auth/me",{headers:{Authorization:`Bearer ${o}`}});if(n.ok){const t=await n.json();t.user&&(ye(t.user),_(x=>({...x,commercial_name:t.user.name||x.commercial_name,commercial_phone:t.user.phone||x.commercial_phone,issue_date:x.issue_date||new Date().toISOString().slice(0,10),request_date:x.request_date||new Date().toISOString().slice(0,10)})))}}catch(o){console.warn("No se pudo obtener datos del usuario:",o)}})()},[]),c.useEffect(()=>{if(!D)return;const a=(j||[]).find(t=>String(t.id)===String(D));if(!a)return;const o=a.conditions||{};_(t=>({...t,payment_terms:o.default_payment_terms||t.payment_terms,igv:typeof o.default_igv=="boolean"?o.default_igv:t.igv,reference:o.default_reference||t.reference}));const n=M(a)||a.description||"";n&&k(n)},[D]);const X=c.useMemo(()=>y.reduce((a,o)=>a+Te(o),0),[y]),ne=c.useMemo(()=>r.igv?Number((X*.18).toFixed(2)):0,[X,r.igv]),ge=c.useMemo(()=>Number((X+ne).toFixed(2)),[X,ne]),Be=()=>P([...y,{...de}]),Ue=a=>P(y.filter((o,n)=>n!==a)),J=(a,o)=>P(y.map((n,t)=>t===a?{...n,...o}:n)),Ge=async()=>{try{console.log("ðŸ” fetchClients - Llamando a /api/companies");const a=await Ca({limit:500});console.log("ðŸ” fetchClients - Respuesta recibida:",a);const o=(a==null?void 0:a.data)||a||[];console.log("ðŸ” fetchClients - Lista de clientes:",o.length,"clientes"),ve(o)}catch(a){console.error("âŒ Error fetching clients:",a),i("Error al cargar los clientes: "+(a.message||"Error desconocido")),ve([])}},Ye=a=>{if(console.log("ðŸ” handleClientSearch - TÃ©rmino de bÃºsqueda:",a),Y(a),!a.trim()){_e([]),K(!1);return}const o=a.toLowerCase();console.log("ðŸ” handleClientSearch - BÃºsqueda en minÃºsculas:",o);const n=V.filter(t=>{var E,se,ce,Z,re;const x=(E=t.name)==null?void 0:E.toLowerCase().includes(o),N=(se=t.ruc)==null?void 0:se.toLowerCase().includes(o),h=(ce=t.email)==null?void 0:ce.toLowerCase().includes(o),C=(Z=t.phone)==null?void 0:Z.toLowerCase().includes(o),f=(re=t.name)==null?void 0:re.toLowerCase().split(" ").some(oa=>oa.includes(o)),b=x||N||h||C||f;return b&&console.log("âœ… Cliente encontrado:",t.name,"- Match:",{nameMatch:x,nameWordsMatch:f,rucMatch:N,emailMatch:h,phoneMatch:C}),b});console.log("ðŸ” handleClientSearch - Resultados encontrados:",n.length),_e(n),K(!0)},Qe=a=>{console.log("ðŸ” handleClientSelect - Cliente seleccionado:",a.name,"ID:",a.id),B(a),Y(a.name),K(!1),g(o=>({...o,company_name:a.name||"",ruc:a.ruc||"",contact_name:a.contact_name||"",contact_phone:a.phone||"",contact_email:a.email||"",project_location:a.address||""})),console.log("âœ… Campos del cliente llenados automÃ¡ticamente:",{company_name:a.name,ruc:a.ruc,contact_name:a.contact_name,contact_phone:a.phone,contact_email:a.email,project_location:a.address})},Xe=()=>{console.log("ðŸ” handleClientClear - Limpiando selecciÃ³n de cliente"),B(null),Y(""),K(!1),g(Pe)};c.useEffect(()=>{d&&V.length>0&&Je(d)},[d,V]);const Je=async a=>{var o,n;q(!0);try{console.log("ðŸ”„ Cargando cotizaciÃ³n existente:",a);const t=await Na(a);if(console.log("âœ… CotizaciÃ³n cargada:",t),!A)try{const h=localStorage.getItem("token");if(h){const C=await fetch("http://localhost:4000/api/auth/me",{headers:{Authorization:`Bearer ${h}`}});if(C.ok){const f=await C.json();f.user&&(ye(f.user),console.log("âœ… Usuario cargado para ediciÃ³n:",f.user))}}}catch(h){console.warn("No se pudo obtener datos del usuario para ediciÃ³n:",h)}if(t.meta&&typeof t.meta=="string")try{t.meta=JSON.parse(t.meta),console.log("âœ… Meta parseado correctamente:",t.meta)}catch(h){console.error("âŒ Error parseando meta:",h),t.meta={}}if(t.client_contact||t.company_name){const h=t.company_name||t.client_company||t.client_contact||"",C=t.client_contact||"";g(b=>({...b,company_name:h,ruc:t.company_ruc||t.client_ruc||"",contact_name:C,contact_phone:t.client_phone||"",contact_email:t.client_email||"",project_location:t.project_location||"",project_name:t.project_name||""})),Y(h),console.log("ðŸ” Configurando bÃºsqueda de cliente:",h),console.log("ðŸ” RUC del cliente:",t.company_ruc||t.client_ruc),console.log("ðŸ” TelÃ©fono del cliente:",t.client_phone);const f=t.company_ruc||t.client_ruc;if(f){console.log("ðŸ” Buscando cliente por RUC:",f);const b=V.find(E=>E.ruc===f);if(b)console.log("âœ… Cliente encontrado:",b),B(b);else{console.log("âŒ Cliente no encontrado en la lista, creando cliente simulado");const E={id:"existing",name:h,ruc:f||"",email:t.client_email||"",phone:t.client_phone||"",contact_name:C,address:t.project_location||""};B(E),console.log("âœ… Cliente simulado creado:",E)}}else{const b={id:"existing",name:h,ruc:"",email:t.client_email||"",phone:t.client_phone||"",contact_name:C,address:t.project_location||""};B(b),console.log("âœ… Cliente simulado creado (sin RUC):",b)}}const x=((n=(o=t.meta)==null?void 0:o.quote)==null?void 0:n.delivery_days)||t.delivery_days||4;_(h=>{var C,f;return{...h,request_date:((f=(C=t.meta)==null?void 0:C.quote)==null?void 0:f.request_date)||t.request_date||new Date().toISOString().slice(0,10),issue_date:t.issue_date||new Date().toISOString().slice(0,10),commercial_name:t.commercial_name||(A==null?void 0:A.name)||"",commercial_phone:t.commercial_phone||(A==null?void 0:A.phone)||"",payment_terms:t.payment_terms||"adelantado",reference:t.reference||"",reference_type:t.reference_type||["email","phone"],igv:t.igv!==!1,delivery_days:x,category_main:t.category_main||"laboratorio"}});let N=[];t.meta&&t.meta.items&&t.meta.items.length>0?(N=t.meta.items,console.log("âœ… Cargando Ã­tems desde meta.items:",N.length)):t.items&&t.items.length>0&&(N=t.items,console.log("âœ… Cargando Ã­tems desde items directo:",N.length)),N.length>0?(P(N),console.log("ðŸ“¦ Ãtems cargados para ediciÃ³n:",N)):(console.log("ðŸ“¦ No hay Ã­tems para cargar, usando Ã­tem vacÃ­o por defecto"),P([{...de}])),t.variant_id&&(L(t.variant_id),console.log("ðŸ”„ Variante cargada:",t.variant_id)),t.meta&&t.meta.conditions_text&&(k(t.meta.conditions_text),console.log("ðŸ“ Condiciones especÃ­ficas cargadas")),t.project_id&&(S(h=>({...h,project_id:t.project_id})),console.log("âœ… Project ID cargado para ediciÃ³n:",t.project_id)),console.log("âœ… Datos de cotizaciÃ³n cargados para ediciÃ³n")}catch(t){console.error("âŒ Error cargando cotizaciÃ³n:",t),i("Error al cargar la cotizaciÃ³n existente: "+(t.message||"Error desconocido"))}finally{q(!1)}};c.useEffect(()=>{Ge()},[]),c.useEffect(()=>{var a;if((a=p.state)!=null&&a.selectedClient&&V.length>0){const o=p.state.selectedClient;console.log("ðŸŽ¯ Cliente pre-seleccionado desde navegaciÃ³n:",o);const n=V.find(t=>t.id===o.id);n?(console.log("âœ… Cliente encontrado en la lista, pre-llenando datos"),B(n),Y(n.name),g(t=>({...t,company_name:n.name||"",ruc:n.ruc||n.dni||"",contact_name:n.contact_name||"",contact_phone:n.phone||"",contact_email:n.email||"",project_location:n.address||""}))):(console.log("âš ï¸ Cliente no encontrado en la lista, usando datos de navegaciÃ³n"),B(o),Y(o.name),g(t=>({...t,company_name:o.name||"",ruc:o.ruc||o.dni||"",contact_name:o.contact_name||"",contact_phone:o.phone||"",contact_email:o.email||"",project_location:o.address||""})))}},[(we=p.state)==null?void 0:we.selectedClient,V]),c.useEffect(()=>()=>{he&&clearTimeout(he)},[he]);const Ke=async a=>{var o,n,t;a.preventDefault(),U(!0),i("");try{if(!s.company_name)throw new Error("Debe ingresar al menos el nombre de la empresa");let x=((o=m.project)==null?void 0:o.id)||m.project_id,N=(n=m.company)==null?void 0:n.id;if(!N){if(!s.ruc)throw new Error("Debe ingresar el RUC de la empresa");const E=await Ea({type:"empresa",ruc:s.ruc,name:s.company_name,address:s.project_location||"",email:s.contact_email||"",phone:s.contact_phone||"",contact_name:s.contact_name||"",city:s.project_location||"",sector:"servicios"});N=E.id,console.log("âœ… Empresa obtenida/creada:",E)}if(!x){const E=await _a({company_id:N,name:s.project_name||`Proyecto ${s.company_name}`,location:s.project_location||"Por definir",contact_name:s.contact_name,contact_phone:s.contact_phone,contact_email:s.contact_email,status:"activo",priority:"normal",vendedor_id:(A==null?void 0:A.id)||null,requiere_laboratorio:r.category_main==="laboratorio",laboratorio_status:r.category_main==="laboratorio"?"pendiente":"no_requerido"});x=E.id,console.log("âœ… Proyecto creado automÃ¡ticamente:",E),console.log("ðŸ‘¤ Vendedor asignado:",A==null?void 0:A.name)}const h=Pa(),C={project_id:x,variant_id:D||null,client_contact:s.contact_name,client_email:s.contact_email,client_phone:s.contact_phone,client_company:s.company_name,client_ruc:s.ruc,project_name:s.project_name,project_location:s.project_location,request_date:r.request_date||new Date().toISOString().slice(0,10),issue_date:r.issue_date||new Date().toISOString().slice(0,10),subtotal:X,igv:ne,total:ge,status:"borrador",reference:r.reference,reference_type:JSON.stringify(r.reference_type),category_main:r.category_main,quote_code:h,meta:JSON.stringify({customer:s,quote:{...r,request_date:r.request_date||new Date().toISOString().slice(0,10),delivery_days:r.delivery_days||4,reference:r.reference,category_main:r.category_main,quote_code:h},items:y,conditions_text:w,payment_terms:r.payment_terms,file_name:v||`CotizaciÃ³n ${new Date().getFullYear()}-${String(new Date().getMonth()+1).padStart(2,"0")}${String(new Date().getDate()).padStart(2,"0")} LEM-GEOFAL-${((t=s.company_name)==null?void 0:t.toUpperCase())||"CLIENTE"}`})};let f,b;d?(f=await ba(d,C),b="CotizaciÃ³n actualizada exitosamente",console.log("âœ… CotizaciÃ³n actualizada:",f)):(f=await ya(C),b="CotizaciÃ³n creada exitosamente",console.log("âœ… Nueva cotizaciÃ³n creada:",f)),Fe({code:h,category:r.category_main==="laboratorio"?"ðŸ§ª Laboratorio":"âš™ï¸ IngenierÃ­a",itemsCount:y.length,total:ge.toLocaleString(),isEdit:!!d,message:b}),Ee(!0),ue(f.id)}catch(x){console.error("Error:",x),i(x.message||"Error al crear cotizaciÃ³n")}finally{U(!1)}},We=async()=>{try{const a=ee;if(!a)return alert("Guarde la cotizaciÃ³n antes de generar el borrador");const o="https://sublustrous-odelia-uninsured.ngrok-free.dev/api".replace(/\/$/,"")||"",n=`/api/quotes/${a}/export/pdf-draft`,t=o&&/\/api$/i.test(o)?`${o}${n.replace(/^\/api/,"")}`:`${o}${n}`,x=localStorage.getItem("token");if(!x)throw new Error("No se encontrÃ³ token de autenticaciÃ³n");const N={variant_id:D,delivery_days:r.delivery_days,meta:{customer:s,quote:{...r,delivery_days:r.delivery_days,variant_id:D},items:y,conditions_text:w,payment_terms:r.payment_terms},items:y};console.log("ðŸ” exportDraft - Enviando datos:",N);const h=await fetch(t,{method:"POST",headers:{Authorization:`Bearer ${x}`,"Content-Type":"application/json"},body:JSON.stringify(N)});if(!h.ok)throw new Error(`Error ${h.status}: ${h.statusText}`);const C=await h.blob(),f=window.URL.createObjectURL(C),b=document.createElement("a");b.href=f;const E=new Date,se=String(E.getDate()).padStart(2,"0"),ce=String(E.getMonth()+1).padStart(2,"0"),Z=String(E.getFullYear()).slice(-2),re=`COT-${se}${ce}${Z}-${Z}.pdf`;b.download=re,document.body.appendChild(b),b.click(),document.body.removeChild(b),window.URL.revokeObjectURL(f)}catch(a){console.error("Error al exportar borrador:",a),alert(`No se pudo exportar borrador: ${a.message}`)}},Ze=a=>{var o;if(g({...s,project_name:a}),a&&a.trim().length>=3){const n=((o=m.company)==null?void 0:o.id)||(O==null?void 0:O.id);n&&He(a.trim(),n)}},He=async(a,o)=>{try{const n=await Le(a,o);n&&n.length>0?Q({count:n.length,suggestedName:`${a} (${n.length+1})`}):Q(null)}catch(n){console.error("Error verificando proyectos duplicados:",n),Q(null)}},ea=async()=>{var n,t;const a=(n=s.project_name)==null?void 0:n.trim();if(!a||a.length<3){alert("Por favor ingresa al menos 3 caracteres en el nombre del proyecto");return}let o=(t=m.company)==null?void 0:t.id;if(!o&&O&&(o=O.id),!o){alert("Por favor selecciona una empresa primero usando el buscador de clientes");return}console.log("ðŸ” Verificando proyectos existentes para:",a,"empresa:",o),console.log("ðŸ” selectedClient:",O),console.log("ðŸ” selection.company:",m.company),$e(a),Ve(o),Se(!0)},aa=a=>{console.log("ðŸ”„ Seleccionando proyecto existente:",a),S(o=>({...o,project:a,project_id:a.id})),g(o=>({...o,project_name:a.name,project_location:a.location||o.project_location})),Q(null),console.log("âœ… Proyecto existente seleccionado y estado actualizado:",a)},ta=(a=null)=>{console.log("ðŸ”„ Creando nuevo proyecto:",a),S(o=>({...o,project:null,project_id:null})),a?(g(o=>({...o,project_name:a})),console.log("âœ… Se crearÃ¡ un nuevo proyecto con nombre diferenciado:",a)):console.log("âœ… Se crearÃ¡ un nuevo proyecto con nombre original"),Q(null)};return e.jsxs(fa,{titulo:d?"ðŸ“ Editar CotizaciÃ³n":"ðŸ“‹ CotizaciÃ³n Inteligente",descripcion:d?"Edita una cotizaciÃ³n existente con nueva fecha":"Formulario unificado para crear cotizaciones de forma rÃ¡pida e intuitiva",children:[I&&e.jsx("div",{className:"alert alert-info",children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"spinner-border spinner-border-sm me-2",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Cargando..."})}),"Cargando cotizaciÃ³n existente..."]})}),z&&e.jsx("div",{className:"alert alert-danger",children:z}),e.jsxs("form",{onSubmit:Ke,className:"intelligent-quote-form",children:[e.jsxs("div",{className:"alert alert-light border mt-3 intelligent-intro",children:[e.jsx("h5",{children:"ðŸš€ Flujo Simplificado"}),e.jsx("p",{className:"mb-0",children:'Completa los datos del cliente, proyecto y cotizaciÃ³n. Usa el botÃ³n "ðŸ’¾ GUARDAR COTIZACIÃ“N" para guardar tu trabajo.'})]}),e.jsxs("div",{className:"intelligent-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("span",{className:"section-icon",children:"ðŸ¢"}),e.jsx("h4",{children:"CLIENTE"}),e.jsx("span",{className:"section-status",children:s.company_name?"âœ… Cliente configurado":"â³ Pendiente"})]}),e.jsxs("div",{className:"section-content",children:[e.jsx("div",{className:"row g-3 mb-4",children:e.jsxs("div",{className:"col-md-12",children:[e.jsx("label",{className:"form-label",children:"Buscar Cliente Existente"}),e.jsxs("div",{className:"position-relative",children:[e.jsx("input",{type:"text",className:"form-control",value:oe,onChange:a=>Ye(a.target.value),onFocus:()=>K(!0),placeholder:"Buscar por nombre, RUC, email o telÃ©fono..."}),O&&e.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm position-absolute end-0 top-50 translate-middle-y me-2",onClick:Xe,children:"âœ•"})]}),oe&&Ce&&G.length>0&&e.jsxs("div",{className:"border rounded mt-2",style:{maxHeight:"200px",overflowY:"auto"},children:[e.jsx("div",{className:"p-2 bg-light border-bottom",children:e.jsxs("small",{className:"text-muted",children:[G.length," cliente",G.length!==1?"s":""," encontrado",G.length!==1?"s":""]})}),G.map(a=>e.jsxs("div",{className:"p-2 border-bottom cursor-pointer hover-bg-light",onClick:()=>Qe(a),style:{cursor:"pointer"},children:[e.jsx("div",{className:"fw-bold",children:a.name}),e.jsxs("small",{className:"text-muted",children:["RUC: ",a.ruc," | Email: ",a.email,a.phone&&` | Tel: ${a.phone}`]})]},a.id))]}),oe&&Ce&&G.length===0&&e.jsx("div",{className:"border rounded mt-2 p-3 text-center",children:e.jsxs("small",{className:"text-muted",children:['No se encontraron clientes con "',oe,'"']})}),O&&e.jsxs("div",{className:"mt-2 p-2 bg-light rounded",children:[e.jsx("strong",{children:"Cliente seleccionado:"})," ",O.name,e.jsx("br",{}),e.jsxs("small",{className:"text-muted",children:["RUC: ",O.ruc," | Email: ",O.email,O.phone&&` | Tel: ${O.phone}`]})]})]})}),e.jsxs("div",{className:"row g-3",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"Empresa"}),e.jsx("input",{className:"form-control",value:s.company_name,onChange:a=>g({...s,company_name:a.target.value}),required:!0,placeholder:"Nombre de la empresa"})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"R.U.C. *"}),e.jsx("input",{className:"form-control",value:s.ruc,onChange:a=>g({...s,ruc:a.target.value}),placeholder:"RUC de la empresa",required:!0})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"Contacto"}),e.jsx("input",{className:"form-control",value:s.contact_name,onChange:a=>g({...s,contact_name:a.target.value}),required:!0,placeholder:"Nombre del contacto"})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"TelÃ©fono"}),e.jsx("input",{className:"form-control",value:s.contact_phone,onChange:a=>g({...s,contact_phone:a.target.value}),placeholder:"TelÃ©fono del contacto"})]}),e.jsxs("div",{className:"col-md-12",children:[e.jsx("label",{className:"form-label",children:"Correo"}),e.jsx("input",{type:"email",className:"form-control",value:s.contact_email,onChange:a=>g({...s,contact_email:a.target.value}),placeholder:"Correo del contacto"})]})]})]})]}),e.jsxs("div",{className:"intelligent-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("span",{className:"section-icon",children:"ðŸ“"}),e.jsx("h4",{children:"PROYECTO"}),e.jsx("span",{className:"section-status",children:s.project_name?"âœ… Proyecto configurado":"â³ Pendiente"})]}),e.jsx("div",{className:"section-content",children:e.jsxs("div",{className:"row g-3",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsxs("label",{className:"form-label",children:["Nombre del Proyecto",m.project&&e.jsx("span",{className:"badge bg-success ms-2",children:"âœ… Proyecto existente seleccionado"})]}),e.jsxs("div",{className:"input-group",children:[e.jsx("input",{className:`form-control ${W?"is-warning":m.project?"is-success":""}`,value:s.project_name,onChange:a=>Ze(a.target.value),required:!0,placeholder:"Nombre del proyecto"}),e.jsx("button",{type:"button",className:"btn btn-outline-info",onClick:ea,title:"Verificar si ya existen proyectos con este nombre",children:"ðŸ” Verificar"})]}),W&&e.jsxs("div",{className:"alert alert-warning mt-2 mb-0",children:[e.jsx("strong",{children:"âš ï¸ Advertencia:"})," Se encontraron ",W.count," proyecto(s) con este nombre.",e.jsx("br",{}),e.jsxs("small",{children:["Sugerencia: ",e.jsx("code",{children:W.suggestedName}),e.jsx("button",{type:"button",className:"btn btn-sm btn-outline-warning ms-2",onClick:()=>{g(a=>({...a,project_name:W.suggestedName})),Q(null)},children:"Usar sugerencia"})]})]}),m.project&&e.jsx("div",{className:"alert alert-success mt-2 mb-0",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-start",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"âœ… Proyecto existente seleccionado:"})," ",m.project.name,e.jsx("br",{}),e.jsxs("small",{children:["UbicaciÃ³n: ",m.project.location||"No especificada"," | Vendedor: ",m.project.vendedor_name||"No asignado"," | Cotizaciones: ",m.project.quotes_count||0]})]}),e.jsx("button",{type:"button",className:"btn btn-sm btn-outline-danger",onClick:()=>{S(a=>({...a,project:null,project_id:null})),console.log("ðŸ”„ Proyecto existente deseleccionado")},title:"Deseleccionar proyecto existente",children:"âœ•"})]})})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"UbicaciÃ³n"}),e.jsx("input",{className:"form-control",value:s.project_location,onChange:a=>g({...s,project_location:a.target.value}),placeholder:"UbicaciÃ³n del proyecto"})]})]})})]}),e.jsxs("div",{className:"intelligent-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("span",{className:"section-icon",children:"ðŸ“‹"}),e.jsx("h4",{children:"COTIZACIÃ“N"}),e.jsx("span",{className:"section-status",children:D?"âœ… Variante seleccionada":"â³ Pendiente"})]}),e.jsxs("div",{className:"section-content",children:[e.jsxs("div",{className:"row g-3",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"Fecha de Solicitud"}),e.jsx("input",{type:"date",className:"form-control",value:r.request_date,onChange:a=>_({...r,request_date:a.target.value})})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"Fecha de EmisiÃ³n"}),e.jsx("input",{type:"date",className:"form-control",value:r.issue_date,onChange:a=>_({...r,issue_date:a.target.value})})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"Comercial"}),e.jsx("input",{className:"form-control",value:r.commercial_name,onChange:a=>_({...r,commercial_name:a.target.value}),placeholder:"Nombre del comercial"})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"TelÃ©fono Comercial"}),e.jsx("input",{type:"tel",className:"form-control",value:r.commercial_phone,onChange:a=>_({...r,commercial_phone:a.target.value}),required:!0,placeholder:"TelÃ©fono del comercial"})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"Variante"}),e.jsxs("select",{className:"form-select",value:D,onChange:a=>L(a.target.value),children:[e.jsx("option",{value:"",children:"Seleccionar variante"}),(j||[]).map(a=>e.jsxs("option",{value:a.id,children:[a.code," - ",a.title]},a.id))]})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"Forma de Pago"}),e.jsxs("select",{className:"form-select",value:r.payment_terms,onChange:a=>_({...r,payment_terms:a.target.value}),children:[e.jsx("option",{value:"adelantado",children:"Adelantado"}),e.jsx("option",{value:"50%",children:"Adelanto 50% y saldo previo al informe"}),e.jsx("option",{value:"credito7",children:"CrÃ©dito 7 dÃ­as con OS"}),e.jsx("option",{value:"credito15",children:"CrÃ©dito 15 dÃ­as con OS"}),e.jsx("option",{value:"credito30",children:"CrÃ©dito 30 dÃ­as con OS"})]})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"DÃ­as HÃ¡biles"}),e.jsx("input",{type:"number",className:"form-control",value:r.delivery_days||4,onChange:a=>{const o=parseInt(a.target.value)||4;_(n=>({...n,delivery_days:o}))},min:"1",max:"30"},`delivery-days-${r.delivery_days}`),e.jsxs("small",{className:"text-muted",children:["Estado actual: ",r.delivery_days]})]}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"form-check mt-4",children:[e.jsx("input",{className:"form-check-input",type:"checkbox",id:"igv",checked:r.igv,onChange:a=>_({...r,igv:a.target.checked})}),e.jsx("label",{className:"form-check-label",htmlFor:"igv",children:"Aplicar IGV 18%"})]})})]}),e.jsxs("div",{className:"mt-3",children:[e.jsx("label",{className:"form-label",children:"Referencia"}),e.jsx("input",{className:"form-control",value:r.reference,onChange:a=>_({...r,reference:a.target.value}),placeholder:"SEGÃšN LO SOLICITADO VÃA CORREO ELECTRÃ“NICO / LLAMADA TELEFÃ“NICA"})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"form-label",children:"CategorÃ­a Principal"}),e.jsxs("div",{className:"row g-3",children:[e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"form-check",children:[e.jsx("input",{className:"form-check-input",type:"radio",name:"categoryMain",id:"laboratorio",value:"laboratorio",checked:r.category_main==="laboratorio",onChange:a=>_({...r,category_main:a.target.value})}),e.jsx("label",{className:"form-check-label",htmlFor:"laboratorio",children:"ðŸ§ª Laboratorio"})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"form-check",children:[e.jsx("input",{className:"form-check-input",type:"radio",name:"categoryMain",id:"ingenieria",value:"ingenieria",checked:r.category_main==="ingenieria",onChange:a=>_({...r,category_main:a.target.value})}),e.jsx("label",{className:"form-check-label",htmlFor:"ingenieria",children:"âš™ï¸ IngenierÃ­a"})]})})]}),e.jsx("div",{className:"alert alert-info mt-2",children:e.jsxs("small",{children:[e.jsx("strong",{children:"ðŸ’¡ Importante:"})," Selecciona la categorÃ­a principal para que el sistema pueda categorizar automÃ¡ticamente los Ã­tems y alimentar el embudo de ventas."]})})]}),e.jsxs("div",{className:"mt-3",children:[e.jsx("label",{className:"form-label",children:"Condiciones EspecÃ­ficas"}),e.jsx("textarea",{className:"form-control",rows:4,placeholder:"Las condiciones se auto-completan segÃºn la variante seleccionada",value:w,onChange:a=>k(a.target.value)})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"form-label",children:"Ãtems de la CotizaciÃ³n"}),e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-bordered table-striped",children:[e.jsx("thead",{className:"table-dark",children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:"10%"},children:"CÃ³digo"}),e.jsx("th",{style:{width:"35%"},children:"DescripciÃ³n"}),e.jsx("th",{style:{width:"15%"},children:"Norma"}),e.jsx("th",{style:{width:"12%"},children:"Precio Unit."}),e.jsx("th",{style:{width:"10%"},children:"Cantidad"}),e.jsx("th",{style:{width:"12%"},children:"Parcial"}),e.jsx("th",{style:{width:"6%"}})]})}),e.jsx("tbody",{children:y.map((a,o)=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("input",{className:"form-control form-control-sm",value:a.code,onChange:n=>J(o,{code:n.target.value}),placeholder:"CÃ³digo"})}),e.jsx("td",{children:e.jsx(Da,{value:a.description,onChange:n=>J(o,{description:n}),onSelect:n=>{n&&J(o,{code:n.codigo,description:n.descripcion,norm:n.norma,unit_price:n.precio})},onDependenciesSelect:n=>{console.log("ðŸš€ Agregando dependencias automÃ¡ticamente:",n);const t=n.map(N=>({...de,code:N.codigo,description:N.descripcion,norm:N.norma,unit_price:N.precio,quantity:1}));console.log("ðŸ“¦ Nuevos items a agregar:",t);const x=[...y];x.splice(o+1,0,...t),P(x),console.log("âœ… Items actualizados:",x)},placeholder:"Buscar servicio...",size:"sm"})}),e.jsx("td",{children:e.jsx("input",{className:"form-control form-control-sm",value:a.norm,onChange:n=>J(o,{norm:n.target.value}),placeholder:"Norma"})}),e.jsx("td",{children:e.jsx("input",{type:"number",step:"0.01",className:"form-control form-control-sm",value:a.unit_price,onChange:n=>J(o,{unit_price:n.target.value}),placeholder:"0.00"})}),e.jsx("td",{children:e.jsx("input",{type:"number",className:"form-control form-control-sm",value:a.quantity,onChange:n=>J(o,{quantity:n.target.value}),min:"1"})}),e.jsx("td",{children:e.jsxs("span",{className:"fw-bold text-success",children:["S/ ",Te(a).toFixed(2)]})}),e.jsx("td",{children:e.jsx("button",{type:"button",className:"btn btn-sm btn-outline-danger",onClick:()=>Ue(o),disabled:y.length===1,title:"Eliminar Ã­tem",children:"ðŸ—‘ï¸"})})]},o))})]})}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center mt-3",children:[e.jsx("button",{type:"button",className:"btn btn-outline-primary",onClick:Be,children:"âž• Agregar Ã­tem"}),e.jsxs("div",{className:"text-end",children:[e.jsxs("div",{className:"h6 mb-1",children:["Subtotal: ",e.jsxs("span",{className:"text-primary",children:["S/ ",X.toFixed(2)]})]}),e.jsxs("div",{className:"h6 mb-1",children:["IGV 18%: ",e.jsxs("span",{className:"text-primary",children:["S/ ",ne.toFixed(2)]})]}),e.jsxs("div",{className:"h5 mb-0",children:["Total: ",e.jsxs("span",{className:"text-success fw-bold",children:["S/ ",ge.toFixed(2)]})]})]})]})]})]})]}),e.jsxs("div",{className:"intelligent-actions",children:[e.jsx("button",{type:"submit",className:"btn btn-success btn-lg",disabled:F||!s.company_name||!s.ruc,children:F?d?"ðŸ”„ Actualizando...":"ðŸ’¾ Guardando...":d?"ðŸ”„ GUARDAR CAMBIOS":"ðŸ’¾ CREAR COTIZACIÃ“N"}),e.jsx("button",{type:"button",className:"btn btn-outline-warning btn-lg",onClick:We,disabled:!ee,children:"ðŸ“„ Generar cotizaciÃ³n"})]})]}),e.jsx(wa,{show:Me,onHide:()=>Ee(!1),data:Re,buttonText:"Aceptar"}),e.jsx(Ia,{show:ze,onHide:()=>Se(!1),projectName:ke,companyId:qe,onSelectExisting:aa,onCreateNew:ta})]})}export{Ja as default};
//# sourceMappingURL=CotizacionInteligente-Ab9mhiDV.js.map
