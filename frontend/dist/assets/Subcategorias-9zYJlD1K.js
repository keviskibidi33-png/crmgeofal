import{R as h,r as s,j as e}from"./index-DQOtztfR.js";import{M as $}from"./ModuloBase-DOe55Sy6.js";import{T as D,a as I}from"./Toolbar-Bx_nmjLF.js";import{T as R}from"./Toast-D03MbIwu.js";import{l as q}from"./categories-KGa0J8x4.js";import{F}from"./FloatingInput-DwiVoxaM.js";const G=(n,i={})=>{const r=new URLSearchParams(i).toString(),l=`/api/subcategories/category/${n}`;return h(r?`${l}?${r}`:l)},L=n=>h("/api/subcategories",{method:"POST",body:JSON.stringify(n)}),O=(n,i)=>h(`/api/subcategories/${n}`,{method:"PUT",body:JSON.stringify(i)}),J=n=>h(`/api/subcategories/${n}`,{method:"DELETE"});function Q(){const[n,i]=s.useState([]),[r,l]=s.useState(""),[b,N]=s.useState([]),[S,v]=s.useState(0),[c,g]=s.useState(1),[w]=s.useState(10),[x,E]=s.useState(!1),[m,o]=s.useState({show:!1,variant:"success",message:""}),[T,d]=s.useState(!1),[u,C]=s.useState(null),[j,y]=s.useState("");s.useEffect(()=>{(async()=>{try{const a=await q({page:1,limit:200}),t=Array.isArray(a==null?void 0:a.data)?a.data:a||[];i(t),t.length&&l(String(t[0].id))}catch{}})()},[]);const f=async()=>{if(!r){N([]),v(0);return}try{E(!0);const a=await G(r,{page:c,limit:w}),t=Array.isArray(a==null?void 0:a.data)?a.data:(a==null?void 0:a.rows)||a||[];N(t),v((a==null?void 0:a.total)??t.length)}catch(a){o({show:!0,variant:"danger",message:a.message||"No se pudo cargar"})}finally{E(!1)}};s.useEffect(()=>{f()},[c,r]);const k=()=>{C(null),y(""),d(!0)},A=a=>{C(a),y(a.name||""),d(!0)},M=async a=>{a.preventDefault();try{u?await O(u.id,{name:j}):await L({category_id:r,name:j}),o({show:!0,variant:"success",message:u?"Subcategoría actualizada":"Subcategoría creada"}),d(!1),f()}catch(t){o({show:!0,variant:"danger",message:t.message||"Error al guardar"})}},P=async a=>{if(window.confirm("¿Eliminar subcategoría?"))try{await J(a.id),o({show:!0,variant:"success",message:"Eliminado"}),f()}catch(t){o({show:!0,variant:"danger",message:t.message||"Error al eliminar"})}},p=Math.max(1,Math.ceil((S||0)/w));return e.jsxs($,{titulo:"Gestión de Subcategorías",descripcion:"Aquí podrás ver, crear, editar y eliminar subcategorías asociadas a una categoría.",children:[e.jsx(D,{left:e.jsx("div",{className:"row g-2 w-100",children:e.jsxs("div",{className:"col-sm-4",children:[e.jsx("label",{className:"form-label",children:"Categoría"}),e.jsx("select",{className:"form-select",value:r,onChange:a=>{l(a.target.value),g(1)},children:n.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))})]})}),right:e.jsx("button",{className:"btn btn-primary",onClick:k,disabled:!r,children:"+ Agregar subcategoría"})}),e.jsx("div",{className:"table-responsive mt-3",children:e.jsxs("table",{className:"table table-striped align-middle",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"ID"}),e.jsx("th",{children:"Nombre"}),e.jsx("th",{style:{width:140},children:"Acciones"})]})}),e.jsxs("tbody",{children:[(b||[]).map(a=>e.jsxs("tr",{children:[e.jsx("td",{children:a.id}),e.jsx("td",{children:a.name}),e.jsxs("td",{className:"d-flex gap-2",children:[e.jsx("button",{className:"btn btn-sm btn-outline-secondary",onClick:()=>A(a),children:"Editar"}),e.jsx("button",{className:"btn btn-sm btn-outline-danger",onClick:()=>P(a),children:"Eliminar"})]})]},a.id)),(!b||b.length===0)&&!x&&e.jsx(I,{colSpan:3,label:"Sin subcategorías"})]})]})}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{className:"text-muted small",children:["Total: ",S]}),e.jsxs("div",{className:"btn-group",children:[e.jsx("button",{className:"btn btn-outline-secondary",disabled:c<=1,onClick:()=>g(a=>Math.max(1,a-1)),children:"Anterior"}),e.jsxs("span",{className:"btn btn-outline-secondary disabled",children:[c,"/",p]}),e.jsx("button",{className:"btn btn-outline-secondary",disabled:c>=p,onClick:()=>g(a=>Math.min(p,a+1)),children:"Siguiente"})]})]}),T&&e.jsx("div",{className:"modal fade show",style:{display:"block"},children:e.jsx("div",{className:"modal-dialog",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h5",{className:"modal-title",children:[u?"Editar":"Nueva"," subcategoría"]}),e.jsx("button",{type:"button",className:"btn-close",onClick:()=>d(!1)})]}),e.jsxs("form",{onSubmit:M,children:[e.jsx("div",{className:"modal-body",children:e.jsx(F,{id:"subcat-name",label:"Nombre",value:j,onChange:a=>y(a.target.value),required:!0})}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>d(!1),children:"Cancelar"}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:x,children:x?"Guardando...":"Guardar"})]})]})]})})}),e.jsx(R,{show:m.show,variant:m.variant,onClose:()=>o({...m,show:!1}),children:m.message})]})}export{Q as default};
//# sourceMappingURL=Subcategorias-9zYJlD1K.js.map
