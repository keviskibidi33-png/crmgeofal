import{a as k,r as h,b as c,j as e,B as A,A as M,V as E,ar as v,C as n,X as F,f as P,h as q,F as T,O as H}from"./index-Cuktr-pt.js";import{C as j,R as d}from"./Row-DXxIMG7u.js";import{A as g}from"./Alert-D03HJGca.js";import{S as D}from"./Spinner-B39M6lL3.js";import{C as i}from"./Col-nNxAn9NL.js";import{C as a}from"./Card-B0ZWfcwD.js";import{T as L}from"./Table-BqADrEzs.js";import{P as V}from"./ProgressBar-Cuk399x_.js";import"./ElementChildren-CA6H3NXv.js";const W=()=>{const{user:m}=k(),[r,f]=h.useState({servicesDistribution:[],categoryRanking:[],ensayosRanking:[],hierarchicalStructure:[],conversionByCategory:[],monthlyTrends:[],underutilizedServices:[],salespersonPerformance:[],executiveSummary:{},funnelByArea:[],approvalMetrics:{}}),[b,u]=h.useState(!0),[p,o]=h.useState(null);h.useEffect(()=>{N()},[]);const N=async()=>{try{if(u(!0),o(null),m.role==="admin"||m.role==="jefa_comercial"){const[s,l,t,y,_,S,C,z,w,B,R]=await Promise.all([c("/api/funnel/distribution"),c("/api/funnel/category-ranking"),c("/api/funnel/ensayos-ranking"),c("/api/funnel/hierarchical-structure"),c("/api/funnel/categories"),c("/api/funnel/trends"),c("/api/funnel/underutilized"),c("/api/funnel/performance"),c("/api/funnel/summary"),c("/api/funnel/by-area"),c("/api/funnel/approval-metrics")]);f({servicesDistribution:s||[],categoryRanking:l||[],ensayosRanking:t||[],hierarchicalStructure:y||[],conversionByCategory:_||[],monthlyTrends:S||[],underutilizedServices:C||[],salespersonPerformance:z||[],executiveSummary:w||{},funnelByArea:B||[],approvalMetrics:R||{}})}else o("No tienes permisos para acceder a esta sección")}catch(s){console.error("Error fetching metrics:",s),s.status===401?o("Sesión expirada. Por favor, inicia sesión nuevamente."):s.status===403?o("No tienes permisos para acceder a esta sección."):o("Error al cargar las métricas: "+(s.message||"Error desconocido"))}finally{u(!1)}};if(!m||!["admin","jefa_comercial"].includes(m.role))return e.jsx(j,{className:"mt-4",children:e.jsxs(g,{variant:"warning",children:[e.jsx("h4",{children:"Acceso Denegado"}),e.jsx("p",{children:"No tienes permisos para acceder a esta sección. Solo los administradores y jefes comerciales pueden ver las métricas de embudo."})]})});if(b)return e.jsxs(j,{className:"d-flex justify-content-center align-items-center",style:{minHeight:"400px"},children:[e.jsx(D,{animation:"border"}),e.jsx("div",{className:"ms-3",children:e.jsx("p",{children:"Cargando métricas..."})})]});const x=s=>new Intl.NumberFormat("es-PE",{style:"currency",currency:"PEN"}).format(s);return e.jsxs(j,{fluid:!0,children:[e.jsxs(d,{className:"mb-4",children:[e.jsxs(i,{children:[e.jsx("h2",{children:"📊 Análisis de Conversión y Rendimiento Comercial"}),e.jsx("p",{className:"text-muted",children:"Dashboard inteligente para jefes comerciales"})]}),e.jsx(i,{xs:"auto",children:e.jsxs(A,{variant:"outline-primary",onClick:N,children:[e.jsx(M,{className:"me-2"}),"Actualizar"]})})]}),p&&e.jsx(g,{variant:"danger",dismissible:!0,onClose:()=>o(null),children:p}),e.jsx(d,{className:"mb-4",children:e.jsx(i,{children:e.jsxs(a,{children:[e.jsx(a.Header,{children:e.jsxs("h5",{className:"mb-0",children:[e.jsx(E,{className:"me-2"}),"Resumen Ejecutivo"]})}),e.jsx(a.Body,{children:e.jsxs(d,{children:[e.jsx(i,{md:3,children:e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-primary",children:r.executiveSummary.approved_quotes||0}),e.jsx("p",{className:"text-muted",children:"Cotizaciones Aprobadas"})]})}),e.jsx(i,{md:3,children:e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-success",children:x(r.executiveSummary.approved_amount||0)}),e.jsx("p",{className:"text-muted",children:"Monto Total Aprobado"})]})}),e.jsx(i,{md:3,children:e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-info",children:x(r.executiveSummary.average_approved_amount||0)}),e.jsx("p",{className:"text-muted",children:"Promedio por Cotización"})]})}),e.jsx(i,{md:3,children:e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-warning",children:r.executiveSummary.active_salespeople||0}),e.jsx("p",{className:"text-muted",children:"Vendedores Activos"})]})})]})})]})})}),e.jsxs(d,{children:[e.jsx(i,{lg:6,className:"mb-4",children:e.jsxs(a,{children:[e.jsx(a.Header,{children:e.jsxs("h5",{className:"mb-0",children:[e.jsx(v,{className:"me-2"}),"🏆 Ranking de Categorías"]})}),e.jsx(a.Body,{children:r.categoryRanking.length===0?e.jsx("p",{className:"text-muted text-center",children:"No hay datos disponibles"}):e.jsx("div",{className:"list-group list-group-flush",children:r.categoryRanking.map((s,l)=>{var t;return e.jsxs("div",{className:"list-group-item d-flex justify-content-between align-items-center",children:[e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsxs(n,{bg:l===0?"warning":l===1?"secondary":"info",className:"me-3 fs-6",children:["#",l+1]}),e.jsxs("div",{children:[e.jsx("strong",{className:"text-capitalize",children:s.category_name}),e.jsx("br",{}),e.jsxs("small",{className:"text-muted",children:[s.total_items," ítems • ",s.total_quotes," cotizaciones"]})]})]}),e.jsxs("div",{className:"text-end",children:[e.jsxs(n,{bg:"success",className:"fs-6 mb-1",children:["S/ ",((t=s.total_money)==null?void 0:t.toLocaleString())||"0"]}),e.jsx("br",{}),e.jsxs("small",{className:"text-muted",children:["Promedio: S/ ",s.average_money_per_quote?Number(s.average_money_per_quote).toFixed(2):"0.00"]}),e.jsx("br",{}),e.jsxs("small",{className:"text-info",children:[s.percentage_of_items,"% del total"]})]})]},l)})})})]})}),e.jsx(i,{lg:6,className:"mb-4",children:e.jsxs(a,{children:[e.jsx(a.Header,{children:e.jsxs("h5",{className:"mb-0",children:[e.jsx(F,{className:"me-2"}),"🧪 Ranking de Ensayos"]})}),e.jsx(a.Body,{children:r.ensayosRanking.length===0?e.jsx("p",{className:"text-muted text-center",children:"No hay datos disponibles"}):e.jsx("div",{className:"list-group list-group-flush",children:r.ensayosRanking.slice(0,10).map((s,l)=>{var t;return e.jsxs("div",{className:"list-group-item d-flex justify-content-between align-items-center",children:[e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsxs(n,{bg:l===0?"warning":l===1?"secondary":l===2?"info":"light",className:"me-3 fs-6",children:["#",l+1]}),e.jsxs("div",{children:[e.jsx("strong",{className:"text-capitalize",children:s.ensayo_name}),e.jsx("br",{}),e.jsxs("small",{className:"text-muted",children:[s.total_hijos_cotizados," hijos cotizados • ",s.total_quotes," cotizaciones"]}),e.jsx("br",{}),e.jsxs("small",{className:"text-info",children:[s.category_main," • ",s.percentage_of_items,"% del total"]})]})]}),e.jsxs("div",{className:"text-end",children:[e.jsxs(n,{bg:"success",className:"fs-6 mb-1",children:["S/ ",((t=s.total_money)==null?void 0:t.toLocaleString())||"0"]}),e.jsx("br",{}),e.jsxs("small",{className:"text-muted",children:["Promedio: S/ ",s.average_money_per_quote?Number(s.average_money_per_quote).toFixed(2):"0.00"]})]})]},l)})})})]})})]}),e.jsx(d,{children:e.jsx(i,{lg:12,className:"mb-4",children:e.jsxs(a,{children:[e.jsx(a.Header,{children:e.jsxs("h5",{className:"mb-0",children:[e.jsx(v,{className:"me-2"}),"🌳 Estructura Jerárquica del Embudo"]})}),e.jsx(a.Body,{children:r.hierarchicalStructure.length===0?e.jsx("p",{className:"text-muted text-center",children:"No hay datos disponibles"}):e.jsx("div",{className:"hierarchical-structure",children:r.hierarchicalStructure.map((s,l)=>{var t;return e.jsx("div",{className:`hierarchy-item ${s.level}`,style:{marginLeft:s.level==="category"?"0px":s.level==="ensayo"?"20px":"40px",padding:"10px",border:"1px solid #e0e0e0",borderRadius:"5px",marginBottom:"5px",backgroundColor:s.level==="category"?"#f8f9fa":s.level==="ensayo"?"#e3f2fd":"#f3e5f5"},children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{className:"d-flex align-items-center",children:[s.level==="category"&&e.jsx("span",{className:"me-2",children:"📁"}),s.level==="ensayo"&&e.jsx("span",{className:"me-2",children:"🧪"}),s.level==="subservicio"&&e.jsx("span",{className:"me-2",children:"📋"}),e.jsxs("div",{children:[e.jsx("strong",{className:"text-capitalize",children:s.name}),s.level==="category"&&e.jsxs("div",{className:"text-muted small",children:[s.total_items," ítems • ",s.total_quotes," cotizaciones"]}),s.level==="ensayo"&&e.jsxs("div",{className:"text-muted small",children:[s.total_items," hijos cotizados • ",s.total_quotes," cotizaciones"]}),s.level==="subservicio"&&e.jsxs("div",{className:"text-muted small",children:[s.veces_cotizado," veces cotizado • ",s.total_quotes," cotizaciones"]})]})]}),e.jsx("div",{className:"text-end",children:e.jsxs(n,{bg:"success",className:"fs-6",children:["S/ ",((t=s.total_money)==null?void 0:t.toLocaleString())||"0"]})})]})},l)})})})]})})}),e.jsxs(d,{children:[e.jsx(i,{lg:6,className:"mb-4",children:e.jsxs(a,{children:[e.jsx(a.Header,{children:e.jsxs("h5",{className:"mb-0",children:[e.jsx(P,{className:"me-2"}),"Conversión por Categoría"]})}),e.jsx(a.Body,{children:r.conversionByCategory.length===0?e.jsx("p",{className:"text-muted text-center",children:"No hay datos disponibles"}):e.jsxs(L,{responsive:!0,size:"sm",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Categoría"}),e.jsx("th",{children:"Borradores"}),e.jsx("th",{children:"Aprobadas"}),e.jsx("th",{children:"% Conversión"})]})}),e.jsx("tbody",{children:r.conversionByCategory.map((s,l)=>e.jsxs("tr",{children:[e.jsx("td",{children:s.category_name}),e.jsx("td",{children:s.draft_count}),e.jsx("td",{children:s.approved_count}),e.jsx("td",{children:e.jsxs(n,{bg:s.conversion_rate>50?"success":s.conversion_rate>25?"warning":"danger",children:[s.conversion_rate,"%"]})})]},l))})]})})]})}),e.jsx(i,{lg:6,className:"mb-4",children:e.jsxs(a,{children:[e.jsx(a.Header,{children:e.jsxs("h5",{className:"mb-0",children:[e.jsx(q,{className:"me-2"}),"Rendimiento de Vendedores"]})}),e.jsx(a.Body,{children:r.salespersonPerformance.length===0?e.jsx("p",{className:"text-muted text-center",children:"No hay datos disponibles"}):e.jsx("div",{className:"list-group list-group-flush",children:r.salespersonPerformance.map((s,l)=>e.jsxs("div",{className:"list-group-item",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[e.jsxs("h6",{className:"mb-0",children:[s.name," ",s.apellido]}),e.jsx(n,{bg:"info",children:s.area})]}),e.jsxs("div",{className:"row text-center",children:[e.jsxs("div",{className:"col-4",children:[e.jsx("small",{className:"text-muted",children:"Total"}),e.jsx("div",{className:"fw-bold",children:s.total_quotes})]}),e.jsxs("div",{className:"col-4",children:[e.jsx("small",{className:"text-muted",children:"Aprobadas"}),e.jsx("div",{className:"fw-bold text-success",children:s.approved_quotes})]}),e.jsxs("div",{className:"col-4",children:[e.jsx("small",{className:"text-muted",children:"% Éxito"}),e.jsxs("div",{className:"fw-bold text-primary",children:[s.approval_rate,"%"]})]})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("small",{className:"text-muted",children:"Monto: "}),e.jsx("span",{className:"fw-bold text-success",children:x(s.approved_amount)})]})]},l))})})]})})]}),e.jsxs(d,{children:[e.jsx(i,{lg:6,className:"mb-4",children:e.jsxs(a,{children:[e.jsx(a.Header,{children:e.jsxs("h5",{className:"mb-0",children:[e.jsx(T,{className:"me-2"}),"Servicios Subutilizados"]})}),e.jsx(a.Body,{children:r.underutilizedServices.length===0?e.jsx("p",{className:"text-muted text-center",children:"No hay servicios subutilizados"}):e.jsx("div",{className:"list-group list-group-flush",children:r.underutilizedServices.map((s,l)=>e.jsxs("div",{className:"list-group-item d-flex justify-content-between align-items-center",children:[e.jsxs("div",{children:[e.jsx("h6",{className:"mb-1",children:s.service_name}),e.jsxs("small",{className:"text-muted",children:[s.category_name," • ",s.area]})]}),e.jsxs("div",{className:"text-end",children:[e.jsxs(n,{bg:"warning",children:[s.usage_count," usos"]}),e.jsx("div",{className:"small text-muted",children:x(s.total_revenue)})]})]},l))})})]})}),e.jsx(i,{lg:6,className:"mb-4",children:e.jsxs(a,{children:[e.jsx(a.Header,{children:e.jsxs("h5",{className:"mb-0",children:[e.jsx(H,{className:"me-2"}),"Métricas de Tiempo"]})}),e.jsx(a.Body,{children:e.jsxs("div",{className:"text-center",children:[e.jsxs("h4",{className:"text-primary",children:[Math.round(r.approvalMetrics.avg_approval_hours||0),"h"]}),e.jsx("p",{className:"text-muted",children:"Tiempo Promedio de Aprobación"}),e.jsxs("div",{className:"mt-3",children:[e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsx("span",{children:"Rápido (<24h)"}),e.jsx("span",{children:r.approvalMetrics.fast_approvals||0})]}),e.jsx(V,{now:r.approvalMetrics.total_approvals?(r.approvalMetrics.fast_approvals||0)/r.approvalMetrics.total_approvals*100:0,variant:"success",className:"mt-1"})]})]})})]})})]})]})};export{W as default};
//# sourceMappingURL=MetricasEmbudo-CSHUJZtM.js.map
