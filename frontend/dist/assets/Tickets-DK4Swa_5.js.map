{"version":3,"file":"Tickets-DK4Swa_5.js","sources":["../../src/pages/Tickets.jsx"],"sourcesContent":["import React, { useState } from 'react';\r\nimport ModuloBase from '../components/ModuloBase';\r\nimport Toolbar from '../components/Toolbar';\r\nimport Toast from '../components/Toast';\r\nimport TableEmpty from '../components/TableEmpty';\r\nimport { listTickets, createTicket, updateTicketStatus } from '../services/tickets';\r\nimport { useQuery, useMutation, useQueryClient } from 'react-query';\r\n\r\nexport default function Tickets() {\r\n  const [page, setPage] = useState(1);\r\n  const [limit] = useState(10);\r\n  const [filters, setFilters] = useState({ status: '', priority: '' });\r\n  const [toast, setToast] = useState({ show: false, variant: 'success', message: '' });\r\n  const [showModal, setShowModal] = useState(false);\r\n  const [form, setForm] = useState({ title: '', description: '', priority: 'media', file: null });\r\n\r\n  const queryClient = useQueryClient();\r\n\r\n  const { data, isLoading } = useQuery(\r\n    ['tickets', { page, limit, status: filters.status, priority: filters.priority }],\r\n    async () => {\r\n      const resp = await listTickets({ page, limit, ...filters });\r\n      const rows = Array.isArray(resp?.data) ? resp.data : (resp?.rows || resp || []);\r\n      const total = Number(resp?.total || rows.length || 0);\r\n      return { rows, total };\r\n    },\r\n    { keepPreviousData: true }\r\n  );\r\n\r\n  const createMutation = useMutation(createTicket, {\r\n    onSuccess: () => {\r\n      setToast({ show: true, variant: 'success', message: 'Ticket creado' });\r\n      queryClient.invalidateQueries('tickets');\r\n    },\r\n    onError: (err) => setToast({ show: true, variant: 'danger', message: err.message || 'Error al crear' })\r\n  });\r\n\r\n  const statusMutation = useMutation(({ id, status }) => updateTicketStatus(id, status), {\r\n    onSuccess: () => {\r\n      setToast({ show: true, variant: 'success', message: 'Estado actualizado' });\r\n      queryClient.invalidateQueries('tickets');\r\n    },\r\n    onError: (err) => setToast({ show: true, variant: 'danger', message: err.message || 'No se pudo actualizar' })\r\n  });\r\n\r\n  const rows = data?.rows || [];\r\n  const total = data?.total || 0;\r\n  const totalPages = Math.max(1, Math.ceil(total / limit));\r\n\r\n  const onCreate = async (e) => {\r\n    e.preventDefault();\r\n    await createMutation.mutateAsync(form);\r\n    setShowModal(false);\r\n    setForm({ title: '', description: '', priority: 'media', file: null });\r\n  };\r\n\r\n  return (\r\n    <ModuloBase titulo=\"Gestión de Tickets\" descripcion=\"Aquí podrás ver, crear y gestionar tickets de soporte.\">\r\n      <Toolbar\r\n        left={\r\n          <div className=\"row g-2 w-100\">\r\n            <div className=\"col-sm-3\">\r\n              <label className=\"form-label\">Estado</label>\r\n              <select className=\"form-select\" value={filters.status} onChange={e=>{ setPage(1); setFilters({ ...filters, status: e.target.value }); }}>\r\n                <option value=\"\">Todos</option>\r\n                <option value=\"abierto\">Abierto</option>\r\n                <option value=\"en_proceso\">En proceso</option>\r\n                <option value=\"resuelto\">Resuelto</option>\r\n                <option value=\"cerrado\">Cerrado</option>\r\n              </select>\r\n            </div>\r\n            <div className=\"col-sm-3\">\r\n              <label className=\"form-label\">Prioridad</label>\r\n              <select className=\"form-select\" value={filters.priority} onChange={e=>{ setPage(1); setFilters({ ...filters, priority: e.target.value }); }}>\r\n                <option value=\"\">Todas</option>\r\n                <option value=\"baja\">Baja</option>\r\n                <option value=\"media\">Media</option>\r\n                <option value=\"alta\">Alta</option>\r\n              </select>\r\n            </div>\r\n          </div>\r\n        }\r\n        right={<button className=\"btn btn-primary\" onClick={()=>setShowModal(true)}>+ Nuevo ticket</button>}\r\n      />\r\n\r\n      <div className=\"table-responsive mt-3\">\r\n        <table className=\"table table-striped align-middle\">\r\n          <thead>\r\n            <tr>\r\n              <th>ID</th>\r\n              <th>Título</th>\r\n              <th>Prioridad</th>\r\n              <th>Estado</th>\r\n              <th>Creado</th>\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            {(rows || []).map(r => (\r\n              <tr key={r.id}>\r\n                <td>{r.id}</td>\r\n                <td>{r.title}</td>\r\n                <td className=\"text-capitalize\">{r.priority}</td>\r\n                <td>\r\n                  <select\r\n                    className=\"form-select form-select-sm text-capitalize\"\r\n                    value={r.status || ''}\r\n                    onChange={async (e)=>{\r\n                      const val = e.target.value;\r\n                      await statusMutation.mutateAsync({ id: r.id, status: val });\r\n                    }}\r\n                  >\r\n                    <option value=\"abierto\">Abierto</option>\r\n                    <option value=\"en_proceso\">En proceso</option>\r\n                    <option value=\"resuelto\">Resuelto</option>\r\n                    <option value=\"cerrado\">Cerrado</option>\r\n                  </select>\r\n                </td>\r\n                <td>{r.created_at ? String(r.created_at).slice(0, 19).replace('T',' ') : ''}</td>\r\n              </tr>\r\n            ))}\r\n            {(!rows || rows.length === 0) && !isLoading && <TableEmpty colSpan={5} label=\"Sin tickets\" />}\r\n          </tbody>\r\n        </table>\r\n      </div>\r\n\r\n      <div className=\"d-flex justify-content-between align-items-center\">\r\n        <div className=\"text-muted small\">Total: {total}</div>\r\n        <div className=\"btn-group\">\r\n          <button className=\"btn btn-outline-secondary\" disabled={page<=1 || isLoading} onClick={()=>setPage(p=>Math.max(1,p-1))}>Anterior</button>\r\n          <span className=\"btn btn-outline-secondary disabled\">{page}/{totalPages}</span>\r\n          <button className=\"btn btn-outline-secondary\" disabled={page>=totalPages || isLoading} onClick={()=>setPage(p=>Math.min(totalPages,p+1))}>Siguiente</button>\r\n        </div>\r\n      </div>\r\n\r\n      {showModal && (\r\n        <div className=\"modal fade show\" style={{ display: 'block' }}>\r\n          <div className=\"modal-dialog\">\r\n            <div className=\"modal-content\">\r\n              <div className=\"modal-header\">\r\n                <h5 className=\"modal-title\">Nuevo ticket</h5>\r\n                <button type=\"button\" className=\"btn-close\" onClick={()=>setShowModal(false)}></button>\r\n              </div>\r\n              <form onSubmit={onCreate}>\r\n                <div className=\"modal-body\">\r\n                  <div className=\"mb-3\">\r\n                    <label className=\"form-label\">Título</label>\r\n                    <input className=\"form-control\" value={form.title} onChange={e=>setForm({ ...form, title: e.target.value })} required />\r\n                  </div>\r\n                  <div className=\"mb-3\">\r\n                    <label className=\"form-label\">Descripción</label>\r\n                    <textarea className=\"form-control\" rows={4} value={form.description} onChange={e=>setForm({ ...form, description: e.target.value })} />\r\n                  </div>\r\n                  <div className=\"mb-3\">\r\n                    <label className=\"form-label\">Prioridad</label>\r\n                    <select className=\"form-select\" value={form.priority} onChange={e=>setForm({ ...form, priority: e.target.value })}>\r\n                      <option value=\"baja\">Baja</option>\r\n                      <option value=\"media\">Media</option>\r\n                      <option value=\"alta\">Alta</option>\r\n                    </select>\r\n                  </div>\r\n                  <div className=\"mb-3\">\r\n                    <label className=\"form-label\">Adjunto (opcional)</label>\r\n                    <input type=\"file\" className=\"form-control\" onChange={e=>setForm({ ...form, file: e.target.files?.[0] || null })} />\r\n                  </div>\r\n                </div>\r\n                <div className=\"modal-footer\">\r\n                  <button type=\"button\" className=\"btn btn-outline-secondary\" onClick={()=>setShowModal(false)}>Cancelar</button>\r\n                  <button type=\"submit\" className=\"btn btn-primary\" disabled={createMutation.isLoading}>{createMutation.isLoading ? 'Guardando...' : 'Crear'}</button>\r\n                </div>\r\n              </form>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      <Toast show={toast.show} variant={toast.variant} onClose={()=>setToast({ ...toast, show: false })}>\r\n        {toast.message}\r\n      </Toast>\r\n    </ModuloBase>\r\n  );\r\n}\r\n"],"names":["Tickets","page","setPage","useState","limit","filters","setFilters","toast","setToast","showModal","setShowModal","form","setForm","queryClient","useQueryClient","data","isLoading","useQuery","resp","listTickets","rows","total","createMutation","useMutation","createTicket","err","statusMutation","id","status","updateTicketStatus","totalPages","onCreate","e","jsxs","ModuloBase","jsx","Toolbar","r","val","TableEmpty","p","_a","Toast"],"mappings":"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"}