import{j as e,r as a,b as d}from"./index-DwZw-JFj.js";import{M as D}from"./ModuloBase-CvVreALB.js";const P={position:"fixed",top:0,left:0,width:"100vw",height:"100vh",background:"rgba(0,0,0,0.18)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center"},U={background:"#fff",borderRadius:12,boxShadow:"0 2px 16px #0002",padding:"2rem 2.5rem",minWidth:340,maxWidth:420};function A({open:c,onClose:j,children:s}){return c?e.jsx("div",{style:P,onClick:j,children:e.jsx("div",{style:U,onClick:n=>n.stopPropagation(),children:s})}):null}const k=20,J=()=>{const[c,j]=a.useState([]),[s,n]=a.useState(null),[u,m]=a.useState(null),[h,p]=a.useState(null),[S,B]=a.useState(0),[E,w]=a.useState(!0),[v,I]=a.useState(null),[i,x]=a.useState(1),[b,T]=a.useState(""),[g,W]=a.useState(""),[_,f]=a.useState(!1),R=[{value:"",label:"Todos los roles"},{value:"admin",label:"Admin"},{value:"jefa_comercial",label:"Jefa Comercial"},{value:"vendedor_comercial",label:"Vendedor Comercial"},{value:"jefe_laboratorio",label:"Jefe Laboratorio"},{value:"usuario_laboratorio",label:"Usuario Laboratorio"},{value:"user",label:"User"}];return a.useEffect(()=>{w(!0),(async()=>{try{const r=[];r.push(`page=${i}`),r.push(`limit=${k}`),b&&r.push(`search=${encodeURIComponent(b)}`),g&&r.push(`role=${encodeURIComponent(g)}`);const y=`/api/users?${r.join("&")}`,t=await d(y);j(t.data||[]),B(t.total||0)}catch(r){I(r.message||"Error al cargar usuarios")}finally{w(!1)}})()},[i,b,g,_]),e.jsxs(D,{titulo:"Gestión de Usuarios",descripcion:"Activa o desactiva el acceso de los agentes, gestiona sus contraseñas y filtra por nombre o área.",children:[e.jsxs("div",{style:{display:"flex",gap:"1rem",marginBottom:"1.5rem",alignItems:"center"},children:[e.jsx("input",{type:"text",placeholder:"Buscar por nombre...",value:b,onChange:r=>{T(r.target.value),x(1)},style:{padding:"0.5rem 1rem",border:"1px solid #ddd",borderRadius:6,minWidth:220}}),e.jsx("select",{value:g,onChange:r=>{W(r.target.value),x(1)},style:{padding:"0.5rem",borderRadius:6,background:"#f5f5f5",fontWeight:500},children:R.map(r=>e.jsx("option",{value:r.value,children:r.label},r.value))})]}),E&&e.jsx("p",{children:"Cargando..."}),v&&e.jsx("p",{style:{color:"red"},children:v}),!E&&!v&&e.jsxs(e.Fragment,{children:[e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",marginBottom:"1rem",background:"#fff",boxShadow:"0 2px 8px #0001",borderRadius:8},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{background:"#f5f5f5"},children:[e.jsx("th",{style:{textAlign:"center",padding:"0.7rem"},children:"Nombre"}),e.jsx("th",{style:{textAlign:"center",padding:"0.7rem"},children:"Apellido"}),e.jsx("th",{style:{textAlign:"center",padding:"0.7rem"},children:"Correo"}),e.jsx("th",{style:{textAlign:"center",padding:"0.7rem"},children:"Rol"}),e.jsx("th",{style:{textAlign:"center",padding:"0.7rem"},children:"Área"}),e.jsx("th",{style:{textAlign:"center",padding:"0.7rem"},children:"Estado"}),e.jsx("th",{style:{textAlign:"center",padding:"0.7rem"},children:"Acceso"}),e.jsx("th",{style:{textAlign:"center",padding:"0.7rem"},children:"Acciones"})]})}),e.jsxs("tbody",{children:[c.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:7,style:{textAlign:"center",padding:"1.5rem"},children:"Sin usuarios"})}),c.map(r=>{var y;return e.jsxs("tr",{style:{borderBottom:"1px solid #f0f0f0"},children:[e.jsx("td",{style:{fontWeight:600,textAlign:"center"},children:r.name}),e.jsx("td",{style:{textAlign:"center"},children:r.apellido||"-"}),e.jsx("td",{style:{textAlign:"center"},children:r.email}),e.jsx("td",{style:{textAlign:"center"},children:e.jsx("span",{style:{background:r.role==="admin"?"#ffe58f":r.role==="jefa_comercial"?"#ffd6e7":r.role==="vendedor_comercial"?"#e6f7ff":r.role==="jefe_laboratorio"?"#d9f7be":r.role==="usuario_laboratorio"?"#f4ffb8":"#f5f5f5",color:r.role==="admin"?"#ad8b00":r.role==="jefa_comercial"?"#c41d7f":r.role==="vendedor_comercial"?"#096dd9":r.role==="jefe_laboratorio"?"#389e0d":r.role==="usuario_laboratorio"?"#b7a200":"#222",borderRadius:8,padding:"0.2rem 0.7rem",fontSize:13,fontWeight:600,display:"inline-block"},children:((y=R.find(t=>t.value===r.role))==null?void 0:y.label)||r.role})}),e.jsx("td",{style:{textAlign:"center"},children:r.area||"-"}),e.jsx("td",{style:{textAlign:"center"},children:e.jsxs("label",{style:{display:"inline-flex",alignItems:"center",cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:r.active,onChange:async t=>{try{await d(`/api/users/${r.id}`,{method:"PATCH",body:JSON.stringify({active:t.target.checked})}),f(l=>!l)}catch(l){alert(l.message||"Error al actualizar estado")}},style:{marginRight:8}}),e.jsx("span",{style:{fontWeight:600,color:r.active?"#0a7d2c":"#c0392b"},children:r.active?"Activo":"Inactivo"})]})}),e.jsxs("td",{style:{textAlign:"center"},children:[e.jsx("button",{title:"Editar",style:{background:"none",border:"1px solid #bbb",borderRadius:4,padding:"0.2rem 0.5rem",cursor:"pointer",marginRight:8},onClick:()=>n(r),children:e.jsx("span",{role:"img","aria-label":"edit",style:{color:"#fa8c16"},children:"✏️"})}),e.jsx("button",{title:"Restablecer contraseña",style:{background:"none",border:"none",cursor:"pointer",marginRight:8},onClick:()=>p(r),children:e.jsx("span",{role:"img","aria-label":"reset",style:{color:"#faad14"},children:"🔑"})}),e.jsx("button",{title:"Eliminar",style:{background:"none",border:"none",color:"#e74c3c",cursor:"pointer"},onClick:()=>m(r),children:e.jsx("span",{role:"img","aria-label":"delete",children:"🗑️"})})]}),e.jsx(A,{open:!!s,onClose:()=>n(null),children:s&&e.jsxs("form",{onSubmit:async t=>{t.preventDefault();const l=t.target,o=l.nombre.value.trim(),M=l.apellido.value.trim(),L=l.email.value.trim(),N=l.rol.value,$=l.area.value.trim();try{await d(`/api/users/${s.id}`,{method:"PATCH",body:JSON.stringify({name:o,apellido:M,email:L,role:N,area:$})}),n(null),f(C=>!C)}catch(C){alert(C.message||"Error al editar usuario")}},children:[e.jsx("h2",{style:{marginBottom:8},children:"Editar Usuario"}),e.jsx("div",{style:{color:"#888",marginBottom:18},children:"Actualiza los datos del usuario."}),e.jsxs("div",{style:{display:"flex",gap:"1rem",marginBottom:18},children:[e.jsxs("div",{style:{flex:1},children:[e.jsx("label",{children:"Nombre"}),e.jsx("input",{name:"nombre",defaultValue:s.name,style:{width:"100%",padding:"0.6rem",borderRadius:8,border:"2px solid #222",marginTop:4,fontWeight:600},required:!0})]}),e.jsxs("div",{style:{flex:1},children:[e.jsx("label",{children:"Apellido"}),e.jsx("input",{name:"apellido",defaultValue:s.apellido,style:{width:"100%",padding:"0.6rem",borderRadius:8,border:"1px solid #ccc",marginTop:4},required:!0})]}),e.jsxs("div",{style:{flex:1},children:[e.jsx("label",{children:"Área"}),e.jsx("input",{name:"area",defaultValue:s.area,style:{width:"100%",padding:"0.6rem",borderRadius:8,border:"1px solid #ccc",marginTop:4},required:!0})]})]}),e.jsxs("div",{style:{marginBottom:18},children:[e.jsx("label",{children:"Correo Electrónico"}),e.jsx("input",{name:"email",defaultValue:s.email,style:{width:"100%",padding:"0.6rem",borderRadius:8,border:"1px solid #ccc",marginTop:4},required:!0})]}),e.jsxs("div",{style:{marginBottom:24},children:[e.jsx("label",{children:"Rol"}),e.jsx("select",{name:"rol",defaultValue:s.role,style:{width:"100%",padding:"0.6rem",borderRadius:8,border:"1px solid #ccc",marginTop:4},children:R.filter(t=>t.value).map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"1rem"},children:[e.jsx("button",{type:"button",onClick:()=>n(null),style:{background:"#fff",border:"2px solid #222",borderRadius:8,padding:"0.7rem 2.2rem",fontWeight:600},children:"Cancelar"}),e.jsx("button",{type:"submit",style:{background:"#222",color:"#fff",border:"none",borderRadius:8,padding:"0.7rem 2.2rem",fontWeight:600},children:"Guardar Cambios"})]})]})}),e.jsx(A,{open:!!h,onClose:()=>p(null),children:h&&e.jsxs("form",{onSubmit:async t=>{t.preventDefault();const l=t.target.password.value.trim();if(l.length<6){alert("La contraseña debe tener al menos 6 caracteres");return}try{await d(`/api/users/${h.id}/reset-password`,{method:"POST",body:JSON.stringify({password:l})}),p(null),f(o=>!o)}catch(o){alert(o.message||"Error al restablecer contraseña")}},children:[e.jsx("h2",{style:{marginBottom:8},children:"Restablecer contraseña"}),e.jsxs("div",{style:{color:"#888",marginBottom:18},children:["Escribe la nueva contraseña para el usuario ",e.jsx("b",{children:h.name}),". Debe tener al menos 6 caracteres."]}),e.jsxs("div",{style:{marginBottom:18},children:[e.jsx("label",{children:"Nueva contraseña"}),e.jsx("input",{name:"password",type:"password",minLength:6,style:{width:"100%",padding:"0.6rem",borderRadius:8,border:"1px solid #ccc",marginTop:4},required:!0})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"1rem"},children:[e.jsx("button",{type:"button",onClick:()=>p(null),style:{background:"#fff",border:"2px solid #222",borderRadius:8,padding:"0.7rem 2.2rem",fontWeight:600},children:"Cancelar"}),e.jsx("button",{type:"submit",style:{background:"#222",color:"#fff",border:"none",borderRadius:8,padding:"0.7rem 2.2rem",fontWeight:600},children:"Restablecer"})]})]})}),e.jsx(A,{open:!!u,onClose:()=>m(null),children:u&&e.jsxs("form",{onSubmit:async t=>{if(t.preventDefault(),t.target.confirm.value==="ELIMINAR")try{await d(`/api/users/${u.id}`,{method:"DELETE"}),m(null),f(l=>!l)}catch(l){alert(l.message||"Error al eliminar usuario")}else alert("Debes escribir ELIMINAR para confirmar")},children:[e.jsx("h2",{style:{marginBottom:8},children:"¿Estás absolutamente seguro?"}),e.jsxs("div",{style:{color:"#888",marginBottom:18},children:["Esta acción no se puede deshacer. Esto eliminará permanentemente al usuario ",e.jsx("b",{children:u.name})," y todos sus datos asociados."]}),e.jsxs("div",{style:{marginBottom:18},children:[e.jsxs("label",{children:["Por favor, escribe ",e.jsx("b",{children:"ELIMINAR"})," para confirmar."]}),e.jsx("input",{name:"confirm",style:{width:"100%",padding:"0.6rem",borderRadius:8,border:"1px solid #ccc",marginTop:4},required:!0})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"1rem"},children:[e.jsx("button",{type:"button",onClick:()=>m(null),style:{background:"#fff",border:"2px solid #222",borderRadius:8,padding:"0.7rem 2.2rem",fontWeight:600},children:"Cancelar"}),e.jsx("button",{type:"submit",style:{background:"#e74c3c",color:"#fff",border:"none",borderRadius:8,padding:"0.7rem 2.2rem",fontWeight:600},children:"Sí, eliminar usuario"})]})]})})]},r.id)})]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("button",{disabled:i===1,onClick:()=>x(r=>r-1),children:"Anterior"}),e.jsxs("span",{children:["Página ",i," de ",Math.ceil(S/k)||1]}),e.jsx("button",{disabled:i*k>=S,onClick:()=>x(r=>r+1),children:"Siguiente"})]})]})]})};export{J as default};
//# sourceMappingURL=Usuarios-CZFjZqsq.js.map
