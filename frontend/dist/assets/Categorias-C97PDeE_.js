import{r as s,j as e}from"./index-DEOVmouH.js";import{M as T}from"./ModuloBase-D7hsd1iJ.js";import{T as A,a as q}from"./Toolbar-DzDpkaTp.js";import{T as D}from"./Toast-BeFpd6uA.js";import{l as G,u as z,c as B,d as F}from"./categories-CZDmVj7B.js";import{F as I}from"./FloatingInput-CLfTaFOu.js";function O(){const[c,p]=s.useState([]),[j,v]=s.useState(0),[l,d]=s.useState(1),[N]=s.useState(10),[m,f]=s.useState(!1),[u,w]=s.useState(""),[o,t]=s.useState({show:!1,variant:"success",message:""}),[C,r]=s.useState(!1),[i,y]=s.useState(null),[h,b]=s.useState(""),g=async()=>{try{f(!0);const a=await G({page:l,limit:N,q:u||void 0}),n=Array.isArray(a==null?void 0:a.data)?a.data:(a==null?void 0:a.rows)||a||[];p(n),v((a==null?void 0:a.total)??n.length)}catch(a){t({show:!0,variant:"danger",message:a.message||"No se pudo cargar"})}finally{f(!1)}};s.useEffect(()=>{g()},[l,u]);const S=()=>{y(null),b(""),r(!0)},E=a=>{y(a),b(a.name||""),r(!0)},k=async a=>{a.preventDefault();try{i?await z(i.id,{name:h}):await B({name:h}),t({show:!0,variant:"success",message:i?"Categoría actualizada":"Categoría creada"}),r(!1),g()}catch(n){t({show:!0,variant:"danger",message:n.message||"Error al guardar"})}},M=async a=>{if(window.confirm("¿Eliminar categoría?"))try{await F(a.id),t({show:!0,variant:"success",message:"Eliminado"}),g()}catch(n){t({show:!0,variant:"danger",message:n.message||"Error al eliminar"})}},x=Math.max(1,Math.ceil((j||0)/N));return e.jsxs(T,{titulo:"Gestión de Categorías",descripcion:"Aquí podrás ver, crear, editar y eliminar categorías de proyectos o cotizaciones.",children:[e.jsx(A,{left:e.jsx("div",{className:"row g-2 w-100",children:e.jsxs("div",{className:"col-sm-4",children:[e.jsx("label",{className:"form-label",children:"Buscar"}),e.jsx("input",{className:"form-control",placeholder:"Nombre",value:u,onChange:a=>{w(a.target.value),d(1)}})]})}),right:e.jsx("button",{className:"btn btn-primary",onClick:S,children:"+ Agregar categoría"})}),e.jsx("div",{className:"table-responsive mt-3",children:e.jsxs("table",{className:"table table-striped align-middle",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"ID"}),e.jsx("th",{children:"Nombre"}),e.jsx("th",{style:{width:140},children:"Acciones"})]})}),e.jsxs("tbody",{children:[(c||[]).map(a=>e.jsxs("tr",{children:[e.jsx("td",{children:a.id}),e.jsx("td",{children:a.name}),e.jsxs("td",{className:"d-flex gap-2",children:[e.jsx("button",{className:"btn btn-sm btn-outline-secondary",onClick:()=>E(a),children:"Editar"}),e.jsx("button",{className:"btn btn-sm btn-outline-danger",onClick:()=>M(a),children:"Eliminar"})]})]},a.id)),(!c||c.length===0)&&!m&&e.jsx(q,{colSpan:3,label:"Sin categorías"})]})]})}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{className:"text-muted small",children:["Total: ",j]}),e.jsxs("div",{className:"btn-group",children:[e.jsx("button",{className:"btn btn-outline-secondary",disabled:l<=1,onClick:()=>d(a=>Math.max(1,a-1)),children:"Anterior"}),e.jsxs("span",{className:"btn btn-outline-secondary disabled",children:[l,"/",x]}),e.jsx("button",{className:"btn btn-outline-secondary",disabled:l>=x,onClick:()=>d(a=>Math.min(x,a+1)),children:"Siguiente"})]})]}),C&&e.jsx("div",{className:"modal fade show",style:{display:"block"},children:e.jsx("div",{className:"modal-dialog",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h5",{className:"modal-title",children:[i?"Editar":"Nueva"," categoría"]}),e.jsx("button",{type:"button",className:"btn-close",onClick:()=>r(!1)})]}),e.jsxs("form",{onSubmit:k,children:[e.jsx("div",{className:"modal-body",children:e.jsx(I,{id:"cat-name",label:"Nombre",value:h,onChange:a=>b(a.target.value),required:!0})}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>r(!1),children:"Cancelar"}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:m,children:m?"Guardando...":"Guardar"})]})]})]})})}),e.jsx(D,{show:o.show,variant:o.variant,onClose:()=>t({...o,show:!1}),children:o.message})]})}export{O as default};
//# sourceMappingURL=Categorias-C97PDeE_.js.map
