import{r as l,P as Re,E as Ge,c as X,G as Z,j as e,n as m,B as o,p as He,v as $,O as ee,H as Je,U as ye,V as Qe,f as We,Q as _e,W as Ye,K as Ve,X as P,d as Ke}from"./index-VjS0hY4d.js";import{P as Ze}from"./PageHeader-s2EwJBI9.js";import{D as ea}from"./DataTable-DC-fV_34.js";import{S as R}from"./StatsCard-CQWt6EQk.js";import{M as ae}from"./Modal-DlEZCcrX.js";import{T as aa}from"./Toast-CGuZ55WP.js";import{d as sa,u as ia,b as ta,a as ra,g as ca}from"./attachments-B0ysfLLF.js";import{l as la}from"./projects-x-AZJvXx.js";import{l as na,a as oa}from"./categories-CYZIxNuw.js";import{C as Ne}from"./CompanyProjectPicker-B5QY6E6K.js";import{R as f,C as r}from"./Row-Ra1wnXQ8.js";import{C as p}from"./Card-Bl_n2eis.js";import{A as Ce}from"./Alert-CpcGC_BM.js";import{F as t}from"./Form-f81hzvzI.js";import{P as da}from"./ProgressBar-CyM_H3Y2.js";import{S as D}from"./Spinner-CSZmUozg.js";import"./InputGroup-D28bQjEt.js";import"./Table-BrpyFtCQ.js";import"./companies-CMTUE1PH.js";import"./ElementChildren-DGNtIhpN.js";const qe={project_id:"",company_id:"",company:null,project:null,project_name:"",location:"",description:"",file:null,category_id:"",subcategory_id:"",requiere_laboratorio:!1,requiere_ingenieria:!1,requiere_consultoria:!1,requiere_capacitacion:!1,requiere_auditoria:!1};function Fa(){var je;const[G,H]=l.useState(1),[F]=l.useState(20),[J,se]=l.useState(""),[ie,Se]=l.useState(""),[te,ke]=l.useState(""),[re,v]=l.useState({message:"",type:"success",show:!1}),Q=Re(),[j,Ae]=l.useState({company_id:null,company:null,project_id:null,project:null,project_name:"",location:""}),[L,N]=l.useState(!1),[z,C]=l.useState(!1),[i,n]=l.useState(qe),[u,ce]=l.useState(null),[g,w]=l.useState(null),[le,ne]=l.useState(0),[Pe,W]=l.useState(!1),De=Ge();l.useEffect(()=>{var a;(a=Q.state)!=null&&a.search&&se(Q.state.search)},[Q.state]);const{data:y,isLoading:q,refetch:Fe}=X(["allAttachments",G,F,J,ie,te,j.project_id],()=>ca({page:G,limit:F,search:J,project_id:j.project_id||ie,file_type:te}),{keepPreviousData:!0,refetchOnWindowFocus:!1,staleTime:3e4}),{data:E}=X("projectsList",()=>la({page:1,limit:500}),{staleTime:1/0}),S=l.useMemo(()=>(E==null?void 0:E.data)||[],[E]),{data:oe,refetch:de}=X("categoriesList",na,{staleTime:3e4,refetchOnWindowFocus:!0}),T=l.useMemo(()=>oe||[],[oe]),{data:me,refetch:ue}=X("subcategoriesList",()=>oa(),{staleTime:3e4,refetchOnWindowFocus:!0}),M=l.useMemo(()=>me||[],[me]);l.useMemo(()=>S.find(a=>a.id===parseInt(i.project_id)),[S,i.project_id]),l.useMemo(()=>u?S.find(a=>a.id===parseInt(u.project_id)):null,[S,u]);const k=()=>{de(),ue()};l.useEffect(()=>{(L||z)&&k()},[L,z,de,ue]);const Y=a=>{v({message:a,type:"success",show:!0}),De.invalidateQueries("allAttachments"),N(!1),C(!1),n(qe),ce(null),w(null),ne(0)},V=(a,s)=>{v({message:(a==null?void 0:a.message)||s,type:"error",show:!0}),ne(0)},x=Z(a=>ia(i.project_id,a),{onSuccess:()=>Y("Archivo subido correctamente."),onError:a=>V(a,"Error al subir archivo.")}),b=Z(({id:a,formData:s})=>ta(a,s),{onSuccess:()=>Y("Archivo actualizado correctamente."),onError:a=>V(a,"Error al actualizar archivo.")}),I=Z(ra,{onSuccess:()=>Y("Adjunto eliminado correctamente."),onError:a=>V(a,"Error al eliminar adjunto.")}),he=a=>{if(a.preventDefault(),!i.file||!i.project_id){v({message:"Debe seleccionar un proyecto y un archivo.",type:"error",show:!0});return}const s=new FormData;s.append("file",i.file),s.append("description",i.description||""),i.category_id&&s.append("category_id",i.category_id),i.subcategory_id&&s.append("subcategory_id",i.subcategory_id),s.append("requiere_laboratorio",i.requiere_laboratorio),s.append("requiere_ingenieria",i.requiere_ingenieria),s.append("requiere_consultoria",i.requiere_consultoria),s.append("requiere_capacitacion",i.requiere_capacitacion),s.append("requiere_auditoria",i.requiere_auditoria),x.mutate(s)},Le=a=>{ce(a),n({project_id:a.project_id,description:a.description||"",file:null,category_id:a.category_id||"",subcategory_id:a.subcategory_id||"",requiere_laboratorio:a.requiere_laboratorio||!1,requiere_ingenieria:a.requiere_ingenieria||!1,requiere_consultoria:a.requiere_consultoria||!1,requiere_capacitacion:a.requiere_capacitacion||!1,requiere_auditoria:a.requiere_auditoria||!1}),C(!0)},xe=a=>{if(a.preventDefault(),!u)return;const s={description:i.description||"",category_id:i.category_id||null,subcategory_id:i.subcategory_id||null,requiere_laboratorio:i.requiere_laboratorio,requiere_ingenieria:i.requiere_ingenieria,requiere_consultoria:i.requiere_consultoria,requiere_capacitacion:i.requiere_capacitacion,requiere_auditoria:i.requiere_auditoria};console.log("🔄 handleEditSubmit - Editing attachment ID:",u.id),console.log("🔄 handleEditSubmit - Upload form data:",i),console.log("🔄 handleEditSubmit - Update data:",s);const c=new FormData;i.file&&c.append("file",i.file),Object.keys(s).forEach(d=>{s[d]!==null&&s[d]!==void 0&&(c.append(d,s[d]),console.log(`🔄 FormData - ${d}:`,s[d]))}),console.log("🔄 FormData entries:");for(let[d,A]of c.entries())console.log(`  ${d}:`,A);b.mutate({id:u.id,formData:c})},ze=()=>{g&&I.mutate(g.id)},we=async a=>{try{await sa(a),v({message:"Descarga iniciada correctamente.",type:"success",show:!0})}catch(s){console.error("Error al descargar archivo:",s),v({message:"Error al descargar el archivo.",type:"error",show:!0})}},Ee=a=>{a.preventDefault(),a.stopPropagation(),W(!0)},Te=a=>{a.preventDefault(),a.stopPropagation(),W(!1)},Me=a=>{a.preventDefault(),a.stopPropagation()},Ie=a=>{a.preventDefault(),a.stopPropagation(),W(!1);const s=a.dataTransfer.files;s&&s[0]&&n(c=>({...c,file:s[0]}))},Be=a=>{Se(a.project_id||""),ke(a.file_type||""),H(1)},K=a=>{var c;switch((c=a.split(".").pop())==null?void 0:c.toLowerCase()){case"pdf":return"📄";case"doc":case"docx":return"📝";case"xls":case"xlsx":return"📊";case"ppt":case"pptx":return"📈";case"jpg":case"jpeg":case"png":case"gif":return"🖼️";case"txt":return"📃";default:return"📎"}},Oe=a=>{var d;const s=(d=a.split(".").pop())==null?void 0:d.toLowerCase();return{pdf:{variant:"danger",text:"PDF"},doc:{variant:"primary",text:"DOC"},docx:{variant:"primary",text:"DOCX"},xls:{variant:"success",text:"XLS"},xlsx:{variant:"success",text:"XLSX"},ppt:{variant:"warning",text:"PPT"},pptx:{variant:"warning",text:"PPTX"},jpg:{variant:"info",text:"JPG"},jpeg:{variant:"info",text:"JPEG"},png:{variant:"info",text:"PNG"},gif:{variant:"info",text:"GIF"},txt:{variant:"secondary",text:"TXT"}}[s]||{variant:"secondary",text:(s==null?void 0:s.toUpperCase())||"FILE"}},_=a=>({admin:{variant:"danger",text:"Admin"},jefa_comercial:{variant:"primary",text:"Jefa Comercial"},jefe_laboratorio:{variant:"info",text:"Jefe Lab"},vendedor_comercial:{variant:"success",text:"Vendedor"},usuario_laboratorio:{variant:"warning",text:"Lab User"}})[a]||{variant:"secondary",text:a||"N/A"},pe=a=>({activo:{variant:"success",text:"Activo"},pendiente:{variant:"warning",text:"Pendiente"},completado:{variant:"primary",text:"Completado"},cancelado:{variant:"danger",text:"Cancelado"},pausado:{variant:"secondary",text:"Pausado"}})[a]||{variant:"secondary",text:a||"N/A"},Ue=l.useMemo(()=>[{header:"ID",accessor:"id",width:60},{header:"Proyecto",accessor:"project_name",render:(a,s)=>e.jsxs("div",{children:[e.jsx("div",{className:"fw-medium",children:a||"Sin proyecto"}),e.jsxs("div",{className:"small text-muted",children:[e.jsxs("div",{children:["📍 ",s.project_location||"Sin ubicación"]}),e.jsxs("div",{className:"d-flex align-items-center gap-2 mt-1",children:[e.jsx(m,{bg:pe(s.project_status).variant,className:"small",children:pe(s.project_status).text}),s.project_priority&&e.jsx(m,{bg:s.project_priority==="urgent"?"danger":s.project_priority==="high"?"warning":"info",className:"small",children:s.project_priority})]})]})]})},{header:"Empresa",accessor:"company_name",render:(a,s)=>e.jsxs("div",{children:[e.jsx("div",{className:"fw-medium",children:a||"Sin empresa"}),e.jsxs("small",{className:"text-muted",children:["RUC: ",s.company_ruc||"N/A"]})]})},{header:"Archivo",accessor:"original_name",render:(a,s)=>{const c=Oe(a);return e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("span",{className:"me-2",style:{fontSize:"1.2em"},children:K(a)}),e.jsxs("div",{children:[e.jsx("div",{className:"fw-medium",children:a}),e.jsx(m,{bg:c.variant,className:"small",children:c.text})]})]})}},{header:"Categorías",accessor:"category_name",render:(a,s)=>e.jsxs("div",{children:[a&&e.jsx("div",{className:"mb-1",children:e.jsxs(m,{bg:"primary",className:"small",children:["📁 ",a]})}),s.subcategory_name&&e.jsx("div",{children:e.jsxs(m,{bg:"info",className:"small",children:["📂 ",s.subcategory_name]})}),!a&&!s.subcategory_name&&e.jsx("span",{className:"text-muted small",children:"Sin categoría"})]})},{header:"Servicios",accessor:"requiere_laboratorio",render:(a,s)=>e.jsxs("div",{className:"d-flex flex-wrap gap-1",children:[s.requiere_laboratorio&&e.jsx(m,{bg:"warning",className:"small",children:"🧪 Lab"}),s.requiere_ingenieria&&e.jsx(m,{bg:"info",className:"small",children:"⚙️ Ing"}),s.requiere_consultoria&&e.jsx(m,{bg:"success",className:"small",children:"💼 Cons"}),s.requiere_capacitacion&&e.jsx(m,{bg:"primary",className:"small",children:"🎓 Cap"}),s.requiere_auditoria&&e.jsx(m,{bg:"secondary",className:"small",children:"📋 Aud"}),!s.requiere_laboratorio&&!s.requiere_ingenieria&&!s.requiere_consultoria&&!s.requiere_capacitacion&&!s.requiere_auditoria&&e.jsx("span",{className:"text-muted small",children:"Sin servicios"})]})},{header:"Roles",accessor:"vendedor_name",render:(a,s)=>e.jsxs("div",{children:[a&&e.jsx("div",{className:"mb-1",children:e.jsxs("div",{className:"small",children:[e.jsx(m,{bg:_(s.vendedor_role).variant,className:"small me-1",children:_(s.vendedor_role).text}),e.jsx("span",{className:"text-muted",children:a})]})}),s.laboratorio_name&&e.jsxs("div",{className:"small",children:[e.jsx(m,{bg:_(s.laboratorio_role).variant,className:"small me-1",children:_(s.laboratorio_role).text}),e.jsx("span",{className:"text-muted",children:s.laboratorio_name})]}),!a&&!s.laboratorio_name&&e.jsx("span",{className:"text-muted small",children:"Sin asignación"})]})},{header:"Subido por",accessor:"uploaded_by_name",render:(a,s)=>e.jsxs("div",{children:[e.jsx("div",{className:"fw-medium",children:a||"Usuario desconocido"}),e.jsx("div",{className:"small",children:e.jsx(m,{bg:_(s.uploaded_by_role).variant,className:"small",children:_(s.uploaded_by_role).text})})]})},{header:"Fecha",accessor:"created_at",render:a=>e.jsxs("div",{children:[e.jsx("div",{children:new Date(a).toLocaleDateString()}),e.jsx("small",{className:"text-muted",children:new Date(a).toLocaleTimeString()})]}),width:120},{header:"Acciones",accessor:"actions",width:180,render:(a,s)=>e.jsxs("div",{className:"d-flex gap-1",children:[e.jsx(o,{variant:"outline-primary",size:"sm",onClick:()=>we(s),title:"Descargar",children:e.jsx(He,{})}),e.jsx(o,{variant:"outline-success",size:"sm",onClick:()=>Le(s),title:"Editar",children:e.jsx($,{})}),e.jsx(o,{variant:"outline-danger",size:"sm",onClick:()=>w(s),title:"Eliminar",children:e.jsx(ee,{})})]})}],[]),B=(y==null?void 0:y.data)||[],O=(y==null?void 0:y.total)||0,Xe=Math.max(1,Math.ceil(O/F)),U=l.useMemo(()=>{const a={},s=new Set,c=new Set,d=new Set,A=new Set;let ge=0;return B.forEach(h=>{var fe,ve;const be=((ve=(fe=h.original_name)==null?void 0:fe.split(".").pop())==null?void 0:ve.toLowerCase())||"unknown";a[be]=(a[be]||0)+1,h.project_id&&s.add(h.project_id),h.category_name&&c.add(h.category_name),h.subcategory_name&&d.add(h.subcategory_name),h.vendedor_name&&A.add("vendedor"),h.laboratorio_name&&A.add("laboratorio"),h.file_size&&(ge+=parseInt(h.file_size))}),{total:O,totalFiles:B.length,totalProjects:s.size,totalCategories:c.size,totalSubcategories:d.size,totalRoles:A.size,fileTypes:Object.keys(a).length,totalSize:(ge/1024/1024).toFixed(1)+" MB"}},[B,O]),$e=[{title:"Por Proyecto",options:S.map(a=>({label:`${a.name} - ${a.location}`,filter:{project_id:a.id}}))},{title:"Por Tipo de Archivo",options:[{label:"📄 PDF",filter:{file_type:"pdf"}},{label:"📝 Documentos",filter:{file_type:"doc"}},{label:"📊 Excel",filter:{file_type:"xls"}},{label:"🖼️ Imágenes",filter:{file_type:"img"}}]},{title:"Por Estado de Proyecto",options:[{label:"🟢 Activos",filter:{project_status:"activo"}},{label:"🟡 Pendientes",filter:{project_status:"pendiente"}},{label:"🔵 Completados",filter:{project_status:"completado"}},{label:"🔴 Cancelados",filter:{project_status:"cancelado"}}]}];return e.jsxs(e.Fragment,{children:[e.jsxs(Je,{fluid:!0,className:"py-4",children:[e.jsx(Ze,{title:"Gestión de Adjuntos",subtitle:"Archivos relacionados a proyectos y cotizaciones",icon:ye}),e.jsxs(f,{className:"mb-4",children:[e.jsx(r,{md:6,lg:3,children:e.jsx(R,{title:"Total Archivos",value:U.total,icon:Qe,color:"primary",subtitle:"Archivos en el sistema",loading:q})}),e.jsx(r,{md:6,lg:3,children:e.jsx(R,{title:"Proyectos",value:U.totalProjects,icon:ye,color:"info",subtitle:"Con archivos adjuntos",loading:q})}),e.jsx(r,{md:6,lg:3,children:e.jsx(R,{title:"Categorías",value:U.totalCategories,icon:We,color:"success",subtitle:"Con archivos asignados",loading:q})}),e.jsx(r,{md:6,lg:3,children:e.jsx(R,{title:"Espacio Usado",value:U.totalSize,icon:_e,color:"warning",subtitle:"Almacenamiento total",loading:q})})]}),e.jsx(p,{className:"mb-4",children:e.jsx(p.Body,{children:e.jsx(f,{children:e.jsxs(r,{md:12,children:[e.jsx("h6",{className:"mb-3",children:"Filtro por Cliente y Proyecto"}),e.jsx(Ne,{value:j,onChange:Ae}),j.project&&e.jsx("div",{className:"mt-3",children:e.jsx(Ce,{variant:"info",className:"py-2",children:e.jsxs("small",{children:[e.jsx("strong",{children:"Proyecto seleccionado:"})," ",j.project.name," |",e.jsx("strong",{children:" Cliente:"})," ",(je=j.company)==null?void 0:je.name," |",e.jsx("strong",{children:" Ubicación:"})," ",j.project.location]})})})]})})})}),e.jsx(p,{className:"mb-4",children:e.jsx(p.Body,{children:e.jsxs(f,{className:"align-items-center",children:[e.jsx(r,{md:6,children:e.jsxs("div",{className:"d-flex gap-2",children:[e.jsxs("div",{className:"position-relative flex-grow-1",children:[e.jsx(Ye,{className:"position-absolute top-50 start-0 translate-middle-y ms-3 text-muted"}),e.jsx(t.Control,{type:"text",placeholder:"Buscar por archivo, proyecto...",value:J,onChange:a=>{se(a.target.value),H(1)},className:"ps-5"})]}),e.jsx(o,{variant:"outline-secondary",onClick:()=>Fe(),title:"Actualizar",children:e.jsx(Ve,{})})]})}),e.jsx(r,{md:6,className:"text-end",children:e.jsx("div",{className:"d-flex gap-2 justify-content-end",children:e.jsxs(o,{variant:"outline-primary",onClick:()=>N(!0),children:[e.jsx(P,{className:"me-2"}),"Subir Archivo"]})})})]})})}),e.jsx(p,{children:e.jsx(p.Body,{className:"p-0",children:e.jsx(ea,{columns:Ue,data:B,loading:q,currentPage:G,totalPages:Xe,onPageChange:H,totalItems:O,itemsPerPage:F,filterOptions:$e,onFilter:Be,emptyMessage:"No hay archivos adjuntos",emptyDescription:"Sube tu primer archivo usando el botón 'Subir Archivo'"})})})]}),L&&e.jsxs(ae,{open:L,onClose:()=>N(!1),size:"xl",className:"adjuntos-modal",children:[e.jsx("div",{className:"modal-header",children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx(P,{className:"me-2 text-primary",size:24}),e.jsx("h4",{className:"mb-0",children:"Subir Archivo Adjunto"})]})}),e.jsx("div",{className:"modal-body",children:e.jsxs("form",{onSubmit:he,children:[e.jsxs(f,{className:"g-3",children:[e.jsxs(r,{md:12,children:[e.jsx(t.Label,{className:"fw-medium",children:"Cliente y Proyecto *"}),e.jsx(Ne,{value:{company_id:i.company_id||null,company:i.company||null,project_id:i.project_id||null,project:i.project||null,project_name:i.project_name||"",location:i.location||""},onChange:a=>{n(s=>{var c,d;return{...s,company_id:a.company_id,company:a.company,project_id:a.project_id,project:a.project,project_name:a.project_name,location:a.location,category_id:((c=a.project)==null?void 0:c.category_id)||"",subcategory_id:((d=a.project)==null?void 0:d.subcategory_id)||""}})}})]}),e.jsxs(r,{md:12,children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[e.jsx(t.Label,{className:"fw-medium mb-0",children:"Categorías Disponibles"}),e.jsx(o,{variant:"outline-secondary",size:"sm",onClick:k,title:"Actualizar lista de categorías",children:"🔄 Actualizar"})]}),e.jsx("div",{className:"border rounded p-3 bg-light",style:{maxHeight:"200px",overflowY:"auto"},children:T.length>0?T.map(a=>e.jsx(t.Check,{type:"checkbox",id:`category-${a.id}`,label:`📁 ${a.name}`,checked:i.category_id===a.id,onChange:s=>n(c=>({...c,category_id:s.target.checked?a.id:""})),className:"mb-2"},a.id)):e.jsx("p",{className:"text-muted mb-0",children:"No hay categorías disponibles"})}),e.jsx(t.Text,{className:"text-muted d-block mt-1",children:"Selecciona una categoría para asignar al archivo"})]}),e.jsxs(r,{md:12,children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[e.jsx(t.Label,{className:"fw-medium mb-0",children:"Subcategorías Disponibles"}),e.jsx(o,{variant:"outline-secondary",size:"sm",onClick:k,title:"Actualizar lista de subcategorías",children:"🔄 Actualizar"})]}),e.jsx("div",{className:"border rounded p-3 bg-light",style:{maxHeight:"200px",overflowY:"auto"},children:M.length>0?M.map(a=>e.jsx(t.Check,{type:"checkbox",id:`subcategory-${a.id}`,label:`📂 ${a.name}`,checked:i.subcategory_id===a.id,onChange:s=>n(c=>({...c,subcategory_id:s.target.checked?a.id:""})),className:"mb-2"},a.id)):e.jsx("p",{className:"text-muted mb-0",children:"No hay subcategorías disponibles"})}),e.jsx(t.Text,{className:"text-muted d-block mt-1",children:"Selecciona una subcategoría para asignar al archivo"})]}),e.jsxs(r,{md:12,children:[e.jsx(t.Label,{className:"fw-medium",children:"Descripción (Opcional)"}),e.jsx(t.Control,{as:"textarea",rows:3,value:i.description,onChange:a=>n(s=>({...s,description:a.target.value})),placeholder:"Describe el contenido del archivo..."})]}),e.jsxs(r,{md:12,children:[e.jsx(t.Label,{className:"fw-medium",children:"Servicios Requeridos"}),e.jsxs("div",{className:"border rounded p-3 bg-light",children:[e.jsxs(f,{children:[e.jsx(r,{md:6,children:e.jsx(t.Check,{type:"checkbox",id:"upload-requiere-laboratorio",label:"🧪 Laboratorio",checked:i.requiere_laboratorio,onChange:a=>n(s=>({...s,requiere_laboratorio:a.target.checked}))})}),e.jsx(r,{md:6,children:e.jsx(t.Check,{type:"checkbox",id:"upload-requiere-ingenieria",label:"⚙️ Ingeniería",checked:i.requiere_ingenieria,onChange:a=>n(s=>({...s,requiere_ingenieria:a.target.checked}))})}),e.jsx(r,{md:6,children:e.jsx(t.Check,{type:"checkbox",id:"upload-requiere-consultoria",label:"💼 Consultoría",checked:i.requiere_consultoria,onChange:a=>n(s=>({...s,requiere_consultoria:a.target.checked}))})}),e.jsx(r,{md:6,children:e.jsx(t.Check,{type:"checkbox",id:"upload-requiere-capacitacion",label:"🎓 Capacitación",checked:i.requiere_capacitacion,onChange:a=>n(s=>({...s,requiere_capacitacion:a.target.checked}))})}),e.jsx(r,{md:6,children:e.jsx(t.Check,{type:"checkbox",id:"upload-requiere-auditoria",label:"📋 Auditoría",checked:i.requiere_auditoria,onChange:a=>n(s=>({...s,requiere_auditoria:a.target.checked}))})})]}),e.jsx(t.Text,{className:"text-muted d-block mt-2",children:"Marca los servicios que requiere este archivo"})]})]}),e.jsxs(r,{md:12,children:[e.jsx(t.Label,{className:"fw-medium",children:"Archivo *"}),e.jsx("div",{className:`border-2 border-dashed rounded p-4 text-center ${Pe?"border-primary bg-light":"border-secondary"}`,onDragEnter:Ee,onDragLeave:Te,onDragOver:Me,onDrop:Ie,style:{minHeight:"120px",cursor:"pointer"},onClick:()=>document.getElementById("fileInput").click(),children:i.file?e.jsxs("div",{children:[e.jsx(Ke,{className:"text-success mb-2",size:32}),e.jsx("div",{className:"fw-medium",children:i.file.name}),e.jsxs("small",{className:"text-muted",children:[(i.file.size/1024/1024).toFixed(2)," MB"]})]}):e.jsxs("div",{children:[e.jsx(P,{className:"text-muted mb-2",size:32}),e.jsx("div",{className:"fw-medium",children:"Arrastra y suelta tu archivo aquí"}),e.jsx("small",{className:"text-muted",children:"o haz clic para seleccionar"}),e.jsx("div",{className:"mt-2",children:e.jsx("small",{className:"text-muted",children:"Formatos permitidos: PDF, DOC, DOCX, XLS, XLSX, PPT, PPTX, JPG, PNG, GIF, TXT"})})]})}),e.jsx(t.Control,{id:"fileInput",type:"file",className:"d-none",onChange:a=>n(s=>({...s,file:a.target.files[0]})),accept:".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.jpg,.jpeg,.png,.gif,.txt",required:!0})]})]}),x.isLoading&&e.jsxs("div",{className:"mt-3",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[e.jsx("small",{children:"Subiendo archivo..."}),e.jsxs("small",{children:[le,"%"]})]}),e.jsx(da,{now:le,animated:!0})]}),e.jsxs("div",{className:"d-flex justify-content-end gap-2 mt-4",children:[e.jsx(o,{type:"button",variant:"outline-secondary",onClick:()=>N(!1),disabled:x.isLoading,children:"Cancelar"}),e.jsx(o,{type:"submit",variant:"primary",disabled:x.isLoading||!i.file||!i.project_id,children:x.isLoading?e.jsxs(e.Fragment,{children:[e.jsx(D,{size:"sm",className:"me-2"}),"Subiendo..."]}):e.jsxs(e.Fragment,{children:[e.jsx(P,{className:"me-2"}),"Subir Archivo"]})})]})]})}),e.jsx("div",{className:"modal-footer",children:e.jsxs("div",{className:"d-flex gap-2 justify-content-end",children:[e.jsx(o,{type:"button",variant:"outline-secondary",onClick:()=>N(!1),disabled:x.isLoading,children:"Cancelar"}),e.jsx(o,{type:"submit",variant:"primary",disabled:x.isLoading,onClick:he,children:x.isLoading?e.jsxs(e.Fragment,{children:[e.jsx(D,{size:"sm",className:"me-2"}),"Subiendo..."]}):e.jsxs(e.Fragment,{children:[e.jsx(P,{className:"me-2"}),"Subir Archivo"]})})]})})]}),z&&u&&e.jsxs(ae,{open:z,onClose:()=>C(!1),size:"xl",className:"adjuntos-modal",children:[e.jsx("div",{className:"modal-header",children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx($,{className:"me-2 text-success",size:24}),e.jsx("h4",{className:"mb-0",children:"Editar Archivo Adjunto"})]})}),e.jsx("div",{className:"modal-body",children:e.jsxs("form",{onSubmit:xe,children:[e.jsxs(f,{className:"g-3",children:[e.jsxs(r,{md:12,children:[e.jsx(t.Label,{className:"fw-medium",children:"Proyecto"}),e.jsx(t.Control,{type:"text",value:u.project_name||"Sin proyecto",readOnly:!0,className:"bg-light"})]}),e.jsxs(r,{md:12,children:[e.jsx(t.Label,{className:"fw-medium",children:"Archivo Actual"}),e.jsxs("div",{className:"d-flex align-items-center p-3 bg-light rounded",children:[e.jsx("span",{className:"me-2",style:{fontSize:"1.2em"},children:K(u.original_name)}),e.jsxs("div",{children:[e.jsx("div",{className:"fw-medium",children:u.original_name}),e.jsxs("small",{className:"text-muted",children:[(u.file_size/1024/1024).toFixed(2)," MB"]})]})]})]}),e.jsxs(r,{md:12,children:[e.jsx(t.Label,{className:"fw-medium",children:"Nuevo Archivo (Opcional)"}),e.jsx(t.Control,{type:"file",onChange:a=>n(s=>({...s,file:a.target.files[0]})),accept:".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.jpg,.jpeg,.png,.gif,.txt"}),e.jsx(t.Text,{className:"text-muted",children:"Deja vacío para mantener el archivo actual"})]}),e.jsxs(r,{md:12,children:[e.jsx(t.Label,{className:"fw-medium",children:"Descripción"}),e.jsx(t.Control,{as:"textarea",rows:3,value:i.description,onChange:a=>n(s=>({...s,description:a.target.value})),placeholder:"Describe el contenido del archivo..."})]}),e.jsxs(r,{md:12,children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[e.jsx(t.Label,{className:"fw-medium mb-0",children:"Categorías Disponibles"}),e.jsx(o,{variant:"outline-secondary",size:"sm",onClick:k,title:"Actualizar lista de categorías",children:"🔄 Actualizar"})]}),e.jsx("div",{className:"border rounded p-3 bg-light",style:{maxHeight:"200px",overflowY:"auto"},children:T.length>0?T.map(a=>e.jsx(t.Check,{type:"checkbox",id:`edit-category-${a.id}`,label:`📁 ${a.name}`,checked:i.category_id===a.id,onChange:s=>n(c=>({...c,category_id:s.target.checked?a.id:""})),className:"mb-2"},a.id)):e.jsx("p",{className:"text-muted mb-0",children:"No hay categorías disponibles"})}),e.jsx(t.Text,{className:"text-muted d-block mt-1",children:"Selecciona una categoría para asignar al archivo"})]}),e.jsxs(r,{md:12,children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[e.jsx(t.Label,{className:"fw-medium mb-0",children:"Subcategorías Disponibles"}),e.jsx(o,{variant:"outline-secondary",size:"sm",onClick:k,title:"Actualizar lista de subcategorías",children:"🔄 Actualizar"})]}),e.jsx("div",{className:"border rounded p-3 bg-light",style:{maxHeight:"200px",overflowY:"auto"},children:M.length>0?M.map(a=>e.jsx(t.Check,{type:"checkbox",id:`edit-subcategory-${a.id}`,label:`📂 ${a.name}`,checked:i.subcategory_id===a.id,onChange:s=>n(c=>({...c,subcategory_id:s.target.checked?a.id:""})),className:"mb-2"},a.id)):e.jsx("p",{className:"text-muted mb-0",children:"No hay subcategorías disponibles"})}),e.jsx(t.Text,{className:"text-muted d-block mt-1",children:"Selecciona una subcategoría para asignar al archivo"})]}),e.jsxs(r,{md:12,children:[e.jsx(t.Label,{className:"fw-medium",children:"Servicios Requeridos"}),e.jsxs("div",{className:"border rounded p-3 bg-light",children:[e.jsxs(f,{children:[e.jsx(r,{md:6,children:e.jsx(t.Check,{type:"checkbox",id:"requiere-laboratorio",label:"🧪 Laboratorio",checked:i.requiere_laboratorio,onChange:a=>n(s=>({...s,requiere_laboratorio:a.target.checked}))})}),e.jsx(r,{md:6,children:e.jsx(t.Check,{type:"checkbox",id:"requiere-ingenieria",label:"⚙️ Ingeniería",checked:i.requiere_ingenieria,onChange:a=>n(s=>({...s,requiere_ingenieria:a.target.checked}))})}),e.jsx(r,{md:6,children:e.jsx(t.Check,{type:"checkbox",id:"requiere-consultoria",label:"💼 Consultoría",checked:i.requiere_consultoria,onChange:a=>n(s=>({...s,requiere_consultoria:a.target.checked}))})}),e.jsx(r,{md:6,children:e.jsx(t.Check,{type:"checkbox",id:"requiere-capacitacion",label:"🎓 Capacitación",checked:i.requiere_capacitacion,onChange:a=>n(s=>({...s,requiere_capacitacion:a.target.checked}))})}),e.jsx(r,{md:6,children:e.jsx(t.Check,{type:"checkbox",id:"requiere-auditoria",label:"📋 Auditoría",checked:i.requiere_auditoria,onChange:a=>n(s=>({...s,requiere_auditoria:a.target.checked}))})})]}),e.jsx(t.Text,{className:"text-muted d-block mt-2",children:"Marca los servicios que requiere este archivo"})]})]})]}),e.jsxs("div",{className:"d-flex justify-content-end gap-2 mt-4",children:[e.jsx(o,{type:"button",variant:"outline-secondary",onClick:()=>C(!1),disabled:b.isLoading,children:"Cancelar"}),e.jsx(o,{type:"submit",variant:"success",disabled:b.isLoading,children:b.isLoading?e.jsxs(e.Fragment,{children:[e.jsx(D,{size:"sm",className:"me-2"}),"Actualizando..."]}):e.jsxs(e.Fragment,{children:[e.jsx($,{className:"me-2"}),"Actualizar Archivo"]})})]})]})}),e.jsx("div",{className:"modal-footer",children:e.jsxs("div",{className:"d-flex gap-2 justify-content-end",children:[e.jsx(o,{type:"button",variant:"outline-secondary",onClick:()=>C(!1),disabled:b.isLoading,children:"Cancelar"}),e.jsx(o,{type:"submit",variant:"success",disabled:b.isLoading,onClick:xe,children:b.isLoading?e.jsxs(e.Fragment,{children:[e.jsx(D,{size:"sm",className:"me-2"}),"Actualizando..."]}):e.jsxs(e.Fragment,{children:[e.jsx($,{className:"me-2"}),"Actualizar Archivo"]})})]})})]}),g&&e.jsx(ae,{open:!!g,onClose:()=>w(null),children:e.jsxs("div",{children:[e.jsxs("div",{className:"d-flex align-items-center mb-4",children:[e.jsx(ee,{className:"me-2 text-danger",size:24}),e.jsx("h4",{className:"mb-0",children:"Confirmar Eliminación"})]}),e.jsxs(Ce,{variant:"warning",className:"mb-4",children:[e.jsx(_e,{className:"me-2"}),e.jsx("strong",{children:"¡Atención!"})," Esta acción no se puede deshacer."]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{children:"¿Estás seguro de que quieres eliminar el siguiente archivo?"}),e.jsx(p,{className:"bg-light",children:e.jsx(p.Body,{children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("span",{className:"me-3",style:{fontSize:"1.5em"},children:K(g.original_name)}),e.jsxs("div",{children:[e.jsx("div",{className:"fw-medium",children:g.original_name}),e.jsxs("small",{className:"text-muted",children:["Proyecto: ",g.project_name||"Sin proyecto"]})]})]})})})]}),e.jsxs("div",{className:"d-flex justify-content-end gap-2",children:[e.jsx(o,{variant:"outline-secondary",onClick:()=>w(null),disabled:I.isLoading,children:"Cancelar"}),e.jsx(o,{variant:"danger",onClick:ze,disabled:I.isLoading,children:I.isLoading?e.jsxs(e.Fragment,{children:[e.jsx(D,{size:"sm",className:"me-2"}),"Eliminando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ee,{className:"me-2"}),"Eliminar Archivo"]})})]})]})}),e.jsx(aa,{message:re.message,type:re.type,onClose:()=>v({message:"",type:"success",show:!1})})]})}export{Fa as default};
//# sourceMappingURL=Adjuntos-pfb1WQi_.js.map
