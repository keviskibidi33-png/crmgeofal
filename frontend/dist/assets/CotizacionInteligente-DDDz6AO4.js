import{r as n,e as ta,j as e,C as me,F as oa,V as na,a7 as sa,o as ca,Q as ra,a1 as _e,K as la,n as ia,W as da,B as ne,a3 as ma,y as Ee,a8 as ua,$ as pa}from"./index-Cuktr-pt.js";import{M as ha}from"./ModuloBase-BhBuNKRm.js";import{g as ga,u as xa,c as ja}from"./quotes-B7ZC9qfO.js";import{s as Oe,l as fa,c as ba}from"./projects-Bepwnn11.js";import{l as Na,f as ya}from"./companies-CyyHtdeS.js";import{s as va}from"./subservices-qxTsHPEW.js";import{S as ue}from"./Spinner-B39M6lL3.js";import{F as Se}from"./Form-luTHskiS.js";import{S as Ca}from"./SuccessModal-Cpw2-i9u.js";import{M as J}from"./Modal-DX3fBC5J.js";import{A as se}from"./Alert-D03HJGca.js";import{L as Ae}from"./ListGroup-C8_pvorp.js";/* empty css                     */import"./ElementChildren-CA6H3NXv.js";import"./Col-nNxAn9NL.js";const _a=({value:f="",onChange:h,onSelect:d,placeholder:_="Buscar servicio...",disabled:G=!1,size:D="sm"})=>{const[b,s]=n.useState(f),[u,m]=n.useState(!1),[w,r]=n.useState({top:0,left:0,width:0}),x=n.useRef(null),v=n.useRef(null),[O,k]=n.useState(b);n.useEffect(()=>{const i=setTimeout(()=>k(b),400);return()=>clearTimeout(i)},[b]);const{data:R,isLoading:I}=ta(["subservices",O],()=>va(O),{enabled:O.length>=2,staleTime:10*60*1e3,keepPreviousData:!0,refetchOnWindowFocus:!1}),l=(R==null?void 0:R.data)||[],N=()=>{if(x.current&&u){const i=x.current.getBoundingClientRect();r({top:i.bottom+window.scrollY+2,left:i.left+window.scrollX,width:i.width})}};n.useEffect(()=>{if(u){N();const i=()=>{u&&N()},C=()=>{u&&N()};return window.addEventListener("scroll",i,!0),window.addEventListener("resize",C),()=>{window.removeEventListener("scroll",i,!0),window.removeEventListener("resize",C)}}},[u]);const Y=i=>{const C=i.target.value;s(C),h==null||h(C),C.length>=2?m(!0):m(!1)},Z=()=>{b.length>=2&&(m(!0),N())},ce=i=>{s(i.display_text),m(!1),d==null||d(i)},pe=()=>{s(""),m(!1),h==null||h(""),d==null||d(null)};n.useEffect(()=>{const i=C=>{x.current&&!x.current.contains(C.target)&&v.current&&!v.current.contains(C.target)&&m(!1)};if(u)return document.addEventListener("mousedown",i),()=>document.removeEventListener("mousedown",i)},[u]);const H=i=>i===0?"Sujeto a evaluaciÃ³n":`S/ ${i.toFixed(2)}`,he=i=>({"ENSAYO ESTÃNDAR":"primary","ENSAYOS ESPECIALES":"success","ENSAYOS DE CAMPO":"info","ENSAYO AGREGADO":"warning"})[i]||"secondary",Q=u&&b.length>=2&&e.jsxs("div",{ref:v,style:{position:"absolute",top:`${w.top}px`,left:`${w.left}px`,width:`${w.width}px`,zIndex:999999,maxHeight:"300px",overflowY:"auto",backgroundColor:"white",border:"1px solid #dee2e6",borderRadius:"4px",boxShadow:"0 4px 12px rgba(0,0,0,0.15)"},onMouseDown:i=>i.preventDefault(),children:[I&&e.jsxs("div",{className:"p-3 text-center text-muted",children:[e.jsx(ue,{animation:"border",size:"sm",className:"me-2"}),e.jsx("small",{children:"Buscando..."})]}),!I&&l.length===0&&e.jsx("div",{className:"p-3 text-center text-muted",children:e.jsx("small",{children:"No se encontraron resultados"})}),!I&&l.length>0&&l.map(i=>e.jsx("div",{className:"p-2 border-bottom",onClick:()=>ce(i),style:{cursor:"pointer",transition:"background-color 0.15s"},onMouseEnter:C=>C.currentTarget.style.backgroundColor="#f8f9fa",onMouseLeave:C=>C.currentTarget.style.backgroundColor="white",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-start",children:[e.jsxs("div",{className:"flex-grow-1",children:[e.jsx("div",{className:"d-flex align-items-center gap-2 mb-1",children:e.jsx(me,{bg:he(i.service_name),className:"small",children:i.codigo})}),e.jsx("div",{className:"fw-bold small text-dark",children:i.descripcion}),i.norma&&i.norma!=="-"&&e.jsxs("div",{className:"text-muted",style:{fontSize:"0.75rem"},children:[e.jsx(oa,{size:10,className:"me-1"}),i.norma]})]}),e.jsx("div",{className:"text-end ms-2",children:e.jsxs("div",{className:"fw-bold text-success small",children:[e.jsx(na,{size:12}),H(i.precio)]})})]})},i.id))]});return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"position-relative",children:e.jsx(Se.Group,{className:"mb-0",children:e.jsxs("div",{className:"position-relative",children:[e.jsx(Se.Control,{ref:x,type:"text",value:b,onChange:Y,onFocus:Z,placeholder:_,disabled:G,size:D,className:"pe-5",autoComplete:"off"}),e.jsxs("div",{className:"position-absolute top-50 end-0 translate-middle-y pe-3 d-flex align-items-center gap-2",children:[I&&e.jsx(ue,{animation:"border",size:"sm",variant:"primary"}),!I&&b&&e.jsx(ca,{className:"text-muted",onClick:pe,onMouseDown:i=>i.preventDefault(),style:{cursor:"pointer"}}),!I&&!b&&e.jsx(ra,{className:"text-muted"})]})]})})}),typeof document<"u"&&Q&&sa.createPortal(Q,document.body)]})},Ea=({show:f,onHide:h,projectName:d,companyId:_,onSelectExisting:G,onCreateNew:D})=>{const[b,s]=n.useState([]),[u,m]=n.useState(!1),[w,r]=n.useState(null);n.useEffect(()=>{console.log("ðŸ” ProjectSelectionModal - useEffect triggered:",{show:f,projectName:d,companyId:_}),f&&d&&d.trim().length>=2&&x()},[f,d,_]);const x=async()=>{try{console.log("ðŸ” ProjectSelectionModal - Iniciando bÃºsqueda:",{projectName:d,companyId:_}),m(!0),r(null);const l=await Oe(d,_);console.log("âœ… ProjectSelectionModal - Proyectos encontrados:",l),s(l||[])}catch(l){console.error("âŒ ProjectSelectionModal - Error searching projects:",l),r("Error al buscar proyectos existentes")}finally{m(!1)}},v=l=>{G(l),h()},O=()=>{D(),h()},k=()=>{const l=b.length+1,N=`${d} (${l})`;D(N),h()},R=l=>{const N=prompt(`Editar nombre del proyecto "${l.name}":`,l.name);N&&N.trim()!==l.name&&(console.log("Editar proyecto:",l.id,"nuevo nombre:",N),alert(`Funcionalidad de ediciÃ³n en desarrollo. Proyecto: ${l.name} â†’ ${N}`))},I=l=>new Date(l).toLocaleDateString("es-PE");return e.jsxs(J,{show:f,onHide:h,size:"lg",centered:!0,style:{zIndex:9999},children:[e.jsx(J.Header,{closeButton:!0,children:e.jsxs(J.Title,{children:[e.jsx(_e,{className:"me-2"}),'Proyectos Existentes: "',d,'"']})}),e.jsxs(J.Body,{children:[u&&e.jsxs("div",{className:"text-center py-4",children:[e.jsx(ue,{animation:"border"}),e.jsx("p",{className:"mt-2",children:"Buscando proyectos existentes..."})]}),w&&e.jsx(se,{variant:"danger",children:w}),!u&&!w&&b.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(se,{variant:"warning",className:"mb-3",children:e.jsxs("div",{children:[e.jsxs("strong",{children:["âš ï¸ Se encontraron ",b.length,' proyecto(s) con el nombre "',d,'" en esta empresa.']}),e.jsx("br",{}),"Para evitar confusiones, el sistema sugiere diferenciarlos automÃ¡ticamente."]})}),e.jsx(se,{variant:"info",className:"mb-3",children:e.jsxs("div",{children:[e.jsx("strong",{children:"ðŸ’¡ Opciones disponibles:"}),e.jsxs("ul",{className:"mb-0 mt-2",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Continuar con proyecto existente:"})," Usar uno de los proyectos listados"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Crear nuevo diferenciado:"}),' El sistema agregarÃ¡ automÃ¡ticamente "(2)", "(3)", etc.']}),e.jsxs("li",{children:[e.jsx("strong",{children:"Editar manualmente:"})," Puedes cambiar el nombre despuÃ©s de crear el proyecto"]})]})]})}),e.jsx(Ae,{children:b.map(l=>e.jsxs(Ae.Item,{className:"d-flex justify-content-between align-items-start",style:{cursor:"pointer"},onClick:()=>v(l),children:[e.jsxs("div",{className:"ms-2 me-auto",children:[e.jsxs("div",{className:"fw-bold",children:[e.jsx(_e,{className:"me-1"}),l.name]}),e.jsxs("div",{className:"text-muted small",children:[e.jsx("strong",{children:"Empresa:"})," ",l.company_name," (RUC: ",l.company_ruc,")"]}),e.jsxs("div",{className:"text-muted small",children:[e.jsx(la,{className:"me-1"}),l.location||"Sin ubicaciÃ³n"]}),e.jsxs("div",{className:"text-muted small",children:[e.jsx(ia,{className:"me-1"}),"Vendedor: ",l.vendedor_name||"No asignado"]}),e.jsxs("div",{className:"text-muted small",children:[e.jsx(da,{className:"me-1"}),"Creado: ",I(l.created_at)]})]}),e.jsxs("div",{className:"text-end",children:[e.jsx("div",{className:"mb-2",children:e.jsxs(ne,{variant:"outline-secondary",size:"sm",onClick:N=>{N.stopPropagation(),R(l)},title:"Editar nombre para unificar proyectos",children:[e.jsx(ma,{className:"me-1"}),"Editar"]})}),e.jsxs("div",{children:[e.jsxs(me,{bg:"secondary",className:"me-2",children:[l.quotes_count," cotizaciÃ³n(es)"]}),e.jsx(me,{bg:l.status==="activo"?"success":"warning",children:l.status})]})]})]},l.id))})]}),!u&&!w&&b.length===0&&e.jsxs(se,{variant:"success",children:[e.jsx("strong",{children:"No se encontraron proyectos con ese nombre."}),e.jsx("br",{}),"Puedes crear un nuevo proyecto sin problemas."]})]}),e.jsxs(J.Footer,{children:[e.jsx(ne,{variant:"outline-secondary",onClick:h,children:"Cancelar"}),e.jsxs(ne,{variant:"warning",onClick:k,children:[e.jsx(Ee,{className:"me-1"}),'Crear "',d," (",b.length+1,')"']}),e.jsxs(ne,{variant:"primary",onClick:O,children:[e.jsx(Ee,{className:"me-1"}),"Crear Nuevo (Nombre Original)"]})]})]})},we={company_name:"",ruc:"",contact_name:"",contact_phone:"",contact_email:"",project_location:"",project_name:""},Sa={request_date:"",issue_date:"",commercial_name:"",commercial_phone:"",payment_terms:"adelantado",reference:"",reference_type:["email","phone"],igv:!0,delivery_days:4,category_main:"laboratorio"},ie={code:"",description:"",norm:"",unit_price:0,quantity:1};function De(f){const h=Number(f.unit_price||0),d=Number(f.quantity||0);return Number((h*d).toFixed(2))}function Aa(){const f=new Date().getFullYear(),h=String(new Date().getMonth()+1).padStart(2,"0"),d=String(new Date().getDate()).padStart(2,"0"),_=Math.floor(Math.random()*1e3).toString().padStart(3,"0");return`COT-${f}${h}${d}-${_}`}const M=(f="")=>(f||"").normalize("NFD").replace(/[\u0300-\u036f]/g,"").toUpperCase().trim(),de={[M("MUESTRA DE SUELO Y AGREGADO")]:`CONDICIONES ESPECÃFICAS:
- El cliente debe enviar al laboratorio, para los ensayo en suelo y agregados, la cantidad minima de 100 kg por cada muestra.
- El cliente deberÃ¡ de entregar las muestras debidamente identificadas.
- El cliente deberÃ¡ especificar la Norma a ser utilizada para la ejecuciÃ³n del ensayo, caso contrario se considera Norma ASTM o NTP vigente de acuerdo con el alcance del laboratorio.
- El cliente deberÃ¡ entregar las muestras en las instalaciones del LEM, ubicado en la Av. MaraÃ±Ã³n NÂ° 763, Los Olivos, Lima.`,[M("PROBETAS")]:`CONDICIONES ESPECÃFICAS:
- El cliente debe proporcionar las probetas antes del ingreso a obra.
- El cliente deberÃ¡ de entregar las muestras debidamente identificadas.
- El cliente deberÃ¡ especificar la Norma a ser utilizada para la ejecuciÃ³n del ensayo, caso contrario se considera Norma ASTM o NTP vigente de acuerdo con el alcance del laboratorio.
- El cliente deberÃ¡ entregar las muestras en las instalaciones del LEM, ubicado en la Av. MaraÃ±Ã³n NÂ° 763, Los Olivos, Lima.`,[M("DENSIDAD DE CAMPO Y MUESTREO")]:`CONDICIONES ESPECÃFICAS:
- El cliente deberÃ¡ enviar al laboratorio, para los ensayo en suelo y agregados, la cantidad minima de 100 kg por cada muestra.
- Para el ensayo de Densidad de campo, la cantidad de puntos/salida minimo 4 und.
- El cliente deberÃ¡ de programar el servicio, Densidad de campo, con 24 horas de anticipaciÃ³n.
- El cliente deberÃ¡ especificar la Norma a ser utilizada para la ejecuciÃ³n del ensayo, caso contrario se considera Norma ASTM o NTP vigente de acuerdo con el alcance del laboratorio.
- El cliente deberÃ¡ entregar las muestras en las instalaciones del LEM, ubicado en la Av. MaraÃ±Ã³n NÂ° 763, Los Olivos, Lima.`,[M("EXTRACCIÃ“N DE DIAMANTINA")]:`CONDICIONES ESPECÃFICAS:
- MovilizaciÃ³n y desmovilizaciÃ³n de equipos y del personal tÃ©cnico, estara a cargo de GEOFAL.
- Resane de estructura de concreto con sika rep 500 y Sikadur 32, estara a cargo de GEOFAL.
- El servicio no incluye trabajos de acabados como pintura, mayolica y otros.
- El area de trabajo, zona de extracciÃ³n de diamantina, tiene que estar libre de interferencia.
- La extracciÃ³n de diamantina se realizara en 2 dia en campo, en laboratorio se realizarÃ¡ el tallado y refrentado de diamantina, el ensayo de resistencia a la compresiÃ³n de testigo de diamantina se realizara en 5 dias (el tiempo de ensayo obedece a la normativa vigente).
- Costo de resane insumos 250 soles, este costo se distribuira de acuerdo con el numero de perforaciones Donde se hara las extracciones de diamantina`,[M("DIAMANTINA PARA PASES")]:`CONDICIONES ESPECÃFICAS:
- El cliente deberÃ¡ de programar el servicio, ExtracciÃ³n diamantina, con 24 horas de anticipaciÃ³n.
- El area de trabajo, zona de extraccion de diamantina, debera estar libre de interferencia.
- Para extraer la diamantina, se ubicara el acero con un escaneador.
- Movilizacion y desmovilizacion de equipos y del personal tecnico, estara a cargo de Geofal.`,[M("ALBAÃ‘ILERÃA")]:`CONDICIONES ESPECÃFICAS:
- El cliente deberÃ¡ enviar al laboratorio, 20 ladrillo de cada tipo, en buen estado y sin presentar fisuras.
- El cliente deberÃ¡ de entregar las muestras debidamente identificadas.
- El cliente deberÃ¡ especificar la Norma a ser utilizada para la ejecuciÃ³n del ensayo, caso contrario se considera Norma ASTM o NTP vigente de acuerdo con el alcance del laboratorio.
- El cliente deberÃ¡ entregar las muestras en las instalaciones del LEM, ubicado en la Av. MaraÃ±Ã³n NÂ° 763, Los Olivos, Lima`,[M("VIGA BECKELMAN")]:`CONDICIONES ESPECÃFICAS:
- El cliente deberÃ¡ de programar el servicio, Ensayo de DeflexiÃ³n, con 24 horas de anticipaciÃ³n.
- El area de trabajo tiene que estar habilitado.
- El cliente deberÃ¡ especificar la Norma a ser utilizada para la ejecuciÃ³n del ensayo, caso contrario se considera Norma ASTM o NTP o MTC vigente de acuerdo con el alcance del laboratorio.
- Especificar las caracteristicas del camion`,[M("CONTROL DE CALIDAD DE CONCRETO FRESCO EN OBRA")]:`CONDICIONES ESPECÃFICAS:
- El cliente deberÃ¡ de programar el servicio, con 24 horas de anticipaciÃ³n.
- Para el ensayo de control de calidad de concreto fresco en obra, se moldeara 6 probetas, ensayo slump, control de temperatura, en laboratorio las probetas se colocara en camara de curado, el ensayo de compresiÃ³n de las probetas seran 3 a 7 dias y 3 a 28 dias.
- El control de calidad del concreto fresco se sacara cada 50m3 a uno de los mixer donde se hara todos los ensayos respectivos mencionados, o por dia asi no se halla llegado los 50m3.
- El cliente deberÃ¡ especificar la Norma a ser utilizada para la ejecuciÃ³n del ensayo, caso contrario se considera Norma ASTM o NTP vigente de acuerdo con el alcance del laboratorio.`},L=f=>{const h=M((f==null?void 0:f.title)||"");if(de[h])return de[h];const d=Object.entries(de).find(([_])=>h.includes(_)||_.includes(h));return d?d[1]:""};function Ga(){var ve;const[f]=ua(),h=pa(),d=f.get("edit"),[_,G]=n.useState([]),[D,b]=n.useState(""),[s,u]=n.useState(we),[m,w]=n.useState({company_id:null,project_id:null,company:null,project:null}),[r,x]=n.useState(Sa),[v,O]=n.useState([{...ie}]),[k,R]=n.useState(!1),[I,l]=n.useState(""),[N,Y]=n.useState(""),[Z,ce]=n.useState(null),[pe,H]=n.useState([]),[he,Q]=n.useState([]),[i,C]=n.useState(!1),[Ie,wa]=n.useState(""),[Pe,ge]=n.useState(!1),[S,xe]=n.useState(null),[F,je]=n.useState([]),[q,fe]=n.useState([]),[ee,$]=n.useState(""),[A,z]=n.useState(null),[be,X]=n.useState(!1),[Te,Ne]=n.useState(!1),[Le,Me]=n.useState(null),[Re,ye]=n.useState(!1),[Fe,ze]=n.useState(""),[ke,qe]=n.useState(null),[re,Da]=n.useState(null),[K,V]=n.useState(null);n.useEffect(()=>{const a=[{id:"V1",code:"V1",title:"MUESTRA DE SUELO Y AGREGADO",description:L({title:"MUESTRA DE SUELO Y AGREGADO"})},{id:"V2",code:"V2",title:"PROBETAS",description:L({title:"PROBETAS"})},{id:"V3",code:"V3",title:"DENSIDAD DE CAMPO Y MUESTREO",description:L({title:"DENSIDAD DE CAMPO Y MUESTREO"})},{id:"V4",code:"V4",title:"EXTRACCIÃ“N DE DIAMANTINA",description:L({title:"EXTRACCIÃ“N DE DIAMANTINA"})},{id:"V5",code:"V5",title:"DIAMANTINA PARA PASES",description:L({title:"DIAMANTINA PARA PASES"})},{id:"V6",code:"V6",title:"ALBAÃ‘ILERÃA",description:L({title:"ALBAÃ‘ILERÃA"})},{id:"V7",code:"V7",title:"VIGA BECKELMAN",description:L({title:"VIGA BECKELMAN"})},{id:"V8",code:"V8",title:"CONTROL DE CALIDAD DE CONCRETO FRESCO EN OBRA",description:L({title:"CONTROL DE CALIDAD DE CONCRETO FRESCO EN OBRA"})}];G(a)},[]),n.useEffect(()=>{(async()=>{try{const t=(await fa({page:1,limit:100})).data||[];H(t),Q(t)}catch(a){console.warn("No se pudieron cargar proyectos existentes:",a),H([]),Q([])}})()},[]),n.useEffect(()=>{m.company&&u(a=>{var t,o;return{...a,company_name:m.company.name||a.company_name,ruc:m.company.ruc||a.ruc,contact_name:m.company.contact_name||a.contact_name,contact_phone:m.company.phone||a.contact_phone,contact_email:m.company.email||a.contact_email,project_location:((t=m.project)==null?void 0:t.location)||a.project_location,project_name:((o=m.project)==null?void 0:o.name)||a.project_name}})},[m.company,m.project]),n.useEffect(()=>{(async()=>{try{const t=localStorage.getItem("token");if(!t)return;const o=await fetch("http://localhost:4000/api/auth/me",{headers:{Authorization:`Bearer ${t}`}});if(o.ok){const c=await o.json();c.user&&(xe(c.user),x(p=>({...p,commercial_name:c.user.name||p.commercial_name,commercial_phone:c.user.phone||p.commercial_phone,issue_date:p.issue_date||new Date().toISOString().slice(0,10),request_date:p.request_date||new Date().toISOString().slice(0,10)})))}}catch(t){console.warn("No se pudo obtener datos del usuario:",t)}})()},[]),n.useEffect(()=>{if(!D)return;const a=(_||[]).find(c=>String(c.id)===String(D));if(!a)return;const t=a.conditions||{};x(c=>({...c,payment_terms:t.default_payment_terms||c.payment_terms,igv:typeof t.default_igv=="boolean"?t.default_igv:c.igv,reference:t.default_reference||c.reference}));const o=L(a)||a.description||"";o&&Y(o)},[D]);const U=n.useMemo(()=>v.reduce((a,t)=>a+De(t),0),[v]),ae=n.useMemo(()=>r.igv?Number((U*.18).toFixed(2)):0,[U,r.igv]),le=n.useMemo(()=>Number((U+ae).toFixed(2)),[U,ae]),$e=()=>O([...v,{...ie}]),Ve=a=>O(v.filter((t,o)=>o!==a)),B=(a,t)=>O(v.map((o,c)=>c===a?{...o,...t}:o)),Ue=async()=>{try{console.log("ðŸ” fetchClients - Llamando a /api/companies");const a=await Na({limit:500});console.log("ðŸ” fetchClients - Respuesta recibida:",a);const t=(a==null?void 0:a.data)||a||[];console.log("ðŸ” fetchClients - Lista de clientes:",t.length,"clientes"),je(t)}catch(a){console.error("âŒ Error fetching clients:",a),l("Error al cargar los clientes: "+(a.message||"Error desconocido")),je([])}},Be=a=>{if(console.log("ðŸ” handleClientSearch - TÃ©rmino de bÃºsqueda:",a),$(a),!a.trim()){fe([]),X(!1);return}const t=a.toLowerCase();console.log("ðŸ” handleClientSearch - BÃºsqueda en minÃºsculas:",t);const o=F.filter(c=>{var T,te,W,oe,Ce;const p=(T=c.name)==null?void 0:T.toLowerCase().includes(t),g=(te=c.ruc)==null?void 0:te.toLowerCase().includes(t),j=(W=c.email)==null?void 0:W.toLowerCase().includes(t),y=(oe=c.phone)==null?void 0:oe.toLowerCase().includes(t),E=(Ce=c.name)==null?void 0:Ce.toLowerCase().split(" ").some(aa=>aa.includes(t)),P=p||g||j||y||E;return P&&console.log("âœ… Cliente encontrado:",c.name,"- Match:",{nameMatch:p,nameWordsMatch:E,rucMatch:g,emailMatch:j,phoneMatch:y}),P});console.log("ðŸ” handleClientSearch - Resultados encontrados:",o.length),fe(o),X(!0)},Ge=a=>{console.log("ðŸ” handleClientSelect - Cliente seleccionado:",a.name,"ID:",a.id),z(a),$(a.name),X(!1),u(t=>({...t,company_name:a.name||"",ruc:a.ruc||"",contact_name:a.contact_name||"",contact_phone:a.phone||"",contact_email:a.email||"",project_location:a.address||""})),console.log("âœ… Campos del cliente llenados automÃ¡ticamente:",{company_name:a.name,ruc:a.ruc,contact_name:a.contact_name,contact_phone:a.phone,contact_email:a.email,project_location:a.address})},Ye=()=>{console.log("ðŸ” handleClientClear - Limpiando selecciÃ³n de cliente"),z(null),$(""),X(!1),u(we)};n.useEffect(()=>{d&&F.length>0&&Qe(d)},[d,F]);const Qe=async a=>{ge(!0);try{console.log("ðŸ”„ Cargando cotizaciÃ³n existente:",a);const t=await ga(a);if(console.log("âœ… CotizaciÃ³n cargada:",t),!S)try{const c=localStorage.getItem("token");if(c){const p=await fetch("http://localhost:4000/api/auth/me",{headers:{Authorization:`Bearer ${c}`}});if(p.ok){const g=await p.json();g.user&&(xe(g.user),console.log("âœ… Usuario cargado para ediciÃ³n:",g.user))}}}catch(c){console.warn("No se pudo obtener datos del usuario para ediciÃ³n:",c)}if(t.meta&&typeof t.meta=="string")try{t.meta=JSON.parse(t.meta),console.log("âœ… Meta parseado correctamente:",t.meta)}catch(c){console.error("âŒ Error parseando meta:",c),t.meta={}}if(t.client_contact||t.company_name){const c=t.company_name||t.client_company||t.client_contact||"",p=t.client_contact||"";u(j=>({...j,company_name:c,ruc:t.company_ruc||t.client_ruc||"",contact_name:p,contact_phone:t.client_phone||"",contact_email:t.client_email||"",project_location:t.project_location||"",project_name:t.project_name||""})),$(c),console.log("ðŸ” Configurando bÃºsqueda de cliente:",c),console.log("ðŸ” RUC del cliente:",t.company_ruc||t.client_ruc),console.log("ðŸ” TelÃ©fono del cliente:",t.client_phone);const g=t.company_ruc||t.client_ruc;if(g){console.log("ðŸ” Buscando cliente por RUC:",g);const j=F.find(y=>y.ruc===g);if(j)console.log("âœ… Cliente encontrado:",j),z(j);else{console.log("âŒ Cliente no encontrado en la lista, creando cliente simulado");const y={id:"existing",name:c,ruc:g||"",email:t.client_email||"",phone:t.client_phone||"",contact_name:p,address:t.project_location||""};z(y),console.log("âœ… Cliente simulado creado:",y)}}else{const j={id:"existing",name:c,ruc:"",email:t.client_email||"",phone:t.client_phone||"",contact_name:p,address:t.project_location||""};z(j),console.log("âœ… Cliente simulado creado (sin RUC):",j)}}x(c=>{var p,g,j,y;return{...c,request_date:((g=(p=t.meta)==null?void 0:p.quote)==null?void 0:g.request_date)||t.request_date||new Date().toISOString().slice(0,10),issue_date:t.issue_date||new Date().toISOString().slice(0,10),commercial_name:t.commercial_name||(S==null?void 0:S.name)||"",commercial_phone:t.commercial_phone||(S==null?void 0:S.phone)||"",payment_terms:t.payment_terms||"adelantado",reference:t.reference||"",reference_type:t.reference_type||["email","phone"],igv:t.igv!==!1,delivery_days:((y=(j=t.meta)==null?void 0:j.quote)==null?void 0:y.delivery_days)||t.delivery_days||4,category_main:t.category_main||"laboratorio"}});let o=[];t.meta&&t.meta.items&&t.meta.items.length>0?(o=t.meta.items,console.log("âœ… Cargando Ã­tems desde meta.items:",o.length)):t.items&&t.items.length>0&&(o=t.items,console.log("âœ… Cargando Ã­tems desde items directo:",o.length)),o.length>0?(O(o),console.log("ðŸ“¦ Ãtems cargados para ediciÃ³n:",o)):(console.log("ðŸ“¦ No hay Ã­tems para cargar, usando Ã­tem vacÃ­o por defecto"),O([{...ie}])),t.variant_id&&(b(t.variant_id),console.log("ðŸ”„ Variante cargada:",t.variant_id)),t.meta&&t.meta.conditions_text&&(Y(t.meta.conditions_text),console.log("ðŸ“ Condiciones especÃ­ficas cargadas")),console.log("âœ… Datos de cotizaciÃ³n cargados para ediciÃ³n")}catch(t){console.error("âŒ Error cargando cotizaciÃ³n:",t),l("Error al cargar la cotizaciÃ³n existente: "+(t.message||"Error desconocido"))}finally{ge(!1)}};n.useEffect(()=>{Ue()},[]),n.useEffect(()=>{var a;if((a=h.state)!=null&&a.selectedClient&&F.length>0){const t=h.state.selectedClient;console.log("ðŸŽ¯ Cliente pre-seleccionado desde navegaciÃ³n:",t);const o=F.find(c=>c.id===t.id);o?(console.log("âœ… Cliente encontrado en la lista, pre-llenando datos"),z(o),$(o.name),u(c=>({...c,company_name:o.name||"",ruc:o.ruc||o.dni||"",contact_name:o.contact_name||"",contact_phone:o.phone||"",contact_email:o.email||"",project_location:o.address||""}))):(console.log("âš ï¸ Cliente no encontrado en la lista, usando datos de navegaciÃ³n"),z(t),$(t.name),u(c=>({...c,company_name:t.name||"",ruc:t.ruc||t.dni||"",contact_name:t.contact_name||"",contact_phone:t.phone||"",contact_email:t.email||"",project_location:t.address||""})))}},[(ve=h.state)==null?void 0:ve.selectedClient,F]),n.useEffect(()=>()=>{re&&clearTimeout(re)},[re]);const Xe=async a=>{var t,o,c;a.preventDefault(),R(!0),l("");try{if(!s.company_name)throw new Error("Debe ingresar al menos el nombre de la empresa");let p=((t=m.project)==null?void 0:t.id)||m.project_id,g=(o=m.company)==null?void 0:o.id;if(!g){if(!s.ruc)throw new Error("Debe ingresar el RUC de la empresa");const T=await ya({type:"empresa",ruc:s.ruc,name:s.company_name,address:s.project_location||"",email:s.contact_email||"",phone:s.contact_phone||"",contact_name:s.contact_name||"",city:s.project_location||"",sector:"servicios"});g=T.id,console.log("âœ… Empresa obtenida/creada:",T)}if(!p){const T=await ba({company_id:g,name:s.project_name||`Proyecto ${s.company_name}`,location:s.project_location||"Por definir",contact_name:s.contact_name,contact_phone:s.contact_phone,contact_email:s.contact_email,status:"activo",priority:"normal",vendedor_id:(S==null?void 0:S.id)||null,requiere_laboratorio:r.category_main==="laboratorio",laboratorio_status:r.category_main==="laboratorio"?"pendiente":"no_requerido"});p=T.id,console.log("âœ… Proyecto creado automÃ¡ticamente:",T),console.log("ðŸ‘¤ Vendedor asignado:",S==null?void 0:S.name)}const j=Aa(),y={project_id:p,variant_id:D||null,client_contact:s.contact_name,client_email:s.contact_email,client_phone:s.contact_phone,client_company:s.company_name,client_ruc:s.ruc,project_name:s.project_name,project_location:s.project_location,request_date:r.request_date||new Date().toISOString().slice(0,10),issue_date:r.issue_date||new Date().toISOString().slice(0,10),subtotal:U,igv:ae,total:le,status:"borrador",reference:r.reference,reference_type:JSON.stringify(r.reference_type),category_main:r.category_main,quote_code:j,meta:JSON.stringify({customer:s,quote:{...r,request_date:r.request_date||new Date().toISOString().slice(0,10),delivery_days:r.delivery_days||4,reference:r.reference,category_main:r.category_main,quote_code:j},items:v,conditions_text:N,payment_terms:r.payment_terms,file_name:Ie||`CotizaciÃ³n ${new Date().getFullYear()}-${String(new Date().getMonth()+1).padStart(2,"0")}${String(new Date().getDate()).padStart(2,"0")} LEM-GEOFAL-${((c=s.company_name)==null?void 0:c.toUpperCase())||"CLIENTE"}`})};let E,P;d?(E=await xa(d,y),P="CotizaciÃ³n actualizada exitosamente",console.log("âœ… CotizaciÃ³n actualizada:",E)):(E=await ja(y),P="CotizaciÃ³n creada exitosamente",console.log("âœ… Nueva cotizaciÃ³n creada:",E)),Me({code:j,category:r.category_main==="laboratorio"?"ðŸ§ª Laboratorio":"âš™ï¸ IngenierÃ­a",itemsCount:v.length,total:le.toLocaleString(),isEdit:!!d,message:P}),Ne(!0),ce(E.id)}catch(p){console.error("Error:",p),l(p.message||"Error al crear cotizaciÃ³n")}finally{R(!1)}},Ke=async()=>{try{const a=Z;if(!a)return alert("Guarde la cotizaciÃ³n antes de generar el borrador");const t="http://localhost:4000/api".replace(/\/$/,"")||"",o=`/api/quotes/${a}/export/pdf-draft`,c=t&&/\/api$/i.test(t)?`${t}${o.replace(/^\/api/,"")}`:`${t}${o}`,p=localStorage.getItem("token");if(!p)throw new Error("No se encontrÃ³ token de autenticaciÃ³n");const g=await fetch(c,{method:"GET",headers:{Authorization:`Bearer ${p}`,"Content-Type":"application/json"}});if(!g.ok)throw new Error(`Error ${g.status}: ${g.statusText}`);const j=await g.blob(),y=window.URL.createObjectURL(j),E=document.createElement("a");E.href=y;const P=new Date,T=String(P.getDate()).padStart(2,"0"),te=String(P.getMonth()+1).padStart(2,"0"),W=String(P.getFullYear()).slice(-2),oe=`COT-${T}${te}${W}-${W}.pdf`;E.download=oe,document.body.appendChild(E),E.click(),document.body.removeChild(E),window.URL.revokeObjectURL(y)}catch(a){console.error("Error al exportar borrador:",a),alert(`No se pudo exportar borrador: ${a.message}`)}},We=a=>{var t;if(u({...s,project_name:a}),a&&a.trim().length>=3){const o=((t=m.company)==null?void 0:t.id)||(A==null?void 0:A.id);o&&Je(a.trim(),o)}},Je=async(a,t)=>{try{const o=await Oe(a,t);o&&o.length>0?V({count:o.length,suggestedName:`${a} (${o.length+1})`}):V(null)}catch(o){console.error("Error verificando proyectos duplicados:",o),V(null)}},Ze=async()=>{var o,c;const a=(o=s.project_name)==null?void 0:o.trim();if(!a||a.length<3){alert("Por favor ingresa al menos 3 caracteres en el nombre del proyecto");return}let t=(c=m.company)==null?void 0:c.id;if(!t&&A&&(t=A.id),!t){alert("Por favor selecciona una empresa primero usando el buscador de clientes");return}console.log("ðŸ” Verificando proyectos existentes para:",a,"empresa:",t),console.log("ðŸ” selectedClient:",A),console.log("ðŸ” selection.company:",m.company),ze(a),qe(t),ye(!0)},He=a=>{console.log("ðŸ”„ Seleccionando proyecto existente:",a),w(t=>({...t,project:a,project_id:a.id})),u(t=>({...t,project_name:a.name,project_location:a.location||t.project_location})),V(null),console.log("âœ… Proyecto existente seleccionado y estado actualizado:",a)},ea=(a=null)=>{console.log("ðŸ”„ Creando nuevo proyecto:",a),w(t=>({...t,project:null,project_id:null})),a?(u(t=>({...t,project_name:a})),console.log("âœ… Se crearÃ¡ un nuevo proyecto con nombre diferenciado:",a)):console.log("âœ… Se crearÃ¡ un nuevo proyecto con nombre original"),V(null)};return e.jsxs(ha,{titulo:d?"ðŸ“ Editar CotizaciÃ³n":"ðŸ“‹ CotizaciÃ³n Inteligente",descripcion:d?"Edita una cotizaciÃ³n existente con nueva fecha":"Formulario unificado para crear cotizaciones de forma rÃ¡pida e intuitiva",children:[Pe&&e.jsx("div",{className:"alert alert-info",children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"spinner-border spinner-border-sm me-2",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Cargando..."})}),"Cargando cotizaciÃ³n existente..."]})}),I&&e.jsx("div",{className:"alert alert-danger",children:I}),e.jsxs("form",{onSubmit:Xe,className:"intelligent-quote-form",children:[e.jsxs("div",{className:"alert alert-light border mt-3 intelligent-intro",children:[e.jsx("h5",{children:"ðŸš€ Flujo Simplificado"}),e.jsx("p",{className:"mb-0",children:'Completa los datos del cliente, proyecto y cotizaciÃ³n. Usa el botÃ³n "ðŸ’¾ GUARDAR COTIZACIÃ“N" para guardar tu trabajo.'})]}),e.jsxs("div",{className:"intelligent-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("span",{className:"section-icon",children:"ðŸ¢"}),e.jsx("h4",{children:"CLIENTE"}),e.jsx("span",{className:"section-status",children:s.company_name?"âœ… Cliente configurado":"â³ Pendiente"})]}),e.jsxs("div",{className:"section-content",children:[e.jsx("div",{className:"row g-3 mb-4",children:e.jsxs("div",{className:"col-md-12",children:[e.jsx("label",{className:"form-label",children:"Buscar Cliente Existente"}),e.jsxs("div",{className:"position-relative",children:[e.jsx("input",{type:"text",className:"form-control",value:ee,onChange:a=>Be(a.target.value),onFocus:()=>X(!0),placeholder:"Buscar por nombre, RUC, email o telÃ©fono..."}),A&&e.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm position-absolute end-0 top-50 translate-middle-y me-2",onClick:Ye,children:"âœ•"})]}),ee&&be&&q.length>0&&e.jsxs("div",{className:"border rounded mt-2",style:{maxHeight:"200px",overflowY:"auto"},children:[e.jsx("div",{className:"p-2 bg-light border-bottom",children:e.jsxs("small",{className:"text-muted",children:[q.length," cliente",q.length!==1?"s":""," encontrado",q.length!==1?"s":""]})}),q.map(a=>e.jsxs("div",{className:"p-2 border-bottom cursor-pointer hover-bg-light",onClick:()=>Ge(a),style:{cursor:"pointer"},children:[e.jsx("div",{className:"fw-bold",children:a.name}),e.jsxs("small",{className:"text-muted",children:["RUC: ",a.ruc," | Email: ",a.email,a.phone&&` | Tel: ${a.phone}`]})]},a.id))]}),ee&&be&&q.length===0&&e.jsx("div",{className:"border rounded mt-2 p-3 text-center",children:e.jsxs("small",{className:"text-muted",children:['No se encontraron clientes con "',ee,'"']})}),A&&e.jsxs("div",{className:"mt-2 p-2 bg-light rounded",children:[e.jsx("strong",{children:"Cliente seleccionado:"})," ",A.name,e.jsx("br",{}),e.jsxs("small",{className:"text-muted",children:["RUC: ",A.ruc," | Email: ",A.email,A.phone&&` | Tel: ${A.phone}`]})]})]})}),e.jsxs("div",{className:"row g-3",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"Empresa"}),e.jsx("input",{className:"form-control",value:s.company_name,onChange:a=>u({...s,company_name:a.target.value}),required:!0,placeholder:"Nombre de la empresa"})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"R.U.C. *"}),e.jsx("input",{className:"form-control",value:s.ruc,onChange:a=>u({...s,ruc:a.target.value}),placeholder:"RUC de la empresa",required:!0})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"Contacto"}),e.jsx("input",{className:"form-control",value:s.contact_name,onChange:a=>u({...s,contact_name:a.target.value}),required:!0,placeholder:"Nombre del contacto"})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"TelÃ©fono"}),e.jsx("input",{className:"form-control",value:s.contact_phone,onChange:a=>u({...s,contact_phone:a.target.value}),placeholder:"TelÃ©fono del contacto"})]}),e.jsxs("div",{className:"col-md-12",children:[e.jsx("label",{className:"form-label",children:"Correo"}),e.jsx("input",{type:"email",className:"form-control",value:s.contact_email,onChange:a=>u({...s,contact_email:a.target.value}),placeholder:"Correo del contacto"})]})]})]})]}),e.jsxs("div",{className:"intelligent-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("span",{className:"section-icon",children:"ðŸ“"}),e.jsx("h4",{children:"PROYECTO"}),e.jsx("span",{className:"section-status",children:s.project_name?"âœ… Proyecto configurado":"â³ Pendiente"})]}),e.jsx("div",{className:"section-content",children:e.jsxs("div",{className:"row g-3",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsxs("label",{className:"form-label",children:["Nombre del Proyecto",m.project&&e.jsx("span",{className:"badge bg-success ms-2",children:"âœ… Proyecto existente seleccionado"})]}),e.jsxs("div",{className:"input-group",children:[e.jsx("input",{className:`form-control ${K?"is-warning":m.project?"is-success":""}`,value:s.project_name,onChange:a=>We(a.target.value),required:!0,placeholder:"Nombre del proyecto"}),e.jsx("button",{type:"button",className:"btn btn-outline-info",onClick:Ze,title:"Verificar si ya existen proyectos con este nombre",children:"ðŸ” Verificar"})]}),K&&e.jsxs("div",{className:"alert alert-warning mt-2 mb-0",children:[e.jsx("strong",{children:"âš ï¸ Advertencia:"})," Se encontraron ",K.count," proyecto(s) con este nombre.",e.jsx("br",{}),e.jsxs("small",{children:["Sugerencia: ",e.jsx("code",{children:K.suggestedName}),e.jsx("button",{type:"button",className:"btn btn-sm btn-outline-warning ms-2",onClick:()=>{u(a=>({...a,project_name:K.suggestedName})),V(null)},children:"Usar sugerencia"})]})]}),m.project&&e.jsx("div",{className:"alert alert-success mt-2 mb-0",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-start",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"âœ… Proyecto existente seleccionado:"})," ",m.project.name,e.jsx("br",{}),e.jsxs("small",{children:["UbicaciÃ³n: ",m.project.location||"No especificada"," | Vendedor: ",m.project.vendedor_name||"No asignado"," | Cotizaciones: ",m.project.quotes_count||0]})]}),e.jsx("button",{type:"button",className:"btn btn-sm btn-outline-danger",onClick:()=>{w(a=>({...a,project:null,project_id:null})),console.log("ðŸ”„ Proyecto existente deseleccionado")},title:"Deseleccionar proyecto existente",children:"âœ•"})]})})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"UbicaciÃ³n"}),e.jsx("input",{className:"form-control",value:s.project_location,onChange:a=>u({...s,project_location:a.target.value}),placeholder:"UbicaciÃ³n del proyecto"})]})]})})]}),e.jsxs("div",{className:"intelligent-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("span",{className:"section-icon",children:"ðŸ“‹"}),e.jsx("h4",{children:"COTIZACIÃ“N"}),e.jsx("span",{className:"section-status",children:D?"âœ… Variante seleccionada":"â³ Pendiente"})]}),e.jsxs("div",{className:"section-content",children:[e.jsxs("div",{className:"row g-3",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"Fecha de Solicitud"}),e.jsx("input",{type:"date",className:"form-control",value:r.request_date,onChange:a=>x({...r,request_date:a.target.value})})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"Fecha de EmisiÃ³n"}),e.jsx("input",{type:"date",className:"form-control",value:r.issue_date,onChange:a=>x({...r,issue_date:a.target.value})})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"Comercial"}),e.jsx("input",{className:"form-control",value:r.commercial_name,onChange:a=>x({...r,commercial_name:a.target.value}),placeholder:"Nombre del comercial"})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"TelÃ©fono Comercial"}),e.jsx("input",{type:"tel",className:"form-control",value:r.commercial_phone,onChange:a=>x({...r,commercial_phone:a.target.value}),required:!0,placeholder:"TelÃ©fono del comercial"})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"Variante"}),e.jsxs("select",{className:"form-select",value:D,onChange:a=>b(a.target.value),children:[e.jsx("option",{value:"",children:"Seleccionar variante"}),(_||[]).map(a=>e.jsxs("option",{value:a.id,children:[a.code," - ",a.title]},a.id))]})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"Forma de Pago"}),e.jsxs("select",{className:"form-select",value:r.payment_terms,onChange:a=>x({...r,payment_terms:a.target.value}),children:[e.jsx("option",{value:"adelantado",children:"Adelantado"}),e.jsx("option",{value:"50%",children:"Adelanto 50% y saldo previo al informe"}),e.jsx("option",{value:"credito7",children:"CrÃ©dito 7 dÃ­as con OS"}),e.jsx("option",{value:"credito15",children:"CrÃ©dito 15 dÃ­as con OS"}),e.jsx("option",{value:"credito30",children:"CrÃ©dito 30 dÃ­as con OS"})]})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"DÃ­as HÃ¡biles"}),e.jsx("input",{type:"number",className:"form-control",value:r.delivery_days,onChange:a=>x({...r,delivery_days:parseInt(a.target.value)||4}),min:"1",max:"30"})]}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"form-check mt-4",children:[e.jsx("input",{className:"form-check-input",type:"checkbox",id:"igv",checked:r.igv,onChange:a=>x({...r,igv:a.target.checked})}),e.jsx("label",{className:"form-check-label",htmlFor:"igv",children:"Aplicar IGV 18%"})]})})]}),e.jsxs("div",{className:"mt-3",children:[e.jsx("label",{className:"form-label",children:"Referencia"}),e.jsx("input",{className:"form-control",value:r.reference,onChange:a=>x({...r,reference:a.target.value}),placeholder:"SEGÃšN LO SOLICITADO VÃA CORREO ELECTRÃ“NICO / LLAMADA TELEFÃ“NICA"})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"form-label",children:"CategorÃ­a Principal"}),e.jsxs("div",{className:"row g-3",children:[e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"form-check",children:[e.jsx("input",{className:"form-check-input",type:"radio",name:"categoryMain",id:"laboratorio",value:"laboratorio",checked:r.category_main==="laboratorio",onChange:a=>x({...r,category_main:a.target.value})}),e.jsx("label",{className:"form-check-label",htmlFor:"laboratorio",children:"ðŸ§ª Laboratorio"})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"form-check",children:[e.jsx("input",{className:"form-check-input",type:"radio",name:"categoryMain",id:"ingenieria",value:"ingenieria",checked:r.category_main==="ingenieria",onChange:a=>x({...r,category_main:a.target.value})}),e.jsx("label",{className:"form-check-label",htmlFor:"ingenieria",children:"âš™ï¸ IngenierÃ­a"})]})})]}),e.jsx("div",{className:"alert alert-info mt-2",children:e.jsxs("small",{children:[e.jsx("strong",{children:"ðŸ’¡ Importante:"})," Selecciona la categorÃ­a principal para que el sistema pueda categorizar automÃ¡ticamente los Ã­tems y alimentar el embudo de ventas."]})})]}),e.jsxs("div",{className:"mt-3",children:[e.jsx("label",{className:"form-label",children:"Condiciones EspecÃ­ficas"}),e.jsx("textarea",{className:"form-control",rows:4,placeholder:"Las condiciones se auto-completan segÃºn la variante seleccionada",value:N,onChange:a=>Y(a.target.value)})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"form-label",children:"Ãtems de la CotizaciÃ³n"}),e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-bordered table-striped",children:[e.jsx("thead",{className:"table-dark",children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:"10%"},children:"CÃ³digo"}),e.jsx("th",{style:{width:"35%"},children:"DescripciÃ³n"}),e.jsx("th",{style:{width:"15%"},children:"Norma"}),e.jsx("th",{style:{width:"12%"},children:"Precio Unit."}),e.jsx("th",{style:{width:"10%"},children:"Cantidad"}),e.jsx("th",{style:{width:"12%"},children:"Parcial"}),e.jsx("th",{style:{width:"6%"}})]})}),e.jsx("tbody",{children:v.map((a,t)=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("input",{className:"form-control form-control-sm",value:a.code,onChange:o=>B(t,{code:o.target.value}),placeholder:"CÃ³digo"})}),e.jsx("td",{children:e.jsx(_a,{value:a.description,onChange:o=>B(t,{description:o}),onSelect:o=>{o&&B(t,{code:o.codigo,description:o.descripcion,norm:o.norma,unit_price:o.precio})},placeholder:"Buscar servicio...",size:"sm"})}),e.jsx("td",{children:e.jsx("input",{className:"form-control form-control-sm",value:a.norm,onChange:o=>B(t,{norm:o.target.value}),placeholder:"Norma"})}),e.jsx("td",{children:e.jsx("input",{type:"number",step:"0.01",className:"form-control form-control-sm",value:a.unit_price,onChange:o=>B(t,{unit_price:o.target.value}),placeholder:"0.00"})}),e.jsx("td",{children:e.jsx("input",{type:"number",className:"form-control form-control-sm",value:a.quantity,onChange:o=>B(t,{quantity:o.target.value}),min:"1"})}),e.jsx("td",{children:e.jsxs("span",{className:"fw-bold text-success",children:["S/ ",De(a).toFixed(2)]})}),e.jsx("td",{children:e.jsx("button",{type:"button",className:"btn btn-sm btn-outline-danger",onClick:()=>Ve(t),disabled:v.length===1,title:"Eliminar Ã­tem",children:"ðŸ—‘ï¸"})})]},t))})]})}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center mt-3",children:[e.jsx("button",{type:"button",className:"btn btn-outline-primary",onClick:$e,children:"âž• Agregar Ã­tem"}),e.jsxs("div",{className:"text-end",children:[e.jsxs("div",{className:"h6 mb-1",children:["Subtotal: ",e.jsxs("span",{className:"text-primary",children:["S/ ",U.toFixed(2)]})]}),e.jsxs("div",{className:"h6 mb-1",children:["IGV 18%: ",e.jsxs("span",{className:"text-primary",children:["S/ ",ae.toFixed(2)]})]}),e.jsxs("div",{className:"h5 mb-0",children:["Total: ",e.jsxs("span",{className:"text-success fw-bold",children:["S/ ",le.toFixed(2)]})]})]})]})]})]})]}),e.jsxs("div",{className:"intelligent-actions",children:[e.jsx("button",{type:"submit",className:"btn btn-success btn-lg",disabled:k||!s.company_name||!s.ruc,children:k?d?"ðŸ”„ Actualizando...":"ðŸ’¾ Guardando...":d?"ðŸ”„ GUARDAR CAMBIOS":"ðŸ’¾ CREAR COTIZACIÃ“N"}),e.jsx("button",{type:"button",className:"btn btn-outline-warning btn-lg",onClick:Ke,disabled:!Z,children:"ðŸ“„ Generar cotizaciÃ³n"})]})]}),e.jsx(Ca,{show:Te,onHide:()=>Ne(!1),data:Le,buttonText:"Aceptar"}),e.jsx(Ea,{show:Re,onHide:()=>ye(!1),projectName:Fe,companyId:ke,onSelectExisting:He,onCreateNew:ea})]})}export{Ga as default};
//# sourceMappingURL=CotizacionInteligente-DDDz6AO4.js.map
