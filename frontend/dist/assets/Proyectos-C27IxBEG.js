import{r as n,u as z,L as B,j as s,M as R,c,B as H,O as I,g as N,W as Q,v as P,V as T,t as U}from"./index-Vrmn15ab.js";import{u as x}from"./useMutation-CW9zOA4W.js";import{u as V}from"./useQuery-C0PUex0E.js";import{P as G,R as O,C as d}from"./PageHeader-BlrN-WgO.js";import{D as W}from"./DataTable-C6GfqTma.js";import{M as J}from"./ModalForm-DmG8OU-6.js";import{S as m}from"./StatsCard-uVAG-g3O.js";import{d as K,l as X,c as Y,u as Z}from"./projects-b3Cl7FnY.js";import{C as h}from"./Card-DbstLWov.js";import"./InputGroup-BN0s6ecM.js";const C={company_id:"",name:"",location:"",vendedor_id:"",laboratorio_id:""};function me(){var b,y,v;const[E,l]=n.useState(!1),[o,u]=n.useState(null),[ee,S]=n.useState(null);z();const M=B(),{data:a,isLoading:F}=V(["projects"],()=>X(),{keepPreviousData:!0}),p=e=>{M.invalidateQueries("projects"),l(!1),u(null),S(null)},g=x(Y,{onSuccess:()=>p(),onError:e=>console.error("Error creating project:",e)}),j=x(Z,{onSuccess:()=>p(),onError:e=>console.error("Error updating project:",e)}),_=x(K,{onSuccess:()=>p(),onError:e=>console.error("Error deleting project:",e)}),w=()=>{u(C),l(!0)},A=e=>{u(e),l(!0)},$=e=>{window.confirm(`¿Estás seguro de que quieres eliminar el proyecto "${e.name}"?`)&&_.mutate(e.id)},D=async e=>{o.id?await j.mutateAsync({id:o.id,...e}):await g.mutateAsync(e)},L=e=>{const i={activo:{bg:"success",text:"Activo"},pendiente:{bg:"warning",text:"Pendiente"},completado:{bg:"primary",text:"Completado"},cancelado:{bg:"danger",text:"Cancelado"}}[e]||{bg:"secondary",text:e};return s.jsx(P,{bg:i.bg,className:"status-badge",children:i.text})},k=[{header:"ID",accessor:"id",width:"80px"},{header:"Proyecto",accessor:"name",render:(e,t)=>s.jsxs("div",{children:[s.jsx("div",{className:"fw-medium",children:t.name}),t.location&&s.jsxs("small",{className:"text-muted",children:[s.jsx(T,{size:12,className:"me-1"}),t.location]})]})},{header:"Empresa",accessor:"company",render:(e,t)=>{var i,f;return s.jsxs("div",{children:[s.jsx("div",{className:"fw-medium",children:((i=t.company)==null?void 0:i.name)||"Sin empresa"}),((f=t.company)==null?void 0:f.ruc)&&s.jsxs("small",{className:"text-muted",children:["RUC: ",t.company.ruc]})]})}},{header:"Estado",accessor:"status",render:e=>L(e||"activo")},{header:"Asignado a",accessor:"vendedor",render:(e,t)=>s.jsxs("div",{children:[t.vendedor&&s.jsxs("div",{className:"d-flex align-items-center",children:[s.jsx(U,{size:14,className:"me-1 text-muted"}),s.jsx("span",{children:t.vendedor.name})]}),t.laboratorio&&s.jsxs("div",{className:"d-flex align-items-center mt-1",children:[s.jsx(c,{size:14,className:"me-1 text-muted"}),s.jsx("span",{className:"small text-muted",children:t.laboratorio.name})]})]})},{header:"Fecha Creación",accessor:"created_at",type:"date"}],q=[{name:"company_id",label:"Empresa",type:"select",required:!0,options:((b=a==null?void 0:a.companies)==null?void 0:b.map(e=>({value:e.id,label:`${e.name} (${e.ruc})`})))||[]},{name:"name",label:"Nombre del Proyecto",type:"text",required:!0,placeholder:"Ingresa el nombre del proyecto"},{name:"location",label:"Ubicación",type:"text",placeholder:"Ingresa la ubicación del proyecto"},{name:"vendedor_id",label:"Vendedor Asignado",type:"select",options:((y=a==null?void 0:a.users)==null?void 0:y.filter(e=>["vendedor_comercial","jefa_comercial"].includes(e.role)).map(e=>({value:e.id,label:`${e.name} ${e.apellido}`})))||[]},{name:"laboratorio_id",label:"Responsable de Laboratorio",type:"select",options:((v=a==null?void 0:a.users)==null?void 0:v.filter(e=>["jefe_laboratorio","usuario_laboratorio","laboratorio"].includes(e.role)).map(e=>({value:e.id,label:`${e.name} ${e.apellido}`})))||[]}],r=n.useMemo(()=>{const e=(a==null?void 0:a.projects)||[];return{total:e.length,activos:e.filter(t=>t.status==="activo").length,completados:e.filter(t=>t.status==="completado").length,pendientes:e.filter(t=>t.status==="pendiente").length,cancelados:e.filter(t=>t.status==="cancelado").length}},[a]);return s.jsx(R,{fluid:!0,className:"py-4",children:s.jsxs("div",{className:"fade-in",children:[s.jsx(G,{title:"Gestión de Proyectos",subtitle:"Crear, editar y gestionar proyectos del sistema",icon:c,actions:s.jsxs(H,{variant:"primary",onClick:w,children:[s.jsx(I,{className:"me-2"}),"Nuevo Proyecto"]})}),s.jsxs(O,{className:"g-4 mb-4",children:[s.jsx(d,{md:6,lg:3,children:s.jsx(m,{title:"Total Proyectos",value:r.total,icon:c,color:"primary",subtitle:"Proyectos registrados"})}),s.jsx(d,{md:6,lg:3,children:s.jsx(m,{title:"Proyectos Activos",value:r.activos,icon:N,color:"success",subtitle:"En desarrollo"})}),s.jsx(d,{md:6,lg:3,children:s.jsx(m,{title:"Completados",value:r.completados,icon:N,color:"info",subtitle:"Finalizados"})}),s.jsx(d,{md:6,lg:3,children:s.jsx(m,{title:"Pendientes",value:r.pendientes,icon:Q,color:"warning",subtitle:"Por iniciar"})})]}),s.jsxs(h,{className:"shadow-sm border-0",children:[s.jsx(h.Header,{className:"bg-white border-bottom",children:s.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[s.jsxs("h5",{className:"mb-0",children:[s.jsx(c,{className:"me-2 text-primary"}),"Lista de Proyectos"]}),s.jsxs(P,{bg:"light",text:"dark",className:"px-3 py-2",children:[r.total," proyectos"]})]})}),s.jsx(h.Body,{className:"p-0",children:s.jsx(W,{data:(a==null?void 0:a.projects)||[],columns:k,loading:F,onEdit:A,onDelete:$,emptyMessage:"No hay proyectos registrados"})})]}),s.jsx(J,{show:E,onHide:()=>l(!1),title:o!=null&&o.id?"Editar Proyecto":"Nuevo Proyecto",data:o||C,fields:q,onSubmit:D,loading:g.isLoading||j.isLoading,submitText:o!=null&&o.id?"Actualizar":"Crear"})]})})}export{me as default};
//# sourceMappingURL=Proyectos-C27IxBEG.js.map
