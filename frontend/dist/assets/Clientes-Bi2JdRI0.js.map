{"version":3,"file":"Clientes-Bi2JdRI0.js","sources":["../../src/pages/Clientes.jsx"],"sourcesContent":["import React, { useState, useMemo } from 'react';\nimport { useQuery, useMutation, useQueryClient } from 'react-query';\nimport { Button, Badge, Row, Col, Card, Container } from 'react-bootstrap';\nimport { FiPlus, FiEdit, FiTrash2, FiUser, FiHome, FiMail, FiPhone, FiMapPin, FiUsers, FiHome as FiBuilding } from 'react-icons/fi';\nimport PageHeader from '../components/common/PageHeader';\nimport DataTable from '../components/common/DataTable';\nimport ModalForm from '../components/common/ModalForm';\nimport StatsCard from '../components/common/StatsCard';\nimport { listCompanies, createCompany, updateCompany, deleteCompany } from '../services/companies';\n\nconst emptyForm = {\n  type: 'empresa',\n  ruc: '',\n  dni: '',\n  name: '',\n  address: '',\n  email: '',\n  phone: '',\n  contact_name: '',\n};\n\nexport default function Clientes() {\n  const [showModal, setShowModal] = useState(false);\n  const [editingClient, setEditingClient] = useState(null);\n  const [deletingClient, setDeletingClient] = useState(null);\n\n  const queryClient = useQueryClient();\n\n  const { data, isLoading } = useQuery(\n    ['clients'],\n    () => listCompanies(),\n    { keepPreviousData: true }\n  );\n\n  const handleMutationSuccess = (message) => {\n    queryClient.invalidateQueries('clients');\n    setShowModal(false);\n    setEditingClient(null);\n    setDeletingClient(null);\n  };\n\n  const createMutation = useMutation(createCompany, {\n    onSuccess: () => handleMutationSuccess('Cliente creado exitosamente'),\n    onError: (error) => console.error('Error creating client:', error)\n  });\n\n  const updateMutation = useMutation(updateCompany, {\n    onSuccess: () => handleMutationSuccess('Cliente actualizado exitosamente'),\n    onError: (error) => console.error('Error updating client:', error)\n  });\n\n  const deleteMutation = useMutation(deleteCompany, {\n    onSuccess: () => handleMutationSuccess('Cliente eliminado exitosamente'),\n    onError: (error) => console.error('Error deleting client:', error)\n  });\n\n  const handleCreate = () => {\n    setEditingClient(emptyForm);\n    setShowModal(true);\n  };\n\n  const handleEdit = (client) => {\n    setEditingClient(client);\n    setShowModal(true);\n  };\n\n  const handleDelete = (client) => {\n    if (window.confirm(`¿Estás seguro de que quieres eliminar el cliente \"${client.name}\"?`)) {\n      deleteMutation.mutate(client.id);\n    }\n  };\n\n  const handleSubmit = async (formData) => {\n    if (editingClient.id) {\n      await updateMutation.mutateAsync({ id: editingClient.id, ...formData });\n    } else {\n      await createMutation.mutateAsync(formData);\n    }\n  };\n\n  const getTypeBadge = (type) => {\n    const typeConfig = {\n      'empresa': { bg: 'primary', text: 'Empresa', icon: FiHome },\n      'persona': { bg: 'info', text: 'Persona Natural', icon: FiUser }\n    };\n    \n    const config = typeConfig[type] || { bg: 'secondary', text: type, icon: FiUser };\n    const Icon = config.icon;\n    \n    return (\n      <Badge bg={config.bg} className=\"status-badge d-flex align-items-center\">\n        <Icon size={12} className=\"me-1\" />\n        {config.text}\n      </Badge>\n    );\n  };\n\n  const columns = [\n    {\n      header: 'ID',\n      accessor: 'id',\n      width: '80px'\n    },\n    {\n      header: 'Cliente',\n      accessor: 'name',\n      render: (value, row) => (\n        <div>\n          <div className=\"fw-medium\">{row.name}</div>\n          <div className=\"d-flex align-items-center gap-2 mt-1\">\n            {getTypeBadge(row.type)}\n            {row.ruc && (\n              <small className=\"text-muted\">RUC: {row.ruc}</small>\n            )}\n            {row.dni && (\n              <small className=\"text-muted\">DNI: {row.dni}</small>\n            )}\n          </div>\n        </div>\n      )\n    },\n    {\n      header: 'Contacto',\n      accessor: 'contact',\n      render: (value, row) => (\n        <div>\n          {row.contact_name && (\n            <div className=\"fw-medium\">{row.contact_name}</div>\n          )}\n          {row.email && (\n            <div className=\"d-flex align-items-center mt-1\">\n              <FiMail size={12} className=\"me-1 text-muted\" />\n              <small className=\"text-muted\">{row.email}</small>\n            </div>\n          )}\n          {row.phone && (\n            <div className=\"d-flex align-items-center mt-1\">\n              <FiPhone size={12} className=\"me-1 text-muted\" />\n              <small className=\"text-muted\">{row.phone}</small>\n            </div>\n          )}\n        </div>\n      )\n    },\n    {\n      header: 'Dirección',\n      accessor: 'address',\n      render: (value) => (\n        value ? (\n          <div className=\"d-flex align-items-center\">\n            <FiMapPin size={12} className=\"me-1 text-muted\" />\n            <small className=\"text-muted\">{value}</small>\n          </div>\n        ) : (\n          <small className=\"text-muted\">Sin dirección</small>\n        )\n      )\n    },\n    {\n      header: 'Fecha Registro',\n      accessor: 'created_at',\n      type: 'date'\n    }\n  ];\n\n  const formFields = [\n    {\n      name: 'type',\n      label: 'Tipo de Cliente',\n      type: 'select',\n      required: true,\n      options: [\n        { value: 'empresa', label: 'Empresa' },\n        { value: 'persona', label: 'Persona Natural' }\n      ]\n    },\n    {\n      name: 'name',\n      label: 'Nombre/Razón Social',\n      type: 'text',\n      required: true,\n      placeholder: 'Ingresa el nombre o razón social'\n    },\n    {\n      name: 'ruc',\n      label: 'RUC',\n      type: 'text',\n      placeholder: 'Ingresa el RUC (solo para empresas)',\n      help: 'Solo para empresas'\n    },\n    {\n      name: 'dni',\n      label: 'DNI',\n      type: 'text',\n      placeholder: 'Ingresa el DNI (solo para personas)',\n      help: 'Solo para personas naturales'\n    },\n    {\n      name: 'contact_name',\n      label: 'Nombre de Contacto',\n      type: 'text',\n      placeholder: 'Ingresa el nombre del contacto'\n    },\n    {\n      name: 'email',\n      label: 'Email',\n      type: 'email',\n      placeholder: 'contacto@empresa.com'\n    },\n    {\n      name: 'phone',\n      label: 'Teléfono',\n      type: 'text',\n      placeholder: '+51 999 999 999'\n    },\n    {\n      name: 'address',\n      label: 'Dirección',\n      type: 'textarea',\n      placeholder: 'Ingresa la dirección completa'\n    }\n  ];\n\n  // Calcular estadísticas\n  const stats = useMemo(() => {\n    const companies = data?.companies || [];\n    return {\n      total: companies.length,\n      empresas: companies.filter(c => c.type === 'empresa').length,\n      personas: companies.filter(c => c.type === 'persona').length,\n      conEmail: companies.filter(c => c.email).length,\n      conTelefono: companies.filter(c => c.phone).length\n    };\n  }, [data]);\n\n  return (\n    <Container fluid className=\"py-4\">\n      <div className=\"fade-in\">\n        <PageHeader\n          title=\"Gestión de Clientes\"\n          subtitle=\"Crear, editar y gestionar clientes del sistema\"\n          icon={FiUsers}\n          actions={\n            <Button variant=\"primary\" onClick={handleCreate}>\n              <FiPlus className=\"me-2\" />\n              Nuevo Cliente\n            </Button>\n          }\n        />\n\n        {/* Estadísticas */}\n        <Row className=\"g-4 mb-4\">\n          <Col md={6} lg={3}>\n            <StatsCard\n              title=\"Total Clientes\"\n              value={stats.total}\n              icon={FiUsers}\n              color=\"primary\"\n              subtitle=\"Clientes registrados\"\n            />\n          </Col>\n          <Col md={6} lg={3}>\n            <StatsCard\n              title=\"Empresas\"\n              value={stats.empresas}\n              icon={FiBuilding}\n              color=\"success\"\n              subtitle=\"Clientes corporativos\"\n            />\n          </Col>\n          <Col md={6} lg={3}>\n            <StatsCard\n              title=\"Personas\"\n              value={stats.personas}\n              icon={FiUser}\n              color=\"info\"\n              subtitle=\"Clientes individuales\"\n            />\n          </Col>\n          <Col md={6} lg={3}>\n            <StatsCard\n              title=\"Con Contacto\"\n              value={stats.conEmail}\n              icon={FiMail}\n              color=\"warning\"\n              subtitle=\"Con email registrado\"\n            />\n          </Col>\n        </Row>\n\n        {/* Tabla de clientes */}\n        <Card className=\"shadow-sm border-0\">\n          <Card.Header className=\"bg-white border-bottom\">\n            <div className=\"d-flex justify-content-between align-items-center\">\n              <h5 className=\"mb-0\">\n                <FiUsers className=\"me-2 text-primary\" />\n                Lista de Clientes\n              </h5>\n              <Badge bg=\"light\" text=\"dark\" className=\"px-3 py-2\">\n                {stats.total} clientes\n              </Badge>\n            </div>\n          </Card.Header>\n          <Card.Body className=\"p-0\">\n            <DataTable\n              data={data?.companies || []}\n              columns={columns}\n              loading={isLoading}\n              onEdit={handleEdit}\n              onDelete={handleDelete}\n              emptyMessage=\"No hay clientes registrados\"\n            />\n          </Card.Body>\n        </Card>\n\n      <ModalForm\n        show={showModal}\n        onHide={() => setShowModal(false)}\n        title={editingClient?.id ? 'Editar Cliente' : 'Nuevo Cliente'}\n        data={editingClient || emptyForm}\n        fields={formFields}\n        onSubmit={handleSubmit}\n        loading={createMutation.isLoading || updateMutation.isLoading}\n        submitText={editingClient?.id ? 'Actualizar' : 'Crear'}\n      />\n      </div>\n    </Container>\n  );\n};"],"names":["emptyForm","Clientes","showModal","setShowModal","useState","editingClient","setEditingClient","deletingClient","setDeletingClient","queryClient","useQueryClient","data","isLoading","useQuery","listCompanies","handleMutationSuccess","message","createMutation","useMutation","createCompany","error","updateMutation","updateCompany","deleteMutation","deleteCompany","handleCreate","handleEdit","client","handleDelete","handleSubmit","formData","getTypeBadge","type","config","FiHome","FiUser","Icon","Badge","jsx","columns","value","row","jsxs","FiMail","FiPhone","FiMapPin","formFields","stats","useMemo","companies","c","Container","PageHeader","FiUsers","Button","FiPlus","Row","Col","StatsCard","FiBuilding","Card","DataTable","ModalForm"],"mappings":"whBAUA,MAAMA,EAAY,CAChB,KAAM,UACN,IAAK,GACL,IAAK,GACL,KAAM,GACN,QAAS,GACT,MAAO,GACP,MAAO,GACP,aAAc,EAChB,EAEA,SAAwBC,IAAW,CACjC,KAAM,CAACC,EAAWC,CAAY,EAAIC,EAAAA,SAAS,EAAK,EAC1C,CAACC,EAAeC,CAAgB,EAAIF,EAAAA,SAAS,IAAI,EACjD,CAACG,EAAgBC,CAAiB,EAAIJ,EAAAA,SAAS,IAAI,EAEnDK,EAAcC,EAAA,EAEd,CAAE,KAAAC,EAAM,UAAAC,CAAA,EAAcC,EAC1B,CAAC,SAAS,EACV,IAAMC,EAAA,EACN,CAAE,iBAAkB,EAAA,CAAK,EAGrBC,EAAyBC,GAAY,CACzCP,EAAY,kBAAkB,SAAS,EACvCN,EAAa,EAAK,EAClBG,EAAiB,IAAI,EACrBE,EAAkB,IAAI,CACxB,EAEMS,EAAiBC,EAAYC,EAAe,CAChD,UAAW,IAAMJ,EAAmD,EACpE,QAAUK,GAAU,QAAQ,MAAM,yBAA0BA,CAAK,CAAA,CAClE,EAEKC,EAAiBH,EAAYI,EAAe,CAChD,UAAW,IAAMP,EAAwD,EACzE,QAAUK,GAAU,QAAQ,MAAM,yBAA0BA,CAAK,CAAA,CAClE,EAEKG,EAAiBL,EAAYM,EAAe,CAChD,UAAW,IAAMT,EAAsD,EACvE,QAAUK,GAAU,QAAQ,MAAM,yBAA0BA,CAAK,CAAA,CAClE,EAEKK,EAAe,IAAM,CACzBnB,EAAiBN,CAAS,EAC1BG,EAAa,EAAI,CACnB,EAEMuB,EAAcC,GAAW,CAC7BrB,EAAiBqB,CAAM,EACvBxB,EAAa,EAAI,CACnB,EAEMyB,EAAgBD,GAAW,CAC3B,OAAO,QAAQ,qDAAqDA,EAAO,IAAI,IAAI,GACrFJ,EAAe,OAAOI,EAAO,EAAE,CAEnC,EAEME,EAAe,MAAOC,GAAa,CACnCzB,EAAc,GAChB,MAAMgB,EAAe,YAAY,CAAE,GAAIhB,EAAc,GAAI,GAAGyB,EAAU,EAEtE,MAAMb,EAAe,YAAYa,CAAQ,CAE7C,EAEMC,EAAgBC,GAAS,CAM7B,MAAMC,EALa,CACjB,QAAW,CAAE,GAAI,UAAW,KAAM,UAAW,KAAMC,CAAA,EACnD,QAAW,CAAE,GAAI,OAAQ,KAAM,kBAAmB,KAAMC,CAAA,CAAO,EAGvCH,CAAI,GAAK,CAAE,GAAI,YAAa,KAAMA,EAAM,KAAMG,CAAA,EAClEC,EAAOH,EAAO,KAEpB,cACGI,EAAA,CAAM,GAAIJ,EAAO,GAAI,UAAU,yCAC9B,SAAA,CAAAK,EAAAA,IAACF,EAAA,CAAK,KAAM,GAAI,UAAU,OAAO,EAChCH,EAAO,IAAA,EACV,CAEJ,EAEMM,EAAU,CACd,CACE,OAAQ,KACR,SAAU,KACV,MAAO,MAAA,EAET,CACE,OAAQ,UACR,SAAU,OACV,OAAQ,CAACC,EAAOC,WACb,MAAA,CACC,SAAA,CAAAH,EAAAA,IAAC,MAAA,CAAI,UAAU,YAAa,SAAAG,EAAI,KAAK,EACrCC,EAAAA,KAAC,MAAA,CAAI,UAAU,uCACZ,SAAA,CAAAX,EAAaU,EAAI,IAAI,EACrBA,EAAI,KACHC,OAAC,QAAA,CAAM,UAAU,aAAa,SAAA,CAAA,QAAMD,EAAI,GAAA,EAAI,EAE7CA,EAAI,KACHC,OAAC,QAAA,CAAM,UAAU,aAAa,SAAA,CAAA,QAAMD,EAAI,GAAA,CAAA,CAAI,CAAA,CAAA,CAEhD,CAAA,CAAA,CACF,CAAA,EAGJ,CACE,OAAQ,WACR,SAAU,UACV,OAAQ,CAACD,EAAOC,WACb,MAAA,CACE,SAAA,CAAAA,EAAI,cACHH,EAAAA,IAAC,MAAA,CAAI,UAAU,YAAa,WAAI,aAAa,EAE9CG,EAAI,OACHC,OAAC,MAAA,CAAI,UAAU,iCACb,SAAA,CAAAJ,EAAAA,IAACK,EAAA,CAAO,KAAM,GAAI,UAAU,kBAAkB,EAC9CL,EAAAA,IAAC,QAAA,CAAM,UAAU,aAAc,WAAI,KAAA,CAAM,CAAA,EAC3C,EAEDG,EAAI,OACHC,OAAC,MAAA,CAAI,UAAU,iCACb,SAAA,CAAAJ,EAAAA,IAACM,EAAA,CAAQ,KAAM,GAAI,UAAU,kBAAkB,EAC/CN,EAAAA,IAAC,QAAA,CAAM,UAAU,aAAc,WAAI,KAAA,CAAM,CAAA,CAAA,CAC3C,CAAA,CAAA,CAEJ,CAAA,EAGJ,CACE,OAAQ,YACR,SAAU,UACV,OAASE,GACPA,EACEE,EAAAA,KAAC,MAAA,CAAI,UAAU,4BACb,SAAA,CAAAJ,EAAAA,IAACO,EAAA,CAAS,KAAM,GAAI,UAAU,kBAAkB,EAChDP,EAAAA,IAAC,QAAA,CAAM,UAAU,aAAc,SAAAE,CAAA,CAAM,CAAA,CAAA,CACvC,EAEAF,EAAAA,IAAC,QAAA,CAAM,UAAU,aAAa,SAAA,eAAA,CAAa,CAAA,EAIjD,CACE,OAAQ,iBACR,SAAU,aACV,KAAM,MAAA,CACR,EAGIQ,EAAa,CACjB,CACE,KAAM,OACN,MAAO,kBACP,KAAM,SACN,SAAU,GACV,QAAS,CACP,CAAE,MAAO,UAAW,MAAO,SAAA,EAC3B,CAAE,MAAO,UAAW,MAAO,iBAAA,CAAkB,CAC/C,EAEF,CACE,KAAM,OACN,MAAO,sBACP,KAAM,OACN,SAAU,GACV,YAAa,kCAAA,EAEf,CACE,KAAM,MACN,MAAO,MACP,KAAM,OACN,YAAa,sCACb,KAAM,oBAAA,EAER,CACE,KAAM,MACN,MAAO,MACP,KAAM,OACN,YAAa,sCACb,KAAM,8BAAA,EAER,CACE,KAAM,eACN,MAAO,qBACP,KAAM,OACN,YAAa,gCAAA,EAEf,CACE,KAAM,QACN,MAAO,QACP,KAAM,QACN,YAAa,sBAAA,EAEf,CACE,KAAM,QACN,MAAO,WACP,KAAM,OACN,YAAa,iBAAA,EAEf,CACE,KAAM,UACN,MAAO,YACP,KAAM,WACN,YAAa,+BAAA,CACf,EAIIC,EAAQC,EAAAA,QAAQ,IAAM,CAC1B,MAAMC,GAAYtC,GAAA,YAAAA,EAAM,YAAa,CAAA,EACrC,MAAO,CACL,MAAOsC,EAAU,OACjB,SAAUA,EAAU,UAAYC,EAAE,OAAS,SAAS,EAAE,OACtD,SAAUD,EAAU,UAAYC,EAAE,OAAS,SAAS,EAAE,OACtD,SAAUD,EAAU,OAAOC,GAAKA,EAAE,KAAK,EAAE,OACzC,YAAaD,EAAU,OAAOC,GAAKA,EAAE,KAAK,EAAE,MAAA,CAEhD,EAAG,CAACvC,CAAI,CAAC,EAET,OACE2B,EAAAA,IAACa,GAAU,MAAK,GAAC,UAAU,OACzB,SAAAT,EAAAA,KAAC,MAAA,CAAI,UAAU,UACb,SAAA,CAAAJ,EAAAA,IAACc,EAAA,CACC,MAAM,sBACN,SAAS,iDACT,KAAMC,EACN,QACEX,EAAAA,KAACY,EAAA,CAAO,QAAQ,UAAU,QAAS7B,EACjC,SAAA,CAAAa,EAAAA,IAACiB,EAAA,CAAO,UAAU,MAAA,CAAO,EAAE,eAAA,CAAA,CAE7B,CAAA,CAAA,EAKJb,EAAAA,KAACc,EAAA,CAAI,UAAU,WACb,SAAA,CAAAlB,EAAAA,IAACmB,EAAA,CAAI,GAAI,EAAG,GAAI,EACd,SAAAnB,EAAAA,IAACoB,EAAA,CACC,MAAM,iBACN,MAAOX,EAAM,MACb,KAAMM,EACN,MAAM,UACN,SAAS,sBAAA,CAAA,EAEb,EACAf,EAAAA,IAACmB,EAAA,CAAI,GAAI,EAAG,GAAI,EACd,SAAAnB,EAAAA,IAACoB,EAAA,CACC,MAAM,WACN,MAAOX,EAAM,SACb,KAAMY,EACN,MAAM,UACN,SAAS,uBAAA,CAAA,EAEb,EACArB,EAAAA,IAACmB,EAAA,CAAI,GAAI,EAAG,GAAI,EACd,SAAAnB,EAAAA,IAACoB,EAAA,CACC,MAAM,WACN,MAAOX,EAAM,SACb,KAAMZ,EACN,MAAM,OACN,SAAS,uBAAA,CAAA,EAEb,EACAG,EAAAA,IAACmB,EAAA,CAAI,GAAI,EAAG,GAAI,EACd,SAAAnB,EAAAA,IAACoB,EAAA,CACC,MAAM,eACN,MAAOX,EAAM,SACb,KAAMJ,EACN,MAAM,UACN,SAAS,sBAAA,CAAA,CACX,CACF,CAAA,EACF,EAGAD,EAAAA,KAACkB,EAAA,CAAK,UAAU,qBACd,SAAA,CAAAtB,EAAAA,IAACsB,EAAK,OAAL,CAAY,UAAU,yBACrB,SAAAlB,EAAAA,KAAC,MAAA,CAAI,UAAU,oDACb,SAAA,CAAAA,EAAAA,KAAC,KAAA,CAAG,UAAU,OACZ,SAAA,CAAAJ,EAAAA,IAACe,EAAA,CAAQ,UAAU,mBAAA,CAAoB,EAAE,mBAAA,EAE3C,SACChB,EAAA,CAAM,GAAG,QAAQ,KAAK,OAAO,UAAU,YACrC,SAAA,CAAAU,EAAM,MAAM,WAAA,CAAA,CACf,CAAA,CAAA,CACF,CAAA,CACF,EACAT,EAAAA,IAACsB,EAAK,KAAL,CAAU,UAAU,MACnB,SAAAtB,EAAAA,IAACuB,EAAA,CACC,MAAMlD,GAAA,YAAAA,EAAM,YAAa,CAAA,EACzB,QAAA4B,EACA,QAAS3B,EACT,OAAQc,EACR,SAAUE,EACV,aAAa,6BAAA,CAAA,CACf,CACF,CAAA,EACF,EAEFU,EAAAA,IAACwB,EAAA,CACC,KAAM5D,EACN,OAAQ,IAAMC,EAAa,EAAK,EAChC,MAAOE,GAAA,MAAAA,EAAe,GAAK,iBAAmB,gBAC9C,KAAMA,GAAiBL,EACvB,OAAQ8C,EACR,SAAUjB,EACV,QAASZ,EAAe,WAAaI,EAAe,UACpD,WAAYhB,GAAA,MAAAA,EAAe,GAAK,aAAe,OAAA,CAAA,CACjD,CAAA,CACA,CAAA,CACF,CAEJ"}