import{b,ac as l,Q as C,c as k,R as E,j as t}from"./index-o7c7tdkB.js";import{M as A}from"./ModuloBase-DpIJbQDg.js";import{D as M}from"./DataTable-BXmKJeNO.js";import{T as P}from"./Toolbar-Dgqueffs.js";import{M as q}from"./Modal-M1gDWVxD.js";const T=(s,a={})=>{const n=new URLSearchParams;a.page&&n.set("page",a.page),a.limit&&n.set("limit",a.limit);const m=n.toString(),r=`/api/project-whatsapp-notices/project/${s}`+(m?`?${m}`:"");return b(r)},D=({project_id:s,sent_to:a,message:n})=>b("/api/project-whatsapp-notices",{method:"POST",body:JSON.stringify({project_id:s,sent_to:a,message:n})}),F=(s={})=>{const a=new URLSearchParams;s.page&&a.set("page",s.page),s.limit&&a.set("limit",s.limit),s.q&&a.set("q",s.q),s.status&&a.set("status",s.status),s.range&&a.set("range",s.range),s.project_id&&a.set("project_id",s.project_id);const n=a.toString();return b("/api/project-whatsapp-notices"+(n?`?${n}`:""))};function B(){var N;const[s,a]=l.useState(""),[n,m]=l.useState(""),[r,y]=l.useState(""),[g,w]=l.useState("30"),[d,c]=l.useState(1),[h]=l.useState(10),[S,j]=l.useState(!1),[i,p]=l.useState({sent_to:"",message:""}),_=C(),{data:o,isLoading:x}=k(["whatsapp-notices",{projectId:s,page:d,limit:h,q:n,status:r,range:g}],async()=>{if(s){const e=await T(s,{page:d,limit:h}),u=Array.isArray(e==null?void 0:e.data)?e.data:(e==null?void 0:e.rows)||e||[],v=Number((e==null?void 0:e.total)||u.length||0);return{rows:u,total:v}}else{const e=await F({page:d,limit:h,q:n,status:r,range:g}),u=Array.isArray(e==null?void 0:e.data)?e.data:(e==null?void 0:e.rows)||e||[],v=Number((e==null?void 0:e.total)||u.length||0);return{rows:u,total:v}}},{keepPreviousData:!0}),f=E(D,{onSuccess:()=>{_.invalidateQueries("whatsapp-notices"),j(!1),p({sent_to:"",message:""})}});return t.jsxs(A,{titulo:"Notificaciones WhatsApp",descripcion:"Historial y estado de notificaciones enviadas por WhatsApp.",children:[t.jsx(P,{compact:!0,left:t.jsxs(t.Fragment,{children:[t.jsx("input",{className:"form-control",style:{minWidth:160},placeholder:"ID de proyecto (opcional)",value:s,onChange:e=>{a(e.target.value),c(1)}}),!s&&t.jsxs(t.Fragment,{children:[t.jsx("input",{className:"form-control",style:{minWidth:200},placeholder:"Buscar (destinatario/mensaje)",value:n,onChange:e=>{m(e.target.value),c(1)}}),t.jsxs("select",{className:"form-select",value:r,onChange:e=>{y(e.target.value),c(1)},children:[t.jsx("option",{value:"",children:"Todos los estados"}),t.jsx("option",{value:"queued",children:"En cola"}),t.jsx("option",{value:"sent",children:"Enviado"}),t.jsx("option",{value:"delivered",children:"Entregado"}),t.jsx("option",{value:"failed",children:"Fallido"})]}),t.jsxs("select",{className:"form-select",value:g,onChange:e=>{w(e.target.value),c(1)},children:[t.jsx("option",{value:"7",children:"Últimos 7 días"}),t.jsx("option",{value:"30",children:"Últimos 30 días"}),t.jsx("option",{value:"90",children:"Últimos 90 días"}),t.jsx("option",{value:"all",children:"Todo"})]})]}),t.jsxs("div",{className:"text-muted small d-flex align-items-center",children:[(o==null?void 0:o.total)||0," resultados"]})]}),right:t.jsx(t.Fragment,{children:t.jsx("button",{className:"btn btn-primary",disabled:!s,onClick:()=>j(!0),children:"+ Enviar aviso"})})}),t.jsx(M,{columns:[{header:"ID",key:"id",width:80},{header:"Destinatario",key:"sent_to",render:e=>e.sent_to||e.to},{header:"Mensaje",key:"message"},{header:"Estado",key:"status"},{header:"Fecha",key:"sent_at",render:e=>e.sent_at?String(e.sent_at).slice(0,19).replace("T"," "):e.created_at?String(e.created_at).slice(0,19).replace("T"," "):"—",width:160}],rows:(o==null?void 0:o.rows)||[],loading:x}),t.jsxs("div",{className:"d-flex justify-content-between align-items-center mt-2",children:[t.jsxs("div",{className:"text-muted small",children:["Página ",d]}),t.jsxs("div",{className:"btn-group",children:[t.jsx("button",{className:"btn btn-outline-secondary",disabled:d<=1||x,onClick:()=>c(e=>Math.max(1,e-1)),children:"Anterior"}),t.jsx("button",{className:"btn btn-outline-secondary",disabled:(((N=o==null?void 0:o.rows)==null?void 0:N.length)||0)<h||x,onClick:()=>c(e=>e+1),children:"Siguiente"})]})]}),t.jsxs(q,{open:S,onClose:()=>j(!1),children:[t.jsx("h5",{className:"mb-2",children:"Enviar aviso WhatsApp"}),t.jsxs("div",{className:"text-muted mb-3",children:["Proyecto #",s]}),t.jsxs("div",{className:"mb-2",children:[t.jsx("label",{className:"form-label",children:"Destinatario"}),t.jsx("input",{className:"form-control",value:i.sent_to,onChange:e=>p({...i,sent_to:e.target.value}),placeholder:"Ej. +51999999999"})]}),t.jsxs("div",{className:"mb-3",children:[t.jsx("label",{className:"form-label",children:"Mensaje"}),t.jsx("textarea",{className:"form-control",rows:4,value:i.message,onChange:e=>p({...i,message:e.target.value})})]}),t.jsxs("div",{className:"d-flex justify-content-end gap-2",children:[t.jsx("button",{className:"btn btn-outline-secondary",onClick:()=>j(!1),children:"Cancelar"}),t.jsx("button",{className:"btn btn-primary",disabled:!s||!i.sent_to||!i.message||f.isLoading,onClick:()=>f.mutate({project_id:Number(s),sent_to:i.sent_to,message:i.message}),children:f.isLoading?"Enviando...":"Enviar"})]})]})]})}export{B as default};
//# sourceMappingURL=NotificacionesWhatsapp-DODTbVI0.js.map
