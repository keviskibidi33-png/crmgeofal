import{r as c,j as e}from"./index-FgnKWDtQ.js";import{M as G}from"./ModuloBase-BCXrQDzC.js";import{l as V}from"./quoteVariants-CRkmUQRg.js";import{c as U,a as X}from"./quotes-Bv-nGcaF.js";import{l as B,c as Q}from"./projects-yUBhH7vx.js";function Y({value:i,onChange:d}){const[l,x]=c.useState([]),[f,E]=c.useState(!1),[t,u]=c.useState({company_id:"",project_name:"",location:""}),[N,C]=c.useState("");c.useEffect(()=>{(async()=>{try{E(!0);const r=await B({page:1,limit:50}),h=Array.isArray(r==null?void 0:r.data)?r.data:r;x(h||[])}catch{C("No se pudo cargar empresas")}finally{E(!1)}})()},[]);const s=c.useMemo(()=>l.find(r=>String(r.id)===String(t.company_id)),[l,t.company_id]);c.useEffect(()=>{typeof d=="function"&&d({company_id:t.company_id?Number(t.company_id):null,company:s||null,project_name:t.project_name,location:t.location})},[t,s,d]);const b=async()=>{if(!(!t.company_id||!t.project_name))try{const r={company_id:Number(t.company_id),name:t.project_name,location:t.location},h=await Q(r);typeof d=="function"&&d({...i,project_id:h.id,project:h})}catch(r){C(r.message||"No se pudo crear proyecto")}};return e.jsxs("div",{className:"border rounded p-3",children:[e.jsx("h6",{children:"Cliente y Proyecto"}),N&&e.jsx("div",{className:"alert alert-warning py-1 my-2",children:N}),e.jsxs("div",{className:"row g-2 align-items-end",children:[e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label",children:"Cliente"}),e.jsxs("select",{className:"form-select",value:t.company_id,disabled:f,onChange:r=>u({...t,company_id:r.target.value}),children:[e.jsx("option",{value:"",children:"Seleccione..."}),l.map(r=>e.jsxs("option",{value:r.id,children:[r.name," ",r.ruc?`(RUC ${r.ruc})`:""]},r.id))]})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label",children:"Nombre del proyecto"}),e.jsx("input",{className:"form-control",value:t.project_name,onChange:r=>u({...t,project_name:r.target.value}),placeholder:"Ej. Control de calidad de mezclas"})]}),e.jsxs("div",{className:"col-md-3",children:[e.jsx("label",{className:"form-label",children:"Ubicación"}),e.jsx("input",{className:"form-control",value:t.location,onChange:r=>u({...t,location:r.target.value})})]}),e.jsx("div",{className:"col-md-1 d-grid",children:e.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:b,disabled:!t.company_id||!t.project_name,children:"Crear"})})]}),s&&e.jsxs("div",{className:"small text-muted mt-2",children:["Contacto: ",s.contact_name," · Tel: ",s.phone," · Email: ",s.email]})]})}const K={company_name:"",ruc:"",contact_name:"",contact_phone:"",contact_email:"",project_location:"",project_name:"",service_name:""},H={request_date:"",issue_date:"",commercial_name:"",payment_terms:"adelantado",acceptance:!1,reference:"",igv:!0},z={code:"",description:"",norm:"",unit_price:0,quantity:1};function _(i){const d=Number(i.unit_price||0),l=Number(i.quantity||0);return Number((d*l).toFixed(2))}function F(i="xxx-XX",d=""){const l=(d||"").toUpperCase().trim()||"NOMBRE DEL CLIENTE";return`Cotización ${i} LEM-GEOFAL-${l}`}const p=(i="")=>(i||"").normalize("NFD").replace(/[\u0300-\u036f]/g,"").toUpperCase().trim(),S={[p("MUESTRA DE SUELO Y AGREGADO")]:`CONDICIONES ESPECÍFICAS:
- El cliente deberá enviar al laboratorio, para los ensayo en suelo y agregados, la cantidad minima de 100 kg por cada muestra.
- El cliente deberá de entregar las muestras debidamente identificadas.
- El cliente deberá especificar la Norma a ser utilizada para la ejecución del ensayo, caso contrario se considera Norma ASTM o NTP vigente de acuerdo con el alcance del laboratorio.
- El cliente deberá entregar las muestras en las instalaciones del LEM, ubicado en la Av. Marañón N° 763, Los Olivos, Lima.`,[p("PROBETAS")]:`CONDICIONES ESPECÍFICAS:
- El cliente debe proporcionar las probetas antes del ingreso a obra.
- El cliente deberá de entregar las muestras debidamente identificadas.
- El cliente deberá especificar la Norma a ser utilizada para la ejecución del ensayo, caso contrario se considera Norma ASTM o NTP vigente de acuerdo con el alcance del laboratorio.
- El cliente deberá entregar las muestras en las instalaciones del LEM, ubicado en la Av. Marañón N° 763, Los Olivos, Lima.`,[p("DENSIDAD DE CAMPO Y MUESTREO")]:`CONDICIONES ESPECÍFICAS:
- El cliente deberá enviar al laboratorio, para los ensayo en suelo y agregados, la cantidad minima de 100 kg por cada muestra.
- Para el ensayo de Densidad de campo, la cantidad de puntos/salida minimo 4 und.
- El cliente deberá de programar el servicio, Densidad de campo, con 24 horas de anticipación.
- El cliente deberá especificar la Norma a ser utilizada para la ejecución del ensayo, caso contrario se considera Norma ASTM o NTP vigente de acuerdo con el alcance del laboratorio.
- El cliente deberá entregar las muestras en las instalaciones del LEM, ubicado en la Av. Marañón N° 763, Los Olivos, Lima.`,[p("EXTRACCIÓN DE DIAMANTINA")]:`CONDICIONES ESPECÍFICAS:
- Movilización y desmovilización de equipos y del personal técnico, estara a cargo de GEOFAL.
- Resane de estructura de concreto con sika rep 500 y Sikadur 32, estara a cargo de GEOFAL.
- El servicio no incluye trabajos de acabados como pintura, mayolica y otros.
- El area de trabajo, zona de extracción de diamantina, tiene que estar libre de interferencia.
- La extracción de diamantina se realizara en 2 dia en campo, en laboratorio se realizará el tallado y refrentado de diamantina, el ensayo de resistencia a la compresión de testigo de diamantina se realizara en 5 dias (el tiempo de ensayo obedece a la normativa vigente).
- Costo de resane insumos 250 soles, este costo se distribuira de acuerdo con el numero de perforaciones Donde se hara las extracciones de diamantina`,[p("EXTRACCION DE DIAMANTINA")]:`CONDICIONES ESPECÍFICAS:
- Movilización y desmovilización de equipos y del personal técnico, estara a cargo de GEOFAL.
- Resane de estructura de concreto con sika rep 500 y Sikadur 32, estara a cargo de GEOFAL.
- El servicio no incluye trabajos de acabados como pintura, mayolica y otros.
- El area de trabajo, zona de extracción de diamantina, tiene que estar libre de interferencia.
- La extracción de diamantina se realizara en 2 dia en campo, en laboratorio se realizará el tallado y refrentado de diamantina, el ensayo de resistencia a la compresión de testigo de diamantina se realizara en 5 dias (el tiempo de ensayo obedece a la normativa vigente).
- Costo de resane insumos 250 soles, este costo se distribuira de acuerdo con el numero de perforaciones Donde se hara las extracciones de diamantina`,[p("DIAMANTINA PARA PASES")]:`CONDICIONES ESPECÍFICAS:
- El cliente deberá de programar el servicio, Extracción diamantina, con 24 horas de anticipación.
- El area de trabajo, zona de extraccion de diamantina, debera estar libre de interferencia.
- Para extraer la diamantina, se ubicara el acero con un escaneador.
- Movilizacion y desmovilizacion de equipos y del personal tecnico, estara a cargo de Geofal.`,[p("ALBAÑILERÍA")]:`CONDICIONES ESPECÍFICAS:
- El cliente deberá enviar al laboratorio, 20 ladrillo de cada tipo, en buen estado y sin presentar fisuras.
- El cliente deberá de entregar las muestras debidamente identificadas.
- El cliente deberá especificar la Norma a ser utilizada para la ejecución del ensayo, caso contrario se considera Norma ASTM o NTP vigente de acuerdo con el alcance del laboratorio.
- El cliente deberá entregar las muestras en las instalaciones del LEM, ubicado en la Av. Marañón N° 763, Los Olivos, Lima`,[p("ALBANILERIA")]:`CONDICIONES ESPECÍFICAS:
- El cliente deberá enviar al laboratorio, 20 ladrillo de cada tipo, en buen estado y sin presentar fisuras.
- El cliente deberá de entregar las muestras debidamente identificadas.
- El cliente deberá especificar la Norma a ser utilizada para la ejecución del ensayo, caso contrario se considera Norma ASTM o NTP vigente de acuerdo con el alcance del laboratorio.
- El cliente deberá entregar las muestras en las instalaciones del LEM, ubicado en la Av. Marañón N° 763, Los Olivos, Lima`,[p("VIGA BECKELMAN")]:`CONDICIONES ESPECÍFICAS:
- El cliente deberá de programar el servicio, Ensayo de Deflexión, con 24 horas de anticipación.
- El area de trabajo tiene que estar habilitado.
- El cliente deberá especificar la Norma a ser utilizada para la ejecución del ensayo, caso contrario se considera Norma ASTM o NTP o MTC vigente de acuerdo con el alcance del laboratorio.
- Especificar las caracteristicas del camion`,[p("CONTROL DE CALIDAD DE CONCRETO FRESCO EN OBRA")]:`CONDICIONES ESPECÍFICAS:
- El cliente deberá de programar el servicio, con 24 horas de anticipación.
- Para el ensayo de control de calidad de concreto fresco en obra, se moldeara 6 probetas, ensayo slump, control de temperatura, en laboratorio las probetas se colocara en camara de curado, el ensayo de compresión de las probetas seran 3 a 7 dias y 3 a 28 dias.
- El control de calidad del concreto fresco se sacara cada 50m3 a uno de los mixer donde se hara todos los ensayos respectivos mencionados, o por dia asi no se halla llegado los 50m3.
- El cliente deberá especificar la Norma a ser utilizada para la ejecución del ensayo, caso contrario se considera Norma ASTM o NTP vigente de acuerdo con el alcance del laboratorio.`,[p("CONTROL DE CALIDAD DE CONCRETO FRESCO")]:`CONDICIONES ESPECÍFICAS:
- El cliente deberá de programar el servicio, con 24 horas de anticipación.
- Para el ensayo de control de calidad de concreto fresco en obra, se moldeara 6 probetas, ensayo slump, control de temperatura, en laboratorio las probetas se colocara en camara de curado, el ensayo de compresión de las probetas seran 3 a 7 dias y 3 a 28 dias.
- El control de calidad del concreto fresco se sacara cada 50m3 a uno de los mixer donde se hara todos los ensayos respectivos mencionados, o por dia asi no se halla llegado los 50m3.
- El cliente deberá especificar la Norma a ser utilizada para la ejecución del ensayo, caso contrario se considera Norma ASTM o NTP vigente de acuerdo con el alcance del laboratorio.`},J=i=>{const d=p((i==null?void 0:i.title)||"");if(S[d])return S[d];const l=Object.entries(S).find(([x])=>d.includes(x)||x.includes(d));return l?l[1]:""},ne=()=>{var P;const[i,d]=c.useState([]),[l,x]=c.useState(""),[f,E]=c.useState(!1),[t,u]=c.useState(K),[N,C]=c.useState({company_id:null,project_id:null,company:null,project:null}),[s,b]=c.useState(H),[r,h]=c.useState([{...z}]),[A,I]=c.useState(!1),[O,D]=c.useState("");c.useEffect(()=>{(async()=>{try{const a=await V({active:!0});d(a||[])}catch{}})()},[]);const v=c.useMemo(()=>r.reduce((a,o)=>a+_(o),0),[r]),y=c.useMemo(()=>s.igv?Number((v*.18).toFixed(2)):0,[v,s.igv]),L=c.useMemo(()=>Number((v+y).toFixed(2)),[v,y]),k=()=>h([...r,{...z}]),w=a=>h(r.filter((o,n)=>n!==a)),g=(a,o)=>h(r.map((n,m)=>m===a?{...n,...o}:n));c.useEffect(()=>{if(!l)return;const a=(i||[]).find(n=>String(n.id)===String(l));if(!a)return;const o=a.conditions||{};if(b(n=>({...n,payment_terms:o.default_payment_terms||n.payment_terms,acceptance:typeof o.default_acceptance=="boolean"?o.default_acceptance:n.acceptance,igv:typeof o.default_igv=="boolean"?o.default_igv:n.igv,reference:o.default_reference||n.reference})),Array.isArray(o.default_items)&&r.length<=1&&!r[0].code&&!r[0].description&&!r[0].norm){const n=o.default_items.map(m=>({code:m.code||"",description:m.description||"",norm:m.norm||"",unit_price:Number(m.unit_price||0),quantity:Number(m.quantity||1)}));n.length&&h(n)}o.default_service_name&&!t.service_name&&u(n=>({...n,service_name:o.default_service_name}))},[l]);const R=async a=>{var o;a.preventDefault(),I(!0),D("");try{const n={project_id:((o=N.project)==null?void 0:o.id)||N.project_id||null,variant_id:l||null,client_contact:t.contact_name,client_email:t.contact_email,client_phone:t.contact_phone,issue_date:s.issue_date||new Date().toISOString().slice(0,10),subtotal:v,igv:y,total:L,status:"borrador",meta:{customer:t,quote:s,payment_terms:s.payment_terms,acceptance:s.acceptance,reference:s.reference,subtotal:v,igv:y,file_name:F("xxx-XX",t.company_name)}},m=await U(n);for(const j of r)await X({quote_id:m.id,code:j.code,description:j.description,norm:j.norm,unit_price:Number(j.unit_price||0),quantity:Number(j.quantity||0),partial_price:_(j)});alert("Cotización creada"),q(m.id)}catch(n){D(n.message||"Error al crear cotización")}finally{I(!1)}},[M,q]=c.useState(null),T=async a=>{try{const o=M;if(!o)return alert("Guarde la cotización antes de exportar");const n="http://localhost:4000/api".replace(/\/$/,"")||"",m=`/api/quotes/${o}/export/${a}`,j=n&&/\/api$/i.test(n)?`${n}${m.replace(/^\/api/,"")}`:`${n}${m}`;window.open(j,"_blank")}catch{alert("No se pudo exportar")}},$=async()=>{try{const a=M;if(!a)return alert("Guarde la cotización antes de generar el borrador");const o="http://localhost:4000/api".replace(/\/$/,"")||"",n=`/api/quotes/${a}/export/pdf-draft`,m=o&&/\/api$/i.test(o)?`${o}${n.replace(/^\/api/,"")}`:`${o}${n}`;window.open(m,"_blank")}catch{alert("No se pudo generar el borrador")}};return e.jsxs(G,{titulo:"Nueva Cotización LEM",descripcion:"Plantilla de cotización para Laboratorio con variantes y condiciones",children:[O&&e.jsx("div",{className:"alert alert-danger",children:O}),e.jsxs("form",{onSubmit:R,children:[e.jsx(Y,{value:N,onChange:C}),e.jsxs("div",{className:"row g-3 mt-3",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsx("h5",{children:"Datos del Cliente"}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"form-label",children:"Empresa"}),e.jsx("input",{className:"form-control",value:t.company_name,onChange:a=>u({...t,company_name:a.target.value}),required:!0})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"form-label",children:"R.U.C."}),e.jsx("input",{className:"form-control",value:t.ruc,onChange:a=>u({...t,ruc:a.target.value})})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"form-label",children:"Contacto"}),e.jsx("input",{className:"form-control",value:t.contact_name,onChange:a=>u({...t,contact_name:a.target.value}),required:!0})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"form-label",children:"Teléfono"}),e.jsx("input",{className:"form-control",value:t.contact_phone,onChange:a=>u({...t,contact_phone:a.target.value})})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"form-label",children:"Correo"}),e.jsx("input",{type:"email",className:"form-control",value:t.contact_email,onChange:a=>u({...t,contact_email:a.target.value})})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"form-label",children:"Ubicación del proyecto"}),e.jsx("input",{className:"form-control",value:t.project_location,onChange:a=>u({...t,project_location:a.target.value})})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"form-label",children:"Nombre del proyecto"}),e.jsx("input",{className:"form-control",value:t.project_name,onChange:a=>u({...t,project_name:a.target.value})})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Nombre del servicio"}),e.jsx("input",{className:"form-control",value:t.service_name,onChange:a=>u({...t,service_name:a.target.value})})]})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("h5",{children:"Datos de la Cotización"}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"form-label",children:"Fecha de Solicitud"}),e.jsx("input",{type:"date",className:"form-control",value:s.request_date,onChange:a=>b({...s,request_date:a.target.value})})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"form-label",children:"Fecha de Emisión"}),e.jsx("input",{type:"date",className:"form-control",value:s.issue_date,onChange:a=>b({...s,issue_date:a.target.value})})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"form-label",children:"Comercial"}),e.jsx("input",{className:"form-control",value:s.commercial_name,onChange:a=>b({...s,commercial_name:a.target.value})})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"form-label",children:"Referencia"}),e.jsx("input",{className:"form-control",placeholder:"SEGÚN LO SOLICITADO VÍA correo / llamada",value:s.reference,onChange:a=>b({...s,reference:a.target.value})})]}),e.jsxs("div",{className:"mb-2",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsx("label",{className:"form-label mb-0",children:"Variante"}),e.jsx("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>E(!f),children:f?"Ver como lista":"Ver como cards"})]}),f?e.jsx("div",{className:"row row-cols-2 row-cols-md-3 g-2 mt-1",children:(i||[]).map(a=>{const o=J(a)||a.description||"";return e.jsx("div",{className:"col",children:e.jsx("div",{className:`card h-100 ${String(l)===String(a.id)?"border-primary":""}`,role:"button",onClick:()=>x(String(a.id)),children:e.jsxs("div",{className:"card-body py-2",children:[e.jsx("div",{className:"fw-semibold small",children:a.code}),e.jsx("div",{className:"small",children:a.title}),o?e.jsx("div",{className:"text-muted small mt-1",style:{whiteSpace:"pre-line",maxHeight:"8.5em",overflowY:"auto"},children:o}):null]})})},a.id)})}):e.jsxs("select",{className:"form-select mt-2",value:l,onChange:a=>x(a.target.value),children:[e.jsx("option",{value:"",children:"Sin variante"}),(i||[]).map(a=>e.jsxs("option",{value:a.id,children:[a.code," - ",a.title]},a.id))]})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"form-label",children:"Forma de pago"}),e.jsxs("select",{className:"form-select",value:s.payment_terms,onChange:a=>b({...s,payment_terms:a.target.value}),children:[e.jsx("option",{value:"adelantado",children:"Adelantado"}),e.jsx("option",{value:"50%",children:"Adelanto 50% y saldo previo al informe"}),e.jsx("option",{value:"credito7",children:"Crédito 7 días con OS"}),e.jsx("option",{value:"credito15",children:"Crédito 15 días con OS"}),e.jsx("option",{value:"credito30",children:"Crédito 30 días con OS"})]})]}),e.jsxs("div",{className:"form-check mb-2",children:[e.jsx("input",{className:"form-check-input",type:"checkbox",id:"igv",checked:s.igv,onChange:a=>b({...s,igv:a.target.checked})}),e.jsx("label",{className:"form-check-label",htmlFor:"igv",children:"Aplicar IGV 18%"})]}),e.jsxs("div",{className:"form-check mb-3",children:[e.jsx("input",{className:"form-check-input",type:"checkbox",id:"acceptance",checked:s.acceptance,onChange:a=>b({...s,acceptance:a.target.checked})}),e.jsx("label",{className:"form-check-label",htmlFor:"acceptance",children:"Aceptación de cotización"})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"form-label",children:"Nombre de archivo sugerido"}),e.jsx("input",{className:"form-control",value:F("xxx-XX",t.company_name),readOnly:!0})]})]})]}),e.jsx("h5",{className:"mt-3",children:"Ítems"}),e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-bordered align-middle",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Código/N° ensayo"}),e.jsx("th",{children:"Descripción"}),e.jsx("th",{children:"Norma"}),e.jsx("th",{children:"Unitario (S/)"}),e.jsx("th",{children:"Cantidad"}),e.jsx("th",{children:"Parcial (S/)"}),e.jsx("th",{})]})}),e.jsx("tbody",{children:r.map((a,o)=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("input",{className:"form-control",value:a.code,onChange:n=>g(o,{code:n.target.value})})}),e.jsx("td",{children:e.jsx("textarea",{className:"form-control",rows:1,value:a.description,onChange:n=>g(o,{description:n.target.value})})}),e.jsx("td",{children:e.jsx("input",{className:"form-control",value:a.norm,onChange:n=>g(o,{norm:n.target.value})})}),e.jsx("td",{style:{width:120},children:e.jsx("input",{type:"number",step:"0.01",className:"form-control",value:a.unit_price,onChange:n=>g(o,{unit_price:n.target.value})})}),e.jsx("td",{style:{width:100},children:e.jsx("input",{type:"number",className:"form-control",value:a.quantity,onChange:n=>g(o,{quantity:n.target.value})})}),e.jsx("td",{style:{width:120},children:_(a)}),e.jsx("td",{style:{width:80},children:e.jsx("button",{type:"button",className:"btn btn-sm btn-outline-danger",onClick:()=>w(o),disabled:r.length===1,children:"-"})})]},o))})]})}),e.jsx("div",{className:"mb-3",children:e.jsx("button",{type:"button",className:"btn btn-outline-primary",onClick:k,children:"Agregar ítem"})}),e.jsxs("div",{className:"d-flex justify-content-end align-items-center gap-4 flex-wrap",children:[e.jsxs("div",{className:"text-end",children:[e.jsxs("div",{children:["Subtotal: S/ ",v.toFixed(2)]}),e.jsxs("div",{children:["IGV 18%: S/ ",y.toFixed(2)]}),e.jsx("div",{children:e.jsxs("strong",{children:["Total: S/ ",L.toFixed(2)]})})]}),e.jsx("button",{type:"submit",className:"btn btn-success",disabled:A||!((P=N.project)!=null&&P.id)&&!N.project_id,children:A?"Guardando...":"Guardar borrador"}),e.jsx("button",{type:"button",className:"btn btn-outline-warning",onClick:$,children:"Guardar PDF Borrador"}),e.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>T("pdf"),children:"Exportar PDF"}),e.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>T("excel"),children:"Exportar Excel"})]})]})]})};export{ne as default};
//# sourceMappingURL=CotizacionNuevaLEM-D_hExgcx.js.map
