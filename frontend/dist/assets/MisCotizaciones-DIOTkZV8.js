import{b as v,a as P,c as R,r as j,e as M,n as z,j as e,C as g,B as o,t as F,F as D,K as O,v as q,L as U,m as G}from"./index-CJDD9_Aw.js";import{S as H}from"./Spinner-BVQsrHFz.js";import{A as K}from"./Alert-Cn54xJZ3.js";import{R as l,C as h}from"./Row-BGooJhRW.js";import{C as r}from"./Col-DkPevymr.js";import{F as V}from"./Form-FBPQ7LgU.js";import"./ElementChildren-B01Kjy_s.js";const W=async t=>{try{return await v(`/api/quote-approval/${t}/approve`,{method:"POST"})}catch(a){throw console.error("Error approving quote:",a),a}},X=async t=>{try{return await v(`/api/quote-approval/${t}/revert`,{method:"POST"})}catch(a){throw console.error("Error reverting quote:",a),a}},I=async(t={})=>{try{const a=new URLSearchParams;t.status&&a.append("status",t.status),t.page&&a.append("page",t.page),t.limit&&a.append("limit",t.limit);const c=a.toString(),x=`/api/quote-approval/my-quotes${c?`?${c}`:""}`;return await v(x)}catch(a){throw console.error("Error getting my quotes:",a),a}},te=()=>{var S;const{user:t}=P(),a=R(),[c,x]=j.useState({status:"",page:1,limit:20}),[i,A]=j.useState(null),[E,p]=j.useState(!1),{data:m,isLoading:Q,error:y,refetch:k}=M(["myQuotes",c],()=>I(c),{enabled:!!t,refetchOnWindowFocus:!1}),N=z(W,{onSuccess:()=>{a.invalidateQueries(["myQuotes"]),alert("Cotización aprobada exitosamente")},onError:s=>{alert(`Error aprobando cotización: ${s.message}`)}}),b=z(X,{onSuccess:()=>{a.invalidateQueries(["myQuotes"]),alert("Cotización revertida a borrador exitosamente")},onError:s=>{alert(`Error revirtiendo cotización: ${s.message}`)}}),_=s=>{window.confirm("¿Estás seguro de que quieres aprobar esta cotización?")&&N.mutate(s)},T=s=>{window.confirm("¿Estás seguro de que quieres revertir esta cotización a borrador?")&&b.mutate(s)},$=s=>{const{name:n,value:u}=s.target;x(L=>({...L,[n]:u,page:1}))},f=s=>{x(n=>({...n,page:s}))},C=s=>{const u={borrador:{variant:"warning",text:"Borrador"},aprobada:{variant:"success",text:"Aprobada"},facturada:{variant:"info",text:"Facturada"}}[s]||{variant:"secondary",text:s};return e.jsx(q,{bg:u.variant,children:u.text})},B=s=>{const n=[];return s.status==="borrador"&&n.push(e.jsxs(o,{variant:"success",size:"sm",onClick:()=>_(s.id),disabled:N.isLoading,children:[e.jsx(U,{className:"me-1"}),"Aprobar"]},"approve")),s.status==="aprobada"&&n.push(e.jsxs(o,{variant:"warning",size:"sm",onClick:()=>T(s.id),disabled:b.isLoading,children:[e.jsx(F,{className:"me-1"}),"Revertir"]},"revert")),n.push(e.jsxs(o,{variant:"outline-primary",size:"sm",onClick:()=>{A(s),p(!0)},children:[e.jsx(G,{className:"me-1"}),"Ver"]},"view")),n};if(Q)return e.jsx(g,{className:"py-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx(H,{animation:"border"}),e.jsx("p",{className:"mt-2",children:"Cargando mis cotizaciones..."})]})});if(y)return e.jsx(g,{className:"py-4",children:e.jsxs(K,{variant:"danger",children:["Error cargando cotizaciones: ",y.message]})});const w=(m==null?void 0:m.data)||[],d=(m==null?void 0:m.pagination)||{};return e.jsxs(g,{className:"py-4",children:[e.jsx(l,{className:"mb-4",children:e.jsxs(r,{children:[e.jsx("h2",{children:"Mis Cotizaciones"}),e.jsx("p",{className:"text-muted",children:"Gestiona tus cotizaciones de forma autónoma"})]})}),e.jsxs(l,{className:"mb-4",children:[e.jsx(r,{md:4,children:e.jsxs(V.Select,{name:"status",value:c.status,onChange:$,children:[e.jsx("option",{value:"",children:"Todos los estados"}),e.jsx("option",{value:"borrador",children:"Borrador"}),e.jsx("option",{value:"aprobada",children:"Aprobada"}),e.jsx("option",{value:"facturada",children:"Facturada"})]})}),e.jsx(r,{md:4,children:e.jsxs(o,{variant:"outline-secondary",onClick:()=>k(),children:[e.jsx(F,{className:"me-1"}),"Actualizar"]})})]}),e.jsx(l,{children:w.length===0?e.jsx(r,{children:e.jsx(h,{children:e.jsxs(h.Body,{className:"text-center py-5",children:[e.jsx(D,{size:48,className:"text-muted mb-3"}),e.jsx("h5",{children:"No hay cotizaciones"}),e.jsx("p",{className:"text-muted",children:c.status?`No se encontraron cotizaciones en estado "${c.status}"`:"No tienes cotizaciones registradas"})]})})}):w.map(s=>{var n;return e.jsx(r,{md:6,lg:4,className:"mb-3",children:e.jsxs(h,{children:[e.jsxs(h.Header,{className:"d-flex justify-content-between align-items-center",children:[e.jsx("strong",{children:s.quote_number||`COT-${s.id}`}),C(s.status)]}),e.jsxs(h.Body,{children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Cliente:"})," ",s.company_name||"N/A"]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Proyecto:"})," ",s.project_name||"N/A"]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Total:"})," S/ ",((n=s.total)==null?void 0:n.toFixed(2))||"0.00"]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"Fecha:"})," ",new Date(s.created_at).toLocaleDateString()]}),e.jsx("div",{className:"d-flex gap-2 flex-wrap",children:B(s)})]})]})},s.id)})}),d.pages>1&&e.jsx(l,{className:"mt-4",children:e.jsx(r,{children:e.jsx("div",{className:"d-flex justify-content-center",children:e.jsxs("div",{className:"btn-group",children:[e.jsx(o,{variant:"outline-secondary",disabled:d.page===1,onClick:()=>f(d.page-1),children:"Anterior"}),e.jsxs(o,{variant:"outline-secondary",disabled:!0,children:["Página ",d.page," de ",d.pages]}),e.jsx(o,{variant:"outline-secondary",disabled:d.page===d.pages,onClick:()=>f(d.page+1),children:"Siguiente"})]})})})}),E&&i&&e.jsx("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.5)"},children:e.jsx("div",{className:"modal-dialog modal-lg",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h5",{className:"modal-title",children:"Detalles de Cotización"}),e.jsx(o,{variant:"outline-secondary",onClick:()=>p(!1),children:e.jsx(O,{})})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs(l,{children:[e.jsxs(r,{md:6,children:[e.jsx("strong",{children:"Número:"})," ",i.quote_number||`COT-${i.id}`]}),e.jsxs(r,{md:6,children:[e.jsx("strong",{children:"Estado:"})," ",C(i.status)]})]}),e.jsx("hr",{}),e.jsxs(l,{children:[e.jsxs(r,{md:6,children:[e.jsx("strong",{children:"Cliente:"})," ",i.company_name||"N/A"]}),e.jsxs(r,{md:6,children:[e.jsx("strong",{children:"RUC:"})," ",i.company_ruc||"N/A"]})]}),e.jsxs(l,{children:[e.jsxs(r,{md:6,children:[e.jsx("strong",{children:"Proyecto:"})," ",i.project_name||"N/A"]}),e.jsxs(r,{md:6,children:[e.jsx("strong",{children:"Total:"})," S/ ",((S=i.total)==null?void 0:S.toFixed(2))||"0.00"]})]}),e.jsx("hr",{}),e.jsxs(l,{children:[e.jsxs(r,{md:6,children:[e.jsx("strong",{children:"Fecha de creación:"})," ",new Date(i.created_at).toLocaleString()]}),e.jsxs(r,{md:6,children:[e.jsx("strong",{children:"Última actualización:"})," ",new Date(i.updated_at).toLocaleString()]})]})]}),e.jsx("div",{className:"modal-footer",children:e.jsx(o,{variant:"secondary",onClick:()=>p(!1),children:"Cerrar"})})]})})})]})};export{te as default};
//# sourceMappingURL=MisCotizaciones-DIOTkZV8.js.map
