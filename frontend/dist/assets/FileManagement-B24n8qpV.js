import{r as c,a1 as W,j as e,a2 as q,H as M,T as S,B as x,K as O,ag as I,i as X,n as z,ah as Y,S as Z,ai as E,V as K,k as $,f as U,p as ee,b as R,d as se}from"./index-DEOVmouH.js";import{A as G}from"./Alert-DDQcQ1-v.js";import{R as F,C}from"./Row-BbuP-81J.js";import{T as ae,a as L}from"./Tabs-Bp3bcevM.js";import{C as t}from"./Card-Dh58Aev9.js";import{m as re}from"./ElementChildren-gaW6uce3.js";import{T as D}from"./Table-CnkmMpGQ.js";const V=1e3;function te(a,d,l){const i=(a-d)/(l-d)*100;return Math.round(i*V)/V}function _({min:a,now:d,max:l,label:i,visuallyHidden:p,striped:u,animated:m,className:h,style:n,variant:v,bsPrefix:j,...N},b){return e.jsx("div",{ref:b,...N,role:"progressbar",className:q(h,`${j}-bar`,{[`bg-${v}`]:v,[`${j}-bar-animated`]:m,[`${j}-bar-striped`]:m||u}),style:{width:`${te(d,a,l)}%`,...n},"aria-valuenow":d,"aria-valuemin":a,"aria-valuemax":l,children:p?e.jsx("span",{className:"visually-hidden",children:i}):i})}const J=c.forwardRef(({isChild:a=!1,...d},l)=>{const i={min:0,max:100,animated:!1,visuallyHidden:!1,striped:!1,...d};if(i.bsPrefix=W(i.bsPrefix,"progress"),a)return _(i,l);const{min:p,now:u,max:m,label:h,visuallyHidden:n,striped:v,animated:j,bsPrefix:N,variant:b,className:T,children:o,...B}=i;return e.jsx("div",{ref:l,...B,className:q(T,N),children:o?re(o,P=>c.cloneElement(P,{isChild:!0})):_({min:p,now:u,max:m,label:h,visuallyHidden:n,striped:v,animated:j,bsPrefix:N,variant:b},l)})});J.displayName="ProgressBar";const he=()=>{const[a,d]=c.useState(null),[l,i]=c.useState(!0),[p,u]=c.useState(null),[m,h]=c.useState(!1),[n,v]=c.useState(!0),[j,N]=c.useState(new Date),[b,T]=c.useState("overview"),o=async()=>{try{i(!0);const s=await R("/api/attachments/storage/stats");d(s),u(null),N(new Date)}catch(s){console.error("Error cargando estadísticas:",s),u("Error al cargar estadísticas de almacenamiento")}finally{i(!1)}};c.useEffect(()=>{let s;return n&&(s=setInterval(()=>{o()},3e4)),()=>{s&&clearInterval(s)}},[n]);const B=async()=>{try{h(!0),await R("/api/attachments/storage/create-folders",{method:"POST"}),await o(),alert("✅ Carpetas anticipatorias creadas exitosamente")}catch(s){console.error("Error creando carpetas:",s),alert("❌ Error al crear carpetas anticipatorias")}finally{h(!1)}},P=async()=>{try{h(!0),await R("/api/attachments/storage/compress",{method:"POST"}),await o(),alert("✅ Compresión de carpetas antiguas completada")}catch(s){console.error("Error comprimiendo carpetas:",s),alert("❌ Error al comprimir carpetas")}finally{h(!1)}},Q=()=>{if(!(a!=null&&a.folders))return[];const s={};return a.folders.forEach(r=>{const f=r.path.match(/project_(\d+)/g);f&&f.forEach(w=>{const y=w.replace("project_","");s[y]||(s[y]={projectId:y,totalSize:0,fileCount:0,folders:[]}),s[y].totalSize+=r.size,s[y].fileCount+=r.fileCount,s[y].folders.push(r)})}),Object.values(s).sort((r,f)=>f.totalSize-r.totalSize)},H=()=>a!=null&&a.folders?a.folders.filter(s=>s.path.includes(".zip")||s.path.includes(".rar")):[];c.useEffect(()=>{o()},[]);const g=s=>{if(s===0)return"0 Bytes";const r=1024,f=["Bytes","KB","MB","GB","TB"],w=Math.floor(Math.log(s)/Math.log(r));return parseFloat((s/Math.pow(r,w)).toFixed(2))+" "+f[w]},A=s=>{switch(s){case"red":return"danger";case"orange":return"warning";case"yellow":return"info";default:return"success"}},k=s=>{switch(s){case"red":return e.jsx(S,{className:"text-danger"});case"orange":return e.jsx(S,{className:"text-warning"});case"yellow":return e.jsx(S,{className:"text-info"});default:return e.jsx(se,{className:"text-success"})}};return l?e.jsx(M,{className:"mt-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"spinner-border",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Cargando..."})}),e.jsx("p",{className:"mt-2",children:"Cargando estadísticas de almacenamiento..."})]})}):p?e.jsx(M,{className:"mt-4",children:e.jsxs(G,{variant:"danger",children:[e.jsx(S,{className:"me-2"}),p,e.jsxs(x,{variant:"outline-danger",size:"sm",className:"ms-2",onClick:o,children:[e.jsx(O,{className:"me-1"}),"Reintentar"]})]})}):e.jsxs(M,{className:"mt-4",children:[e.jsx(F,{className:"mb-4",children:e.jsx(C,{children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{children:[e.jsxs("h2",{children:[e.jsx(I,{className:"me-2"}),"Gestión de Archivos"]}),e.jsx("p",{className:"text-muted",children:"Sistema inteligente de organización y monitoreo de almacenamiento"})]}),e.jsxs("div",{className:"d-flex align-items-center gap-3",children:[e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx(X,{className:`me-2 ${n?"text-success":"text-muted"}`}),e.jsxs("span",{className:n?"text-success":"text-muted",children:["Monitoreo ",n?"Activo":"Inactivo"]})]}),e.jsxs(x,{variant:n?"outline-danger":"outline-success",size:"sm",onClick:()=>v(!n),children:[n?"Pausar":"Activar"," Monitoreo"]}),e.jsxs("small",{className:"text-muted",children:["Última actualización: ",j.toLocaleTimeString()]})]})]})})}),e.jsxs(ae,{activeKey:b,onSelect:T,className:"mb-4",children:[e.jsxs(L,{eventKey:"overview",title:e.jsxs("span",{children:[e.jsx(I,{className:"me-1"}),"Resumen"]}),children:[e.jsxs(F,{className:"mb-4",children:[e.jsx(C,{md:8,children:e.jsxs(t,{children:[e.jsx(t.Header,{children:e.jsxs("h5",{className:"mb-0",children:[e.jsx(I,{className:"me-2"}),"Estado del Almacenamiento"]})}),e.jsxs(t.Body,{children:[e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"d-flex justify-content-between mb-2",children:[e.jsx("span",{children:"Uso de almacenamiento"}),e.jsxs("span",{className:"fw-bold",children:[g(a.totalSize)," / ",g(a.maxSize),e.jsxs(z,{bg:A(a.alertLevel),className:"ms-2",children:[a.usagePercentage,"%"]})]})]}),e.jsx(J,{now:a.usagePercentage,variant:A(a.alertLevel),style:{height:"20px"}})]}),e.jsxs(F,{children:[e.jsx(C,{md:6,children:e.jsxs("div",{className:"text-center p-3 border rounded",children:[e.jsx(Y,{className:"h3 text-primary mb-2"}),e.jsx("h6",{children:"Espacio Libre"}),e.jsx("h4",{className:"text-success",children:g(a.freeSpace)})]})}),e.jsx(C,{md:6,children:e.jsxs("div",{className:"text-center p-3 border rounded",children:[k(a.alertLevel),e.jsx("h6",{children:"Estado"}),e.jsx("h4",{className:`text-${A(a.alertLevel)}`,children:a.alertLevel.toUpperCase()})]})})]})]})]})}),e.jsx(C,{md:4,children:e.jsxs(t,{children:[e.jsx(t.Header,{children:e.jsx("h5",{className:"mb-0",children:"Acciones"})}),e.jsx(t.Body,{children:e.jsxs("div",{className:"d-grid gap-2",children:[e.jsxs(x,{variant:"primary",onClick:o,disabled:m,children:[e.jsx(O,{className:"me-2"}),"Actualizar Estadísticas"]}),e.jsxs(x,{variant:"success",onClick:B,disabled:m,children:[e.jsx(Z,{className:"me-2"}),"Crear Carpetas Anticipatorias"]}),e.jsxs(x,{variant:"warning",onClick:P,disabled:m,children:[e.jsx(E,{className:"me-2"}),"Comprimir Carpetas Antiguas"]})]})})]})})]}),a.alertLevel!=="green"&&e.jsx(F,{className:"mb-4",children:e.jsx(C,{children:e.jsx(G,{variant:A(a.alertLevel),children:e.jsxs("div",{className:"d-flex align-items-center",children:[k(a.alertLevel),e.jsxs("div",{className:"ms-2",children:[e.jsx("strong",{children:"Alerta de Almacenamiento"}),e.jsxs("p",{className:"mb-0",children:[a.alertLevel==="red"&&"⚠️ CRÍTICO: Almacenamiento al 95% o más. Se requiere acción inmediata.",a.alertLevel==="orange"&&"⚠️ ADVERTENCIA: Almacenamiento al 85% o más. Considere comprimir archivos antiguos.",a.alertLevel==="yellow"&&"ℹ️ INFORMACIÓN: Almacenamiento al 70% o más. Monitoree el uso."]})]})]})})})})]}),e.jsx(L,{eventKey:"by-month",title:e.jsxs("span",{children:[e.jsx(K,{className:"me-1"}),"Por Mes"]}),children:e.jsxs(t,{children:[e.jsx(t.Header,{children:e.jsxs("h5",{className:"mb-0",children:[e.jsx(K,{className:"me-2"}),"Carpetas por Mes"]})}),e.jsx(t.Body,{children:e.jsxs(D,{responsive:!0,striped:!0,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Año"}),e.jsx("th",{children:"Mes"}),e.jsx("th",{children:"Tamaño"}),e.jsx("th",{children:"Archivos"}),e.jsx("th",{children:"Estado"}),e.jsx("th",{children:"Acciones"})]})}),e.jsx("tbody",{children:a.folders.map((s,r)=>e.jsxs("tr",{children:[e.jsx("td",{children:s.year}),e.jsx("td",{children:s.month}),e.jsx("td",{children:g(s.size)}),e.jsx("td",{children:s.fileCount}),e.jsx("td",{children:e.jsx(z,{bg:s.size>100*1024*1024?"warning":"success",children:s.size>100*1024*1024?"Grande":"Normal"})}),e.jsx("td",{children:e.jsxs(x,{variant:"outline-primary",size:"sm",children:[e.jsx($,{className:"me-1"}),"Ver"]})})]},r))})]})})]})}),e.jsx(L,{eventKey:"by-client",title:e.jsxs("span",{children:[e.jsx(U,{className:"me-1"}),"Por Cliente"]}),children:e.jsxs(t,{children:[e.jsx(t.Header,{children:e.jsxs("h5",{className:"mb-0",children:[e.jsx(U,{className:"me-2"}),"Archivos por Cliente/Proyecto"]})}),e.jsx(t.Body,{children:e.jsxs(D,{responsive:!0,striped:!0,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Proyecto ID"}),e.jsx("th",{children:"Tamaño Total"}),e.jsx("th",{children:"Archivos"}),e.jsx("th",{children:"Carpetas"}),e.jsx("th",{children:"Estado"}),e.jsx("th",{children:"Acciones"})]})}),e.jsx("tbody",{children:Q().map((s,r)=>e.jsxs("tr",{children:[e.jsxs("td",{children:["Proyecto #",s.projectId]}),e.jsx("td",{children:g(s.totalSize)}),e.jsx("td",{children:s.fileCount}),e.jsx("td",{children:s.folders.length}),e.jsx("td",{children:e.jsx(z,{bg:s.totalSize>50*1024*1024?"warning":"success",children:s.totalSize>50*1024*1024?"Grande":"Normal"})}),e.jsx("td",{children:e.jsxs(x,{variant:"outline-primary",size:"sm",children:[e.jsx($,{className:"me-1"}),"Ver Detalles"]})})]},r))})]})})]})}),e.jsx(L,{eventKey:"compressed",title:e.jsxs("span",{children:[e.jsx(E,{className:"me-1"}),"Comprimidos"]}),children:e.jsxs(t,{children:[e.jsx(t.Header,{children:e.jsxs("h5",{className:"mb-0",children:[e.jsx(E,{className:"me-2"}),"Archivos Comprimidos"]})}),e.jsx(t.Body,{children:H().length>0?e.jsxs(D,{responsive:!0,striped:!0,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Archivo"}),e.jsx("th",{children:"Tamaño"}),e.jsx("th",{children:"Fecha"}),e.jsx("th",{children:"Estado"}),e.jsx("th",{children:"Acciones"})]})}),e.jsx("tbody",{children:H().map((s,r)=>e.jsxs("tr",{children:[e.jsx("td",{children:s.path.split("/").pop()}),e.jsx("td",{children:g(s.size)}),e.jsx("td",{children:new Date().toLocaleDateString()}),e.jsx("td",{children:e.jsx(z,{bg:"success",children:"Comprimido"})}),e.jsx("td",{children:e.jsxs(x,{variant:"outline-success",size:"sm",children:[e.jsx(ee,{className:"me-1"}),"Descargar"]})})]},r))})]}):e.jsxs("div",{className:"text-center py-4",children:[e.jsx(E,{className:"h1 text-muted mb-3"}),e.jsx("h5",{children:"No hay archivos comprimidos"}),e.jsx("p",{className:"text-muted",children:"Los archivos se comprimen automáticamente cuando el almacenamiento supera el 90%"})]})})]})})]})]})};export{he as default};
//# sourceMappingURL=FileManagement-B24n8qpV.js.map
