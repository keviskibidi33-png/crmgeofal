{"version":3,"file":"HistorialProyectos-3yBhYXJx.js","sources":["../../src/services/projectHistory.js","../../src/pages/HistorialProyectos.jsx"],"sourcesContent":["import { apiFetch } from './api';\n\nexport const getProjectHistory = (projectId, params = {}) => {\n  const sp = new URLSearchParams();\n  if (params.page) sp.set('page', params.page);\n  if (params.limit) sp.set('limit', params.limit);\n  const qs = sp.toString();\n  const path = `/api/project-history/project/${projectId}` + (qs ? `?${qs}` : '');\n  return apiFetch(path);\n};\n\nexport default {\n  getProjectHistory,\n};","import React, { useState, useEffect } from 'react';\nimport { useLocation } from 'react-router-dom';\nimport { useQuery } from 'react-query';\nimport ModuloBase from '../components/ModuloBase';\nimport DataTable from '../components/DataTable';\nimport Toolbar from '../components/Toolbar';\nimport { getProjectHistory } from '../services/projectHistory';\n\nexport default function HistorialProyectos() {\n  const [projectId, setProjectId] = useState('');\n  const [page, setPage] = useState(1);\n  const [limit] = useState(10);\n  const location = useLocation();\n\n  useEffect(() => {\n    if (location.state?.projectId) {\n      setProjectId(location.state.projectId);\n    }\n  }, [location.state]);\n\n  const { data, isLoading, isFetching } = useQuery(\n    ['projectHistory', projectId, page, limit],\n    () => getProjectHistory(projectId, { page, limit }),\n    {\n      enabled: !!projectId, // Only run query if projectId is set\n      keepPreviousData: true,\n    }\n  );\n\n  const rows = data?.data || [];\n  const total = data?.total || 0;\n  const totalPages = Math.max(1, Math.ceil(total / limit));\n\n  const columns = React.useMemo(() => [\n    { header: 'ID', key: 'id', width: 80 },\n    { header: 'AcciÃ³n', key: 'action' },\n    { header: 'Realizado por', key: 'performed_by' },\n    { header: 'Fecha', key: 'created_at', render: (r) => new Date(r.created_at).toLocaleString() },\n    { header: 'Notas', key: 'notes' },\n  ], []);\n\n  return (\n    <ModuloBase titulo=\"Historial de Proyectos\" descripcion=\"Consulta el historial de cambios y eventos de cada proyecto.\">\n      <Toolbar\n        left={\n          <div className=\"d-flex align-items-end gap-2\">\n            <div style={{ minWidth: '200px' }}>\n              <label htmlFor=\"project-id-input\" className=\"form-label\">ID del Proyecto</label>\n              <input\n                id=\"project-id-input\"\n                type=\"number\"\n                className=\"form-control\"\n                placeholder=\"Ingrese ID del proyecto\"\n                value={projectId}\n                onChange={(e) => {\n                  setProjectId(e.target.value);\n                  setPage(1); // Reset page when project changes\n                }}\n              />\n            </div>\n          </div>\n        }\n      />\n\n      {projectId ? (\n        <>\n          <DataTable columns={columns} rows={rows} loading={isLoading || isFetching} />\n          <div className=\"d-flex justify-content-between align-items-center mt-3\">\n            <span className=\"text-muted\">Total: {total}</span>\n            <div className=\"btn-group\">\n              <button className=\"btn btn-outline-secondary\" disabled={page <= 1} onClick={() => setPage(p => p - 1)}>Anterior</button>\n              <span className=\"btn btn-outline-secondary disabled\">{page} / {totalPages}</span>\n              <button className=\"btn btn-outline-secondary\" disabled={page >= totalPages} onClick={() => setPage(p => p + 1)}>Siguiente</button>\n            </div>\n          </div>\n        </>\n      ) : (\n        <div className=\"alert alert-info mt-3\">\n          Por favor, ingrese un ID de proyecto para ver su historial, o navegue desde la lista de proyectos.\n        </div>\n      )}\n    </ModuloBase>\n  );\n}"],"names":["getProjectHistory","projectId","params","sp","qs","path","apiFetch","HistorialProyectos","setProjectId","useState","page","setPage","limit","location","useLocation","useEffect","_a","data","isLoading","isFetching","useQuery","rows","total","totalPages","columns","React","r","jsxs","ModuloBase","jsx","Toolbar","e","Fragment","DataTable","p"],"mappings":"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"}