{"version":3,"file":"HistorialProyectos-BM_NquSZ.js","sources":["../../src/services/projectHistory.js","../../src/pages/HistorialProyectos.jsx"],"sourcesContent":["import { apiFetch } from './api';\r\n\r\nexport const getProjectHistory = (projectId, params = {}) => {\r\n  const sp = new URLSearchParams();\r\n  if (params.page) sp.set('page', params.page);\r\n  if (params.limit) sp.set('limit', params.limit);\r\n  const qs = sp.toString();\r\n  const path = `/api/project-history/project/${projectId}` + (qs ? `?${qs}` : '');\r\n  return apiFetch(path);\r\n};\r\n\r\nexport default {\r\n  getProjectHistory,\r\n};","import React, { useState, useEffect } from 'react';\r\nimport { useLocation } from 'react-router-dom';\r\nimport { useQuery } from 'react-query';\r\nimport ModuloBase from '../components/ModuloBase';\r\nimport DataTable from '../components/DataTable';\r\nimport Toolbar from '../components/Toolbar';\r\nimport { getProjectHistory } from '../services/projectHistory';\r\n\r\nexport default function HistorialProyectos() {\r\n  const [projectId, setProjectId] = useState('');\r\n  const [page, setPage] = useState(1);\r\n  const [limit] = useState(10);\r\n  const location = useLocation();\r\n\r\n  useEffect(() => {\r\n    if (location.state?.projectId) {\r\n      setProjectId(location.state.projectId);\r\n    }\r\n  }, [location.state]);\r\n\r\n  const { data, isLoading, isFetching } = useQuery(\r\n    ['projectHistory', projectId, page, limit],\r\n    () => getProjectHistory(projectId, { page, limit }),\r\n    {\r\n      enabled: !!projectId, // Only run query if projectId is set\r\n      keepPreviousData: true,\r\n    }\r\n  );\r\n\r\n  const rows = data?.data || [];\r\n  const total = data?.total || 0;\r\n  const totalPages = Math.max(1, Math.ceil(total / limit));\r\n\r\n  const columns = React.useMemo(() => [\r\n    { header: 'ID', key: 'id', width: 80 },\r\n    { header: 'AcciÃ³n', key: 'action' },\r\n    { header: 'Realizado por', key: 'performed_by' },\r\n    { header: 'Fecha', key: 'created_at', render: (r) => new Date(r.created_at).toLocaleString() },\r\n    { header: 'Notas', key: 'notes' },\r\n  ], []);\r\n\r\n  return (\r\n    <ModuloBase titulo=\"Historial de Proyectos\" descripcion=\"Consulta el historial de cambios y eventos de cada proyecto.\">\r\n      <Toolbar\r\n        left={\r\n          <div className=\"d-flex align-items-end gap-2\">\r\n            <div style={{ minWidth: '200px' }}>\r\n              <label htmlFor=\"project-id-input\" className=\"form-label\">ID del Proyecto</label>\r\n              <input\r\n                id=\"project-id-input\"\r\n                type=\"number\"\r\n                className=\"form-control\"\r\n                placeholder=\"Ingrese ID del proyecto\"\r\n                value={projectId}\r\n                onChange={(e) => {\r\n                  setProjectId(e.target.value);\r\n                  setPage(1); // Reset page when project changes\r\n                }}\r\n              />\r\n            </div>\r\n          </div>\r\n        }\r\n      />\r\n\r\n      {projectId ? (\r\n        <>\r\n          <DataTable columns={columns} rows={rows} loading={isLoading || isFetching} />\r\n          <div className=\"d-flex justify-content-between align-items-center mt-3\">\r\n            <span className=\"text-muted\">Total: {total}</span>\r\n            <div className=\"btn-group\">\r\n              <button className=\"btn btn-outline-secondary\" disabled={page <= 1} onClick={() => setPage(p => p - 1)}>Anterior</button>\r\n              <span className=\"btn btn-outline-secondary disabled\">{page} / {totalPages}</span>\r\n              <button className=\"btn btn-outline-secondary\" disabled={page >= totalPages} onClick={() => setPage(p => p + 1)}>Siguiente</button>\r\n            </div>\r\n          </div>\r\n        </>\r\n      ) : (\r\n        <div className=\"alert alert-info mt-3\">\r\n          Por favor, ingrese un ID de proyecto para ver su historial, o navegue desde la lista de proyectos.\r\n        </div>\r\n      )}\r\n    </ModuloBase>\r\n  );\r\n}"],"names":["getProjectHistory","projectId","params","sp","qs","path","apiFetch","HistorialProyectos","setProjectId","useState","page","setPage","limit","location","useLocation","useEffect","_a","data","isLoading","isFetching","useQuery","rows","total","totalPages","columns","React","r","jsxs","ModuloBase","jsx","Toolbar","e","Fragment","DataTable","p"],"mappings":"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"}