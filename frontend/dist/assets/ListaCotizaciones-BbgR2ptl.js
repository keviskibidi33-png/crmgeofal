import{r as y,u as k,c as L,e as g,n as P,j as a,C as V,F as l,B as I,o as M,f as x,N as B,v as N,m as $,z as q,Z as A,A as Q,K as z,M as H,T as R,q as G,k as O}from"./index-CJDD9_Aw.js";import{P as K}from"./PageHeader-Cfye0oPO.js";import{D as U}from"./DataTable-CI3KJtBU.js";import{S as m}from"./StatsCard-DzydegCt.js";import{C as W}from"./ConfirmModal-C4J0KUay.js";import{c as X,d as Z,l as J}from"./quotes-BPXzql52.js";import{l as Y}from"./companies-CfmLL5xp.js";import{l as ee}from"./projects-DVgYDsHe.js";import{R as ae,C as p}from"./Row-BGooJhRW.js";import{C as u}from"./Col-DkPevymr.js";import"./InputGroup-CY9SaoEq.js";import"./Form-FBPQ7LgU.js";import"./ElementChildren-B01Kjy_s.js";import"./Table-ME9p9tbt.js";import"./Spinner-BVQsrHFz.js";import"./Modal-BJZ3bxhN.js";import"./Alert-Cn54xJZ3.js";function Ce(){const[i,r]=y.useState(null),d=k(),h=L(),{data:se}=g("companiesList",()=>Y({page:1,limit:200}),{staleTime:1/0}),{data:te}=g("projectsList",()=>ee({page:1,limit:500}),{staleTime:1/0}),{data:o,isLoading:E}=g(["quotes"],()=>J(),{keepPreviousData:!0}),j=P(Z,{onSuccess:()=>{h.invalidateQueries("quotes"),r(null)},onError:e=>console.error("Error deleting quote:",e)}),F=()=>{d("/cotizaciones/nueva")},b=e=>{d(`/cotizaciones/${e.id}/editar`)},f=e=>{d(`/cotizaciones/${e.id}`)},v=e=>{r(e)},_=async()=>{try{await j.mutateAsync(i.id),r(null)}catch(e){console.error("Error eliminando cotización:",e),r(null)}},w=async e=>{try{const s={project_id:e.project_id,variant_id:e.variant_id||null,client_contact:e.client_contact,client_email:e.client_email,client_phone:e.client_phone,issue_date:new Date().toISOString().slice(0,10),subtotal:e.subtotal,igv:e.igv,total:e.total,status:"borrador",meta:{from_quote_id:e.id,...e.meta}},t=await X(s);h.invalidateQueries("quotes"),d(`/cotizaciones/${t.id}/editar`)}catch(s){console.error("Error cloning quote:",s)}},D=e=>{const t={borrador:{bg:"secondary",text:"Borrador",icon:H},enviada:{bg:"primary",text:"Enviada",icon:l},aprobada:{bg:"success",text:"Aprobada",icon:x},rechazada:{bg:"danger",text:"Rechazada",icon:z},cancelada:{bg:"warning",text:"Cancelada",icon:z}}[e]||{bg:"secondary",text:e,icon:l},n=t.icon;return a.jsxs(N,{bg:t.bg,className:"status-badge d-flex align-items-center",children:[a.jsx(n,{size:12,className:"me-1"}),t.text]})},C=e=>new Intl.NumberFormat("es-PE",{style:"currency",currency:"PEN"}).format(e||0),S=[{header:"ID",accessor:"id",width:"80px"},{header:"Código",accessor:"code",render:(e,s)=>a.jsxs("div",{children:[a.jsx("div",{className:"fw-medium",children:e||`COT-${s.id}`}),a.jsxs("small",{className:"text-muted",children:[a.jsx(R,{size:12,className:"me-1"}),new Date(s.issue_date).toLocaleDateString("es-ES")]})]})},{header:"Cliente",accessor:"client",render:(e,s)=>a.jsxs("div",{children:[a.jsx("div",{className:"fw-medium",children:s.client_contact||"Sin contacto"}),s.client_email&&a.jsxs("small",{className:"text-muted",children:[a.jsx(G,{size:12,className:"me-1"}),s.client_email]})]})},{header:"Proyecto",accessor:"project",render:(e,s)=>{var t,n;return a.jsxs("div",{children:[a.jsx("div",{className:"fw-medium",children:((t=s.project)==null?void 0:t.name)||"Sin proyecto"}),((n=s.project)==null?void 0:n.company)&&a.jsxs("small",{className:"text-muted",children:[a.jsx(O,{size:12,className:"me-1"}),s.project.company.name]})]})}},{header:"Estado",accessor:"status",render:e=>D(e)},{header:"Total",accessor:"total",render:(e,s)=>a.jsxs("div",{className:"text-end",children:[a.jsx("div",{className:"fw-bold text-success",children:C(e)}),a.jsxs("small",{className:"text-muted",children:["IGV: ",C(s.igv||0)]})]})}],c=y.useMemo(()=>{const e=(o==null?void 0:o.quotes)||[],s=e.reduce((t,n)=>{const T=parseFloat(n.total)||0;return t+T},0);return{total:e.length,borrador:e.filter(t=>t.status==="borrador").length,enviadas:e.filter(t=>t.status==="enviada").length,aprobadas:e.filter(t=>t.status==="aprobada").length,rechazadas:e.filter(t=>t.status==="rechazada").length,totalValue:s}},[o]);return a.jsxs(V,{fluid:!0,className:"py-4",children:[a.jsxs("div",{className:"fade-in",children:[a.jsx(K,{title:"Gestión de Cotizaciones",subtitle:"Crear, editar y gestionar cotizaciones del sistema",icon:l,actions:a.jsxs(I,{variant:"primary",size:"lg",onClick:F,className:"px-4 py-2 shadow-sm",style:{background:"linear-gradient(135deg, #f84616 0%, #f84616 100%)",border:"none",fontWeight:"600",fontSize:"1.1rem"},children:[a.jsx(M,{className:"me-2",size:20}),"Nueva Cotización"]})}),a.jsxs(ae,{className:"g-4 mb-4",children:[a.jsx(u,{md:6,lg:3,children:a.jsx(m,{title:"Total Cotizaciones",value:c.total,icon:l,color:"primary",subtitle:"Cotizaciones registradas"})}),a.jsx(u,{md:6,lg:3,children:a.jsx(m,{title:"Enviadas",value:c.enviadas,icon:x,color:"success",subtitle:"Enviadas a clientes"})}),a.jsx(u,{md:6,lg:3,children:a.jsx(m,{title:"Aprobadas",value:c.aprobadas,icon:x,color:"info",subtitle:"Aceptadas por clientes"})}),a.jsx(u,{md:6,lg:3,children:a.jsx(m,{title:"Valor Total",value:`S/ ${Number(c.totalValue).toLocaleString("es-PE",{minimumFractionDigits:2,maximumFractionDigits:2})}`,icon:B,color:"warning",subtitle:"Valor acumulado"})})]}),a.jsxs(p,{className:"shadow-sm border-0",children:[a.jsx(p.Header,{className:"bg-white border-bottom",children:a.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[a.jsxs("h5",{className:"mb-0",children:[a.jsx(l,{className:"me-2 text-primary"}),"Lista de Cotizaciones"]}),a.jsxs(N,{bg:"light",text:"dark",className:"px-3 py-2",children:[c.total," cotizaciones"]})]})}),a.jsx(p.Body,{className:"p-0",children:a.jsx(U,{data:(o==null?void 0:o.quotes)||[],columns:S,loading:E,onEdit:b,onDelete:v,onView:f,emptyMessage:"No hay cotizaciones registradas",actions:[{label:"Ver",icon:$,onClick:f,variant:"outline-info"},{label:"Editar",icon:q,onClick:b,variant:"outline-primary"},{label:"Clonar",icon:A,onClick:w,variant:"outline-secondary"},{label:"Eliminar",icon:Q,onClick:v,variant:"outline-danger"}]})})]})]}),a.jsx(W,{show:!!i,onHide:()=>r(null),onConfirm:_,title:"Eliminar Cotización",message:`¿Estás seguro de que quieres eliminar la cotización "${(i==null?void 0:i.code)||(i==null?void 0:i.id)}"?`,confirmText:"Eliminar",variant:"danger",isLoading:j.isLoading,alertMessage:"Esta acción eliminará permanentemente la cotización y no se puede deshacer.",alertVariant:"warning"})]})}export{Ce as default};
//# sourceMappingURL=ListaCotizaciones-BbgR2ptl.js.map
