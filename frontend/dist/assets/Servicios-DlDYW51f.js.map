{"version":3,"file":"Servicios-DlDYW51f.js","sources":["../../src/pages/Servicios.jsx"],"sourcesContent":["import React, { useState } from 'react';\r\nimport { useQuery, useMutation, useQueryClient } from 'react-query';\r\nimport { Button, Badge, Alert } from 'react-bootstrap';\r\nimport { \r\n  FiPlus, FiEdit, FiTrash2, FiSettings, FiPackage, FiHome, \r\n  FiUsers, FiShield, FiCheckCircle, FiAlertTriangle\r\n} from 'react-icons/fi';\r\nimport PageHeader from '../components/common/PageHeader';\r\nimport DataTable from '../components/common/DataTable';\r\nimport ModalForm from '../components/common/ModalForm';\r\nimport { listServices, createService, updateService, deleteService } from '../services/services';\r\nimport { useAuth } from '../contexts/AuthContext';\r\n\r\nconst emptyForm = { name: '', area: 'laboratorio' };\r\n\r\nconst AREAS = [\r\n  { value: 'laboratorio', label: 'Laboratorio' },\r\n  { value: 'comercial', label: 'Comercial' },\r\n  { value: 'soporte', label: 'Soporte' },\r\n  { value: 'sistemas', label: 'Sistemas' },\r\n  { value: 'gerencia', label: 'Gerencia' }\r\n];\r\n\r\nexport default function Servicios() {\r\n  const [showModal, setShowModal] = useState(false);\r\n  const [editingService, setEditingService] = useState(null);\r\n  const [deletingService, setDeletingService] = useState(null);\r\n  const { user } = useAuth();\r\n  const canManage = ['admin', 'jefe_laboratorio', 'jefa_comercial'].includes(user?.role);\r\n\r\n  const queryClient = useQueryClient();\r\n\r\n  const { data, isLoading } = useQuery(\r\n    ['services'],\r\n    () => listServices(),\r\n    { keepPreviousData: true }\r\n  );\r\n\r\n  const handleMutationSuccess = (message) => {\r\n    queryClient.invalidateQueries('services');\r\n    setShowModal(false);\r\n    setEditingService(null);\r\n    setDeletingService(null);\r\n  };\r\n\r\n  const createMutation = useMutation(createService, {\r\n    onSuccess: () => handleMutationSuccess('Servicio creado exitosamente'),\r\n    onError: (error) => console.error('Error creating service:', error)\r\n  });\r\n\r\n  const updateMutation = useMutation(updateService, {\r\n    onSuccess: () => handleMutationSuccess('Servicio actualizado exitosamente'),\r\n    onError: (error) => console.error('Error updating service:', error)\r\n  });\r\n\r\n  const deleteMutation = useMutation(deleteService, {\r\n    onSuccess: () => handleMutationSuccess('Servicio eliminado exitosamente'),\r\n    onError: (error) => console.error('Error deleting service:', error)\r\n  });\r\n\r\n  const handleCreate = () => {\r\n    setEditingService(emptyForm);\r\n    setShowModal(true);\r\n  };\r\n\r\n  const handleEdit = (service) => {\r\n    setEditingService(service);\r\n    setShowModal(true);\r\n  };\r\n\r\n  const handleDelete = (service) => {\r\n    if (window.confirm(`¿Estás seguro de que quieres eliminar el servicio \"${service.name}\"?`)) {\r\n      deleteMutation.mutate(service.id);\r\n    }\r\n  };\r\n\r\n  const handleSubmit = async (formData) => {\r\n    if (editingService.id) {\r\n      await updateMutation.mutateAsync({ id: editingService.id, ...formData });\r\n    } else {\r\n      await createMutation.mutateAsync(formData);\r\n    }\r\n  };\r\n\r\n  const getAreaBadge = (area) => {\r\n    const areaConfig = {\r\n      'laboratorio': { bg: 'primary', text: 'Laboratorio', icon: FiSettings },\r\n      'comercial': { bg: 'success', text: 'Comercial', icon: FiUsers },\r\n      'soporte': { bg: 'info', text: 'Soporte', icon: FiShield },\r\n      'sistemas': { bg: 'warning', text: 'Sistemas', icon: FiPackage },\r\n      'gerencia': { bg: 'danger', text: 'Gerencia', icon: FiHome }\r\n    };\r\n    \r\n    const config = areaConfig[area] || { bg: 'secondary', text: area, icon: FiSettings };\r\n    const Icon = config.icon;\r\n    \r\n    return (\r\n      <Badge bg={config.bg} className=\"status-badge d-flex align-items-center\">\r\n        <Icon size={12} className=\"me-1\" />\r\n        {config.text}\r\n      </Badge>\r\n    );\r\n  };\r\n\r\n  const columns = [\r\n    {\r\n      header: 'ID',\r\n      accessor: 'id',\r\n      width: '80px'\r\n    },\r\n    {\r\n      header: 'Nombre del Servicio',\r\n      accessor: 'name',\r\n      render: (value) => (\r\n        <div className=\"fw-medium\">{value}</div>\r\n      )\r\n    },\r\n    {\r\n      header: 'Área',\r\n      accessor: 'area',\r\n      render: (value) => getAreaBadge(value)\r\n    },\r\n    {\r\n      header: 'Estado',\r\n      accessor: 'status',\r\n      render: (value) => (\r\n        <Badge bg=\"success\" className=\"status-badge d-flex align-items-center\">\r\n          <FiCheckCircle size={12} className=\"me-1\" />\r\n          Activo\r\n        </Badge>\r\n      )\r\n    }\r\n  ];\r\n\r\n  const formFields = [\r\n    {\r\n      name: 'name',\r\n      label: 'Nombre del Servicio',\r\n      type: 'text',\r\n      required: true,\r\n      placeholder: 'Ingresa el nombre del servicio'\r\n    },\r\n    {\r\n      name: 'area',\r\n      label: 'Área',\r\n      type: 'select',\r\n      required: true,\r\n      options: AREAS\r\n    }\r\n  ];\r\n\r\n  if (!canManage) {\r\n    return (\r\n      <div className=\"fade-in\">\r\n        <PageHeader\r\n          title=\"Gestión de Servicios\"\r\n          subtitle=\"Visualiza los servicios disponibles en el sistema\"\r\n          icon={FiSettings}\r\n        />\r\n        <Alert variant=\"warning\" className=\"d-flex align-items-center\">\r\n          <FiAlertTriangle className=\"me-2\" />\r\n          No tienes permisos para gestionar servicios. Contacta al administrador.\r\n        </Alert>\r\n        <DataTable\r\n          data={data?.services || []}\r\n          columns={columns}\r\n          loading={isLoading}\r\n          emptyMessage=\"No hay servicios registrados\"\r\n        />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"fade-in\">\r\n      <PageHeader\r\n        title=\"Gestión de Servicios\"\r\n        subtitle=\"Crear, editar y gestionar servicios del sistema\"\r\n        icon={FiSettings}\r\n        actions={\r\n          <Button variant=\"primary\" onClick={handleCreate}>\r\n            <FiPlus className=\"me-2\" />\r\n            Nuevo Servicio\r\n          </Button>\r\n        }\r\n      />\r\n\r\n      <DataTable\r\n        data={data?.services || []}\r\n        columns={columns}\r\n        loading={isLoading}\r\n        onEdit={handleEdit}\r\n        onDelete={handleDelete}\r\n        emptyMessage=\"No hay servicios registrados\"\r\n      />\r\n\r\n      <ModalForm\r\n        show={showModal}\r\n        onHide={() => setShowModal(false)}\r\n        title={editingService?.id ? 'Editar Servicio' : 'Nuevo Servicio'}\r\n        data={editingService || emptyForm}\r\n        fields={formFields}\r\n        onSubmit={handleSubmit}\r\n        loading={createMutation.isLoading || updateMutation.isLoading}\r\n        submitText={editingService?.id ? 'Actualizar' : 'Crear'}\r\n      />\r\n        </div>\r\n  );\r\n}\r\n"],"names":["emptyForm","AREAS","Servicios","showModal","setShowModal","useState","editingService","setEditingService","deletingService","setDeletingService","user","useAuth","canManage","queryClient","useQueryClient","data","isLoading","useQuery","listServices","handleMutationSuccess","message","createMutation","useMutation","createService","error","updateMutation","updateService","deleteMutation","deleteService","handleCreate","handleEdit","service","handleDelete","handleSubmit","formData","getAreaBadge","area","config","FiSettings","FiUsers","FiShield","FiPackage","FiHome","Icon","Badge","jsx","columns","value","jsxs","FiCheckCircle","formFields","PageHeader","Button","FiPlus","DataTable","ModalForm","Alert","FiAlertTriangle"],"mappings":"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"}