import{r as t,j as e,P as Xe,Q as Ye,R as Ze,S as V,T as Je,U as H,V as ea,W as aa,u as sa,X as oa,E as ta,c as be,G as C,H as ia,h as T,n as h,m as B,B as S,I as ra,d as ve,Y as na,K as ca,k as Ne,O as la,l as fe,f as da,Z as ye,v as ma,_ as ua,t as _e,M as ha}from"./index-CfR9WAuT.js";import{P as pa,R as xa,C as Q}from"./PageHeader-DbJRTO5Q.js";import{D as ga}from"./DataTable-BIvqx0K5.js";import{u as ja,M as Ce}from"./ModalForm-ZT1Rbkdz.js";import{S as U}from"./StatsCard-BttFBygx.js";import{d as ba,c as va,u as Na,a as fa,b as ya,e as _a,f as Ca,l as Sa,g as qa}from"./projects-CcDpKxPh.js";import{C as ae}from"./Card-BNPLJe3K.js";import{T as Ea,a as P}from"./Tabs-h_0691Yy.js";import"./InputGroup-CE65djO7.js";import"./Form-CyVSn8yA.js";import"./Spinner-jzKous8S.js";function ka(){const r=t.useRef(!0),i=t.useRef(()=>r.current);return t.useEffect(()=>(r.current=!0,()=>{r.current=!1}),[]),i.current}const te=2**31-1;function Se(r,i,n){const m=n-Date.now();r.current=m<=te?setTimeout(i,m):setTimeout(()=>Se(r,i,n),te)}function Ta(){const r=ka(),i=t.useRef();return ja(()=>clearTimeout(i.current)),t.useMemo(()=>{const n=()=>clearTimeout(i.current);function m(g,p=0){r()&&(n(),p<=te?i.current=setTimeout(g,p):Se(i,g,Date.now()+p))}return{set:m,clear:n,handleRef:i}},[])}const Pa={[Ze]:"showing",[Ye]:"showing show"},qe=t.forwardRef((r,i)=>e.jsx(Xe,{...r,ref:i,transitionClasses:Pa}));qe.displayName="ToastFade";const Ee=t.createContext({onClose(){}}),ke=t.forwardRef(({bsPrefix:r,closeLabel:i="Close",closeVariant:n,closeButton:m=!0,className:g,children:p,...q},j)=>{r=V(r,"toast-header");const E=t.useContext(Ee),D=Je(L=>{E==null||E.onClose==null||E.onClose(L)});return e.jsxs("div",{ref:j,...q,className:H(r,g),children:[p,m&&e.jsx(ea,{"aria-label":i,variant:n,onClick:D,"data-dismiss":"toast"})]})});ke.displayName="ToastHeader";const Te=t.forwardRef(({className:r,bsPrefix:i,as:n="div",...m},g)=>(i=V(i,"toast-body"),e.jsx(n,{ref:g,className:H(r,i),...m})));Te.displayName="ToastBody";const Pe=t.forwardRef(({bsPrefix:r,className:i,transition:n=qe,show:m=!0,animation:g=!0,delay:p=5e3,autohide:q=!1,onClose:j,onEntered:E,onExit:D,onExiting:L,onEnter:ie,onEntering:O,onExited:f,bg:c,...b},K)=>{r=V(r,"toast");const w=t.useRef(p),o=t.useRef(j);t.useEffect(()=>{w.current=p,o.current=j},[p,j]);const l=Ta(),k=!!(q&&m),M=t.useCallback(()=>{k&&(o.current==null||o.current())},[k]);t.useEffect(()=>{l.set(M,w.current)},[l,M]);const I=t.useMemo(()=>({onClose:j}),[j]),G=!!(n&&g),y=e.jsx("div",{...b,ref:K,className:H(r,i,c&&`bg-${c}`,!G&&(m?"show":"hide")),role:"alert","aria-live":"assertive","aria-atomic":"true"});return e.jsx(Ee.Provider,{value:I,children:G&&n?e.jsx(n,{in:m,onEnter:ie,onEntering:O,onEntered:E,onExit:D,onExiting:L,onExited:f,unmountOnExit:!0,children:y}):y})});Pe.displayName="Toast";const se=Object.assign(Pe,{Body:Te,Header:ke}),wa={"top-start":"top-0 start-0","top-center":"top-0 start-50 translate-middle-x","top-end":"top-0 end-0","middle-start":"top-50 start-0 translate-middle-y","middle-center":"top-50 start-50 translate-middle","middle-end":"top-50 end-0 translate-middle-y","bottom-start":"bottom-0 start-0","bottom-center":"bottom-0 start-50 translate-middle-x","bottom-end":"bottom-0 end-0"},we=t.forwardRef(({bsPrefix:r,position:i,containerPosition:n,className:m,as:g="div",...p},q)=>(r=V(r,"toast-container"),e.jsx(g,{ref:q,...p,className:H(r,i&&wa[i],n&&`position-${n}`,m)})));we.displayName="ToastContainer";const oe={company_id:"",name:"",location:"",vendedor_id:"",laboratorio_id:"",requiere_laboratorio:!1,requiere_ingenieria:!1,requiere_consultoria:!1,requiere_capacitacion:!1,requiere_auditoria:!1,contact_name:"",contact_phone:"",contact_email:"",queries:"",priority:"normal",marked:!1};function Ua(){var pe,xe,ge,je;const[r,i]=t.useState(!1),[n,m]=t.useState(null),[g,p]=t.useState(null),[q,j]=t.useState(!1),[E,D]=t.useState(!1),[L,ie]=t.useState(!1),[O,f]=t.useState(!1),[c,b]=t.useState(null),[K,w]=t.useState("view"),[o,l]=t.useState({}),[k,M]=t.useState(!1),[I,G]=t.useState(""),[y,Me]=t.useState("success");aa.useEffect(()=>{console.log("🔔 Toast State - showToast:",k),console.log("🔔 Toast State - message:",I),console.log("🔔 Toast State - variant:",y)},[k,I,y]);const[W,X]=t.useState(1),[re,Ie]=t.useState(""),[ne,Fe]=t.useState(""),[ce,Ae]=t.useState(""),[le,Re]=t.useState(""),[De,de]=t.useState(!1);sa();const x=(pe=oa().state)==null?void 0:pe.selectedClient,z=ta(),{data:d,isLoading:me,refetch:Le}=be(["projects",W,re,ne,ce,le],()=>Sa({page:W,limit:20,search:re,status:ne,company_id:ce,project_type:le}),{keepPreviousData:!0,refetchOnWindowFocus:!1,refetchOnMount:!1,staleTime:3e4,cacheTime:3e5,retry:2,retryDelay:1e3}),{data:v,isLoading:$}=be(["projectStats"],qa,{refetchOnWindowFocus:!1,refetchOnMount:!1,staleTime:6e4,cacheTime:3e5,retry:1}),F=a=>{z.invalidateQueries("projects"),z.invalidateQueries("projectStats"),i(!1),m(null),p(null)},_=(a,s="success")=>{console.log("🔔 showNotification - Message:",a),console.log("🔔 showNotification - Variant:",s),G(a),Me(s),M(!0),console.log("🔔 showNotification - Toast activado")},Ge=a=>{console.log("🔍 handleSearch - Búsqueda:",a),Ie(a),X(1),de(!0),setTimeout(()=>de(!1),1e3)},ze=a=>{console.log("🔍 handleFilter - Filtros:",a),Fe(a.status||""),Ae(a.company_id||""),Re(a.project_type||""),X(1)},$e=[{title:"Por Estado",options:[{label:"Pendientes",filter:{status:"pendiente"}},{label:"Activos",filter:{status:"activo"}},{label:"Completados",filter:{status:"completado"}},{label:"Cancelados",filter:{status:"cancelado"}}]},{title:"Por Tipo de Proyecto",options:[{label:"Análisis de Suelos",filter:{project_type:"Análisis de Suelos"}},{label:"Estudio Geotécnico",filter:{project_type:"Estudio Geotécnico"}},{label:"Evaluación Ambiental",filter:{project_type:"Evaluación Ambiental"}},{label:"Control de Calidad",filter:{project_type:"Control de Calidad"}},{label:"Análisis de Agua",filter:{project_type:"Análisis de Agua"}},{label:"Estudio de Impacto",filter:{project_type:"Estudio de Impacto"}},{label:"Análisis Químico",filter:{project_type:"Análisis Químico"}},{label:"Pruebas de Laboratorio",filter:{project_type:"Pruebas de Laboratorio"}},{label:"Inspección Técnica",filter:{project_type:"Inspección Técnica"}},{label:"Certificación de Materiales",filter:{project_type:"Certificación de Materiales"}}]}],ue=C(va,{onSuccess:()=>F(),onError:a=>console.error("Error creating project:",a)}),A=C(({id:a,data:s})=>Na(a,s),{onSuccess:a=>{console.log("✅ updateMutation - Success:",a),b(a),l(a),_("✅ Proyecto actualizado exitosamente!","success"),z.invalidateQueries("projects")},onError:a=>{console.error("❌ updateMutation - Error:",a),_("❌ Error al actualizar proyecto","danger")}}),Be=C(ba,{onSuccess:()=>F(),onError:a=>console.error("Error deleting project:",a)}),Y=C(({id:a,...s})=>fa(a,s),{onSuccess:a=>{b(a),l(a),F()},onError:a=>console.error("Error updating project status:",a)}),Z=C(({id:a,...s})=>ya(a,s),{onSuccess:a=>{console.log("✅ updateCategoriesMutation - Success:",a),b(a),l(a),_("✅ Categorías guardadas correctamente!","success"),z.invalidateQueries("projects")},onError:a=>{console.error("❌ updateCategoriesMutation - Error:",a),_("❌ Error al guardar categorías","danger")}}),J=C(({id:a,...s})=>_a(a,s),{onSuccess:a=>{b(a),l(a),F()},onError:a=>console.error("Error updating project queries:",a)}),ee=C(({id:a,...s})=>Ca(a,s),{onSuccess:a=>{b(a),l(a),F()},onError:a=>console.error("Error updating project mark:",a)}),Qe=()=>{const a=x?{...oe,company_id:x.id,name:`${x.sector||"Proyecto"} - ${x.name}`,location:x.city||"",contact_name:x.contact_name||"",contact_phone:x.phone||"",contact_email:x.email||""}:oe;m(a),i(!0)},Ue=a=>{m(a),i(!0)},he=a=>{window.confirm(`¿Estás seguro de que quieres eliminar el proyecto "${a.name}"?`)&&Be.mutate(a.id)},Ve=a=>{console.log("🔍 handleViewProject - Project recibido:",a),console.log("🔍 handleViewProject - Project.id:",a==null?void 0:a.id),console.log("🔍 handleViewProject - Type of project.id:",typeof(a==null?void 0:a.id)),b(a);const s={...a,requiere_laboratorio:a.requiere_laboratorio||!1,requiere_ingenieria:a.requiere_ingenieria||!1,requiere_consultoria:a.requiere_consultoria||!1,requiere_capacitacion:a.requiere_capacitacion||!1,requiere_auditoria:a.requiere_auditoria||!1,marked:a.marked||!1,priority:a.priority||"normal",queries:a.queries||"",contact_name:a.contact_name||"",contact_phone:a.contact_phone||"",contact_email:a.contact_email||""};console.log("🔍 handleViewProject - editingData inicializado:",s),l(s),w("view"),f(!0)},He=async a=>{n.id?await A.mutateAsync({id:n.id,...a}):await ue.mutateAsync(a)},Oe=a=>{const N={activo:{bg:"success",text:"Activo"},pendiente:{bg:"warning",text:"Pendiente"},completado:{bg:"primary",text:"Completado"},cancelado:{bg:"danger",text:"Cancelado"}}[a]||{bg:"secondary",text:a};return e.jsx(h,{bg:N.bg,className:"status-badge",children:N.text})},Ke=[{header:"ID",accessor:"id",width:"80px"},{header:"Proyecto",accessor:"name",render:(a,s)=>e.jsxs("div",{children:[e.jsx("div",{className:"fw-medium",children:s.name}),s.location&&e.jsxs("small",{className:"text-muted",children:[e.jsx(ha,{size:12,className:"me-1"}),s.location]})]})},{header:"Tipo de Proyecto",accessor:"project_type",render:(a,s)=>{const N=s.project_type||"General";let u="secondary";switch(N){case"Análisis de Suelos":u="success";break;case"Estudio Geotécnico":u="primary";break;case"Evaluación Ambiental":u="info";break;case"Control de Calidad":u="warning";break;case"Análisis de Agua":u="info";break;case"Estudio de Impacto":u="danger";break;case"Análisis Químico":u="primary";break;case"Pruebas de Laboratorio":u="success";break;case"Inspección Técnica":u="warning";break;case"Certificación de Materiales":u="info";break;default:u="secondary"}return e.jsx(h,{bg:u,className:"px-2 py-1",children:N})}},{header:"Empresa",accessor:"company_name",render:(a,s)=>e.jsxs("div",{children:[e.jsx("div",{className:"fw-medium",children:s.company_name||"Sin empresa"}),s.company_ruc&&e.jsxs("small",{className:"text-muted",children:["RUC: ",s.company_ruc]})]})},{header:"Estado",accessor:"status",render:a=>Oe(a||"activo")},{header:"Servicios Requeridos",accessor:"services",render:(a,s)=>e.jsxs("div",{className:"d-flex flex-wrap gap-1",children:[s.requiere_laboratorio&&e.jsxs(h,{bg:"info",className:"px-2 py-1",children:[e.jsx(T,{size:12,className:"me-1"}),"Laboratorio"]}),s.requiere_ingenieria&&e.jsxs(h,{bg:"primary",className:"px-2 py-1",children:[e.jsx(B,{size:12,className:"me-1"}),"Ingeniería"]}),!s.requiere_laboratorio&&!s.requiere_ingenieria&&e.jsx(h,{bg:"secondary",className:"px-2 py-1",children:"Sin servicios"})]})},{header:"Contacto",accessor:"contacto",render:(a,s)=>e.jsxs("div",{className:"small",children:[s.contact_name&&e.jsx("div",{children:e.jsx("strong",{children:s.contact_name})}),s.contact_phone&&e.jsx("div",{className:"text-muted",children:s.contact_phone}),s.contact_email&&e.jsx("div",{className:"text-muted",children:s.contact_email}),!s.contact_name&&!s.contact_phone&&!s.contact_email&&e.jsx("span",{className:"text-muted",children:"Sin contacto"})]})},{header:"Asignado a",accessor:"vendedor_name",render:(a,s)=>e.jsxs("div",{children:[s.vendedor_name&&e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx(B,{size:14,className:"me-1 text-muted"}),e.jsx("span",{children:s.vendedor_name})]}),s.laboratorio_name&&e.jsxs("div",{className:"d-flex align-items-center mt-1",children:[e.jsx(T,{size:14,className:"me-1 text-muted"}),e.jsx("span",{className:"small text-muted",children:s.laboratorio_name})]})]})},{header:"Fecha Creación",accessor:"created_at",type:"date"}],We=[{name:"company_id",label:"Empresa/Cliente",type:"select",required:!0,options:((xe=d==null?void 0:d.companies)==null?void 0:xe.map(a=>({value:a.id,label:`${a.name} (${a.ruc||a.dni||"Sin RUC/DNI"})`})))||[],description:"Selecciona un cliente existente o crea uno nuevo desde el módulo de clientes"},{name:"name",label:"Nombre del Proyecto",type:"text",required:!0,placeholder:"Ingresa el nombre del proyecto"},{name:"location",label:"Ubicación del Proyecto",type:"text",placeholder:"Ingresa la ubicación del proyecto",required:!0},{name:"contact_name",label:"Persona de Contacto",type:"text",placeholder:"Nombre de la persona con quien negociar",description:"Persona responsable del proyecto en el cliente"},{name:"contact_phone",label:"Teléfono de Contacto",type:"text",placeholder:"Teléfono para comunicación directa",description:"Número para llamadas urgentes o seguimiento"},{name:"contact_email",label:"Email de Contacto",type:"email",placeholder:"Email para comunicación",description:"Email para envío de reportes y documentos"},{name:"requiere_laboratorio",label:"Requiere Laboratorio",type:"checkbox",description:"Marcar si el proyecto necesita servicios de laboratorio"},{name:"requiere_ingenieria",label:"Requiere Ingeniería",type:"checkbox",description:"Marcar si el proyecto necesita servicios de ingeniería"},{name:"requiere_consultoria",label:"Requiere Consultoría",type:"checkbox",description:"Marcar si el proyecto necesita servicios de consultoría"},{name:"requiere_capacitacion",label:"Requiere Capacitación",type:"checkbox",description:"Marcar si el proyecto necesita servicios de capacitación"},{name:"requiere_auditoria",label:"Requiere Auditoría",type:"checkbox",description:"Marcar si el proyecto necesita servicios de auditoría"},{name:"queries",label:"Consultas del Cliente",type:"textarea",placeholder:"Ingresa las consultas o dudas del cliente...",description:"Preguntas o dudas específicas del cliente sobre el proyecto"},{name:"priority",label:"Prioridad del Proyecto",type:"select",options:[{value:"low",label:"Baja"},{value:"normal",label:"Normal"},{value:"high",label:"Alta"},{value:"urgent",label:"Urgente"}],description:"Nivel de prioridad para la ejecución del proyecto"},{name:"vendedor_id",label:"Vendedor Asignado",type:"select",options:((ge=d==null?void 0:d.users)==null?void 0:ge.filter(a=>["vendedor_comercial","jefa_comercial"].includes(a.role)).map(a=>({value:a.id,label:`${a.name} ${a.apellido}`})))||[]},{name:"laboratorio_id",label:"Responsable de Laboratorio",type:"select",options:((je=d==null?void 0:d.users)==null?void 0:je.filter(a=>["jefe_laboratorio","usuario_laboratorio","laboratorio"].includes(a.role)).map(a=>({value:a.id,label:`${a.name} ${a.apellido}`})))||[]},{name:"requiere_laboratorio",label:"Requiere Servicios de Laboratorio",type:"checkbox",description:"Marcar si el proyecto necesita análisis o pruebas de laboratorio"},{name:"requiere_ingenieria",label:"Requiere Servicios de Ingeniería",type:"checkbox",description:"Marcar si el proyecto necesita estudios o consultoría de ingeniería"}],R=t.useMemo(()=>{if(v)return console.log("📊 Stats - Usando estadísticas reales del backend:",v),{total:v.total||0,activos:v.activos||0,completados:v.completados||0,pendientes:v.pendientes||0,cancelados:v.cancelados||0};const a=(d==null?void 0:d.data)||[];return console.log("📊 Stats - Fallback: calculando desde página actual:",a),{total:a.length,activos:a.filter(s=>s.status==="activo").length,completados:a.filter(s=>s.status==="completado").length,pendientes:a.filter(s=>s.status==="pendiente").length,cancelados:a.filter(s=>s.status==="cancelado").length}},[v,d]);return e.jsxs(ia,{fluid:!0,className:"py-4",children:[e.jsxs("div",{className:"fade-in",children:[e.jsx(pa,{title:"Gestión de Proyectos",subtitle:x?`Crear proyecto para: ${x.name}`:"Crear, editar y gestionar proyectos del sistema",icon:T,actions:e.jsxs("div",{className:"d-flex gap-2",children:[x&&e.jsxs(h,{bg:"info",className:"px-3 py-2 d-flex align-items-center",children:[e.jsx(B,{className:"me-1"}),"Cliente: ",x.name]}),e.jsxs(S,{variant:"primary",onClick:Qe,children:[e.jsx(ra,{className:"me-2"}),x?"Crear Proyecto":"Nuevo Proyecto"]})]})}),e.jsxs(xa,{className:"g-4 mb-4",children:[e.jsx(Q,{md:6,lg:3,children:e.jsx(U,{title:"Total Proyectos",value:R.total,icon:T,color:"primary",subtitle:"Proyectos registrados",loading:$})}),e.jsx(Q,{md:6,lg:3,children:e.jsx(U,{title:"Proyectos Activos",value:R.activos,icon:ve,color:"success",subtitle:"En desarrollo",loading:$})}),e.jsx(Q,{md:6,lg:3,children:e.jsx(U,{title:"Completados",value:R.completados,icon:ve,color:"info",subtitle:"Finalizados",loading:$})}),e.jsx(Q,{md:6,lg:3,children:e.jsx(U,{title:"Pendientes",value:R.pendientes,icon:na,color:"warning",subtitle:"Por iniciar",loading:$})})]}),e.jsxs(ae,{className:"shadow-sm border-0",children:[e.jsx(ae.Header,{className:"bg-white border-bottom",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("h5",{className:"mb-0",children:[e.jsx(T,{className:"me-2 text-primary"}),"Lista de Proyectos"]}),e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx(S,{variant:"outline-secondary",size:"sm",onClick:()=>Le(),className:"d-flex align-items-center",title:"Actualizar datos",children:e.jsx(ca,{className:`${me?"spinning":""}`})}),e.jsxs(h,{bg:"light",text:"dark",className:"px-3 py-2",children:[R.total," proyectos"]})]})]})}),e.jsx(ae.Body,{className:"p-0",children:e.jsx(ga,{data:(d==null?void 0:d.data)||[],columns:Ke,loading:me||De,onEdit:Ue,onDelete:he,actions:[{label:"Gestionar",icon:Ne,onClick:Ve,variant:"outline-primary"},{label:"Eliminar",icon:la,onClick:he,variant:"outline-danger"}],emptyMessage:"No hay proyectos registrados",totalItems:(d==null?void 0:d.total)||0,itemsPerPage:20,currentPage:W,onPageChange:X,onSearch:Ge,onFilter:ze,filterOptions:$e})})]}),e.jsx(Ce,{show:r,onHide:()=>i(!1),title:n!=null&&n.id?"Editar Proyecto":"Nuevo Proyecto",data:n||oe,fields:We,onSubmit:He,loading:ue.isLoading||A.isLoading,submitText:n!=null&&n.id?"Actualizar":"Crear"}),e.jsx(Ce,{show:O,onHide:()=>f(!1),title:`Gestionar Proyecto - ${(c==null?void 0:c.name)||""}`,data:o,fields:[{name:"project_management",label:"Gestión del Proyecto",type:"custom",render:a=>e.jsxs(Ea,{activeKey:K,onSelect:s=>w(s),className:"mb-3",children:[e.jsx(P,{eventKey:"view",title:e.jsxs("span",{children:[e.jsx(Ne,{className:"me-1"}),"Ver"]}),children:e.jsxs("div",{className:"row g-3",children:[e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"border rounded p-3 h-100",children:[e.jsxs("h6",{className:"text-primary mb-3",children:[e.jsx(T,{className:"me-2"}),"Datos Generales"]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"ID:"})," ",a.id]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Nombre:"})," ",a.name]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Ubicación:"})," ",a.location]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Tipo:"}),e.jsx(h,{bg:"info",className:"ms-2",children:a.project_type})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Estado:"}),e.jsx(h,{bg:"primary",className:"ms-2",children:a.status})]})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"border rounded p-3 h-100",children:[e.jsxs("h6",{className:"text-success mb-3",children:[e.jsx(B,{className:"me-2"}),"Información de Contacto"]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Empresa:"})," ",a.company_name]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"RUC:"})," ",a.company_ruc]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Contacto:"})," ",a.contact_name||"Sin contacto"]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Teléfono:"})," ",a.contact_phone||"Sin teléfono"]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Email:"})," ",a.contact_email||"Sin email"]})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"border rounded p-3 h-100",children:[e.jsxs("h6",{className:"text-warning mb-3",children:[e.jsx(fe,{className:"me-2"}),"Servicios Requeridos"]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Laboratorio:"}),a.requiere_laboratorio?e.jsx(h,{bg:"info",className:"ms-2",children:"Requerido"}):e.jsx(h,{bg:"secondary",className:"ms-2",children:"No requerido"})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Ingeniería:"}),a.requiere_ingenieria?e.jsx(h,{bg:"success",className:"ms-2",children:"Requerido"}):e.jsx(h,{bg:"secondary",className:"ms-2",children:"No requerido"})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Estado Lab:"}),e.jsx(h,{bg:"info",className:"ms-2",children:a.laboratorio_status})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Estado Ing:"}),e.jsx(h,{bg:"success",className:"ms-2",children:a.ingenieria_status})]})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"border rounded p-3 h-100",children:[e.jsxs("h6",{className:"text-info mb-3",children:[e.jsx(da,{className:"me-2"}),"Asignaciones"]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Vendedor:"})," ",a.vendedor_name||"Sin asignar"]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Laboratorio:"})," ",a.laboratorio_name||"Sin asignar"]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Fecha Creación:"})," ",new Date(a.created_at).toLocaleDateString()]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Última Actualización:"})," ",new Date(a.updated_at).toLocaleDateString()]})]})}),a.status_notes&&e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"border rounded p-3",children:[e.jsxs("h6",{className:"text-muted mb-3",children:[e.jsx(ye,{className:"me-2"}),"Notas del Estado"]}),e.jsx("p",{className:"mb-0",children:a.status_notes})]})})]})}),e.jsx(P,{eventKey:"edit",title:e.jsxs("span",{children:[e.jsx(ma,{className:"me-1"}),"Editar"]}),children:e.jsxs("div",{className:"row g-3",children:[e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Nombre del Proyecto"}),e.jsx("input",{type:"text",className:"form-control",value:o.name||"",onChange:s=>l({...o,name:s.target.value})})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Ubicación"}),e.jsx("input",{type:"text",className:"form-control",value:o.location||"",onChange:s=>l({...o,location:s.target.value})})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Persona de Contacto"}),e.jsx("input",{type:"text",className:"form-control",value:o.contact_name||"",onChange:s=>{console.log("🔍 contact_name onChange:",s.target.value),l({...o,contact_name:s.target.value})}})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Teléfono de Contacto"}),e.jsx("input",{type:"text",className:"form-control",value:o.contact_phone||"",onChange:s=>l({...o,contact_phone:s.target.value})})]})}),e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Email de Contacto"}),e.jsx("input",{type:"email",className:"form-control",value:o.contact_email||"",onChange:s=>l({...o,contact_email:s.target.value})})]})}),e.jsx("div",{className:"col-12",children:e.jsx(S,{variant:"primary",onClick:()=>{const s=c==null?void 0:c.id;if(console.log("🔍 selectedProject:",c),console.log("🔍 projectId:",s),console.log("🔍 typeof projectId:",typeof s),!s){console.error("No se encontró el ID del proyecto"),_("❌ Error: No se encontró el ID del proyecto","danger");return}const N=typeof s=="object"?s.id:s;console.log("🔍 numericId:",N),console.log("🔍 Guardando cambios del proyecto:",o),A.mutate({id:N,data:o},{onSuccess:u=>{console.log("✅ Guardar Cambios - Éxito:",u),_("✅ Proyecto actualizado exitosamente!","success")},onError:u=>{console.error("❌ Guardar Cambios - Error:",u),_("❌ Error al actualizar proyecto","danger")}})},disabled:A.isLoading,children:A.isLoading?"Guardando...":"Guardar Cambios"})})]})}),e.jsx(P,{eventKey:"status",title:e.jsxs("span",{children:[e.jsx(fe,{className:"me-1"}),"Estado"]}),children:e.jsxs("div",{className:"row g-3",children:[e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Estado del Proyecto"}),e.jsxs("select",{className:"form-select",value:o.status||"",onChange:s=>l({...o,status:s.target.value}),children:[e.jsx("option",{value:"pendiente",children:"Pendiente"}),e.jsx("option",{value:"en_proceso",children:"En Proceso"}),e.jsx("option",{value:"completado",children:"Completado"}),e.jsx("option",{value:"pausado",children:"Pausado"}),e.jsx("option",{value:"cancelado",children:"Cancelado"})]})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Estado del Laboratorio"}),e.jsxs("select",{className:"form-select",value:o.laboratorio_status||"",onChange:s=>l({...o,laboratorio_status:s.target.value}),children:[e.jsx("option",{value:"no_requerido",children:"No Requerido"}),e.jsx("option",{value:"pendiente",children:"Pendiente"}),e.jsx("option",{value:"en_proceso",children:"En Proceso"}),e.jsx("option",{value:"completado",children:"Completado"}),e.jsx("option",{value:"pausado",children:"Pausado"}),e.jsx("option",{value:"cancelado",children:"Cancelado"})]})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Estado de Ingeniería"}),e.jsxs("select",{className:"form-select",value:o.ingenieria_status||"",onChange:s=>l({...o,ingenieria_status:s.target.value}),children:[e.jsx("option",{value:"no_requerido",children:"No Requerido"}),e.jsx("option",{value:"pendiente",children:"Pendiente"}),e.jsx("option",{value:"en_proceso",children:"En Proceso"}),e.jsx("option",{value:"completado",children:"Completado"}),e.jsx("option",{value:"pausado",children:"Pausado"}),e.jsx("option",{value:"cancelado",children:"Cancelado"})]})]})}),e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Notas del Estado"}),e.jsx("textarea",{className:"form-control",rows:"3",value:o.status_notes||"",onChange:s=>l({...o,status_notes:s.target.value}),placeholder:"Agrega comentarios sobre el cambio de estado..."})]})}),e.jsx("div",{className:"col-12",children:e.jsx(S,{variant:"success",onClick:()=>{const s=c==null?void 0:c.id;if(!s){console.error("No se encontró el ID del proyecto");return}Y.mutate({id:s,...o}),f(!1)},disabled:Y.isLoading,children:Y.isLoading?"Actualizando...":"Actualizar Estado"})})]})}),e.jsx(P,{eventKey:"categories",title:e.jsxs("span",{children:[e.jsx(ua,{className:"me-1"}),"Categorías"]}),children:e.jsxs("div",{className:"row g-3",children:[e.jsxs("div",{className:"col-12",children:[e.jsx("h6",{className:"mb-3",children:"Categorías del Proyecto"}),e.jsxs("div",{className:"form-check",children:[e.jsx("input",{className:"form-check-input",type:"checkbox",id:"cat_laboratorio",checked:o.requiere_laboratorio||!1,onChange:s=>{console.log("🔍 requiere_laboratorio onChange:",s.target.checked),l({...o,requiere_laboratorio:s.target.checked})}}),e.jsx("label",{className:"form-check-label",htmlFor:"cat_laboratorio",children:"Laboratorio"})]}),e.jsxs("div",{className:"form-check",children:[e.jsx("input",{className:"form-check-input",type:"checkbox",id:"cat_ingenieria",checked:o.requiere_ingenieria||!1,onChange:s=>l({...o,requiere_ingenieria:s.target.checked})}),e.jsx("label",{className:"form-check-label",htmlFor:"cat_ingenieria",children:"Ingeniería"})]}),e.jsxs("div",{className:"form-check",children:[e.jsx("input",{className:"form-check-input",type:"checkbox",id:"cat_consultoria",checked:o.requiere_consultoria||!1,onChange:s=>l({...o,requiere_consultoria:s.target.checked})}),e.jsx("label",{className:"form-check-label",htmlFor:"cat_consultoria",children:"Consultoría"})]}),e.jsxs("div",{className:"form-check",children:[e.jsx("input",{className:"form-check-input",type:"checkbox",id:"cat_capacitacion",checked:o.requiere_capacitacion||!1,onChange:s=>l({...o,requiere_capacitacion:s.target.checked})}),e.jsx("label",{className:"form-check-label",htmlFor:"cat_capacitacion",children:"Capacitación"})]}),e.jsxs("div",{className:"form-check",children:[e.jsx("input",{className:"form-check-input",type:"checkbox",id:"cat_auditoria",checked:o.requiere_auditoria||!1,onChange:s=>l({...o,requiere_auditoria:s.target.checked})}),e.jsx("label",{className:"form-check-label",htmlFor:"cat_auditoria",children:"Auditoría"})]})]}),e.jsx("div",{className:"col-12",children:e.jsx(S,{variant:"info",onClick:()=>{console.log("selectedProject:",c),console.log("selectedProject.id:",c==null?void 0:c.id),console.log("editingData:",o);const s=c==null?void 0:c.id;if(!s){console.error("No se encontró el ID del proyecto");return}Z.mutate({id:s,requiere_laboratorio:o.requiere_laboratorio||!1,requiere_ingenieria:o.requiere_ingenieria||!1,requiere_consultoria:o.requiere_consultoria||!1,requiere_capacitacion:o.requiere_capacitacion||!1,requiere_auditoria:o.requiere_auditoria||!1})},disabled:Z.isLoading,children:Z.isLoading?"Guardando...":"Guardar Categorías"})})]})}),e.jsx(P,{eventKey:"queries",title:e.jsxs("span",{children:[e.jsx(ye,{className:"me-1"}),"Consultas"]}),children:e.jsxs("div",{className:"row g-3",children:[e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Consultas y Dudas del Cliente"}),e.jsx("textarea",{className:"form-control",rows:"8",value:o.queries||"",onChange:s=>l({...o,queries:s.target.value}),placeholder:"Ingresa las consultas o dudas del cliente..."})]})}),e.jsx("div",{className:"col-12",children:e.jsx(S,{variant:"warning",onClick:()=>{const s=c==null?void 0:c.id;if(!s){console.error("No se encontró el ID del proyecto");return}J.mutate({id:s,queries:o.queries||""})},disabled:J.isLoading,children:J.isLoading?"Guardando...":"Guardar Consultas"})})]})}),e.jsx(P,{eventKey:"mark",title:e.jsxs("span",{children:[e.jsx(_e,{className:"me-1"}),"Marcar"]}),children:e.jsx("div",{className:"row g-3",children:e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h6",{className:"mb-3",children:"Marcar Proyecto"}),e.jsx("p",{className:"text-muted mb-4",children:"Marca este proyecto para seguimiento especial o prioridad alta."}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Prioridad"}),e.jsxs("select",{className:"form-select",value:o.priority||"normal",onChange:s=>l({...o,priority:s.target.value}),children:[e.jsx("option",{value:"low",children:"Baja"}),e.jsx("option",{value:"normal",children:"Normal"}),e.jsx("option",{value:"high",children:"Alta"}),e.jsx("option",{value:"urgent",children:"Urgente"})]})]}),e.jsxs(S,{variant:"success",size:"lg",onClick:()=>{const s=c==null?void 0:c.id;if(!s){console.error("No se encontró el ID del proyecto");return}ee.mutate({id:s,marked:!o.marked,priority:o.priority||"normal"}),f(!1)},disabled:ee.isLoading,children:[e.jsx(_e,{className:"me-2"}),ee.isLoading?"Procesando...":o.marked?"Desmarcar Proyecto":"Marcar Proyecto"]})]})})})})]})}],onSubmit:()=>f(!1),submitText:"Cerrar",size:"xl"})]}),e.jsx(we,{position:"top-end",className:"p-3",style:{zIndex:9999},children:e.jsxs(se,{show:k,onClose:()=>{console.log("🔔 Toast - Cerrando notificación"),M(!1)},delay:3e3,autohide:!0,bg:y,onShow:()=>console.log("🔔 Toast - Mostrando notificación"),children:[e.jsx(se.Header,{children:e.jsx("strong",{className:"me-auto",children:y==="success"?"✅ Éxito":"❌ Error"})}),e.jsx(se.Body,{className:"text-white",children:I})]})})]})}export{Ua as default};
//# sourceMappingURL=Proyectos-CmaZld7Y.js.map
