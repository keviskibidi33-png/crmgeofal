import{r as o,c as te,e as P,H as m,j as a,I as le,h as S,B as U,J as ie,K as ne,o as ce,n as de,L as ue,p as w,A as me}from"./index-CJuzvD_R.js";import{P as he}from"./PageHeader-NoH3AoYJ.js";import{D as pe}from"./DataTable-Dr__4Ol-.js";import{M as _}from"./ModalForm-CRTtXpsx.js";import{S as h}from"./StatsCard-D4P-ueZT.js";import{c as be,u as ge,d as fe,r as xe,l as ve,g as je}from"./users-efug1JdH.js";import{R as Se,C as y}from"./Row-B9arpL02.js";import{C as p}from"./Col-DXGSQkwi.js";import"./InputGroup-En6Uyfcr.js";import"./Form-CKV1GU6x.js";import"./ElementChildren-GtC5s3Ff.js";import"./Table-Ct6XUerj.js";/* empty css                     */import"./Modal-VRH4uMZk.js";import"./Spinner-BhrlrNe3.js";const q={name:"",apellido:"",email:"",role:"vendedor_comercial",area:"Comercial",password:""},A=[{value:"admin",label:"Administrador"},{value:"jefa_comercial",label:"Jefa Comercial"},{value:"vendedor_comercial",label:"Vendedor Comercial"},{value:"jefe_laboratorio",label:"Jefe Laboratorio"},{value:"usuario_laboratorio",label:"Usuario Laboratorio"},{value:"laboratorio",label:"Laboratorio"},{value:"soporte",label:"Soporte"},{value:"gerencia",label:"Gerencia"}],we=[{value:"Comercial",label:"Comercial"},{value:"Laboratorio",label:"Laboratorio"},{value:"Sistemas",label:"Sistemas"},{value:"Gerencia",label:"Gerencia"},{value:"Soporte",label:"Soporte"}];function Be(){const[T,n]=o.useState(!1),[s,b]=o.useState(null),[ye,k]=o.useState(null),[c,g]=o.useState(null),[f,C]=o.useState(""),[x,v]=o.useState(1),[N,D]=o.useState(""),[B,I]=o.useState(""),[O,H]=o.useState(""),[G,E]=o.useState(!1),F=te(),{data:t,isLoading:j,refetch:Q}=P(["users",x,N,B,O],()=>ve({page:x,limit:20,search:N}),{keepPreviousData:!0,refetchOnWindowFocus:!0,refetchOnMount:!0,staleTime:0,cacheTime:0}),{data:l,isLoading:d}=P(["userStats"],je,{refetchOnWindowFocus:!0,refetchOnMount:!0,staleTime:3e4,cacheTime:6e4}),u=e=>{F.invalidateQueries("users"),F.invalidateQueries("userStats"),n(!1),b(null),k(null),g(null),C("")},J=e=>{console.log("🔍 handleSearch - Búsqueda:",e),D(e),v(1),E(!0),setTimeout(()=>E(!1),1e3)},z=e=>{console.log("🔍 handleFilter - Filtros:",e),I(e.role||""),H(e.area||""),v(1)},R=m(be,{onSuccess:()=>u(),onError:e=>console.error("Error creating user:",e)}),L=m(ge,{onSuccess:()=>u(),onError:e=>console.error("Error updating user:",e)}),W=m(fe,{onSuccess:()=>u(),onError:e=>console.error("Error deleting user:",e)}),M=m(xe,{onSuccess:()=>u(),onError:e=>console.error("Error resetting password:",e)}),K=()=>{b(q),n(!0)},V=e=>{b(e),n(!0)},$=e=>{window.confirm(`¿Estás seguro de que quieres eliminar al usuario ${e.name}?`)&&W.mutate(e.id)},X=e=>{g(e),C("")},Y=async e=>{s.id?await L.mutateAsync({id:s.id,...e}):await R.mutateAsync(e)},Z=async()=>{f&&c&&await M.mutateAsync({id:c.id,password:f})},ee=e=>({admin:"danger",jefa_comercial:"warning",vendedor_comercial:"primary",jefe_laboratorio:"info",usuario_laboratorio:"secondary",laboratorio:"secondary",soporte:"success",gerencia:"dark"})[e]||"secondary",ae=e=>{const r=A.find(oe=>oe.value===e);return r?r.label:e},se=[{header:"ID",accessor:"id",width:"80px"},{header:"Nombre",accessor:"name",render:(e,r)=>a.jsxs("div",{children:[a.jsxs("div",{className:"fw-medium",children:[r.name," ",r.apellido]}),a.jsx("small",{className:"text-muted",children:r.email})]})},{header:"Rol",accessor:"role",render:e=>a.jsx(w,{bg:ee(e),className:"status-badge",children:ae(e)})},{header:"Área",accessor:"area",render:e=>a.jsx(w,{bg:"light",text:"dark",className:"status-badge",children:e})},{header:"Fecha Creación",accessor:"created_at",type:"date"}],re=[{name:"name",label:"Nombre",type:"text",required:!0,placeholder:"Ingresa el nombre"},{name:"apellido",label:"Apellido",type:"text",required:!0,placeholder:"Ingresa el apellido"},{name:"email",label:"Email",type:"email",required:!0,placeholder:"usuario@ejemplo.com"},{name:"role",label:"Rol",type:"select",required:!0,options:A},{name:"area",label:"Área",type:"select",required:!0,options:we},{name:"password",label:"Contraseña",type:"password",required:!(s!=null&&s.id),placeholder:"Mínimo 6 caracteres",help:s!=null&&s.id?"Dejar vacío para mantener la contraseña actual":"Mínimo 6 caracteres"}],i=o.useMemo(()=>{if(l)return console.log("📊 Stats - Usando estadísticas reales del backend:",l),{total:l.total||0,admins:l.admins||0,vendedores:l.vendedores||0,laboratorio:l.laboratorio||0,activos:l.active||0};const e=(t==null?void 0:t.data)||[];return console.log("📊 Stats - Fallback: calculando desde página actual:",e),{total:e.length,admins:e.filter(r=>r.role==="admin").length,vendedores:e.filter(r=>r.role==="vendedor_comercial").length,laboratorio:e.filter(r=>["jefe_laboratorio","usuario_laboratorio","laboratorio"].includes(r.role)).length,activos:e.filter(r=>r.active!==!1).length}},[l,t]);return a.jsx(le,{fluid:!0,className:"py-4",children:a.jsxs("div",{className:"fade-in",children:[a.jsx(he,{title:"Gestión de Usuarios",subtitle:"Crear, editar, eliminar y gestionar usuarios del sistema",icon:S,actions:a.jsxs(U,{variant:"primary",onClick:K,children:[a.jsx(ie,{className:"me-2"}),"Nuevo Usuario"]})}),a.jsxs(Se,{className:"g-4 mb-4",children:[a.jsx(p,{md:6,lg:3,children:a.jsx(h,{title:"Total Usuarios",value:i.total,icon:S,color:"primary",subtitle:"Usuarios registrados",loading:d})}),a.jsx(p,{md:6,lg:3,children:a.jsx(h,{title:"Administradores",value:i.admins,icon:ne,color:"danger",subtitle:"Usuarios con privilegios",loading:d})}),a.jsx(p,{md:6,lg:3,children:a.jsx(h,{title:"Vendedores",value:i.vendedores,icon:ce,color:"success",subtitle:"Equipo comercial",loading:d})}),a.jsx(p,{md:6,lg:3,children:a.jsx(h,{title:"Laboratorio",value:i.laboratorio,icon:de,color:"info",subtitle:"Personal técnico",loading:d})})]}),a.jsxs(y,{className:"shadow-sm border-0",children:[a.jsx(y.Header,{className:"bg-white border-bottom",children:a.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[a.jsxs("h5",{className:"mb-0",children:[a.jsx(S,{className:"me-2 text-primary"}),"Lista de Usuarios"]}),a.jsxs("div",{className:"d-flex align-items-center gap-2",children:[a.jsx(U,{variant:"outline-primary",size:"sm",onClick:()=>Q(),disabled:j,className:"refresh-btn",children:a.jsx(ue,{className:j?"spinning":""})}),a.jsxs(w,{bg:"light",text:"dark",className:"px-3 py-2",children:[i.total," usuarios"]})]})]})}),a.jsx(y.Body,{className:"p-0",children:a.jsx(pe,{data:(t==null?void 0:t.data)||[],columns:se,loading:j||G,onEdit:V,onDelete:$,emptyMessage:"No hay usuarios registrados",totalItems:(t==null?void 0:t.total)||0,itemsPerPage:20,currentPage:x,onPageChange:v,onSearch:J,onFilter:z,actions:[{label:"Restablecer Contraseña",icon:me,onClick:X,variant:"outline-warning"}]})})]}),a.jsx(_,{show:T,onHide:()=>n(!1),title:s!=null&&s.id?"Editar Usuario":"Nuevo Usuario",data:s||q,fields:re,onSubmit:Y,loading:R.isLoading||L.isLoading,submitText:s!=null&&s.id?"Actualizar":"Crear"}),c&&a.jsx(_,{show:!!c,onHide:()=>g(null),title:"Restablecer Contraseña",data:{password:f},fields:[{name:"password",label:"Nueva Contraseña",type:"password",required:!0,placeholder:"Mínimo 6 caracteres"}],onSubmit:Z,loading:M.isLoading,submitText:"Restablecer"})]})})}export{Be as default};
//# sourceMappingURL=Usuarios-RXN3aWYz.js.map
