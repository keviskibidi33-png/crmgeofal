import{r as l,j as e,B as w,o as Z,w as ea,e as Ce,a2 as sa,C as M,T as be,N as Ke,a0 as aa,z as ke,k as oe,b as ia,f as ne,y as Ss,n as je,g as Be,a5 as Qe,a6 as ys,X as Xe,a as ra,u as ta,a7 as na,c as oa,x as ge,A as la,m as ca,J as vs,a1 as da,V as Ns,F as we,a8 as _s,_ as ws,K as ma}from"./index-CDayYYh0.js";import{g as ha,e as ua,f as xa,h as pa}from"./authHelper-YcFWq3xo.js";import{P as ga}from"./PageHeader-TwGN4X1N.js";import{D as ba}from"./DataTable-fBHHupz0.js";/* empty css                     */import{M as Se}from"./Modal-DfQWsS-G.js";import{F as c}from"./Form-CukTEVnv.js";import{R as X,C as ja}from"./Row-CeY1UBxE.js";import{C as q}from"./Col-Bcdl2XMD.js";import{S as Ze}from"./Spinner-BFSKMpy4.js";import{S as Re}from"./StatsCard-CwkDyVPe.js";import{C as Je}from"./ConfirmModal-CXaDN9lK.js";import{P as fa}from"./PermissionDeniedModal-awQvARvK.js";import{c as ya,u as va,d as Na,a as _a,b as wa,e as Sa,l as Ca,g as qa}from"./projects-DJh1lR4x.js";import{l as Ye,u as ka,d as Ea,a as Fa}from"./attachments-PB3o7_en.js";import{l as za}from"./users-DCI6J8CV.js";import{l as Aa,a as Pa}from"./services-B3-ciDnT.js";import{C as h}from"./Card-DxGUdTXm.js";import{A as qe}from"./Alert-pvqi0VvY.js";/* empty css                  */import"./InputGroup-BfugZ8Gm.js";import"./Table-DcOWcae_.js";import"./ElementChildren-DjJrrPtR.js";const $e=({show:v,onHide:b,title:z,data:k={},fields:i=[],onSubmit:E,loading:j=!1,size:L="lg",submitText:u="Guardar",cancelText:G="Cancelar",validation:F={},className:f=""})=>{const[A,D]=l.useState({}),[B,H]=l.useState({}),[le,I]=l.useState({}),[$,d]=l.useState({}),[x,n]=l.useState({});l.useEffect(()=>{v&&(D(k),H({}),I({}))},[v,k]);const S=(r,p)=>{D(N=>({...N,[r]:p})),B[r]&&H(N=>({...N,[r]:null}));const g=i.find(N=>N.name===r);if(g&&g.autocomplete&&g.suggestions&&p.length>0){const N=g.suggestions.filter(y=>y.toLowerCase().includes(p.toLowerCase()));d(y=>({...y,[r]:N.slice(0,5)})),n(y=>({...y,[r]:!0}))}else n(N=>({...N,[r]:!1}))},Y=r=>{if(I(p=>({...p,[r]:!0})),setTimeout(()=>{n(p=>({...p,[r]:!1}))},200),F[r]){const p=F[r](A[r],A);p&&H(g=>({...g,[r]:p}))}},fe=(r,p)=>{D(g=>({...g,[r]:p})),n(g=>({...g,[r]:!1}))},ce=()=>{const r={};let p=!0;return i.forEach(g=>{if(g.required&&(!A[g.name]||A[g.name]===""))r[g.name]=`${g.label} es requerido`,p=!1;else if(F[g.name]){const N=F[g.name](A[g.name],A);N&&(r[g.name]=N,p=!1)}}),H(r),p},ee=async r=>{if(r.preventDefault(),ce())try{await E(A),b()}catch(p){console.error("Error submitting form:",p)}},se=r=>{var N;const p=le[r.name]&&B[r.name],g=A[r.name]||"";switch(r.type){case"text":case"email":case"password":return e.jsxs(c.Group,{className:"mb-3 position-relative",children:[e.jsxs(c.Label,{children:[r.label,r.required&&e.jsx("span",{className:"text-danger ms-1",children:"*"})]}),e.jsx(c.Control,{type:r.type,name:r.name,value:g,onChange:y=>S(r.name,y.target.value),onBlur:()=>Y(r.name),isInvalid:p,placeholder:r.placeholder,disabled:r.disabled}),p&&e.jsx(c.Control.Feedback,{type:"invalid",children:B[r.name]}),r.help&&e.jsx(c.Text,{className:"text-muted",children:r.help}),r.autocomplete&&x[r.name]&&$[r.name]&&$[r.name].length>0&&e.jsx("div",{className:"autocomplete-suggestions position-absolute w-100",style:{zIndex:1e3,top:"100%"},children:e.jsx("div",{className:"list-group",children:$[r.name].map((y,de)=>e.jsx("button",{type:"button",className:"list-group-item list-group-item-action",onClick:()=>fe(r.name,y),style:{fontSize:"0.875rem",padding:"0.5rem 0.75rem"},children:y},de))})})]},r.name);case"textarea":return e.jsxs(c.Group,{className:"mb-3",children:[e.jsxs(c.Label,{children:[r.label,r.required&&e.jsx("span",{className:"text-danger ms-1",children:"*"})]}),e.jsx(c.Control,{as:"textarea",rows:r.rows||3,name:r.name,value:g,onChange:y=>S(r.name,y.target.value),onBlur:()=>Y(r.name),isInvalid:p,placeholder:r.placeholder}),p&&e.jsx(c.Control.Feedback,{type:"invalid",children:B[r.name]})]},r.name);case"select":return e.jsxs(c.Group,{className:"mb-3",children:[e.jsxs(c.Label,{children:[r.label,r.required&&e.jsx("span",{className:"text-danger ms-1",children:"*"})]}),e.jsxs(c.Select,{name:r.name,value:g,onChange:y=>S(r.name,y.target.value),onBlur:()=>Y(r.name),isInvalid:p,children:[e.jsx("option",{value:"",children:"Seleccionar..."}),(N=r.options)==null?void 0:N.map(y=>e.jsx("option",{value:y.value,children:y.label},y.value))]}),p&&e.jsx(c.Control.Feedback,{type:"invalid",children:B[r.name]})]},r.name);case"number":return e.jsxs(c.Group,{className:"mb-3",children:[e.jsxs(c.Label,{children:[r.label,r.required&&e.jsx("span",{className:"text-danger ms-1",children:"*"})]}),e.jsx(c.Control,{type:"number",name:r.name,value:g,onChange:y=>S(r.name,parseFloat(y.target.value)||""),onBlur:()=>Y(r.name),isInvalid:p,placeholder:r.placeholder,min:r.min,max:r.max,step:r.step}),p&&e.jsx(c.Control.Feedback,{type:"invalid",children:B[r.name]})]},r.name);case"checkbox":return e.jsx(c.Group,{className:"mb-3",children:e.jsx(c.Check,{type:"checkbox",name:r.name,checked:!!g,onChange:y=>S(r.name,y.target.checked),label:r.label})},r.name);case"custom":return e.jsx("div",{className:"mb-3",children:r.render&&r.render(A)},r.name);default:return null}};return e.jsxs(Se,{show:v,onHide:b,size:L,className:f,children:[e.jsx(Se.Header,{closeButton:!0,className:"border-0 pb-0",children:e.jsx(Se.Title,{className:"fw-bold",children:z})}),e.jsxs(c,{onSubmit:ee,children:[e.jsx(Se.Body,{className:"pt-0",children:e.jsx(X,{children:i.map(r=>e.jsx(q,{md:r.col||12,children:se(r)},r.name))})}),e.jsxs(Se.Footer,{className:"border-0 pt-0",children:[e.jsxs(w,{variant:"outline-secondary",onClick:b,disabled:j,children:[e.jsx(Z,{className:"me-1"}),G]}),e.jsx(w,{type:"submit",variant:"primary",disabled:j,children:j?e.jsxs(e.Fragment,{children:[e.jsx(Ze,{size:"sm",className:"me-1"}),"Guardando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ea,{className:"me-1"}),u]})})]})]})]})};function Ta({selectedServices:v=[],onServicesChange:b}){const[z,k]=l.useState(""),[i,E]=l.useState(null),[j,L]=l.useState([]),{data:u,isLoading:G}=Ce(["services"],()=>Aa({}),{staleTime:5*60*1e3,cacheTime:10*60*1e3}),{data:F,isLoading:f}=Ce(["subservices",i==null?void 0:i.id],()=>i?Pa({service_id:i.id}):null,{enabled:!!i,staleTime:5*60*1e3,cacheTime:10*60*1e3}),A=(u==null?void 0:u.data)||(u==null?void 0:u.rows)||[],D=(F==null?void 0:F.data)||(F==null?void 0:F.rows)||[],B=A.filter(d=>{var x,n;return((x=d.name)==null?void 0:x.toLowerCase().includes(z.toLowerCase()))||((n=d.description)==null?void 0:n.toLowerCase().includes(z.toLowerCase()))}),H=d=>{if(!v.some(n=>n.ensayo.id===d.id)){if(v.length>=5){alert("Máximo 5 servicios pueden ser seleccionados");return}E(d),L([])}},le=d=>{const x=j.some(n=>n.id===d.id);L(x?n=>n.filter(S=>S.id!==d.id):n=>[...n,d])},I=()=>{if(i&&j.length>0){const d={ensayo:i,subservices:j,total:j.reduce((x,n)=>x+(n.precio||0),0)};b([...v,d]),E(null),L([])}},$=d=>{const x=v.filter((n,S)=>S!==d);b(x)};return e.jsxs("div",{className:"service-selection",children:[e.jsxs(h,{className:"mb-4",children:[e.jsx(h.Header,{children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("h6",{className:"mb-0",children:[e.jsx(sa,{className:"me-2"}),"Selección de Servicios"]}),e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsxs(M,{bg:"info",children:[v.length,"/5 seleccionados"]}),v.length>0&&e.jsxs(w,{variant:"outline-danger",size:"sm",onClick:()=>b([]),children:[e.jsx(Z,{size:12,className:"me-1"}),"Limpiar"]})]})]})}),e.jsxs(h.Body,{children:[e.jsx("div",{className:"mb-3",children:e.jsx(c.Control,{type:"text",placeholder:"Buscar servicios...",value:z,onChange:d=>k(d.target.value)})}),G?e.jsxs("div",{className:"text-center py-4",children:[e.jsx(Ze,{animation:"border",variant:"primary"}),e.jsx("p",{className:"mt-2 text-muted",children:"Cargando servicios..."})]}):e.jsx(X,{className:"g-3",children:B.map(d=>{const x=v.some(S=>S.ensayo.id===d.id),n=(i==null?void 0:i.id)===d.id;return e.jsx(q,{md:6,lg:4,children:e.jsx(h,{className:`h-100 cursor-pointer ${x?"border-success":n?"border-primary":""} ${x?"bg-light text-dark":""}`,onClick:()=>H(d),children:e.jsxs(h.Body,{children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-start mb-2",children:[e.jsx("h6",{className:"mb-1",children:d.name}),x?e.jsx(M,{bg:"success",children:e.jsx(be,{size:14})}):n?e.jsx(M,{bg:"primary",children:e.jsx(be,{size:14})}):null]}),e.jsx("p",{className:"text-muted small mb-2",children:d.description||"Sin descripción"}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("small",{className:"text-muted",children:[e.jsx(Ke,{className:"me-1",size:12}),d.norma||"N/A"]}),e.jsxs(M,{bg:d.subservices_count>0?"info":"secondary",children:[d.subservices_count||0," subservicios"]})]})]})})},d.id)})}),i&&e.jsxs(h,{className:"mt-4 border-primary",children:[e.jsx(h.Header,{children:e.jsxs("h6",{className:"mb-0",children:["Subservicios de: ",i.name]})}),e.jsxs(h.Body,{children:[f?e.jsxs("div",{className:"text-center py-3",children:[e.jsx(Ze,{animation:"border",size:"sm",variant:"primary"}),e.jsx("p",{className:"mt-2 text-muted small",children:"Cargando subservicios..."})]}):D.length>0?e.jsx(X,{className:"g-2",children:D.map(d=>{const x=j.some(n=>n.id===d.id);return e.jsx(q,{md:6,lg:4,children:e.jsx(h,{className:`h-100 cursor-pointer ${x?"border-success":""}`,onClick:()=>le(d),children:e.jsxs(h.Body,{className:"p-3",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-start mb-2",children:[e.jsx("h6",{className:"mb-1 small",children:d.codigo}),x&&e.jsx(M,{bg:"success",children:e.jsx(be,{size:12})})]}),e.jsx("p",{className:"text-muted small mb-2",children:d.descripcion}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsx("small",{className:"text-muted",children:d.norma||"-"}),e.jsxs(M,{bg:d.precio>0?"success":"warning",children:[e.jsx(aa,{className:"me-1",size:10}),d.precio>0?`S/ ${d.precio}`:"Sujeto a evaluación"]})]})]})})},d.id)})}):e.jsx(qe,{variant:"info",className:"mb-0",children:"No hay subservicios disponibles para este servicio."}),j.length>0&&e.jsx("div",{className:"mt-3 text-center",children:e.jsxs(w,{variant:"success",onClick:I,disabled:j.length===0,children:[e.jsx(be,{className:"me-1"}),"Agregar ",j.length," subservicio(s) seleccionado(s)"]})})]})]})]})]}),v.length>0&&e.jsxs(h,{className:"border-success",children:[e.jsx(h.Header,{children:e.jsxs("h6",{className:"mb-0 text-success",children:[e.jsx(be,{className:"me-2"}),"Servicios Seleccionados (",v.length,")"]})}),e.jsx(h.Body,{children:v.map((d,x)=>e.jsx(h,{className:"mb-3",children:e.jsx(h.Body,{children:e.jsxs("div",{className:"d-flex justify-content-between align-items-start",children:[e.jsxs("div",{children:[e.jsx("h6",{className:"mb-1",children:d.ensayo.name}),e.jsx("p",{className:"text-muted small mb-2",children:d.ensayo.description}),e.jsx("div",{className:"d-flex flex-wrap gap-1",children:d.subservices.map((n,S)=>e.jsx(M,{bg:"info",className:"me-1",children:n.codigo},S))})]}),e.jsxs("div",{className:"text-end",children:[e.jsxs("h6",{className:"text-success mb-1",children:["S/ ",d.total.toFixed(2)]}),e.jsx(w,{variant:"outline-danger",size:"sm",onClick:()=>$(x),children:e.jsx(Z,{size:14})})]})]})})},x))})]})]})}function La({onServicesChange:v,selectedServices:b=[]}){const z=k=>{v(k)};return e.jsxs(h,{className:"mb-4",children:[e.jsx(h.Header,{children:e.jsxs("h6",{className:"mb-0",children:[e.jsx(ke,{className:"me-2"}),"Configuración de Servicios del Proyecto"]})}),e.jsxs(h.Body,{children:[e.jsxs(qe,{variant:"info",className:"mb-4",children:[e.jsx(oe,{className:"me-2"}),e.jsxs("div",{children:[e.jsx("strong",{children:"Servicios:"})," Selecciona los servicios que necesitas para este proyecto.",e.jsx("br",{}),e.jsx("small",{className:"text-muted",children:"Puedes elegir entre diferentes tipos de servicios (Laboratorio, Ingeniería, etc.) y sus subservicios correspondientes. Máximo 5 servicios."})]})]}),e.jsx(Ta,{selectedServices:b,onServicesChange:z}),b.length>0&&e.jsxs(h,{className:"border-success mt-4",children:[e.jsx(h.Header,{children:e.jsxs("h6",{className:"mb-0 text-success",children:[e.jsx(be,{className:"me-2"}),"Resumen de Servicios Seleccionados"]})}),e.jsx(h.Body,{children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Total de Servicios:"})," ",b.length]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Total de Subservicios:"})," ",b.reduce((k,i)=>k+i.subservices.length,0)]})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Subtotal:"})," S/ ",b.reduce((k,i)=>k+i.total,0).toFixed(2)]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"IGV (18%):"})," S/ ",(b.reduce((k,i)=>k+i.total,0)*.18).toFixed(2)]}),e.jsxs("div",{className:"fw-bold text-success",children:[e.jsx("strong",{children:"Total:"})," S/ ",(b.reduce((k,i)=>k+i.total,0)*1.18).toFixed(2)]})]})]})})]})]})]})}const Ia=async(v,b)=>{try{const z=new URLSearchParams({type:v,q:b});return await ia(`/companies/search?${z.toString()}`)}catch(z){throw console.error("Error en búsqueda de empresas:",z),z}};function Ma({data:v={},onSubmit:b,loading:z=!1,onCancel:k}){const[i,E]=l.useState({clientType:"",client_id:"",client_name:"",client_info:{},name:"",location:"",vendedor_id:"",laboratorio_id:"",contact_name:"",contact_phone:"",contact_email:"",priority:"normal",marked:!1,requiere_laboratorio:!1,requiere_ingenieria:!1,requiere_capacitacion:!1}),[j,L]=l.useState(1),[u,G]=l.useState({}),[F,f]=l.useState(""),[A,D]=l.useState([]),[B,H]=l.useState(!1),[le,I]=l.useState(!1),[$,d]=l.useState(null),x=4;l.useEffect(()=>{v&&E(t=>({...t,...v}))},[v]);const n=(t,m)=>{E(_=>({..._,[t]:m})),u[t]&&G(_=>({..._,[t]:null}))},S=async t=>{if(console.log("🔍 handleSearch - Iniciando búsqueda:",{searchTerm:t,clientType:i.clientType}),!t||t.length<2){console.log("🔍 handleSearch - Término muy corto, cancelando búsqueda"),D([]),I(!1);return}if(!i.clientType){console.log("🔍 handleSearch - No hay tipo de cliente seleccionado"),D([]),I(!1);return}H(!0);try{console.log("🔍 handleSearch - Llamando a searchCompanies...");const m=await Ia(i.clientType,t);if(console.log("🔍 handleSearch - Respuesta recibida:",m),m.success){const _=m.data||[];console.log("🔍 handleSearch - Resultados encontrados:",_.length),D(_),I(!0);const U=_.find(me=>{const K=me.name.toLowerCase().trim(),ae=t.toLowerCase().trim();if(console.log("🔍 Comparando:",{clientName:K,searchName:ae}),K===ae)return console.log("✅ Coincidencia exacta encontrada"),!0;if(K.replace(/\s+/g," ")===ae.replace(/\s+/g," "))return console.log("✅ Coincidencia sin espacios extra encontrada"),!0;const ve=K.replace(/[^\w\s]/g,""),he=ae.replace(/[^\w\s]/g,"");return ve===he?(console.log("✅ Coincidencia sin caracteres especiales encontrada"),!0):!1});U?(console.log("🎯 Cliente detectado automáticamente:",U.name),Y(U,!0)):console.log("❌ No se encontró coincidencia exacta")}else console.log("❌ handleSearch - Respuesta no exitosa:",m),D([]),I(!1)}catch(m){console.error("❌ Error en búsqueda:",m),D([]),I(!1)}finally{H(!1)}},Y=(t,m=!1)=>{E(_=>({..._,client_id:t.id,client_name:t.name,client_info:t})),f(t.name),I(!1),m&&(console.log("✅ Cliente seleccionado automáticamente:",t.name),d(t.name),setTimeout(()=>d(null),3e3))},fe=()=>{E(t=>({...t,client_id:"",client_name:"",client_info:{}})),f(""),D([]),I(!1),d(null)},ce=t=>{const m={};switch(t){case 1:i.clientType||(m.clientType="Selecciona el tipo de cliente"),i.client_id||(m.client_id="Debes seleccionar un cliente de la lista de resultados"),i.name||(m.name="Nombre del proyecto es requerido"),i.location||(m.location="Ubicación es requerida");break;case 2:i.contact_name||(m.contact_name="Persona de contacto es requerida"),i.contact_phone||(m.contact_phone="Teléfono es requerido");break;case 3:!i.requiere_laboratorio&&!i.requiere_ingenieria&&!i.requiere_capacitacion&&(m.services="Debes seleccionar al menos un tipo de servicio");break}return G(m),Object.keys(m).length===0},ee=()=>{ce(j)&&L(t=>Math.min(t+1,x))},se=()=>{L(t=>Math.max(t-1,1))},r=()=>{ce(j)&&b(i)},p=t=>{switch(t){case 1:return e.jsx(je,{});case 2:return e.jsx(Be,{});case 3:return e.jsx(ke,{});case 4:return e.jsx(ne,{});default:return e.jsx(je,{})}},g=t=>{switch(t){case 1:return"Información Básica";case 2:return"Contacto";case 3:return"Requisitos del Proyecto";case 4:return"Resumen";default:return"Paso"}},N=()=>e.jsxs("div",{className:"step-content",children:[e.jsxs("div",{className:"text-center mb-5",children:[e.jsx("div",{className:"d-inline-flex align-items-center justify-content-center rounded-circle bg-primary bg-opacity-10 mb-3",style:{width:"64px",height:"64px"},children:e.jsx(je,{size:28,className:"text-primary"})}),e.jsx("h3",{className:"fw-bold text-dark mb-2",children:"Información Básica"}),e.jsx("p",{className:"text-muted",children:"Completa los datos del cliente y del proyecto"})]}),e.jsxs(X,{className:"g-3",children:[e.jsx(q,{md:12,children:e.jsxs(c.Group,{children:[e.jsx(c.Label,{className:"fw-bold",children:"Tipo de Cliente *"}),e.jsxs("div",{className:"d-flex gap-3",children:[e.jsx(c.Check,{type:"radio",id:"empresa",name:"clientType",label:"Empresa",checked:i.clientType==="empresa",onChange:()=>n("clientType","empresa"),className:"d-flex align-items-center"}),e.jsx(c.Check,{type:"radio",id:"persona_natural",name:"clientType",label:"Persona Natural",checked:i.clientType==="persona_natural",onChange:()=>n("clientType","persona_natural"),className:"d-flex align-items-center"})]}),u.clientType&&e.jsx(c.Control.Feedback,{type:"invalid",children:u.clientType})]})}),i.clientType&&e.jsx(q,{md:12,children:e.jsxs(c.Group,{children:[e.jsxs(c.Label,{className:"fw-bold",children:["Buscar ",i.clientType==="empresa"?"Empresa":"Persona Natural"," *"]}),e.jsxs("div",{className:"position-relative",children:[e.jsx(c.Control,{type:"text",value:F,onChange:t=>{const m=t.target.value;f(m),S(m)},placeholder:`Buscar ${i.clientType==="empresa"?"empresa":"persona natural"}...`,isInvalid:!!u.client_id,isValid:!!i.client_id&&!u.client_id}),B&&e.jsx("div",{className:"position-absolute top-50 end-0 translate-middle-y me-3",children:e.jsx("div",{className:"spinner-border spinner-border-sm",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Buscando..."})})}),le&&F&&e.jsx("div",{className:"position-absolute w-100 bg-white border rounded shadow-lg",style:{zIndex:1e3,maxHeight:"300px",overflowY:"auto"},children:A.length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"p-2 bg-light border-bottom",children:e.jsx("small",{className:"text-muted",children:e.jsx("strong",{children:"Haz clic en un cliente para seleccionarlo:"})})}),A.map((t,m)=>e.jsxs("div",{className:"p-3 border-bottom cursor-pointer hover-bg-light",onClick:()=>Y(t),style:{cursor:"pointer"},children:[e.jsx("div",{className:"fw-bold",children:t.name}),e.jsxs("div",{className:"text-muted small",children:[i.clientType==="empresa"?t.ruc:t.dni," • ",t.address]})]},m))]}):e.jsxs("div",{className:"p-3 text-center",children:[e.jsx("div",{className:"text-muted mb-2",children:"No se encontraron resultados"}),e.jsx("small",{className:"text-warning",children:"Verifica el nombre o crea un nuevo cliente"})]})})]}),u.client_id&&e.jsx(c.Control.Feedback,{type:"invalid",children:u.client_id}),$&&e.jsx("div",{className:"mt-2",children:e.jsxs(qe,{variant:"success",className:"py-2 mb-0",children:[e.jsx(ne,{className:"me-2"}),e.jsx("strong",{children:"Cliente detectado automáticamente:"})," ",$]})})]})}),i.client_id&&e.jsx(q,{md:12,children:e.jsxs(h,{className:"border-success",children:[e.jsxs(h.Header,{className:"bg-success text-white d-flex justify-content-between align-items-center",children:[e.jsxs("h6",{className:"mb-0",children:[e.jsx(ne,{className:"me-2"}),"Cliente Seleccionado"]}),e.jsxs(w,{variant:"outline-light",size:"sm",onClick:fe,className:"d-flex align-items-center",children:[e.jsx(Z,{className:"me-1"}),"Cambiar"]})]}),e.jsx(h.Body,{children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsx("strong",{children:"Nombre:"})," ",i.client_name]}),e.jsxs("div",{className:"col-md-6",children:[e.jsxs("strong",{children:[i.clientType==="empresa"?"RUC":"DNI",":"]})," ",i.client_info.ruc||i.client_info.dni]}),e.jsxs("div",{className:"col-md-12 mt-2",children:[e.jsx("strong",{children:"Dirección:"})," ",i.client_info.address]}),i.client_info.phone&&e.jsxs("div",{className:"col-md-6 mt-2",children:[e.jsx("strong",{children:"Teléfono:"})," ",i.client_info.phone]}),i.client_info.email&&e.jsxs("div",{className:"col-md-6 mt-2",children:[e.jsx("strong",{children:"Email:"})," ",i.client_info.email]})]})})]})}),e.jsx(q,{md:12,children:e.jsxs(c.Group,{children:[e.jsx(c.Label,{className:"fw-bold",children:"Nombre del Proyecto *"}),e.jsx(c.Control,{type:"text",value:i.name,onChange:t=>n("name",t.target.value),placeholder:"Ingresa el nombre del proyecto",isInvalid:!!u.name}),u.name&&e.jsx(c.Control.Feedback,{type:"invalid",children:u.name})]})}),e.jsx(q,{md:12,children:e.jsxs(c.Group,{children:[e.jsx(c.Label,{className:"fw-bold",children:"Ubicación *"}),e.jsx(c.Control,{type:"text",value:i.location,onChange:t=>n("location",t.target.value),placeholder:"Ingresa la ubicación del proyecto",isInvalid:!!u.location}),u.location&&e.jsx(c.Control.Feedback,{type:"invalid",children:u.location})]})})]})]}),y=()=>e.jsxs("div",{className:"step-content",children:[e.jsxs("div",{className:"text-center mb-5",children:[e.jsx("div",{className:"d-inline-flex align-items-center justify-content-center rounded-circle bg-success bg-opacity-10 mb-3",style:{width:"64px",height:"64px"},children:e.jsx(Be,{size:28,className:"text-success"})}),e.jsx("h3",{className:"fw-bold text-dark mb-2",children:"Información de Contacto"}),e.jsx("p",{className:"text-muted",children:"Datos de la persona responsable del proyecto"})]}),e.jsxs(X,{className:"g-3",children:[e.jsx(q,{md:6,children:e.jsxs(c.Group,{children:[e.jsx(c.Label,{className:"fw-bold",children:"Persona de Contacto *"}),e.jsx(c.Control,{type:"text",value:i.contact_name,onChange:t=>n("contact_name",t.target.value),placeholder:"Nombre completo",isInvalid:!!u.contact_name}),u.contact_name&&e.jsx(c.Control.Feedback,{type:"invalid",children:u.contact_name})]})}),e.jsx(q,{md:6,children:e.jsxs(c.Group,{children:[e.jsx(c.Label,{className:"fw-bold",children:"Teléfono *"}),e.jsx(c.Control,{type:"tel",value:i.contact_phone,onChange:t=>n("contact_phone",t.target.value),placeholder:"Número de teléfono",isInvalid:!!u.contact_phone}),u.contact_phone&&e.jsx(c.Control.Feedback,{type:"invalid",children:u.contact_phone})]})}),e.jsx(q,{md:12,children:e.jsxs(c.Group,{children:[e.jsx(c.Label,{className:"fw-bold",children:"Email"}),e.jsx(c.Control,{type:"email",value:i.contact_email,onChange:t=>n("contact_email",t.target.value),placeholder:"Email para comunicación"})]})})]})]}),de=()=>e.jsxs("div",{className:"step-content",children:[e.jsxs("div",{className:"text-center mb-5",children:[e.jsx("div",{className:"d-inline-flex align-items-center justify-content-center rounded-circle bg-warning bg-opacity-10 mb-3",style:{width:"64px",height:"64px"},children:e.jsx(ke,{size:28,className:"text-warning"})}),e.jsx("h3",{className:"fw-bold text-dark mb-2",children:"Requisitos del Proyecto"}),e.jsx("p",{className:"text-muted",children:"Selecciona los tipos de servicios que requiere este proyecto"})]}),e.jsx(qe,{variant:"info",className:"mb-4",children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx(Qe,{className:"me-2"}),e.jsxs("div",{children:[e.jsx("strong",{children:"Selecciona los tipos de servicios que requiere este proyecto"}),e.jsx("br",{}),e.jsx("small",{children:"Esto ayudará a determinar qué áreas del laboratorio trabajarán en el proyecto"})]})]})}),e.jsxs(X,{className:"g-4",children:[e.jsx(q,{md:6,children:e.jsx(h,{className:`h-100 border-0 shadow-sm service-card ${i.requiere_laboratorio?"selected":""}`,style:{borderRadius:"16px",transition:"all 0.3s ease",cursor:"pointer",border:i.requiere_laboratorio?"2px solid #667eea":"2px solid transparent"},onClick:()=>n("requiere_laboratorio",!i.requiere_laboratorio),children:e.jsxs(h.Body,{className:"text-center p-4",children:[e.jsx("div",{className:"service-icon mb-3",children:e.jsx(Qe,{size:48,className:i.requiere_laboratorio?"text-white":"text-primary"})}),e.jsx("h5",{className:"fw-bold mb-2",children:"Laboratorio"}),e.jsx("p",{className:"text-muted small mb-4",children:"Ensayos de laboratorio, análisis de muestras, pruebas técnicas"}),e.jsx(c.Check,{type:"checkbox",id:"requiere_laboratorio",label:"Requiere servicios de laboratorio",checked:i.requiere_laboratorio||!1,onChange:t=>n("requiere_laboratorio",t.target.checked),className:"d-flex justify-content-center",style:{pointerEvents:"none"}})]})})}),e.jsx(q,{md:6,children:e.jsx(h,{className:`h-100 border-0 shadow-sm service-card ${i.requiere_ingenieria?"selected":""}`,style:{borderRadius:"16px",transition:"all 0.3s ease",cursor:"pointer",border:i.requiere_ingenieria?"2px solid #56ab2f":"2px solid transparent"},onClick:()=>n("requiere_ingenieria",!i.requiere_ingenieria),children:e.jsxs(h.Body,{className:"text-center p-4",children:[e.jsx("div",{className:"service-icon mb-3",children:e.jsx(oe,{size:48,className:i.requiere_ingenieria?"text-white":"text-success"})}),e.jsx("h5",{className:"fw-bold mb-2",children:"Ingeniería"}),e.jsx("p",{className:"text-muted small mb-4",children:"Diseño, consultoría técnica, supervisión de obras"}),e.jsx(c.Check,{type:"checkbox",id:"requiere_ingenieria",label:"Requiere servicios de ingeniería",checked:i.requiere_ingenieria||!1,onChange:t=>n("requiere_ingenieria",t.target.checked),className:"d-flex justify-content-center",style:{pointerEvents:"none"}})]})})}),e.jsx(q,{md:6,children:e.jsx(h,{className:`h-100 border-0 shadow-sm service-card ${i.requiere_capacitacion?"selected":""}`,style:{borderRadius:"16px",transition:"all 0.3s ease",cursor:"pointer",border:i.requiere_capacitacion?"2px solid #3498db":"2px solid transparent"},onClick:()=>n("requiere_capacitacion",!i.requiere_capacitacion),children:e.jsxs(h.Body,{className:"text-center p-4",children:[e.jsx("div",{className:"service-icon mb-3",children:e.jsx(ys,{size:48,className:i.requiere_capacitacion?"text-white":"text-info"})}),e.jsx("h5",{className:"fw-bold mb-2",children:"Capacitación"}),e.jsx("p",{className:"text-muted small mb-4",children:"Entrenamiento, cursos, formación técnica"}),e.jsx(c.Check,{type:"checkbox",id:"requiere_capacitacion",label:"Requiere servicios de capacitación",checked:i.requiere_capacitacion||!1,onChange:t=>n("requiere_capacitacion",t.target.checked),className:"d-flex justify-content-center",style:{pointerEvents:"none"}})]})})})]}),!i.requiere_laboratorio&&!i.requiere_ingenieria&&!i.requiere_capacitacion&&e.jsxs(qe,{variant:"warning",className:"mt-3",children:[e.jsx(Xe,{className:"me-2"}),"Debes seleccionar al menos un tipo de servicio para el proyecto"]})]}),ye=()=>e.jsxs("div",{className:"step-content",children:[e.jsxs("div",{className:"text-center mb-5",children:[e.jsx("div",{className:"d-inline-flex align-items-center justify-content-center rounded-circle bg-info bg-opacity-10 mb-3",style:{width:"64px",height:"64px"},children:e.jsx(ne,{size:28,className:"text-info"})}),e.jsx("h3",{className:"fw-bold text-dark mb-2",children:"Resumen del Proyecto"}),e.jsx("p",{className:"text-muted",children:"Revisa la información antes de crear el proyecto"})]}),e.jsxs(X,{className:"g-4",children:[e.jsx(q,{md:6,children:e.jsxs(h,{children:[e.jsx(h.Header,{children:e.jsx("h6",{className:"mb-0",children:"Información Básica"})}),e.jsxs(h.Body,{children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Proyecto:"})," ",i.name]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Ubicación:"})," ",i.location]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Contacto:"})," ",i.contact_name]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Teléfono:"})," ",i.contact_phone]}),i.contact_email&&e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Email:"})," ",i.contact_email]})]})]})}),e.jsx(q,{md:6,children:e.jsxs(h,{children:[e.jsx(h.Header,{children:e.jsx("h6",{className:"mb-0",children:"Requisitos del Proyecto"})}),e.jsxs(h.Body,{children:[e.jsx("div",{className:"mb-3",children:e.jsx("strong",{children:"Tipos de servicios requeridos:"})}),e.jsxs("div",{className:"d-flex flex-column gap-2",children:[i.requiere_laboratorio&&e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx(Qe,{className:"text-primary me-2"}),e.jsx("span",{children:"Laboratorio"})]}),i.requiere_ingenieria&&e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx(oe,{className:"text-success me-2"}),e.jsx("span",{children:"Ingeniería"})]}),i.requiere_capacitacion&&e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx(ys,{className:"text-info me-2"}),e.jsx("span",{children:"Capacitación"})]}),!i.requiere_laboratorio&&!i.requiere_ingenieria&&!i.requiere_capacitacion&&e.jsxs("div",{className:"text-muted",children:[e.jsx(Z,{className:"me-1"}),"No hay requisitos seleccionados"]})]})]})]})})]})]});return e.jsxs("div",{className:"project-form-redesigned",style:{fontFamily:"Inter, -apple-system, BlinkMacSystemFont, sans-serif"},children:[e.jsxs("div",{className:"mb-5",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsx("h4",{className:"mb-0 fw-bold text-dark",children:"Crear Nuevo Proyecto"}),e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsxs("span",{className:"text-muted me-2",children:["Paso ",j," de ",x]}),e.jsx("div",{className:"progress",style:{width:"120px",height:"6px"},children:e.jsx("div",{className:"progress-bar bg-gradient-primary",style:{width:`${j/x*100}%`,background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",borderRadius:"3px"}})})]})]}),e.jsx("div",{className:"step-navigation",children:Array.from({length:x},(t,m)=>{const _=m+1,U=_===j,me=_<j;return e.jsxs("div",{className:`step-item ${U?"active":me?"completed":""}`,onClick:()=>L(_),children:[e.jsx("div",{className:"step-icon",children:me?e.jsx(ne,{}):p(_)}),e.jsxs("div",{className:"step-content",children:[e.jsx("div",{className:"step-title",children:g(_)}),e.jsxs("div",{className:"step-subtitle",children:[_===1&&"Información del cliente y proyecto",_===2&&"Datos de contacto",_===3&&"Tipos de servicios requeridos",_===4&&"Revisar y confirmar"]})]}),_<x&&e.jsx("div",{className:"step-connector"})]},_)})})]}),e.jsx(h,{className:"border-0 shadow-lg mb-4",style:{borderRadius:"16px",overflow:"hidden"},children:e.jsx(h.Body,{className:"p-5",children:e.jsxs("div",{className:"step-content-wrapper",children:[j===1&&N(),j===2&&y(),j===3&&de(),j===4&&ye()]})})}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs(w,{variant:"outline-secondary",onClick:se,disabled:j===1,className:"px-4 py-2 rounded-pill",style:{border:"2px solid #e9ecef",fontWeight:"500",minWidth:"120px"},children:[e.jsx(Z,{className:"me-2"}),"Anterior"]}),e.jsxs("div",{className:"d-flex gap-3",children:[j<x?e.jsxs(w,{variant:"primary",onClick:ee,className:"px-5 py-2 rounded-pill fw-bold",style:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",border:"none",minWidth:"140px",boxShadow:"0 4px 15px rgba(102, 126, 234, 0.4)"},children:["Siguiente",e.jsx(Ss,{className:"ms-2"})]}):e.jsx(w,{variant:"success",onClick:r,disabled:z,className:"px-5 py-2 rounded-pill fw-bold",style:{background:"linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%)",border:"none",minWidth:"160px",boxShadow:"0 4px 15px rgba(86, 171, 47, 0.4)"},children:z?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"spinner-border spinner-border-sm me-2",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Cargando..."})}),"Creando..."]}):e.jsxs(e.Fragment,{children:["Crear Proyecto",e.jsx(ne,{className:"ms-2"})]})}),e.jsx(w,{variant:"outline-danger",onClick:k,className:"px-4 py-2 rounded-pill",style:{border:"2px solid #dc3545",color:"#dc3545",fontWeight:"500",minWidth:"120px"},children:"Cancelar"})]})]}),e.jsx("style",{jsx:!0,children:`
        .step-navigation {
          display: flex;
          align-items: center;
          justify-content: space-between;
          position: relative;
          margin: 2rem 0;
        }
        
        .step-item {
          display: flex;
          align-items: center;
          cursor: pointer;
          transition: all 0.3s ease;
          position: relative;
          z-index: 2;
        }
        
        .step-item:hover {
          transform: translateY(-2px);
        }
        
        .step-icon {
          width: 48px;
          height: 48px;
          border-radius: 50%;
          display: flex;
          align-items: center;
          justify-content: center;
          font-size: 20px;
          font-weight: bold;
          transition: all 0.3s ease;
          margin-right: 12px;
          background: #f8f9fa;
          color: #6c757d;
          border: 3px solid #e9ecef;
        }
        
        .step-item.active .step-icon {
          background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
          color: white;
          border-color: #667eea;
          box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }
        
        .step-item.completed .step-icon {
          background: linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%);
          color: white;
          border-color: #56ab2f;
        }
        
        .step-content {
          flex: 1;
        }
        
        .step-title {
          font-weight: 600;
          font-size: 14px;
          color: #495057;
          margin-bottom: 2px;
        }
        
        .step-item.active .step-title {
          color: #667eea;
          font-weight: 700;
        }
        
        .step-item.completed .step-title {
          color: #56ab2f;
        }
        
        .step-subtitle {
          font-size: 12px;
          color: #6c757d;
          line-height: 1.3;
        }
        
        .step-connector {
          position: absolute;
          top: 24px;
          left: 100%;
          width: 100%;
          height: 2px;
          background: #e9ecef;
          z-index: 1;
        }
        
        .step-item.completed + .step-item .step-connector {
          background: linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%);
        }
        
        .step-content-wrapper {
          min-height: 400px;
        }
        
        .bg-gradient-primary {
          background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .service-card {
          transition: all 0.3s ease;
        }
        
        .service-card:hover {
          transform: translateY(-4px);
          box-shadow: 0 8px 25px rgba(0,0,0,0.15) !important;
        }
        
        .service-card.selected {
          transform: translateY(-2px);
          box-shadow: 0 8px 25px rgba(0,0,0,0.2) !important;
        }
        
        .service-card.selected .service-icon {
          background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
          border-radius: 50%;
          width: 80px;
          height: 80px;
          display: flex;
          align-items: center;
          justify-content: center;
          margin: 0 auto 1rem auto;
        }
        
        .service-card:not(.selected) .service-icon {
          background: rgba(0,0,0,0.05);
          border-radius: 50%;
          width: 80px;
          height: 80px;
          display: flex;
          align-items: center;
          justify-content: center;
          margin: 0 auto 1rem auto;
        }
        
        @media (max-width: 768px) {
          .step-navigation {
            flex-direction: column;
            align-items: flex-start;
          }
          
          .step-item {
            width: 100%;
            margin-bottom: 1rem;
          }
          
          .step-connector {
            display: none;
          }
        }
      `})]})}const Da={company_id:"",name:"",location:"",vendedor_id:"",laboratorio_id:"",requiere_laboratorio:!1,requiere_ingenieria:!1,requiere_consultoria:!1,requiere_capacitacion:!1,requiere_auditoria:!1,contact_name:"",contact_phone:"",contact_email:"",queries:"",priority:"normal",marked:!1};function hi(){var gs,bs,js,fs;const{user:v}=ra(),b=ha();ua(),xa();const z=pa(),[k,i]=l.useState(!1),[E,j]=l.useState(null),[L,u]=l.useState(null),[G,F]=l.useState(null),[f,A]=l.useState(null),[D,B]=l.useState(!1),[H,le]=l.useState(!1),[I,$]=l.useState(!1),[d,x]=l.useState(!1),[n,S]=l.useState(null),[Y,fe]=l.useState("info"),[ce,ee]=l.useState(!1),[se,r]=l.useState({}),[p,g]=l.useState([]),[N,y]=l.useState(null),[de,ye]=l.useState(!1),[t,m]=l.useState({}),[_,U]=l.useState(!1),[me,K]=l.useState(""),[ae,ve]=l.useState("success"),[he,Ee]=l.useState(""),[Fe,ze]=l.useState(""),[Cs,Ae]=l.useState(!1),[qs,Pe]=l.useState(!1),[ue,es]=l.useState(""),[W,ss]=l.useState([]),[ks,Ue]=l.useState(!1),[Ra,$a]=l.useState(!0),[Es,Te]=l.useState(!1),[Ve,He]=l.useState(1),[as,Fs]=l.useState(""),[is,zs]=l.useState(""),[rs,As]=l.useState(""),[ts,Ps]=l.useState(""),[ns,Ts]=l.useState(""),[Ls,os]=l.useState(!1),Oe=ta(),ls=na(),Ge=new URLSearchParams(ls.search).get("view"),ie=(gs=ls.state)==null?void 0:gs.selectedClient,Le=oa(),{data:C,isLoading:cs,refetch:Is}=Ce(["projects",Ve,as,is,rs,ts,ns],()=>Ca({page:Ve,limit:20,search:as,status:is,company_id:rs,project_type:ts,priority:ns}),{keepPreviousData:!0,refetchOnWindowFocus:!1,refetchOnMount:!1,staleTime:3e4,cacheTime:3e5,retry:2,retryDelay:1e3}),{data:R,isLoading:Ua}=Ce("users",()=>za(),{keepPreviousData:!0,refetchOnWindowFocus:!1,staleTime:3e5,cacheTime:6e5}),{data:Q,isLoading:Ie}=Ce(["projectStats"],qa,{refetchOnWindowFocus:!1,refetchOnMount:!1,staleTime:6e4,cacheTime:3e5,retry:1,onSuccess:s=>{console.log("📊 Frontend - Estadísticas recibidas:",s),console.log("📊 Frontend - alta_prioridad:",s==null?void 0:s.alta_prioridad)}});l.useEffect(()=>{if(Ge&&(C!=null&&C.data)){const s=C.data.find(a=>a.id==Ge);s&&(ps(s),Oe("/proyectos",{replace:!0}))}},[Ge,C==null?void 0:C.data]),l.useEffect(()=>{(async()=>{if(n!=null&&n.id)try{const a=await Ye(n.id);g(a)}catch(a){console.error("Error al cargar adjuntos:",a)}})()},[n==null?void 0:n.id,I]),l.useEffect(()=>{const s=a=>{a.target.closest(".position-relative")||(Ae(!1),Pe(!1))};return document.addEventListener("mousedown",s),()=>{document.removeEventListener("mousedown",s)}},[]);const Ne=s=>{Le.invalidateQueries("projects"),Le.invalidateQueries("projectStats"),i(!1),j(null),u(null)},T=(s,a="success")=>{K(s),ve(a),U(!0),setTimeout(()=>{U(!1)},5e3)},Ms=s=>{console.log("🔍 handleSearch - Búsqueda:",s),Fs(s),He(1),os(!0),setTimeout(()=>os(!1),1e3)},Ds=s=>{console.log("🔍 handleFilter - Filtros:",s),zs(s.status||""),As(s.company_id||""),Ps(s.project_type||""),Ts(s.priority||""),He(1)},Rs=s=>{const a=s.target.files[0];a&&y(a)},$s=async()=>{if(!N||!(n!=null&&n.id)){T("❌ Por favor selecciona un archivo","danger");return}ye(!0);try{const s=new FormData;s.append("file",N),s.append("description",`Archivo subido: ${N.name}`),await ka(n.id,s);const a=await Ye(n.id);g(a),y(null),ye(!1),T("✅ Archivo subido correctamente","success")}catch(s){console.error("Error al subir archivo:",s),ye(!1),T("❌ Error al subir archivo","danger")}},ds=async s=>{try{await Ea(s),T("✅ Archivo descargado correctamente","success")}catch(a){console.error("Error al descargar archivo:",a),T("❌ Error al descargar archivo","danger")}},Bs=async s=>{F(s)},Us=async()=>{try{await Fa(G);const s=await Ye(n.id);g(s),T("✅ Archivo eliminado correctamente","success"),F(null)}catch(s){console.error("Error al eliminar archivo:",s),T("❌ Error al eliminar archivo","danger"),F(null)}},Vs=s=>{m({...t,vendedor_id:s.id}),Ee(`${s.name} ${s.apellido}`),Ae(!1),s.id&&n&&ms(s.id,"vendedor",n)},Hs=s=>{m({...t,laboratorio_id:s.id}),ze(`${s.name} ${s.apellido}`),Pe(!1),s.id&&n&&ms(s.id,"laboratorio",n)},ms=async(s,a,o)=>{try{const J="https://sublustrous-odelia-uninsured.ngrok-free.dev/api".replace(/\/api$/,""),xe=localStorage.getItem("token"),re=new Date,te=re.toLocaleString("es-PE",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}),V=a==="vendedor"?"vendedor comercial responsable":"usuario de laboratorio responsable",O={user_id:s,type:"project_assignment",title:`🎯 Proyecto Asignado - ${o.name}`,message:`Se te ha asignado el proyecto "${o.name}" como ${V}.

📅 Fecha y hora: ${te}
🏢 Empresa: ${o.company_name||"No especificada"}
📍 Ubicación: ${o.location||"No especificada"}
📞 Contacto: ${o.contact_name||"No especificado"}`,project_id:o.id,priority:"high",metadata:{assignment_date:re.toISOString(),role:a,project_name:o.name,company_name:o.company_name}};console.log("📤 Enviando notificación:",O);const pe=await fetch(`${J}/api/notifications`,{method:"POST",headers:{Authorization:`Bearer ${xe}`,"Content-Type":"application/json"},body:JSON.stringify(O)});if(pe.ok){const We=await pe.json();console.log("✅ Notificación enviada exitosamente:",We),T(`✅ Notificación enviada al ${V} - ${te}`,"success")}else{const We=await pe.text();console.warn("⚠️ No se pudo enviar la notificación:",pe.status,We),T(`⚠️ Error enviando notificación al ${V}`,"warning")}}catch(P){console.error("❌ Error enviando notificación:",P),T(`❌ Error enviando notificación al ${a==="vendedor"?"vendedor comercial":"usuario de laboratorio"}`,"danger")}},hs=()=>R!=null&&R.data?R.data.filter(s=>{var a;return s.role==="vendedor_comercial"&&(he===""||`${s.name} ${s.apellido}`.toLowerCase().includes(he.toLowerCase())||((a=s.email)==null?void 0:a.toLowerCase().includes(he.toLowerCase())))}):[],us=()=>R!=null&&R.data?R.data.filter(s=>{var a;return s.role==="usuario_laboratorio"&&(Fe===""||`${s.name} ${s.apellido}`.toLowerCase().includes(Fe.toLowerCase())||((a=s.email)==null?void 0:a.toLowerCase().includes(Fe.toLowerCase())))}):[],Os=[{title:"Por Estado",options:[{label:"Pendientes",filter:{status:"pendiente"}},{label:"Activos",filter:{status:"activo"}}]},{title:"Por Prioridad",options:[{label:"🟠 Alta",filter:{priority:"high"}},{label:"🟢 Normal",filter:{priority:"normal"}}]}],Me=ge(ya,{onSuccess:()=>Ne(),onError:s=>console.error("Error creating project:",s)}),De=ge(({id:s,data:a})=>va(s,a),{onSuccess:s=>{console.log("✅ updateMutation - Success:",s),S(s);const a={...s,queries_history:(()=>{try{if(s.queries_history&&Array.isArray(s.queries_history))return s.queries_history;if(s.queries_history&&typeof s.queries_history=="string"){const o=JSON.parse(s.queries_history);return Array.isArray(o)?o:[]}return[]}catch(o){return console.warn("❌ Error procesando queries_history en updateMutation:",o),[]}})()};m(a),T("✅ Proyecto actualizado exitosamente!","success"),Le.invalidateQueries(["projects"])},onError:s=>{console.error("❌ updateMutation - Error:",s),T("❌ Error al actualizar proyecto","danger")}}),xs=ge(Na,{onSuccess:()=>Ne(),onError:s=>{console.error("Error deleting project:",s)}});ge(({id:s,...a})=>_a(s,a),{onSuccess:s=>{S(s);const a={...s,queries_history:(()=>{try{if(s.queries_history&&Array.isArray(s.queries_history))return s.queries_history;if(s.queries_history&&typeof s.queries_history=="string"){const o=JSON.parse(s.queries_history);return Array.isArray(o)?o:[]}return[]}catch(o){return console.warn("❌ Error procesando queries_history en updateStatusMutation:",o),[]}})()};m(a),Ne()},onError:s=>console.error("Error updating project status:",s)}),ge(({id:s,...a})=>wa(s,a),{onSuccess:s=>{S(s);const a={...s,queries_history:(()=>{try{if(s.queries_history&&Array.isArray(s.queries_history))return s.queries_history;if(s.queries_history&&typeof s.queries_history=="string"){const o=JSON.parse(s.queries_history);return Array.isArray(o)?o:[]}return[]}catch(o){return console.warn("❌ Error procesando queries_history en updateQueriesMutation:",o),[]}})()};m(a),Ne()},onError:s=>console.error("Error updating project queries:",s)}),ge(({id:s,...a})=>Sa(s,a),{onSuccess:s=>{S(s);const a={...s,queries_history:(()=>{try{if(s.queries_history&&Array.isArray(s.queries_history))return s.queries_history;if(s.queries_history&&typeof s.queries_history=="string"){const o=JSON.parse(s.queries_history);return Array.isArray(o)?o:[]}return[]}catch(o){return console.warn("❌ Error procesando queries_history en updateMarkMutation:",o),[]}})()};m(a),Ne()},onError:s=>console.error("Error updating project mark:",s)});const Gs=s=>{if(console.log("🔍 handleDelete - Verificando permisos:",{userCanDeleteProject:z,currentUserRole:b==null?void 0:b.role,currentUser:b}),!z){console.log("🚫 handleDelete - Permisos insuficientes, mostrando modal"),r({action:"eliminar proyectos",requiredRole:"jefa comercial o soporte",currentRole:(b==null?void 0:b.role)||"no autenticado"}),ee(!0);return}console.log("✅ handleDelete - Permisos OK, procediendo con eliminación"),u(s)},Ws=async()=>{var s;try{await xs.mutateAsync(L.id),u(null)}catch(a){console.error("Error eliminando proyecto:",a),a.status===403||(s=a.message)!=null&&s.includes("No autorizado")?(u(null),r({action:"eliminar proyectos",requiredRole:"jefa comercial o soporte",currentRole:(b==null?void 0:b.role)||"no autenticado"}),ee(!0)):u(null)}},Qs=async()=>{try{console.log("Marcar/desmarcar proyecto:",f),T(`Proyecto ${f.marked?"desmarcado":"marcado"}: ${f.name}`,"success"),A(null)}catch(s){console.error("Error al marcar proyecto:",s),T("Error al marcar proyecto","danger"),A(null)}},Js=s=>{S(s),x(!0)},ps=s=>{console.log("🔍 handleViewProject - Project recibido:",s),console.log("🔍 handleViewProject - Project.id:",s==null?void 0:s.id),console.log("🔍 handleViewProject - Type of project.id:",typeof(s==null?void 0:s.id)),console.log("🔍 handleViewProject - Project.queries:",s==null?void 0:s.queries),console.log("🔍 handleViewProject - Project.queries_history:",s==null?void 0:s.queries_history),S(s);const a={...s,requiere_laboratorio:s.requiere_laboratorio||!1,requiere_ingenieria:s.requiere_ingenieria||!1,requiere_consultoria:s.requiere_consultoria||!1,requiere_capacitacion:s.requiere_capacitacion||!1,requiere_auditoria:s.requiere_auditoria||!1,marked:s.marked||!1,priority:s.priority||"normal",queries:s.queries||"",contact_name:s.contact_name||"",contact_phone:s.contact_phone||"",contact_email:s.contact_email||"",category_id:s.category_id||"",subcategory_id:s.subcategory_id||"",category_name:s.category_name||"",subcategory_name:s.subcategory_name||"",vendedor_id:s.vendedor_id||"",laboratorio_id:s.laboratorio_id||"",queries_history:(()=>{try{if(console.log("🔍 Parseando queries_history - project.queries_history:",s.queries_history),console.log("🔍 Parseando queries_history - project.queries:",s.queries),s.queries_history&&Array.isArray(s.queries_history))return console.log("✅ Usando project.queries_history como array:",s.queries_history),s.queries_history;if(s.queries&&typeof s.queries=="string")try{const o=JSON.parse(s.queries);if(console.log("✅ Parseado project.queries como JSON:",o),Array.isArray(o))return o}catch{if(console.log("⚠️ project.queries no es JSON válido, tratando como texto plano"),s.queries.trim()){const P={message:s.queries.trim(),user_name:"Usuario Anterior",created_at:new Date().toISOString()};return console.log("✅ Creado historial desde texto plano:",P),[P]}}return console.log("⚠️ No se encontró queries_history válido, retornando array vacío"),[]}catch(o){return console.warn("❌ Error parseando queries_history:",o),[]}})()};console.log("🔍 handleViewProject - editingData inicializado:",a),m(a),s.vendedor_name?Ee(s.vendedor_name):Ee(""),s.laboratorio_name?ze(s.laboratorio_name):ze(""),fe("info"),$(!0)},Ys=async s=>{E.id?await De.mutateAsync({id:E.id,...s}):await Me.mutateAsync(s)},Ks=s=>{const o={activo:{bg:"success",text:"Activo"},pendiente:{bg:"warning",text:"Pendiente"},completado:{bg:"primary",text:"Completado"},cancelado:{bg:"danger",text:"Cancelado"}}[s]||{bg:"secondary",text:s};return e.jsx(M,{bg:o.bg,className:"status-badge",children:o.text})},Xs=[{header:"ID",accessor:"id",width:"60px"},{header:"Proyecto",accessor:"name",render:(s,a)=>e.jsxs("div",{children:[e.jsx("div",{className:"fw-medium",children:a.name}),a.location&&e.jsxs("small",{className:"text-muted",children:[e.jsx(ma,{size:12,className:"me-1"}),a.location]}),a.project_type&&e.jsx("div",{className:"mt-1",children:e.jsx(M,{bg:"outline-secondary",size:"sm",className:"px-1 py-0 small",children:a.project_type})})]})},{header:"Empresa",accessor:"company_name",render:(s,a)=>e.jsxs("div",{children:[e.jsx("div",{className:"fw-medium",children:a.company_name||"Sin empresa"}),a.contact_name&&e.jsxs("small",{className:"text-muted",children:[e.jsx(je,{size:12,className:"me-1"}),a.contact_name]})]})},{header:"Estado",accessor:"status",width:"100px",render:s=>Ks(s||"activo")},{header:"Servicios",accessor:"services",width:"180px",className:"d-none d-lg-table-cell",render:(s,a)=>{if(a.requiere_laboratorio){const P={no_requerido:"N/A",pendiente:"Pendiente",en_proceso:"En Proceso",completado:"Completado"}[a.laboratorio_status]||"N/A";return e.jsxs("div",{className:"d-flex flex-column gap-1",children:[e.jsx(M,{bg:"info",size:"sm",className:"px-2",children:"🔬 Laboratorio"}),e.jsx("span",{className:"small text-muted",children:P})]})}if(a.requiere_ingenieria){const P={no_requerido:"N/A",pendiente:"Pendiente",en_proceso:"En Proceso",completado:"Completado"}[a.ingenieria_status]||"N/A";return e.jsxs("div",{className:"d-flex flex-column gap-1",children:[e.jsx(M,{bg:"primary",size:"sm",className:"px-2",children:"⚙️ Ingeniería"}),e.jsx("span",{className:"small text-muted",children:P})]})}return a.requiere_consultoria?e.jsx(M,{bg:"success",size:"sm",className:"px-2",children:"💼 Consultoría"}):e.jsx(M,{bg:"secondary",size:"sm",className:"px-1",children:"N/A"})}},{header:"Prioridad",accessor:"priority",width:"100px",render:(s,a)=>{const P=(J=>{switch(J){case"urgent":return{emoji:"🔴",text:"Urgente",color:"text-danger"};case"high":return{emoji:"🟠",text:"Alta",color:"text-warning"};case"active":return{emoji:"🔵",text:"Activo",color:"text-info"};case"low":return{emoji:"🔵",text:"Baja",color:"text-primary"};case"normal":default:return{emoji:"🟢",text:"Normal",color:"text-success"}}})(a.priority);return e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("span",{className:"me-1",style:{fontSize:"1em"},children:P.emoji}),e.jsx("span",{className:`small ${P.color} fw-medium`,children:P.text}),(a.priority==="urgent"||a.priority==="high")&&a.requiere_laboratorio&&e.jsx(Xe,{className:"text-warning ms-1",size:12})]})}},{header:"Asignado a",accessor:"vendedor_name",className:"d-none d-md-table-cell",render:(s,a)=>e.jsxs("div",{children:[a.vendedor_name&&e.jsxs("div",{className:"small",children:[e.jsx(je,{size:12,className:"me-1 text-muted"}),e.jsx("span",{children:a.vendedor_name})]}),a.laboratorio_name&&e.jsxs("div",{className:"small text-muted mt-1",children:[e.jsx(oe,{size:12,className:"me-1"}),e.jsx("span",{children:a.laboratorio_name})]}),!a.vendedor_name&&!a.laboratorio_name&&e.jsx("span",{className:"text-muted small",children:"Sin asignar"})]})},{header:"Fecha",accessor:"created_at",width:"100px",className:"d-none d-xl-table-cell",render:s=>{if(!s)return"-";const a=new Date(s);return e.jsx("div",{className:"small",children:e.jsx("div",{children:a.toLocaleDateString("es-ES")})})}}],Zs=[{name:"company_id",label:"Empresa/Cliente",type:"select",required:!0,options:((bs=C==null?void 0:C.companies)==null?void 0:bs.map(s=>({value:s.id,label:`${s.name} (${s.ruc||s.dni||"Sin RUC/DNI"})`})))||[],description:"Selecciona un cliente existente o crea uno nuevo desde el módulo de clientes"},{name:"name",label:"Nombre del Proyecto",type:"text",required:!0,placeholder:"Ingresa el nombre del proyecto"},{name:"location",label:"Ubicación del Proyecto",type:"text",placeholder:"Ingresa la ubicación del proyecto",required:!0},{name:"contact_name",label:"Persona de Contacto",type:"text",placeholder:"Nombre de la persona con quien negociar",description:"Persona responsable del proyecto en el cliente"},{name:"contact_phone",label:"Teléfono de Contacto",type:"text",placeholder:"Teléfono para comunicación directa",description:"Número para llamadas urgentes o seguimiento"},{name:"contact_email",label:"Email de Contacto",type:"email",placeholder:"Email para comunicación",description:"Email para envío de reportes y documentos"},{name:"requiere_laboratorio",label:"Requiere Laboratorio",type:"checkbox",description:"Marcar si el proyecto necesita servicios de laboratorio"},{name:"requiere_ingenieria",label:"Requiere Ingeniería",type:"checkbox",description:"Marcar si el proyecto necesita servicios de ingeniería"},{name:"requiere_consultoria",label:"Requiere Consultoría",type:"checkbox",description:"Marcar si el proyecto necesita servicios de consultoría"},{name:"requiere_capacitacion",label:"Requiere Capacitación",type:"checkbox",description:"Marcar si el proyecto necesita servicios de capacitación"},{name:"requiere_auditoria",label:"Requiere Auditoría",type:"checkbox",description:"Marcar si el proyecto necesita servicios de auditoría"},{name:"queries",label:"Consultas del Cliente",type:"textarea",placeholder:"Ingresa las consultas o dudas del cliente...",description:"Preguntas o dudas específicas del cliente sobre el proyecto"},{name:"services",label:"Servicios del Proyecto",type:"custom",component:e.jsxs("div",{children:[e.jsx("div",{className:"mb-3",children:e.jsxs(w,{variant:"outline-primary",onClick:()=>Ue(!0),className:"w-100",children:[e.jsx(ke,{className:"me-2"}),W.length>0?`Configurar Servicios (${W.length} seleccionados)`:"Seleccionar Servicios"]})}),W.length>0&&e.jsxs("div",{className:"border rounded p-3 bg-light",children:[e.jsx("h6",{className:"mb-2",children:"Servicios Seleccionados:"}),W.map((s,a)=>e.jsx("div",{className:"mb-2 p-2 border rounded bg-white",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-start",children:[e.jsxs("div",{children:[e.jsx("strong",{children:s.ensayo.name}),e.jsx("div",{className:"small text-muted",children:s.subservices.map(o=>o.codigo).join(", ")})]}),e.jsxs("div",{className:"text-end",children:[e.jsxs("div",{className:"fw-bold text-success",children:["S/ ",s.total.toFixed(2)]}),e.jsx(w,{variant:"outline-danger",size:"sm",onClick:()=>{const o=W.filter((P,J)=>J!==a);ss(o)},children:e.jsx(Z,{size:12})})]})]})},a)),e.jsxs("div",{className:"mt-2 pt-2 border-top",children:[e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsx("strong",{children:"Subtotal:"}),e.jsxs("strong",{children:["S/ ",W.reduce((s,a)=>s+a.total,0).toFixed(2)]})]}),e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsx("span",{children:"IGV (18%):"}),e.jsxs("span",{children:["S/ ",(W.reduce((s,a)=>s+a.total,0)*.18).toFixed(2)]})]}),e.jsxs("div",{className:"d-flex justify-content-between fw-bold text-success",children:[e.jsx("span",{children:"Total:"}),e.jsxs("span",{children:["S/ ",(W.reduce((s,a)=>s+a.total,0)*1.18).toFixed(2)]})]})]})]})]})},{name:"priority",label:"Prioridad del Proyecto",type:"select",options:[{value:"low",label:"Baja"},{value:"normal",label:"Normal"},{value:"high",label:"Alta"},{value:"urgent",label:"Urgente"}],description:"Nivel de prioridad para la ejecución del proyecto"},{name:"vendedor_id",label:"Vendedor Asignado",type:"select",options:((js=R==null?void 0:R.data)==null?void 0:js.filter(s=>s.role==="vendedor_comercial").map(s=>({value:s.id,label:`${s.name} ${s.apellido}`})))||[]},{name:"laboratorio_id",label:"Responsable de Laboratorio",type:"select",options:((fs=R==null?void 0:R.data)==null?void 0:fs.filter(s=>s.role==="usuario_laboratorio").map(s=>({value:s.id,label:`${s.name} ${s.apellido}`})))||[]}],_e=l.useMemo(()=>{if(Q)return console.log("📊 Stats - Usando estadísticas reales del backend:",Q),{total:Q.total||0,activos:Q.activos||0,completados:Q.completados||0,pendientes:Q.pendientes||0,cancelados:Q.cancelados||0,alta_prioridad:Q.alta_prioridad||0};const s=(C==null?void 0:C.data)||[];return console.log("📊 Stats - Fallback: calculando desde página actual:",s),{total:s.length,activos:s.filter(a=>a.status==="activo").length,completados:s.filter(a=>a.status==="completado").length,pendientes:s.filter(a=>a.status==="pendiente").length,cancelados:s.filter(a=>a.status==="cancelado").length,alta_prioridad:s.filter(a=>a.priority==="urgent"||a.priority==="high").length}},[Q,C]);return e.jsxs(e.Fragment,{children:[e.jsx(ja,{fluid:!0,className:"py-4",children:e.jsxs("div",{className:"fade-in",children:[e.jsx(ga,{title:"Gestión de Proyectos",subtitle:ie?`Crear proyecto para: ${ie.name}`:"Crear, editar y gestionar proyectos del sistema",icon:oe,actions:e.jsxs("div",{className:"d-flex gap-2",children:[ie&&e.jsxs(M,{bg:"info",className:"px-3 py-2 d-flex align-items-center",children:[e.jsx(je,{className:"me-1"}),"Cliente: ",ie.name]}),e.jsxs(w,{variant:"primary",onClick:()=>Te(!0),children:[e.jsx(Ss,{className:"me-2"}),ie?"Crear Proyecto":"Nuevo Proyecto"]})]})}),e.jsxs(X,{className:"g-2 mb-4",children:[e.jsx(q,{md:6,lg:3,children:e.jsx(Re,{title:"Total Proyectos",value:_e.total,icon:oe,color:"primary",subtitle:"Proyectos registrados",loading:Ie,size:"compact"})}),e.jsx(q,{md:6,lg:3,children:e.jsx(Re,{title:"Proyectos Activos",value:_e.activos,icon:ne,color:"success",subtitle:"En desarrollo",loading:Ie,size:"compact"})}),e.jsx(q,{md:6,lg:3,children:e.jsx(Re,{title:"Alta Prioridad",value:_e.alta_prioridad||0,icon:Xe,color:"danger",subtitle:"🔴 Urgente + 🟠 Alta",loading:Ie,size:"compact"})}),e.jsx(q,{md:6,lg:3,children:e.jsx(Re,{title:"Pendientes",value:_e.pendientes,icon:Ke,color:"warning",subtitle:"Por iniciar",loading:Ie,size:"compact"})})]}),e.jsxs(h,{className:"shadow-sm border-0",children:[e.jsx(h.Header,{className:"bg-white border-bottom",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("h5",{className:"mb-0",children:[e.jsx(oe,{className:"me-2 text-primary"}),"Lista de Proyectos"]}),e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx(w,{variant:"outline-secondary",size:"sm",onClick:()=>Is(),className:"d-flex align-items-center",title:"Actualizar datos",children:e.jsx(la,{className:`${cs?"spinning":""}`})}),e.jsxs(M,{bg:"light",text:"dark",className:"px-3 py-2",children:[_e.total," proyectos"]})]})]})}),e.jsx(h.Body,{className:"p-0",children:e.jsx(ba,{data:(C==null?void 0:C.data)||[],columns:Xs,loading:cs||Ls,actions:[{label:"Ver",icon:ca,onClick:Js,variant:"primary",style:{backgroundColor:"#f84616",borderColor:"#f84616"}},{label:"Eliminar",icon:vs,onClick:Gs,variant:"outline-danger"}],emptyMessage:"No hay proyectos registrados",totalItems:(C==null?void 0:C.total)||0,itemsPerPage:20,currentPage:Ve,onPageChange:He,onSearch:Ms,onFilter:Ds,filterOptions:Os,getRowClassName:s=>s.status==="cancelado"?"table-secondary opacity-50 text-muted":""})})]}),e.jsx($e,{show:k,onHide:()=>i(!1),title:E!=null&&E.id?"Editar Proyecto":"Nuevo Proyecto",data:E||Da,fields:Zs,onSubmit:Ys,loading:Me.isLoading||De.isLoading,submitText:E!=null&&E.id?"Actualizar":"Crear"}),e.jsx($e,{show:I,onHide:()=>$(!1),title:`📋 Gestionar Proyecto - ${(n==null?void 0:n.name)||""}`,data:{...t,queries_history:Array.isArray(t==null?void 0:t.queries_history)?t.queries_history:[]},size:"xl",fields:[{name:"project_management",label:"Gestión del Proyecto",type:"custom",render:s=>e.jsxs("div",{className:"project-management-modal",children:[e.jsx("style",{children:`
                  .project-management-modal {
                    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
                  }
                  .project-header {
                    background: #f84616;
                    color: white;
                    padding: 1.5rem;
                    border-radius: 12px;
                    margin-bottom: 2rem;
                    box-shadow: 0 8px 25px rgba(248, 70, 22, 0.3);
                  }
                  .project-header h4 {
                    margin: 0;
                    font-weight: 600;
                    font-size: 1.5rem;
                  }
                  .project-header .project-id {
                    background: rgba(255, 255, 255, 0.2);
                    padding: 0.5rem 1rem;
                    border-radius: 20px;
                    font-size: 0.9rem;
                    margin-top: 0.5rem;
                    display: inline-block;
                  }
                  .info-card {
                    background: white;
                    border-radius: 12px;
                    padding: 1.5rem;
                    margin-bottom: 1.5rem;
                    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
                    border: 1px solid #e9ecef;
                  }
                  .info-card h6 {
                    color: #495057;
                    font-weight: 600;
                      margin-bottom: 1rem;
                    padding-bottom: 0.5rem;
                    border-bottom: 2px solid #f8f9fa;
                  }
                  .info-grid {
                    display: grid;
                    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                    gap: 1rem;
                  }
                  .info-item {
                    display: flex;
                    flex-direction: column;
                    gap: 0.25rem;
                    }
                    .info-item label {
                      font-size: 0.75rem;
                      font-weight: 600;
                    color: #6c757d;
                      text-transform: uppercase;
                      letter-spacing: 0.5px;
                  }
                  .info-item .value {
                    font-weight: 500;
                    color: #212529;
                    font-size: 0.95rem;
                  }
                  .priority-badge {
                    display: inline-flex;
                    align-items: center;
                    gap: 0.5rem;
                    padding: 0.5rem 1rem;
                    border-radius: 20px;
                    font-weight: 600;
                    font-size: 0.85rem;
                  }
                  .priority-urgent { background: #fee2e2; color: #dc2626; }
                  .priority-high { background: #fef3c7; color: #d97706; }
                  .priority-normal { background: #d1fae5; color: #059669; }
                  .priority-low { background: #e0e7ff; color: #3730a3; }
                  .status-badge {
                    padding: 0.5rem 1rem;
                    border-radius: 20px;
                    font-weight: 600;
                    font-size: 0.85rem;
                  }
                  .status-pendiente { background: #fef3c7; color: #d97706; }
                  .status-activo { background: #d1fae5; color: #059669; }
                  .status-completado { background: #dbeafe; color: #2563eb; }
                  .status-cancelado { background: #fee2e2; color: #dc2626; }
                  .form-control, .form-select {
                    border-radius: 8px;
                    border: 1px solid #d1d5db;
                    padding: 0.75rem;
                    font-size: 0.9rem;
                    transition: all 0.2s ease;
                  }
                  .form-control:focus, .form-select:focus {
                    border-color: #f84616;
                    box-shadow: 0 0 0 3px rgba(248, 70, 22, 0.1);
                  }
                  .btn-primary {
                    background: #f84616;
                    border: none;
                    border-radius: 8px;
                    padding: 0.75rem 2rem;
                    font-weight: 600;
                    transition: all 0.2s ease;
                  }
                  .btn-primary:hover {
                    background: #e03d14;
                    transform: translateY(-2px);
                    box-shadow: 0 8px 25px rgba(248, 70, 22, 0.3);
                  }
                  .btn-secondary {
                    border-radius: 8px;
                    padding: 0.75rem 2rem;
                    font-weight: 600;
                  }
                  .file-upload-area {
                    border: 2px dashed #d1d5db;
                    border-radius: 12px;
                    padding: 2rem;
                    text-align: center;
                    background: #f9fafb;
                    transition: all 0.2s ease;
                    cursor: pointer;
                  }
                  .file-upload-area:hover {
                    border-color: #f84616;
                    background: #fff5f2;
                  }
                  .file-item {
                    background: white;
                    border: 1px solid #e5e7eb;
                    border-radius: 8px;
                    padding: 1rem;
                    margin-bottom: 0.5rem;
                    display: flex;
                    align-items: center;
                    justify-content: space-between;
                  }
                  .file-item:hover {
                    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
                    }
                  `}),e.jsxs("div",{className:"project-header",children:[e.jsxs("h4",{children:["📋 ",s.name]}),e.jsxs("div",{className:"project-id",children:["ID: #",s.id]})]}),e.jsxs("div",{className:"row g-4",children:[e.jsxs("div",{className:"col-lg-8",children:[e.jsxs("div",{className:"info-card",children:[e.jsx("h6",{children:"📊 Información del Proyecto"}),e.jsxs("div",{className:"info-grid",children:[e.jsxs("div",{className:"info-item",children:[e.jsx("label",{children:"Ubicación"}),e.jsx("div",{className:"value",children:s.location||"No especificada"})]}),e.jsxs("div",{className:"info-item",children:[e.jsx("label",{children:"Estado Actual"}),e.jsx("div",{children:e.jsx("span",{className:`status-badge status-${s.status||"pendiente"}`,children:s.status==="pendiente"?"Pendiente":s.status==="activo"?"Activo":s.status==="completado"?"Completado":s.status==="cancelado"?"Cancelado":s.status})})]}),e.jsxs("div",{className:"info-item",children:[e.jsx("label",{children:"Prioridad"}),e.jsx("div",{children:e.jsx("span",{className:`priority-badge priority-${s.priority||"normal"}`,children:s.priority==="urgent"?"🔴 Urgente":s.priority==="high"?"🟠 Alta":s.priority==="normal"?"🟢 Normal":s.priority==="low"?"🔵 Baja":"🟢 Normal"})})]})]})]}),e.jsxs("div",{className:"info-card",children:[e.jsx("h6",{children:"🏢 Información de la Empresa"}),e.jsxs("div",{className:"info-grid",children:[e.jsxs("div",{className:"info-item",children:[e.jsx("label",{children:"Empresa"}),e.jsx("div",{className:"value fw-bold",children:s.company_name||"Sin empresa"})]}),e.jsxs("div",{className:"info-item",children:[e.jsx("label",{children:"RUC"}),e.jsx("div",{className:"value",children:s.company_ruc||"Sin RUC"})]}),e.jsxs("div",{className:"info-item",children:[e.jsx("label",{children:"Contacto"}),e.jsx("div",{className:"value fw-bold",children:s.contact_name||"Sin contacto"})]}),e.jsxs("div",{className:"info-item",children:[e.jsx("label",{children:"Teléfono"}),e.jsx("div",{className:"value",children:s.contact_phone||"Sin teléfono"})]}),e.jsxs("div",{className:"info-item",children:[e.jsx("label",{children:"Email"}),e.jsx("div",{className:"value",children:s.contact_email||"Sin email"})]}),e.jsxs("div",{className:"info-item",children:[e.jsx("label",{children:"Vendedor Asignado"}),e.jsxs("div",{className:"position-relative",children:[e.jsx("input",{type:"text",className:"form-control form-control-sm",placeholder:"Buscar vendedor...",value:he,onChange:a=>{Ee(a.target.value),Ae(!0)},onFocus:()=>Ae(!0)}),Cs&&e.jsx("div",{className:"position-absolute w-100 bg-white border rounded shadow-lg",style:{zIndex:1e3,maxHeight:"200px",overflowY:"auto"},children:hs().length>0?hs().map(a=>e.jsxs("div",{className:"p-2 border-bottom cursor-pointer hover-bg-light",onClick:()=>Vs(a),style:{cursor:"pointer"},children:[e.jsxs("div",{className:"fw-bold",children:[a.name," ",a.apellido]}),e.jsxs("div",{className:"small text-muted",children:["📧 ",a.email,a.phone&&e.jsxs("span",{children:[" • 📞 ",a.phone]})]}),e.jsx("div",{className:"small",children:e.jsx("span",{className:"badge bg-primary",children:"Vendedor Comercial"})})]},a.id)):e.jsx("div",{className:"p-2 text-muted",children:"No se encontraron vendedores"})})]})]}),e.jsxs("div",{className:"info-item",children:[e.jsx("label",{children:"Responsable Laboratorio"}),e.jsxs("div",{className:"position-relative",children:[e.jsx("input",{type:"text",className:"form-control form-control-sm",placeholder:"Buscar responsable de laboratorio...",value:Fe,onChange:a=>{ze(a.target.value),Pe(!0)},onFocus:()=>Pe(!0)}),qs&&e.jsx("div",{className:"position-absolute w-100 bg-white border rounded shadow-lg",style:{zIndex:1e3,maxHeight:"200px",overflowY:"auto"},children:us().length>0?us().map(a=>e.jsxs("div",{className:"p-2 border-bottom cursor-pointer hover-bg-light",onClick:()=>Hs(a),style:{cursor:"pointer"},children:[e.jsxs("div",{className:"fw-bold",children:[a.name," ",a.apellido]}),e.jsxs("div",{className:"small text-muted",children:["📧 ",a.email,a.phone&&e.jsxs("span",{children:[" • 📞 ",a.phone]})]}),e.jsx("div",{className:"small",children:e.jsx("span",{className:"badge bg-info",children:"Usuario Laboratorio"})})]},a.id)):e.jsx("div",{className:"p-2 text-muted",children:"No se encontraron responsables de laboratorio"})})]})]})]})]})]}),e.jsxs("div",{className:"col-lg-4",children:[e.jsxs("div",{className:"info-card",children:[e.jsx("h6",{children:"⚙️ Configuración Rápida"}),e.jsxs("div",{className:"d-grid gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"form-label small fw-bold",children:"Estado del Proyecto"}),e.jsxs("select",{className:"form-select",value:t.status||"pendiente",onChange:a=>m({...t,status:a.target.value}),children:[e.jsx("option",{value:"pendiente",children:"🟡 Pendiente"}),e.jsx("option",{value:"activo",children:"🟢 Activo"}),e.jsx("option",{value:"en_proceso",children:"🔵 En Proceso"}),e.jsx("option",{value:"completado",children:"✅ Completado"}),e.jsx("option",{value:"pausado",children:"⏸️ Pausado"}),e.jsx("option",{value:"cancelado",children:"❌ Cancelado"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label small fw-bold",children:"Prioridad"}),e.jsxs("select",{className:"form-select",value:t.priority||"normal",onChange:a=>m({...t,priority:a.target.value}),children:[e.jsx("option",{value:"low",children:"🔵 Baja"}),e.jsx("option",{value:"normal",children:"🟢 Normal"}),e.jsx("option",{value:"high",children:"🟠 Alta"}),e.jsx("option",{value:"urgent",children:"🔴 Urgente"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"form-label small fw-bold",children:["Estado Laboratorio",t.ingenieria_status&&t.ingenieria_status!=="no_requerido"&&e.jsx("span",{className:"text-muted small ms-2",children:"(Bloqueado - Ingeniería activa)"})]}),e.jsxs("select",{className:"form-select",disabled:t.ingenieria_status&&t.ingenieria_status!=="no_requerido",value:t.laboratorio_status||"no_requerido",onChange:a=>{const o=a.target.value;m(o!=="no_requerido"?{...t,laboratorio_status:o,ingenieria_status:"no_requerido",requiere_laboratorio:!0,requiere_ingenieria:!1}:{...t,laboratorio_status:o,requiere_laboratorio:!1})},children:[e.jsx("option",{value:"no_requerido",children:"No Requerido"}),e.jsx("option",{value:"pendiente",children:"Pendiente"}),e.jsx("option",{value:"en_proceso",children:"En Proceso"}),e.jsx("option",{value:"completado",children:"Completado"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"form-label small fw-bold",children:["Estado Ingeniería",t.laboratorio_status&&t.laboratorio_status!=="no_requerido"&&e.jsx("span",{className:"text-muted small ms-2",children:"(Bloqueado - Laboratorio activo)"})]}),e.jsxs("select",{className:"form-select",disabled:t.laboratorio_status&&t.laboratorio_status!=="no_requerido",value:t.ingenieria_status||"no_requerido",onChange:a=>{const o=a.target.value;m(o!=="no_requerido"?{...t,ingenieria_status:o,laboratorio_status:"no_requerido",requiere_ingenieria:!0,requiere_laboratorio:!1}:{...t,ingenieria_status:o,requiere_ingenieria:!1})},children:[e.jsx("option",{value:"no_requerido",children:"No Requerido"}),e.jsx("option",{value:"pendiente",children:"Pendiente"}),e.jsx("option",{value:"en_proceso",children:"En Proceso"}),e.jsx("option",{value:"completado",children:"Completado"})]})]})]})]}),e.jsxs("div",{className:"info-card",children:[e.jsx("h6",{children:"📅 Fechas"}),e.jsxs("div",{className:"d-grid gap-2",children:[e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx(da,{className:"text-muted",size:16}),e.jsxs("div",{children:[e.jsx("div",{className:"small text-muted",children:"Creado"}),e.jsx("div",{className:"fw-bold",children:new Date(s.created_at).toLocaleDateString()})]})]}),e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx(Ke,{className:"text-muted",size:16}),e.jsxs("div",{children:[e.jsx("div",{className:"small text-muted",children:"Actualizado"}),e.jsx("div",{className:"fw-bold",children:new Date(s.updated_at).toLocaleDateString()})]})]})]})]})]})]}),e.jsxs("div",{className:"row g-4 mt-2",children:[e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"info-card",children:[e.jsx("h6",{children:"📝 Notas del Estado"}),e.jsx("textarea",{className:"form-control",rows:"4",value:t.status_notes||"",onChange:a=>m({...t,status_notes:a.target.value}),placeholder:"Agrega comentarios sobre el estado del proyecto..."})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"info-card",children:[e.jsx("h6",{children:"❓ Consultas del Cliente"}),e.jsx("div",{className:"mb-3",style:{maxHeight:"200px",overflowY:"auto"},children:t.queries_history&&Array.isArray(t.queries_history)&&t.queries_history.length>0?t.queries_history.map((a,o)=>{const J=(xe=>{const re=["#3b82f6","#ef4444"],te=xe.split("").reduce((V,O)=>(V=(V<<5)-V+O.charCodeAt(0),V&V),0);return re[Math.abs(te)%re.length]})(a.user_name||"Usuario");return e.jsxs("div",{className:"mb-2 p-2 bg-light rounded border-start border-3",style:{borderLeftColor:J},children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-start mb-1",children:[e.jsxs("small",{className:"fw-bold",style:{color:J},children:["👤 ",a.user_name||"Usuario"]}),e.jsx("small",{className:"text-muted",children:new Date(a.created_at).toLocaleString("es-ES",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"})})]}),e.jsx("div",{className:"small",children:a.message})]},o)}):e.jsx("div",{className:"text-center text-muted py-3",children:e.jsx("small",{children:"No hay consultas registradas"})})}),e.jsxs("div",{className:"border-top pt-3",children:[e.jsx("label",{className:"form-label small fw-bold",children:"Agregar consulta:"}),e.jsx("textarea",{className:"form-control",rows:"3",value:ue,onChange:a=>es(a.target.value),placeholder:"Escribe una nueva consulta o respuesta..."}),e.jsx("div",{className:"d-flex justify-content-end mt-2",children:e.jsxs(w,{variant:"primary",size:"sm",onClick:()=>{if(ue&&ue.trim()){const a={message:ue.trim(),user_name:(v==null?void 0:v.name)||"Usuario",created_at:new Date().toISOString()},o=[...t.queries_history||[],a];m({...t,queries_history:o,queries:JSON.stringify(o)}),es("")}},disabled:!ue||!ue.trim(),children:[e.jsx(Be,{className:"me-1"}),"Agregar"]})})]})]})})]}),e.jsxs("div",{className:"info-card mt-3",children:[e.jsx("h6",{children:"📎 Archivos Adjuntos"}),e.jsxs("div",{className:"file-upload-area mb-3",onClick:()=>document.getElementById("fileInput").click(),children:[e.jsx(Ns,{size:32,className:"text-muted mb-2"}),e.jsx("div",{className:"fw-bold text-muted",children:"Hacer clic para subir archivo"}),e.jsx("div",{className:"small text-muted",children:"PDF, Word, Excel, PowerPoint, Imágenes (máx. 10MB)"}),e.jsx("input",{type:"file",id:"fileInput",style:{display:"none"},onChange:Rs,accept:".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.jpg,.jpeg,.png,.gif,.txt"})]}),N&&e.jsxs("div",{className:"alert alert-info d-flex align-items-center mb-3",children:[e.jsx(we,{className:"me-2"}),e.jsxs("div",{children:[e.jsx("strong",{children:N.name}),e.jsx("br",{}),e.jsxs("small",{children:["📏 ",(N.size/1024/1024).toFixed(2)," MB"]})]}),e.jsxs(w,{variant:"primary",size:"sm",onClick:$s,disabled:de,className:"ms-auto",children:[e.jsx(Ns,{className:"me-1"}),de?"Subiendo...":"Subir"]})]}),p.length===0?e.jsxs("div",{className:"text-center py-4 text-muted",children:[e.jsx(_s,{size:48,className:"mb-2 opacity-50"}),e.jsx("div",{children:"No hay archivos adjuntos"}),e.jsx("small",{children:"Sube cotizaciones, documentos técnicos, planos, etc."})]}):e.jsx("div",{className:"row g-2",children:p.map(a=>e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"file-item",children:[e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx(we,{className:"text-primary me-3",size:20}),e.jsxs("div",{children:[e.jsx("div",{className:"fw-bold",children:a.original_name}),e.jsxs("div",{className:"small text-muted",children:["📏 ",a.file_size?`${(a.file_size/1024/1024).toFixed(2)} MB`:"N/A",e.jsx("span",{className:"mx-2",children:"•"}),"📅 ",new Date(a.created_at).toLocaleDateString(),e.jsx("span",{className:"mx-2",children:"•"}),"👤 ",a.uploaded_by_name||"Usuario"]}),a.description&&e.jsx("div",{className:"small text-muted mt-1",children:a.description})]})]}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx(w,{variant:"outline-primary",size:"sm",onClick:()=>ds(a),children:e.jsx(ws,{size:14})}),e.jsx(w,{variant:"outline-danger",size:"sm",onClick:()=>Bs(a.id),children:e.jsx(vs,{size:14})})]})]})},a.id))})]}),e.jsx("div",{className:"d-flex justify-content-between align-items-center gap-3 mt-4 pt-3 border-top",children:e.jsx("div",{children:(n==null?void 0:n.quote_id)&&e.jsxs(w,{variant:"outline-info",onClick:()=>Oe(`/cotizaciones?view=${n.quote_id}`),className:"px-3",children:[e.jsx(we,{className:"me-2"}),"📄 Ver Cotización Relacionada"]})})})]})}],onSubmit:()=>{const s=n==null?void 0:n.id;if(!s){T("❌ Error: No se encontró el ID del proyecto","danger");return}De.mutate({id:s,data:t},{onSuccess:a=>{T("✅ Proyecto actualizado exitosamente!","success"),$(!1)},onError:a=>{console.error("❌ Error al actualizar:",a),T("❌ Error al actualizar proyecto","danger")}})},submitText:De.isLoading?"Guardando...":"Guardar Cambios",cancelText:"Cancelar"}),e.jsx($e,{show:d,onHide:()=>x(!1),title:`👁️ Ver Proyecto - ${(n==null?void 0:n.name)||""}`,data:{...n,queries_history:Array.isArray(n==null?void 0:n.queries_history)?n.queries_history:[]},size:"lg",fields:[{name:"project_view",label:"Información del Proyecto",type:"custom",render:s=>e.jsxs("div",{className:"project-view-modal",children:[e.jsx("style",{children:`
                  .project-view-modal {
                    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
                  }
                  .project-header {
                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                    color: white;
                    padding: 1.5rem;
                    border-radius: 12px;
                    margin-bottom: 2rem;
                    box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
                  }
                  .project-header h4 {
                    margin: 0;
                    font-weight: 600;
                    font-size: 1.5rem;
                  }
                  .project-header .project-id {
                    background: rgba(255, 255, 255, 0.2);
                    padding: 0.5rem 1rem;
                    border-radius: 20px;
                    font-size: 0.9rem;
                    margin-top: 0.5rem;
                    display: inline-block;
                  }
                  .info-card {
                    background: white;
                    border-radius: 12px;
                    padding: 1.5rem;
                    margin-bottom: 1.5rem;
                    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
                    border: 1px solid #e9ecef;
                  }
                  .info-card h6 {
                    color: #495057;
                    font-weight: 600;
                    margin-bottom: 1rem;
                    padding-bottom: 0.5rem;
                    border-bottom: 2px solid #f8f9fa;
                  }
                  .info-grid {
                    display: grid;
                    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                    gap: 1rem;
                  }
                  .info-item {
                    display: flex;
                    flex-direction: column;
                    gap: 0.25rem;
                  }
                  .info-item label {
                    font-size: 0.75rem;
                    font-weight: 600;
                    color: #6c757d;
                    text-transform: uppercase;
                    letter-spacing: 0.5px;
                  }
                  .info-item .value {
                    font-weight: 500;
                    color: #212529;
                    font-size: 0.95rem;
                  }
                  .priority-badge {
                    display: inline-flex;
                    align-items: center;
                    gap: 0.5rem;
                    padding: 0.5rem 1rem;
                    border-radius: 20px;
                    font-weight: 600;
                    font-size: 0.85rem;
                  }
                  .priority-urgent { background: #fee2e2; color: #dc2626; }
                  .priority-high { background: #fef3c7; color: #d97706; }
                  .priority-normal { background: #d1fae5; color: #059669; }
                  .priority-low { background: #e0e7ff; color: #3730a3; }
                  .status-badge {
                    padding: 0.5rem 1rem;
                    border-radius: 20px;
                    font-weight: 600;
                    font-size: 0.85rem;
                  }
                  .status-pendiente { background: #fef3c7; color: #d97706; }
                  .status-activo { background: #d1fae5; color: #059669; }
                  .status-completado { background: #dbeafe; color: #2563eb; }
                  .status-cancelado { background: #fee2e2; color: #dc2626; }
                `}),e.jsxs("div",{className:"project-header",children:[e.jsxs("h4",{children:["👁️ ",s.name]}),e.jsxs("div",{className:"project-id",children:["ID: #",s.id]})]}),e.jsxs("div",{className:"row g-4",children:[e.jsxs("div",{className:"col-lg-8",children:[e.jsxs("div",{className:"info-card",children:[e.jsx("h6",{children:"📊 Información del Proyecto"}),e.jsxs("div",{className:"info-grid",children:[e.jsxs("div",{className:"info-item",children:[e.jsx("label",{children:"Ubicación"}),e.jsx("div",{className:"value",children:s.location||"No especificada"})]}),e.jsxs("div",{className:"info-item",children:[e.jsx("label",{children:"Estado Actual"}),e.jsx("div",{children:e.jsx("span",{className:`status-badge status-${s.status||"pendiente"}`,children:s.status==="pendiente"?"Pendiente":s.status==="activo"?"Activo":s.status==="completado"?"Completado":s.status==="cancelado"?"Cancelado":s.status})})]}),e.jsxs("div",{className:"info-item",children:[e.jsx("label",{children:"Prioridad"}),e.jsx("div",{children:e.jsx("span",{className:`priority-badge priority-${s.priority||"normal"}`,children:s.priority==="urgent"?"🔴 Urgente":s.priority==="high"?"🟠 Alta":s.priority==="normal"?"🟢 Normal":s.priority==="low"?"🔵 Baja":"🟢 Normal"})})]})]})]}),e.jsxs("div",{className:"info-card",children:[e.jsx("h6",{children:"🏢 Información de la Empresa"}),e.jsxs("div",{className:"info-grid",children:[e.jsxs("div",{className:"info-item",children:[e.jsx("label",{children:"Empresa"}),e.jsx("div",{className:"value fw-bold",children:s.company_name||"Sin empresa"})]}),e.jsxs("div",{className:"info-item",children:[e.jsx("label",{children:"RUC"}),e.jsx("div",{className:"value",children:s.company_ruc||"Sin RUC"})]}),e.jsxs("div",{className:"info-item",children:[e.jsx("label",{children:"Contacto"}),e.jsx("div",{className:"value fw-bold",children:s.contact_name||"Sin contacto"})]}),e.jsxs("div",{className:"info-item",children:[e.jsx("label",{children:"Teléfono"}),e.jsx("div",{className:"value",children:s.contact_phone||"Sin teléfono"})]}),e.jsxs("div",{className:"info-item",children:[e.jsx("label",{children:"Email"}),e.jsx("div",{className:"value",children:s.contact_email||"Sin email"})]}),e.jsxs("div",{className:"info-item",children:[e.jsx("label",{children:"Vendedor Asignado"}),e.jsx("div",{className:"value fw-bold",children:s.vendedor_name||"Sin asignar"})]}),e.jsxs("div",{className:"info-item",children:[e.jsx("label",{children:"Responsable Laboratorio"}),e.jsx("div",{className:"value fw-bold",children:s.laboratorio_name||"Sin asignar"})]})]})]})]}),e.jsx("div",{className:"col-lg-4",children:e.jsxs("div",{className:"info-card",children:[e.jsx("h6",{children:"📅 Detalles del Proyecto"}),e.jsxs("div",{className:"info-item mb-3",children:[e.jsx("label",{children:"Fecha de Creación"}),e.jsx("div",{className:"value",children:s.created_at?new Date(s.created_at).toLocaleDateString("es-ES"):"No disponible"})]}),e.jsxs("div",{className:"info-item mb-3",children:[e.jsx("label",{children:"Última Actualización"}),e.jsx("div",{className:"value",children:s.updated_at?new Date(s.updated_at).toLocaleDateString("es-ES"):"No disponible"})]}),s.queries&&e.jsxs("div",{className:"info-item",children:[e.jsx("label",{children:"Consultas/Notas"}),e.jsx("div",{className:"value",style:{fontSize:"0.9rem",lineHeight:"1.4",maxHeight:"200px",overflowY:"auto",border:"1px solid #eee",borderRadius:"5px",padding:"10px"},children:(()=>{try{const a=JSON.parse(s.queries);return Array.isArray(a)&&a.length>0?a.map((o,P)=>{const xe=(re=>{const te=["#3b82f6","#ef4444"],V=re.split("").reduce((O,pe)=>(O=(O<<5)-O+pe.charCodeAt(0),O&O),0);return te[Math.abs(V)%te.length]})(o.user_name||"Usuario Desconocido");return e.jsxs("div",{className:"mb-2 pb-2",style:{borderBottom:P<a.length-1?"1px dotted #eee":"none"},children:[e.jsxs("div",{className:"fw-bold d-flex align-items-center",children:[e.jsx("div",{className:"me-2",style:{width:"4px",height:"20px",backgroundColor:xe,borderRadius:"2px"}}),e.jsx(Be,{className:"me-1",style:{color:xe}}),"👤 ",o.user_name||"Usuario Desconocido",e.jsx("span",{className:"ms-auto text-muted small",style:{fontSize:"0.75rem"},children:new Date(o.created_at).toLocaleString("es-ES",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"})})]}),e.jsx("p",{className:"mb-0 ms-3",style:{fontSize:"0.85rem"},children:o.message})]},P)}):e.jsx("p",{className:"text-muted",children:"No hay consultas registradas."})}catch{return e.jsx("p",{className:"text-muted",children:s.queries})}})()})]})]})})]}),e.jsxs("div",{className:"info-card",children:[e.jsx("h6",{children:"📎 Archivos Adjuntos"}),p.length===0?e.jsxs("div",{className:"text-center py-4 text-muted",children:[e.jsx(_s,{size:48,className:"mb-2 opacity-50"}),e.jsx("div",{children:"No hay archivos adjuntos"}),e.jsx("small",{children:"Este proyecto no tiene archivos adjuntos"})]}):e.jsx("div",{className:"row g-2",children:p.map(a=>e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"file-item",children:[e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx(we,{className:"text-primary me-3",size:20}),e.jsxs("div",{children:[e.jsx("div",{className:"fw-bold",children:a.original_name}),e.jsxs("div",{className:"small text-muted",children:["📏 ",a.file_size?`${(a.file_size/1024/1024).toFixed(2)} MB`:"N/A",e.jsx("span",{className:"mx-2",children:"•"}),"📅 ",new Date(a.created_at).toLocaleDateString(),e.jsx("span",{className:"mx-2",children:"•"}),"👤 ",a.uploaded_by_name||"Usuario"]}),a.description&&e.jsx("div",{className:"small text-muted mt-1",children:a.description})]})]}),e.jsx("div",{className:"d-flex gap-2",children:e.jsx(w,{variant:"outline-primary",size:"sm",onClick:()=>ds(a),children:e.jsx(ws,{size:14})})})]})},a.id))})]}),e.jsxs("div",{className:"d-flex justify-content-center gap-3 mt-4 pt-3 border-top",children:[e.jsxs(w,{variant:"primary",onClick:()=>{x(!1),ps(s)},className:"px-4",style:{backgroundColor:"#f84616",borderColor:"#f84616"},children:[e.jsx(ke,{className:"me-2"}),"⚙️ Gestionar Proyecto"]}),s.quote_id&&e.jsxs(w,{variant:"primary",onClick:()=>{x(!1),Oe(`/cotizaciones?view=${s.quote_id}`)},className:"px-4",style:{backgroundColor:"#f84616",borderColor:"#f84616"},children:[e.jsx(we,{className:"me-2"}),"📄 Ver Evidencias"]})]})]})}],onSubmit:()=>x(!1),submitText:"Cerrar"})]})}),_&&e.jsxs("div",{style:{position:"fixed",top:"20px",right:"20px",zIndex:99999,backgroundColor:ae==="success"?"#28a745":"#dc3545",color:"white",padding:"15px 20px",borderRadius:"8px",boxShadow:"0 4px 12px rgba(0,0,0,0.3)",minWidth:"300px",border:"none"},onClick:()=>U(!1),children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"5px"},children:ae==="success"?"✅ Éxito":"❌ Error"}),e.jsx("div",{children:me})]}),e.jsx($e,{show:ks,onHide:()=>Ue(!1),title:"Seleccionar Servicios del Proyecto",size:"xl",data:{},fields:[],onSubmit:()=>Ue(!1),loading:!1,submitText:"Cerrar",customBody:e.jsx(La,{selectedServices:W,onServicesChange:ss,serviceType:"laboratorio"})}),Es&&e.jsx("div",{className:"modal-backdrop",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:1050,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsxs("div",{className:"modal-content bg-white rounded shadow-lg",style:{width:"90%",maxWidth:"1200px",maxHeight:"90vh",overflow:"auto"},children:[e.jsxs("div",{className:"modal-header p-4 border-bottom d-flex justify-content-between align-items-center",children:[e.jsx("h5",{className:"mb-0",children:"Crear Nuevo Proyecto"}),e.jsx(w,{variant:"outline-secondary",size:"sm",onClick:()=>Te(!1),children:e.jsx(Z,{})})]}),e.jsx("div",{className:"modal-body p-4",children:e.jsx(Ma,{data:ie?{company_id:ie.id}:{},onSubmit:async s=>{try{console.log("Datos del formulario:",s);const a={company_id:s.client_id,name:s.name,location:s.location,contact_name:s.contact_name,contact_phone:s.contact_phone,contact_email:s.contact_email,priority:s.priority||"normal",marked:s.marked||!1,requiere_laboratorio:s.requiere_laboratorio||!1,requiere_ingenieria:s.requiere_ingenieria||!1,requiere_capacitacion:s.requiere_capacitacion||!1};await Me.mutateAsync(a),K("Proyecto creado exitosamente"),ve("success"),U(!0),Te(!1),Le.invalidateQueries("projects")}catch(a){console.error("Error al crear proyecto:",a),K("Error al crear el proyecto"),ve("danger"),U(!0)}},onCancel:()=>Te(!1),loading:Me.isLoading})})]})}),e.jsx(Je,{show:!!L,onHide:()=>u(null),onConfirm:Ws,title:"Eliminar Proyecto",message:`¿Estás seguro de que quieres eliminar el proyecto "${L==null?void 0:L.name}"?`,confirmText:"Eliminar",variant:"danger",isLoading:xs.isLoading,alertMessage:"Esta acción eliminará permanentemente el proyecto y todos sus datos asociados.",alertVariant:"danger"}),e.jsx(Je,{show:!!G,onHide:()=>F(null),onConfirm:Us,title:"Eliminar Archivo",message:"¿Estás seguro de que quieres eliminar este archivo?",confirmText:"Eliminar",variant:"danger",alertMessage:"El archivo se eliminará permanentemente y no se puede recuperar.",alertVariant:"warning"}),e.jsx(Je,{show:!!f,onHide:()=>A(null),onConfirm:Qs,title:`${f!=null&&f.marked?"Desmarcar":"Marcar"} Proyecto`,message:`¿Estás seguro de que quieres ${f!=null&&f.marked?"desmarcar":"marcar"} el proyecto "${f==null?void 0:f.name}"?`,confirmText:f!=null&&f.marked?"Desmarcar":"Marcar",variant:f!=null&&f.marked?"warning":"success"}),e.jsx(fa,{show:ce,onHide:()=>ee(!1),action:se.action,requiredRole:se.requiredRole,currentRole:se.currentRole})]})}export{hi as default};
//# sourceMappingURL=Proyectos-Dtbe6wSX.js.map
