import{a as H,r as l,b as z,j as e,C as E,B as i,t as O,F as k,aZ as B,M as w,L as m,v as V,a3 as D,m as $}from"./index-CJDD9_Aw.js";import{S as L}from"./Spinner-BVQsrHFz.js";import{A as U}from"./Alert-Cn54xJZ3.js";import{R as b,C as t}from"./Row-BGooJhRW.js";import{C as n}from"./Col-DkPevymr.js";import{F as r}from"./Form-FBPQ7LgU.js";import{M as h}from"./Modal-BJZ3bxhN.js";import"./ElementChildren-B01Kjy_s.js";const Y=()=>{const{user:j}=H(),[x,P]=l.useState([]),[C,u]=l.useState(!0),[F,p]=l.useState(null),[o,v]=l.useState({status:"",client:"",vendedor:""}),[M,f]=l.useState(!1),[g,_]=l.useState(null),[c,N]=l.useState({status:"",notes:"",files:[]});l.useEffect(()=>{y()},[]);const y=async()=>{try{u(!0),p(null);const s=j.role==="usuario_laboratorio"?"/api/shipments/laboratory":"/api/shipments/commercial",a=await z(s);P(a||[])}catch(s){console.error("Error fetching data:",s),p("Error al cargar los datos: "+(s.message||"Error desconocido"))}finally{u(!1)}},R=s=>{const d={enviado:{variant:"primary",text:"Enviado",icon:B},recibido:{variant:"success",text:"Recibido",icon:m},en_proceso:{variant:"warning",text:"En Proceso",icon:w},completado:{variant:"info",text:"Completado",icon:m},pendiente:{variant:"secondary",text:"Pendiente",icon:D}}[s]||{variant:"secondary",text:s,icon:D};return e.jsxs(V,{bg:d.variant,children:[e.jsx(d.icon,{className:"me-1"}),d.text]})},T=s=>{const a=[];return(j.role==="vendedor_comercial"||j.role==="jefa_comercial")&&s.status==="enviado"&&a.push(e.jsxs(i,{variant:"success",size:"sm",onClick:()=>S(s,"recibido"),children:[e.jsx(m,{className:"me-1"}),"Marcar Recibido"]},"mark-received")),j.role==="usuario_laboratorio"&&(s.status==="recibido"&&a.push(e.jsxs(i,{variant:"warning",size:"sm",onClick:()=>S(s,"en_proceso"),children:[e.jsx(w,{className:"me-1"}),"Marcar En Proceso"]},"mark-processing")),s.status==="en_proceso"&&a.push(e.jsxs(i,{variant:"info",size:"sm",onClick:()=>S(s,"completado"),children:[e.jsx(m,{className:"me-1"}),"Marcar Completado"]},"mark-completed"))),a.push(e.jsxs(i,{variant:"outline-primary",size:"sm",onClick:()=>{window.location.href=`/envios/${s.id}`},children:[e.jsx($,{className:"me-1"}),"Ver Detalles"]},"view-details")),a},S=(s,a)=>{_(s),N({status:a,notes:"",files:[]}),f(!0)},G=async()=>{try{u(!0),p(null);const s=new FormData;s.append("status",c.status),s.append("notes",c.notes),c.files.length>0&&c.files.forEach(a=>{s.append("files",a)}),await z(`/api/shipments/${g.id}/status`,{method:"POST",body:s}),f(!1),_(null),N({status:"",notes:"",files:[]}),await y()}catch(s){p("Error al actualizar estado: "+(s.message||"Error desconocido"))}finally{u(!1)}},A=x.filter(s=>{var a,d;return!(o.status&&s.status!==o.status||o.client&&!((a=s.client_name)!=null&&a.toLowerCase().includes(o.client.toLowerCase()))||o.vendedor&&!((d=s.vendedor_name)!=null&&d.toLowerCase().includes(o.vendedor.toLowerCase())))});return C?e.jsx(E,{className:"py-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx(L,{animation:"border"}),e.jsx("p",{className:"mt-2",children:"Cargando envÃ­os..."})]})}):F?e.jsx(E,{className:"py-4",children:e.jsx(U,{variant:"danger",children:F})}):e.jsxs(E,{className:"py-4",children:[e.jsxs(b,{className:"mb-4",children:[e.jsxs(n,{children:[e.jsx("h2",{children:"ðŸ“¦ Seguimiento de EnvÃ­os"}),e.jsx("p",{className:"text-muted",children:"Seguimiento de envÃ­os entre comercial y laboratorio"})]}),e.jsx(n,{md:"auto",children:e.jsxs(i,{variant:"outline-secondary",onClick:y,children:[e.jsx(O,{className:"me-2"}),"Actualizar"]})})]}),e.jsxs(b,{className:"mb-4",children:[e.jsx(n,{md:3,children:e.jsxs(r.Select,{value:o.status,onChange:s=>v(a=>({...a,status:s.target.value})),children:[e.jsx("option",{value:"",children:"Todos los estados"}),e.jsx("option",{value:"enviado",children:"Enviado"}),e.jsx("option",{value:"recibido",children:"Recibido"}),e.jsx("option",{value:"en_proceso",children:"En Proceso"}),e.jsx("option",{value:"completado",children:"Completado"}),e.jsx("option",{value:"pendiente",children:"Pendiente"})]})}),e.jsx(n,{md:3,children:e.jsx(r.Control,{type:"text",placeholder:"Filtrar por cliente...",value:o.client,onChange:s=>v(a=>({...a,client:s.target.value}))})}),e.jsx(n,{md:3,children:e.jsx(r.Control,{type:"text",placeholder:"Filtrar por vendedor...",value:o.vendedor,onChange:s=>v(a=>({...a,vendedor:s.target.value}))})}),e.jsx(n,{md:3,children:e.jsx("div",{className:"d-flex gap-2",children:e.jsx(i,{variant:"outline-secondary",onClick:()=>v({status:"",client:"",vendedor:""}),children:"Limpiar"})})})]}),e.jsxs(b,{className:"mb-4",children:[e.jsx(n,{md:3,children:e.jsx(t,{className:"text-center",children:e.jsxs(t.Body,{children:[e.jsx(k,{size:24,className:"text-primary mb-2"}),e.jsx("h4",{children:x.length}),e.jsx("small",{className:"text-muted",children:"Total EnvÃ­os"})]})})}),e.jsx(n,{md:3,children:e.jsx(t,{className:"text-center",children:e.jsxs(t.Body,{children:[e.jsx(B,{size:24,className:"text-primary mb-2"}),e.jsx("h4",{children:x.filter(s=>s.status==="enviado").length}),e.jsx("small",{className:"text-muted",children:"Enviados"})]})})}),e.jsx(n,{md:3,children:e.jsx(t,{className:"text-center",children:e.jsxs(t.Body,{children:[e.jsx(w,{size:24,className:"text-warning mb-2"}),e.jsx("h4",{children:x.filter(s=>s.status==="en_proceso").length}),e.jsx("small",{className:"text-muted",children:"En Proceso"})]})})}),e.jsx(n,{md:3,children:e.jsx(t,{className:"text-center",children:e.jsxs(t.Body,{children:[e.jsx(m,{size:24,className:"text-success mb-2"}),e.jsx("h4",{children:x.filter(s=>s.status==="completado").length}),e.jsx("small",{className:"text-muted",children:"Completados"})]})})})]}),e.jsx(b,{children:A.length===0?e.jsx(n,{children:e.jsx(t,{children:e.jsxs(t.Body,{className:"text-center py-5",children:[e.jsx(k,{size:48,className:"text-muted mb-3"}),e.jsx("h5",{children:"No hay envÃ­os"}),e.jsx("p",{className:"text-muted",children:Object.values(o).some(s=>s)?"No se encontraron envÃ­os con los filtros aplicados":"No hay envÃ­os registrados"})]})})}):A.map(s=>e.jsx(n,{md:6,lg:4,className:"mb-3",children:e.jsxs(t,{children:[e.jsxs(t.Header,{className:"d-flex justify-content-between align-items-center",children:[e.jsx("strong",{children:s.project_name}),R(s.status)]}),e.jsxs(t.Body,{children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Cliente:"})," ",s.client_name||"N/A"]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Vendedor:"})," ",s.vendedor_name||"N/A"]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Proyecto:"})," ",s.project_name||"N/A"]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"DescripciÃ³n:"})," ",s.description||"Sin descripciÃ³n"]}),e.jsx("hr",{}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Fecha de EnvÃ­o:"})," ",new Date(s.sent_at).toLocaleDateString()]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Ãšltima ActualizaciÃ³n:"})," ",new Date(s.updated_at).toLocaleDateString()]}),s.notes&&e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Notas:"})," ",s.notes]}),e.jsx("div",{className:"d-flex gap-2 mt-3",children:T(s)})]})]})},s.id))}),e.jsxs(h,{show:M,onHide:()=>f(!1),children:[e.jsx(h.Header,{closeButton:!0,children:e.jsx(h.Title,{children:"Actualizar Estado del EnvÃ­o"})}),e.jsxs(h.Body,{children:[g&&e.jsxs("div",{className:"mb-3",children:[e.jsxs("h6",{children:["Proyecto: ",g.project_name]}),e.jsxs("p",{className:"text-muted",children:["Cliente: ",g.client_name]})]}),e.jsxs(r.Group,{className:"mb-3",children:[e.jsx(r.Label,{children:"Nuevo Estado"}),e.jsx(r.Control,{type:"text",value:c.status,readOnly:!0})]}),e.jsxs(r.Group,{className:"mb-3",children:[e.jsx(r.Label,{children:"Notas"}),e.jsx(r.Control,{as:"textarea",rows:3,value:c.notes,onChange:s=>N(a=>({...a,notes:s.target.value})),placeholder:"Agregar notas sobre el cambio de estado..."})]}),e.jsxs(r.Group,{className:"mb-3",children:[e.jsx(r.Label,{children:"Archivos Adjuntos"}),e.jsx(r.Control,{type:"file",multiple:!0,accept:".pdf,.jpg,.jpeg,.png,.doc,.docx",onChange:s=>N(a=>({...a,files:Array.from(s.target.files)}))}),e.jsx(r.Text,{className:"text-muted",children:"Puedes adjuntar archivos relacionados con el cambio de estado"})]})]}),e.jsxs(h.Footer,{children:[e.jsx(i,{variant:"secondary",onClick:()=>f(!1),children:"Cancelar"}),e.jsx(i,{variant:"success",onClick:G,disabled:C,children:C?e.jsxs(e.Fragment,{children:[e.jsx(L,{size:"sm",className:"me-2"}),"Actualizando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(m,{className:"me-2"}),"Actualizar Estado"]})})]})]})]})};export{Y as default};
//# sourceMappingURL=SeguimientoEnvios-GBtYw1iU.js.map
