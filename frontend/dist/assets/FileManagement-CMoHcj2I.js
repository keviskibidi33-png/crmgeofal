import{r as n,j as e,C,Q as u,B as l,t as T,ap as b,l as _,v,an as q,U as Q,al as g,T as M,m as B,h as P,X,b as A,f as J}from"./index-xQVByYRi.js";import{A as D}from"./Alert-BijlR5uZ.js";import{R as N,C as t}from"./Row-mPOlevGM.js";import{C as m}from"./Col-Dz9zKzWQ.js";import{T as W,a as f}from"./Tabs-Bk5q6sTj.js";import{P as Y}from"./ProgressBar-BxphXh5S.js";import{T as F}from"./Table-6IySdngi.js";import"./ElementChildren-BP-7Da5j.js";const ce=()=>{const[a,I]=n.useState(null),[R,w]=n.useState(!0),[S,E]=n.useState(null),[y,x]=n.useState(!1),[c,U]=n.useState(!0),[k,$]=n.useState(new Date),[H,K]=n.useState("overview"),d=async()=>{try{w(!0);const s=await A("/api/attachments/storage/stats");I(s),E(null),$(new Date)}catch(s){console.error("Error cargando estad√≠sticas:",s),E("Error al cargar estad√≠sticas de almacenamiento")}finally{w(!1)}};n.useEffect(()=>{let s;return c&&(s=setInterval(()=>{d()},3e4)),()=>{s&&clearInterval(s)}},[c]);const O=async()=>{try{x(!0);const s=await A("/api/attachments/storage/create-folders",{method:"POST"});await d();let r=`‚úÖ ${s.message}`;s.createdFolders&&s.createdFolders.length>0&&(r+=`

üìÅ Carpetas creadas:`,s.createdFolders.forEach(i=>{r+=`
‚Ä¢ ${i.path} (${i.type})`})),s.existingFolders&&s.existingFolders.length>0&&(r+=`

‚úÖ Carpetas existentes: ${s.existingFolders.length}`),s.daysUntilMonthEnd!==void 0&&(r+=`

üìÖ D√≠as hasta fin de mes: ${s.daysUntilMonthEnd}`),alert(r)}catch(s){console.error("Error creando carpetas:",s),alert("‚ùå Error al crear carpetas anticipatorias")}finally{x(!1)}},G=async()=>{try{x(!0),await A("/api/attachments/storage/compress",{method:"POST"}),await d(),alert("‚úÖ Compresi√≥n de carpetas antiguas completada")}catch(s){console.error("Error comprimiendo carpetas:",s),alert("‚ùå Error al comprimir carpetas")}finally{x(!1)}},V=()=>{if(!(a!=null&&a.folders))return[];const s={};return a.folders.forEach(r=>{const i=r.path.match(/project_(\d+)/g);i&&i.forEach(p=>{const h=p.replace("project_","");s[h]||(s[h]={projectId:h,totalSize:0,fileCount:0,folders:[]}),s[h].totalSize+=r.size,s[h].fileCount+=r.fileCount,s[h].folders.push(r)})}),Object.values(s).sort((r,i)=>i.totalSize-r.totalSize)},z=()=>a!=null&&a.folders?a.folders.filter(s=>s.path.includes(".zip")||s.path.includes(".rar")):[];n.useEffect(()=>{d()},[]);const o=s=>{if(s===0)return"0 Bytes";const r=1024,i=["Bytes","KB","MB","GB","TB"],p=Math.floor(Math.log(s)/Math.log(r));return parseFloat((s/Math.pow(r,p)).toFixed(2))+" "+i[p]},j=s=>{switch(s){case"red":return"danger";case"orange":return"warning";case"yellow":return"info";default:return"success"}},L=s=>{switch(s){case"red":return e.jsx(u,{className:"text-danger"});case"orange":return e.jsx(u,{className:"text-warning"});case"yellow":return e.jsx(u,{className:"text-info"});default:return e.jsx(J,{className:"text-success"})}};return R?e.jsx(C,{className:"mt-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"spinner-border",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Cargando..."})}),e.jsx("p",{className:"mt-2",children:"Cargando estad√≠sticas de almacenamiento..."})]})}):S?e.jsx(C,{className:"mt-4",children:e.jsxs(D,{variant:"danger",children:[e.jsx(u,{className:"me-2"}),S,e.jsxs(l,{variant:"outline-danger",size:"sm",className:"ms-2",onClick:d,children:[e.jsx(T,{className:"me-1"}),"Reintentar"]})]})}):e.jsxs(C,{className:"mt-4",children:[e.jsx(N,{className:"mb-4",children:e.jsx(m,{children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{children:[e.jsxs("h2",{children:[e.jsx(b,{className:"me-2"}),"Gesti√≥n de Archivos"]}),e.jsx("p",{className:"text-muted",children:"Sistema inteligente de organizaci√≥n y monitoreo de almacenamiento"})]}),e.jsxs("div",{className:"d-flex align-items-center gap-3",children:[e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx(_,{className:`me-2 ${c?"text-success":"text-muted"}`}),e.jsxs("span",{className:c?"text-success":"text-muted",children:["Monitoreo ",c?"Activo":"Inactivo"]})]}),e.jsxs(l,{variant:c?"outline-danger":"outline-success",size:"sm",onClick:()=>U(!c),children:[c?"Pausar":"Activar"," Monitoreo"]}),e.jsxs("small",{className:"text-muted",children:["√öltima actualizaci√≥n: ",k.toLocaleTimeString()]})]})]})})}),e.jsxs(W,{activeKey:H,onSelect:K,className:"mb-4",children:[e.jsxs(f,{eventKey:"overview",title:e.jsxs("span",{children:[e.jsx(b,{className:"me-1"}),"Resumen"]}),children:[e.jsxs(N,{className:"mb-4",children:[e.jsx(m,{md:8,children:e.jsxs(t,{children:[e.jsx(t.Header,{children:e.jsxs("h5",{className:"mb-0",children:[e.jsx(b,{className:"me-2"}),"Estado del Almacenamiento"]})}),e.jsxs(t.Body,{children:[e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"d-flex justify-content-between mb-2",children:[e.jsx("span",{children:"Uso de almacenamiento"}),e.jsxs("span",{className:"fw-bold",children:[o(a.totalSize)," / ",o(a.maxSize),e.jsxs(v,{bg:j(a.alertLevel),className:"ms-2",children:[a.usagePercentage,"%"]})]})]}),e.jsx(Y,{now:a.usagePercentage,variant:j(a.alertLevel),style:{height:"20px"}})]}),e.jsxs(N,{children:[e.jsx(m,{md:6,children:e.jsxs("div",{className:"text-center p-3 border rounded",children:[e.jsx(q,{className:"h3 text-primary mb-2"}),e.jsx("h6",{children:"Espacio Libre"}),e.jsx("h4",{className:"text-success",children:o(a.freeSpace)})]})}),e.jsx(m,{md:6,children:e.jsxs("div",{className:"text-center p-3 border rounded",children:[L(a.alertLevel),e.jsx("h6",{children:"Estado"}),e.jsx("h4",{className:`text-${j(a.alertLevel)}`,children:a.alertLevel.toUpperCase()})]})})]})]})]})}),e.jsx(m,{md:4,children:e.jsxs(t,{children:[e.jsx(t.Header,{children:e.jsx("h5",{className:"mb-0",children:"Acciones"})}),e.jsx(t.Body,{children:e.jsxs("div",{className:"d-grid gap-2",children:[e.jsxs(l,{variant:"primary",onClick:d,disabled:y,children:[e.jsx(T,{className:"me-2"}),"Actualizar Estad√≠sticas"]}),e.jsxs(l,{variant:"success",onClick:O,disabled:y,children:[e.jsx(Q,{className:"me-2"}),"Crear Carpetas Anticipatorias"]}),e.jsxs(l,{variant:"warning",onClick:G,disabled:y,children:[e.jsx(g,{className:"me-2"}),"Comprimir Carpetas Antiguas"]})]})})]})})]}),a.alertLevel!=="green"&&e.jsx(N,{className:"mb-4",children:e.jsx(m,{children:e.jsx(D,{variant:j(a.alertLevel),children:e.jsxs("div",{className:"d-flex align-items-center",children:[L(a.alertLevel),e.jsxs("div",{className:"ms-2",children:[e.jsx("strong",{children:"Alerta de Almacenamiento"}),e.jsxs("p",{className:"mb-0",children:[a.alertLevel==="red"&&"‚ö†Ô∏è CR√çTICO: Almacenamiento al 95% o m√°s. Se requiere acci√≥n inmediata.",a.alertLevel==="orange"&&"‚ö†Ô∏è ADVERTENCIA: Almacenamiento al 85% o m√°s. Considere comprimir archivos antiguos.",a.alertLevel==="yellow"&&"‚ÑπÔ∏è INFORMACI√ìN: Almacenamiento al 70% o m√°s. Monitoree el uso."]})]})]})})})})]}),e.jsx(f,{eventKey:"by-month",title:e.jsxs("span",{children:[e.jsx(M,{className:"me-1"}),"Por Mes"]}),children:e.jsxs(t,{children:[e.jsx(t.Header,{children:e.jsxs("h5",{className:"mb-0",children:[e.jsx(M,{className:"me-2"}),"Carpetas por Mes"]})}),e.jsx(t.Body,{children:e.jsxs(F,{responsive:!0,striped:!0,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"A√±o"}),e.jsx("th",{children:"Mes"}),e.jsx("th",{children:"Tama√±o"}),e.jsx("th",{children:"Archivos"}),e.jsx("th",{children:"Estado"}),e.jsx("th",{children:"Acciones"})]})}),e.jsx("tbody",{children:a.folders.map((s,r)=>e.jsxs("tr",{children:[e.jsx("td",{children:s.year}),e.jsx("td",{children:s.month}),e.jsx("td",{children:o(s.size)}),e.jsx("td",{children:s.fileCount}),e.jsx("td",{children:e.jsx(v,{bg:s.size>100*1024*1024?"warning":"success",children:s.size>100*1024*1024?"Grande":"Normal"})}),e.jsx("td",{children:e.jsxs(l,{variant:"outline-primary",size:"sm",children:[e.jsx(B,{className:"me-1"}),"Ver"]})})]},r))})]})})]})}),e.jsx(f,{eventKey:"by-client",title:e.jsxs("span",{children:[e.jsx(P,{className:"me-1"}),"Por Cliente"]}),children:e.jsxs(t,{children:[e.jsx(t.Header,{children:e.jsxs("h5",{className:"mb-0",children:[e.jsx(P,{className:"me-2"}),"Archivos por Cliente/Proyecto"]})}),e.jsx(t.Body,{children:e.jsxs(F,{responsive:!0,striped:!0,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Proyecto ID"}),e.jsx("th",{children:"Tama√±o Total"}),e.jsx("th",{children:"Archivos"}),e.jsx("th",{children:"Carpetas"}),e.jsx("th",{children:"Estado"}),e.jsx("th",{children:"Acciones"})]})}),e.jsx("tbody",{children:V().map((s,r)=>e.jsxs("tr",{children:[e.jsxs("td",{children:["Proyecto #",s.projectId]}),e.jsx("td",{children:o(s.totalSize)}),e.jsx("td",{children:s.fileCount}),e.jsx("td",{children:s.folders.length}),e.jsx("td",{children:e.jsx(v,{bg:s.totalSize>50*1024*1024?"warning":"success",children:s.totalSize>50*1024*1024?"Grande":"Normal"})}),e.jsx("td",{children:e.jsxs(l,{variant:"outline-primary",size:"sm",children:[e.jsx(B,{className:"me-1"}),"Ver Detalles"]})})]},r))})]})})]})}),e.jsx(f,{eventKey:"compressed",title:e.jsxs("span",{children:[e.jsx(g,{className:"me-1"}),"Comprimidos"]}),children:e.jsxs(t,{children:[e.jsx(t.Header,{children:e.jsxs("h5",{className:"mb-0",children:[e.jsx(g,{className:"me-2"}),"Archivos Comprimidos"]})}),e.jsx(t.Body,{children:z().length>0?e.jsxs(F,{responsive:!0,striped:!0,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Archivo"}),e.jsx("th",{children:"Tama√±o"}),e.jsx("th",{children:"Fecha"}),e.jsx("th",{children:"Estado"}),e.jsx("th",{children:"Acciones"})]})}),e.jsx("tbody",{children:z().map((s,r)=>e.jsxs("tr",{children:[e.jsx("td",{children:s.path.split("/").pop()}),e.jsx("td",{children:o(s.size)}),e.jsx("td",{children:new Date().toLocaleDateString()}),e.jsx("td",{children:e.jsx(v,{bg:"success",children:"Comprimido"})}),e.jsx("td",{children:e.jsxs(l,{variant:"outline-success",size:"sm",children:[e.jsx(X,{className:"me-1"}),"Descargar"]})})]},r))})]}):e.jsxs("div",{className:"text-center py-4",children:[e.jsx(g,{className:"h1 text-muted mb-3"}),e.jsx("h5",{children:"No hay archivos comprimidos"}),e.jsx("p",{className:"text-muted",children:"Los archivos se comprimen autom√°ticamente cuando el almacenamiento supera el 90%"})]})})]})})]})]})};export{ce as default};
//# sourceMappingURL=FileManagement-CMoHcj2I.js.map
