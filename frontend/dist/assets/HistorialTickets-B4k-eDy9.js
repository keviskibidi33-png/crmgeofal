import{R as s,j as t}from"./index-BFrTSJXc.js";import{M as p}from"./ModuloBase-BXjPI6cD.js";import{D as y}from"./DataTable-CSrcfzDj.js";import{T as k}from"./Toolbar-CsECCMO9.js";import{u as f}from"./useQuery-C56LzOWb.js";import{a as w,b as C}from"./tickets-DxqGWiv9.js";function H(){var x;const[i,b]=s.useState(""),[c,j]=s.useState(""),[d,g]=s.useState(""),[u,v]=s.useState("30"),[n,o]=s.useState(1),[l]=s.useState(10),{data:a,isLoading:m}=f(["ticket-history",{ticketId:i,page:n,limit:l,q:c,action:d,range:u}],async()=>{if(i){const e=await w(i,{page:n,limit:l}),r=Array.isArray(e==null?void 0:e.data)?e.data:(e==null?void 0:e.rows)||e||[],h=Number((e==null?void 0:e.total)||r.length||0);return{rows:r,total:h}}else{const e=await C({page:n,limit:l,q:c,action:d,range:u}),r=Array.isArray(e==null?void 0:e.data)?e.data:(e==null?void 0:e.rows)||e||[],h=Number((e==null?void 0:e.total)||r.length||0);return{rows:r,total:h}}},{keepPreviousData:!0});return t.jsxs(p,{titulo:"Historial de Tickets",descripcion:"Listado de cambios de estado y acciones sobre tickets.",children:[t.jsx(k,{compact:!0,left:t.jsxs(t.Fragment,{children:[t.jsx("input",{className:"form-control",style:{minWidth:160},placeholder:"ID de ticket (opcional)",value:i,onChange:e=>{b(e.target.value),o(1)}}),!i&&t.jsxs(t.Fragment,{children:[t.jsx("input",{className:"form-control",style:{minWidth:180},placeholder:"Buscar (ticket/usuario)",value:c,onChange:e=>{j(e.target.value),o(1)}}),t.jsxs("select",{className:"form-select",value:d,onChange:e=>{g(e.target.value),o(1)},children:[t.jsx("option",{value:"",children:"Todas las acciones"}),t.jsx("option",{value:"creado",children:"Creado"}),t.jsx("option",{value:"cambio",children:"Cambio"}),t.jsx("option",{value:"cambio a abierto",children:"Cambio a abierto"}),t.jsx("option",{value:"cambio a en_proceso",children:"Cambio a en_proceso"}),t.jsx("option",{value:"cambio a resuelto",children:"Cambio a resuelto"}),t.jsx("option",{value:"cambio a cerrado",children:"Cambio a cerrado"})]}),t.jsxs("select",{className:"form-select",value:u,onChange:e=>{v(e.target.value),o(1)},children:[t.jsx("option",{value:"7",children:"Últimos 7 días"}),t.jsx("option",{value:"30",children:"Últimos 30 días"}),t.jsx("option",{value:"90",children:"Últimos 90 días"}),t.jsx("option",{value:"all",children:"Todo"})]})]}),t.jsxs("div",{className:"text-muted small d-flex align-items-center",children:[(a==null?void 0:a.total)||0," eventos"]})]}),right:null}),t.jsx(y,{columns:[{header:"ID",key:"id",width:80},{header:"Ticket",key:"ticket_id"},{header:"Acción",key:"action"},{header:"Usuario",key:"user_name",render:e=>e.user_name||e.performed_by},{header:"Fecha",key:"created_at",render:e=>e.created_at?String(e.created_at).slice(0,19).replace("T"," "):"—",width:160}],rows:(a==null?void 0:a.rows)||[],loading:m}),t.jsxs("div",{className:"d-flex justify-content-between align-items-center mt-2",children:[t.jsxs("div",{className:"text-muted small",children:["Página ",n]}),t.jsxs("div",{className:"btn-group",children:[t.jsx("button",{className:"btn btn-outline-secondary",disabled:n<=1||m,onClick:()=>o(e=>Math.max(1,e-1)),children:"Anterior"}),t.jsx("button",{className:"btn btn-outline-secondary",disabled:(((x=a==null?void 0:a.rows)==null?void 0:x.length)||0)<l||m,onClick:()=>o(e=>e+1),children:"Siguiente"})]})]})]})}export{H as default};
//# sourceMappingURL=HistorialTickets-B4k-eDy9.js.map
