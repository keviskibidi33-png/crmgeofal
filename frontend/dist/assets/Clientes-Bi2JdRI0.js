import{r,L as w,j as e,M as B,b as p,B as L,O as _,c as b,t as x,I as y,v as C,U as H,V as k}from"./index-DQOtztfR.js";import{u as h}from"./useMutation-CIsAIm9w.js";import{u as A}from"./useQuery-CYOA-NUZ.js";import{P as Q,R as G,C as o}from"./PageHeader-BEMCbyOR.js";import{D as O}from"./DataTable-GseDfFac.js";import{M as V}from"./ModalForm-yDWh6PbB.js";import{S as c}from"./StatsCard-BNDy4zbf.js";import{d as $,l as J,c as K,u as W}from"./companies-zyOdEFRO.js";import{C as g}from"./Card-ChjpncsD.js";import"./InputGroup-BJLqGG_u.js";const N={type:"empresa",ruc:"",dni:"",name:"",address:"",email:"",phone:"",contact_name:""};function oe(){const[v,i]=r.useState(!1),[t,m]=r.useState(null),[X,E]=r.useState(null),S=w(),{data:l,isLoading:M}=A(["clients"],()=>J(),{keepPreviousData:!0}),d=s=>{S.invalidateQueries("clients"),i(!1),m(null),E(null)},j=h(K,{onSuccess:()=>d(),onError:s=>console.error("Error creating client:",s)}),f=h(W,{onSuccess:()=>d(),onError:s=>console.error("Error updating client:",s)}),D=h($,{onSuccess:()=>d(),onError:s=>console.error("Error deleting client:",s)}),F=()=>{m(N),i(!0)},I=s=>{m(s),i(!0)},P=s=>{window.confirm(`¿Estás seguro de que quieres eliminar el cliente "${s.name}"?`)&&D.mutate(s.id)},R=async s=>{t.id?await f.mutateAsync({id:t.id,...s}):await j.mutateAsync(s)},z=s=>{const u={empresa:{bg:"primary",text:"Empresa",icon:b},persona:{bg:"info",text:"Persona Natural",icon:x}}[s]||{bg:"secondary",text:s,icon:x},q=u.icon;return e.jsxs(C,{bg:u.bg,className:"status-badge d-flex align-items-center",children:[e.jsx(q,{size:12,className:"me-1"}),u.text]})},T=[{header:"ID",accessor:"id",width:"80px"},{header:"Cliente",accessor:"name",render:(s,a)=>e.jsxs("div",{children:[e.jsx("div",{className:"fw-medium",children:a.name}),e.jsxs("div",{className:"d-flex align-items-center gap-2 mt-1",children:[z(a.type),a.ruc&&e.jsxs("small",{className:"text-muted",children:["RUC: ",a.ruc]}),a.dni&&e.jsxs("small",{className:"text-muted",children:["DNI: ",a.dni]})]})]})},{header:"Contacto",accessor:"contact",render:(s,a)=>e.jsxs("div",{children:[a.contact_name&&e.jsx("div",{className:"fw-medium",children:a.contact_name}),a.email&&e.jsxs("div",{className:"d-flex align-items-center mt-1",children:[e.jsx(y,{size:12,className:"me-1 text-muted"}),e.jsx("small",{className:"text-muted",children:a.email})]}),a.phone&&e.jsxs("div",{className:"d-flex align-items-center mt-1",children:[e.jsx(H,{size:12,className:"me-1 text-muted"}),e.jsx("small",{className:"text-muted",children:a.phone})]})]})},{header:"Dirección",accessor:"address",render:s=>s?e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx(k,{size:12,className:"me-1 text-muted"}),e.jsx("small",{className:"text-muted",children:s})]}):e.jsx("small",{className:"text-muted",children:"Sin dirección"})},{header:"Fecha Registro",accessor:"created_at",type:"date"}],U=[{name:"type",label:"Tipo de Cliente",type:"select",required:!0,options:[{value:"empresa",label:"Empresa"},{value:"persona",label:"Persona Natural"}]},{name:"name",label:"Nombre/Razón Social",type:"text",required:!0,placeholder:"Ingresa el nombre o razón social"},{name:"ruc",label:"RUC",type:"text",placeholder:"Ingresa el RUC (solo para empresas)",help:"Solo para empresas"},{name:"dni",label:"DNI",type:"text",placeholder:"Ingresa el DNI (solo para personas)",help:"Solo para personas naturales"},{name:"contact_name",label:"Nombre de Contacto",type:"text",placeholder:"Ingresa el nombre del contacto"},{name:"email",label:"Email",type:"email",placeholder:"contacto@empresa.com"},{name:"phone",label:"Teléfono",type:"text",placeholder:"+51 999 999 999"},{name:"address",label:"Dirección",type:"textarea",placeholder:"Ingresa la dirección completa"}],n=r.useMemo(()=>{const s=(l==null?void 0:l.companies)||[];return{total:s.length,empresas:s.filter(a=>a.type==="empresa").length,personas:s.filter(a=>a.type==="persona").length,conEmail:s.filter(a=>a.email).length,conTelefono:s.filter(a=>a.phone).length}},[l]);return e.jsx(B,{fluid:!0,className:"py-4",children:e.jsxs("div",{className:"fade-in",children:[e.jsx(Q,{title:"Gestión de Clientes",subtitle:"Crear, editar y gestionar clientes del sistema",icon:p,actions:e.jsxs(L,{variant:"primary",onClick:F,children:[e.jsx(_,{className:"me-2"}),"Nuevo Cliente"]})}),e.jsxs(G,{className:"g-4 mb-4",children:[e.jsx(o,{md:6,lg:3,children:e.jsx(c,{title:"Total Clientes",value:n.total,icon:p,color:"primary",subtitle:"Clientes registrados"})}),e.jsx(o,{md:6,lg:3,children:e.jsx(c,{title:"Empresas",value:n.empresas,icon:b,color:"success",subtitle:"Clientes corporativos"})}),e.jsx(o,{md:6,lg:3,children:e.jsx(c,{title:"Personas",value:n.personas,icon:x,color:"info",subtitle:"Clientes individuales"})}),e.jsx(o,{md:6,lg:3,children:e.jsx(c,{title:"Con Contacto",value:n.conEmail,icon:y,color:"warning",subtitle:"Con email registrado"})})]}),e.jsxs(g,{className:"shadow-sm border-0",children:[e.jsx(g.Header,{className:"bg-white border-bottom",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("h5",{className:"mb-0",children:[e.jsx(p,{className:"me-2 text-primary"}),"Lista de Clientes"]}),e.jsxs(C,{bg:"light",text:"dark",className:"px-3 py-2",children:[n.total," clientes"]})]})}),e.jsx(g.Body,{className:"p-0",children:e.jsx(O,{data:(l==null?void 0:l.companies)||[],columns:T,loading:M,onEdit:I,onDelete:P,emptyMessage:"No hay clientes registrados"})})]}),e.jsx(V,{show:v,onHide:()=>i(!1),title:t!=null&&t.id?"Editar Cliente":"Nuevo Cliente",data:t||N,fields:U,onSubmit:R,loading:j.isLoading||f.isLoading,submitText:t!=null&&t.id?"Actualizar":"Crear"})]})})}export{oe as default};
//# sourceMappingURL=Clientes-Bi2JdRI0.js.map
