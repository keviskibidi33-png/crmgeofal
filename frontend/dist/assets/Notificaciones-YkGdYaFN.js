import{a as H,c as L,u as q,r as w,e as F,x as u,j as e,aH as C,B as l,T as S,C as j,m as I,J as T,b9 as $,ba as J,bb as O,bc as P,bd as V}from"./index-Cuktr-pt.js";import{C as p,R as G}from"./Row-DXxIMG7u.js";import{S as Y}from"./Spinner-B39M6lL3.js";import{A as K}from"./Alert-D03HJGca.js";import{C as U}from"./Col-nNxAn9NL.js";import{C as m}from"./Card-B0ZWfcwD.js";import{M as d}from"./Modal-DX3fBC5J.js";const re=()=>{const{user:n}=H(),t=L(),x=q(),[a,k]=w.useState(null),[M,c]=w.useState(!1),{data:i,isLoading:A,error:N}=F(["notifications-all",n==null?void 0:n.id],()=>V({limit:50,unreadOnly:!1}),{enabled:!!n,refetchInterval:3e4}),f=u(O,{onSuccess:()=>{t.invalidateQueries(["notifications-all"]),t.invalidateQueries(["notifications"]),t.invalidateQueries(["notificationStats"])}}),g=u(J,{onSuccess:()=>{t.invalidateQueries(["notifications-all"]),t.invalidateQueries(["notifications"]),t.invalidateQueries(["notificationStats"])}}),v=u(P,{onSuccess:()=>{t.invalidateQueries(["notifications-all"]),t.invalidateQueries(["notifications"]),t.invalidateQueries(["notificationStats"])}}),y=s=>{f.mutate(s)},E=()=>{g.mutate()},Q=s=>{window.confirm("Â¿EstÃ¡s seguro de que quieres eliminar esta notificaciÃ³n?")&&v.mutate(s)},z=s=>{k(s),c(!0),s.read_at||y(s.id)},R=s=>{if(c(!1),s.type==="project_assignment"&&s.data){const r=typeof s.data=="string"?JSON.parse(s.data):s.data;r.project_id?x(`/proyectos?view=${r.project_id}`):x("/proyectos")}else x("/proyectos")},b=s=>({payment_proof_uploaded:"ðŸ’°",payment_proof_approved:"âœ…",payment_proof_rejected:"âŒ",quote_created:"ðŸ“„",quote_approved:"âœ…",quote_rejected:"âŒ",project_created:"ðŸ—ï¸",project_updated:"ðŸ”„",project_assignment:"ðŸŽ¯",ticket_created:"ðŸŽ«",ticket_updated:"ðŸ”„",system_update:"ðŸ†•"})[s]||"ðŸ””",B=s=>{const r=new Date(s),o=Math.floor((new Date-r)/(1e3*60));if(o<1)return"Ahora";if(o<60)return`Hace ${o} min`;const h=Math.floor(o/60);if(h<24)return`Hace ${h} h`;const _=Math.floor(h/24);return _<7?`Hace ${_} dÃ­as`:r.toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})};if(A)return e.jsx(p,{className:"py-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Y,{animation:"border"}),e.jsx("p",{className:"mt-2",children:"Cargando notificaciones..."})]})});if(N)return e.jsx(p,{className:"py-4",children:e.jsxs(K,{variant:"danger",children:["Error al cargar las notificaciones: ",N.message]})});const D=(i==null?void 0:i.filter(s=>!s.read_at).length)||0;return e.jsxs(p,{className:"py-4",children:[e.jsx(G,{children:e.jsxs(U,{children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[e.jsxs("h2",{className:"mb-0",children:[e.jsx(C,{className:"me-2"}),"Notificaciones"]}),e.jsx("div",{className:"d-flex gap-2",children:D>0&&e.jsxs(l,{variant:"outline-primary",size:"sm",onClick:E,disabled:g.isLoading,children:[e.jsx(S,{className:"me-1"}),"Marcar todas como leÃ­das"]})})]}),(i==null?void 0:i.length)===0?e.jsx(m,{children:e.jsxs(m.Body,{className:"text-center py-5",children:[e.jsx(C,{size:48,className:"text-muted mb-3"}),e.jsx("h5",{className:"text-muted",children:"No hay notificaciones"}),e.jsx("p",{className:"text-muted",children:"Cuando recibas notificaciones, aparecerÃ¡n aquÃ­."})]})}):e.jsx("div",{className:"notification-list",children:i==null?void 0:i.map(s=>e.jsx(m,{className:`mb-3 ${s.read_at?"":"border-primary"}`,children:e.jsx(m.Body,{children:e.jsxs("div",{className:"d-flex align-items-start",children:[e.jsx("div",{className:"me-3",children:e.jsx("span",{className:"fs-4",children:b(s.type)})}),e.jsxs("div",{className:"flex-grow-1",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-start mb-2",children:[e.jsxs("div",{children:[e.jsxs("h6",{className:"mb-1",children:[s.title,!s.read_at&&e.jsx(j,{bg:"primary",className:"ms-2",children:"Nueva"})]}),e.jsx("p",{className:"text-muted mb-2",children:s.message})]}),e.jsx("div",{className:"text-end",children:e.jsx("small",{className:"text-muted",children:B(s.created_at)})})]}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsxs(l,{variant:"outline-primary",size:"sm",onClick:()=>z(s),children:[e.jsx(I,{className:"me-1"}),"Ver detalles"]}),!s.read_at&&e.jsxs(l,{variant:"outline-success",size:"sm",onClick:()=>y(s.id),disabled:f.isLoading,children:[e.jsx(S,{className:"me-1"}),"Marcar como leÃ­da"]}),e.jsxs(l,{variant:"outline-danger",size:"sm",onClick:()=>Q(s.id),disabled:v.isLoading,children:[e.jsx(T,{className:"me-1"}),"Eliminar"]})]})]})]})})},s.id))})]})}),e.jsxs(d,{show:M,onHide:()=>c(!1),size:"md",centered:!0,children:[e.jsx(d.Header,{closeButton:!0,className:"bg-primary text-white",children:e.jsxs(d.Title,{className:"fw-bold",children:[a&&b(a.type),a==null?void 0:a.title]})}),e.jsx(d.Body,{className:"p-3",children:a&&e.jsxs("div",{children:[e.jsxs("div",{className:"alert alert-info mb-3",children:[e.jsx("strong",{children:"ðŸ“ Mensaje:"}),e.jsx("p",{className:"mb-0 mt-2",children:a.message})]}),e.jsxs("div",{className:"row g-2",children:[e.jsx("div",{className:"col-6",children:e.jsxs("div",{className:"bg-light p-2 rounded",children:[e.jsx("small",{className:"text-muted",children:"Tipo"}),e.jsx("div",{className:"fw-bold",children:a.type})]})}),e.jsx("div",{className:"col-6",children:e.jsxs("div",{className:"bg-light p-2 rounded",children:[e.jsx("small",{className:"text-muted",children:"Prioridad"}),e.jsx("div",{className:"fw-bold",children:e.jsx(j,{bg:a.priority==="high"?"danger":"secondary",children:a.priority})})]})}),e.jsx("div",{className:"col-6",children:e.jsxs("div",{className:"bg-light p-2 rounded",children:[e.jsx("small",{className:"text-muted",children:"Fecha"}),e.jsx("div",{className:"fw-bold",style:{fontSize:"12px"},children:new Date(a.created_at).toLocaleString("es-ES")})]})}),e.jsx("div",{className:"col-6",children:e.jsxs("div",{className:"bg-light p-2 rounded",children:[e.jsx("small",{className:"text-muted",children:"Estado"}),e.jsx("div",{className:"fw-bold",children:e.jsx(j,{bg:a.read_at?"success":"warning",children:a.read_at?"LeÃ­da":"No leÃ­da"})})]})})]}),a.data&&e.jsxs("div",{className:"mt-3",children:[e.jsx("small",{className:"text-muted",children:"Datos adicionales:"}),e.jsx("div",{className:"bg-light p-2 rounded mt-1",style:{fontSize:"11px",maxHeight:"100px",overflowY:"auto"},children:e.jsx("pre",{className:"mb-0",children:JSON.stringify(a.data,null,2)})})]})]})}),e.jsx(d.Footer,{className:"p-2",children:e.jsxs("div",{className:"d-flex gap-2 w-100",children:[(a==null?void 0:a.type)==="project_assignment"&&e.jsxs(l,{variant:"primary",onClick:()=>R(a),size:"sm",className:"flex-grow-1",style:{backgroundColor:"#f84616",borderColor:"#f84616"},children:[e.jsx($,{className:"me-1"}),"ðŸŽ¯ Ver Proyecto"]}),e.jsx(l,{variant:"primary",onClick:()=>c(!1),size:"sm",className:(a==null?void 0:a.type)==="project_assignment"?"":"w-100",children:"âœ… Entendido"})]})})]})]})};export{re as default};
//# sourceMappingURL=Notificaciones-YkGdYaFN.js.map
