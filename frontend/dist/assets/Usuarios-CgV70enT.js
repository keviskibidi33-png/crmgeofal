import{r as t,L as T,j as a,M as I,b as g,B as O,O as J,Q as V,t as z,s as $,v as x,G as K}from"./index-DQOtztfR.js";import{u as d}from"./useMutation-CIsAIm9w.js";import{u as W}from"./useQuery-CYOA-NUZ.js";import{P as X,R as Y,C as u}from"./PageHeader-BEMCbyOR.js";import{D as Z}from"./DataTable-GseDfFac.js";import{M as S}from"./ModalForm-yDWh6PbB.js";import{S as m}from"./StatsCard-BNDy4zbf.js";import{l as ee,c as ae,u as se,d as re,r as oe}from"./users-eOA9fOsB.js";import{C as f}from"./Card-ChjpncsD.js";import"./InputGroup-BJLqGG_u.js";const C={name:"",apellido:"",email:"",role:"vendedor_comercial",area:"Comercial",password:""},N=[{value:"admin",label:"Administrador"},{value:"jefa_comercial",label:"Jefa Comercial"},{value:"vendedor_comercial",label:"Vendedor Comercial"},{value:"jefe_laboratorio",label:"Jefe Laboratorio"},{value:"usuario_laboratorio",label:"Usuario Laboratorio"},{value:"laboratorio",label:"Laboratorio"},{value:"soporte",label:"Soporte"},{value:"gerencia",label:"Gerencia"}],te=[{value:"Comercial",label:"Comercial"},{value:"Laboratorio",label:"Laboratorio"},{value:"Sistemas",label:"Sistemas"},{value:"Gerencia",label:"Gerencia"},{value:"Soporte",label:"Soporte"}];function xe(){const[E,i]=t.useState(!1),[s,b]=t.useState(null),[le,M]=t.useState(null),[n,p]=t.useState(null),[h,j]=t.useState(""),L=T(),{data:o,isLoading:R}=W(["users"],()=>ee(),{keepPreviousData:!0}),c=e=>{L.invalidateQueries("users"),i(!1),b(null),M(null),p(null),j("")},v=d(ae,{onSuccess:()=>c(),onError:e=>console.error("Error creating user:",e)}),w=d(se,{onSuccess:()=>c(),onError:e=>console.error("Error updating user:",e)}),U=d(re,{onSuccess:()=>c(),onError:e=>console.error("Error deleting user:",e)}),y=d(oe,{onSuccess:()=>c(),onError:e=>console.error("Error resetting password:",e)}),_=()=>{b(C),i(!0)},q=e=>{b(e),i(!0)},P=e=>{window.confirm(`¿Estás seguro de que quieres eliminar al usuario ${e.name}?`)&&U.mutate(e.id)},F=e=>{p(e),j("")},A=async e=>{s.id?await w.mutateAsync({id:s.id,...e}):await v.mutateAsync(e)},k=async()=>{h&&n&&await y.mutateAsync({id:n.id,password:h})},D=e=>({admin:"danger",jefa_comercial:"warning",vendedor_comercial:"primary",jefe_laboratorio:"info",usuario_laboratorio:"secondary",laboratorio:"secondary",soporte:"success",gerencia:"dark"})[e]||"secondary",B=e=>{const r=N.find(Q=>Q.value===e);return r?r.label:e},G=[{header:"ID",accessor:"id",width:"80px"},{header:"Nombre",accessor:"name",render:(e,r)=>a.jsxs("div",{children:[a.jsxs("div",{className:"fw-medium",children:[r.name," ",r.apellido]}),a.jsx("small",{className:"text-muted",children:r.email})]})},{header:"Rol",accessor:"role",render:e=>a.jsx(x,{bg:D(e),className:"status-badge",children:B(e)})},{header:"Área",accessor:"area",render:e=>a.jsx(x,{bg:"light",text:"dark",className:"status-badge",children:e})},{header:"Fecha Creación",accessor:"created_at",type:"date"}],H=[{name:"name",label:"Nombre",type:"text",required:!0,placeholder:"Ingresa el nombre"},{name:"apellido",label:"Apellido",type:"text",required:!0,placeholder:"Ingresa el apellido"},{name:"email",label:"Email",type:"email",required:!0,placeholder:"usuario@ejemplo.com"},{name:"role",label:"Rol",type:"select",required:!0,options:N},{name:"area",label:"Área",type:"select",required:!0,options:te},{name:"password",label:"Contraseña",type:"password",required:!(s!=null&&s.id),placeholder:"Mínimo 6 caracteres",help:s!=null&&s.id?"Dejar vacío para mantener la contraseña actual":"Mínimo 6 caracteres"}],l=t.useMemo(()=>{const e=(o==null?void 0:o.users)||[];return{total:e.length,admins:e.filter(r=>r.role==="admin").length,vendedores:e.filter(r=>r.role==="vendedor_comercial").length,laboratorio:e.filter(r=>["jefe_laboratorio","usuario_laboratorio","laboratorio"].includes(r.role)).length,activos:e.filter(r=>r.active!==!1).length}},[o]);return a.jsx(I,{fluid:!0,className:"py-4",children:a.jsxs("div",{className:"fade-in",children:[a.jsx(X,{title:"Gestión de Usuarios",subtitle:"Crear, editar, eliminar y gestionar usuarios del sistema",icon:g,actions:a.jsxs(O,{variant:"primary",onClick:_,children:[a.jsx(J,{className:"me-2"}),"Nuevo Usuario"]})}),a.jsxs(Y,{className:"g-4 mb-4",children:[a.jsx(u,{md:6,lg:3,children:a.jsx(m,{title:"Total Usuarios",value:l.total,icon:g,color:"primary",subtitle:"Usuarios registrados"})}),a.jsx(u,{md:6,lg:3,children:a.jsx(m,{title:"Administradores",value:l.admins,icon:V,color:"danger",subtitle:"Usuarios con privilegios"})}),a.jsx(u,{md:6,lg:3,children:a.jsx(m,{title:"Vendedores",value:l.vendedores,icon:z,color:"success",subtitle:"Equipo comercial"})}),a.jsx(u,{md:6,lg:3,children:a.jsx(m,{title:"Laboratorio",value:l.laboratorio,icon:$,color:"info",subtitle:"Personal técnico"})})]}),a.jsxs(f,{className:"shadow-sm border-0",children:[a.jsx(f.Header,{className:"bg-white border-bottom",children:a.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[a.jsxs("h5",{className:"mb-0",children:[a.jsx(g,{className:"me-2 text-primary"}),"Lista de Usuarios"]}),a.jsxs(x,{bg:"light",text:"dark",className:"px-3 py-2",children:[l.total," usuarios"]})]})}),a.jsx(f.Body,{className:"p-0",children:a.jsx(Z,{data:(o==null?void 0:o.users)||[],columns:G,loading:R,onEdit:q,onDelete:P,emptyMessage:"No hay usuarios registrados",actions:[{label:"Restablecer Contraseña",icon:K,onClick:F,variant:"outline-warning"}]})})]}),a.jsx(S,{show:E,onHide:()=>i(!1),title:s!=null&&s.id?"Editar Usuario":"Nuevo Usuario",data:s||C,fields:H,onSubmit:A,loading:v.isLoading||w.isLoading,submitText:s!=null&&s.id?"Actualizar":"Crear"}),n&&a.jsx(S,{show:!!n,onHide:()=>p(null),title:"Restablecer Contraseña",data:{password:h},fields:[{name:"password",label:"Nueva Contraseña",type:"password",required:!0,placeholder:"Mínimo 6 caracteres"}],onSubmit:k,loading:y.isLoading,submitText:"Restablecer"})]})})}export{xe as default};
//# sourceMappingURL=Usuarios-CgV70enT.js.map
