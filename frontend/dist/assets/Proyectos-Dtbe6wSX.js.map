{"version":3,"file":"Proyectos-Dtbe6wSX.js","sources":["../../src/components/common/ModalForm.jsx","../../src/components/ServiceSelection.jsx","../../src/components/ProjectServiceForm.jsx","../../src/services/companySearch.js","../../src/components/ProjectFormRedesigned.jsx","../../src/pages/Proyectos.jsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { Modal, Form, Button, Row, Col, Alert, Spinner } from 'react-bootstrap';\r\nimport { FiSave, FiX } from 'react-icons/fi';\r\nimport '../../styles/autocomplete.css';\r\n\r\nconst ModalForm = ({\r\n  show,\r\n  onHide,\r\n  title,\r\n  data = {},\r\n  fields = [],\r\n  onSubmit,\r\n  loading = false,\r\n  size = 'lg',\r\n  submitText = 'Guardar',\r\n  cancelText = 'Cancelar',\r\n  validation = {},\r\n  className = \"\"\r\n}) => {\r\n  const [formData, setFormData] = useState({});\r\n  const [errors, setErrors] = useState({});\r\n  const [touched, setTouched] = useState({});\r\n  const [suggestions, setSuggestions] = useState({});\r\n  const [showSuggestions, setShowSuggestions] = useState({});\r\n\r\n  useEffect(() => {\r\n    if (show) {\r\n      setFormData(data);\r\n      setErrors({});\r\n      setTouched({});\r\n    }\r\n  }, [show, data]);\r\n\r\n  const handleInputChange = (name, value) => {\r\n    setFormData(prev => ({\r\n      ...prev,\r\n      [name]: value\r\n    }));\r\n\r\n    // Limpiar error cuando el usuario empieza a escribir\r\n    if (errors[name]) {\r\n      setErrors(prev => ({\r\n        ...prev,\r\n        [name]: null\r\n      }));\r\n    }\r\n\r\n    // Manejar autocompletado\r\n    const field = fields.find(f => f.name === name);\r\n    if (field && field.autocomplete && field.suggestions && value.length > 0) {\r\n      const filteredSuggestions = field.suggestions.filter(suggestion =>\r\n        suggestion.toLowerCase().includes(value.toLowerCase())\r\n      );\r\n      setSuggestions(prev => ({\r\n        ...prev,\r\n        [name]: filteredSuggestions.slice(0, 5) // Mostrar m√°ximo 5 sugerencias\r\n      }));\r\n      setShowSuggestions(prev => ({\r\n        ...prev,\r\n        [name]: true\r\n      }));\r\n    } else {\r\n      setShowSuggestions(prev => ({\r\n        ...prev,\r\n        [name]: false\r\n      }));\r\n    }\r\n  };\r\n\r\n  const handleBlur = (name) => {\r\n    setTouched(prev => ({\r\n      ...prev,\r\n      [name]: true\r\n    }));\r\n\r\n    // Ocultar sugerencias al perder el foco\r\n    setTimeout(() => {\r\n      setShowSuggestions(prev => ({\r\n        ...prev,\r\n        [name]: false\r\n      }));\r\n    }, 200);\r\n\r\n    // Validar campo\r\n    if (validation[name]) {\r\n      const error = validation[name](formData[name], formData);\r\n      if (error) {\r\n        setErrors(prev => ({\r\n          ...prev,\r\n          [name]: error\r\n        }));\r\n      }\r\n    }\r\n  };\r\n\r\n  const handleSuggestionClick = (name, suggestion) => {\r\n    setFormData(prev => ({\r\n      ...prev,\r\n      [name]: suggestion\r\n    }));\r\n    setShowSuggestions(prev => ({\r\n      ...prev,\r\n      [name]: false\r\n    }));\r\n  };\r\n\r\n  const validateForm = () => {\r\n    const newErrors = {};\r\n    let isValid = true;\r\n\r\n    fields.forEach(field => {\r\n      if (field.required && (!formData[field.name] || formData[field.name] === '')) {\r\n        newErrors[field.name] = `${field.label} es requerido`;\r\n        isValid = false;\r\n      } else if (validation[field.name]) {\r\n        const error = validation[field.name](formData[field.name], formData);\r\n        if (error) {\r\n          newErrors[field.name] = error;\r\n          isValid = false;\r\n        }\r\n      }\r\n    });\r\n\r\n    setErrors(newErrors);\r\n    return isValid;\r\n  };\r\n\r\n  const handleSubmit = async (e) => {\r\n    e.preventDefault();\r\n    \r\n    if (validateForm()) {\r\n      try {\r\n        await onSubmit(formData);\r\n        onHide();\r\n      } catch (error) {\r\n        console.error('Error submitting form:', error);\r\n      }\r\n    }\r\n  };\r\n\r\n  const renderField = (field) => {\r\n    const hasError = touched[field.name] && errors[field.name];\r\n    const value = formData[field.name] || '';\r\n\r\n    switch (field.type) {\r\n      case 'text':\r\n      case 'email':\r\n      case 'password':\r\n        return (\r\n          <Form.Group key={field.name} className=\"mb-3 position-relative\">\r\n            <Form.Label>\r\n              {field.label}\r\n              {field.required && <span className=\"text-danger ms-1\">*</span>}\r\n            </Form.Label>\r\n            <Form.Control\r\n              type={field.type}\r\n              name={field.name}\r\n              value={value}\r\n              onChange={(e) => handleInputChange(field.name, e.target.value)}\r\n              onBlur={() => handleBlur(field.name)}\r\n              isInvalid={hasError}\r\n              placeholder={field.placeholder}\r\n              disabled={field.disabled}\r\n            />\r\n            {hasError && (\r\n              <Form.Control.Feedback type=\"invalid\">\r\n                {errors[field.name]}\r\n              </Form.Control.Feedback>\r\n            )}\r\n            {field.help && (\r\n              <Form.Text className=\"text-muted\">\r\n                {field.help}\r\n              </Form.Text>\r\n            )}\r\n            {/* Sugerencias de autocompletado */}\r\n            {field.autocomplete && showSuggestions[field.name] && suggestions[field.name] && suggestions[field.name].length > 0 && (\r\n              <div className=\"autocomplete-suggestions position-absolute w-100\" style={{ zIndex: 1000, top: '100%' }}>\r\n                <div className=\"list-group\">\r\n                  {suggestions[field.name].map((suggestion, index) => (\r\n                    <button\r\n                      key={index}\r\n                      type=\"button\"\r\n                      className=\"list-group-item list-group-item-action\"\r\n                      onClick={() => handleSuggestionClick(field.name, suggestion)}\r\n                      style={{ fontSize: '0.875rem', padding: '0.5rem 0.75rem' }}\r\n                    >\r\n                      {suggestion}\r\n                    </button>\r\n                  ))}\r\n                </div>\r\n              </div>\r\n            )}\r\n          </Form.Group>\r\n        );\r\n\r\n      case 'textarea':\r\n        return (\r\n          <Form.Group key={field.name} className=\"mb-3\">\r\n            <Form.Label>\r\n              {field.label}\r\n              {field.required && <span className=\"text-danger ms-1\">*</span>}\r\n            </Form.Label>\r\n            <Form.Control\r\n              as=\"textarea\"\r\n              rows={field.rows || 3}\r\n              name={field.name}\r\n              value={value}\r\n              onChange={(e) => handleInputChange(field.name, e.target.value)}\r\n              onBlur={() => handleBlur(field.name)}\r\n              isInvalid={hasError}\r\n              placeholder={field.placeholder}\r\n            />\r\n            {hasError && (\r\n              <Form.Control.Feedback type=\"invalid\">\r\n                {errors[field.name]}\r\n              </Form.Control.Feedback>\r\n            )}\r\n          </Form.Group>\r\n        );\r\n\r\n      case 'select':\r\n        return (\r\n          <Form.Group key={field.name} className=\"mb-3\">\r\n            <Form.Label>\r\n              {field.label}\r\n              {field.required && <span className=\"text-danger ms-1\">*</span>}\r\n            </Form.Label>\r\n            <Form.Select\r\n              name={field.name}\r\n              value={value}\r\n              onChange={(e) => handleInputChange(field.name, e.target.value)}\r\n              onBlur={() => handleBlur(field.name)}\r\n              isInvalid={hasError}\r\n            >\r\n              <option value=\"\">Seleccionar...</option>\r\n              {field.options?.map(option => (\r\n                <option key={option.value} value={option.value}>\r\n                  {option.label}\r\n                </option>\r\n              ))}\r\n            </Form.Select>\r\n            {hasError && (\r\n              <Form.Control.Feedback type=\"invalid\">\r\n                {errors[field.name]}\r\n              </Form.Control.Feedback>\r\n            )}\r\n          </Form.Group>\r\n        );\r\n\r\n      case 'number':\r\n        return (\r\n          <Form.Group key={field.name} className=\"mb-3\">\r\n            <Form.Label>\r\n              {field.label}\r\n              {field.required && <span className=\"text-danger ms-1\">*</span>}\r\n            </Form.Label>\r\n            <Form.Control\r\n              type=\"number\"\r\n              name={field.name}\r\n              value={value}\r\n              onChange={(e) => handleInputChange(field.name, parseFloat(e.target.value) || '')}\r\n              onBlur={() => handleBlur(field.name)}\r\n              isInvalid={hasError}\r\n              placeholder={field.placeholder}\r\n              min={field.min}\r\n              max={field.max}\r\n              step={field.step}\r\n            />\r\n            {hasError && (\r\n              <Form.Control.Feedback type=\"invalid\">\r\n                {errors[field.name]}\r\n              </Form.Control.Feedback>\r\n            )}\r\n          </Form.Group>\r\n        );\r\n\r\n      case 'checkbox':\r\n        return (\r\n          <Form.Group key={field.name} className=\"mb-3\">\r\n            <Form.Check\r\n              type=\"checkbox\"\r\n              name={field.name}\r\n              checked={!!value}\r\n              onChange={(e) => handleInputChange(field.name, e.target.checked)}\r\n              label={field.label}\r\n            />\r\n          </Form.Group>\r\n        );\r\n\r\n      case 'custom':\r\n        return (\r\n          <div key={field.name} className=\"mb-3\">\r\n            {field.render && field.render(formData)}\r\n          </div>\r\n        );\r\n\r\n      default:\r\n        return null;\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Modal show={show} onHide={onHide} size={size} className={className}>\r\n      <Modal.Header closeButton className=\"border-0 pb-0\">\r\n        <Modal.Title className=\"fw-bold\">{title}</Modal.Title>\r\n      </Modal.Header>\r\n      \r\n      <Form onSubmit={handleSubmit}>\r\n        <Modal.Body className=\"pt-0\">\r\n          <Row>\r\n            {fields.map(field => (\r\n              <Col key={field.name} md={field.col || 12}>\r\n                {renderField(field)}\r\n              </Col>\r\n            ))}\r\n          </Row>\r\n        </Modal.Body>\r\n        \r\n        <Modal.Footer className=\"border-0 pt-0\">\r\n          <Button \r\n            variant=\"outline-secondary\" \r\n            onClick={onHide}\r\n            disabled={loading}\r\n          >\r\n            <FiX className=\"me-1\" />\r\n            {cancelText}\r\n          </Button>\r\n          \r\n          <Button \r\n            type=\"submit\" \r\n            variant=\"primary\"\r\n            disabled={loading}\r\n          >\r\n            {loading ? (\r\n              <>\r\n                <Spinner size=\"sm\" className=\"me-1\" />\r\n                Guardando...\r\n              </>\r\n            ) : (\r\n              <>\r\n                <FiSave className=\"me-1\" />\r\n                {submitText}\r\n              </>\r\n            )}\r\n          </Button>\r\n        </Modal.Footer>\r\n      </Form>\r\n    </Modal>\r\n  );\r\n};\r\n\r\nexport default ModalForm;\r\n","import React, { useState, useEffect } from 'react';\r\nimport { Card, Row, Col, Form, Button, Badge, Spinner, Alert } from 'react-bootstrap';\r\nimport { FiCheck, FiX, FiSearch, FiFilter, FiClock, FiDollarSign } from 'react-icons/fi';\r\nimport { useQuery } from 'react-query';\r\nimport { listServices, listSubservices } from '../services/services';\r\n\r\nexport default function ServiceSelection({ \r\n  selectedServices = [], \r\n  onServicesChange\r\n}) {\r\n  const [searchTerm, setSearchTerm] = useState('');\r\n  const [selectedEnsayo, setSelectedEnsayo] = useState(null);\r\n  const [selectedSubservices, setSelectedSubservices] = useState([]);\r\n\r\n  // Obtener todos los servicios (sin filtro de tipo)\r\n  const { data: servicesData, isLoading: isLoadingServices } = useQuery(\r\n    ['services'],\r\n    () => listServices({}),\r\n    {\r\n      staleTime: 5 * 60 * 1000, // 5 minutos\r\n      cacheTime: 10 * 60 * 1000, // 10 minutos\r\n    }\r\n  );\r\n\r\n  // Obtener subservicios cuando se selecciona un ensayo\r\n  const { data: subservicesData, isLoading: isLoadingSubservices } = useQuery(\r\n    ['subservices', selectedEnsayo?.id],\r\n    () => selectedEnsayo ? listSubservices({ service_id: selectedEnsayo.id }) : null,\r\n    {\r\n      enabled: !!selectedEnsayo,\r\n      staleTime: 5 * 60 * 1000,\r\n      cacheTime: 10 * 60 * 1000,\r\n    }\r\n  );\r\n\r\n  const services = servicesData?.data || servicesData?.rows || [];\r\n  const subservices = subservicesData?.data || subservicesData?.rows || [];\r\n\r\n  // Filtrar servicios por t√©rmino de b√∫squeda\r\n  const filteredServices = services.filter(service =>\r\n    service.name?.toLowerCase().includes(searchTerm.toLowerCase()) ||\r\n    service.description?.toLowerCase().includes(searchTerm.toLowerCase())\r\n  );\r\n\r\n  // Manejar selecci√≥n de ensayo\r\n  const handleEnsayoSelect = (ensayo) => {\r\n    // Verificar si ya est√° seleccionado\r\n    const isAlreadySelected = selectedServices.some(service => service.ensayo.id === ensayo.id);\r\n    \r\n    if (isAlreadySelected) {\r\n      // Si ya est√° seleccionado, no hacer nada\r\n      return;\r\n    }\r\n    \r\n    // Verificar l√≠mite m√°ximo (5 servicios)\r\n    if (selectedServices.length >= 5) {\r\n      alert('M√°ximo 5 servicios pueden ser seleccionados');\r\n      return;\r\n    }\r\n    \r\n    setSelectedEnsayo(ensayo);\r\n    setSelectedSubservices([]);\r\n  };\r\n\r\n  // Manejar selecci√≥n de subservicios\r\n  const handleSubserviceToggle = (subservice) => {\r\n    const isSelected = selectedSubservices.some(s => s.id === subservice.id);\r\n    if (isSelected) {\r\n      setSelectedSubservices(prev => prev.filter(s => s.id !== subservice.id));\r\n    } else {\r\n      setSelectedSubservices(prev => [...prev, subservice]);\r\n    }\r\n  };\r\n\r\n  // Confirmar selecci√≥n\r\n  const handleConfirmSelection = () => {\r\n    if (selectedEnsayo && selectedSubservices.length > 0) {\r\n      const newService = {\r\n        ensayo: selectedEnsayo,\r\n        subservices: selectedSubservices,\r\n        total: selectedSubservices.reduce((sum, sub) => sum + (sub.precio || 0), 0)\r\n      };\r\n      \r\n      onServicesChange([...selectedServices, newService]);\r\n      setSelectedEnsayo(null);\r\n      setSelectedSubservices([]);\r\n    }\r\n  };\r\n\r\n  // Eliminar servicio seleccionado\r\n  const handleRemoveService = (index) => {\r\n    const newServices = selectedServices.filter((_, i) => i !== index);\r\n    onServicesChange(newServices);\r\n  };\r\n\r\n  return (\r\n    <div className=\"service-selection\">\r\n      <Card className=\"mb-4\">\r\n        <Card.Header>\r\n          <div className=\"d-flex justify-content-between align-items-center\">\r\n            <h6 className=\"mb-0\">\r\n              <FiFilter className=\"me-2\" />\r\n              Selecci√≥n de Servicios\r\n            </h6>\r\n            <div className=\"d-flex align-items-center gap-2\">\r\n              <Badge bg=\"info\">\r\n                {selectedServices.length}/5 seleccionados\r\n              </Badge>\r\n              {selectedServices.length > 0 && (\r\n                <Button \r\n                  variant=\"outline-danger\" \r\n                  size=\"sm\"\r\n                  onClick={() => onServicesChange([])}\r\n                >\r\n                  <FiX size={12} className=\"me-1\" />\r\n                  Limpiar\r\n                </Button>\r\n              )}\r\n            </div>\r\n          </div>\r\n        </Card.Header>\r\n        <Card.Body>\r\n          {/* B√∫squeda */}\r\n          <div className=\"mb-3\">\r\n            <Form.Control\r\n              type=\"text\"\r\n              placeholder=\"Buscar servicios...\"\r\n              value={searchTerm}\r\n              onChange={(e) => setSearchTerm(e.target.value)}\r\n            />\r\n          </div>\r\n\r\n          {/* Lista de servicios/ensayos */}\r\n          {isLoadingServices ? (\r\n            <div className=\"text-center py-4\">\r\n              <Spinner animation=\"border\" variant=\"primary\" />\r\n              <p className=\"mt-2 text-muted\">Cargando servicios...</p>\r\n            </div>\r\n          ) : (\r\n            <Row className=\"g-3\">\r\n              {filteredServices.map((service) => {\r\n                const isSelected = selectedServices.some(s => s.ensayo.id === service.id);\r\n                const isCurrentlySelected = selectedEnsayo?.id === service.id;\r\n                \r\n                return (\r\n                  <Col md={6} lg={4} key={service.id}>\r\n                    <Card \r\n                      className={`h-100 cursor-pointer ${\r\n                        isSelected ? 'border-success' : \r\n                        isCurrentlySelected ? 'border-primary' : ''\r\n                      } ${isSelected ? 'bg-light text-dark' : ''}`}\r\n                      onClick={() => handleEnsayoSelect(service)}\r\n                    >\r\n                      <Card.Body>\r\n                        <div className=\"d-flex justify-content-between align-items-start mb-2\">\r\n                          <h6 className=\"mb-1\">{service.name}</h6>\r\n                          {isSelected ? (\r\n                            <Badge bg=\"success\">\r\n                              <FiCheck size={14} />\r\n                            </Badge>\r\n                          ) : isCurrentlySelected ? (\r\n                            <Badge bg=\"primary\">\r\n                              <FiCheck size={14} />\r\n                            </Badge>\r\n                          ) : null}\r\n                        </div>\r\n                        <p className=\"text-muted small mb-2\">\r\n                          {service.description || 'Sin descripci√≥n'}\r\n                        </p>\r\n                        <div className=\"d-flex justify-content-between align-items-center\">\r\n                          <small className=\"text-muted\">\r\n                            <FiClock className=\"me-1\" size={12} />\r\n                            {service.norma || 'N/A'}\r\n                          </small>\r\n                          <Badge bg={service.subservices_count > 0 ? 'info' : 'secondary'}>\r\n                            {service.subservices_count || 0} subservicios\r\n                          </Badge>\r\n                        </div>\r\n                      </Card.Body>\r\n                    </Card>\r\n                  </Col>\r\n                );\r\n              })}\r\n            </Row>\r\n          )}\r\n\r\n          {/* Subservicios del ensayo seleccionado */}\r\n          {selectedEnsayo && (\r\n            <Card className=\"mt-4 border-primary\">\r\n              <Card.Header>\r\n                <h6 className=\"mb-0\">\r\n                  Subservicios de: {selectedEnsayo.name}\r\n                </h6>\r\n              </Card.Header>\r\n              <Card.Body>\r\n                {isLoadingSubservices ? (\r\n                  <div className=\"text-center py-3\">\r\n                    <Spinner animation=\"border\" size=\"sm\" variant=\"primary\" />\r\n                    <p className=\"mt-2 text-muted small\">Cargando subservicios...</p>\r\n                  </div>\r\n                ) : subservices.length > 0 ? (\r\n                  <Row className=\"g-2\">\r\n                    {subservices.map((subservice) => {\r\n                      const isSelected = selectedSubservices.some(s => s.id === subservice.id);\r\n                      return (\r\n                        <Col md={6} lg={4} key={subservice.id}>\r\n                          <Card \r\n                            className={`h-100 cursor-pointer ${isSelected ? 'border-success' : ''}`}\r\n                            onClick={() => handleSubserviceToggle(subservice)}\r\n                          >\r\n                            <Card.Body className=\"p-3\">\r\n                              <div className=\"d-flex justify-content-between align-items-start mb-2\">\r\n                                <h6 className=\"mb-1 small\">{subservice.codigo}</h6>\r\n                                {isSelected && (\r\n                                  <Badge bg=\"success\">\r\n                                    <FiCheck size={12} />\r\n                                  </Badge>\r\n                                )}\r\n                              </div>\r\n                              <p className=\"text-muted small mb-2\">\r\n                                {subservice.descripcion}\r\n                              </p>\r\n                              <div className=\"d-flex justify-content-between align-items-center\">\r\n                                <small className=\"text-muted\">\r\n                                  {subservice.norma || '-'}\r\n                                </small>\r\n                                <Badge bg={subservice.precio > 0 ? 'success' : 'warning'}>\r\n                                  <FiDollarSign className=\"me-1\" size={10} />\r\n                                  {subservice.precio > 0 ? `S/ ${subservice.precio}` : 'Sujeto a evaluaci√≥n'}\r\n                                </Badge>\r\n                              </div>\r\n                            </Card.Body>\r\n                          </Card>\r\n                        </Col>\r\n                      );\r\n                    })}\r\n                  </Row>\r\n                ) : (\r\n                  <Alert variant=\"info\" className=\"mb-0\">\r\n                    No hay subservicios disponibles para este servicio.\r\n                  </Alert>\r\n                )}\r\n\r\n                {/* Bot√≥n de confirmaci√≥n */}\r\n                {selectedSubservices.length > 0 && (\r\n                  <div className=\"mt-3 text-center\">\r\n                    <Button \r\n                      variant=\"success\" \r\n                      onClick={handleConfirmSelection}\r\n                      disabled={selectedSubservices.length === 0}\r\n                    >\r\n                      <FiCheck className=\"me-1\" />\r\n                      Agregar {selectedSubservices.length} subservicio(s) seleccionado(s)\r\n                    </Button>\r\n                  </div>\r\n                )}\r\n              </Card.Body>\r\n            </Card>\r\n          )}\r\n        </Card.Body>\r\n      </Card>\r\n\r\n      {/* Servicios seleccionados */}\r\n      {selectedServices.length > 0 && (\r\n        <Card className=\"border-success\">\r\n          <Card.Header>\r\n            <h6 className=\"mb-0 text-success\">\r\n              <FiCheck className=\"me-2\" />\r\n              Servicios Seleccionados ({selectedServices.length})\r\n            </h6>\r\n          </Card.Header>\r\n          <Card.Body>\r\n            {selectedServices.map((service, index) => (\r\n              <Card key={index} className=\"mb-3\">\r\n                <Card.Body>\r\n                  <div className=\"d-flex justify-content-between align-items-start\">\r\n                    <div>\r\n                      <h6 className=\"mb-1\">{service.ensayo.name}</h6>\r\n                      <p className=\"text-muted small mb-2\">{service.ensayo.description}</p>\r\n                      <div className=\"d-flex flex-wrap gap-1\">\r\n                        {service.subservices.map((sub, subIndex) => (\r\n                          <Badge key={subIndex} bg=\"info\" className=\"me-1\">\r\n                            {sub.codigo}\r\n                          </Badge>\r\n                        ))}\r\n                      </div>\r\n                    </div>\r\n                    <div className=\"text-end\">\r\n                      <h6 className=\"text-success mb-1\">\r\n                        S/ {service.total.toFixed(2)}\r\n                      </h6>\r\n                      <Button \r\n                        variant=\"outline-danger\" \r\n                        size=\"sm\"\r\n                        onClick={() => handleRemoveService(index)}\r\n                      >\r\n                        <FiX size={14} />\r\n                      </Button>\r\n                    </div>\r\n                  </div>\r\n                </Card.Body>\r\n              </Card>\r\n            ))}\r\n          </Card.Body>\r\n        </Card>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","import React from 'react';\r\nimport { Card, Alert } from 'react-bootstrap';\r\nimport { FiSettings, FiHome, FiCheck } from 'react-icons/fi';\r\nimport ServiceSelection from './ServiceSelection';\r\n\r\nexport default function ProjectServiceForm({ \r\n  onServicesChange, \r\n  selectedServices = []\r\n}) {\r\n  const handleServicesChange = (services) => {\r\n    onServicesChange(services);\r\n  };\r\n\r\n  return (\r\n    <Card className=\"mb-4\">\r\n      <Card.Header>\r\n        <h6 className=\"mb-0\">\r\n          <FiSettings className=\"me-2\" />\r\n          Configuraci√≥n de Servicios del Proyecto\r\n        </h6>\r\n      </Card.Header>\r\n      <Card.Body>\r\n        {/* Informaci√≥n sobre la selecci√≥n */}\r\n        <Alert variant=\"info\" className=\"mb-4\">\r\n          <FiHome className=\"me-2\" />\r\n          <div>\r\n            <strong>Servicios:</strong> Selecciona los servicios que necesitas para este proyecto.\r\n            <br />\r\n            <small className=\"text-muted\">\r\n              Puedes elegir entre diferentes tipos de servicios (Laboratorio, Ingenier√≠a, etc.) \r\n              y sus subservicios correspondientes. M√°ximo 5 servicios.\r\n            </small>\r\n          </div>\r\n        </Alert>\r\n\r\n        {/* Componente de selecci√≥n de servicios */}\r\n        <ServiceSelection\r\n          selectedServices={selectedServices}\r\n          onServicesChange={handleServicesChange}\r\n        />\r\n\r\n        {/* Resumen de servicios seleccionados */}\r\n        {selectedServices.length > 0 && (\r\n          <Card className=\"border-success mt-4\">\r\n            <Card.Header>\r\n              <h6 className=\"mb-0 text-success\">\r\n                <FiCheck className=\"me-2\" />\r\n                Resumen de Servicios Seleccionados\r\n              </h6>\r\n            </Card.Header>\r\n            <Card.Body>\r\n              <div className=\"row\">\r\n                <div className=\"col-md-6\">\r\n                  <div className=\"mb-2\">\r\n                    <strong>Total de Servicios:</strong> {selectedServices.length}\r\n                  </div>\r\n                  <div className=\"mb-2\">\r\n                    <strong>Total de Subservicios:</strong> {selectedServices.reduce((sum, service) => sum + service.subservices.length, 0)}\r\n                  </div>\r\n                </div>\r\n                <div className=\"col-md-6\">\r\n                  <div className=\"mb-2\">\r\n                    <strong>Subtotal:</strong> S/ {selectedServices.reduce((sum, service) => sum + service.total, 0).toFixed(2)}\r\n                  </div>\r\n                  <div className=\"mb-2\">\r\n                    <strong>IGV (18%):</strong> S/ {(selectedServices.reduce((sum, service) => sum + service.total, 0) * 0.18).toFixed(2)}\r\n                  </div>\r\n                  <div className=\"fw-bold text-success\">\r\n                    <strong>Total:</strong> S/ {(selectedServices.reduce((sum, service) => sum + service.total, 0) * 1.18).toFixed(2)}\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </Card.Body>\r\n          </Card>\r\n        )}\r\n      </Card.Body>\r\n    </Card>\r\n  );\r\n}","import apiFetch from './api';\r\n\r\n// Buscar empresas/personas por tipo y t√©rmino\r\nexport const searchCompanies = async (type, searchTerm) => {\r\n  try {\r\n    const params = new URLSearchParams({\r\n      type,\r\n      q: searchTerm\r\n    });\r\n    \r\n    const response = await apiFetch(`/companies/search?${params.toString()}`);\r\n    return response;\r\n  } catch (error) {\r\n    console.error('Error en b√∫squeda de empresas:', error);\r\n    throw error;\r\n  }\r\n};\r\n\r\nexport default {\r\n  searchCompanies\r\n};\r\n","import React, { useState, useEffect } from 'react';\r\nimport { Card, Row, Col, Form, Button, Alert, Badge, ProgressBar } from 'react-bootstrap';\r\nimport { \r\n  FiUser, FiMapPin, FiMail, FiPhone, FiMessageSquare, FiSettings, \r\n  FiCheck, FiX, FiPlus, FiEdit, FiTrash2, FiDollarSign, FiClock,\r\n  FiHome, FiTool, FiBookOpen, FiShield, FiCheckCircle, FiAlertTriangle\r\n} from 'react-icons/fi';\r\nimport { searchCompanies } from '../services/companySearch';\r\n\r\nexport default function ProjectFormRedesigned({ \r\n  data = {}, \r\n  onSubmit, \r\n  loading = false,\r\n  onCancel \r\n}) {\r\n  const [formData, setFormData] = useState({\r\n    // Tipo de cliente\r\n    clientType: '', // 'empresa' o 'persona_natural'\r\n    client_id: '',\r\n    client_name: '',\r\n    client_info: {},\r\n    \r\n    // Datos del proyecto\r\n    name: '',\r\n    location: '',\r\n    vendedor_id: '',\r\n    laboratorio_id: '',\r\n    contact_name: '',\r\n    contact_phone: '',\r\n    contact_email: '',\r\n    priority: 'normal',\r\n    marked: false,\r\n    \r\n    // Requisitos del proyecto\r\n    requiere_laboratorio: false,\r\n    requiere_ingenieria: false,\r\n    requiere_capacitacion: false\r\n  });\r\n\r\n  const [currentStep, setCurrentStep] = useState(1);\r\n  const [errors, setErrors] = useState({});\r\n  \r\n  // Estados para b√∫squeda inteligente\r\n  const [searchTerm, setSearchTerm] = useState('');\r\n  const [searchResults, setSearchResults] = useState([]);\r\n  const [isSearching, setIsSearching] = useState(false);\r\n  const [showSearchResults, setShowSearchResults] = useState(false);\r\n  const [autoDetectedClient, setAutoDetectedClient] = useState(null);\r\n\r\n  const totalSteps = 4;\r\n\r\n  useEffect(() => {\r\n    if (data) {\r\n      setFormData(prev => ({\r\n        ...prev,\r\n        ...data\r\n      }));\r\n    }\r\n  }, [data]);\r\n\r\n  const handleInputChange = (field, value) => {\r\n    setFormData(prev => ({\r\n      ...prev,\r\n      [field]: value\r\n    }));\r\n    \r\n    // Limpiar error del campo\r\n    if (errors[field]) {\r\n      setErrors(prev => ({\r\n        ...prev,\r\n        [field]: null\r\n      }));\r\n    }\r\n  };\r\n\r\n\r\n  // B√∫squeda inteligente de clientes\r\n  const handleSearch = async (searchTerm) => {\r\n    console.log('üîç handleSearch - Iniciando b√∫squeda:', { searchTerm, clientType: formData.clientType });\r\n    \r\n    if (!searchTerm || searchTerm.length < 2) {\r\n      console.log('üîç handleSearch - T√©rmino muy corto, cancelando b√∫squeda');\r\n      setSearchResults([]);\r\n      setShowSearchResults(false);\r\n      return;\r\n    }\r\n\r\n    if (!formData.clientType) {\r\n      console.log('üîç handleSearch - No hay tipo de cliente seleccionado');\r\n      setSearchResults([]);\r\n      setShowSearchResults(false);\r\n      return;\r\n    }\r\n\r\n    setIsSearching(true);\r\n    try {\r\n      console.log('üîç handleSearch - Llamando a searchCompanies...');\r\n      const response = await searchCompanies(formData.clientType, searchTerm);\r\n      console.log('üîç handleSearch - Respuesta recibida:', response);\r\n      \r\n      if (response.success) {\r\n        const results = response.data || [];\r\n        console.log('üîç handleSearch - Resultados encontrados:', results.length);\r\n        setSearchResults(results);\r\n        setShowSearchResults(true);\r\n        \r\n        // Auto-seleccionar si hay una coincidencia exacta o muy similar\r\n        const exactMatch = results.find(client => {\r\n          const clientName = client.name.toLowerCase().trim();\r\n          const searchName = searchTerm.toLowerCase().trim();\r\n          \r\n          console.log('üîç Comparando:', { clientName, searchName });\r\n          \r\n          // Coincidencia exacta\r\n          if (clientName === searchName) {\r\n            console.log('‚úÖ Coincidencia exacta encontrada');\r\n            return true;\r\n          }\r\n          \r\n          // Coincidencia sin espacios extra\r\n          if (clientName.replace(/\\s+/g, ' ') === searchName.replace(/\\s+/g, ' ')) {\r\n            console.log('‚úÖ Coincidencia sin espacios extra encontrada');\r\n            return true;\r\n          }\r\n          \r\n          // Coincidencia sin caracteres especiales\r\n          const cleanClientName = clientName.replace(/[^\\w\\s]/g, '');\r\n          const cleanSearchName = searchName.replace(/[^\\w\\s]/g, '');\r\n          if (cleanClientName === cleanSearchName) {\r\n            console.log('‚úÖ Coincidencia sin caracteres especiales encontrada');\r\n            return true;\r\n          }\r\n          \r\n          return false;\r\n        });\r\n        \r\n        if (exactMatch) {\r\n          console.log('üéØ Cliente detectado autom√°ticamente:', exactMatch.name);\r\n          handleSelectClient(exactMatch, true);\r\n        } else {\r\n          console.log('‚ùå No se encontr√≥ coincidencia exacta');\r\n        }\r\n      } else {\r\n        console.log('‚ùå handleSearch - Respuesta no exitosa:', response);\r\n        setSearchResults([]);\r\n        setShowSearchResults(false);\r\n      }\r\n    } catch (error) {\r\n      console.error('‚ùå Error en b√∫squeda:', error);\r\n      setSearchResults([]);\r\n      setShowSearchResults(false);\r\n    } finally {\r\n      setIsSearching(false);\r\n    }\r\n  };\r\n\r\n  // Seleccionar cliente\r\n  const handleSelectClient = (client, isAutoDetected = false) => {\r\n    setFormData(prev => ({\r\n      ...prev,\r\n      client_id: client.id,\r\n      client_name: client.name,\r\n      client_info: client\r\n    }));\r\n    setSearchTerm(client.name);\r\n    setShowSearchResults(false);\r\n    \r\n    if (isAutoDetected) {\r\n      // Mostrar mensaje de confirmaci√≥n\r\n      console.log('‚úÖ Cliente seleccionado autom√°ticamente:', client.name);\r\n      setAutoDetectedClient(client.name);\r\n      // Limpiar el mensaje despu√©s de 3 segundos\r\n      setTimeout(() => setAutoDetectedClient(null), 3000);\r\n    }\r\n  };\r\n\r\n  // Limpiar selecci√≥n\r\n  const handleClearClient = () => {\r\n    setFormData(prev => ({\r\n      ...prev,\r\n      client_id: '',\r\n      client_name: '',\r\n      client_info: {}\r\n    }));\r\n    setSearchTerm('');\r\n    setSearchResults([]);\r\n    setShowSearchResults(false);\r\n    setAutoDetectedClient(null);\r\n  };\r\n\r\n  const validateStep = (step) => {\r\n    const newErrors = {};\r\n    \r\n    switch (step) {\r\n      case 1:\r\n        if (!formData.clientType) newErrors.clientType = 'Selecciona el tipo de cliente';\r\n        if (!formData.client_id) newErrors.client_id = 'Debes seleccionar un cliente de la lista de resultados';\r\n        if (!formData.name) newErrors.name = 'Nombre del proyecto es requerido';\r\n        if (!formData.location) newErrors.location = 'Ubicaci√≥n es requerida';\r\n        break;\r\n      case 2:\r\n        if (!formData.contact_name) newErrors.contact_name = 'Persona de contacto es requerida';\r\n        if (!formData.contact_phone) newErrors.contact_phone = 'Tel√©fono es requerido';\r\n        break;\r\n      case 3:\r\n        if (!formData.requiere_laboratorio && !formData.requiere_ingenieria && \r\n            !formData.requiere_capacitacion) {\r\n          newErrors.services = 'Debes seleccionar al menos un tipo de servicio';\r\n        }\r\n        break;\r\n    }\r\n    \r\n    setErrors(newErrors);\r\n    return Object.keys(newErrors).length === 0;\r\n  };\r\n\r\n  const handleNext = () => {\r\n    if (validateStep(currentStep)) {\r\n      setCurrentStep(prev => Math.min(prev + 1, totalSteps));\r\n    }\r\n  };\r\n\r\n  const handlePrevious = () => {\r\n    setCurrentStep(prev => Math.max(prev - 1, 1));\r\n  };\r\n\r\n  const handleSubmit = () => {\r\n    if (validateStep(currentStep)) {\r\n      onSubmit(formData);\r\n    }\r\n  };\r\n\r\n  const getStepIcon = (step) => {\r\n    switch (step) {\r\n      case 1: return <FiUser />;\r\n      case 2: return <FiMessageSquare />;\r\n      case 3: return <FiSettings />;\r\n      case 4: return <FiCheckCircle />;\r\n      default: return <FiUser />;\r\n    }\r\n  };\r\n\r\n  const getStepTitle = (step) => {\r\n    switch (step) {\r\n      case 1: return 'Informaci√≥n B√°sica';\r\n      case 2: return 'Contacto';\r\n      case 3: return 'Requisitos del Proyecto';\r\n      case 4: return 'Resumen';\r\n      default: return 'Paso';\r\n    }\r\n  };\r\n\r\n  const renderStep1 = () => (\r\n    <div className=\"step-content\">\r\n      <div className=\"text-center mb-5\">\r\n        <div className=\"d-inline-flex align-items-center justify-content-center rounded-circle bg-primary bg-opacity-10 mb-3\" style={{ width: '64px', height: '64px' }}>\r\n          <FiUser size={28} className=\"text-primary\" />\r\n        </div>\r\n        <h3 className=\"fw-bold text-dark mb-2\">Informaci√≥n B√°sica</h3>\r\n        <p className=\"text-muted\">Completa los datos del cliente y del proyecto</p>\r\n      </div>\r\n      \r\n      <Row className=\"g-3\">\r\n        {/* Selecci√≥n de tipo de cliente */}\r\n        <Col md={12}>\r\n          <Form.Group>\r\n            <Form.Label className=\"fw-bold\">Tipo de Cliente *</Form.Label>\r\n            <div className=\"d-flex gap-3\">\r\n              <Form.Check\r\n                type=\"radio\"\r\n                id=\"empresa\"\r\n                name=\"clientType\"\r\n                label=\"Empresa\"\r\n                checked={formData.clientType === 'empresa'}\r\n                onChange={() => handleInputChange('clientType', 'empresa')}\r\n                className=\"d-flex align-items-center\"\r\n              />\r\n              <Form.Check\r\n                type=\"radio\"\r\n                id=\"persona_natural\"\r\n                name=\"clientType\"\r\n                label=\"Persona Natural\"\r\n                checked={formData.clientType === 'persona_natural'}\r\n                onChange={() => handleInputChange('clientType', 'persona_natural')}\r\n                className=\"d-flex align-items-center\"\r\n              />\r\n            </div>\r\n            {errors.clientType && (\r\n              <Form.Control.Feedback type=\"invalid\">\r\n                {errors.clientType}\r\n              </Form.Control.Feedback>\r\n            )}\r\n          </Form.Group>\r\n        </Col>\r\n        \r\n        {/* B√∫squeda inteligente */}\r\n        {formData.clientType && (\r\n          <Col md={12}>\r\n            <Form.Group>\r\n              <Form.Label className=\"fw-bold\">\r\n                Buscar {formData.clientType === 'empresa' ? 'Empresa' : 'Persona Natural'} *\r\n              </Form.Label>\r\n              <div className=\"position-relative\">\r\n                <Form.Control\r\n                  type=\"text\"\r\n                  value={searchTerm}\r\n                  onChange={(e) => {\r\n                    const value = e.target.value;\r\n                    setSearchTerm(value);\r\n                    handleSearch(value);\r\n                  }}\r\n                  placeholder={`Buscar ${formData.clientType === 'empresa' ? 'empresa' : 'persona natural'}...`}\r\n                  isInvalid={!!errors.client_id}\r\n                  isValid={!!formData.client_id && !errors.client_id}\r\n                />\r\n                {isSearching && (\r\n                  <div className=\"position-absolute top-50 end-0 translate-middle-y me-3\">\r\n                    <div className=\"spinner-border spinner-border-sm\" role=\"status\">\r\n                      <span className=\"visually-hidden\">Buscando...</span>\r\n                    </div>\r\n                  </div>\r\n                )}\r\n                \r\n                {/* Resultados de b√∫squeda */}\r\n                {showSearchResults && searchTerm && (\r\n                  <div className=\"position-absolute w-100 bg-white border rounded shadow-lg\" style={{zIndex: 1000, maxHeight: '300px', overflowY: 'auto'}}>\r\n                    {searchResults.length > 0 ? (\r\n                      <>\r\n                        <div className=\"p-2 bg-light border-bottom\">\r\n                          <small className=\"text-muted\">\r\n                            <strong>Haz clic en un cliente para seleccionarlo:</strong>\r\n                          </small>\r\n                        </div>\r\n                        {searchResults.map((result, index) => (\r\n                          <div \r\n                            key={index}\r\n                            className=\"p-3 border-bottom cursor-pointer hover-bg-light\"\r\n                            onClick={() => handleSelectClient(result)}\r\n                            style={{ cursor: 'pointer' }}\r\n                          >\r\n                            <div className=\"fw-bold\">{result.name}</div>\r\n                            <div className=\"text-muted small\">\r\n                              {formData.clientType === 'empresa' ? result.ruc : result.dni} ‚Ä¢ {result.address}\r\n                            </div>\r\n                          </div>\r\n                        ))}\r\n                      </>\r\n                    ) : (\r\n                      <div className=\"p-3 text-center\">\r\n                        <div className=\"text-muted mb-2\">No se encontraron resultados</div>\r\n                        <small className=\"text-warning\">\r\n                          Verifica el nombre o crea un nuevo cliente\r\n                        </small>\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n                )}\r\n              </div>\r\n              {errors.client_id && (\r\n                <Form.Control.Feedback type=\"invalid\">\r\n                  {errors.client_id}\r\n                </Form.Control.Feedback>\r\n              )}\r\n              {autoDetectedClient && (\r\n                <div className=\"mt-2\">\r\n                  <Alert variant=\"success\" className=\"py-2 mb-0\">\r\n                    <FiCheckCircle className=\"me-2\" />\r\n                    <strong>Cliente detectado autom√°ticamente:</strong> {autoDetectedClient}\r\n                  </Alert>\r\n                </div>\r\n              )}\r\n            </Form.Group>\r\n          </Col>\r\n        )}\r\n        \r\n        {/* Informaci√≥n del cliente seleccionado */}\r\n        {formData.client_id && (\r\n          <Col md={12}>\r\n            <Card className=\"border-success\">\r\n              <Card.Header className=\"bg-success text-white d-flex justify-content-between align-items-center\">\r\n                <h6 className=\"mb-0\">\r\n                  <FiCheckCircle className=\"me-2\" />\r\n                  Cliente Seleccionado\r\n                </h6>\r\n                <Button \r\n                  variant=\"outline-light\" \r\n                  size=\"sm\" \r\n                  onClick={handleClearClient}\r\n                  className=\"d-flex align-items-center\"\r\n                >\r\n                  <FiX className=\"me-1\" />\r\n                  Cambiar\r\n                </Button>\r\n              </Card.Header>\r\n              <Card.Body>\r\n                <div className=\"row\">\r\n                  <div className=\"col-md-6\">\r\n                    <strong>Nombre:</strong> {formData.client_name}\r\n                  </div>\r\n                  <div className=\"col-md-6\">\r\n                    <strong>{formData.clientType === 'empresa' ? 'RUC' : 'DNI'}:</strong> {formData.client_info.ruc || formData.client_info.dni}\r\n                  </div>\r\n                  <div className=\"col-md-12 mt-2\">\r\n                    <strong>Direcci√≥n:</strong> {formData.client_info.address}\r\n                  </div>\r\n                  {formData.client_info.phone && (\r\n                    <div className=\"col-md-6 mt-2\">\r\n                      <strong>Tel√©fono:</strong> {formData.client_info.phone}\r\n                    </div>\r\n                  )}\r\n                  {formData.client_info.email && (\r\n                    <div className=\"col-md-6 mt-2\">\r\n                      <strong>Email:</strong> {formData.client_info.email}\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              </Card.Body>\r\n            </Card>\r\n          </Col>\r\n        )}\r\n        \r\n        {/* Datos del proyecto */}\r\n        <Col md={12}>\r\n          <Form.Group>\r\n            <Form.Label className=\"fw-bold\">Nombre del Proyecto *</Form.Label>\r\n            <Form.Control\r\n              type=\"text\"\r\n              value={formData.name}\r\n              onChange={(e) => handleInputChange('name', e.target.value)}\r\n              placeholder=\"Ingresa el nombre del proyecto\"\r\n              isInvalid={!!errors.name}\r\n            />\r\n            {errors.name && (\r\n              <Form.Control.Feedback type=\"invalid\">\r\n                {errors.name}\r\n              </Form.Control.Feedback>\r\n            )}\r\n          </Form.Group>\r\n        </Col>\r\n        \r\n        <Col md={12}>\r\n          <Form.Group>\r\n            <Form.Label className=\"fw-bold\">Ubicaci√≥n *</Form.Label>\r\n            <Form.Control\r\n              type=\"text\"\r\n              value={formData.location}\r\n              onChange={(e) => handleInputChange('location', e.target.value)}\r\n              placeholder=\"Ingresa la ubicaci√≥n del proyecto\"\r\n              isInvalid={!!errors.location}\r\n            />\r\n            {errors.location && (\r\n              <Form.Control.Feedback type=\"invalid\">\r\n                {errors.location}\r\n              </Form.Control.Feedback>\r\n            )}\r\n          </Form.Group>\r\n        </Col>\r\n      </Row>\r\n    </div>\r\n  );\r\n\r\n  const renderStep2 = () => (\r\n    <div className=\"step-content\">\r\n      <div className=\"text-center mb-5\">\r\n        <div className=\"d-inline-flex align-items-center justify-content-center rounded-circle bg-success bg-opacity-10 mb-3\" style={{ width: '64px', height: '64px' }}>\r\n          <FiMessageSquare size={28} className=\"text-success\" />\r\n        </div>\r\n        <h3 className=\"fw-bold text-dark mb-2\">Informaci√≥n de Contacto</h3>\r\n        <p className=\"text-muted\">Datos de la persona responsable del proyecto</p>\r\n      </div>\r\n      \r\n      <Row className=\"g-3\">\r\n        <Col md={6}>\r\n          <Form.Group>\r\n            <Form.Label className=\"fw-bold\">Persona de Contacto *</Form.Label>\r\n            <Form.Control\r\n              type=\"text\"\r\n              value={formData.contact_name}\r\n              onChange={(e) => handleInputChange('contact_name', e.target.value)}\r\n              placeholder=\"Nombre completo\"\r\n              isInvalid={!!errors.contact_name}\r\n            />\r\n            {errors.contact_name && (\r\n              <Form.Control.Feedback type=\"invalid\">\r\n                {errors.contact_name}\r\n              </Form.Control.Feedback>\r\n            )}\r\n          </Form.Group>\r\n        </Col>\r\n        \r\n        <Col md={6}>\r\n          <Form.Group>\r\n            <Form.Label className=\"fw-bold\">Tel√©fono *</Form.Label>\r\n            <Form.Control\r\n              type=\"tel\"\r\n              value={formData.contact_phone}\r\n              onChange={(e) => handleInputChange('contact_phone', e.target.value)}\r\n              placeholder=\"N√∫mero de tel√©fono\"\r\n              isInvalid={!!errors.contact_phone}\r\n            />\r\n            {errors.contact_phone && (\r\n              <Form.Control.Feedback type=\"invalid\">\r\n                {errors.contact_phone}\r\n              </Form.Control.Feedback>\r\n            )}\r\n          </Form.Group>\r\n        </Col>\r\n        \r\n        <Col md={12}>\r\n          <Form.Group>\r\n            <Form.Label className=\"fw-bold\">Email</Form.Label>\r\n            <Form.Control\r\n              type=\"email\"\r\n              value={formData.contact_email}\r\n              onChange={(e) => handleInputChange('contact_email', e.target.value)}\r\n              placeholder=\"Email para comunicaci√≥n\"\r\n            />\r\n          </Form.Group>\r\n        </Col>\r\n      </Row>\r\n    </div>\r\n  );\r\n\r\n  const renderStep3 = () => (\r\n    <div className=\"step-content\">\r\n      <div className=\"text-center mb-5\">\r\n        <div className=\"d-inline-flex align-items-center justify-content-center rounded-circle bg-warning bg-opacity-10 mb-3\" style={{ width: '64px', height: '64px' }}>\r\n          <FiSettings size={28} className=\"text-warning\" />\r\n        </div>\r\n        <h3 className=\"fw-bold text-dark mb-2\">Requisitos del Proyecto</h3>\r\n        <p className=\"text-muted\">Selecciona los tipos de servicios que requiere este proyecto</p>\r\n      </div>\r\n      \r\n      <Alert variant=\"info\" className=\"mb-4\">\r\n        <div className=\"d-flex align-items-center\">\r\n          <FiTool className=\"me-2\" />\r\n          <div>\r\n            <strong>Selecciona los tipos de servicios que requiere este proyecto</strong>\r\n            <br />\r\n            <small>Esto ayudar√° a determinar qu√© √°reas del laboratorio trabajar√°n en el proyecto</small>\r\n          </div>\r\n        </div>\r\n      </Alert>\r\n      \r\n      <Row className=\"g-4\">\r\n        <Col md={6}>\r\n          <Card \r\n            className={`h-100 border-0 shadow-sm service-card ${formData.requiere_laboratorio ? 'selected' : ''}`}\r\n            style={{ \r\n              borderRadius: '16px',\r\n              transition: 'all 0.3s ease',\r\n              cursor: 'pointer',\r\n              border: formData.requiere_laboratorio ? '2px solid #667eea' : '2px solid transparent'\r\n            }}\r\n            onClick={() => handleInputChange('requiere_laboratorio', !formData.requiere_laboratorio)}\r\n          >\r\n            <Card.Body className=\"text-center p-4\">\r\n              <div className=\"service-icon mb-3\">\r\n                <FiTool \r\n                  size={48} \r\n                  className={formData.requiere_laboratorio ? 'text-white' : 'text-primary'} \r\n                />\r\n      </div>\r\n              <h5 className=\"fw-bold mb-2\">Laboratorio</h5>\r\n              <p className=\"text-muted small mb-4\">\r\n                Ensayos de laboratorio, an√°lisis de muestras, pruebas t√©cnicas\r\n              </p>\r\n              <Form.Check\r\n                type=\"checkbox\"\r\n                id=\"requiere_laboratorio\"\r\n                label=\"Requiere servicios de laboratorio\"\r\n                checked={formData.requiere_laboratorio || false}\r\n                onChange={(e) => handleInputChange('requiere_laboratorio', e.target.checked)}\r\n                className=\"d-flex justify-content-center\"\r\n                style={{ pointerEvents: 'none' }}\r\n              />\r\n            </Card.Body>\r\n          </Card>\r\n        </Col>\r\n        \r\n        <Col md={6}>\r\n          <Card \r\n            className={`h-100 border-0 shadow-sm service-card ${formData.requiere_ingenieria ? 'selected' : ''}`}\r\n            style={{ \r\n              borderRadius: '16px',\r\n              transition: 'all 0.3s ease',\r\n              cursor: 'pointer',\r\n              border: formData.requiere_ingenieria ? '2px solid #56ab2f' : '2px solid transparent'\r\n            }}\r\n            onClick={() => handleInputChange('requiere_ingenieria', !formData.requiere_ingenieria)}\r\n          >\r\n            <Card.Body className=\"text-center p-4\">\r\n              <div className=\"service-icon mb-3\">\r\n                <FiHome \r\n                  size={48} \r\n                  className={formData.requiere_ingenieria ? 'text-white' : 'text-success'} \r\n                />\r\n                  </div>\r\n              <h5 className=\"fw-bold mb-2\">Ingenier√≠a</h5>\r\n              <p className=\"text-muted small mb-4\">\r\n                Dise√±o, consultor√≠a t√©cnica, supervisi√≥n de obras\r\n              </p>\r\n              <Form.Check\r\n                type=\"checkbox\"\r\n                id=\"requiere_ingenieria\"\r\n                label=\"Requiere servicios de ingenier√≠a\"\r\n                checked={formData.requiere_ingenieria || false}\r\n                onChange={(e) => handleInputChange('requiere_ingenieria', e.target.checked)}\r\n                className=\"d-flex justify-content-center\"\r\n                style={{ pointerEvents: 'none' }}\r\n              />\r\n            </Card.Body>\r\n          </Card>\r\n        </Col>\r\n        \r\n                <Col md={6}>\r\n          <Card \r\n            className={`h-100 border-0 shadow-sm service-card ${formData.requiere_capacitacion ? 'selected' : ''}`}\r\n            style={{ \r\n              borderRadius: '16px',\r\n              transition: 'all 0.3s ease',\r\n              cursor: 'pointer',\r\n              border: formData.requiere_capacitacion ? '2px solid #3498db' : '2px solid transparent'\r\n            }}\r\n            onClick={() => handleInputChange('requiere_capacitacion', !formData.requiere_capacitacion)}\r\n          >\r\n            <Card.Body className=\"text-center p-4\">\r\n              <div className=\"service-icon mb-3\">\r\n                <FiBookOpen \r\n                  size={48} \r\n                  className={formData.requiere_capacitacion ? 'text-white' : 'text-info'} \r\n                />\r\n                  </div>\r\n              <h5 className=\"fw-bold mb-2\">Capacitaci√≥n</h5>\r\n              <p className=\"text-muted small mb-4\">\r\n                Entrenamiento, cursos, formaci√≥n t√©cnica\r\n              </p>\r\n              <Form.Check\r\n                type=\"checkbox\"\r\n                id=\"requiere_capacitacion\"\r\n                label=\"Requiere servicios de capacitaci√≥n\"\r\n                checked={formData.requiere_capacitacion || false}\r\n                onChange={(e) => handleInputChange('requiere_capacitacion', e.target.checked)}\r\n                className=\"d-flex justify-content-center\"\r\n                style={{ pointerEvents: 'none' }}\r\n              />\r\n          </Card.Body>\r\n        </Card>\r\n        </Col>\r\n      </Row>\r\n      \r\n      {/* Validaci√≥n de al menos un servicio */}\r\n      {!formData.requiere_laboratorio && !formData.requiere_ingenieria && \r\n       !formData.requiere_capacitacion && (\r\n        <Alert variant=\"warning\" className=\"mt-3\">\r\n          <FiAlertTriangle className=\"me-2\" />\r\n          Debes seleccionar al menos un tipo de servicio para el proyecto\r\n        </Alert>\r\n      )}\r\n    </div>\r\n  );\r\n\r\n  const renderStep4 = () => (\r\n    <div className=\"step-content\">\r\n      <div className=\"text-center mb-5\">\r\n        <div className=\"d-inline-flex align-items-center justify-content-center rounded-circle bg-info bg-opacity-10 mb-3\" style={{ width: '64px', height: '64px' }}>\r\n          <FiCheckCircle size={28} className=\"text-info\" />\r\n        </div>\r\n        <h3 className=\"fw-bold text-dark mb-2\">Resumen del Proyecto</h3>\r\n        <p className=\"text-muted\">Revisa la informaci√≥n antes de crear el proyecto</p>\r\n      </div>\r\n      \r\n      <Row className=\"g-4\">\r\n        <Col md={6}>\r\n          <Card>\r\n            <Card.Header>\r\n              <h6 className=\"mb-0\">Informaci√≥n B√°sica</h6>\r\n            </Card.Header>\r\n            <Card.Body>\r\n              <div className=\"mb-2\">\r\n                <strong>Proyecto:</strong> {formData.name}\r\n              </div>\r\n              <div className=\"mb-2\">\r\n                <strong>Ubicaci√≥n:</strong> {formData.location}\r\n              </div>\r\n              <div className=\"mb-2\">\r\n                <strong>Contacto:</strong> {formData.contact_name}\r\n              </div>\r\n              <div className=\"mb-2\">\r\n                <strong>Tel√©fono:</strong> {formData.contact_phone}\r\n              </div>\r\n              {formData.contact_email && (\r\n                <div className=\"mb-2\">\r\n                  <strong>Email:</strong> {formData.contact_email}\r\n                </div>\r\n              )}\r\n            </Card.Body>\r\n          </Card>\r\n        </Col>\r\n        \r\n        <Col md={6}>\r\n          <Card>\r\n            <Card.Header>\r\n              <h6 className=\"mb-0\">Requisitos del Proyecto</h6>\r\n            </Card.Header>\r\n            <Card.Body>\r\n              <div className=\"mb-3\">\r\n                <strong>Tipos de servicios requeridos:</strong>\r\n                  </div>\r\n              <div className=\"d-flex flex-column gap-2\">\r\n                {formData.requiere_laboratorio && (\r\n                  <div className=\"d-flex align-items-center\">\r\n                    <FiTool className=\"text-primary me-2\" />\r\n                    <span>Laboratorio</span>\r\n                  </div>\r\n                )}\r\n                {formData.requiere_ingenieria && (\r\n                  <div className=\"d-flex align-items-center\">\r\n                    <FiHome className=\"text-success me-2\" />\r\n                    <span>Ingenier√≠a</span>\r\n                  </div>\r\n                )}\r\n                {formData.requiere_capacitacion && (\r\n                  <div className=\"d-flex align-items-center\">\r\n                    <FiBookOpen className=\"text-info me-2\" />\r\n                    <span>Capacitaci√≥n</span>\r\n                  </div>\r\n                )}\r\n                {!formData.requiere_laboratorio && !formData.requiere_ingenieria && \r\n                 !formData.requiere_capacitacion && (\r\n                <div className=\"text-muted\">\r\n                  <FiX className=\"me-1\" />\r\n                    No hay requisitos seleccionados\r\n                </div>\r\n              )}\r\n              </div>\r\n            </Card.Body>\r\n          </Card>\r\n        </Col>\r\n      </Row>\r\n      \r\n    </div>\r\n  );\r\n\r\n  return (\r\n    <div className=\"project-form-redesigned\" style={{ fontFamily: 'Inter, -apple-system, BlinkMacSystemFont, sans-serif' }}>\r\n      {/* Modern Progress Indicator */}\r\n      <div className=\"mb-5\">\r\n        <div className=\"d-flex justify-content-between align-items-center mb-3\">\r\n          <h4 className=\"mb-0 fw-bold text-dark\">Crear Nuevo Proyecto</h4>\r\n          <div className=\"d-flex align-items-center\">\r\n            <span className=\"text-muted me-2\">Paso {currentStep} de {totalSteps}</span>\r\n            <div className=\"progress\" style={{ width: '120px', height: '6px' }}>\r\n              <div \r\n                className=\"progress-bar bg-gradient-primary\" \r\n                style={{ \r\n                  width: `${(currentStep / totalSteps) * 100}%`,\r\n                  background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',\r\n                  borderRadius: '3px'\r\n                }}\r\n              ></div>\r\n        </div>\r\n          </div>\r\n      </div>\r\n      \r\n        {/* Modern Step Navigation */}\r\n        <div className=\"step-navigation\">\r\n          {Array.from({ length: totalSteps }, (_, index) => {\r\n            const step = index + 1;\r\n            const isActive = step === currentStep;\r\n            const isCompleted = step < currentStep;\r\n            \r\n            return (\r\n                <div \r\n                key={step} \r\n                className={`step-item ${isActive ? 'active' : isCompleted ? 'completed' : ''}`}\r\n                  onClick={() => setCurrentStep(step)}\r\n                >\r\n                <div className=\"step-icon\">\r\n                  {isCompleted ? <FiCheckCircle /> : getStepIcon(step)}\r\n                  </div>\r\n                <div className=\"step-content\">\r\n                  <div className=\"step-title\">{getStepTitle(step)}</div>\r\n                  <div className=\"step-subtitle\">\r\n                    {step === 1 && 'Informaci√≥n del cliente y proyecto'}\r\n                    {step === 2 && 'Datos de contacto'}\r\n                    {step === 3 && 'Tipos de servicios requeridos'}\r\n                    {step === 4 && 'Revisar y confirmar'}\r\n                  </div>\r\n                </div>\r\n                {step < totalSteps && <div className=\"step-connector\"></div>}\r\n              </div>\r\n            );\r\n          })}\r\n        </div>\r\n      </div>\r\n      \r\n      {/* Modern Content Card */}\r\n      <Card className=\"border-0 shadow-lg mb-4\" style={{ borderRadius: '16px', overflow: 'hidden' }}>\r\n        <Card.Body className=\"p-5\">\r\n          <div className=\"step-content-wrapper\">\r\n          {currentStep === 1 && renderStep1()}\r\n          {currentStep === 2 && renderStep2()}\r\n          {currentStep === 3 && renderStep3()}\r\n          {currentStep === 4 && renderStep4()}\r\n          </div>\r\n        </Card.Body>\r\n      </Card>\r\n      \r\n      {/* Modern Navigation Buttons */}\r\n      <div className=\"d-flex justify-content-between align-items-center\">\r\n        <Button \r\n          variant=\"outline-secondary\" \r\n          onClick={handlePrevious}\r\n          disabled={currentStep === 1}\r\n          className=\"px-4 py-2 rounded-pill\"\r\n          style={{ \r\n            border: '2px solid #e9ecef',\r\n            fontWeight: '500',\r\n            minWidth: '120px'\r\n          }}\r\n        >\r\n          <FiX className=\"me-2\" />\r\n          Anterior\r\n        </Button>\r\n        \r\n        <div className=\"d-flex gap-3\">\r\n          {currentStep < totalSteps ? (\r\n            <Button \r\n              variant=\"primary\" \r\n              onClick={handleNext}\r\n              className=\"px-5 py-2 rounded-pill fw-bold\"\r\n              style={{ \r\n                background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',\r\n                border: 'none',\r\n                minWidth: '140px',\r\n                boxShadow: '0 4px 15px rgba(102, 126, 234, 0.4)'\r\n              }}\r\n            >\r\n              Siguiente\r\n              <FiPlus className=\"ms-2\" />\r\n            </Button>\r\n          ) : (\r\n            <Button \r\n              variant=\"success\" \r\n              onClick={handleSubmit}\r\n              disabled={loading}\r\n              className=\"px-5 py-2 rounded-pill fw-bold\"\r\n              style={{ \r\n                background: 'linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%)',\r\n                border: 'none',\r\n                minWidth: '160px',\r\n                boxShadow: '0 4px 15px rgba(86, 171, 47, 0.4)'\r\n              }}\r\n            >\r\n              {loading ? (\r\n                <>\r\n                  <div className=\"spinner-border spinner-border-sm me-2\" role=\"status\">\r\n                    <span className=\"visually-hidden\">Cargando...</span>\r\n                  </div>\r\n                  Creando...\r\n                </>\r\n              ) : (\r\n                <>\r\n                  Crear Proyecto\r\n                  <FiCheckCircle className=\"ms-2\" />\r\n                </>\r\n              )}\r\n            </Button>\r\n          )}\r\n          \r\n          <Button \r\n            variant=\"outline-danger\" \r\n            onClick={onCancel}\r\n            className=\"px-4 py-2 rounded-pill\"\r\n            style={{ \r\n              border: '2px solid #dc3545',\r\n              color: '#dc3545',\r\n              fontWeight: '500',\r\n              minWidth: '120px'\r\n            }}\r\n          >\r\n            Cancelar\r\n          </Button>\r\n        </div>\r\n      </div>\r\n      \r\n      {/* Custom Styles */}\r\n      <style jsx>{`\r\n        .step-navigation {\r\n          display: flex;\r\n          align-items: center;\r\n          justify-content: space-between;\r\n          position: relative;\r\n          margin: 2rem 0;\r\n        }\r\n        \r\n        .step-item {\r\n          display: flex;\r\n          align-items: center;\r\n          cursor: pointer;\r\n          transition: all 0.3s ease;\r\n          position: relative;\r\n          z-index: 2;\r\n        }\r\n        \r\n        .step-item:hover {\r\n          transform: translateY(-2px);\r\n        }\r\n        \r\n        .step-icon {\r\n          width: 48px;\r\n          height: 48px;\r\n          border-radius: 50%;\r\n          display: flex;\r\n          align-items: center;\r\n          justify-content: center;\r\n          font-size: 20px;\r\n          font-weight: bold;\r\n          transition: all 0.3s ease;\r\n          margin-right: 12px;\r\n          background: #f8f9fa;\r\n          color: #6c757d;\r\n          border: 3px solid #e9ecef;\r\n        }\r\n        \r\n        .step-item.active .step-icon {\r\n          background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\r\n          color: white;\r\n          border-color: #667eea;\r\n          box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);\r\n        }\r\n        \r\n        .step-item.completed .step-icon {\r\n          background: linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%);\r\n          color: white;\r\n          border-color: #56ab2f;\r\n        }\r\n        \r\n        .step-content {\r\n          flex: 1;\r\n        }\r\n        \r\n        .step-title {\r\n          font-weight: 600;\r\n          font-size: 14px;\r\n          color: #495057;\r\n          margin-bottom: 2px;\r\n        }\r\n        \r\n        .step-item.active .step-title {\r\n          color: #667eea;\r\n          font-weight: 700;\r\n        }\r\n        \r\n        .step-item.completed .step-title {\r\n          color: #56ab2f;\r\n        }\r\n        \r\n        .step-subtitle {\r\n          font-size: 12px;\r\n          color: #6c757d;\r\n          line-height: 1.3;\r\n        }\r\n        \r\n        .step-connector {\r\n          position: absolute;\r\n          top: 24px;\r\n          left: 100%;\r\n          width: 100%;\r\n          height: 2px;\r\n          background: #e9ecef;\r\n          z-index: 1;\r\n        }\r\n        \r\n        .step-item.completed + .step-item .step-connector {\r\n          background: linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%);\r\n        }\r\n        \r\n        .step-content-wrapper {\r\n          min-height: 400px;\r\n        }\r\n        \r\n        .bg-gradient-primary {\r\n          background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\r\n        }\r\n        \r\n        .service-card {\r\n          transition: all 0.3s ease;\r\n        }\r\n        \r\n        .service-card:hover {\r\n          transform: translateY(-4px);\r\n          box-shadow: 0 8px 25px rgba(0,0,0,0.15) !important;\r\n        }\r\n        \r\n        .service-card.selected {\r\n          transform: translateY(-2px);\r\n          box-shadow: 0 8px 25px rgba(0,0,0,0.2) !important;\r\n        }\r\n        \r\n        .service-card.selected .service-icon {\r\n          background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\r\n          border-radius: 50%;\r\n          width: 80px;\r\n          height: 80px;\r\n          display: flex;\r\n          align-items: center;\r\n          justify-content: center;\r\n          margin: 0 auto 1rem auto;\r\n        }\r\n        \r\n        .service-card:not(.selected) .service-icon {\r\n          background: rgba(0,0,0,0.05);\r\n          border-radius: 50%;\r\n          width: 80px;\r\n          height: 80px;\r\n          display: flex;\r\n          align-items: center;\r\n          justify-content: center;\r\n          margin: 0 auto 1rem auto;\r\n        }\r\n        \r\n        @media (max-width: 768px) {\r\n          .step-navigation {\r\n            flex-direction: column;\r\n            align-items: flex-start;\r\n          }\r\n          \r\n          .step-item {\r\n            width: 100%;\r\n            margin-bottom: 1rem;\r\n          }\r\n          \r\n          .step-connector {\r\n            display: none;\r\n          }\r\n        }\r\n      `}</style>\r\n    </div>\r\n  );\r\n}\r\n","import React, { useState, useMemo, useEffect } from 'react';\r\nimport { useQuery, useMutation, useQueryClient } from 'react-query';\r\nimport { useNavigate, useLocation } from 'react-router-dom';\r\nimport { useAuth } from '../contexts/AuthContext';\r\nimport { getCurrentUser, canCreateProject, canEditProject, canDeleteProject } from '../utils/authHelper';\r\nimport { Button, Badge, Row, Col, Card, Container, Tabs, Tab, Toast, ToastContainer } from 'react-bootstrap';\r\nimport { FiPlus, FiEdit, FiTrash2, FiHome, FiMapPin, FiCalendar, FiUser, FiCheckCircle, FiClock, FiX, FiRefreshCw, FiFolder, FiMessageCircle, FiCheck, FiSettings, FiEye, FiUsers, FiDownload, FiAlertTriangle, FiUpload, FiFileText, FiSave, FiMessageSquare } from 'react-icons/fi';\r\nimport PageHeader from '../components/common/PageHeader';\r\nimport DataTable from '../components/common/DataTable';\r\nimport ModalForm from '../components/common/ModalForm';\r\nimport StatsCard from '../components/common/StatsCard';\r\nimport ConfirmModal from '../components/common/ConfirmModal';\r\nimport PermissionDeniedModal from '../components/common/PermissionDeniedModal';\r\nimport { listProjects, createProject, updateProject, deleteProject, getProjectStats, updateProjectStatus, updateProjectQueries, updateProjectMark } from '../services/projects';\r\nimport { listProjectAttachments, uploadAttachment, deleteAttachment, downloadFile } from '../services/attachments';\r\nimport { listUsers } from '../services/users';\r\nimport ProjectServiceForm from '../components/ProjectServiceForm';\r\nimport ProjectFormRedesigned from '../components/ProjectFormRedesigned';\r\n\r\nconst emptyForm = { \r\n  company_id: '', \r\n  name: '', \r\n  location: '', \r\n  vendedor_id: '', \r\n  laboratorio_id: '', \r\n  requiere_laboratorio: false, \r\n  requiere_ingenieria: false, \r\n  requiere_consultoria: false,\r\n  requiere_capacitacion: false,\r\n  requiere_auditoria: false,\r\n  contact_name: '', \r\n  contact_phone: '', \r\n  contact_email: '',\r\n  queries: '',\r\n  priority: 'normal',\r\n  marked: false\r\n};\r\n\r\nexport default function Proyectos() {\r\n  const { user } = useAuth();\r\n  \r\n  // Informaci√≥n del usuario actual y permisos\r\n  const currentUser = getCurrentUser();\r\n  const userCanCreateProject = canCreateProject();\r\n  const userCanEditProject = canEditProject();\r\n  const userCanDeleteProject = canDeleteProject();\r\n  const [showModal, setShowModal] = useState(false);\r\n  const [editingProject, setEditingProject] = useState(null);\r\n  const [deletingProject, setDeletingProject] = useState(null);\r\n  const [deletingFile, setDeletingFile] = useState(null);\r\n  const [markingProject, setMarkingProject] = useState(null);\r\n  const [showQueriesModal, setShowQueriesModal] = useState(false);\r\n  const [showStatusModal, setShowStatusModal] = useState(false);\r\n  const [showViewModal, setShowViewModal] = useState(false);\r\n  const [showViewOnlyModal, setShowViewOnlyModal] = useState(false);\r\n  const [selectedProject, setSelectedProject] = useState(null);\r\n  const [activeTab, setActiveTab] = useState('info');\r\n  \r\n  // Estados para modal de permisos denegados\r\n  const [showPermissionDeniedModal, setShowPermissionDeniedModal] = useState(false);\r\n  const [permissionDeniedInfo, setPermissionDeniedInfo] = useState({});\r\n  \r\n  // Estados para archivos adjuntos\r\n  const [attachments, setAttachments] = useState([]);\r\n  const [selectedFile, setSelectedFile] = useState(null);\r\n  const [uploadingFile, setUploadingFile] = useState(false);\r\n  const [editingData, setEditingData] = useState({});\r\n  const [showToast, setShowToast] = useState(false);\r\n  const [toastMessage, setToastMessage] = useState('');\r\n  const [toastVariant, setToastVariant] = useState('success');\r\n  \r\n  // Estados para buscadores de usuarios\r\n  const [vendedorSearch, setVendedorSearch] = useState('');\r\n  const [laboratorioSearch, setLaboratorioSearch] = useState('');\r\n  const [showVendedorDropdown, setShowVendedorDropdown] = useState(false);\r\n  const [showLaboratorioDropdown, setShowLaboratorioDropdown] = useState(false);\r\n  const [newQuery, setNewQuery] = useState('');\r\n  \r\n  // Estados para servicios\r\n  const [selectedServices, setSelectedServices] = useState([]);\r\n  const [showServiceForm, setShowServiceForm] = useState(false);\r\n  \r\n  // Estados para formulario redise√±ado\r\n  const [useNewForm, setUseNewForm] = useState(true);\r\n  const [showNewForm, setShowNewForm] = useState(false);\r\n\r\n\r\n  const [currentPage, setCurrentPage] = useState(1);\r\n  const [searchTerm, setSearchTerm] = useState('');\r\n  const [selectedStatus, setSelectedStatus] = useState('');\r\n  const [selectedCompany, setSelectedCompany] = useState('');\r\n  const [selectedProjectType, setSelectedProjectType] = useState('');\r\n  const [selectedPriority, setSelectedPriority] = useState('');\r\n  const [isSearching, setIsSearching] = useState(false);\r\n  const navigate = useNavigate();\r\n  const location = useLocation();\r\n  \r\n  // Obtener par√°metros de URL para abrir proyecto espec√≠fico\r\n  const urlParams = new URLSearchParams(location.search);\r\n  const viewProjectId = urlParams.get('view');\r\n  \r\n  // Obtener cliente pre-seleccionado desde la navegaci√≥n\r\n  const selectedClient = location.state?.selectedClient;\r\n\r\n  const queryClient = useQueryClient();\r\n\r\n  const { data, isLoading, refetch } = useQuery(\r\n    ['projects', currentPage, searchTerm, selectedStatus, selectedCompany, selectedProjectType, selectedPriority],\r\n    () => listProjects({ \r\n      page: currentPage, \r\n      limit: 20, \r\n      search: searchTerm, \r\n      status: selectedStatus, \r\n      company_id: selectedCompany,\r\n      project_type: selectedProjectType,\r\n      priority: selectedPriority\r\n    }),\r\n    { \r\n      keepPreviousData: true,\r\n      refetchOnWindowFocus: false, // No refrescar autom√°ticamente\r\n      refetchOnMount: false, // No refrescar al montar\r\n      staleTime: 30000, // 30 segundos - considerar datos frescos\r\n      cacheTime: 300000, // 5 minutos - cachear datos\r\n      retry: 2, // Reintentar m√°ximo 2 veces\r\n      retryDelay: 1000, // Esperar 1 segundo entre reintentos\r\n    }\r\n  );\r\n\r\n  // Cargar usuarios para los dropdowns\r\n  const { data: usersData, isLoading: usersLoading } = useQuery(\r\n    'users',\r\n    () => listUsers(),\r\n    {\r\n      keepPreviousData: true,\r\n      refetchOnWindowFocus: false,\r\n      staleTime: 300000, // 5 minutos\r\n      cacheTime: 600000, // 10 minutos\r\n    }\r\n  );\r\n\r\n  // Estad√≠sticas separadas\r\n  const { data: statsData, isLoading: statsLoading } = useQuery(\r\n    ['projectStats'],\r\n    getProjectStats,\r\n    {\r\n      refetchOnWindowFocus: false, // No refrescar autom√°ticamente\r\n      refetchOnMount: false, // No refrescar al montar\r\n      staleTime: 60000, // 1 minuto - considerar datos frescos\r\n      cacheTime: 300000, // 5 minutos - cachear datos\r\n      retry: 1, // Reintentar m√°ximo 1 vez\r\n      onSuccess: (data) => {\r\n        console.log('üìä Frontend - Estad√≠sticas recibidas:', data);\r\n        console.log('üìä Frontend - alta_prioridad:', data?.alta_prioridad);\r\n      }\r\n    }\r\n  );\r\n\r\n  // Efecto para abrir proyecto espec√≠fico desde URL\r\n  useEffect(() => {\r\n    if (viewProjectId && data?.data) {\r\n      const project = data.data.find(p => p.id == viewProjectId);\r\n      if (project) {\r\n        handleViewProject(project);\r\n        // Limpiar la URL despu√©s de abrir el modal\r\n        navigate('/proyectos', { replace: true });\r\n      }\r\n    }\r\n  }, [viewProjectId, data?.data]);\r\n\r\n  // Sistema de servicios moderno implementado\r\n\r\n  // Cargar adjuntos cuando se abra el modal de gesti√≥n\r\n  useEffect(() => {\r\n    const loadAttachments = async () => {\r\n      if (selectedProject?.id) {\r\n        try {\r\n          const attachmentsData = await listProjectAttachments(selectedProject.id);\r\n          setAttachments(attachmentsData);\r\n        } catch (error) {\r\n          console.error('Error al cargar adjuntos:', error);\r\n        }\r\n      }\r\n    };\r\n    loadAttachments();\r\n  }, [selectedProject?.id, showViewModal]);\r\n\r\n  // Cerrar dropdowns al hacer clic fuera\r\n  useEffect(() => {\r\n    const handleClickOutside = (event) => {\r\n      if (!event.target.closest('.position-relative')) {\r\n        setShowVendedorDropdown(false);\r\n        setShowLaboratorioDropdown(false);\r\n      }\r\n    };\r\n\r\n    document.addEventListener('mousedown', handleClickOutside);\r\n    return () => {\r\n      document.removeEventListener('mousedown', handleClickOutside);\r\n    };\r\n  }, []);\r\n\r\n  const handleMutationSuccess = (message) => {\r\n    queryClient.invalidateQueries('projects');\r\n    queryClient.invalidateQueries('projectStats');\r\n    setShowModal(false);\r\n    setEditingProject(null);\r\n    setDeletingProject(null);\r\n  };\r\n\r\n  const showNotification = (message, variant = 'success') => {\r\n    setToastMessage(message);\r\n    setToastVariant(variant);\r\n    setShowToast(true);\r\n    \r\n    // Auto-close despu√©s de 5 segundos\r\n    setTimeout(() => {\r\n      setShowToast(false);\r\n    }, 5000);\r\n  };\r\n\r\n  // Funci√≥n para manejar b√∫squeda\r\n  const handleSearch = (searchValue) => {\r\n    console.log('üîç handleSearch - B√∫squeda:', searchValue);\r\n    setSearchTerm(searchValue);\r\n    setCurrentPage(1); // Resetear a la primera p√°gina\r\n    setIsSearching(true);\r\n    setTimeout(() => setIsSearching(false), 1000);\r\n  };\r\n\r\n  // Funci√≥n para manejar filtros\r\n  const handleFilter = (filters) => {\r\n    console.log('üîç handleFilter - Filtros:', filters);\r\n    setSelectedStatus(filters.status || '');\r\n    setSelectedCompany(filters.company_id || '');\r\n    setSelectedProjectType(filters.project_type || '');\r\n    setSelectedPriority(filters.priority || '');\r\n    setCurrentPage(1); // Resetear a la primera p√°gina\r\n  };\r\n\r\n  // Funciones para manejar adjuntos\r\n  const handleFileSelect = (event) => {\r\n    const file = event.target.files[0];\r\n    if (file) {\r\n      setSelectedFile(file);\r\n    }\r\n  };\r\n\r\n  const handleFileUpload = async () => {\r\n    if (!selectedFile || !selectedProject?.id) {\r\n      showNotification('‚ùå Por favor selecciona un archivo', 'danger');\r\n      return;\r\n    }\r\n\r\n    setUploadingFile(true);\r\n    try {\r\n      const formData = new FormData();\r\n      formData.append('file', selectedFile);\r\n      formData.append('description', `Archivo subido: ${selectedFile.name}`);\r\n\r\n      await uploadAttachment(selectedProject.id, formData);\r\n      \r\n      // Recargar adjuntos\r\n      const attachmentsData = await listProjectAttachments(selectedProject.id);\r\n      setAttachments(attachmentsData);\r\n      \r\n      setSelectedFile(null);\r\n      setUploadingFile(false);\r\n      showNotification('‚úÖ Archivo subido correctamente', 'success');\r\n    } catch (error) {\r\n      console.error('Error al subir archivo:', error);\r\n      setUploadingFile(false);\r\n      showNotification('‚ùå Error al subir archivo', 'danger');\r\n    }\r\n  };\r\n\r\n  const handleFileDownload = async (attachment) => {\r\n    try {\r\n      await downloadFile(attachment);\r\n      showNotification('‚úÖ Archivo descargado correctamente', 'success');\r\n    } catch (error) {\r\n      console.error('Error al descargar archivo:', error);\r\n      showNotification('‚ùå Error al descargar archivo', 'danger');\r\n    }\r\n  };\r\n\r\n  const handleFileDelete = async (attachmentId) => {\r\n    setDeletingFile(attachmentId);\r\n  };\r\n\r\n  const confirmFileDelete = async () => {\r\n    try {\r\n      await deleteAttachment(deletingFile);\r\n      \r\n      // Recargar adjuntos\r\n      const attachmentsData = await listProjectAttachments(selectedProject.id);\r\n      setAttachments(attachmentsData);\r\n      \r\n      showNotification('‚úÖ Archivo eliminado correctamente', 'success');\r\n      setDeletingFile(null);\r\n    } catch (error) {\r\n      console.error('Error al eliminar archivo:', error);\r\n      showNotification('‚ùå Error al eliminar archivo', 'danger');\r\n      setDeletingFile(null);\r\n    }\r\n  };\r\n\r\n  // Funciones para manejo de usuarios\r\n  const handleVendedorSelect = (user) => {\r\n    setEditingData({...editingData, vendedor_id: user.id});\r\n    setVendedorSearch(`${user.name} ${user.apellido}`);\r\n    setShowVendedorDropdown(false);\r\n    \r\n    // Enviar notificaci√≥n al vendedor asignado\r\n    if (user.id && selectedProject) {\r\n      sendAssignmentNotification(user.id, 'vendedor', selectedProject);\r\n    }\r\n  };\r\n\r\n  const handleLaboratorioSelect = (user) => {\r\n    setEditingData({...editingData, laboratorio_id: user.id});\r\n    setLaboratorioSearch(`${user.name} ${user.apellido}`);\r\n    setShowLaboratorioDropdown(false);\r\n    \r\n    // Enviar notificaci√≥n al responsable de laboratorio asignado\r\n    if (user.id && selectedProject) {\r\n      sendAssignmentNotification(user.id, 'laboratorio', selectedProject);\r\n    }\r\n  };\r\n\r\n  const sendAssignmentNotification = async (userId, role, project) => {\r\n    try {\r\n      const apiUrl = import.meta.env?.VITE_API_URL || 'http://localhost:4000';\r\n      const baseUrl = apiUrl.replace(/\\/api$/, '');\r\n      const token = localStorage.getItem('token');\r\n      \r\n      // Crear fecha y hora formateada\r\n      const now = new Date();\r\n      const fechaHora = now.toLocaleString('es-PE', {\r\n        year: 'numeric',\r\n        month: '2-digit',\r\n        day: '2-digit',\r\n        hour: '2-digit',\r\n        minute: '2-digit',\r\n        second: '2-digit'\r\n      });\r\n      \r\n      const roleText = role === 'vendedor' ? 'vendedor comercial responsable' : 'usuario de laboratorio responsable';\r\n      \r\n      const notificationData = {\r\n        user_id: userId,\r\n        type: 'project_assignment',\r\n        title: `üéØ Proyecto Asignado - ${project.name}`,\r\n        message: `Se te ha asignado el proyecto \"${project.name}\" como ${roleText}.\\n\\nüìÖ Fecha y hora: ${fechaHora}\\nüè¢ Empresa: ${project.company_name || 'No especificada'}\\nüìç Ubicaci√≥n: ${project.location || 'No especificada'}\\nüìû Contacto: ${project.contact_name || 'No especificado'}`,\r\n        project_id: project.id,\r\n        priority: 'high',\r\n        metadata: {\r\n          assignment_date: now.toISOString(),\r\n          role: role,\r\n          project_name: project.name,\r\n          company_name: project.company_name\r\n        }\r\n      };\r\n\r\n      console.log('üì§ Enviando notificaci√≥n:', notificationData);\r\n\r\n      const response = await fetch(`${baseUrl}/api/notifications`, {\r\n        method: 'POST',\r\n        headers: {\r\n          'Authorization': `Bearer ${token}`,\r\n          'Content-Type': 'application/json'\r\n        },\r\n        body: JSON.stringify(notificationData)\r\n      });\r\n\r\n      if (response.ok) {\r\n        const result = await response.json();\r\n        console.log('‚úÖ Notificaci√≥n enviada exitosamente:', result);\r\n        showNotification(`‚úÖ Notificaci√≥n enviada al ${roleText} - ${fechaHora}`, 'success');\r\n      } else {\r\n        const errorText = await response.text();\r\n        console.warn('‚ö†Ô∏è No se pudo enviar la notificaci√≥n:', response.status, errorText);\r\n        showNotification(`‚ö†Ô∏è Error enviando notificaci√≥n al ${roleText}`, 'warning');\r\n      }\r\n    } catch (error) {\r\n      console.error('‚ùå Error enviando notificaci√≥n:', error);\r\n      showNotification(`‚ùå Error enviando notificaci√≥n al ${role === 'vendedor' ? 'vendedor comercial' : 'usuario de laboratorio'}`, 'danger');\r\n    }\r\n  };\r\n\r\n  // Filtrar usuarios por b√∫squeda\r\n  const getFilteredVendedores = () => {\r\n    if (!usersData?.data) return [];\r\n    return usersData.data.filter(user => \r\n      user.role === 'vendedor_comercial' &&\r\n      (vendedorSearch === '' || \r\n       `${user.name} ${user.apellido}`.toLowerCase().includes(vendedorSearch.toLowerCase()) ||\r\n       user.email?.toLowerCase().includes(vendedorSearch.toLowerCase()))\r\n    );\r\n  };\r\n\r\n  const getFilteredLaboratorio = () => {\r\n    if (!usersData?.data) return [];\r\n    return usersData.data.filter(user => \r\n      user.role === 'usuario_laboratorio' &&\r\n      (laboratorioSearch === '' || \r\n       `${user.name} ${user.apellido}`.toLowerCase().includes(laboratorioSearch.toLowerCase()) ||\r\n       user.email?.toLowerCase().includes(laboratorioSearch.toLowerCase()))\r\n    );\r\n  };\r\n\r\n  // Opciones de filtros espec√≠ficas para proyectos\r\n  const projectFilterOptions = [\r\n    {\r\n      title: 'Por Estado',\r\n      options: [\r\n        { label: 'Pendientes', filter: { status: 'pendiente' } },\r\n        { label: 'Activos', filter: { status: 'activo' } }\r\n      ]\r\n    },\r\n    {\r\n      title: 'Por Prioridad',\r\n      options: [\r\n        { label: 'üü† Alta', filter: { priority: 'high' } },\r\n        { label: 'üü¢ Normal', filter: { priority: 'normal' } }\r\n      ]\r\n    }\r\n  ];\r\n\r\n  const createMutation = useMutation(createProject, {\r\n    onSuccess: () => handleMutationSuccess('Proyecto creado exitosamente'),\r\n    onError: (error) => console.error('Error creating project:', error)\r\n  });\r\n\r\n  const updateMutation = useMutation(\r\n    ({ id, data }) => updateProject(id, data),\r\n    {\r\n      onSuccess: (updatedProject) => {\r\n        console.log('‚úÖ updateMutation - Success:', updatedProject);\r\n        // Actualizar el proyecto seleccionado con los nuevos datos\r\n        setSelectedProject(updatedProject);\r\n        \r\n        // Procesar editingData para asegurar que queries_history sea un array\r\n        const processedEditingData = {\r\n          ...updatedProject,\r\n          queries_history: (() => {\r\n            try {\r\n              if (updatedProject.queries_history && Array.isArray(updatedProject.queries_history)) {\r\n                return updatedProject.queries_history;\r\n              }\r\n              if (updatedProject.queries_history && typeof updatedProject.queries_history === 'string') {\r\n                const parsed = JSON.parse(updatedProject.queries_history);\r\n                return Array.isArray(parsed) ? parsed : [];\r\n              }\r\n              return [];\r\n            } catch (e) {\r\n              console.warn('‚ùå Error procesando queries_history en updateMutation:', e);\r\n              return [];\r\n            }\r\n          })()\r\n        };\r\n        \r\n        setEditingData(processedEditingData);\r\n        showNotification('‚úÖ Proyecto actualizado exitosamente!', 'success');\r\n        queryClient.invalidateQueries(['projects']);\r\n      },\r\n      onError: (error) => {\r\n        console.error('‚ùå updateMutation - Error:', error);\r\n        showNotification('‚ùå Error al actualizar proyecto', 'danger');\r\n      }\r\n    }\r\n  );\r\n\r\n  const deleteMutation = useMutation(deleteProject, {\r\n    onSuccess: () => handleMutationSuccess('Proyecto eliminado exitosamente'),\r\n    onError: (error) => {\r\n      console.error('Error deleting project:', error);\r\n      // El manejo espec√≠fico del error 403 se hace en confirmDelete\r\n    }\r\n  });\r\n\r\n  const updateStatusMutation = useMutation(\r\n    ({ id, ...data }) => updateProjectStatus(id, data),\r\n    {\r\n      onSuccess: (updatedProject) => {\r\n        setSelectedProject(updatedProject);\r\n        \r\n        // Procesar editingData para asegurar que queries_history sea un array\r\n        const processedEditingData = {\r\n          ...updatedProject,\r\n          queries_history: (() => {\r\n            try {\r\n              if (updatedProject.queries_history && Array.isArray(updatedProject.queries_history)) {\r\n                return updatedProject.queries_history;\r\n              }\r\n              if (updatedProject.queries_history && typeof updatedProject.queries_history === 'string') {\r\n                const parsed = JSON.parse(updatedProject.queries_history);\r\n                return Array.isArray(parsed) ? parsed : [];\r\n              }\r\n              return [];\r\n            } catch (e) {\r\n              console.warn('‚ùå Error procesando queries_history en updateStatusMutation:', e);\r\n              return [];\r\n            }\r\n          })()\r\n        };\r\n        \r\n        setEditingData(processedEditingData);\r\n        handleMutationSuccess('Estado del proyecto actualizado exitosamente');\r\n      },\r\n      onError: (error) => console.error('Error updating project status:', error)\r\n    }\r\n  );\r\n\r\n\r\n  const updateQueriesMutation = useMutation(\r\n    ({ id, ...data }) => updateProjectQueries(id, data),\r\n    {\r\n      onSuccess: (updatedProject) => {\r\n        setSelectedProject(updatedProject);\r\n        \r\n        // Procesar editingData para asegurar que queries_history sea un array\r\n        const processedEditingData = {\r\n          ...updatedProject,\r\n          queries_history: (() => {\r\n            try {\r\n              if (updatedProject.queries_history && Array.isArray(updatedProject.queries_history)) {\r\n                return updatedProject.queries_history;\r\n              }\r\n              if (updatedProject.queries_history && typeof updatedProject.queries_history === 'string') {\r\n                const parsed = JSON.parse(updatedProject.queries_history);\r\n                return Array.isArray(parsed) ? parsed : [];\r\n              }\r\n              return [];\r\n            } catch (e) {\r\n              console.warn('‚ùå Error procesando queries_history en updateQueriesMutation:', e);\r\n              return [];\r\n            }\r\n          })()\r\n        };\r\n        \r\n        setEditingData(processedEditingData);\r\n        handleMutationSuccess('Consultas del proyecto actualizadas exitosamente');\r\n      },\r\n      onError: (error) => console.error('Error updating project queries:', error)\r\n    }\r\n  );\r\n\r\n  const updateMarkMutation = useMutation(\r\n    ({ id, ...data }) => updateProjectMark(id, data),\r\n    {\r\n      onSuccess: (updatedProject) => {\r\n        setSelectedProject(updatedProject);\r\n        \r\n        // Procesar editingData para asegurar que queries_history sea un array\r\n        const processedEditingData = {\r\n          ...updatedProject,\r\n          queries_history: (() => {\r\n            try {\r\n              if (updatedProject.queries_history && Array.isArray(updatedProject.queries_history)) {\r\n                return updatedProject.queries_history;\r\n              }\r\n              if (updatedProject.queries_history && typeof updatedProject.queries_history === 'string') {\r\n                const parsed = JSON.parse(updatedProject.queries_history);\r\n                return Array.isArray(parsed) ? parsed : [];\r\n              }\r\n              return [];\r\n            } catch (e) {\r\n              console.warn('‚ùå Error procesando queries_history en updateMarkMutation:', e);\r\n              return [];\r\n            }\r\n          })()\r\n        };\r\n        \r\n        setEditingData(processedEditingData);\r\n        handleMutationSuccess('Proyecto marcado/desmarcado exitosamente');\r\n      },\r\n      onError: (error) => console.error('Error updating project mark:', error)\r\n    }\r\n  );\r\n\r\n  const handleCreate = () => {\r\n    if (!userCanCreateProject) {\r\n      setPermissionDeniedInfo({\r\n        action: \"crear proyectos\",\r\n        requiredRole: \"administrador, jefa comercial o vendedor comercial\",\r\n        currentRole: currentUser?.role || \"no autenticado\"\r\n      });\r\n      setShowPermissionDeniedModal(true);\r\n      return;\r\n    }\r\n    \r\n    // Si hay un cliente pre-seleccionado, pre-llenar el formulario\r\n    const formData = selectedClient ? {\r\n      ...emptyForm,\r\n      company_id: selectedClient.id,\r\n      name: `${selectedClient.sector || 'Proyecto'} - ${selectedClient.name}`,\r\n      location: selectedClient.city || '',\r\n      contact_name: selectedClient.contact_name || '',\r\n      contact_phone: selectedClient.phone || '',\r\n      contact_email: selectedClient.email || ''\r\n    } : emptyForm;\r\n    \r\n    setEditingProject(formData);\r\n    setShowModal(true);\r\n  };\r\n\r\n  const handleEdit = (project) => {\r\n    if (!userCanEditProject) {\r\n      setPermissionDeniedInfo({\r\n        action: \"editar proyectos\",\r\n        requiredRole: \"administrador, jefa comercial o vendedor comercial\",\r\n        currentRole: currentUser?.role || \"no autenticado\"\r\n      });\r\n      setShowPermissionDeniedModal(true);\r\n      return;\r\n    }\r\n    setEditingProject(project);\r\n    setShowModal(true);\r\n  };\r\n\r\n  const handleDelete = (project) => {\r\n    console.log('üîç handleDelete - Verificando permisos:', {\r\n      userCanDeleteProject,\r\n      currentUserRole: currentUser?.role,\r\n      currentUser: currentUser\r\n    });\r\n    \r\n    if (!userCanDeleteProject) {\r\n      console.log('üö´ handleDelete - Permisos insuficientes, mostrando modal');\r\n      setPermissionDeniedInfo({\r\n        action: \"eliminar proyectos\",\r\n        requiredRole: \"jefa comercial o soporte\",\r\n        currentRole: currentUser?.role || \"no autenticado\"\r\n      });\r\n      setShowPermissionDeniedModal(true);\r\n      return;\r\n    }\r\n    console.log('‚úÖ handleDelete - Permisos OK, procediendo con eliminaci√≥n');\r\n    setDeletingProject(project);\r\n  };\r\n\r\n  const confirmDelete = async () => {\r\n    try {\r\n      await deleteMutation.mutateAsync(deletingProject.id);\r\n      setDeletingProject(null);\r\n    } catch (error) {\r\n      console.error('Error eliminando proyecto:', error);\r\n      \r\n      // Si es un error 403 (Forbidden), mostrar modal de permisos denegados\r\n      if (error.status === 403 || error.message?.includes('No autorizado')) {\r\n        setDeletingProject(null); // Cerrar modal de confirmaci√≥n\r\n        setPermissionDeniedInfo({\r\n          action: \"eliminar proyectos\",\r\n          requiredRole: \"jefa comercial o soporte\",\r\n          currentRole: currentUser?.role || \"no autenticado\"\r\n        });\r\n        setShowPermissionDeniedModal(true);\r\n      } else {\r\n        setDeletingProject(null);\r\n      }\r\n    }\r\n  };\r\n\r\n\r\n  const handleViewQueries = (project) => {\r\n    setSelectedProject(project);\r\n    setShowQueriesModal(true);\r\n  };\r\n\r\n  const handleToggleMark = async (project) => {\r\n    setMarkingProject(project);\r\n  };\r\n\r\n  const confirmToggleMark = async () => {\r\n    try {\r\n      // Aqu√≠ implementar√≠as la l√≥gica para marcar/desmarcar\r\n      console.log('Marcar/desmarcar proyecto:', markingProject);\r\n      showNotification(`Proyecto ${markingProject.marked ? 'desmarcado' : 'marcado'}: ${markingProject.name}`, 'success');\r\n      setMarkingProject(null);\r\n    } catch (error) {\r\n      console.error('Error al marcar proyecto:', error);\r\n      showNotification('Error al marcar proyecto', 'danger');\r\n      setMarkingProject(null);\r\n    }\r\n  };\r\n\r\n  const handleUpdateStatus = (project) => {\r\n    setSelectedProject(project);\r\n    setShowStatusModal(true);\r\n  };\r\n\r\n  // Funci√≥n para abrir modal de solo lectura (Ver Proyecto)\r\n  const handleViewOnlyProject = (project) => {\r\n    setSelectedProject(project);\r\n    setShowViewOnlyModal(true);\r\n  };\r\n\r\n  // Funci√≥n para abrir modal de gesti√≥n completa\r\n  const handleViewProject = (project) => {\r\n    console.log('üîç handleViewProject - Project recibido:', project);\r\n    console.log('üîç handleViewProject - Project.id:', project?.id);\r\n    console.log('üîç handleViewProject - Type of project.id:', typeof project?.id);\r\n    console.log('üîç handleViewProject - Project.queries:', project?.queries);\r\n    console.log('üîç handleViewProject - Project.queries_history:', project?.queries_history);\r\n    \r\n    setSelectedProject(project);\r\n    \r\n    // Inicializar editingData con todos los campos del proyecto\r\n    const initialEditingData = {\r\n      ...project,\r\n      // Asegurar que los campos booleanos tengan valores por defecto\r\n      requiere_laboratorio: project.requiere_laboratorio || false,\r\n      requiere_ingenieria: project.requiere_ingenieria || false,\r\n      requiere_consultoria: project.requiere_consultoria || false,\r\n      requiere_capacitacion: project.requiere_capacitacion || false,\r\n      requiere_auditoria: project.requiere_auditoria || false,\r\n      marked: project.marked || false,\r\n      priority: project.priority || 'normal',\r\n      queries: project.queries || '',\r\n      contact_name: project.contact_name || '',\r\n      contact_phone: project.contact_phone || '',\r\n      contact_email: project.contact_email || '',\r\n      category_id: project.category_id || '',\r\n      subcategory_id: project.subcategory_id || '',\r\n      category_name: project.category_name || '',\r\n      subcategory_name: project.subcategory_name || '',\r\n      // Incluir IDs de usuarios asignados\r\n      vendedor_id: project.vendedor_id || '',\r\n      laboratorio_id: project.laboratorio_id || '',\r\n      // Inicializar historial de consultas\r\n      queries_history: (() => {\r\n        try {\r\n          console.log('üîç Parseando queries_history - project.queries_history:', project.queries_history);\r\n          console.log('üîç Parseando queries_history - project.queries:', project.queries);\r\n          \r\n          // Si project.queries_history existe y es un array, usarlo\r\n          if (project.queries_history && Array.isArray(project.queries_history)) {\r\n            console.log('‚úÖ Usando project.queries_history como array:', project.queries_history);\r\n            return project.queries_history;\r\n          }\r\n          \r\n          // Si project.queries es un JSON string, parsearlo\r\n          if (project.queries && typeof project.queries === 'string') {\r\n            try {\r\n              const parsed = JSON.parse(project.queries);\r\n              console.log('‚úÖ Parseado project.queries como JSON:', parsed);\r\n              if (Array.isArray(parsed)) {\r\n                return parsed;\r\n              }\r\n            } catch (jsonError) {\r\n              // Si no es JSON v√°lido, tratar como texto plano y crear un historial\r\n              console.log('‚ö†Ô∏è project.queries no es JSON v√°lido, tratando como texto plano');\r\n              if (project.queries.trim()) {\r\n                // Crear un historial con el texto existente\r\n                const historyEntry = {\r\n                  message: project.queries.trim(),\r\n                  user_name: 'Usuario Anterior',\r\n                  created_at: new Date().toISOString()\r\n                };\r\n                console.log('‚úÖ Creado historial desde texto plano:', historyEntry);\r\n                return [historyEntry];\r\n              }\r\n            }\r\n          }\r\n          \r\n          console.log('‚ö†Ô∏è No se encontr√≥ queries_history v√°lido, retornando array vac√≠o');\r\n          return [];\r\n        } catch (e) {\r\n          console.warn('‚ùå Error parseando queries_history:', e);\r\n          return [];\r\n        }\r\n      })()\r\n    };\r\n    \r\n    console.log('üîç handleViewProject - editingData inicializado:', initialEditingData);\r\n    setEditingData(initialEditingData);\r\n    \r\n    // Inicializar campos de b√∫squeda con los nombres de usuarios asignados\r\n    if (project.vendedor_name) {\r\n      setVendedorSearch(project.vendedor_name);\r\n    } else {\r\n      setVendedorSearch('');\r\n    }\r\n    \r\n    if (project.laboratorio_name) {\r\n      setLaboratorioSearch(project.laboratorio_name);\r\n    } else {\r\n      setLaboratorioSearch('');\r\n    }\r\n    \r\n    setActiveTab('info');\r\n    setShowViewModal(true);\r\n  };\r\n\r\n  const handleSubmit = async (formData) => {\r\n    if (editingProject.id) {\r\n      await updateMutation.mutateAsync({ id: editingProject.id, ...formData });\r\n    } else {\r\n      await createMutation.mutateAsync(formData);\r\n    }\r\n  };\r\n\r\n  const getStatusBadge = (status) => {\r\n    const statusConfig = {\r\n      'activo': { bg: 'success', text: 'Activo' },\r\n      'pendiente': { bg: 'warning', text: 'Pendiente' },\r\n      'completado': { bg: 'primary', text: 'Completado' },\r\n      'cancelado': { bg: 'danger', text: 'Cancelado' }\r\n    };\r\n    \r\n    const config = statusConfig[status] || { bg: 'secondary', text: status };\r\n    return <Badge bg={config.bg} className=\"status-badge\">{config.text}</Badge>;\r\n  };\r\n\r\n  const columns = [\r\n    {\r\n      header: 'ID',\r\n      accessor: 'id',\r\n      width: '60px'\r\n    },\r\n    {\r\n      header: 'Proyecto',\r\n      accessor: 'name',\r\n      render: (value, row) => (\r\n        <div>\r\n          <div className=\"fw-medium\">{row.name}</div>\r\n          {row.location && (\r\n            <small className=\"text-muted\">\r\n              <FiMapPin size={12} className=\"me-1\" />\r\n              {row.location}\r\n            </small>\r\n          )}\r\n          {/* Mostrar tipo de proyecto como badge peque√±o */}\r\n          {row.project_type && (\r\n            <div className=\"mt-1\">\r\n              <Badge bg=\"outline-secondary\" size=\"sm\" className=\"px-1 py-0 small\">\r\n                {row.project_type}\r\n              </Badge>\r\n            </div>\r\n          )}\r\n        </div>\r\n      )\r\n    },\r\n    {\r\n      header: 'Empresa',\r\n      accessor: 'company_name',\r\n      render: (value, row) => (\r\n        <div>\r\n          <div className=\"fw-medium\">{row.company_name || 'Sin empresa'}</div>\r\n          {row.contact_name && (\r\n            <small className=\"text-muted\">\r\n              <FiUser size={12} className=\"me-1\" />\r\n              {row.contact_name}\r\n            </small>\r\n          )}\r\n        </div>\r\n      )\r\n    },\r\n    {\r\n      header: 'Estado',\r\n      accessor: 'status',\r\n      width: '100px',\r\n      render: (value) => getStatusBadge(value || 'activo')\r\n    },\r\n    {\r\n      header: 'Servicios',\r\n      accessor: 'services',\r\n      width: '180px',\r\n      className: 'd-none d-lg-table-cell',\r\n      render: (value, row) => {\r\n        // Determinar servicio activo y su estado\r\n        if (row.requiere_laboratorio) {\r\n          const estadoLabMap = {\r\n            'no_requerido': 'N/A',\r\n            'pendiente': 'Pendiente',\r\n            'en_proceso': 'En Proceso',\r\n            'completado': 'Completado'\r\n          };\r\n          const estadoLab = estadoLabMap[row.laboratorio_status] || 'N/A';\r\n          return (\r\n            <div className=\"d-flex flex-column gap-1\">\r\n              <Badge bg=\"info\" size=\"sm\" className=\"px-2\">\r\n                üî¨ Laboratorio\r\n              </Badge>\r\n              <span className=\"small text-muted\">{estadoLab}</span>\r\n            </div>\r\n          );\r\n        }\r\n        \r\n        if (row.requiere_ingenieria) {\r\n          const estadoIngMap = {\r\n            'no_requerido': 'N/A',\r\n            'pendiente': 'Pendiente',\r\n            'en_proceso': 'En Proceso',\r\n            'completado': 'Completado'\r\n          };\r\n          const estadoIng = estadoIngMap[row.ingenieria_status] || 'N/A';\r\n          return (\r\n            <div className=\"d-flex flex-column gap-1\">\r\n              <Badge bg=\"primary\" size=\"sm\" className=\"px-2\">\r\n                ‚öôÔ∏è Ingenier√≠a\r\n              </Badge>\r\n              <span className=\"small text-muted\">{estadoIng}</span>\r\n            </div>\r\n          );\r\n        }\r\n        \r\n        if (row.requiere_consultoria) {\r\n          return (\r\n            <Badge bg=\"success\" size=\"sm\" className=\"px-2\">\r\n              üíº Consultor√≠a\r\n            </Badge>\r\n          );\r\n        }\r\n        \r\n        return (\r\n          <Badge bg=\"secondary\" size=\"sm\" className=\"px-1\">\r\n            N/A\r\n          </Badge>\r\n        );\r\n      }\r\n    },\r\n    {\r\n      header: 'Prioridad',\r\n      accessor: 'priority',\r\n      width: '100px',\r\n      render: (value, row) => {\r\n        const getPriorityDisplay = (priority) => {\r\n          switch (priority) {\r\n            case 'urgent':\r\n              return { emoji: 'üî¥', text: 'Urgente', color: 'text-danger' };\r\n            case 'high':\r\n              return { emoji: 'üü†', text: 'Alta', color: 'text-warning' };\r\n            case 'active':\r\n              return { emoji: 'üîµ', text: 'Activo', color: 'text-info' };\r\n            case 'low':\r\n              return { emoji: 'üîµ', text: 'Baja', color: 'text-primary' };\r\n            case 'normal':\r\n            default:\r\n              return { emoji: 'üü¢', text: 'Normal', color: 'text-success' };\r\n          }\r\n        };\r\n\r\n        const priorityInfo = getPriorityDisplay(row.priority);\r\n        \r\n        return (\r\n          <div className=\"d-flex align-items-center\">\r\n            <span className=\"me-1\" style={{ fontSize: '1em' }}>\r\n              {priorityInfo.emoji}\r\n            </span>\r\n            <span className={`small ${priorityInfo.color} fw-medium`}>\r\n              {priorityInfo.text}\r\n            </span>\r\n            {(row.priority === 'urgent' || row.priority === 'high') && row.requiere_laboratorio && (\r\n              <FiAlertTriangle className=\"text-warning ms-1\" size={12} />\r\n            )}\r\n          </div>\r\n        );\r\n      }\r\n    },\r\n    {\r\n      header: 'Asignado a',\r\n      accessor: 'vendedor_name',\r\n      className: 'd-none d-md-table-cell', // Ocultar en pantallas muy peque√±as\r\n      render: (value, row) => (\r\n        <div>\r\n          {row.vendedor_name && (\r\n            <div className=\"small\">\r\n              <FiUser size={12} className=\"me-1 text-muted\" />\r\n              <span>{row.vendedor_name}</span>\r\n            </div>\r\n          )}\r\n          {row.laboratorio_name && (\r\n            <div className=\"small text-muted mt-1\">\r\n              <FiHome size={12} className=\"me-1\" />\r\n              <span>{row.laboratorio_name}</span>\r\n            </div>\r\n          )}\r\n          {!row.vendedor_name && !row.laboratorio_name && (\r\n            <span className=\"text-muted small\">Sin asignar</span>\r\n          )}\r\n        </div>\r\n      )\r\n    },\r\n    {\r\n      header: 'Fecha',\r\n      accessor: 'created_at',\r\n      width: '100px',\r\n      className: 'd-none d-xl-table-cell', // Solo mostrar en pantallas grandes\r\n      render: (value) => {\r\n        if (!value) return '-';\r\n        const date = new Date(value);\r\n        return (\r\n          <div className=\"small\">\r\n            <div>{date.toLocaleDateString('es-ES')}</div>\r\n          </div>\r\n        );\r\n      }\r\n    }\r\n  ];\r\n\r\n  const formFields = [\r\n    {\r\n      name: 'company_id',\r\n      label: 'Empresa/Cliente',\r\n      type: 'select',\r\n      required: true,\r\n      options: data?.companies?.map(company => ({\r\n        value: company.id,\r\n        label: `${company.name} (${company.ruc || company.dni || 'Sin RUC/DNI'})`\r\n      })) || [],\r\n      description: 'Selecciona un cliente existente o crea uno nuevo desde el m√≥dulo de clientes'\r\n    },\r\n    {\r\n      name: 'name',\r\n      label: 'Nombre del Proyecto',\r\n      type: 'text',\r\n      required: true,\r\n      placeholder: 'Ingresa el nombre del proyecto'\r\n    },\r\n    {\r\n      name: 'location',\r\n      label: 'Ubicaci√≥n del Proyecto',\r\n      type: 'text',\r\n      placeholder: 'Ingresa la ubicaci√≥n del proyecto',\r\n      required: true\r\n    },\r\n    // Sistema de servicios moderno\r\n    {\r\n      name: 'contact_name',\r\n      label: 'Persona de Contacto',\r\n      type: 'text',\r\n      placeholder: 'Nombre de la persona con quien negociar',\r\n      description: 'Persona responsable del proyecto en el cliente'\r\n    },\r\n    {\r\n      name: 'contact_phone',\r\n      label: 'Tel√©fono de Contacto',\r\n      type: 'text',\r\n      placeholder: 'Tel√©fono para comunicaci√≥n directa',\r\n      description: 'N√∫mero para llamadas urgentes o seguimiento'\r\n    },\r\n    {\r\n      name: 'contact_email',\r\n      label: 'Email de Contacto',\r\n      type: 'email',\r\n      placeholder: 'Email para comunicaci√≥n',\r\n      description: 'Email para env√≠o de reportes y documentos'\r\n    },\r\n    {\r\n      name: 'requiere_laboratorio',\r\n      label: 'Requiere Laboratorio',\r\n      type: 'checkbox',\r\n      description: 'Marcar si el proyecto necesita servicios de laboratorio'\r\n    },\r\n    {\r\n      name: 'requiere_ingenieria',\r\n      label: 'Requiere Ingenier√≠a',\r\n      type: 'checkbox',\r\n      description: 'Marcar si el proyecto necesita servicios de ingenier√≠a'\r\n    },\r\n    {\r\n      name: 'requiere_consultoria',\r\n      label: 'Requiere Consultor√≠a',\r\n      type: 'checkbox',\r\n      description: 'Marcar si el proyecto necesita servicios de consultor√≠a'\r\n    },\r\n    {\r\n      name: 'requiere_capacitacion',\r\n      label: 'Requiere Capacitaci√≥n',\r\n      type: 'checkbox',\r\n      description: 'Marcar si el proyecto necesita servicios de capacitaci√≥n'\r\n    },\r\n    {\r\n      name: 'requiere_auditoria',\r\n      label: 'Requiere Auditor√≠a',\r\n      type: 'checkbox',\r\n      description: 'Marcar si el proyecto necesita servicios de auditor√≠a'\r\n    },\r\n    {\r\n      name: 'queries',\r\n      label: 'Consultas del Cliente',\r\n      type: 'textarea',\r\n      placeholder: 'Ingresa las consultas o dudas del cliente...',\r\n      description: 'Preguntas o dudas espec√≠ficas del cliente sobre el proyecto'\r\n    },\r\n    {\r\n      name: 'services',\r\n      label: 'Servicios del Proyecto',\r\n      type: 'custom',\r\n      component: (\r\n        <div>\r\n          <div className=\"mb-3\">\r\n            <Button \r\n              variant=\"outline-primary\" \r\n              onClick={() => setShowServiceForm(true)}\r\n              className=\"w-100\"\r\n            >\r\n              <FiSettings className=\"me-2\" />\r\n              {selectedServices.length > 0 \r\n                ? `Configurar Servicios (${selectedServices.length} seleccionados)` \r\n                : 'Seleccionar Servicios'\r\n              }\r\n            </Button>\r\n          </div>\r\n          {selectedServices.length > 0 && (\r\n            <div className=\"border rounded p-3 bg-light\">\r\n              <h6 className=\"mb-2\">Servicios Seleccionados:</h6>\r\n              {selectedServices.map((service, index) => (\r\n                <div key={index} className=\"mb-2 p-2 border rounded bg-white\">\r\n                  <div className=\"d-flex justify-content-between align-items-start\">\r\n                    <div>\r\n                      <strong>{service.ensayo.name}</strong>\r\n                      <div className=\"small text-muted\">\r\n                        {service.subservices.map(sub => sub.codigo).join(', ')}\r\n                      </div>\r\n                    </div>\r\n                    <div className=\"text-end\">\r\n                      <div className=\"fw-bold text-success\">\r\n                        S/ {service.total.toFixed(2)}\r\n                      </div>\r\n                      <Button \r\n                        variant=\"outline-danger\" \r\n                        size=\"sm\"\r\n                        onClick={() => {\r\n                          const newServices = selectedServices.filter((_, i) => i !== index);\r\n                          setSelectedServices(newServices);\r\n                        }}\r\n                      >\r\n                        <FiX size={12} />\r\n                      </Button>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              ))}\r\n              <div className=\"mt-2 pt-2 border-top\">\r\n                <div className=\"d-flex justify-content-between\">\r\n                  <strong>Subtotal:</strong>\r\n                  <strong>S/ {selectedServices.reduce((sum, service) => sum + service.total, 0).toFixed(2)}</strong>\r\n                </div>\r\n                <div className=\"d-flex justify-content-between\">\r\n                  <span>IGV (18%):</span>\r\n                  <span>S/ {(selectedServices.reduce((sum, service) => sum + service.total, 0) * 0.18).toFixed(2)}</span>\r\n                </div>\r\n                <div className=\"d-flex justify-content-between fw-bold text-success\">\r\n                  <span>Total:</span>\r\n                  <span>S/ {(selectedServices.reduce((sum, service) => sum + service.total, 0) * 1.18).toFixed(2)}</span>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          )}\r\n        </div>\r\n      )\r\n    },\r\n    {\r\n      name: 'priority',\r\n      label: 'Prioridad del Proyecto',\r\n      type: 'select',\r\n      options: [\r\n        { value: 'low', label: 'Baja' },\r\n        { value: 'normal', label: 'Normal' },\r\n        { value: 'high', label: 'Alta' },\r\n        { value: 'urgent', label: 'Urgente' }\r\n      ],\r\n      description: 'Nivel de prioridad para la ejecuci√≥n del proyecto'\r\n    },\r\n    {\r\n      name: 'vendedor_id',\r\n      label: 'Vendedor Asignado',\r\n      type: 'select',\r\n      options: usersData?.data?.filter(user => \r\n        user.role === 'vendedor_comercial'\r\n      ).map(user => ({\r\n        value: user.id,\r\n        label: `${user.name} ${user.apellido}`\r\n      })) || []\r\n    },\r\n    {\r\n      name: 'laboratorio_id',\r\n      label: 'Responsable de Laboratorio',\r\n      type: 'select',\r\n      options: usersData?.data?.filter(user => \r\n        user.role === 'usuario_laboratorio'\r\n      ).map(user => ({\r\n        value: user.id,\r\n        label: `${user.name} ${user.apellido}`\r\n      })) || []\r\n    },\r\n    // Campos duplicados eliminados - ya existen arriba en el formulario\r\n  ];\r\n\r\n  // Calcular estad√≠sticas\r\n  const stats = useMemo(() => {\r\n    if (statsData) {\r\n      console.log('üìä Stats - Usando estad√≠sticas reales del backend:', statsData);\r\n      return {\r\n        total: statsData.total || 0,\r\n        activos: statsData.activos || 0,\r\n        completados: statsData.completados || 0,\r\n        pendientes: statsData.pendientes || 0,\r\n        cancelados: statsData.cancelados || 0,\r\n        alta_prioridad: statsData.alta_prioridad || 0\r\n      };\r\n    }\r\n    // Fallback: calcular desde los datos de la p√°gina actual\r\n    const projects = data?.data || [];\r\n    console.log('üìä Stats - Fallback: calculando desde p√°gina actual:', projects);\r\n    return {\r\n      total: projects.length,\r\n      activos: projects.filter(p => p.status === 'activo').length,\r\n      completados: projects.filter(p => p.status === 'completado').length,\r\n      pendientes: projects.filter(p => p.status === 'pendiente').length,\r\n      cancelados: projects.filter(p => p.status === 'cancelado').length,\r\n      alta_prioridad: projects.filter(p => p.priority === 'urgent' || p.priority === 'high').length\r\n    };\r\n  }, [statsData, data]);\r\n\r\n  return (\r\n    <>\r\n      <Container fluid className=\"py-4\">\r\n        <div className=\"fade-in\">\r\n          <PageHeader\r\n            title=\"Gesti√≥n de Proyectos\"\r\n            subtitle={selectedClient ? `Crear proyecto para: ${selectedClient.name}` : \"Crear, editar y gestionar proyectos del sistema\"}\r\n            icon={FiHome}\r\n            actions={\r\n              <div className=\"d-flex gap-2\">\r\n                {selectedClient && (\r\n                  <Badge bg=\"info\" className=\"px-3 py-2 d-flex align-items-center\">\r\n                    <FiUser className=\"me-1\" />\r\n                    Cliente: {selectedClient.name}\r\n                  </Badge>\r\n                )}\r\n                <Button variant=\"primary\" onClick={() => setShowNewForm(true)}>\r\n                  <FiPlus className=\"me-2\" />\r\n                  {selectedClient ? 'Crear Proyecto' : 'Nuevo Proyecto'}\r\n                </Button>\r\n              </div>\r\n            }\r\n          />\r\n\r\n          {/* Estad√≠sticas */}\r\n          <Row className=\"g-2 mb-4\">\r\n          <Col md={6} lg={3}>\r\n            <StatsCard\r\n              title=\"Total Proyectos\"\r\n              value={stats.total}\r\n              icon={FiHome}\r\n              color=\"primary\"\r\n              subtitle=\"Proyectos registrados\"\r\n              loading={statsLoading}\r\n              size=\"compact\"\r\n            />\r\n          </Col>\r\n          <Col md={6} lg={3}>\r\n            <StatsCard\r\n              title=\"Proyectos Activos\"\r\n              value={stats.activos}\r\n              icon={FiCheckCircle}\r\n              color=\"success\"\r\n              subtitle=\"En desarrollo\"\r\n              loading={statsLoading}\r\n              size=\"compact\"\r\n            />\r\n          </Col>\r\n          <Col md={6} lg={3}>\r\n            <StatsCard\r\n              title=\"Alta Prioridad\"\r\n              value={stats.alta_prioridad || 0}\r\n              icon={FiAlertTriangle}\r\n              color=\"danger\"\r\n              subtitle=\"üî¥ Urgente + üü† Alta\"\r\n              loading={statsLoading}\r\n              size=\"compact\"\r\n            />\r\n          </Col>\r\n          <Col md={6} lg={3}>\r\n            <StatsCard\r\n              title=\"Pendientes\"\r\n              value={stats.pendientes}\r\n              icon={FiClock}\r\n              color=\"warning\"\r\n              subtitle=\"Por iniciar\"\r\n              loading={statsLoading}\r\n              size=\"compact\"\r\n            />\r\n          </Col>\r\n        </Row>\r\n\r\n        {/* Tabla de proyectos */}\r\n        <Card className=\"shadow-sm border-0\">\r\n          <Card.Header className=\"bg-white border-bottom\">\r\n            <div className=\"d-flex justify-content-between align-items-center\">\r\n              <h5 className=\"mb-0\">\r\n                <FiHome className=\"me-2 text-primary\" />\r\n                Lista de Proyectos\r\n              </h5>\r\n              <div className=\"d-flex align-items-center gap-2\">\r\n                <Button\r\n                  variant=\"outline-secondary\"\r\n                  size=\"sm\"\r\n                  onClick={() => refetch()}\r\n                  className=\"d-flex align-items-center\"\r\n                  title=\"Actualizar datos\"\r\n                >\r\n                  <FiRefreshCw className={`${isLoading ? 'spinning' : ''}`} />\r\n                </Button>\r\n              <Badge bg=\"light\" text=\"dark\" className=\"px-3 py-2\">\r\n                {stats.total} proyectos\r\n              </Badge>\r\n              </div>\r\n            </div>\r\n          </Card.Header>\r\n          <Card.Body className=\"p-0\">\r\n            <DataTable\r\n              data={data?.data || []}\r\n              columns={columns}\r\n              loading={isLoading || isSearching}\r\n              actions={[\r\n                { \r\n                  label: 'Ver', \r\n                  icon: FiEye, \r\n                  onClick: handleViewOnlyProject, \r\n                  variant: 'primary',\r\n                  style: { backgroundColor: '#f84616', borderColor: '#f84616' }\r\n                },\r\n                { \r\n                  label: 'Eliminar', \r\n                  icon: FiTrash2, \r\n                  onClick: handleDelete, \r\n                  variant: 'outline-danger' \r\n                }\r\n              ]}\r\n              emptyMessage=\"No hay proyectos registrados\"\r\n              // Props para paginaci√≥n del backend\r\n              totalItems={data?.total || 0}\r\n              itemsPerPage={20}\r\n              currentPage={currentPage}\r\n              onPageChange={setCurrentPage}\r\n              onSearch={handleSearch}\r\n              onFilter={handleFilter}\r\n              // Filtros espec√≠ficos para proyectos\r\n              filterOptions={projectFilterOptions}\r\n              // Funci√≥n para estilos de fila\r\n              getRowClassName={(project) => {\r\n                if (project.status === 'cancelado') {\r\n                  return 'table-secondary opacity-50 text-muted';\r\n                }\r\n                return '';\r\n              }}\r\n            />\r\n          </Card.Body>\r\n        </Card>\r\n\r\n      <ModalForm\r\n        show={showModal}\r\n        onHide={() => setShowModal(false)}\r\n        title={editingProject?.id ? 'Editar Proyecto' : 'Nuevo Proyecto'}\r\n        data={editingProject || emptyForm}\r\n        fields={formFields}\r\n        onSubmit={handleSubmit}\r\n        loading={createMutation.isLoading || updateMutation.isLoading}\r\n        submitText={editingProject?.id ? 'Actualizar' : 'Crear'}\r\n      />\r\n\r\n      {/* Modal Redise√±ado para Gestionar Proyecto */}\r\n      <ModalForm\r\n        show={showViewModal}\r\n        onHide={() => setShowViewModal(false)}\r\n        title={`üìã Gestionar Proyecto - ${selectedProject?.name || ''}`}\r\n        data={{\r\n          ...editingData,\r\n          queries_history: Array.isArray(editingData?.queries_history) ? editingData.queries_history : []\r\n        }}\r\n        size=\"xl\"\r\n        fields={[\r\n          {\r\n            name: 'project_management',\r\n            label: 'Gesti√≥n del Proyecto',\r\n            type: 'custom',\r\n            render: (project) => (\r\n              <div className=\"project-management-modal\">\r\n                  <style>{`\r\n                  .project-management-modal {\r\n                    font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif;\r\n                  }\r\n                  .project-header {\r\n                    background: #f84616;\r\n                    color: white;\r\n                    padding: 1.5rem;\r\n                    border-radius: 12px;\r\n                    margin-bottom: 2rem;\r\n                    box-shadow: 0 8px 25px rgba(248, 70, 22, 0.3);\r\n                  }\r\n                  .project-header h4 {\r\n                    margin: 0;\r\n                    font-weight: 600;\r\n                    font-size: 1.5rem;\r\n                  }\r\n                  .project-header .project-id {\r\n                    background: rgba(255, 255, 255, 0.2);\r\n                    padding: 0.5rem 1rem;\r\n                    border-radius: 20px;\r\n                    font-size: 0.9rem;\r\n                    margin-top: 0.5rem;\r\n                    display: inline-block;\r\n                  }\r\n                  .info-card {\r\n                    background: white;\r\n                    border-radius: 12px;\r\n                    padding: 1.5rem;\r\n                    margin-bottom: 1.5rem;\r\n                    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);\r\n                    border: 1px solid #e9ecef;\r\n                  }\r\n                  .info-card h6 {\r\n                    color: #495057;\r\n                    font-weight: 600;\r\n                      margin-bottom: 1rem;\r\n                    padding-bottom: 0.5rem;\r\n                    border-bottom: 2px solid #f8f9fa;\r\n                  }\r\n                  .info-grid {\r\n                    display: grid;\r\n                    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));\r\n                    gap: 1rem;\r\n                  }\r\n                  .info-item {\r\n                    display: flex;\r\n                    flex-direction: column;\r\n                    gap: 0.25rem;\r\n                    }\r\n                    .info-item label {\r\n                      font-size: 0.75rem;\r\n                      font-weight: 600;\r\n                    color: #6c757d;\r\n                      text-transform: uppercase;\r\n                      letter-spacing: 0.5px;\r\n                  }\r\n                  .info-item .value {\r\n                    font-weight: 500;\r\n                    color: #212529;\r\n                    font-size: 0.95rem;\r\n                  }\r\n                  .priority-badge {\r\n                    display: inline-flex;\r\n                    align-items: center;\r\n                    gap: 0.5rem;\r\n                    padding: 0.5rem 1rem;\r\n                    border-radius: 20px;\r\n                    font-weight: 600;\r\n                    font-size: 0.85rem;\r\n                  }\r\n                  .priority-urgent { background: #fee2e2; color: #dc2626; }\r\n                  .priority-high { background: #fef3c7; color: #d97706; }\r\n                  .priority-normal { background: #d1fae5; color: #059669; }\r\n                  .priority-low { background: #e0e7ff; color: #3730a3; }\r\n                  .status-badge {\r\n                    padding: 0.5rem 1rem;\r\n                    border-radius: 20px;\r\n                    font-weight: 600;\r\n                    font-size: 0.85rem;\r\n                  }\r\n                  .status-pendiente { background: #fef3c7; color: #d97706; }\r\n                  .status-activo { background: #d1fae5; color: #059669; }\r\n                  .status-completado { background: #dbeafe; color: #2563eb; }\r\n                  .status-cancelado { background: #fee2e2; color: #dc2626; }\r\n                  .form-control, .form-select {\r\n                    border-radius: 8px;\r\n                    border: 1px solid #d1d5db;\r\n                    padding: 0.75rem;\r\n                    font-size: 0.9rem;\r\n                    transition: all 0.2s ease;\r\n                  }\r\n                  .form-control:focus, .form-select:focus {\r\n                    border-color: #f84616;\r\n                    box-shadow: 0 0 0 3px rgba(248, 70, 22, 0.1);\r\n                  }\r\n                  .btn-primary {\r\n                    background: #f84616;\r\n                    border: none;\r\n                    border-radius: 8px;\r\n                    padding: 0.75rem 2rem;\r\n                    font-weight: 600;\r\n                    transition: all 0.2s ease;\r\n                  }\r\n                  .btn-primary:hover {\r\n                    background: #e03d14;\r\n                    transform: translateY(-2px);\r\n                    box-shadow: 0 8px 25px rgba(248, 70, 22, 0.3);\r\n                  }\r\n                  .btn-secondary {\r\n                    border-radius: 8px;\r\n                    padding: 0.75rem 2rem;\r\n                    font-weight: 600;\r\n                  }\r\n                  .file-upload-area {\r\n                    border: 2px dashed #d1d5db;\r\n                    border-radius: 12px;\r\n                    padding: 2rem;\r\n                    text-align: center;\r\n                    background: #f9fafb;\r\n                    transition: all 0.2s ease;\r\n                    cursor: pointer;\r\n                  }\r\n                  .file-upload-area:hover {\r\n                    border-color: #f84616;\r\n                    background: #fff5f2;\r\n                  }\r\n                  .file-item {\r\n                    background: white;\r\n                    border: 1px solid #e5e7eb;\r\n                    border-radius: 8px;\r\n                    padding: 1rem;\r\n                    margin-bottom: 0.5rem;\r\n                    display: flex;\r\n                    align-items: center;\r\n                    justify-content: space-between;\r\n                  }\r\n                  .file-item:hover {\r\n                    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);\r\n                    }\r\n                  `}</style>\r\n                \r\n                <div className=\"project-header\">\r\n                  <h4>üìã {project.name}</h4>\r\n                  <div className=\"project-id\">ID: #{project.id}</div>\r\n                </div>\r\n\r\n                  <div className=\"row g-4\">\r\n                    {/* Informaci√≥n Principal */}\r\n                    <div className=\"col-lg-8\">\r\n                    <div className=\"info-card\">\r\n                      <h6>üìä Informaci√≥n del Proyecto</h6>\r\n                      <div className=\"info-grid\">\r\n                              <div className=\"info-item\">\r\n                          <label>Ubicaci√≥n</label>\r\n                          <div className=\"value\">{project.location || 'No especificada'}</div>\r\n                              </div>\r\n                              <div className=\"info-item\">\r\n                          <label>Estado Actual</label>\r\n                          <div>\r\n                            <span className={`status-badge status-${project.status || 'pendiente'}`}>\r\n                              {project.status === 'pendiente' ? 'Pendiente' :\r\n                               project.status === 'activo' ? 'Activo' :\r\n                               project.status === 'completado' ? 'Completado' :\r\n                               project.status === 'cancelado' ? 'Cancelado' : project.status}\r\n                            </span>\r\n                              </div>\r\n                            </div>\r\n                              <div className=\"info-item\">\r\n                          <label>Prioridad</label>\r\n                                <div>\r\n                            <span className={`priority-badge priority-${project.priority || 'normal'}`}>\r\n                              {project.priority === 'urgent' ? 'üî¥ Urgente' :\r\n                               project.priority === 'high' ? 'üü† Alta' :\r\n                               project.priority === 'normal' ? 'üü¢ Normal' :\r\n                               project.priority === 'low' ? 'üîµ Baja' : 'üü¢ Normal'}\r\n                            </span>\r\n                                </div>\r\n                              </div>\r\n                            </div>\r\n                    </div>\r\n\r\n                    <div className=\"info-card\">\r\n                      <h6>üè¢ Informaci√≥n de la Empresa</h6>\r\n                      <div className=\"info-grid\">\r\n                              <div className=\"info-item\">\r\n                          <label>Empresa</label>\r\n                          <div className=\"value fw-bold\">{project.company_name || 'Sin empresa'}</div>\r\n                                </div>\r\n                        <div className=\"info-item\">\r\n                          <label>RUC</label>\r\n                          <div className=\"value\">{project.company_ruc || 'Sin RUC'}</div>\r\n                              </div>\r\n                        <div className=\"info-item\">\r\n                          <label>Contacto</label>\r\n                          <div className=\"value fw-bold\">{project.contact_name || 'Sin contacto'}</div>\r\n                            </div>\r\n                        <div className=\"info-item\">\r\n                          <label>Tel√©fono</label>\r\n                          <div className=\"value\">{project.contact_phone || 'Sin tel√©fono'}</div>\r\n                          </div>\r\n                        <div className=\"info-item\">\r\n                          <label>Email</label>\r\n                          <div className=\"value\">{project.contact_email || 'Sin email'}</div>\r\n                        </div>\r\n                        <div className=\"info-item\">\r\n                          <label>Vendedor Asignado</label>\r\n                          <div className=\"position-relative\">\r\n                            <input\r\n                              type=\"text\"\r\n                              className=\"form-control form-control-sm\"\r\n                              placeholder=\"Buscar vendedor...\"\r\n                              value={vendedorSearch}\r\n                              onChange={(e) => {\r\n                                setVendedorSearch(e.target.value);\r\n                                setShowVendedorDropdown(true);\r\n                              }}\r\n                              onFocus={() => setShowVendedorDropdown(true)}\r\n                            />\r\n                            {showVendedorDropdown && (\r\n                              <div className=\"position-absolute w-100 bg-white border rounded shadow-lg\" style={{zIndex: 1000, maxHeight: '200px', overflowY: 'auto'}}>\r\n                                {getFilteredVendedores().length > 0 ? (\r\n                                  getFilteredVendedores().map(user => (\r\n                                    <div\r\n                                      key={user.id}\r\n                                      className=\"p-2 border-bottom cursor-pointer hover-bg-light\"\r\n                                      onClick={() => handleVendedorSelect(user)}\r\n                                      style={{cursor: 'pointer'}}\r\n                                    >\r\n                                      <div className=\"fw-bold\">{user.name} {user.apellido}</div>\r\n                                      <div className=\"small text-muted\">\r\n                                        üìß {user.email}\r\n                                        {user.phone && <span> ‚Ä¢ üìû {user.phone}</span>}\r\n                      </div>\r\n                                      <div className=\"small\">\r\n                                        <span className=\"badge bg-primary\">\r\n                                          Vendedor Comercial\r\n                                        </span>\r\n                    </div>\r\n                        </div>\r\n                                  ))\r\n                                ) : (\r\n                                  <div className=\"p-2 text-muted\">No se encontraron vendedores</div>\r\n                              )}\r\n                            </div>\r\n                            )}\r\n                          </div>\r\n                            </div>\r\n                        <div className=\"info-item\">\r\n                          <label>Responsable Laboratorio</label>\r\n                          <div className=\"position-relative\">\r\n                              <input \r\n                                type=\"text\" \r\n                              className=\"form-control form-control-sm\"\r\n                              placeholder=\"Buscar responsable de laboratorio...\"\r\n                              value={laboratorioSearch}\r\n                              onChange={(e) => {\r\n                                setLaboratorioSearch(e.target.value);\r\n                                setShowLaboratorioDropdown(true);\r\n                              }}\r\n                              onFocus={() => setShowLaboratorioDropdown(true)}\r\n                            />\r\n                            {showLaboratorioDropdown && (\r\n                              <div className=\"position-absolute w-100 bg-white border rounded shadow-lg\" style={{zIndex: 1000, maxHeight: '200px', overflowY: 'auto'}}>\r\n                                {getFilteredLaboratorio().length > 0 ? (\r\n                                  getFilteredLaboratorio().map(user => (\r\n                                    <div\r\n                                      key={user.id}\r\n                                      className=\"p-2 border-bottom cursor-pointer hover-bg-light\"\r\n                                      onClick={() => handleLaboratorioSelect(user)}\r\n                                      style={{cursor: 'pointer'}}\r\n                                    >\r\n                                      <div className=\"fw-bold\">{user.name} {user.apellido}</div>\r\n                                      <div className=\"small text-muted\">\r\n                                        üìß {user.email}\r\n                                        {user.phone && <span> ‚Ä¢ üìû {user.phone}</span>}\r\n                            </div>\r\n                                      <div className=\"small\">\r\n                                        <span className=\"badge bg-info\">\r\n                                          Usuario Laboratorio\r\n                                        </span>\r\n                            </div>\r\n                            </div>\r\n                                  ))\r\n                                ) : (\r\n                                  <div className=\"p-2 text-muted\">No se encontraron responsables de laboratorio</div>\r\n                                )}\r\n                            </div>\r\n                            )}\r\n                            </div>\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n\r\n                  {/* Panel de Control */}\r\n                  <div className=\"col-lg-4\">\r\n                    <div className=\"info-card\">\r\n                      <h6>‚öôÔ∏è Configuraci√≥n R√°pida</h6>\r\n                      <div className=\"d-grid gap-3\">\r\n                        <div>\r\n                          <label className=\"form-label small fw-bold\">Estado del Proyecto</label>\r\n                            <select \r\n                              className=\"form-select\" \r\n                            value={editingData.status || 'pendiente'} \r\n                              onChange={(e) => setEditingData({...editingData, status: e.target.value})}\r\n                            >\r\n                            <option value=\"pendiente\">üü° Pendiente</option>\r\n                            <option value=\"activo\">üü¢ Activo</option>\r\n                            <option value=\"en_proceso\">üîµ En Proceso</option>\r\n                            <option value=\"completado\">‚úÖ Completado</option>\r\n                            <option value=\"pausado\">‚è∏Ô∏è Pausado</option>\r\n                            <option value=\"cancelado\">‚ùå Cancelado</option>\r\n                            </select>\r\n                          </div>\r\n                        \r\n                        <div>\r\n                          <label className=\"form-label small fw-bold\">Prioridad</label>\r\n                            <select \r\n                              className=\"form-select\" \r\n                              value={editingData.priority || 'normal'} \r\n                              onChange={(e) => setEditingData({...editingData, priority: e.target.value})}\r\n                            >\r\n                            <option value=\"low\">üîµ Baja</option>\r\n                            <option value=\"normal\">üü¢ Normal</option>\r\n                              <option value=\"high\">üü† Alta</option>\r\n                              <option value=\"urgent\">üî¥ Urgente</option>\r\n                            </select>\r\n                          </div>\r\n\r\n                        <div>\r\n                          <label className=\"form-label small fw-bold\">\r\n                            Estado Laboratorio\r\n                            {editingData.ingenieria_status && editingData.ingenieria_status !== 'no_requerido' && (\r\n                              <span className=\"text-muted small ms-2\">(Bloqueado - Ingenier√≠a activa)</span>\r\n                            )}\r\n                          </label>\r\n                            <select \r\n                              className=\"form-select\" \r\n                              disabled={editingData.ingenieria_status && editingData.ingenieria_status !== 'no_requerido'}\r\n                              value={editingData.laboratorio_status || 'no_requerido'} \r\n                              onChange={(e) => {\r\n                                const newValue = e.target.value;\r\n                                // Si se activa laboratorio (no es \"no_requerido\"), desactivar ingenier√≠a\r\n                                if (newValue !== 'no_requerido') {\r\n                                  setEditingData({\r\n                                    ...editingData, \r\n                                    laboratorio_status: newValue,\r\n                                    ingenieria_status: 'no_requerido',\r\n                                    requiere_laboratorio: true,\r\n                                    requiere_ingenieria: false\r\n                                  });\r\n                                } else {\r\n                                  setEditingData({\r\n                                    ...editingData, \r\n                                    laboratorio_status: newValue,\r\n                                    requiere_laboratorio: false\r\n                                  });\r\n                                }\r\n                              }}\r\n                            >\r\n                              <option value=\"no_requerido\">No Requerido</option>\r\n                              <option value=\"pendiente\">Pendiente</option>\r\n                              <option value=\"en_proceso\">En Proceso</option>\r\n                              <option value=\"completado\">Completado</option>\r\n                            </select>\r\n                          </div>\r\n\r\n                        <div>\r\n                          <label className=\"form-label small fw-bold\">\r\n                            Estado Ingenier√≠a\r\n                            {editingData.laboratorio_status && editingData.laboratorio_status !== 'no_requerido' && (\r\n                              <span className=\"text-muted small ms-2\">(Bloqueado - Laboratorio activo)</span>\r\n                            )}\r\n                          </label>\r\n                            <select \r\n                              className=\"form-select\" \r\n                              disabled={editingData.laboratorio_status && editingData.laboratorio_status !== 'no_requerido'}\r\n                              value={editingData.ingenieria_status || 'no_requerido'} \r\n                              onChange={(e) => {\r\n                                const newValue = e.target.value;\r\n                                // Si se activa ingenier√≠a (no es \"no_requerido\"), desactivar laboratorio\r\n                                if (newValue !== 'no_requerido') {\r\n                                  setEditingData({\r\n                                    ...editingData, \r\n                                    ingenieria_status: newValue,\r\n                                    laboratorio_status: 'no_requerido',\r\n                                    requiere_ingenieria: true,\r\n                                    requiere_laboratorio: false\r\n                                  });\r\n                                } else {\r\n                                  setEditingData({\r\n                                    ...editingData, \r\n                                    ingenieria_status: newValue,\r\n                                    requiere_ingenieria: false\r\n                                  });\r\n                                }\r\n                              }}\r\n                            >\r\n                              <option value=\"no_requerido\">No Requerido</option>\r\n                              <option value=\"pendiente\">Pendiente</option>\r\n                              <option value=\"en_proceso\">En Proceso</option>\r\n                              <option value=\"completado\">Completado</option>\r\n                            </select>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n\r\n                    <div className=\"info-card\">\r\n                      <h6>üìÖ Fechas</h6>\r\n                      <div className=\"d-grid gap-2\">\r\n                        <div className=\"d-flex align-items-center gap-2\">\r\n                          <FiCalendar className=\"text-muted\" size={16} />\r\n                          <div>\r\n                            <div className=\"small text-muted\">Creado</div>\r\n                            <div className=\"fw-bold\">{new Date(project.created_at).toLocaleDateString()}</div>\r\n                        </div>\r\n                          </div>\r\n                        <div className=\"d-flex align-items-center gap-2\">\r\n                          <FiClock className=\"text-muted\" size={16} />\r\n                          <div>\r\n                            <div className=\"small text-muted\">Actualizado</div>\r\n                            <div className=\"fw-bold\">{new Date(project.updated_at).toLocaleDateString()}</div>\r\n                          </div>\r\n                          </div>\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n\r\n                    {/* Notas y Consultas */}\r\n                <div className=\"row g-4 mt-2\">\r\n                            <div className=\"col-md-6\">\r\n                    <div className=\"info-card\">\r\n                      <h6>üìù Notas del Estado</h6>\r\n                              <textarea \r\n                                className=\"form-control\" \r\n                                rows=\"4\"\r\n                                value={editingData.status_notes || ''} \r\n                                onChange={(e) => setEditingData({...editingData, status_notes: e.target.value})}\r\n                                placeholder=\"Agrega comentarios sobre el estado del proyecto...\"\r\n                              />\r\n                    </div>\r\n                            </div>\r\n                            <div className=\"col-md-6\">\r\n                    <div className=\"info-card\">\r\n                      <h6>‚ùì Consultas del Cliente</h6>\r\n                      \r\n                      {/* √Årea de comentarios existentes */}\r\n                      <div className=\"mb-3\" style={{ maxHeight: '200px', overflowY: 'auto' }}>\r\n                        {editingData.queries_history && Array.isArray(editingData.queries_history) && editingData.queries_history.length > 0 ? (\r\n                          editingData.queries_history.map((comment, index) => {\r\n                            // Color consistente por usuario\r\n                            const getUserColor = (userName) => {\r\n                              const colors = ['#3b82f6', '#ef4444']; // Azul y Rojo\r\n                              const hash = userName.split('').reduce((a, b) => {\r\n                                a = ((a << 5) - a) + b.charCodeAt(0);\r\n                                return a & a;\r\n                              }, 0);\r\n                              return colors[Math.abs(hash) % colors.length];\r\n                            };\r\n                            \r\n                            const color = getUserColor(comment.user_name || 'Usuario');\r\n                            \r\n                            return (\r\n                              <div key={index} className=\"mb-2 p-2 bg-light rounded border-start border-3\" style={{ borderLeftColor: color }}>\r\n                                <div className=\"d-flex justify-content-between align-items-start mb-1\">\r\n                                  <small className=\"fw-bold\" style={{ color: color }}>\r\n                                    üë§ {comment.user_name || 'Usuario'}\r\n                                  </small>\r\n                                  <small className=\"text-muted\">\r\n                                    {new Date(comment.created_at).toLocaleString('es-ES', {\r\n                                      day: '2-digit',\r\n                                      month: '2-digit',\r\n                                      hour: '2-digit',\r\n                                      minute: '2-digit'\r\n                                    })}\r\n                                  </small>\r\n                                </div>\r\n                                <div className=\"small\">{comment.message}</div>\r\n                              </div>\r\n                            );\r\n                          })\r\n                        ) : (\r\n                          <div className=\"text-center text-muted py-3\">\r\n                            <small>No hay consultas registradas</small>\r\n                          </div>\r\n                        )}\r\n                      </div>\r\n                      \r\n                      {/* √Årea para agregar nueva consulta */}\r\n                      <div className=\"border-top pt-3\">\r\n                        <label className=\"form-label small fw-bold\">Agregar consulta:</label>\r\n                        <textarea \r\n                          className=\"form-control\" \r\n                          rows=\"3\"\r\n                          value={newQuery} \r\n                          onChange={(e) => setNewQuery(e.target.value)}\r\n                          placeholder=\"Escribe una nueva consulta o respuesta...\"\r\n                        />\r\n                        <div className=\"d-flex justify-content-end mt-2\">\r\n                          <Button\r\n                            variant=\"primary\"\r\n                            size=\"sm\"\r\n                            onClick={() => {\r\n                              if (newQuery && newQuery.trim()) {\r\n                                const newComment = {\r\n                                  message: newQuery.trim(),\r\n                                  user_name: user?.name || 'Usuario',\r\n                                  created_at: new Date().toISOString()\r\n                                };\r\n                                \r\n                                const updatedHistory = [\r\n                                  ...(editingData.queries_history || []),\r\n                                  newComment\r\n                                ];\r\n                                \r\n                                setEditingData({\r\n                                  ...editingData,\r\n                                  queries_history: updatedHistory,\r\n                                  queries: JSON.stringify(updatedHistory) // Enviar como JSON string al backend\r\n                                });\r\n                                \r\n                                setNewQuery(''); // Limpiar el campo\r\n                              }\r\n                            }}\r\n                            disabled={!newQuery || !newQuery.trim()}\r\n                          >\r\n                            <FiMessageSquare className=\"me-1\" />\r\n                            Agregar\r\n                          </Button>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                          </div>\r\n                        </div>\r\n\r\n                {/* Archivos Adjuntos */}\r\n                <div className=\"info-card mt-3\">\r\n                  <h6>üìé Archivos Adjuntos</h6>\r\n                  \r\n                  {/* Subir Archivo */}\r\n                  <div className=\"file-upload-area mb-3\" onClick={() => document.getElementById('fileInput').click()}>\r\n                    <FiUpload size={32} className=\"text-muted mb-2\" />\r\n                    <div className=\"fw-bold text-muted\">Hacer clic para subir archivo</div>\r\n                    <div className=\"small text-muted\">PDF, Word, Excel, PowerPoint, Im√°genes (m√°x. 10MB)</div>\r\n                    <input \r\n                      type=\"file\" \r\n                      id=\"fileInput\"\r\n                      style={{ display: 'none' }}\r\n                      onChange={handleFileSelect}\r\n                      accept=\".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.jpg,.jpeg,.png,.gif,.txt\"\r\n                    />\r\n                      </div>\r\n                  \r\n                  {selectedFile && (\r\n                    <div className=\"alert alert-info d-flex align-items-center mb-3\">\r\n                      <FiFileText className=\"me-2\" />\r\n                      <div>\r\n                        <strong>{selectedFile.name}</strong>\r\n                        <br />\r\n                        <small>üìè {(selectedFile.size / 1024 / 1024).toFixed(2)} MB</small>\r\n                    </div>\r\n                      <Button \r\n                        variant=\"primary\" \r\n                        size=\"sm\"\r\n                        onClick={handleFileUpload}\r\n                        disabled={uploadingFile}\r\n                        className=\"ms-auto\"\r\n                      >\r\n                        <FiUpload className=\"me-1\" />\r\n                        {uploadingFile ? 'Subiendo...' : 'Subir'}\r\n                      </Button>\r\n                    </div>\r\n                  )}\r\n                  \r\n                  {/* Lista de Archivos */}\r\n                  {attachments.length === 0 ? (\r\n                    <div className=\"text-center py-4 text-muted\">\r\n                      <FiFolder size={48} className=\"mb-2 opacity-50\" />\r\n                      <div>No hay archivos adjuntos</div>\r\n                      <small>Sube cotizaciones, documentos t√©cnicos, planos, etc.</small>\r\n                    </div>\r\n                  ) : (\r\n                    <div className=\"row g-2\">\r\n                      {attachments.map((attachment) => (\r\n                        <div key={attachment.id} className=\"col-12\">\r\n                          <div className=\"file-item\">\r\n                            <div className=\"d-flex align-items-center\">\r\n                              <FiFileText className=\"text-primary me-3\" size={20} />\r\n                              <div>\r\n                                <div className=\"fw-bold\">{attachment.original_name}</div>\r\n                                <div className=\"small text-muted\">\r\n                                  üìè {attachment.file_size ? `${(attachment.file_size / 1024 / 1024).toFixed(2)} MB` : 'N/A'}\r\n                                  <span className=\"mx-2\">‚Ä¢</span>\r\n                                  üìÖ {new Date(attachment.created_at).toLocaleDateString()}\r\n                                  <span className=\"mx-2\">‚Ä¢</span>\r\n                                  üë§ {attachment.uploaded_by_name || 'Usuario'}\r\n                                </div>\r\n                                {attachment.description && (\r\n                                  <div className=\"small text-muted mt-1\">{attachment.description}</div>\r\n                                )}\r\n                              </div>\r\n                            </div>\r\n                            <div className=\"d-flex gap-2\">\r\n                        <Button \r\n                                variant=\"outline-primary\" \r\n                                size=\"sm\"\r\n                                onClick={() => handleFileDownload(attachment)}\r\n                              >\r\n                                <FiDownload size={14} />\r\n                              </Button>\r\n                              <Button \r\n                                variant=\"outline-danger\" \r\n                                size=\"sm\"\r\n                                onClick={() => handleFileDelete(attachment.id)}\r\n                              >\r\n                                <FiTrash2 size={14} />\r\n                              </Button>\r\n                            </div>\r\n                          </div>\r\n                        </div>\r\n                      ))}\r\n                    </div>\r\n                  )}\r\n                </div>\r\n\r\n                {/* Botones de Acci√≥n */}\r\n                <div className=\"d-flex justify-content-between align-items-center gap-3 mt-4 pt-3 border-top\">\r\n                  <div>\r\n                    {selectedProject?.quote_id && (\r\n                      <Button\r\n                        variant=\"outline-info\"\r\n                        onClick={() => navigate(`/cotizaciones?view=${selectedProject.quote_id}`)}\r\n                        className=\"px-3\"\r\n                      >\r\n                        <FiFileText className=\"me-2\" />\r\n                        üìÑ Ver Cotizaci√≥n Relacionada\r\n                      </Button>\r\n                    )}\r\n                  </div>\r\n                    </div>\r\n                  </div>\r\n            )\r\n          }\r\n        ]}\r\n        onSubmit={() => {\r\n          const projectId = selectedProject?.id;\r\n          \r\n          if (!projectId) {\r\n            showNotification('‚ùå Error: No se encontr√≥ el ID del proyecto', 'danger');\r\n            return;\r\n          }\r\n          \r\n          updateMutation.mutate({ \r\n            id: projectId, \r\n            data: editingData\r\n          }, {\r\n            onSuccess: (data) => {\r\n              showNotification('‚úÖ Proyecto actualizado exitosamente!', 'success');\r\n              setShowViewModal(false);\r\n            },\r\n            onError: (error) => {\r\n              console.error('‚ùå Error al actualizar:', error);\r\n              showNotification('‚ùå Error al actualizar proyecto', 'danger');\r\n              // No cerrar el modal en caso de error para que el usuario pueda intentar de nuevo\r\n            }\r\n          });\r\n        }}\r\n        submitText={updateMutation.isLoading ? 'Guardando...' : 'Guardar Cambios'}\r\n        cancelText=\"Cancelar\"\r\n      />\r\n\r\n      {/* Modal de Ver Proyecto (Solo Lectura) */}\r\n      <ModalForm\r\n        show={showViewOnlyModal}\r\n        onHide={() => setShowViewOnlyModal(false)}\r\n        title={`üëÅÔ∏è Ver Proyecto - ${selectedProject?.name || ''}`}\r\n        data={{\r\n          ...selectedProject,\r\n          queries_history: Array.isArray(selectedProject?.queries_history) ? selectedProject.queries_history : []\r\n        }}\r\n        size=\"lg\"\r\n        fields={[\r\n          {\r\n            name: 'project_view',\r\n            label: 'Informaci√≥n del Proyecto',\r\n            type: 'custom',\r\n            render: (project) => (\r\n              <div className=\"project-view-modal\">\r\n                <style>{`\r\n                  .project-view-modal {\r\n                    font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif;\r\n                  }\r\n                  .project-header {\r\n                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\r\n                    color: white;\r\n                    padding: 1.5rem;\r\n                    border-radius: 12px;\r\n                    margin-bottom: 2rem;\r\n                    box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);\r\n                  }\r\n                  .project-header h4 {\r\n                    margin: 0;\r\n                    font-weight: 600;\r\n                    font-size: 1.5rem;\r\n                  }\r\n                  .project-header .project-id {\r\n                    background: rgba(255, 255, 255, 0.2);\r\n                    padding: 0.5rem 1rem;\r\n                    border-radius: 20px;\r\n                    font-size: 0.9rem;\r\n                    margin-top: 0.5rem;\r\n                    display: inline-block;\r\n                  }\r\n                  .info-card {\r\n                    background: white;\r\n                    border-radius: 12px;\r\n                    padding: 1.5rem;\r\n                    margin-bottom: 1.5rem;\r\n                    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);\r\n                    border: 1px solid #e9ecef;\r\n                  }\r\n                  .info-card h6 {\r\n                    color: #495057;\r\n                    font-weight: 600;\r\n                    margin-bottom: 1rem;\r\n                    padding-bottom: 0.5rem;\r\n                    border-bottom: 2px solid #f8f9fa;\r\n                  }\r\n                  .info-grid {\r\n                    display: grid;\r\n                    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));\r\n                    gap: 1rem;\r\n                  }\r\n                  .info-item {\r\n                    display: flex;\r\n                    flex-direction: column;\r\n                    gap: 0.25rem;\r\n                  }\r\n                  .info-item label {\r\n                    font-size: 0.75rem;\r\n                    font-weight: 600;\r\n                    color: #6c757d;\r\n                    text-transform: uppercase;\r\n                    letter-spacing: 0.5px;\r\n                  }\r\n                  .info-item .value {\r\n                    font-weight: 500;\r\n                    color: #212529;\r\n                    font-size: 0.95rem;\r\n                  }\r\n                  .priority-badge {\r\n                    display: inline-flex;\r\n                    align-items: center;\r\n                    gap: 0.5rem;\r\n                    padding: 0.5rem 1rem;\r\n                    border-radius: 20px;\r\n                    font-weight: 600;\r\n                    font-size: 0.85rem;\r\n                  }\r\n                  .priority-urgent { background: #fee2e2; color: #dc2626; }\r\n                  .priority-high { background: #fef3c7; color: #d97706; }\r\n                  .priority-normal { background: #d1fae5; color: #059669; }\r\n                  .priority-low { background: #e0e7ff; color: #3730a3; }\r\n                  .status-badge {\r\n                    padding: 0.5rem 1rem;\r\n                    border-radius: 20px;\r\n                    font-weight: 600;\r\n                    font-size: 0.85rem;\r\n                  }\r\n                  .status-pendiente { background: #fef3c7; color: #d97706; }\r\n                  .status-activo { background: #d1fae5; color: #059669; }\r\n                  .status-completado { background: #dbeafe; color: #2563eb; }\r\n                  .status-cancelado { background: #fee2e2; color: #dc2626; }\r\n                `}</style>\r\n                \r\n                <div className=\"project-header\">\r\n                  <h4>üëÅÔ∏è {project.name}</h4>\r\n                  <div className=\"project-id\">ID: #{project.id}</div>\r\n                </div>\r\n\r\n                  <div className=\"row g-4\">\r\n                  {/* Informaci√≥n Principal */}\r\n                  <div className=\"col-lg-8\">\r\n                    <div className=\"info-card\">\r\n                      <h6>üìä Informaci√≥n del Proyecto</h6>\r\n                      <div className=\"info-grid\">\r\n                        <div className=\"info-item\">\r\n                          <label>Ubicaci√≥n</label>\r\n                          <div className=\"value\">{project.location || 'No especificada'}</div>\r\n                        </div>\r\n                        <div className=\"info-item\">\r\n                          <label>Estado Actual</label>\r\n                          <div>\r\n                            <span className={`status-badge status-${project.status || 'pendiente'}`}>\r\n                              {project.status === 'pendiente' ? 'Pendiente' :\r\n                               project.status === 'activo' ? 'Activo' :\r\n                               project.status === 'completado' ? 'Completado' :\r\n                               project.status === 'cancelado' ? 'Cancelado' : project.status}\r\n                            </span>\r\n                            </div>\r\n                          </div>\r\n                        <div className=\"info-item\">\r\n                          <label>Prioridad</label>\r\n                              <div>\r\n                            <span className={`priority-badge priority-${project.priority || 'normal'}`}>\r\n                              {project.priority === 'urgent' ? 'üî¥ Urgente' :\r\n                               project.priority === 'high' ? 'üü† Alta' :\r\n                               project.priority === 'normal' ? 'üü¢ Normal' :\r\n                               project.priority === 'low' ? 'üîµ Baja' : 'üü¢ Normal'}\r\n                            </span>\r\n                              </div>\r\n                            </div>\r\n                      </div>\r\n                    </div>\r\n\r\n                    <div className=\"info-card\">\r\n                      <h6>üè¢ Informaci√≥n de la Empresa</h6>\r\n                      <div className=\"info-grid\">\r\n                        <div className=\"info-item\">\r\n                          <label>Empresa</label>\r\n                          <div className=\"value fw-bold\">{project.company_name || 'Sin empresa'}</div>\r\n                          </div>\r\n                        <div className=\"info-item\">\r\n                          <label>RUC</label>\r\n                          <div className=\"value\">{project.company_ruc || 'Sin RUC'}</div>\r\n                        </div>\r\n                        <div className=\"info-item\">\r\n                          <label>Contacto</label>\r\n                          <div className=\"value fw-bold\">{project.contact_name || 'Sin contacto'}</div>\r\n                        </div>\r\n                        <div className=\"info-item\">\r\n                          <label>Tel√©fono</label>\r\n                          <div className=\"value\">{project.contact_phone || 'Sin tel√©fono'}</div>\r\n                        </div>\r\n                        <div className=\"info-item\">\r\n                          <label>Email</label>\r\n                          <div className=\"value\">{project.contact_email || 'Sin email'}</div>\r\n                        </div>\r\n                        <div className=\"info-item\">\r\n                          <label>Vendedor Asignado</label>\r\n                          <div className=\"value fw-bold\">{project.vendedor_name || 'Sin asignar'}</div>\r\n                        </div>\r\n                        <div className=\"info-item\">\r\n                          <label>Responsable Laboratorio</label>\r\n                          <div className=\"value fw-bold\">{project.laboratorio_name || 'Sin asignar'}</div>\r\n                        </div>\r\n                      </div>\r\n                      </div>\r\n                    </div>\r\n\r\n                  {/* Informaci√≥n Adicional */}\r\n                  <div className=\"col-lg-4\">\r\n                    <div className=\"info-card\">\r\n                      <h6>üìÖ Detalles del Proyecto</h6>\r\n                      <div className=\"info-item mb-3\">\r\n                        <label>Fecha de Creaci√≥n</label>\r\n                        <div className=\"value\">\r\n                          {project.created_at ? new Date(project.created_at).toLocaleDateString('es-ES') : 'No disponible'}\r\n                          </div>\r\n                        </div>\r\n                      <div className=\"info-item mb-3\">\r\n                        <label>√öltima Actualizaci√≥n</label>\r\n                        <div className=\"value\">\r\n                          {project.updated_at ? new Date(project.updated_at).toLocaleDateString('es-ES') : 'No disponible'}\r\n                            </div>\r\n                                        </div>\r\n                    {project.queries && (\r\n                      <div className=\"info-item\">\r\n                        <label>Consultas/Notas</label>\r\n                        <div className=\"value\" style={{ fontSize: '0.9rem', lineHeight: '1.4', maxHeight: '200px', overflowY: 'auto', border: '1px solid #eee', borderRadius: '5px', padding: '10px' }}>\r\n                          {(() => {\r\n                            try {\r\n                              // Intentar parsear como JSON (historial de consultas)\r\n                              const history = JSON.parse(project.queries);\r\n                              if (Array.isArray(history) && history.length > 0) {\r\n                return history.map((entry, index) => {\r\n                  // Color consistente por usuario\r\n                  const getUserColor = (userName) => {\r\n                    const colors = ['#3b82f6', '#ef4444']; // Azul y Rojo\r\n                    const hash = userName.split('').reduce((a, b) => {\r\n                      a = ((a << 5) - a) + b.charCodeAt(0);\r\n                      return a & a;\r\n                    }, 0);\r\n                    return colors[Math.abs(hash) % colors.length];\r\n                  };\r\n                  \r\n                  const color = getUserColor(entry.user_name || 'Usuario Desconocido');\r\n                  \r\n                  return (\r\n                    <div key={index} className=\"mb-2 pb-2\" style={{ borderBottom: index < history.length - 1 ? '1px dotted #eee' : 'none' }}>\r\n                      <div className=\"fw-bold d-flex align-items-center\">\r\n                        <div \r\n                          className=\"me-2\" \r\n                          style={{ \r\n                            width: '4px', \r\n                            height: '20px', \r\n                            backgroundColor: color,\r\n                            borderRadius: '2px'\r\n                          }}\r\n                        />\r\n                        <FiMessageSquare className=\"me-1\" style={{ color: color }} />\r\n                        üë§ {entry.user_name || 'Usuario Desconocido'}\r\n                        <span className=\"ms-auto text-muted small\" style={{ fontSize: '0.75rem' }}>\r\n                          {new Date(entry.created_at).toLocaleString('es-ES', { \r\n                            day: '2-digit', \r\n                            month: '2-digit', \r\n                            hour: '2-digit', \r\n                            minute: '2-digit' \r\n                          })}\r\n                        </span>\r\n                      </div>\r\n                      <p className=\"mb-0 ms-3\" style={{ fontSize: '0.85rem' }}>{entry.message}</p>\r\n                    </div>\r\n                  );\r\n                });\r\n                              } else {\r\n                                return <p className=\"text-muted\">No hay consultas registradas.</p>;\r\n                              }\r\n                            } catch (e) {\r\n                              // Fallback si queries no es JSON v√°lido (texto plano)\r\n                              return <p className=\"text-muted\">{project.queries}</p>;\r\n                            }\r\n                          })()}\r\n                        </div>\r\n                      </div>\r\n                    )}\r\n                                        </div>\r\n                                      </div>\r\n                </div>\r\n\r\n                {/* Archivos Adjuntos */}\r\n                <div className=\"info-card\">\r\n                  <h6>üìé Archivos Adjuntos</h6>\r\n                  \r\n                  {attachments.length === 0 ? (\r\n                    <div className=\"text-center py-4 text-muted\">\r\n                      <FiFolder size={48} className=\"mb-2 opacity-50\" />\r\n                      <div>No hay archivos adjuntos</div>\r\n                      <small>Este proyecto no tiene archivos adjuntos</small>\r\n                    </div>\r\n                  ) : (\r\n                    <div className=\"row g-2\">\r\n                      {attachments.map((attachment) => (\r\n                        <div key={attachment.id} className=\"col-12\">\r\n                          <div className=\"file-item\">\r\n                            <div className=\"d-flex align-items-center\">\r\n                              <FiFileText className=\"text-primary me-3\" size={20} />\r\n                              <div>\r\n                                <div className=\"fw-bold\">{attachment.original_name}</div>\r\n                                <div className=\"small text-muted\">\r\n                                  üìè {attachment.file_size ? `${(attachment.file_size / 1024 / 1024).toFixed(2)} MB` : 'N/A'}\r\n                                  <span className=\"mx-2\">‚Ä¢</span>\r\n                                  üìÖ {new Date(attachment.created_at).toLocaleDateString()}\r\n                                  <span className=\"mx-2\">‚Ä¢</span>\r\n                                  üë§ {attachment.uploaded_by_name || 'Usuario'}\r\n                                </div>\r\n                                {attachment.description && (\r\n                                  <div className=\"small text-muted mt-1\">{attachment.description}</div>\r\n                                )}\r\n                              </div>\r\n                            </div>\r\n                            <div className=\"d-flex gap-2\">\r\n                              <Button \r\n                                variant=\"outline-primary\" \r\n                                size=\"sm\"\r\n                                onClick={() => handleFileDownload(attachment)}\r\n                              >\r\n                                <FiDownload size={14} />\r\n                              </Button>\r\n                            </div>\r\n                          </div>\r\n                        </div>\r\n                      ))}\r\n                    </div>\r\n                  )}\r\n                </div>\r\n\r\n                {/* Botones de Acci√≥n */}\r\n                <div className=\"d-flex justify-content-center gap-3 mt-4 pt-3 border-top\">\r\n                                        <Button \r\n                    variant=\"primary\"\r\n                    onClick={() => {\r\n                      setShowViewOnlyModal(false);\r\n                      handleViewProject(project);\r\n                    }}\r\n                    className=\"px-4\"\r\n                    style={{ backgroundColor: '#f84616', borderColor: '#f84616' }}\r\n                  >\r\n                    <FiSettings className=\"me-2\" />\r\n                    ‚öôÔ∏è Gestionar Proyecto\r\n                                        </Button>\r\n                  \r\n                  {project.quote_id && (\r\n                    <Button\r\n                      variant=\"primary\"\r\n                      onClick={() => {\r\n                        setShowViewOnlyModal(false);\r\n                        navigate(`/cotizaciones?view=${project.quote_id}`);\r\n                      }}\r\n                      className=\"px-4\"\r\n                      style={{ backgroundColor: '#f84616', borderColor: '#f84616' }}\r\n                    >\r\n                      <FiFileText className=\"me-2\" />\r\n                      üìÑ Ver Evidencias\r\n                    </Button>\r\n                  )}\r\n                        </div>\r\n                      </div>\r\n            )\r\n          }\r\n        ]}\r\n        onSubmit={() => setShowViewOnlyModal(false)}\r\n        submitText=\"Cerrar\"\r\n      />\r\n      \r\n      </div>\r\n    </Container>\r\n    \r\n    {/* Toast de notificaciones - SOLUCI√ìN ALTERNATIVA */}\r\n    {showToast && (\r\n      <div \r\n        style={{\r\n          position: 'fixed',\r\n          top: '20px',\r\n          right: '20px',\r\n          zIndex: 99999,\r\n          backgroundColor: toastVariant === 'success' ? '#28a745' : '#dc3545',\r\n          color: 'white',\r\n          padding: '15px 20px',\r\n          borderRadius: '8px',\r\n          boxShadow: '0 4px 12px rgba(0,0,0,0.3)',\r\n          minWidth: '300px',\r\n          border: 'none'\r\n        }}\r\n        onClick={() => setShowToast(false)}\r\n      >\r\n        <div style={{ fontWeight: 'bold', marginBottom: '5px' }}>\r\n          {toastVariant === 'success' ? '‚úÖ √âxito' : '‚ùå Error'}\r\n        </div>\r\n        <div>{toastMessage}</div>\r\n      </div>\r\n    )}\r\n\r\n      {/* Modal para selecci√≥n de servicios */}\r\n      <ModalForm\r\n        show={showServiceForm}\r\n        onHide={() => setShowServiceForm(false)}\r\n        title=\"Seleccionar Servicios del Proyecto\"\r\n        size=\"xl\"\r\n        data={{}}\r\n        fields={[]}\r\n        onSubmit={() => setShowServiceForm(false)}\r\n        loading={false}\r\n        submitText=\"Cerrar\"\r\n        customBody={\r\n          <ProjectServiceForm\r\n            selectedServices={selectedServices}\r\n            onServicesChange={setSelectedServices}\r\n            serviceType=\"laboratorio\"\r\n          />\r\n        }\r\n      />\r\n\r\n      {/* Nuevo Formulario Redise√±ado */}\r\n      {showNewForm && (\r\n        <div className=\"modal-backdrop\" style={{\r\n          position: 'fixed',\r\n          top: 0,\r\n          left: 0,\r\n          right: 0,\r\n          bottom: 0,\r\n          backgroundColor: 'rgba(0,0,0,0.5)',\r\n          zIndex: 1050,\r\n          display: 'flex',\r\n          alignItems: 'center',\r\n          justifyContent: 'center'\r\n        }}>\r\n          <div className=\"modal-content bg-white rounded shadow-lg\" style={{\r\n            width: '90%',\r\n            maxWidth: '1200px',\r\n            maxHeight: '90vh',\r\n            overflow: 'auto'\r\n          }}>\r\n            <div className=\"modal-header p-4 border-bottom d-flex justify-content-between align-items-center\">\r\n              <h5 className=\"mb-0\">Crear Nuevo Proyecto</h5>\r\n              <Button \r\n                variant=\"outline-secondary\" \r\n                size=\"sm\"\r\n                onClick={() => setShowNewForm(false)}\r\n              >\r\n                <FiX />\r\n              </Button>\r\n            </div>\r\n            <div className=\"modal-body p-4\">\r\n              <ProjectFormRedesigned\r\n                data={selectedClient ? { company_id: selectedClient.id } : {}}\r\n                onSubmit={async (formData) => {\r\n                  try {\r\n                    console.log('Datos del formulario:', formData);\r\n                    \r\n                    // Preparar datos para crear proyecto\r\n                    const projectData = {\r\n                      company_id: formData.client_id,\r\n                      name: formData.name,\r\n                      location: formData.location,\r\n                      contact_name: formData.contact_name,\r\n                      contact_phone: formData.contact_phone,\r\n                      contact_email: formData.contact_email,\r\n                      priority: formData.priority || 'normal',\r\n                      marked: formData.marked || false,\r\n                      // Usar los requisitos seleccionados directamente\r\n                      requiere_laboratorio: formData.requiere_laboratorio || false,\r\n                      requiere_ingenieria: formData.requiere_ingenieria || false,\r\n                      requiere_capacitacion: formData.requiere_capacitacion || false\r\n                    };\r\n                    \r\n                    // Crear el proyecto\r\n                    await createMutation.mutateAsync(projectData);\r\n                    \r\n                    // Mostrar mensaje de √©xito\r\n                    setToastMessage('Proyecto creado exitosamente');\r\n                    setToastVariant('success');\r\n                    setShowToast(true);\r\n                    \r\n                    // Cerrar modal\r\n                    setShowNewForm(false);\r\n                    \r\n                    // Refrescar la lista de proyectos\r\n                    queryClient.invalidateQueries('projects');\r\n                    \r\n                  } catch (error) {\r\n                    console.error('Error al crear proyecto:', error);\r\n                    setToastMessage('Error al crear el proyecto');\r\n                    setToastVariant('danger');\r\n                    setShowToast(true);\r\n                  }\r\n                }}\r\n                onCancel={() => setShowNewForm(false)}\r\n                loading={createMutation.isLoading}\r\n              />\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Modales de confirmaci√≥n */}\r\n      <ConfirmModal\r\n        show={!!deletingProject}\r\n        onHide={() => setDeletingProject(null)}\r\n        onConfirm={confirmDelete}\r\n        title=\"Eliminar Proyecto\"\r\n        message={`¬øEst√°s seguro de que quieres eliminar el proyecto \"${deletingProject?.name}\"?`}\r\n        confirmText=\"Eliminar\"\r\n        variant=\"danger\"\r\n        isLoading={deleteMutation.isLoading}\r\n        alertMessage=\"Esta acci√≥n eliminar√° permanentemente el proyecto y todos sus datos asociados.\"\r\n        alertVariant=\"danger\"\r\n      />\r\n\r\n      <ConfirmModal\r\n        show={!!deletingFile}\r\n        onHide={() => setDeletingFile(null)}\r\n        onConfirm={confirmFileDelete}\r\n        title=\"Eliminar Archivo\"\r\n        message=\"¬øEst√°s seguro de que quieres eliminar este archivo?\"\r\n        confirmText=\"Eliminar\"\r\n        variant=\"danger\"\r\n        alertMessage=\"El archivo se eliminar√° permanentemente y no se puede recuperar.\"\r\n        alertVariant=\"warning\"\r\n      />\r\n\r\n      <ConfirmModal\r\n        show={!!markingProject}\r\n        onHide={() => setMarkingProject(null)}\r\n        onConfirm={confirmToggleMark}\r\n        title={`${markingProject?.marked ? 'Desmarcar' : 'Marcar'} Proyecto`}\r\n        message={`¬øEst√°s seguro de que quieres ${markingProject?.marked ? 'desmarcar' : 'marcar'} el proyecto \"${markingProject?.name}\"?`}\r\n        confirmText={markingProject?.marked ? 'Desmarcar' : 'Marcar'}\r\n        variant={markingProject?.marked ? 'warning' : 'success'}\r\n      />\r\n\r\n      {/* Modal de permisos denegados */}\r\n      <PermissionDeniedModal\r\n        show={showPermissionDeniedModal}\r\n        onHide={() => setShowPermissionDeniedModal(false)}\r\n        action={permissionDeniedInfo.action}\r\n        requiredRole={permissionDeniedInfo.requiredRole}\r\n        currentRole={permissionDeniedInfo.currentRole}\r\n      />\r\n    </>\r\n  );\r\n};"],"names":["ModalForm","show","onHide","title","data","fields","onSubmit","loading","size","submitText","cancelText","validation","className","formData","setFormData","useState","errors","setErrors","touched","setTouched","suggestions","setSuggestions","showSuggestions","setShowSuggestions","useEffect","handleInputChange","name","value","prev","field","f","filteredSuggestions","suggestion","handleBlur","error","handleSuggestionClick","validateForm","newErrors","isValid","handleSubmit","e","renderField","hasError","jsxs","Form","jsx","index","_a","option","Modal","Row","Col","Button","FiX","Fragment","Spinner","FiSave","ServiceSelection","selectedServices","onServicesChange","searchTerm","setSearchTerm","selectedEnsayo","setSelectedEnsayo","selectedSubservices","setSelectedSubservices","servicesData","isLoadingServices","useQuery","listServices","subservicesData","isLoadingSubservices","listSubservices","services","subservices","filteredServices","service","_b","handleEnsayoSelect","ensayo","handleSubserviceToggle","subservice","isSelected","s","handleConfirmSelection","newService","sum","sub","handleRemoveService","newServices","_","i","Card","FiFilter","Badge","isCurrentlySelected","FiCheck","FiClock","FiDollarSign","Alert","subIndex","ProjectServiceForm","handleServicesChange","FiSettings","FiHome","searchCompanies","type","params","apiFetch","ProjectFormRedesigned","onCancel","currentStep","setCurrentStep","searchResults","setSearchResults","isSearching","setIsSearching","showSearchResults","setShowSearchResults","autoDetectedClient","setAutoDetectedClient","totalSteps","handleSearch","response","results","exactMatch","client","clientName","searchName","cleanClientName","cleanSearchName","handleSelectClient","isAutoDetected","handleClearClient","validateStep","step","handleNext","handlePrevious","getStepIcon","FiUser","FiMessageSquare","FiCheckCircle","getStepTitle","renderStep1","result","renderStep2","renderStep3","FiTool","FiBookOpen","FiAlertTriangle","renderStep4","isActive","isCompleted","FiPlus","emptyForm","Proyectos","user","useAuth","currentUser","getCurrentUser","canCreateProject","canEditProject","userCanDeleteProject","canDeleteProject","showModal","setShowModal","editingProject","setEditingProject","deletingProject","setDeletingProject","deletingFile","setDeletingFile","markingProject","setMarkingProject","showQueriesModal","setShowQueriesModal","showStatusModal","setShowStatusModal","showViewModal","setShowViewModal","showViewOnlyModal","setShowViewOnlyModal","selectedProject","setSelectedProject","activeTab","setActiveTab","showPermissionDeniedModal","setShowPermissionDeniedModal","permissionDeniedInfo","setPermissionDeniedInfo","attachments","setAttachments","selectedFile","setSelectedFile","uploadingFile","setUploadingFile","editingData","setEditingData","showToast","setShowToast","toastMessage","setToastMessage","toastVariant","setToastVariant","vendedorSearch","setVendedorSearch","laboratorioSearch","setLaboratorioSearch","showVendedorDropdown","setShowVendedorDropdown","showLaboratorioDropdown","setShowLaboratorioDropdown","newQuery","setNewQuery","setSelectedServices","showServiceForm","setShowServiceForm","useNewForm","setUseNewForm","showNewForm","setShowNewForm","currentPage","setCurrentPage","selectedStatus","setSelectedStatus","selectedCompany","setSelectedCompany","selectedProjectType","setSelectedProjectType","selectedPriority","setSelectedPriority","navigate","useNavigate","location","useLocation","viewProjectId","selectedClient","queryClient","useQueryClient","isLoading","refetch","listProjects","usersData","usersLoading","listUsers","statsData","statsLoading","getProjectStats","project","p","handleViewProject","attachmentsData","listProjectAttachments","handleClickOutside","event","handleMutationSuccess","message","showNotification","variant","searchValue","handleFilter","filters","handleFileSelect","file","handleFileUpload","uploadAttachment","handleFileDownload","attachment","downloadFile","handleFileDelete","attachmentId","confirmFileDelete","deleteAttachment","handleVendedorSelect","sendAssignmentNotification","handleLaboratorioSelect","userId","role","baseUrl","token","now","fechaHora","roleText","notificationData","errorText","getFilteredVendedores","getFilteredLaboratorio","projectFilterOptions","createMutation","useMutation","createProject","updateMutation","id","updateProject","updatedProject","processedEditingData","parsed","deleteMutation","deleteProject","updateProjectStatus","updateProjectQueries","updateProjectMark","handleDelete","confirmDelete","confirmToggleMark","handleViewOnlyProject","initialEditingData","historyEntry","getStatusBadge","status","config","columns","row","FiMapPin","estadoLab","estadoIng","priorityInfo","priority","date","formFields","company","_c","_d","stats","useMemo","projects","Container","PageHeader","StatsCard","FiRefreshCw","DataTable","FiEye","FiTrash2","newValue","FiCalendar","comment","color","userName","colors","hash","a","b","newComment","updatedHistory","FiUpload","FiFileText","FiFolder","FiDownload","projectId","history","entry","projectData","ConfirmModal","PermissionDeniedModal"],"mappings":"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"}