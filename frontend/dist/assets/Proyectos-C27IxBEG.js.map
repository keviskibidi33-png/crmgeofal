{"version":3,"file":"Proyectos-C27IxBEG.js","sources":["../../src/pages/Proyectos.jsx"],"sourcesContent":["import React, { useState, useMemo } from 'react';\r\nimport { useQuery, useMutation, useQueryClient } from 'react-query';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { Button, Badge, Row, Col, Card, Container } from 'react-bootstrap';\r\nimport { FiPlus, FiEdit, FiTrash2, FiHome, FiMapPin, FiCalendar, FiUser, FiCheckCircle, FiClock, FiX } from 'react-icons/fi';\r\nimport PageHeader from '../components/common/PageHeader';\r\nimport DataTable from '../components/common/DataTable';\r\nimport ModalForm from '../components/common/ModalForm';\r\nimport StatsCard from '../components/common/StatsCard';\r\nimport { listProjects, createProject, updateProject, deleteProject } from '../services/projects';\r\n\r\nconst emptyForm = { company_id: '', name: '', location: '', vendedor_id: '', laboratorio_id: '' };\r\n\r\nexport default function Proyectos() {\r\n  const [showModal, setShowModal] = useState(false);\r\n  const [editingProject, setEditingProject] = useState(null);\r\n  const [deletingProject, setDeletingProject] = useState(null);\r\n  const navigate = useNavigate();\r\n\r\n  const queryClient = useQueryClient();\r\n\r\n  const { data, isLoading } = useQuery(\r\n    ['projects'],\r\n    () => listProjects(),\r\n    { keepPreviousData: true }\r\n  );\r\n\r\n  const handleMutationSuccess = (message) => {\r\n    queryClient.invalidateQueries('projects');\r\n    setShowModal(false);\r\n    setEditingProject(null);\r\n    setDeletingProject(null);\r\n  };\r\n\r\n  const createMutation = useMutation(createProject, {\r\n    onSuccess: () => handleMutationSuccess('Proyecto creado exitosamente'),\r\n    onError: (error) => console.error('Error creating project:', error)\r\n  });\r\n\r\n  const updateMutation = useMutation(updateProject, {\r\n    onSuccess: () => handleMutationSuccess('Proyecto actualizado exitosamente'),\r\n    onError: (error) => console.error('Error updating project:', error)\r\n  });\r\n\r\n  const deleteMutation = useMutation(deleteProject, {\r\n    onSuccess: () => handleMutationSuccess('Proyecto eliminado exitosamente'),\r\n    onError: (error) => console.error('Error deleting project:', error)\r\n  });\r\n\r\n  const handleCreate = () => {\r\n    setEditingProject(emptyForm);\r\n    setShowModal(true);\r\n  };\r\n\r\n  const handleEdit = (project) => {\r\n    setEditingProject(project);\r\n    setShowModal(true);\r\n  };\r\n\r\n  const handleDelete = (project) => {\r\n    if (window.confirm(`¿Estás seguro de que quieres eliminar el proyecto \"${project.name}\"?`)) {\r\n      deleteMutation.mutate(project.id);\r\n    }\r\n  };\r\n\r\n  const handleSubmit = async (formData) => {\r\n    if (editingProject.id) {\r\n      await updateMutation.mutateAsync({ id: editingProject.id, ...formData });\r\n    } else {\r\n      await createMutation.mutateAsync(formData);\r\n    }\r\n  };\r\n\r\n  const getStatusBadge = (status) => {\r\n    const statusConfig = {\r\n      'activo': { bg: 'success', text: 'Activo' },\r\n      'pendiente': { bg: 'warning', text: 'Pendiente' },\r\n      'completado': { bg: 'primary', text: 'Completado' },\r\n      'cancelado': { bg: 'danger', text: 'Cancelado' }\r\n    };\r\n    \r\n    const config = statusConfig[status] || { bg: 'secondary', text: status };\r\n    return <Badge bg={config.bg} className=\"status-badge\">{config.text}</Badge>;\r\n  };\r\n\r\n  const columns = [\r\n    {\r\n      header: 'ID',\r\n      accessor: 'id',\r\n      width: '80px'\r\n    },\r\n    {\r\n      header: 'Proyecto',\r\n      accessor: 'name',\r\n      render: (value, row) => (\r\n        <div>\r\n          <div className=\"fw-medium\">{row.name}</div>\r\n          {row.location && (\r\n            <small className=\"text-muted\">\r\n              <FiMapPin size={12} className=\"me-1\" />\r\n              {row.location}\r\n            </small>\r\n          )}\r\n        </div>\r\n      )\r\n    },\r\n    {\r\n      header: 'Empresa',\r\n      accessor: 'company',\r\n      render: (value, row) => (\r\n        <div>\r\n          <div className=\"fw-medium\">{row.company?.name || 'Sin empresa'}</div>\r\n          {row.company?.ruc && (\r\n            <small className=\"text-muted\">RUC: {row.company.ruc}</small>\r\n          )}\r\n        </div>\r\n      )\r\n    },\r\n    {\r\n      header: 'Estado',\r\n      accessor: 'status',\r\n      render: (value) => getStatusBadge(value || 'activo')\r\n    },\r\n    {\r\n      header: 'Asignado a',\r\n      accessor: 'vendedor',\r\n      render: (value, row) => (\r\n        <div>\r\n          {row.vendedor && (\r\n            <div className=\"d-flex align-items-center\">\r\n              <FiUser size={14} className=\"me-1 text-muted\" />\r\n              <span>{row.vendedor.name}</span>\r\n            </div>\r\n          )}\r\n          {row.laboratorio && (\r\n            <div className=\"d-flex align-items-center mt-1\">\r\n              <FiHome size={14} className=\"me-1 text-muted\" />\r\n              <span className=\"small text-muted\">{row.laboratorio.name}</span>\r\n            </div>\r\n          )}\r\n        </div>\r\n      )\r\n    },\r\n    {\r\n      header: 'Fecha Creación',\r\n      accessor: 'created_at',\r\n      type: 'date'\r\n    }\r\n  ];\r\n\r\n  const formFields = [\r\n    {\r\n      name: 'company_id',\r\n      label: 'Empresa',\r\n      type: 'select',\r\n      required: true,\r\n      options: data?.companies?.map(company => ({\r\n        value: company.id,\r\n        label: `${company.name} (${company.ruc})`\r\n      })) || []\r\n    },\r\n    {\r\n      name: 'name',\r\n      label: 'Nombre del Proyecto',\r\n      type: 'text',\r\n      required: true,\r\n      placeholder: 'Ingresa el nombre del proyecto'\r\n    },\r\n    {\r\n      name: 'location',\r\n      label: 'Ubicación',\r\n      type: 'text',\r\n      placeholder: 'Ingresa la ubicación del proyecto'\r\n    },\r\n    {\r\n      name: 'vendedor_id',\r\n      label: 'Vendedor Asignado',\r\n      type: 'select',\r\n      options: data?.users?.filter(user => \r\n        ['vendedor_comercial', 'jefa_comercial'].includes(user.role)\r\n      ).map(user => ({\r\n        value: user.id,\r\n        label: `${user.name} ${user.apellido}`\r\n      })) || []\r\n    },\r\n    {\r\n      name: 'laboratorio_id',\r\n      label: 'Responsable de Laboratorio',\r\n      type: 'select',\r\n      options: data?.users?.filter(user => \r\n        ['jefe_laboratorio', 'usuario_laboratorio', 'laboratorio'].includes(user.role)\r\n      ).map(user => ({\r\n        value: user.id,\r\n        label: `${user.name} ${user.apellido}`\r\n      })) || []\r\n    }\r\n  ];\r\n\r\n  // Calcular estadísticas\r\n  const stats = useMemo(() => {\r\n    const projects = data?.projects || [];\r\n    return {\r\n      total: projects.length,\r\n      activos: projects.filter(p => p.status === 'activo').length,\r\n      completados: projects.filter(p => p.status === 'completado').length,\r\n      pendientes: projects.filter(p => p.status === 'pendiente').length,\r\n      cancelados: projects.filter(p => p.status === 'cancelado').length\r\n    };\r\n  }, [data]);\r\n\r\n  return (\r\n    <Container fluid className=\"py-4\">\r\n      <div className=\"fade-in\">\r\n        <PageHeader\r\n          title=\"Gestión de Proyectos\"\r\n          subtitle=\"Crear, editar y gestionar proyectos del sistema\"\r\n          icon={FiHome}\r\n          actions={\r\n            <Button variant=\"primary\" onClick={handleCreate}>\r\n              <FiPlus className=\"me-2\" />\r\n              Nuevo Proyecto\r\n            </Button>\r\n          }\r\n        />\r\n\r\n        {/* Estadísticas */}\r\n        <Row className=\"g-4 mb-4\">\r\n          <Col md={6} lg={3}>\r\n            <StatsCard\r\n              title=\"Total Proyectos\"\r\n              value={stats.total}\r\n              icon={FiHome}\r\n              color=\"primary\"\r\n              subtitle=\"Proyectos registrados\"\r\n            />\r\n          </Col>\r\n          <Col md={6} lg={3}>\r\n            <StatsCard\r\n              title=\"Proyectos Activos\"\r\n              value={stats.activos}\r\n              icon={FiCheckCircle}\r\n              color=\"success\"\r\n              subtitle=\"En desarrollo\"\r\n            />\r\n          </Col>\r\n          <Col md={6} lg={3}>\r\n            <StatsCard\r\n              title=\"Completados\"\r\n              value={stats.completados}\r\n              icon={FiCheckCircle}\r\n              color=\"info\"\r\n              subtitle=\"Finalizados\"\r\n            />\r\n          </Col>\r\n          <Col md={6} lg={3}>\r\n            <StatsCard\r\n              title=\"Pendientes\"\r\n              value={stats.pendientes}\r\n              icon={FiClock}\r\n              color=\"warning\"\r\n              subtitle=\"Por iniciar\"\r\n            />\r\n          </Col>\r\n        </Row>\r\n\r\n        {/* Tabla de proyectos */}\r\n        <Card className=\"shadow-sm border-0\">\r\n          <Card.Header className=\"bg-white border-bottom\">\r\n            <div className=\"d-flex justify-content-between align-items-center\">\r\n              <h5 className=\"mb-0\">\r\n                <FiHome className=\"me-2 text-primary\" />\r\n                Lista de Proyectos\r\n              </h5>\r\n              <Badge bg=\"light\" text=\"dark\" className=\"px-3 py-2\">\r\n                {stats.total} proyectos\r\n              </Badge>\r\n            </div>\r\n          </Card.Header>\r\n          <Card.Body className=\"p-0\">\r\n            <DataTable\r\n              data={data?.projects || []}\r\n              columns={columns}\r\n              loading={isLoading}\r\n              onEdit={handleEdit}\r\n              onDelete={handleDelete}\r\n              emptyMessage=\"No hay proyectos registrados\"\r\n            />\r\n          </Card.Body>\r\n        </Card>\r\n\r\n      <ModalForm\r\n        show={showModal}\r\n        onHide={() => setShowModal(false)}\r\n        title={editingProject?.id ? 'Editar Proyecto' : 'Nuevo Proyecto'}\r\n        data={editingProject || emptyForm}\r\n        fields={formFields}\r\n        onSubmit={handleSubmit}\r\n        loading={createMutation.isLoading || updateMutation.isLoading}\r\n        submitText={editingProject?.id ? 'Actualizar' : 'Crear'}\r\n      />\r\n      </div>\r\n    </Container>\r\n  );\r\n};"],"names":["emptyForm","Proyectos","showModal","setShowModal","useState","editingProject","setEditingProject","deletingProject","setDeletingProject","useNavigate","queryClient","useQueryClient","data","isLoading","useQuery","listProjects","handleMutationSuccess","message","createMutation","useMutation","createProject","error","updateMutation","updateProject","deleteMutation","deleteProject","handleCreate","handleEdit","project","handleDelete","handleSubmit","formData","getStatusBadge","status","config","jsx","Badge","columns","value","row","jsxs","FiMapPin","_a","_b","FiUser","FiHome","formFields","company","user","_c","stats","useMemo","projects","p","Container","PageHeader","Button","FiPlus","Row","Col","StatsCard","FiCheckCircle","FiClock","Card","DataTable","ModalForm"],"mappings":"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"}