import{a as B,c as D,r as _,e as L,n as x,j as e,C as u,av as b,B as r,L as C,v as q,m as z,A as F,a_ as H,a$ as I,b0 as $,b1 as T}from"./index-xQVByYRi.js";import{S as O}from"./Spinner-C2jXaFYJ.js";import{A as V}from"./Alert-BijlR5uZ.js";import{R as J,C as c}from"./Row-mPOlevGM.js";import{C as P}from"./Col-Dz9zKzWQ.js";import{M as n}from"./Modal-BPoSYaBi.js";const ee=()=>{const{user:l}=B(),i=D(),[a,M]=_.useState(null),[S,o]=_.useState(!1),{data:t,isLoading:w,error:j}=L(["notifications-all",l==null?void 0:l.id],()=>T({limit:50,unreadOnly:!1}),{enabled:!!l,refetchInterval:3e4}),p=x(I,{onSuccess:()=>{i.invalidateQueries(["notifications-all"]),i.invalidateQueries(["notifications"]),i.invalidateQueries(["notificationStats"])}}),f=x(H,{onSuccess:()=>{i.invalidateQueries(["notifications-all"]),i.invalidateQueries(["notifications"]),i.invalidateQueries(["notificationStats"])}}),N=x($,{onSuccess:()=>{i.invalidateQueries(["notifications-all"]),i.invalidateQueries(["notifications"]),i.invalidateQueries(["notificationStats"])}}),g=s=>{p.mutate(s)},k=()=>{f.mutate()},A=s=>{window.confirm("¿Estás seguro de que quieres eliminar esta notificación?")&&N.mutate(s)},Q=s=>{M(s),o(!0),s.read_at||g(s.id)},v=s=>({payment_proof_uploaded:"💰",payment_proof_approved:"✅",payment_proof_rejected:"❌",quote_created:"📄",quote_approved:"✅",quote_rejected:"❌",project_created:"🏗️",project_updated:"🔄",ticket_created:"🎫",ticket_updated:"🔄",system_update:"🆕"})[s]||"🔔",E=s=>{const m=new Date(s),d=Math.floor((new Date-m)/(1e3*60));if(d<1)return"Ahora";if(d<60)return`Hace ${d} min`;const h=Math.floor(d/60);if(h<24)return`Hace ${h} h`;const y=Math.floor(h/24);return y<7?`Hace ${y} días`:m.toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})};if(w)return e.jsx(u,{className:"py-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx(O,{animation:"border"}),e.jsx("p",{className:"mt-2",children:"Cargando notificaciones..."})]})});if(j)return e.jsx(u,{className:"py-4",children:e.jsxs(V,{variant:"danger",children:["Error al cargar las notificaciones: ",j.message]})});const R=(t==null?void 0:t.filter(s=>!s.read_at).length)||0;return e.jsxs(u,{className:"py-4",children:[e.jsx(J,{children:e.jsxs(P,{children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[e.jsxs("h2",{className:"mb-0",children:[e.jsx(b,{className:"me-2"}),"Notificaciones"]}),e.jsx("div",{className:"d-flex gap-2",children:R>0&&e.jsxs(r,{variant:"outline-primary",size:"sm",onClick:k,disabled:f.isLoading,children:[e.jsx(C,{className:"me-1"}),"Marcar todas como leídas"]})})]}),(t==null?void 0:t.length)===0?e.jsx(c,{children:e.jsxs(c.Body,{className:"text-center py-5",children:[e.jsx(b,{size:48,className:"text-muted mb-3"}),e.jsx("h5",{className:"text-muted",children:"No hay notificaciones"}),e.jsx("p",{className:"text-muted",children:"Cuando recibas notificaciones, aparecerán aquí."})]})}):e.jsx("div",{className:"notification-list",children:t==null?void 0:t.map(s=>e.jsx(c,{className:`mb-3 ${s.read_at?"":"border-primary"}`,children:e.jsx(c.Body,{children:e.jsxs("div",{className:"d-flex align-items-start",children:[e.jsx("div",{className:"me-3",children:e.jsx("span",{className:"fs-4",children:v(s.type)})}),e.jsxs("div",{className:"flex-grow-1",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-start mb-2",children:[e.jsxs("div",{children:[e.jsxs("h6",{className:"mb-1",children:[s.title,!s.read_at&&e.jsx(q,{bg:"primary",className:"ms-2",children:"Nueva"})]}),e.jsx("p",{className:"text-muted mb-2",children:s.message})]}),e.jsx("div",{className:"text-end",children:e.jsx("small",{className:"text-muted",children:E(s.created_at)})})]}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsxs(r,{variant:"outline-primary",size:"sm",onClick:()=>Q(s),children:[e.jsx(z,{className:"me-1"}),"Ver detalles"]}),!s.read_at&&e.jsxs(r,{variant:"outline-success",size:"sm",onClick:()=>g(s.id),disabled:p.isLoading,children:[e.jsx(C,{className:"me-1"}),"Marcar como leída"]}),e.jsxs(r,{variant:"outline-danger",size:"sm",onClick:()=>A(s.id),disabled:N.isLoading,children:[e.jsx(F,{className:"me-1"}),"Eliminar"]})]})]})]})})},s.id))})]})}),e.jsxs(n,{show:S,onHide:()=>o(!1),size:"lg",children:[e.jsx(n.Header,{closeButton:!0,children:e.jsxs(n.Title,{children:[a&&v(a.type),a==null?void 0:a.title]})}),e.jsx(n.Body,{children:a&&e.jsxs("div",{children:[e.jsx("p",{children:e.jsx("strong",{children:"Mensaje:"})}),e.jsx("p",{className:"mb-3",children:a.message}),a.data&&e.jsxs("div",{children:[e.jsx("p",{children:e.jsx("strong",{children:"Datos adicionales:"})}),e.jsx("pre",{className:"bg-light p-3 rounded",children:JSON.stringify(a.data,null,2)})]}),e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Tipo:"})," ",a.type]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Prioridad:"})," ",a.priority]})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Fecha:"})," ",new Date(a.created_at).toLocaleString("es-ES")]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Estado:"})," ",a.read_at?"Leída":"No leída"]})]})]})]})}),e.jsx(n.Footer,{children:e.jsx(r,{variant:"secondary",onClick:()=>o(!1),children:"Cerrar"})})]})]})};export{ee as default};
//# sourceMappingURL=Notificaciones-CUGW0mNm.js.map
