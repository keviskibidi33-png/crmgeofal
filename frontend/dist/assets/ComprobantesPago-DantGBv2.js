import{a as qe,r as c,b as p,j as e,C as le,B as o,W as V,t as de,F as u,v as P,X as g,k as I,L as J,K as me,al as he,N as Fe}from"./index-xQVByYRi.js";import{S as k}from"./Spinner-C2jXaFYJ.js";import{R as Q,C as x}from"./Row-mPOlevGM.js";import{C as N}from"./Col-Dz9zKzWQ.js";import{A as X}from"./Alert-BijlR5uZ.js";import{M as l}from"./Modal-BPoSYaBi.js";import{F as n}from"./Form-BAZkilfb.js";import"./ElementChildren-BP-7Da5j.js";const Oe=()=>{var ie,ce;const{user:d}=qe(),[L,pe]=c.useState([]),[w,M]=c.useState([]),[S,R]=c.useState([]),[T,xe]=c.useState([]),[je,K]=c.useState(!0),[W,h]=c.useState(null),[Ae,Y]=c.useState(null),[ue,f]=c.useState(!1),[ge,E]=c.useState(!1),[be,z]=c.useState(!1),[ve,B]=c.useState(!1),[r,$]=c.useState(null),[O,Z]=c.useState(!1),[U,ee]=c.useState(""),[ae,se]=c.useState(""),[v,re]=c.useState(""),[ne,ye]=c.useState(new Set),[D,q]=c.useState(new Set),[t,b]=c.useState({quote_id:"",quote_file:null,project_files:[],description:"",amount_paid:"",payment_date:"",payment_method:"",payment_proof:null,client_name:"",client_email:"",project_description:""}),[F,Ne]=c.useState([]),[H,te]=c.useState(!1);c.useEffect(()=>{_(),(d.role==="vendedor_comercial"||d.role==="jefa_comercial")&&fe()},[]);const fe=async()=>{try{te(!0);const a=await p("/api/quotes/my-quotes");Ne(a||[]),console.log("üìã Cotizaciones cargadas:",(a==null?void 0:a.length)||0)}catch(a){console.error("Error fetching quotes:",a),h("Error al cargar las cotizaciones: "+(a.message||"Error desconocido"))}finally{te(!1)}},_=async()=>{try{if(K(!0),h(null),d.role==="facturacion"||d.role==="admin"){const[a,s,i]=await Promise.all([p("/api/payment-proofs/pending"),p("/api/payment-proofs/approved"),p("/api/payment-proofs/archived")]);pe(a||[]),M(s||[]),R(i||[])}else if(d.role==="vendedor_comercial"||d.role==="jefa_comercial"){const a=await p("/api/payment-proofs/my-submissions");xe(a||[])}}catch(a){console.error("Error fetching data:",a),h("Error al cargar los datos: "+(a.message||"Error desconocido"))}finally{K(!1)}},_e=a=>{const s=a.target.files[0];s&&b({...t,payment_proof:s})},Ce=async()=>{try{Z(!0),h(null);const a=new FormData;a.append("quote_id",t.quote_id),a.append("description",t.description),a.append("amount_paid",t.amount_paid),a.append("payment_date",t.payment_date),a.append("payment_method",t.payment_method),a.append("payment_proof",t.payment_proof),await p("/api/payment-proofs/upload",{method:"POST",body:a}),f(!1),b({quote_id:"",description:"",amount_paid:"",payment_date:"",payment_method:"",payment_proof:null}),_()}catch(a){console.error("Error uploading proof:",a),h("Error al subir el comprobante: "+(a.message||"Error desconocido"))}finally{Z(!1)}},we=async()=>{try{if(await p("/api/payment-proofs/approve",{method:"POST",body:JSON.stringify({proofId:r.id,notes:ae})}),r.quote_id&&v)try{console.log("üçØ Alimentando embudo de ventas...",{quoteId:r.quote_id,realAmountPaid:parseFloat(v)});const a=await p("/api/funnel/alimentar-embudo",{method:"POST",body:JSON.stringify({quoteId:r.quote_id,realAmountPaid:parseFloat(v)})});console.log("‚úÖ Embudo alimentado exitosamente:",a),alert(`‚úÖ Comprobante aprobado y embudo alimentado exitosamente!
üìä Procesados: ${a.itemsProcessed} √≠tems
üè∑Ô∏è Categor√≠a: ${a.category}
üìã C√≥digo: ${a.quoteCode}`)}catch(a){console.error("‚ùå Error alimentando embudo:",a),alert("‚ö†Ô∏è Comprobante aprobado pero hubo un error alimentando el embudo. Contacta al administrador.")}else console.warn("‚ö†Ô∏è No se pudo alimentar el embudo: quote_id o realAmountPaid faltante"),alert("‚úÖ Comprobante aprobado (embudo no alimentado - datos faltantes)");_(),E(!1),se(""),re("")}catch(a){console.error("Error approving proof:",a),h("Error al aprobar el comprobante: "+(a.message||"Error desconocido"))}},Se=async()=>{try{await p("/api/payment-proofs/reject",{method:"POST",body:JSON.stringify({proofId:r.id,reason:U})}),_(),z(!1),ee("")}catch(a){console.error("Error rejecting proof:",a),h("Error al rechazar el comprobante: "+(a.message||"Error desconocido"))}},A=async a=>{try{const s=await p(`/api/payment-proofs/${a}`),i=s.data||s;if(!i){h("No se encontr√≥ el comprobante");return}$(i),B(!0)}catch(s){console.error("Error getting proof data:",s),h("Error al obtener informaci√≥n del comprobante: "+(s.message||"Error desconocido"))}},G=async(a,s,i="attachment")=>{try{const m=await fetch(`/api/payment-proofs/download-file?path=${encodeURIComponent(a)}&type=${i}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(m.ok){const j=await m.blob(),y=window.URL.createObjectURL(j),C=document.createElement("a");C.href=y,C.download=s,document.body.appendChild(C),C.click(),window.URL.revokeObjectURL(y),document.body.removeChild(C)}else h("Error al descargar el archivo")}catch(m){console.error("Error downloading file:",m),h("Error al descargar el archivo: "+(m.message||"Error desconocido"))}},oe=a=>{const s=new Set(ne);s.has(a)?s.delete(a):s.add(a),ye(s)},Ee=(a,s=100)=>a?a.length<=s?a:a.substring(0,s)+"...":"",ze=async a=>{if(window.confirm("¬øEst√°s seguro de que quieres archivar este comprobante? Se mover√° al archivo y no aparecer√° en la lista principal."))try{q(m=>new Set([...m,a]));const s=await p(`/api/payment-proofs/${a}/archive`,{method:"PUT"}),i=w.find(m=>m.id===a);if(i){M(j=>j.filter(y=>y.id!==a));const m={...i,archived:!0,archived_at:new Date().toISOString(),archived_by_name:d.name};R(j=>[m,...j])}Y("Comprobante archivado exitosamente")}catch(s){console.error("Error archiving proof:",s),h("Error al archivar el comprobante: "+(s.message||"Error desconocido"))}finally{q(s=>{const i=new Set(s);return i.delete(a),i})}},De=async a=>{if(window.confirm("¬øEst√°s seguro de que quieres desarchivar este comprobante? Volver√° a aparecer en la lista de comprobantes aprobados."))try{q(m=>new Set([...m,a]));const s=await p(`/api/payment-proofs/${a}/unarchive`,{method:"PUT"}),i=S.find(m=>m.id===a);if(i){R(j=>j.filter(y=>y.id!==a));const m={...i,archived:!1,archived_at:null,archived_by_name:null};M(j=>[m,...j])}Y("Comprobante desarchivado exitosamente")}catch(s){console.error("Error unarchiving proof:",s),h("Error al desarchivar el comprobante: "+(s.message||"Error desconocido"))}finally{q(s=>{const i=new Set(s);return i.delete(a),i})}};return je?e.jsxs(le,{className:"d-flex justify-content-center align-items-center",style:{minHeight:"400px"},children:[e.jsx(k,{animation:"border"}),e.jsx("div",{className:"ms-3",children:e.jsx("p",{children:"Cargando comprobantes de pago..."})})]}):e.jsxs(le,{fluid:!0,children:[e.jsxs(Q,{className:"mb-4",children:[e.jsxs(N,{children:[e.jsx("h2",{children:"üí≥ Sistema de Comprobantes de Pago"}),e.jsx("p",{className:"text-muted",children:d.role==="facturacion"||d.role==="admin"?"Revisar y aprobar comprobantes de pago enviados por vendedores":"Enviar cotizaciones, comprobantes de pago y archivos del proyecto"})]}),e.jsxs(N,{xs:"auto",children:[(d.role==="vendedor_comercial"||d.role==="jefa_comercial")&&e.jsxs(o,{variant:"success",onClick:()=>f(!0),className:"me-2",children:[e.jsx(V,{className:"me-2"}),"Subir Comprobante"]}),e.jsxs(o,{variant:"outline-primary",onClick:_,children:[e.jsx(de,{className:"me-2"}),"Actualizar"]})]})]}),W&&e.jsx(X,{variant:"danger",dismissible:!0,onClose:()=>h(null),children:W}),e.jsxs(Q,{children:[(d.role==="vendedor_comercial"||d.role==="jefa_comercial")&&e.jsx(N,{lg:12,className:"mb-4",children:e.jsxs(x,{children:[e.jsx(x.Header,{children:e.jsxs("h5",{className:"mb-0",children:[e.jsx(u,{className:"me-2"}),"Mis Env√≠os (",T.length,")"]})}),e.jsx(x.Body,{children:T.length===0?e.jsxs("div",{className:"text-center py-4",children:[e.jsx("p",{className:"text-muted",children:"No has enviado ning√∫n comprobante a√∫n"}),e.jsxs(o,{variant:"success",onClick:()=>f(!0),children:[e.jsx(V,{className:"me-2"}),"Subir Primer Comprobante"]})]}):e.jsx("div",{className:"list-group list-group-flush",children:T.map(a=>{var s;return e.jsx("div",{className:"list-group-item",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-start",children:[e.jsxs("div",{children:[e.jsxs("h6",{className:"mb-1",children:["Cotizaci√≥n: ",a.quote_number]}),e.jsxs("p",{className:"mb-1 text-muted",children:[e.jsx("strong",{children:"Cliente:"})," ",a.client_name,e.jsx("br",{}),e.jsx("strong",{children:"Monto:"})," $",(s=a.amount_paid)==null?void 0:s.toLocaleString(),e.jsx("br",{}),e.jsx("strong",{children:"Estado:"}),e.jsx(P,{bg:a.status==="approved"?"success":a.status==="rejected"?"danger":"warning",className:"ms-2",children:a.status==="approved"?"Aprobado":a.status==="rejected"?"Rechazado":"Pendiente"}),a.status==="rejected"&&a.rejection_reason&&e.jsxs("div",{className:"mt-2",children:[e.jsx("strong",{className:"text-danger",children:"Motivo del rechazo:"}),e.jsx("div",{className:"text-danger small mt-1",children:a.rejection_reason})]})]}),e.jsxs("small",{className:"text-muted",children:["Enviado: ",new Date(a.created_at).toLocaleDateString()]})]}),e.jsx("div",{className:"d-flex flex-column gap-2",children:e.jsxs(o,{variant:"outline-primary",size:"sm",onClick:()=>A(a.id),children:[e.jsx(g,{className:"me-1"}),"Ver"]})})]})},a.id)})})})]})}),(d.role==="facturacion"||d.role==="admin")&&e.jsx(N,{lg:6,children:e.jsxs(x,{children:[e.jsx(x.Header,{children:e.jsxs("h5",{className:"mb-0",children:[e.jsx(u,{className:"me-2"}),"Comprobantes Pendientes (",L.length,")"]})}),e.jsx(x.Body,{children:L.length===0?e.jsx("p",{className:"text-muted text-center",children:"No hay comprobantes pendientes"}):e.jsx("div",{className:"list-group list-group-flush",children:L.map(a=>{var s;return e.jsx("div",{className:"list-group-item",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-start",children:[e.jsxs("div",{children:[e.jsxs("h6",{className:"mb-1",children:["Cotizaci√≥n: ",a.quote_number]}),e.jsxs("p",{className:"mb-1 text-muted",children:[e.jsx("strong",{children:"Empresa:"})," ",a.company_name,e.jsx("br",{}),e.jsx("strong",{children:"Monto:"})," $",(s=a.amount_paid)==null?void 0:s.toLocaleString(),e.jsx("br",{}),e.jsx("strong",{children:"M√©todo:"})," ",a.payment_method,e.jsx("br",{}),e.jsx("strong",{children:"Fecha:"})," ",new Date(a.payment_date).toLocaleDateString(),e.jsx("br",{}),e.jsx("strong",{children:"Subido por:"})," ",a.uploaded_by_name]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("strong",{children:"Archivos adjuntos:"}),e.jsxs("div",{className:"d-flex flex-wrap gap-2 mt-1",children:[e.jsxs(P,{bg:"primary",className:"d-flex align-items-center",children:[e.jsx(u,{className:"me-1"}),"Comprobante"]}),a.quote_file_name&&e.jsxs(P,{bg:"info",className:"d-flex align-items-center",children:[e.jsx(u,{className:"me-1"}),"Cotizaci√≥n"]}),a.project_name&&e.jsxs(P,{bg:"success",className:"d-flex align-items-center",children:[e.jsx(I,{className:"me-1"}),a.project_name]})]})]}),a.description&&e.jsxs("div",{className:"mb-1 text-muted",children:[e.jsx("strong",{children:"Descripci√≥n:"}),e.jsx("div",{className:"mt-1",children:ne.has(a.id)?e.jsxs("div",{children:[e.jsx("div",{className:"text-break",style:{wordBreak:"break-word"},children:a.description}),e.jsx(o,{variant:"link",size:"sm",className:"p-0 text-primary",onClick:()=>oe(a.id),children:"Ver menos"})]}):e.jsxs("div",{children:[e.jsx("div",{className:"text-break",style:{wordBreak:"break-word"},children:Ee(a.description,150)}),a.description.length>150&&e.jsx(o,{variant:"link",size:"sm",className:"p-0 text-primary",onClick:()=>oe(a.id),children:"Ver descripci√≥n completa"})]})})]})]}),e.jsxs("div",{className:"d-flex flex-column gap-2",children:[e.jsxs(o,{variant:"outline-primary",size:"sm",onClick:()=>A(a.id),children:[e.jsx(g,{className:"me-1"}),"Ver"]}),e.jsxs(o,{variant:"success",size:"sm",onClick:()=>{$(a),E(!0)},children:[e.jsx(J,{className:"me-1"}),"Aprobar"]}),e.jsxs(o,{variant:"danger",size:"sm",onClick:()=>{$(a),z(!0)},children:[e.jsx(me,{className:"me-1"}),"Rechazar"]})]})]})},a.id)})})})]})}),(d.role==="facturacion"||d.role==="admin")&&e.jsx(N,{lg:6,children:e.jsxs(x,{children:[e.jsx(x.Header,{children:e.jsxs("h5",{className:"mb-0",children:[e.jsx(J,{className:"me-2"}),"Comprobantes Aprobados (",w.length,")"]})}),e.jsx(x.Body,{children:w.length===0?e.jsx("p",{className:"text-muted text-center",children:"No hay comprobantes aprobados"}):e.jsx("div",{className:"list-group list-group-flush",children:w.map(a=>{var s;return e.jsx("div",{className:"list-group-item",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-start",children:[e.jsxs("div",{children:[e.jsxs("h6",{className:"mb-1",children:["Cotizaci√≥n: ",a.quote_number]}),e.jsxs("p",{className:"mb-1 text-muted",children:[e.jsx("strong",{children:"Empresa:"})," ",a.company_name,e.jsx("br",{}),e.jsx("strong",{children:"Monto:"})," $",(s=a.amount_paid)==null?void 0:s.toLocaleString(),e.jsx("br",{}),e.jsx("strong",{children:"M√©todo:"})," ",a.payment_method,e.jsx("br",{}),e.jsx("strong",{children:"Fecha de pago:"})," ",new Date(a.payment_date).toLocaleDateString(),e.jsx("br",{}),e.jsx("strong",{children:"Aprobado por:"})," ",a.approved_by_name,e.jsx("br",{}),e.jsx("strong",{children:"Fecha de aprobaci√≥n:"})," ",new Date(a.approved_at).toLocaleDateString()]})]}),e.jsxs("div",{className:"d-flex flex-column gap-2",children:[e.jsxs(o,{variant:"outline-primary",size:"sm",onClick:()=>A(a.id),children:[e.jsx(g,{className:"me-1"}),"Descargar"]}),e.jsx(o,{variant:"outline-warning",size:"sm",onClick:()=>ze(a.id),disabled:D.has(a.id),children:D.has(a.id)?e.jsxs(e.Fragment,{children:[e.jsx(k,{animation:"border",size:"sm",className:"me-1"}),"Archivando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(he,{className:"me-1"}),"Archivar"]})})]})]})},a.id)})})})]})})]}),(d.role==="facturacion"||d.role==="admin")&&e.jsx(Q,{className:"mt-4",children:e.jsx(N,{children:e.jsxs(x,{children:[e.jsx(x.Header,{children:e.jsxs("h5",{className:"mb-0",children:[e.jsx(he,{className:"me-2"}),"Comprobantes Archivados (",S.length,")"]})}),e.jsx(x.Body,{children:S.length===0?e.jsx("p",{className:"text-muted text-center",children:"No hay comprobantes archivados"}):e.jsx("div",{className:"list-group list-group-flush",children:S.map(a=>{var s;return e.jsx("div",{className:"list-group-item",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-start",children:[e.jsxs("div",{children:[e.jsxs("h6",{className:"mb-1",children:["Cotizaci√≥n: ",a.quote_number]}),e.jsxs("p",{className:"mb-1 text-muted",children:[e.jsx("strong",{children:"Empresa:"})," ",a.company_name,e.jsx("br",{}),e.jsx("strong",{children:"Monto:"})," $",(s=a.amount_paid)==null?void 0:s.toLocaleString(),e.jsx("br",{}),e.jsx("strong",{children:"M√©todo:"})," ",a.payment_method,e.jsx("br",{}),e.jsx("strong",{children:"Fecha de pago:"})," ",new Date(a.payment_date).toLocaleDateString(),e.jsx("br",{}),e.jsx("strong",{children:"Archivado por:"})," ",a.archived_by_name,e.jsx("br",{}),e.jsx("strong",{children:"Fecha de archivado:"})," ",new Date(a.archived_at).toLocaleDateString()]})]}),e.jsxs("div",{className:"d-flex flex-column gap-2",children:[e.jsxs(o,{variant:"outline-primary",size:"sm",onClick:()=>A(a.id),children:[e.jsx(g,{className:"me-1"}),"Descargar"]}),e.jsx(o,{variant:"outline-success",size:"sm",onClick:()=>De(a.id),disabled:D.has(a.id),children:D.has(a.id)?e.jsxs(e.Fragment,{children:[e.jsx(k,{animation:"border",size:"sm",className:"me-1"}),"Desarchivando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(de,{className:"me-1"}),"Desarchivar"]})})]})]})},a.id)})})})]})})}),e.jsxs(l,{show:ue,onHide:()=>f(!1),size:"lg",children:[e.jsx(l.Header,{closeButton:!0,children:e.jsx(l.Title,{children:"Subir Comprobante de Pago"})}),e.jsx(l.Body,{children:e.jsxs(n,{children:[e.jsxs(n.Group,{className:"mb-3",children:[e.jsx(n.Label,{children:"Seleccionar Cotizaci√≥n *"}),e.jsxs(n.Select,{value:t.quote_id,onChange:a=>{const s=F.find(i=>i.id===parseInt(a.target.value));b({...t,quote_id:a.target.value,client_name:(s==null?void 0:s.company_name)||"",client_email:(s==null?void 0:s.client_email)||""})},required:!0,disabled:H,children:[e.jsx("option",{value:"",children:H?"Cargando cotizaciones...":"Seleccione una cotizaci√≥n"}),F.map(a=>{var s;return e.jsxs("option",{value:a.id,children:[a.quote_code||`COT-${a.id}`," - ",a.company_name," - S/ ",((s=a.total)==null?void 0:s.toLocaleString())||"0.00"]},a.id)})]}),F.length===0&&!H&&e.jsx(n.Text,{className:"text-warning",children:"No tienes cotizaciones disponibles. Crea una cotizaci√≥n primero."})]}),t.quote_id&&e.jsxs("div",{className:"mb-3 p-3 bg-light rounded",children:[e.jsx("h6",{className:"text-primary mb-2",children:"üìã Informaci√≥n de la Cotizaci√≥n"}),(()=>{var s;const a=F.find(i=>i.id===parseInt(t.quote_id));return a?e.jsxs("div",{children:[e.jsxs("p",{className:"mb-1",children:[e.jsx("strong",{children:"C√≥digo:"})," ",a.quote_code||`COT-${a.id}`]}),e.jsxs("p",{className:"mb-1",children:[e.jsx("strong",{children:"Cliente:"})," ",a.company_name]}),e.jsxs("p",{className:"mb-1",children:[e.jsx("strong",{children:"Total:"})," S/ ",((s=a.total)==null?void 0:s.toLocaleString())||"0.00"]}),e.jsxs("p",{className:"mb-1",children:[e.jsx("strong",{children:"Categor√≠a:"}),e.jsx("span",{className:`badge ms-2 ${a.category_main==="laboratorio"?"bg-info":"bg-warning"}`,children:a.category_main==="laboratorio"?"üß™ Laboratorio":"‚öôÔ∏è Ingenier√≠a"})]}),e.jsxs("p",{className:"mb-0",children:[e.jsx("strong",{children:"Estado:"}),e.jsx("span",{className:`badge ms-2 ${a.status==="borrador"?"bg-secondary":"bg-success"}`,children:a.status==="borrador"?"Borrador":"Aprobada"})]})]}):e.jsx("p",{className:"text-muted",children:"Cargando informaci√≥n..."})})()]}),e.jsxs(n.Group,{className:"mb-3",children:[e.jsx(n.Label,{children:"Monto Pagado *"}),e.jsx(n.Control,{type:"number",step:"0.01",value:t.amount_paid,onChange:a=>b({...t,amount_paid:a.target.value}),placeholder:"0.00",required:!0})]}),e.jsxs(n.Group,{className:"mb-3",children:[e.jsx(n.Label,{children:"Fecha de Pago *"}),e.jsx(n.Control,{type:"date",value:t.payment_date,onChange:a=>b({...t,payment_date:a.target.value}),required:!0})]}),e.jsxs(n.Group,{className:"mb-3",children:[e.jsx(n.Label,{children:"M√©todo de Pago *"}),e.jsxs(n.Select,{value:t.payment_method,onChange:a=>b({...t,payment_method:a.target.value}),required:!0,children:[e.jsx("option",{value:"",children:"Seleccione m√©todo"}),e.jsx("option",{value:"Transferencia bancaria",children:"Transferencia bancaria"}),e.jsx("option",{value:"Dep√≥sito bancario",children:"Dep√≥sito bancario"}),e.jsx("option",{value:"Efectivo",children:"Efectivo"}),e.jsx("option",{value:"Cheque",children:"Cheque"}),e.jsx("option",{value:"Tarjeta de cr√©dito",children:"Tarjeta de cr√©dito"}),e.jsx("option",{value:"Otro",children:"Otro"})]})]}),e.jsxs(n.Group,{className:"mb-3",children:[e.jsx(n.Label,{children:"Descripci√≥n"}),e.jsx(n.Control,{as:"textarea",rows:3,value:t.description,onChange:a=>b({...t,description:a.target.value}),placeholder:"Descripci√≥n adicional del pago..."})]}),e.jsxs(n.Group,{className:"mb-3",children:[e.jsx(n.Label,{children:"Comprobante de Pago *"}),e.jsx(n.Control,{type:"file",accept:"image/*,.pdf,.doc,.docx",onChange:_e,required:!0}),e.jsx(n.Text,{className:"text-muted",children:"Formatos permitidos: JPG, PNG, PDF, DOC, DOCX (m√°ximo 10MB)"})]})]})}),e.jsxs(l.Footer,{children:[e.jsx(o,{variant:"secondary",onClick:()=>f(!1),children:"Cancelar"}),e.jsxs(o,{variant:"primary",onClick:Ce,disabled:O||!t.quote_id||!t.amount_paid||!t.payment_date||!t.payment_method||!t.payment_proof,children:[O?e.jsx(k,{size:"sm",className:"me-2"}):e.jsx(V,{className:"me-1"}),O?"Subiendo...":"Subir Comprobante"]})]})]}),e.jsxs(l,{show:ge,onHide:()=>E(!1),children:[e.jsx(l.Header,{closeButton:!0,children:e.jsx(l.Title,{children:"Confirmar Aprobaci√≥n"})}),e.jsxs(l.Body,{children:[e.jsx("p",{children:"¬øEst√° seguro de que desea aprobar el comprobante de pago?"}),e.jsxs("p",{children:[e.jsx("strong",{children:"Cotizaci√≥n:"})," ",r==null?void 0:r.quote_number]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Monto Reportado:"})," S/ ",(ie=r==null?void 0:r.amount_paid)==null?void 0:ie.toLocaleString()]}),e.jsxs(n.Group,{className:"mb-3",children:[e.jsx(n.Label,{children:"Monto Real Pagado por el Cliente *"}),e.jsx(n.Control,{type:"number",step:"0.01",value:v,onChange:a=>re(a.target.value),placeholder:"Ingrese el monto real pagado por el cliente",required:!0}),e.jsx(n.Text,{className:"text-muted",children:"Este monto se usar√° para alimentar el embudo de ventas y an√°lisis de m√©tricas."})]}),e.jsxs(n.Group,{className:"mb-3",children:[e.jsx(n.Label,{children:"Notas de aprobaci√≥n:"}),e.jsx(n.Control,{as:"textarea",rows:3,value:ae,onChange:a=>se(a.target.value),placeholder:"Notas adicionales sobre la aprobaci√≥n..."})]})]}),e.jsxs(l.Footer,{children:[e.jsx(o,{variant:"secondary",onClick:()=>E(!1),children:"Cancelar"}),e.jsxs(o,{variant:"success",onClick:we,disabled:!v||parseFloat(v)<=0,children:[e.jsx(J,{className:"me-1"}),"Aprobar y Alimentar Embudo"]})]})]}),e.jsxs(l,{show:be,onHide:()=>z(!1),children:[e.jsx(l.Header,{closeButton:!0,children:e.jsx(l.Title,{children:"Rechazar Comprobante"})}),e.jsxs(l.Body,{children:[e.jsx("p",{children:"¬øEst√° seguro de que desea rechazar el comprobante de pago?"}),e.jsxs("p",{children:[e.jsx("strong",{children:"Cotizaci√≥n:"})," ",r==null?void 0:r.quote_number]}),e.jsxs(n.Group,{className:"mb-3",children:[e.jsx(n.Label,{children:"Motivo del rechazo:"}),e.jsx(n.Control,{as:"textarea",rows:3,value:U,onChange:a=>ee(a.target.value),placeholder:"Ingrese el motivo del rechazo...",required:!0})]})]}),e.jsxs(l.Footer,{children:[e.jsx(o,{variant:"secondary",onClick:()=>z(!1),children:"Cancelar"}),e.jsxs(o,{variant:"danger",onClick:Se,disabled:!U.trim(),children:[e.jsx(me,{className:"me-1"}),"Rechazar"]})]})]}),e.jsxs(l,{show:ve,onHide:()=>B(!1),size:"lg",children:[e.jsx(l.Header,{closeButton:!0,children:e.jsxs(l.Title,{children:[e.jsx(g,{className:"me-2"}),"Descargar Archivos"]})}),e.jsx(l.Body,{children:r&&e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h6",{children:"Informaci√≥n del Comprobante"}),e.jsxs("p",{children:[e.jsx("strong",{children:"Cotizaci√≥n:"})," ",r.quote_number]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Empresa:"})," ",r.company_name]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Monto:"})," $",(ce=r.amount_paid)==null?void 0:ce.toLocaleString()]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Fecha:"})," ",new Date(r.created_at).toLocaleDateString()]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h6",{children:"Documentos Disponibles"}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("h6",{className:"text-primary mb-2",children:[e.jsx(Fe,{className:"me-2"}),"Comprobante de Pago"]}),r.file_path?e.jsxs(o,{variant:"primary",onClick:()=>G(r.file_path,r.file_name||`comprobante-${r.id}.pdf`,"payment_proof"),className:"d-flex align-items-center justify-content-between w-100",children:[e.jsxs("span",{children:[e.jsx(u,{className:"me-2"}),"Descargar Comprobante de Pago"]}),e.jsx(g,{})]}):e.jsxs(X,{variant:"warning",className:"mb-0",children:[e.jsx(u,{className:"me-2"}),"No hay comprobante de pago disponible"]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("h6",{className:"text-success mb-2",children:[e.jsx(u,{className:"me-2"}),"Cotizaci√≥n"]}),e.jsx("div",{className:"d-grid gap-2",children:r.quote_file_path&&e.jsxs(o,{variant:"outline-secondary",onClick:()=>G(r.quote_file_path,`cotizacion-original-${r.id}.pdf`,"quote_file"),className:"d-flex align-items-center justify-content-between",children:[e.jsxs("span",{children:[e.jsx(u,{className:"me-2"}),"Cotizaci√≥n Original (Archivo Adjunto)"]}),e.jsx(g,{})]})})]}),r.project_files&&r.project_files.length>0&&e.jsxs("div",{className:"mb-3",children:[e.jsxs("h6",{className:"text-info mb-2",children:[e.jsx(I,{className:"me-2"}),"Archivos del Proyecto"]}),e.jsx("div",{className:"d-grid gap-1",children:r.project_files.map((a,s)=>e.jsxs(o,{variant:"outline-info",size:"sm",onClick:()=>G(a.path,a.name,"project_file"),className:"d-flex align-items-center justify-content-between",children:[e.jsxs("span",{children:[e.jsx(I,{className:"me-2"}),a.name]}),e.jsx(g,{})]},s))})]})]}),!r.payment_proof_path&&!r.quote_file_path&&(!r.project_files||r.project_files.length===0)&&e.jsxs(X,{variant:"warning",children:[e.jsx(u,{className:"me-2"}),"No hay archivos adjuntos disponibles para este comprobante."]})]})}),e.jsx(l.Footer,{children:e.jsx(o,{variant:"secondary",onClick:()=>B(!1),children:"Cerrar"})})]})]})};export{Oe as default};
//# sourceMappingURL=ComprobantesPago-DantGBv2.js.map
