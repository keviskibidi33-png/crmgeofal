import{r as n,u as z,Q as B,c as L,R as x,j as s,U as H,h as c,B as Q,V as U,d as N,_ as I,y as P,Z as T,x as V}from"./index-B6K4MeZ_.js";import{P as G,R as Z,C as d}from"./PageHeader-ZaYSeG4B.js";import{D as J}from"./DataTable-DtW7TOza.js";import{M as K}from"./ModalForm-DoSAJory.js";import{S as m}from"./StatsCard-BQEilZ7W.js";import{d as O,c as W,u as X,l as Y}from"./projects-UCcvN5gF.js";import{C as h}from"./Card-C3FyhA6L.js";import"./InputGroup-B3UJk0zl.js";import"./Form-DajNugM3.js";import"./Spinner-Cd5nug_F.js";const C={company_id:"",name:"",location:"",vendedor_id:"",laboratorio_id:""};function me(){var y,b,v;const[E,l]=n.useState(!1),[o,u]=n.useState(null),[ee,S]=n.useState(null);z();const M=B(),{data:a,isLoading:_}=L(["projects"],()=>Y(),{keepPreviousData:!0}),p=e=>{M.invalidateQueries("projects"),l(!1),u(null),S(null)},j=x(W,{onSuccess:()=>p(),onError:e=>console.error("Error creating project:",e)}),g=x(X,{onSuccess:()=>p(),onError:e=>console.error("Error updating project:",e)}),F=x(O,{onSuccess:()=>p(),onError:e=>console.error("Error deleting project:",e)}),w=()=>{u(C),l(!0)},A=e=>{u(e),l(!0)},$=e=>{window.confirm(`¿Estás seguro de que quieres eliminar el proyecto "${e.name}"?`)&&F.mutate(e.id)},D=async e=>{o.id?await g.mutateAsync({id:o.id,...e}):await j.mutateAsync(e)},R=e=>{const i={activo:{bg:"success",text:"Activo"},pendiente:{bg:"warning",text:"Pendiente"},completado:{bg:"primary",text:"Completado"},cancelado:{bg:"danger",text:"Cancelado"}}[e]||{bg:"secondary",text:e};return s.jsx(P,{bg:i.bg,className:"status-badge",children:i.text})},k=[{header:"ID",accessor:"id",width:"80px"},{header:"Proyecto",accessor:"name",render:(e,t)=>s.jsxs("div",{children:[s.jsx("div",{className:"fw-medium",children:t.name}),t.location&&s.jsxs("small",{className:"text-muted",children:[s.jsx(T,{size:12,className:"me-1"}),t.location]})]})},{header:"Empresa",accessor:"company",render:(e,t)=>{var i,f;return s.jsxs("div",{children:[s.jsx("div",{className:"fw-medium",children:((i=t.company)==null?void 0:i.name)||"Sin empresa"}),((f=t.company)==null?void 0:f.ruc)&&s.jsxs("small",{className:"text-muted",children:["RUC: ",t.company.ruc]})]})}},{header:"Estado",accessor:"status",render:e=>R(e||"activo")},{header:"Asignado a",accessor:"vendedor",render:(e,t)=>s.jsxs("div",{children:[t.vendedor&&s.jsxs("div",{className:"d-flex align-items-center",children:[s.jsx(V,{size:14,className:"me-1 text-muted"}),s.jsx("span",{children:t.vendedor.name})]}),t.laboratorio&&s.jsxs("div",{className:"d-flex align-items-center mt-1",children:[s.jsx(c,{size:14,className:"me-1 text-muted"}),s.jsx("span",{className:"small text-muted",children:t.laboratorio.name})]})]})},{header:"Fecha Creación",accessor:"created_at",type:"date"}],q=[{name:"company_id",label:"Empresa",type:"select",required:!0,options:((y=a==null?void 0:a.companies)==null?void 0:y.map(e=>({value:e.id,label:`${e.name} (${e.ruc})`})))||[]},{name:"name",label:"Nombre del Proyecto",type:"text",required:!0,placeholder:"Ingresa el nombre del proyecto"},{name:"location",label:"Ubicación",type:"text",placeholder:"Ingresa la ubicación del proyecto"},{name:"vendedor_id",label:"Vendedor Asignado",type:"select",options:((b=a==null?void 0:a.users)==null?void 0:b.filter(e=>["vendedor_comercial","jefa_comercial"].includes(e.role)).map(e=>({value:e.id,label:`${e.name} ${e.apellido}`})))||[]},{name:"laboratorio_id",label:"Responsable de Laboratorio",type:"select",options:((v=a==null?void 0:a.users)==null?void 0:v.filter(e=>["jefe_laboratorio","usuario_laboratorio","laboratorio"].includes(e.role)).map(e=>({value:e.id,label:`${e.name} ${e.apellido}`})))||[]}],r=n.useMemo(()=>{const e=(a==null?void 0:a.projects)||[];return{total:e.length,activos:e.filter(t=>t.status==="activo").length,completados:e.filter(t=>t.status==="completado").length,pendientes:e.filter(t=>t.status==="pendiente").length,cancelados:e.filter(t=>t.status==="cancelado").length}},[a]);return s.jsx(H,{fluid:!0,className:"py-4",children:s.jsxs("div",{className:"fade-in",children:[s.jsx(G,{title:"Gestión de Proyectos",subtitle:"Crear, editar y gestionar proyectos del sistema",icon:c,actions:s.jsxs(Q,{variant:"primary",onClick:w,children:[s.jsx(U,{className:"me-2"}),"Nuevo Proyecto"]})}),s.jsxs(Z,{className:"g-4 mb-4",children:[s.jsx(d,{md:6,lg:3,children:s.jsx(m,{title:"Total Proyectos",value:r.total,icon:c,color:"primary",subtitle:"Proyectos registrados"})}),s.jsx(d,{md:6,lg:3,children:s.jsx(m,{title:"Proyectos Activos",value:r.activos,icon:N,color:"success",subtitle:"En desarrollo"})}),s.jsx(d,{md:6,lg:3,children:s.jsx(m,{title:"Completados",value:r.completados,icon:N,color:"info",subtitle:"Finalizados"})}),s.jsx(d,{md:6,lg:3,children:s.jsx(m,{title:"Pendientes",value:r.pendientes,icon:I,color:"warning",subtitle:"Por iniciar"})})]}),s.jsxs(h,{className:"shadow-sm border-0",children:[s.jsx(h.Header,{className:"bg-white border-bottom",children:s.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[s.jsxs("h5",{className:"mb-0",children:[s.jsx(c,{className:"me-2 text-primary"}),"Lista de Proyectos"]}),s.jsxs(P,{bg:"light",text:"dark",className:"px-3 py-2",children:[r.total," proyectos"]})]})}),s.jsx(h.Body,{className:"p-0",children:s.jsx(J,{data:(a==null?void 0:a.projects)||[],columns:k,loading:_,onEdit:A,onDelete:$,emptyMessage:"No hay proyectos registrados"})})]}),s.jsx(K,{show:E,onHide:()=>l(!1),title:o!=null&&o.id?"Editar Proyecto":"Nuevo Proyecto",data:o||C,fields:q,onSubmit:D,loading:j.isLoading||g.isLoading,submitText:o!=null&&o.id?"Actualizar":"Crear"})]})})}export{me as default};
//# sourceMappingURL=Proyectos-CknMZjTy.js.map
