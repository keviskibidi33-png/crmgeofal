import{u as K,a7 as O,c as G,r as n,e as P,j as e,O as E,S as A,l as N,f as k,a9 as J,$ as V,n as T,a4 as _,a2 as W,A as X,a1 as L,aa as Y,b as U}from"./index-ACE2z3o6.js";const ee=()=>{var F;K(),O(),G();const[t,I]=n.useState(""),[m,b]=n.useState(""),[j,f]=n.useState("all"),[u,y]=n.useState("all"),[l,o]=n.useState(1),[r]=n.useState(20),{data:x}=P("projects-list",()=>U("/api/projects?limit=500"),{staleTime:5*60*1e3}),{data:c,isLoading:$,error:w}=P(["project-history",t,l,r,m,j,u],()=>H(t,{page:l,limit:r,search:m,action:j,date:u}),{enabled:!!t,keepPreviousData:!0}),H=async(s,a={})=>{const i=new URLSearchParams;a.page&&i.set("page",a.page),a.limit&&i.set("limit",a.limit),a.search&&i.set("search",a.search),a.action&&a.action!=="all"&&i.set("action",a.action),a.date&&a.date!=="all"&&i.set("date",a.date);const h=i.toString(),v=`/api/project-history/project/${s}${h?`?${h}`:""}`;return U(v)},p=(c==null?void 0:c.data)||[],d=(c==null?void 0:c.total)||0,g=Math.ceil(d/r),C=[{value:"all",label:"Todas las acciones",icon:N},{value:"created",label:"Proyecto creado",icon:k},{value:"updated",label:"Proyecto actualizado",icon:J},{value:"status_changed",label:"Estado cambiado",icon:V},{value:"assigned",label:"Asignado",icon:T},{value:"completed",label:"Completado",icon:k},{value:"cancelled",label:"Cancelado",icon:_}],R=s=>{const a=C.find(i=>i.value===s);return a?a.icon:Y},q=s=>({created:"#10b981",updated:"#3b82f6",status_changed:"#f59e0b",assigned:"#8b5cf6",completed:"#10b981",cancelled:"#ef4444"})[s]||"#6b7280",B=s=>{const a=new Date(s);return{date:a.toLocaleDateString("es-ES"),time:a.toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit"})}},M=s=>s.performed_by_name?s.performed_by_name:`Usuario ${s.performed_by}`,D=s=>{I(s),o(1)},S=()=>{o(1)},Q=()=>{b(""),f("all"),y("all"),o(1)};return e.jsxs("div",{className:"historial-proyectos",children:[e.jsx("div",{className:"historial-header",children:e.jsxs("div",{className:"historial-title",children:[e.jsx(E,{className:"title-icon"}),e.jsxs("div",{children:[e.jsx("h1",{children:"Historial de Proyectos"}),e.jsx("p",{children:"Seguimiento completo de cambios y eventos en proyectos"})]})]})}),e.jsxs("div",{className:"historial-filters",children:[e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{className:"filter-label",children:"Proyecto"}),e.jsxs("select",{className:"filter-select",value:t,onChange:s=>D(s.target.value),children:[e.jsx("option",{value:"",children:"Seleccionar proyecto"}),(F=x==null?void 0:x.data)==null?void 0:F.map(s=>e.jsxs("option",{value:s.id,children:["#",s.id," - ",s.name]},s.id))]})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{className:"filter-label",children:"Buscar"}),e.jsxs("div",{className:"search-input-group",children:[e.jsx(A,{className:"search-icon"}),e.jsx("input",{type:"text",className:"search-input",placeholder:"Buscar en historial...",value:m,onChange:s=>b(s.target.value),onKeyPress:s=>s.key==="Enter"&&S()})]})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{className:"filter-label",children:"Acción"}),e.jsx("select",{className:"filter-select",value:j,onChange:s=>f(s.target.value),children:C.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{className:"filter-label",children:"Período"}),e.jsxs("select",{className:"filter-select",value:u,onChange:s=>y(s.target.value),children:[e.jsx("option",{value:"all",children:"Todos los períodos"}),e.jsx("option",{value:"today",children:"Hoy"}),e.jsx("option",{value:"week",children:"Esta semana"}),e.jsx("option",{value:"month",children:"Este mes"}),e.jsx("option",{value:"quarter",children:"Este trimestre"})]})]}),e.jsxs("div",{className:"filter-actions",children:[e.jsxs("button",{className:"btn-search",onClick:S,disabled:!t,children:[e.jsx(A,{}),"Buscar"]}),e.jsxs("button",{className:"btn-clear",onClick:Q,children:[e.jsx(W,{}),"Limpiar"]})]})]}),t?$?e.jsxs("div",{className:"historial-loading",children:[e.jsx(X,{className:"loading-icon"}),e.jsx("p",{children:"Cargando historial..."})]}):w?e.jsxs("div",{className:"historial-error",children:[e.jsx(_,{className:"error-icon"}),e.jsx("h3",{children:"Error al cargar historial"}),e.jsx("p",{children:"No se pudo obtener el historial del proyecto"})]}):p.length===0?e.jsxs("div",{className:"historial-empty",children:[e.jsx(E,{className:"empty-icon"}),e.jsx("h3",{children:"Sin historial"}),e.jsx("p",{children:"Este proyecto no tiene registros en el historial"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"historial-stats",children:[e.jsxs("div",{className:"stat-card",children:[e.jsx(N,{className:"stat-icon"}),e.jsxs("div",{children:[e.jsx("span",{className:"stat-number",children:d}),e.jsx("span",{className:"stat-label",children:"Registros totales"})]})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx(L,{className:"stat-icon"}),e.jsxs("div",{children:[e.jsx("span",{className:"stat-number",children:p.length}),e.jsx("span",{className:"stat-label",children:"En esta página"})]})]})]}),e.jsx("div",{className:"historial-list",children:p.map((s,a)=>{const i=R(s.action),h=q(s.action),{date:v,time:z}=B(s.performed_at);return e.jsxs("div",{className:"historial-item",children:[e.jsx("div",{className:"historial-item-icon",style:{backgroundColor:h},children:e.jsx(i,{})}),e.jsxs("div",{className:"historial-item-content",children:[e.jsxs("div",{className:"historial-item-header",children:[e.jsx("h4",{className:"historial-item-title",children:s.action.replace("_"," ").toUpperCase()}),e.jsxs("div",{className:"historial-item-meta",children:[e.jsxs("span",{className:"historial-item-user",children:[e.jsx(T,{}),M(s)]}),e.jsxs("span",{className:"historial-item-date",children:[e.jsx(L,{}),v," a las ",z]})]})]}),s.notes&&e.jsx("div",{className:"historial-item-notes",children:e.jsx("p",{children:s.notes})})]})]},s.id)})}),g>1&&e.jsxs("div",{className:"historial-pagination",children:[e.jsxs("div",{className:"pagination-info",children:["Mostrando ",(l-1)*r+1," - ",Math.min(l*r,d)," de ",d," registros"]}),e.jsxs("div",{className:"pagination-controls",children:[e.jsx("button",{className:"pagination-btn",onClick:()=>o(s=>s-1),disabled:l<=1,children:"Anterior"}),e.jsxs("span",{className:"pagination-page",children:["Página ",l," de ",g]}),e.jsx("button",{className:"pagination-btn",onClick:()=>o(s=>s+1),disabled:l>=g,children:"Siguiente"})]})]})]}):e.jsxs("div",{className:"historial-empty",children:[e.jsx(N,{className:"empty-icon"}),e.jsx("h3",{children:"Selecciona un proyecto"}),e.jsx("p",{children:"Elige un proyecto de la lista para ver su historial completo"})]})]})};export{ee as default};
//# sourceMappingURL=HistorialProyectos-DHyaVU09.js.map
