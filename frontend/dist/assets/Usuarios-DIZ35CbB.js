import{b as N,R as t,j as e}from"./index-BFrTSJXc.js";import{M as T}from"./ModuloBase-BXjPI6cD.js";import{D as U}from"./DataTable-CSrcfzDj.js";import{T as R}from"./Toolbar-CsECCMO9.js";import{T as q}from"./Toast-BbbM5Ntr.js";import{u as A}from"./useQuery-C56LzOWb.js";const E=(s={})=>{const r=new URLSearchParams;s.page&&r.set("page",s.page),s.limit&&r.set("limit",s.limit),s.search&&r.set("search",s.search),s.area&&r.set("area",s.area),s.role&&r.set("role",s.role);const l=r.toString(),u=l?`/api/users?${l}`:"/api/users";return N(u)},M=s=>N("/api/users",{method:"POST",body:JSON.stringify(s)});function G(){const[s,r]=t.useState(""),[l,u]=t.useState(""),[i,c]=t.useState(1),[j]=t.useState(10),[h,x]=t.useState({show:!1,variant:"success",message:""}),[y,b]=t.useState(!1),[d,m]=t.useState({name:"",email:"",password:"",role:""}),{data:n,isLoading:w,isError:g,error:p}=A(["users",{page:i,limit:j,q:s,role:l}],async()=>{const a=await E({page:i,limit:j,search:s,role:l}),o=Array.isArray(a==null?void 0:a.data)?a.data:(a==null?void 0:a.rows)||a||[],k=(a==null?void 0:a.total)??o.length;return{rows:o,total:k}});t.useEffect(()=>{g&&p&&x({show:!0,variant:"danger",message:p.message||"No se pudo cargar usuarios"})},[g,p]);const C=()=>{r(""),u(""),c(1)},f=(n==null?void 0:n.total)||0,S=(n==null?void 0:n.rows)||[],v=Math.max(1,Math.ceil(f/j));return e.jsxs(T,{titulo:"Gestión de Usuarios",descripcion:"Crear, editar y eliminar usuarios del sistema.",children:[e.jsx(R,{compact:!0,left:e.jsxs(e.Fragment,{children:[e.jsx("input",{className:"form-control",style:{minWidth:220},placeholder:"Buscar por nombre o email",value:s,onChange:a=>{r(a.target.value),c(1)}}),e.jsxs("select",{className:"form-select",value:l,onChange:a=>{u(a.target.value),c(1)},children:[e.jsx("option",{value:"",children:"Todos los roles"}),e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"soporte",children:"Soporte"}),e.jsx("option",{value:"jefa_comercial",children:"Jefa Comercial"}),e.jsx("option",{value:"vendedor_comercial",children:"Vendedor"}),e.jsx("option",{value:"laboratorio",children:"Laboratorio"}),e.jsx("option",{value:"gerencia",children:"Gerencia"})]})]}),right:e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"btn btn-primary",onClick:()=>b(!0),children:"Crear Usuario"}),e.jsx("button",{className:"btn btn-outline-secondary",onClick:C,children:"Limpiar"})]})}),e.jsx(U,{columns:[{header:"ID",key:"id",width:80},{header:"Nombre",key:"name"},{header:"Email",key:"email"},{header:"Rol",key:"role"},{header:"Acciones",key:"actions",render:()=>null,width:120}],rows:S,loading:w}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{className:"text-muted small",children:["Total: ",f]}),e.jsxs("div",{className:"btn-group",children:[e.jsx("button",{className:"btn btn-outline-secondary",disabled:i<=1,onClick:()=>c(a=>Math.max(1,a-1)),children:"Anterior"}),e.jsxs("span",{className:"btn btn-outline-secondary disabled",children:[i,"/",v]}),e.jsx("button",{className:"btn btn-outline-secondary",disabled:i>=v,onClick:()=>c(a=>Math.min(v,a+1)),children:"Siguiente"})]})]}),e.jsx(q,{show:h.show,variant:h.variant,onClose:()=>x({...h,show:!1}),children:h.message}),y&&e.jsx("div",{className:"modal d-block",tabIndex:"-1",role:"dialog",style:{background:"rgba(0,0,0,0.35)"},children:e.jsx("div",{className:"modal-dialog",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h5",{className:"modal-title",children:"Crear Usuario"}),e.jsx("button",{type:"button",className:"btn-close",onClick:()=>b(!1)})]}),e.jsxs("form",{onSubmit:async a=>{a.preventDefault();try{await M(d),x({show:!0,variant:"success",message:"Usuario creado"}),b(!1),m({name:"",email:"",password:"",role:""})}catch(o){x({show:!0,variant:"danger",message:o.message||"Error al crear usuario"})}},children:[e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"form-label",children:"Nombre"}),e.jsx("input",{className:"form-control",value:d.name,onChange:a=>m(o=>({...o,name:a.target.value})),required:!0})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"form-label",children:"Email"}),e.jsx("input",{type:"email",className:"form-control",value:d.email,onChange:a=>m(o=>({...o,email:a.target.value})),required:!0})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"form-label",children:"Contraseña"}),e.jsx("input",{type:"password",className:"form-control",value:d.password,onChange:a=>m(o=>({...o,password:a.target.value})),required:!0})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"form-label",children:"Rol"}),e.jsxs("select",{className:"form-select",value:d.role,onChange:a=>m(o=>({...o,role:a.target.value})),required:!0,children:[e.jsx("option",{value:"",children:"Seleccione"}),e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"soporte",children:"Soporte"}),e.jsx("option",{value:"jefa_comercial",children:"Jefa Comercial"}),e.jsx("option",{value:"vendedor_comercial",children:"Vendedor"}),e.jsx("option",{value:"laboratorio",children:"Laboratorio"}),e.jsx("option",{value:"gerencia",children:"Gerencia"})]})]})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>b(!1),children:"Cancelar"}),e.jsx("button",{type:"submit",className:"btn btn-primary",children:"Crear"})]})]})]})})})]})}export{G as default};
//# sourceMappingURL=Usuarios-DIZ35CbB.js.map
