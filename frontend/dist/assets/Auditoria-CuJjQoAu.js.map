{"version":3,"file":"Auditoria-CuJjQoAu.js","sources":["../../src/services/audit.js","../../src/pages/Auditoria.jsx"],"sourcesContent":["import { apiFetch } from './api';\r\n\r\nexport const listAudit = (params = {}) => {\r\n  const sp = new URLSearchParams();\r\n  if (params.page) sp.set('page', params.page);\r\n  if (params.limit) sp.set('limit', params.limit);\r\n  const qs = sp.toString();\r\n  const path = qs ? `/api/audit?${qs}` : '/api/audit';\r\n  return apiFetch(path);\r\n};\r\n\r\nexport default { listAudit };\r\n","import React, { useMemo, useState } from 'react';\r\nimport ModuloBase from '../components/ModuloBase';\r\nimport DataTable from '../components/DataTable';\r\nimport Toolbar from '../components/Toolbar';\r\nimport { useQuery } from 'react-query';\r\nimport { listAudit } from '../services/audit';\r\n\r\nexport default function Auditoria() {\r\n  const [page, setPage] = useState(1);\r\n  const [limit] = useState(20);\r\n  const { data, isLoading } = useQuery(['audit', { page, limit }], async () => {\r\n    const resp = await listAudit({ page, limit });\r\n    const rows = Array.isArray(resp?.data) ? resp.data : (resp?.rows || resp || []);\r\n    const total = Number(resp?.total || rows.length || 0);\r\n    return { rows, total };\r\n  }, { keepPreviousData: true });\r\n\r\n  const columns = useMemo(() => ([\r\n    { header: 'ID', key: 'id', width: 80 },\r\n    { header: 'Acción', key: 'action' },\r\n    { header: 'Usuario', key: 'user_name', render: r => r.user_name || r.performed_by || r.user_id },\r\n    { header: 'Fecha', key: 'performed_at', render: r => (r.performed_at ? String(r.performed_at).slice(0,19).replace('T',' ') : (r.created_at ? String(r.created_at).slice(0,19).replace('T',' ') : '—')), width: 160 },\r\n    { header: 'Notas', key: 'notes' },\r\n  ]), []);\r\n\r\n  const total = data?.total || 0;\r\n  const rows = data?.rows || [];\r\n  const totalPages = Math.max(1, Math.ceil(total / limit));\r\n\r\n  return (\r\n    <ModuloBase titulo=\"Auditoría\" descripcion=\"Registro de acciones relevantes del sistema.\">\r\n      <Toolbar\r\n        compact\r\n        left={<div className=\"text-muted\">Total: {total}</div>}\r\n        right={\r\n          <div className=\"btn-group\">\r\n            <button className=\"btn btn-outline-secondary\" disabled={page<=1 || isLoading} onClick={()=>setPage(p=>Math.max(1,p-1))}>Anterior</button>\r\n            <span className=\"btn btn-outline-secondary disabled\">{page}/{totalPages}</span>\r\n            <button className=\"btn btn-outline-secondary\" disabled={page>=totalPages || isLoading} onClick={()=>setPage(p=>Math.min(totalPages,p+1))}>Siguiente</button>\r\n          </div>\r\n        }\r\n      />\r\n      <DataTable columns={columns} rows={rows} loading={isLoading} />\r\n    </ModuloBase>\r\n  );\r\n}\r\n"],"names":["listAudit","params","sp","qs","path","apiFetch","Auditoria","page","setPage","useState","limit","data","isLoading","useQuery","resp","rows","total","columns","useMemo","r","totalPages","jsxs","ModuloBase","jsx","Toolbar","p","DataTable"],"mappings":"gMAEO,MAAMA,EAAY,CAACC,EAAS,KAAO,CACxC,MAAMC,EAAK,IAAI,gBACXD,EAAO,MAAMC,EAAG,IAAI,OAAQD,EAAO,IAAI,EACvCA,EAAO,OAAOC,EAAG,IAAI,QAASD,EAAO,KAAK,EAC9C,MAAME,EAAKD,EAAG,WACRE,EAAOD,EAAK,cAAcA,CAAE,GAAK,aACvC,OAAOE,EAASD,CAAI,CACtB,ECFA,SAAwBE,GAAY,CAClC,KAAM,CAACC,EAAMC,CAAO,EAAIC,EAAAA,SAAS,CAAC,EAC5B,CAACC,CAAK,EAAID,EAAAA,SAAS,EAAE,EACrB,CAAE,KAAAE,EAAM,UAAAC,CAAA,EAAcC,EAAS,CAAC,QAAS,CAAE,KAAAN,EAAM,MAAAG,CAAA,CAAO,EAAG,SAAY,CAC3E,MAAMI,EAAO,MAAMd,EAAU,CAAE,KAAAO,EAAM,MAAAG,EAAO,EACtCK,EAAO,MAAM,QAAQD,GAAA,YAAAA,EAAM,IAAI,EAAIA,EAAK,MAAQA,GAAA,YAAAA,EAAM,OAAQA,GAAQ,CAAA,EACtEE,EAAQ,QAAOF,GAAA,YAAAA,EAAM,QAASC,EAAK,QAAU,CAAC,EACpD,MAAO,CAAE,KAAAA,EAAM,MAAAC,CAAAA,CACjB,EAAG,CAAE,iBAAkB,GAAM,EAEvBC,EAAUC,EAAAA,QAAQ,IAAO,CAC7B,CAAE,OAAQ,KAAM,IAAK,KAAM,MAAO,EAAA,EAClC,CAAE,OAAQ,SAAU,IAAK,QAAA,EACzB,CAAE,OAAQ,UAAW,IAAK,YAAa,OAAQC,GAAKA,EAAE,WAAaA,EAAE,cAAgBA,EAAE,OAAA,EACvF,CAAE,OAAQ,QAAS,IAAK,eAAgB,OAAQA,GAAMA,EAAE,aAAe,OAAOA,EAAE,YAAY,EAAE,MAAM,EAAE,EAAE,EAAE,QAAQ,IAAI,GAAG,EAAKA,EAAE,WAAa,OAAOA,EAAE,UAAU,EAAE,MAAM,EAAE,EAAE,EAAE,QAAQ,IAAI,GAAG,EAAI,IAAO,MAAO,GAAA,EAC/M,CAAE,OAAQ,QAAS,IAAK,OAAA,CAAQ,EAC9B,EAAE,EAEAH,GAAQL,GAAA,YAAAA,EAAM,QAAS,EACvBI,GAAOJ,GAAA,YAAAA,EAAM,OAAQ,CAAA,EACrBS,EAAa,KAAK,IAAI,EAAG,KAAK,KAAKJ,EAAQN,CAAK,CAAC,EAEvD,OACEW,EAAAA,KAACC,EAAA,CAAW,OAAO,YAAY,YAAY,+CACzC,SAAA,CAAAC,EAAAA,IAACC,EAAA,CACC,QAAO,GACP,KAAMH,EAAAA,KAAC,MAAA,CAAI,UAAU,aAAa,SAAA,CAAA,UAAQL,CAAA,EAAM,EAChD,MACEK,EAAAA,KAAC,MAAA,CAAI,UAAU,YACb,SAAA,CAAAE,MAAC,UAAO,UAAU,4BAA4B,SAAUhB,GAAM,GAAKK,EAAW,QAAS,IAAIJ,EAAQiB,GAAG,KAAK,IAAI,EAAEA,EAAE,CAAC,CAAC,EAAG,SAAA,WAAQ,EAChIJ,EAAAA,KAAC,OAAA,CAAK,UAAU,qCAAsC,SAAA,CAAAd,EAAK,IAAEa,CAAA,EAAW,QACvE,SAAA,CAAO,UAAU,4BAA4B,SAAUb,GAAMa,GAAcR,EAAW,QAAS,IAAIJ,EAAQiB,GAAG,KAAK,IAAIL,EAAWK,EAAE,CAAC,CAAC,EAAG,SAAA,WAAA,CAAS,CAAA,CAAA,CACrJ,CAAA,CAAA,EAGJF,EAAAA,IAACG,EAAA,CAAU,QAAAT,EAAkB,KAAAF,EAAY,QAASH,CAAA,CAAW,CAAA,EAC/D,CAEJ"}