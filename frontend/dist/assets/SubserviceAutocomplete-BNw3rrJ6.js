import{r as n,e as k,j as e,K as D,Y as M,v as h,F as b,N as U,L as B}from"./index-xQVByYRi.js";import{s as G}from"./subservices-BpjbwGE9.js";import{F as O}from"./Form-BAZkilfb.js";import{S as z}from"./Spinner-C2jXaFYJ.js";const Q=({value:S="",onChange:c,onSelect:a,placeholder:w="Buscar por código, descripción o norma...",disabled:y=!1,size:T="lg"})=>{var A,g;const[i,m]=n.useState(S),[I,l]=n.useState(!1),[t,u]=n.useState(null),d=n.useRef(null),x=n.useRef(null),[p,R]=n.useState(i);n.useEffect(()=>{const s=setTimeout(()=>{R(i)},300);return()=>clearTimeout(s)},[i]);const{data:o,isLoading:N,error:E}=k(["subservices-search",p],()=>G(p),{enabled:p.length>=2,staleTime:5*60*1e3,cacheTime:10*60*1e3}),L=s=>{const r=s.target.value;m(r),l(r.length>=2),c==null||c(r),r.length<2&&(u(null),a==null||a(null))},C=s=>{var r;m(s.display_text),u(s),l(!1),a==null||a(s),(r=d.current)==null||r.blur()},Y=()=>{var s;m(""),u(null),l(!1),c==null||c(""),a==null||a(null),(s=d.current)==null||s.focus()},F=s=>{var r;s.key==="Escape"&&(l(!1),(r=d.current)==null||r.blur())};n.useEffect(()=>{const s=r=>{x.current&&!x.current.contains(r.target)&&l(!1)};return document.addEventListener("mousedown",s),()=>document.removeEventListener("mousedown",s)},[]);const v=s=>s===0?"Sujeto a evaluación":`S/ ${s.toFixed(2)}`,j=s=>({"ENSAYO ESTÁNDAR":"primary","ENSAYOS ESPECIALES":"success","ENSAYOS DE CAMPO":"info","ENSAYO AGREGADO":"warning","ENSAYO QUÍMICO SUELO Y AGUA SUBTERRÁNEO":"secondary","ENSAYO QUÍMICO AGREGADO":"dark","ENSAYO CONCRETO":"primary","ENSAYO ALBAÑILERÍA":"success","ENSAYO ROCA":"info","ENSAYO PAVIMENTO":"warning","ENSAYO ASFALTO":"secondary","ENSAYO MEZCLA ASFÁLTICO":"dark","EVALUACIONES ESTRUCTURALES":"primary","IMPLEMENTACIÓN LABORATORIO EN OBRA":"success","OTROS SERVICIOS":"info"})[s]||"light";return e.jsx("div",{className:"position-relative",ref:x,children:e.jsxs(O.Group,{children:[e.jsxs("div",{className:"position-relative",children:[e.jsx(O.Control,{ref:d,type:"text",value:i,onChange:L,onKeyDown:F,onFocus:()=>i.length>=2&&l(!0),placeholder:w,disabled:y,size:T,className:"pe-5"}),e.jsxs("div",{className:"position-absolute top-50 end-0 translate-middle-y pe-3 d-flex align-items-center gap-2",children:[N&&e.jsx(z,{animation:"border",size:"sm",variant:"primary"}),!N&&i&&e.jsx(D,{className:"text-muted cursor-pointer",onClick:Y,style:{cursor:"pointer"}}),!N&&!i&&e.jsx(M,{className:"text-muted"})]})]}),I&&e.jsxs("div",{className:"position-absolute w-100 bg-white border rounded shadow-lg",style:{top:"100%",zIndex:1050,maxHeight:"300px",overflowY:"auto"},children:[E&&e.jsx("div",{className:"p-3 text-danger",children:e.jsx("small",{children:"Error al buscar subservicios"})}),!E&&((A=o==null?void 0:o.data)==null?void 0:A.length)===0&&e.jsx("div",{className:"p-3 text-muted",children:e.jsx("small",{children:"No se encontraron subservicios"})}),(g=o==null?void 0:o.data)==null?void 0:g.map((s,r)=>e.jsx("div",{className:"p-3 border-bottom cursor-pointer hover-bg-light",onClick:()=>C(s),style:{cursor:"pointer"},onMouseEnter:f=>f.target.style.backgroundColor="#f8f9fa",onMouseLeave:f=>f.target.style.backgroundColor="transparent",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-start mb-2",children:[e.jsxs("div",{className:"flex-grow-1",children:[e.jsxs("div",{className:"d-flex align-items-center gap-2 mb-1",children:[e.jsx(h,{bg:j(s.service_name),className:"small",children:s.codigo}),e.jsx(h,{bg:"outline-secondary",className:"small",children:s.service_name})]}),e.jsx("div",{className:"fw-bold text-dark mb-1",children:s.descripcion}),s.norma&&s.norma!=="-"&&e.jsxs("div",{className:"text-muted small d-flex align-items-center gap-1",children:[e.jsx(b,{size:12}),s.norma]})]}),e.jsx("div",{className:"text-end",children:e.jsxs("div",{className:"fw-bold text-success d-flex align-items-center gap-1",children:[e.jsx(U,{size:14}),v(s.precio)]})})]})},s.id))]}),t&&e.jsx("div",{className:"mt-2 p-2 bg-light rounded border",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{children:[e.jsx(h,{bg:j(t.service_name),className:"me-2",children:t.codigo}),e.jsx("span",{className:"fw-bold",children:t.descripcion}),t.norma&&t.norma!=="-"&&e.jsxs("div",{className:"text-muted small",children:[e.jsx(b,{size:12,className:"me-1"}),t.norma]})]}),e.jsxs("div",{className:"text-end",children:[e.jsx("div",{className:"fw-bold text-success",children:v(t.precio)}),e.jsx(B,{className:"text-success"})]})]})})]})})};export{Q as S};
//# sourceMappingURL=SubserviceAutocomplete-BNw3rrJ6.js.map
