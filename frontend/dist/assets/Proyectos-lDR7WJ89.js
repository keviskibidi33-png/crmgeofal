import{r as i,u as Je,P as Ye,E as Ze,c as me,G as b,j as e,H as ea,h as y,n as m,m as P,B as h,I as aa,d as ue,Q as sa,K as ra,k as he,O as xe,l as pe,f as oa,R as ge,v as ia,S as U,t as be,p as ta,M as ca}from"./index-DEOVmouH.js";import{P as la}from"./PageHeader-CQkDYjTq.js";import{D as na}from"./DataTable-DczKv8iu.js";import{M as je}from"./ModalForm-Bq7S27Np.js";import{S as A}from"./StatsCard-nXHftVJq.js";import{d as da,c as ma,u as ua,a as ha,b as xa,e as pa,f as ga,l as ba,g as ja}from"./projects-CIJM5hiT.js";import{l as va,a as ya}from"./categories-CZDmVj7B.js";import{l as B,u as Na,d as fa,a as _a}from"./attachments-CK8Tvz6R.js";import{R as Ca,C as w}from"./Row-BbuP-81J.js";import{C as V}from"./Card-Dh58Aev9.js";import{T as Sa,a as j}from"./Tabs-Bp3bcevM.js";import"./InputGroup-BKumZwLE.js";import"./Form-B65jexOv.js";import"./ElementChildren-gaW6uce3.js";import"./Table-CnkmMpGQ.js";import"./Spinner-C3m4zju4.js";const K={company_id:"",name:"",location:"",vendedor_id:"",laboratorio_id:"",requiere_laboratorio:!1,requiere_ingenieria:!1,requiere_consultoria:!1,requiere_capacitacion:!1,requiere_auditoria:!1,contact_name:"",contact_phone:"",contact_email:"",queries:"",priority:"normal",marked:!1,category_id:"",subcategory_id:"",category_name:"",subcategory_name:""};function Wa(){var ce,le,ne,de;const[ve,C]=i.useState(!1),[x,S]=i.useState(null),[Ea,ye]=i.useState(null),[qa,ka]=i.useState(!1),[Pa,Aa]=i.useState(!1),[wa,Ma]=i.useState(!1),[O,M]=i.useState(!1),[o,v]=i.useState(null),[Ne,H]=i.useState("view"),[r,l]=i.useState({}),[fe,F]=i.useState(!1),[_e,Ce]=i.useState(""),[X,Se]=i.useState("success"),[Ee,qe]=i.useState([]),[ke,W]=i.useState([]),[E,Pe]=i.useState(""),[D,I]=i.useState([]),[J,T]=i.useState(!1),[g,Y]=i.useState(null),[L,z]=i.useState(1),[Z,Ae]=i.useState(""),[ee,we]=i.useState(""),[ae,Me]=i.useState(""),[se,Fe]=i.useState(""),[De,re]=i.useState(!1);Je();const u=(ce=Ye().state)==null?void 0:ce.selectedClient,q=Ze(),{data:n,isLoading:oe,refetch:Ie}=me(["projects",L,Z,ee,ae,se],()=>ba({page:L,limit:20,search:Z,status:ee,company_id:ae,project_type:se}),{keepPreviousData:!0,refetchOnWindowFocus:!1,refetchOnMount:!1,staleTime:3e4,cacheTime:3e5,retry:2,retryDelay:1e3}),{data:p,isLoading:k}=me(["projectStats"],ja,{refetchOnWindowFocus:!1,refetchOnMount:!1,staleTime:6e4,cacheTime:3e5,retry:1});i.useEffect(()=>{(async()=>{try{const s=await va();qe(s)}catch(s){console.error("Error al cargar categorías:",s)}})()},[]),i.useEffect(()=>{(async()=>{if(E)try{const s=await ya(E);W(s)}catch(s){console.error("Error al cargar subcategorías:",s)}else W([])})()},[E]),i.useEffect(()=>{(async()=>{if(o!=null&&o.id)try{const s=await B(o.id);I(s)}catch(s){console.error("Error al cargar adjuntos:",s)}})()},[o==null?void 0:o.id,O]);const N=a=>{q.invalidateQueries("projects"),q.invalidateQueries("projectStats"),C(!1),S(null),ye(null)},t=(a,s="success")=>{Ce(a),Se(s),F(!0),setTimeout(()=>{F(!1)},5e3)},Te=a=>{console.log("🔍 handleSearch - Búsqueda:",a),Ae(a),z(1),re(!0),setTimeout(()=>re(!1),1e3)},Le=a=>{console.log("🔍 handleFilter - Filtros:",a),we(a.status||""),Me(a.company_id||""),Fe(a.project_type||""),z(1)},ze=a=>{const s=a.target.files[0];s&&Y(s)},Ge=async()=>{if(!g||!(o!=null&&o.id)){t("❌ Por favor selecciona un archivo","danger");return}T(!0);try{const a=new FormData;a.append("file",g),a.append("description",`Archivo subido: ${g.name}`),await Na(o.id,a);const s=await B(o.id);I(s),Y(null),T(!1),t("✅ Archivo subido correctamente","success")}catch(a){console.error("Error al subir archivo:",a),T(!1),t("❌ Error al subir archivo","danger")}},Re=async a=>{try{await fa(a),t("✅ Archivo descargado correctamente","success")}catch(s){console.error("Error al descargar archivo:",s),t("❌ Error al descargar archivo","danger")}},$e=async a=>{if(window.confirm("¿Estás seguro de que quieres eliminar este archivo?"))try{await _a(a);const s=await B(o.id);I(s),t("✅ Archivo eliminado correctamente","success")}catch(s){console.error("Error al eliminar archivo:",s),t("❌ Error al eliminar archivo","danger")}},Qe=[{title:"Por Estado",options:[{label:"Pendientes",filter:{status:"pendiente"}},{label:"Activos",filter:{status:"activo"}},{label:"Completados",filter:{status:"completado"}},{label:"Cancelados",filter:{status:"cancelado"}}]},{title:"Por Tipo de Proyecto",options:[{label:"Análisis de Suelos",filter:{project_type:"Análisis de Suelos"}},{label:"Estudio Geotécnico",filter:{project_type:"Estudio Geotécnico"}},{label:"Evaluación Ambiental",filter:{project_type:"Evaluación Ambiental"}},{label:"Control de Calidad",filter:{project_type:"Control de Calidad"}},{label:"Análisis de Agua",filter:{project_type:"Análisis de Agua"}},{label:"Estudio de Impacto",filter:{project_type:"Estudio de Impacto"}},{label:"Análisis Químico",filter:{project_type:"Análisis Químico"}},{label:"Pruebas de Laboratorio",filter:{project_type:"Pruebas de Laboratorio"}},{label:"Inspección Técnica",filter:{project_type:"Inspección Técnica"}},{label:"Certificación de Materiales",filter:{project_type:"Certificación de Materiales"}}]}],ie=b(ma,{onSuccess:()=>N(),onError:a=>console.error("Error creating project:",a)}),f=b(({id:a,data:s})=>ua(a,s),{onSuccess:a=>{console.log("✅ updateMutation - Success:",a),v(a),l(a),t("✅ Proyecto actualizado exitosamente!","success"),q.invalidateQueries("projects")},onError:a=>{console.error("❌ updateMutation - Error:",a),t("❌ Error al actualizar proyecto","danger")}}),Ue=b(da,{onSuccess:()=>N(),onError:a=>console.error("Error deleting project:",a)}),G=b(({id:a,...s})=>ha(a,s),{onSuccess:a=>{v(a),l(a),N()},onError:a=>console.error("Error updating project status:",a)}),R=b(({id:a,...s})=>xa(a,s),{onSuccess:a=>{console.log("✅ updateCategoriesMutation - Success:",a),v(a),l(a),t("✅ Categorías guardadas correctamente!","success"),q.invalidateQueries("projects")},onError:a=>{console.error("❌ updateCategoriesMutation - Error:",a),t("❌ Error al guardar categorías","danger")}}),$=b(({id:a,...s})=>pa(a,s),{onSuccess:a=>{v(a),l(a),N()},onError:a=>console.error("Error updating project queries:",a)}),Q=b(({id:a,...s})=>ga(a,s),{onSuccess:a=>{v(a),l(a),N()},onError:a=>console.error("Error updating project mark:",a)}),Be=()=>{const a=u?{...K,company_id:u.id,name:`${u.sector||"Proyecto"} - ${u.name}`,location:u.city||"",contact_name:u.contact_name||"",contact_phone:u.phone||"",contact_email:u.email||""}:K;S(a),C(!0)},Ve=a=>{S(a),C(!0)},te=a=>{window.confirm(`¿Estás seguro de que quieres eliminar el proyecto "${a.name}"?`)&&Ue.mutate(a.id)},Ke=a=>{console.log("🔍 handleViewProject - Project recibido:",a),console.log("🔍 handleViewProject - Project.id:",a==null?void 0:a.id),console.log("🔍 handleViewProject - Type of project.id:",typeof(a==null?void 0:a.id)),v(a);const s={...a,requiere_laboratorio:a.requiere_laboratorio||!1,requiere_ingenieria:a.requiere_ingenieria||!1,requiere_consultoria:a.requiere_consultoria||!1,requiere_capacitacion:a.requiere_capacitacion||!1,requiere_auditoria:a.requiere_auditoria||!1,marked:a.marked||!1,priority:a.priority||"normal",queries:a.queries||"",contact_name:a.contact_name||"",contact_phone:a.contact_phone||"",contact_email:a.contact_email||"",category_id:a.category_id||"",subcategory_id:a.subcategory_id||"",category_name:a.category_name||"",subcategory_name:a.subcategory_name||""};console.log("🔍 handleViewProject - editingData inicializado:",s),l(s),H("view"),M(!0)},Oe=async a=>{x.id?await f.mutateAsync({id:x.id,...a}):await ie.mutateAsync(a)},He=a=>{const c={activo:{bg:"success",text:"Activo"},pendiente:{bg:"warning",text:"Pendiente"},completado:{bg:"primary",text:"Completado"},cancelado:{bg:"danger",text:"Cancelado"}}[a]||{bg:"secondary",text:a};return e.jsx(m,{bg:c.bg,className:"status-badge",children:c.text})},Xe=[{header:"ID",accessor:"id",width:"80px"},{header:"Proyecto",accessor:"name",render:(a,s)=>e.jsxs("div",{children:[e.jsx("div",{className:"fw-medium",children:s.name}),s.location&&e.jsxs("small",{className:"text-muted",children:[e.jsx(ca,{size:12,className:"me-1"}),s.location]})]})},{header:"Tipo de Proyecto",accessor:"project_type",render:(a,s)=>{const c=s.project_type||"General";let d="secondary";switch(c){case"Análisis de Suelos":d="success";break;case"Estudio Geotécnico":d="primary";break;case"Evaluación Ambiental":d="info";break;case"Control de Calidad":d="warning";break;case"Análisis de Agua":d="info";break;case"Estudio de Impacto":d="danger";break;case"Análisis Químico":d="primary";break;case"Pruebas de Laboratorio":d="success";break;case"Inspección Técnica":d="warning";break;case"Certificación de Materiales":d="info";break;default:d="secondary"}return e.jsx(m,{bg:d,className:"px-2 py-1",children:c})}},{header:"Categoría",accessor:"category_name",render:(a,s)=>e.jsxs("div",{children:[s.category_name&&e.jsx(m,{bg:"primary",className:"px-2 py-1 mb-1 d-block",children:s.category_name}),s.subcategory_name&&e.jsx(m,{bg:"secondary",className:"px-2 py-1 d-block",children:s.subcategory_name}),!s.category_name&&e.jsx("span",{className:"text-muted",children:"Sin categoría"})]})},{header:"Empresa",accessor:"company_name",render:(a,s)=>e.jsxs("div",{children:[e.jsx("div",{className:"fw-medium",children:s.company_name||"Sin empresa"}),s.company_ruc&&e.jsxs("small",{className:"text-muted",children:["RUC: ",s.company_ruc]})]})},{header:"Estado",accessor:"status",render:a=>He(a||"activo")},{header:"Servicios Requeridos",accessor:"services",render:(a,s)=>e.jsxs("div",{className:"d-flex flex-wrap gap-1",children:[s.requiere_laboratorio&&e.jsxs(m,{bg:"info",className:"px-2 py-1",children:[e.jsx(y,{size:12,className:"me-1"}),"Laboratorio"]}),s.requiere_ingenieria&&e.jsxs(m,{bg:"primary",className:"px-2 py-1",children:[e.jsx(P,{size:12,className:"me-1"}),"Ingeniería"]}),!s.requiere_laboratorio&&!s.requiere_ingenieria&&e.jsx(m,{bg:"secondary",className:"px-2 py-1",children:"Sin servicios"})]})},{header:"Contacto",accessor:"contacto",render:(a,s)=>e.jsxs("div",{className:"small",children:[s.contact_name&&e.jsx("div",{children:e.jsx("strong",{children:s.contact_name})}),s.contact_phone&&e.jsx("div",{className:"text-muted",children:s.contact_phone}),s.contact_email&&e.jsx("div",{className:"text-muted",children:s.contact_email}),!s.contact_name&&!s.contact_phone&&!s.contact_email&&e.jsx("span",{className:"text-muted",children:"Sin contacto"})]})},{header:"Asignado a",accessor:"vendedor_name",render:(a,s)=>e.jsxs("div",{children:[s.vendedor_name&&e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx(P,{size:14,className:"me-1 text-muted"}),e.jsx("span",{children:s.vendedor_name})]}),s.laboratorio_name&&e.jsxs("div",{className:"d-flex align-items-center mt-1",children:[e.jsx(y,{size:14,className:"me-1 text-muted"}),e.jsx("span",{className:"small text-muted",children:s.laboratorio_name})]})]})},{header:"Fecha Creación",accessor:"created_at",type:"date"}],We=[{name:"company_id",label:"Empresa/Cliente",type:"select",required:!0,options:((le=n==null?void 0:n.companies)==null?void 0:le.map(a=>({value:a.id,label:`${a.name} (${a.ruc||a.dni||"Sin RUC/DNI"})`})))||[],description:"Selecciona un cliente existente o crea uno nuevo desde el módulo de clientes"},{name:"name",label:"Nombre del Proyecto",type:"text",required:!0,placeholder:"Ingresa el nombre del proyecto"},{name:"location",label:"Ubicación del Proyecto",type:"text",placeholder:"Ingresa la ubicación del proyecto",required:!0},{name:"category_id",label:"Categoría del Proyecto",type:"select",options:Ee.map(a=>({value:a.id,label:a.name})),description:"Selecciona la categoría principal del proyecto",onChange:a=>{Pe(a),S(s=>({...s,subcategory_id:"",subcategory_name:""}))}},{name:"subcategory_id",label:"Subcategoría del Proyecto",type:"select",options:ke.map(a=>({value:a.id,label:a.name})),description:"Selecciona la subcategoría específica del proyecto",disabled:!E},{name:"contact_name",label:"Persona de Contacto",type:"text",placeholder:"Nombre de la persona con quien negociar",description:"Persona responsable del proyecto en el cliente"},{name:"contact_phone",label:"Teléfono de Contacto",type:"text",placeholder:"Teléfono para comunicación directa",description:"Número para llamadas urgentes o seguimiento"},{name:"contact_email",label:"Email de Contacto",type:"email",placeholder:"Email para comunicación",description:"Email para envío de reportes y documentos"},{name:"requiere_laboratorio",label:"Requiere Laboratorio",type:"checkbox",description:"Marcar si el proyecto necesita servicios de laboratorio"},{name:"requiere_ingenieria",label:"Requiere Ingeniería",type:"checkbox",description:"Marcar si el proyecto necesita servicios de ingeniería"},{name:"requiere_consultoria",label:"Requiere Consultoría",type:"checkbox",description:"Marcar si el proyecto necesita servicios de consultoría"},{name:"requiere_capacitacion",label:"Requiere Capacitación",type:"checkbox",description:"Marcar si el proyecto necesita servicios de capacitación"},{name:"requiere_auditoria",label:"Requiere Auditoría",type:"checkbox",description:"Marcar si el proyecto necesita servicios de auditoría"},{name:"queries",label:"Consultas del Cliente",type:"textarea",placeholder:"Ingresa las consultas o dudas del cliente...",description:"Preguntas o dudas específicas del cliente sobre el proyecto"},{name:"priority",label:"Prioridad del Proyecto",type:"select",options:[{value:"low",label:"Baja"},{value:"normal",label:"Normal"},{value:"high",label:"Alta"},{value:"urgent",label:"Urgente"}],description:"Nivel de prioridad para la ejecución del proyecto"},{name:"vendedor_id",label:"Vendedor Asignado",type:"select",options:((ne=n==null?void 0:n.users)==null?void 0:ne.filter(a=>["vendedor_comercial","jefa_comercial"].includes(a.role)).map(a=>({value:a.id,label:`${a.name} ${a.apellido}`})))||[]},{name:"laboratorio_id",label:"Responsable de Laboratorio",type:"select",options:((de=n==null?void 0:n.users)==null?void 0:de.filter(a=>["jefe_laboratorio","usuario_laboratorio","laboratorio"].includes(a.role)).map(a=>({value:a.id,label:`${a.name} ${a.apellido}`})))||[]},{name:"requiere_laboratorio",label:"Requiere Servicios de Laboratorio",type:"checkbox",description:"Marcar si el proyecto necesita análisis o pruebas de laboratorio"},{name:"requiere_ingenieria",label:"Requiere Servicios de Ingeniería",type:"checkbox",description:"Marcar si el proyecto necesita estudios o consultoría de ingeniería"}],_=i.useMemo(()=>{if(p)return console.log("📊 Stats - Usando estadísticas reales del backend:",p),{total:p.total||0,activos:p.activos||0,completados:p.completados||0,pendientes:p.pendientes||0,cancelados:p.cancelados||0};const a=(n==null?void 0:n.data)||[];return console.log("📊 Stats - Fallback: calculando desde página actual:",a),{total:a.length,activos:a.filter(s=>s.status==="activo").length,completados:a.filter(s=>s.status==="completado").length,pendientes:a.filter(s=>s.status==="pendiente").length,cancelados:a.filter(s=>s.status==="cancelado").length}},[p,n]);return e.jsxs(e.Fragment,{children:[e.jsx(ea,{fluid:!0,className:"py-4",children:e.jsxs("div",{className:"fade-in",children:[e.jsx(la,{title:"Gestión de Proyectos",subtitle:u?`Crear proyecto para: ${u.name}`:"Crear, editar y gestionar proyectos del sistema",icon:y,actions:e.jsxs("div",{className:"d-flex gap-2",children:[u&&e.jsxs(m,{bg:"info",className:"px-3 py-2 d-flex align-items-center",children:[e.jsx(P,{className:"me-1"}),"Cliente: ",u.name]}),e.jsxs(h,{variant:"primary",onClick:Be,children:[e.jsx(aa,{className:"me-2"}),u?"Crear Proyecto":"Nuevo Proyecto"]})]})}),e.jsxs(Ca,{className:"g-4 mb-4",children:[e.jsx(w,{md:6,lg:3,children:e.jsx(A,{title:"Total Proyectos",value:_.total,icon:y,color:"primary",subtitle:"Proyectos registrados",loading:k})}),e.jsx(w,{md:6,lg:3,children:e.jsx(A,{title:"Proyectos Activos",value:_.activos,icon:ue,color:"success",subtitle:"En desarrollo",loading:k})}),e.jsx(w,{md:6,lg:3,children:e.jsx(A,{title:"Completados",value:_.completados,icon:ue,color:"info",subtitle:"Finalizados",loading:k})}),e.jsx(w,{md:6,lg:3,children:e.jsx(A,{title:"Pendientes",value:_.pendientes,icon:sa,color:"warning",subtitle:"Por iniciar",loading:k})})]}),e.jsxs(V,{className:"shadow-sm border-0",children:[e.jsx(V.Header,{className:"bg-white border-bottom",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("h5",{className:"mb-0",children:[e.jsx(y,{className:"me-2 text-primary"}),"Lista de Proyectos"]}),e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx(h,{variant:"outline-secondary",size:"sm",onClick:()=>Ie(),className:"d-flex align-items-center",title:"Actualizar datos",children:e.jsx(ra,{className:`${oe?"spinning":""}`})}),e.jsxs(m,{bg:"light",text:"dark",className:"px-3 py-2",children:[_.total," proyectos"]})]})]})}),e.jsx(V.Body,{className:"p-0",children:e.jsx(na,{data:(n==null?void 0:n.data)||[],columns:Xe,loading:oe||De,onEdit:Ve,onDelete:te,actions:[{label:"Gestionar",icon:he,onClick:Ke,variant:"outline-primary"},{label:"Eliminar",icon:xe,onClick:te,variant:"outline-danger"}],emptyMessage:"No hay proyectos registrados",totalItems:(n==null?void 0:n.total)||0,itemsPerPage:20,currentPage:L,onPageChange:z,onSearch:Te,onFilter:Le,filterOptions:Qe})})]}),e.jsx(je,{show:ve,onHide:()=>C(!1),title:x!=null&&x.id?"Editar Proyecto":"Nuevo Proyecto",data:x||K,fields:We,onSubmit:Oe,loading:ie.isLoading||f.isLoading,submitText:x!=null&&x.id?"Actualizar":"Crear"}),e.jsx(je,{show:O,onHide:()=>M(!1),title:`Gestionar Proyecto - ${(o==null?void 0:o.name)||""}`,data:r,fields:[{name:"project_management",label:"Gestión del Proyecto",type:"custom",render:a=>e.jsxs(Sa,{activeKey:Ne,onSelect:s=>H(s),className:"mb-3",children:[e.jsx(j,{eventKey:"view",title:e.jsxs("span",{children:[e.jsx(he,{className:"me-1"}),"Ver"]}),children:e.jsxs("div",{className:"row g-3",children:[e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"border rounded p-3 h-100",children:[e.jsxs("h6",{className:"text-primary mb-3",children:[e.jsx(y,{className:"me-2"}),"Datos Generales"]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"ID:"})," ",a.id]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Nombre:"})," ",a.name]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Ubicación:"})," ",a.location]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Tipo:"}),e.jsx(m,{bg:"info",className:"ms-2",children:a.project_type})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Estado:"}),e.jsx(m,{bg:"primary",className:"ms-2",children:a.status})]})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"border rounded p-3 h-100",children:[e.jsxs("h6",{className:"text-success mb-3",children:[e.jsx(P,{className:"me-2"}),"Información de Contacto"]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Empresa:"})," ",a.company_name]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"RUC:"})," ",a.company_ruc]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Contacto:"})," ",a.contact_name||"Sin contacto"]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Teléfono:"})," ",a.contact_phone||"Sin teléfono"]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Email:"})," ",a.contact_email||"Sin email"]})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"border rounded p-3 h-100",children:[e.jsxs("h6",{className:"text-warning mb-3",children:[e.jsx(pe,{className:"me-2"}),"Servicios Requeridos"]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Laboratorio:"}),a.requiere_laboratorio?e.jsx(m,{bg:"info",className:"ms-2",children:"Requerido"}):e.jsx(m,{bg:"secondary",className:"ms-2",children:"No requerido"})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Ingeniería:"}),a.requiere_ingenieria?e.jsx(m,{bg:"success",className:"ms-2",children:"Requerido"}):e.jsx(m,{bg:"secondary",className:"ms-2",children:"No requerido"})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Estado Lab:"}),e.jsx(m,{bg:"info",className:"ms-2",children:a.laboratorio_status})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Estado Ing:"}),e.jsx(m,{bg:"success",className:"ms-2",children:a.ingenieria_status})]})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"border rounded p-3 h-100",children:[e.jsxs("h6",{className:"text-info mb-3",children:[e.jsx(oa,{className:"me-2"}),"Asignaciones"]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Vendedor:"})," ",a.vendedor_name||"Sin asignar"]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Laboratorio:"})," ",a.laboratorio_name||"Sin asignar"]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Fecha Creación:"})," ",new Date(a.created_at).toLocaleDateString()]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Última Actualización:"})," ",new Date(a.updated_at).toLocaleDateString()]})]})}),a.status_notes&&e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"border rounded p-3",children:[e.jsxs("h6",{className:"text-muted mb-3",children:[e.jsx(ge,{className:"me-2"}),"Notas del Estado"]}),e.jsx("p",{className:"mb-0",children:a.status_notes})]})})]})}),e.jsx(j,{eventKey:"edit",title:e.jsxs("span",{children:[e.jsx(ia,{className:"me-1"}),"Editar"]}),children:e.jsxs("div",{className:"row g-3",children:[e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Nombre del Proyecto"}),e.jsx("input",{type:"text",className:"form-control",value:r.name||"",onChange:s=>l({...r,name:s.target.value})})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Ubicación"}),e.jsx("input",{type:"text",className:"form-control",value:r.location||"",onChange:s=>l({...r,location:s.target.value})})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Persona de Contacto"}),e.jsx("input",{type:"text",className:"form-control",value:r.contact_name||"",onChange:s=>l({...r,contact_name:s.target.value})})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Teléfono de Contacto"}),e.jsx("input",{type:"text",className:"form-control",value:r.contact_phone||"",onChange:s=>l({...r,contact_phone:s.target.value})})]})}),e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Email de Contacto"}),e.jsx("input",{type:"email",className:"form-control",value:r.contact_email||"",onChange:s=>l({...r,contact_email:s.target.value})})]})}),e.jsx("div",{className:"col-12",children:e.jsx(h,{variant:"primary",onClick:()=>{const s=o==null?void 0:o.id;if(!s){console.error("No se encontró el ID del proyecto"),t("❌ Error: No se encontró el ID del proyecto","danger");return}const c=typeof s=="object"?s.id:s;f.mutate({id:c,data:r},{onSuccess:d=>{t("✅ Proyecto actualizado exitosamente!","success")},onError:d=>{console.error("❌ Guardar Cambios - Error:",d),t("❌ Error al actualizar proyecto","danger")}})},disabled:f.isLoading,children:f.isLoading?"Guardando...":"Guardar Cambios"})})]})}),e.jsx(j,{eventKey:"status",title:e.jsxs("span",{children:[e.jsx(pe,{className:"me-1"}),"Estado"]}),children:e.jsxs("div",{className:"row g-3",children:[e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Estado del Proyecto"}),e.jsxs("select",{className:"form-select",value:r.status||"",onChange:s=>l({...r,status:s.target.value}),children:[e.jsx("option",{value:"pendiente",children:"Pendiente"}),e.jsx("option",{value:"activo",children:"Activo"}),e.jsx("option",{value:"en_proceso",children:"En Proceso"}),e.jsx("option",{value:"completado",children:"Completado"}),e.jsx("option",{value:"pausado",children:"Pausado"}),e.jsx("option",{value:"cancelado",children:"Cancelado"})]})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Estado del Laboratorio"}),e.jsxs("select",{className:"form-select",value:r.laboratorio_status||"",onChange:s=>l({...r,laboratorio_status:s.target.value}),children:[e.jsx("option",{value:"no_requerido",children:"No Requerido"}),e.jsx("option",{value:"pendiente",children:"Pendiente"}),e.jsx("option",{value:"en_proceso",children:"En Proceso"}),e.jsx("option",{value:"completado",children:"Completado"}),e.jsx("option",{value:"pausado",children:"Pausado"}),e.jsx("option",{value:"cancelado",children:"Cancelado"})]})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Estado de Ingeniería"}),e.jsxs("select",{className:"form-select",value:r.ingenieria_status||"",onChange:s=>l({...r,ingenieria_status:s.target.value}),children:[e.jsx("option",{value:"no_requerido",children:"No Requerido"}),e.jsx("option",{value:"pendiente",children:"Pendiente"}),e.jsx("option",{value:"en_proceso",children:"En Proceso"}),e.jsx("option",{value:"completado",children:"Completado"}),e.jsx("option",{value:"pausado",children:"Pausado"}),e.jsx("option",{value:"cancelado",children:"Cancelado"})]})]})}),e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Notas del Estado"}),e.jsx("textarea",{className:"form-control",rows:"3",value:r.status_notes||"",onChange:s=>l({...r,status_notes:s.target.value}),placeholder:"Agrega comentarios sobre el cambio de estado..."})]})}),e.jsx("div",{className:"col-12",children:e.jsx(h,{variant:"success",onClick:()=>{const s=o==null?void 0:o.id;if(!s){console.error("No se encontró el ID del proyecto"),t("❌ Error: No se encontró el ID del proyecto","danger");return}G.mutate({id:s,...r},{onSuccess:c=>{console.log("✅ Actualizar Estado - Éxito:",c),t("✅ Estado actualizado correctamente!","success")},onError:c=>{console.error("❌ Actualizar Estado - Error:",c),t("❌ Error al actualizar estado","danger")}})},disabled:G.isLoading,children:G.isLoading?"Actualizando...":"Actualizar Estado"})})]})}),e.jsx(j,{eventKey:"categories",title:e.jsxs("span",{children:[e.jsx(U,{className:"me-1"}),"Categorías"]}),children:e.jsxs("div",{className:"row g-3",children:[e.jsxs("div",{className:"col-12",children:[e.jsx("h6",{className:"mb-3",children:"Categorías del Proyecto"}),e.jsxs("div",{className:"form-check",children:[e.jsx("input",{className:"form-check-input",type:"checkbox",id:"cat_laboratorio",checked:r.requiere_laboratorio||!1,onChange:s=>{console.log("🔍 requiere_laboratorio onChange:",s.target.checked),l({...r,requiere_laboratorio:s.target.checked})}}),e.jsx("label",{className:"form-check-label",htmlFor:"cat_laboratorio",children:"Laboratorio"})]}),e.jsxs("div",{className:"form-check",children:[e.jsx("input",{className:"form-check-input",type:"checkbox",id:"cat_ingenieria",checked:r.requiere_ingenieria||!1,onChange:s=>l({...r,requiere_ingenieria:s.target.checked})}),e.jsx("label",{className:"form-check-label",htmlFor:"cat_ingenieria",children:"Ingeniería"})]}),e.jsxs("div",{className:"form-check",children:[e.jsx("input",{className:"form-check-input",type:"checkbox",id:"cat_consultoria",checked:r.requiere_consultoria||!1,onChange:s=>l({...r,requiere_consultoria:s.target.checked})}),e.jsx("label",{className:"form-check-label",htmlFor:"cat_consultoria",children:"Consultoría"})]}),e.jsxs("div",{className:"form-check",children:[e.jsx("input",{className:"form-check-input",type:"checkbox",id:"cat_capacitacion",checked:r.requiere_capacitacion||!1,onChange:s=>l({...r,requiere_capacitacion:s.target.checked})}),e.jsx("label",{className:"form-check-label",htmlFor:"cat_capacitacion",children:"Capacitación"})]}),e.jsxs("div",{className:"form-check",children:[e.jsx("input",{className:"form-check-input",type:"checkbox",id:"cat_auditoria",checked:r.requiere_auditoria||!1,onChange:s=>l({...r,requiere_auditoria:s.target.checked})}),e.jsx("label",{className:"form-check-label",htmlFor:"cat_auditoria",children:"Auditoría"})]})]}),e.jsx("div",{className:"col-12",children:e.jsx(h,{variant:"info",onClick:()=>{const s=o==null?void 0:o.id;if(!s){console.error("No se encontró el ID del proyecto"),t("❌ Error: No se encontró el ID del proyecto","danger");return}R.mutate({id:s,requiere_laboratorio:r.requiere_laboratorio||!1,requiere_ingenieria:r.requiere_ingenieria||!1,requiere_consultoria:r.requiere_consultoria||!1,requiere_capacitacion:r.requiere_capacitacion||!1,requiere_auditoria:r.requiere_auditoria||!1},{onSuccess:c=>{console.log("✅ Guardar Categorías - Éxito:",c),t("✅ Categorías guardadas correctamente!","success")},onError:c=>{console.error("❌ Guardar Categorías - Error:",c),t("❌ Error al guardar categorías","danger")}})},disabled:R.isLoading,children:R.isLoading?"Guardando...":"Guardar Categorías"})})]})}),e.jsx(j,{eventKey:"queries",title:e.jsxs("span",{children:[e.jsx(ge,{className:"me-1"}),"Consultas"]}),children:e.jsxs("div",{className:"row g-3",children:[e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Consultas y Dudas del Cliente"}),e.jsx("textarea",{className:"form-control",rows:"8",value:r.queries||"",onChange:s=>l({...r,queries:s.target.value}),placeholder:"Ingresa las consultas o dudas del cliente..."})]})}),e.jsx("div",{className:"col-12",children:e.jsx(h,{variant:"warning",onClick:()=>{const s=o==null?void 0:o.id;if(!s){console.error("No se encontró el ID del proyecto"),t("❌ Error: No se encontró el ID del proyecto","danger");return}$.mutate({id:s,queries:r.queries||""},{onSuccess:c=>{console.log("✅ Guardar Consultas - Éxito:",c),t("✅ Consultas guardadas correctamente!","success")},onError:c=>{console.error("❌ Guardar Consultas - Error:",c),t("❌ Error al guardar consultas","danger")}})},disabled:$.isLoading,children:$.isLoading?"Guardando...":"Guardar Consultas"})})]})}),e.jsx(j,{eventKey:"mark",title:e.jsxs("span",{children:[e.jsx(be,{className:"me-1"}),"Marcar"]}),children:e.jsx("div",{className:"row g-3",children:e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h6",{className:"mb-3",children:"Marcar Proyecto"}),e.jsx("p",{className:"text-muted mb-4",children:"Marca este proyecto para seguimiento especial o prioridad alta."}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Prioridad"}),e.jsxs("select",{className:"form-select",value:r.priority||"normal",onChange:s=>l({...r,priority:s.target.value}),children:[e.jsx("option",{value:"low",children:"Baja"}),e.jsx("option",{value:"normal",children:"Normal"}),e.jsx("option",{value:"high",children:"Alta"}),e.jsx("option",{value:"urgent",children:"Urgente"})]})]}),e.jsxs(h,{variant:"success",size:"lg",onClick:()=>{const s=o==null?void 0:o.id;if(!s){console.error("No se encontró el ID del proyecto"),t("❌ Error: No se encontró el ID del proyecto","danger");return}Q.mutate({id:s,marked:!r.marked,priority:r.priority||"normal"},{onSuccess:c=>{console.log("✅ Marcar Proyecto - Éxito:",c);const d=r.marked?"desmarcado":"marcado";t(`✅ Proyecto ${d} correctamente!`,"success")},onError:c=>{console.error("❌ Marcar Proyecto - Error:",c),t("❌ Error al marcar proyecto","danger")}})},disabled:Q.isLoading,children:[e.jsx(be,{className:"me-2"}),Q.isLoading?"Procesando...":r.marked?"Desmarcar Proyecto":"Marcar Proyecto"]})]})})})}),e.jsx(j,{eventKey:"attachments",title:e.jsxs("span",{children:[e.jsx(U,{className:"me-1"}),"Adjuntos"]}),children:e.jsx("div",{className:"row g-3",children:e.jsxs("div",{className:"col-12",children:[e.jsx("h6",{className:"mb-3",children:"Gestión de Archivos"}),e.jsxs("div",{className:"card mb-4",children:[e.jsx("div",{className:"card-header",children:e.jsx("h6",{className:"mb-0",children:"Subir Nuevo Archivo"})}),e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Seleccionar Archivo"}),e.jsx("input",{type:"file",className:"form-control",onChange:ze,accept:".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.jpg,.jpeg,.png,.gif,.txt"}),e.jsx("div",{className:"form-text",children:"Formatos permitidos: PDF, DOC, DOCX, XLS, XLSX, PPT, PPTX, JPG, JPEG, PNG, GIF, TXT (máx. 10MB)"})]}),g&&e.jsx("div",{className:"mb-3",children:e.jsxs("div",{className:"alert alert-info",children:[e.jsx("strong",{children:"Archivo seleccionado:"})," ",g.name,e.jsx("br",{}),e.jsxs("small",{children:["Tamaño: ",(g.size/1024/1024).toFixed(2)," MB"]})]})}),e.jsx(h,{variant:"primary",onClick:Ge,disabled:!g||J,children:J?"Subiendo...":"Subir Archivo"})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsxs("h6",{className:"mb-0",children:["Archivos Adjuntos (",D.length,")"]})}),e.jsx("div",{className:"card-body",children:D.length===0?e.jsxs("div",{className:"text-center text-muted py-4",children:[e.jsx(U,{size:48,className:"mb-3"}),e.jsx("p",{children:"No hay archivos adjuntos"}),e.jsx("small",{children:"Sube archivos como cotizaciones, documentos técnicos, etc."})]}):e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-hover",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Archivo"}),e.jsx("th",{children:"Tamaño"}),e.jsx("th",{children:"Fecha"}),e.jsx("th",{children:"Subido por"}),e.jsx("th",{children:"Acciones"})]})}),e.jsx("tbody",{children:D.map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("div",{children:[e.jsx("strong",{children:s.original_name}),s.description&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),e.jsx("small",{className:"text-muted",children:s.description})]})]})}),e.jsx("td",{children:s.file_size?`${(s.file_size/1024/1024).toFixed(2)} MB`:"N/A"}),e.jsx("td",{children:new Date(s.created_at).toLocaleDateString()}),e.jsx("td",{children:s.uploaded_by_name||"Usuario"}),e.jsx("td",{children:e.jsxs("div",{className:"btn-group btn-group-sm",children:[e.jsx(h,{variant:"outline-primary",size:"sm",onClick:()=>Re(s),title:"Descargar",children:e.jsx(ta,{size:14})}),e.jsx(h,{variant:"outline-danger",size:"sm",onClick:()=>$e(s.id),title:"Eliminar",children:e.jsx(xe,{size:14})})]})})]},s.id))})]})})})]})]})})})]})}],onSubmit:()=>M(!1),submitText:"Cerrar",size:"xl"})]})}),fe&&e.jsxs("div",{style:{position:"fixed",top:"20px",right:"20px",zIndex:99999,backgroundColor:X==="success"?"#28a745":"#dc3545",color:"white",padding:"15px 20px",borderRadius:"8px",boxShadow:"0 4px 12px rgba(0,0,0,0.3)",minWidth:"300px",border:"none"},onClick:()=>F(!1),children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"5px"},children:X==="success"?"✅ Éxito":"❌ Error"}),e.jsx("div",{children:_e})]})]})}export{Wa as default};
//# sourceMappingURL=Proyectos-lDR7WJ89.js.map
