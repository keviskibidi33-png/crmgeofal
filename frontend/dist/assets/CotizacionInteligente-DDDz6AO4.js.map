{"version":3,"file":"CotizacionInteligente-DDDz6AO4.js","sources":["../../src/components/SubserviceAutocompleteFinal.jsx","../../src/components/ProjectSelectionModal.jsx","../../src/pages/CotizacionInteligente.jsx"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport { Form, Badge, Spinner } from 'react-bootstrap';\r\nimport { FiSearch, FiX, FiDollarSign, FiFileText } from 'react-icons/fi';\r\nimport { useQuery } from 'react-query';\r\nimport { searchSubservices } from '../services/subservices';\r\n\r\nconst SubserviceAutocompleteFinal = ({ \r\n  value = '', \r\n  onChange, \r\n  onSelect, \r\n  placeholder = 'Buscar servicio...',\r\n  disabled = false,\r\n  size = 'sm'\r\n}) => {\r\n  const [searchTerm, setSearchTerm] = useState(value);\r\n  const [isOpen, setIsOpen] = useState(false);\r\n  const [dropdownPosition, setDropdownPosition] = useState({ top: 0, left: 0, width: 0 });\r\n  const inputRef = useRef(null);\r\n  const dropdownRef = useRef(null);\r\n\r\n  // Debounce\r\n  const [debouncedTerm, setDebouncedTerm] = useState(searchTerm);\r\n  useEffect(() => {\r\n    const timer = setTimeout(() => setDebouncedTerm(searchTerm), 400);\r\n    return () => clearTimeout(timer);\r\n  }, [searchTerm]);\r\n\r\n  // Query\r\n  const { data, isLoading } = useQuery(\r\n    ['subservices', debouncedTerm],\r\n    () => searchSubservices(debouncedTerm),\r\n    {\r\n      enabled: debouncedTerm.length >= 2,\r\n      staleTime: 10 * 60 * 1000,\r\n      keepPreviousData: true,\r\n      refetchOnWindowFocus: false,\r\n    }\r\n  );\r\n\r\n  const results = data?.data || [];\r\n\r\n  // Actualizar posici√≥n del dropdown\r\n  const updatePosition = () => {\r\n    if (inputRef.current && isOpen) {\r\n      const rect = inputRef.current.getBoundingClientRect();\r\n      setDropdownPosition({\r\n        top: rect.bottom + window.scrollY + 2,\r\n        left: rect.left + window.scrollX,\r\n        width: rect.width\r\n      });\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (isOpen) {\r\n      updatePosition();\r\n      \r\n      const handleScroll = () => {\r\n        if (isOpen) updatePosition();\r\n      };\r\n      \r\n      const handleResize = () => {\r\n        if (isOpen) updatePosition();\r\n      };\r\n\r\n      window.addEventListener('scroll', handleScroll, true);\r\n      window.addEventListener('resize', handleResize);\r\n      \r\n      return () => {\r\n        window.removeEventListener('scroll', handleScroll, true);\r\n        window.removeEventListener('resize', handleResize);\r\n      };\r\n    }\r\n  }, [isOpen]);\r\n\r\n  // Handlers\r\n  const handleInputChange = (e) => {\r\n    const newValue = e.target.value;\r\n    setSearchTerm(newValue);\r\n    onChange?.(newValue);\r\n    \r\n    if (newValue.length >= 2) {\r\n      setIsOpen(true);\r\n    } else {\r\n      setIsOpen(false);\r\n    }\r\n  };\r\n\r\n  const handleFocus = () => {\r\n    if (searchTerm.length >= 2) {\r\n      setIsOpen(true);\r\n      updatePosition();\r\n    }\r\n  };\r\n\r\n  const handleItemSelect = (item) => {\r\n    setSearchTerm(item.display_text);\r\n    setIsOpen(false);\r\n    onSelect?.(item);\r\n  };\r\n\r\n  const handleClear = () => {\r\n    setSearchTerm('');\r\n    setIsOpen(false);\r\n    onChange?.('');\r\n    onSelect?.(null);\r\n  };\r\n\r\n  // Click outside\r\n  useEffect(() => {\r\n    const handleClickOutside = (e) => {\r\n      if (\r\n        inputRef.current && !inputRef.current.contains(e.target) &&\r\n        dropdownRef.current && !dropdownRef.current.contains(e.target)\r\n      ) {\r\n        setIsOpen(false);\r\n      }\r\n    };\r\n\r\n    if (isOpen) {\r\n      document.addEventListener('mousedown', handleClickOutside);\r\n      return () => document.removeEventListener('mousedown', handleClickOutside);\r\n    }\r\n  }, [isOpen]);\r\n\r\n  const formatPrice = (precio) => {\r\n    if (precio === 0) return 'Sujeto a evaluaci√≥n';\r\n    return `S/ ${precio.toFixed(2)}`;\r\n  };\r\n\r\n  const getServiceColor = (serviceName) => {\r\n    const colors = {\r\n      'ENSAYO EST√ÅNDAR': 'primary',\r\n      'ENSAYOS ESPECIALES': 'success',\r\n      'ENSAYOS DE CAMPO': 'info',\r\n      'ENSAYO AGREGADO': 'warning',\r\n    };\r\n    return colors[serviceName] || 'secondary';\r\n  };\r\n\r\n  // Dropdown Portal\r\n  const dropdownContent = isOpen && searchTerm.length >= 2 && (\r\n    <div \r\n      ref={dropdownRef}\r\n      style={{ \r\n        position: 'absolute',\r\n        top: `${dropdownPosition.top}px`,\r\n        left: `${dropdownPosition.left}px`,\r\n        width: `${dropdownPosition.width}px`,\r\n        zIndex: 999999,\r\n        maxHeight: '300px',\r\n        overflowY: 'auto',\r\n        backgroundColor: 'white',\r\n        border: '1px solid #dee2e6',\r\n        borderRadius: '4px',\r\n        boxShadow: '0 4px 12px rgba(0,0,0,0.15)'\r\n      }}\r\n      onMouseDown={(e) => e.preventDefault()}\r\n    >\r\n      {isLoading && (\r\n        <div className=\"p-3 text-center text-muted\">\r\n          <Spinner animation=\"border\" size=\"sm\" className=\"me-2\" />\r\n          <small>Buscando...</small>\r\n        </div>\r\n      )}\r\n\r\n      {!isLoading && results.length === 0 && (\r\n        <div className=\"p-3 text-center text-muted\">\r\n          <small>No se encontraron resultados</small>\r\n        </div>\r\n      )}\r\n\r\n      {!isLoading && results.length > 0 && results.map((item) => (\r\n        <div\r\n          key={item.id}\r\n          className=\"p-2 border-bottom\"\r\n          onClick={() => handleItemSelect(item)}\r\n          style={{ \r\n            cursor: 'pointer',\r\n            transition: 'background-color 0.15s'\r\n          }}\r\n          onMouseEnter={(e) => e.currentTarget.style.backgroundColor = '#f8f9fa'}\r\n          onMouseLeave={(e) => e.currentTarget.style.backgroundColor = 'white'}\r\n        >\r\n          <div className=\"d-flex justify-content-between align-items-start\">\r\n            <div className=\"flex-grow-1\">\r\n              <div className=\"d-flex align-items-center gap-2 mb-1\">\r\n                <Badge bg={getServiceColor(item.service_name)} className=\"small\">\r\n                  {item.codigo}\r\n                </Badge>\r\n              </div>\r\n              <div className=\"fw-bold small text-dark\">\r\n                {item.descripcion}\r\n              </div>\r\n              {item.norma && item.norma !== '-' && (\r\n                <div className=\"text-muted\" style={{ fontSize: '0.75rem' }}>\r\n                  <FiFileText size={10} className=\"me-1\" />\r\n                  {item.norma}\r\n                </div>\r\n              )}\r\n            </div>\r\n            <div className=\"text-end ms-2\">\r\n              <div className=\"fw-bold text-success small\">\r\n                <FiDollarSign size={12} />\r\n                {formatPrice(item.precio)}\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      ))}\r\n    </div>\r\n  );\r\n\r\n  return (\r\n    <>\r\n      <div className=\"position-relative\">\r\n        <Form.Group className=\"mb-0\">\r\n          <div className=\"position-relative\">\r\n            <Form.Control\r\n              ref={inputRef}\r\n              type=\"text\"\r\n              value={searchTerm}\r\n              onChange={handleInputChange}\r\n              onFocus={handleFocus}\r\n              placeholder={placeholder}\r\n              disabled={disabled}\r\n              size={size}\r\n              className=\"pe-5\"\r\n              autoComplete=\"off\"\r\n            />\r\n            \r\n            <div className=\"position-absolute top-50 end-0 translate-middle-y pe-3 d-flex align-items-center gap-2\">\r\n              {isLoading && <Spinner animation=\"border\" size=\"sm\" variant=\"primary\" />}\r\n              {!isLoading && searchTerm && (\r\n                <FiX \r\n                  className=\"text-muted\" \r\n                  onClick={handleClear}\r\n                  onMouseDown={(e) => e.preventDefault()}\r\n                  style={{ cursor: 'pointer' }}\r\n                />\r\n              )}\r\n              {!isLoading && !searchTerm && <FiSearch className=\"text-muted\" />}\r\n            </div>\r\n          </div>\r\n        </Form.Group>\r\n      </div>\r\n\r\n      {/* Renderizar dropdown usando Portal para evitar overflow de tabla */}\r\n      {typeof document !== 'undefined' && dropdownContent && ReactDOM.createPortal(\r\n        dropdownContent,\r\n        document.body\r\n      )}\r\n    </>\r\n  );\r\n};\r\n\r\nexport default SubserviceAutocompleteFinal;","import React, { useState, useEffect } from 'react';\r\nimport { Modal, Button, ListGroup, Badge, Alert, Spinner } from 'react-bootstrap';\r\nimport { FiFolder, FiPlus, FiCalendar, FiUser, FiMapPin, FiEdit3 } from 'react-icons/fi';\r\nimport { searchProjectsByName } from '../services/projects';\r\n\r\nconst ProjectSelectionModal = ({ \r\n  show, \r\n  onHide, \r\n  projectName, \r\n  companyId, \r\n  onSelectExisting, \r\n  onCreateNew \r\n}) => {\r\n  const [existingProjects, setExistingProjects] = useState([]);\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState(null);\r\n\r\n  useEffect(() => {\r\n    console.log('üîç ProjectSelectionModal - useEffect triggered:', { show, projectName, companyId });\r\n    if (show && projectName && projectName.trim().length >= 2) {\r\n      searchExistingProjects();\r\n    }\r\n  }, [show, projectName, companyId]);\r\n\r\n  const searchExistingProjects = async () => {\r\n    try {\r\n      console.log('üîç ProjectSelectionModal - Iniciando b√∫squeda:', { projectName, companyId });\r\n      setLoading(true);\r\n      setError(null);\r\n      const projects = await searchProjectsByName(projectName, companyId);\r\n      console.log('‚úÖ ProjectSelectionModal - Proyectos encontrados:', projects);\r\n      setExistingProjects(projects || []);\r\n    } catch (err) {\r\n      console.error('‚ùå ProjectSelectionModal - Error searching projects:', err);\r\n      setError('Error al buscar proyectos existentes');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleSelectExisting = (project) => {\r\n    onSelectExisting(project);\r\n    onHide();\r\n  };\r\n\r\n  const handleCreateNew = () => {\r\n    onCreateNew();\r\n    onHide();\r\n  };\r\n\r\n  const handleCreateDifferentiated = () => {\r\n    // Calcular el siguiente n√∫mero para diferenciaci√≥n\r\n    const nextNumber = existingProjects.length + 1;\r\n    const differentiatedName = `${projectName} (${nextNumber})`;\r\n    \r\n    // Llamar a la funci√≥n con el nombre diferenciado\r\n    onCreateNew(differentiatedName);\r\n    onHide();\r\n  };\r\n\r\n  const handleEditProject = (project) => {\r\n    // Permitir editar el nombre del proyecto para unificaci√≥n\r\n    const newName = prompt(`Editar nombre del proyecto \"${project.name}\":`, project.name);\r\n    if (newName && newName.trim() !== project.name) {\r\n      // Aqu√≠ podr√≠as implementar la l√≥gica para actualizar el proyecto\r\n      console.log('Editar proyecto:', project.id, 'nuevo nombre:', newName);\r\n      alert(`Funcionalidad de edici√≥n en desarrollo. Proyecto: ${project.name} ‚Üí ${newName}`);\r\n    }\r\n  };\r\n\r\n  const formatDate = (dateString) => {\r\n    return new Date(dateString).toLocaleDateString('es-PE');\r\n  };\r\n\r\n  return (\r\n    <Modal show={show} onHide={onHide} size=\"lg\" centered style={{ zIndex: 9999 }}>\r\n      <Modal.Header closeButton>\r\n        <Modal.Title>\r\n          <FiFolder className=\"me-2\" />\r\n          Proyectos Existentes: \"{projectName}\"\r\n        </Modal.Title>\r\n      </Modal.Header>\r\n      \r\n      <Modal.Body>\r\n        {loading && (\r\n          <div className=\"text-center py-4\">\r\n            <Spinner animation=\"border\" />\r\n            <p className=\"mt-2\">Buscando proyectos existentes...</p>\r\n          </div>\r\n        )}\r\n\r\n        {error && (\r\n          <Alert variant=\"danger\">\r\n            {error}\r\n          </Alert>\r\n        )}\r\n\r\n        {!loading && !error && existingProjects.length > 0 && (\r\n          <>\r\n            <Alert variant=\"warning\" className=\"mb-3\">\r\n              <div>\r\n                <strong>‚ö†Ô∏è Se encontraron {existingProjects.length} proyecto(s) con el nombre \"{projectName}\" en esta empresa.</strong>\r\n                <br />\r\n                Para evitar confusiones, el sistema sugiere diferenciarlos autom√°ticamente.\r\n              </div>\r\n            </Alert>\r\n            \r\n            <Alert variant=\"info\" className=\"mb-3\">\r\n              <div>\r\n                <strong>üí° Opciones disponibles:</strong>\r\n                <ul className=\"mb-0 mt-2\">\r\n                  <li><strong>Continuar con proyecto existente:</strong> Usar uno de los proyectos listados</li>\r\n                  <li><strong>Crear nuevo diferenciado:</strong> El sistema agregar√° autom√°ticamente \"(2)\", \"(3)\", etc.</li>\r\n                  <li><strong>Editar manualmente:</strong> Puedes cambiar el nombre despu√©s de crear el proyecto</li>\r\n                </ul>\r\n              </div>\r\n            </Alert>\r\n\r\n            <ListGroup>\r\n              {existingProjects.map((project) => (\r\n                <ListGroup.Item \r\n                  key={project.id}\r\n                  className=\"d-flex justify-content-between align-items-start\"\r\n                  style={{ cursor: 'pointer' }}\r\n                  onClick={() => handleSelectExisting(project)}\r\n                >\r\n                  <div className=\"ms-2 me-auto\">\r\n                    <div className=\"fw-bold\">\r\n                      <FiFolder className=\"me-1\" />\r\n                      {project.name}\r\n                    </div>\r\n                    <div className=\"text-muted small\">\r\n                      <strong>Empresa:</strong> {project.company_name} (RUC: {project.company_ruc})\r\n                    </div>\r\n                    <div className=\"text-muted small\">\r\n                      <FiMapPin className=\"me-1\" />\r\n                      {project.location || 'Sin ubicaci√≥n'}\r\n                    </div>\r\n                    <div className=\"text-muted small\">\r\n                      <FiUser className=\"me-1\" />\r\n                      Vendedor: {project.vendedor_name || 'No asignado'}\r\n                    </div>\r\n                    <div className=\"text-muted small\">\r\n                      <FiCalendar className=\"me-1\" />\r\n                      Creado: {formatDate(project.created_at)}\r\n                    </div>\r\n                  </div>\r\n                  <div className=\"text-end\">\r\n                    <div className=\"mb-2\">\r\n                      <Button \r\n                        variant=\"outline-secondary\" \r\n                        size=\"sm\"\r\n                        onClick={(e) => {\r\n                          e.stopPropagation();\r\n                          handleEditProject(project);\r\n                        }}\r\n                        title=\"Editar nombre para unificar proyectos\"\r\n                      >\r\n                        <FiEdit3 className=\"me-1\" />\r\n                        Editar\r\n                      </Button>\r\n                    </div>\r\n                    <div>\r\n                      <Badge bg=\"secondary\" className=\"me-2\">\r\n                        {project.quotes_count} cotizaci√≥n(es)\r\n                      </Badge>\r\n                      <Badge bg={project.status === 'activo' ? 'success' : 'warning'}>\r\n                        {project.status}\r\n                      </Badge>\r\n                    </div>\r\n                  </div>\r\n                </ListGroup.Item>\r\n              ))}\r\n            </ListGroup>\r\n          </>\r\n        )}\r\n\r\n        {!loading && !error && existingProjects.length === 0 && (\r\n          <Alert variant=\"success\">\r\n            <strong>No se encontraron proyectos con ese nombre.</strong>\r\n            <br />\r\n            Puedes crear un nuevo proyecto sin problemas.\r\n          </Alert>\r\n        )}\r\n      </Modal.Body>\r\n\r\n      <Modal.Footer>\r\n        <Button variant=\"outline-secondary\" onClick={onHide}>\r\n          Cancelar\r\n        </Button>\r\n        <Button variant=\"warning\" onClick={handleCreateDifferentiated}>\r\n          <FiPlus className=\"me-1\" />\r\n          Crear \"{projectName} ({existingProjects.length + 1})\"\r\n        </Button>\r\n        <Button variant=\"primary\" onClick={handleCreateNew}>\r\n          <FiPlus className=\"me-1\" />\r\n          Crear Nuevo (Nombre Original)\r\n        </Button>\r\n      </Modal.Footer>\r\n    </Modal>\r\n  );\r\n};\r\n\r\nexport default ProjectSelectionModal;\r\n","import React, { useEffect, useMemo, useState } from 'react';\r\nimport { useSearchParams, useLocation } from 'react-router-dom';\r\nimport ModuloBase from '../components/ModuloBase';\r\nimport { createQuote, getQuote, updateQuote } from '../services/quotes';\r\nimport { getExistingServices, listProjects, createProject, searchProjectsByName } from '../services/projects';\r\nimport { getOrCreateCompany, listCompanies } from '../services/companies';\r\nimport CompanyProjectPicker from '../components/CompanyProjectPicker';\r\nimport SubserviceAutocompleteFinal from '../components/SubserviceAutocompleteFinal';\r\nimport SuccessModal from '../components/SuccessModal';\r\nimport ProjectSelectionModal from '../components/ProjectSelectionModal';\r\nimport './CotizacionInteligente.css';\r\nimport '../styles/autocomplete.css';\r\n\r\nconst emptyClient = {\r\n  company_name: '', ruc: '', contact_name: '', contact_phone: '', contact_email: '',\r\n  project_location: '', project_name: '',\r\n};\r\n\r\nconst emptyQuote = {\r\n  request_date: '', issue_date: '', commercial_name: '', commercial_phone: '', \r\n  payment_terms: 'adelantado', reference: '', reference_type: ['email', 'phone'], \r\n  igv: true, delivery_days: 4, category_main: 'laboratorio',\r\n};\r\n\r\nconst emptyItem = { code: '', description: '', norm: '', unit_price: 0, quantity: 1 };\r\n\r\nfunction computePartial(item) {\r\n  const u = Number(item.unit_price || 0);\r\n  const q = Number(item.quantity || 0);\r\n  return Number((u * q).toFixed(2));\r\n}\r\n\r\nfunction suggestedFileName(seq = 'xxx-XX', client = '') {\r\n  const clientName = (client || '').toUpperCase().trim() || 'NOMBRE DEL CLIENTE';\r\n  return `Cotizaci√≥n ${seq} LEM-GEOFAL-${clientName}`;\r\n}\r\n\r\nfunction generateQuoteCode() {\r\n  const year = new Date().getFullYear();\r\n  const month = String(new Date().getMonth() + 1).padStart(2, '0');\r\n  const day = String(new Date().getDate()).padStart(2, '0');\r\n  const random = Math.floor(Math.random() * 1000).toString().padStart(3, '0');\r\n  return `COT-${year}${month}${day}-${random}`;\r\n}\r\n\r\nconst normalizeKey = (s = '') => (s || '')\r\n  .normalize('NFD')\r\n  .replace(/[\\u0300-\\u036f]/g, '')\r\n  .toUpperCase()\r\n  .trim();\r\n\r\nconst VARIANT_TEXTS = {\r\n  [normalizeKey('MUESTRA DE SUELO Y AGREGADO')]: `CONDICIONES ESPEC√çFICAS:\\n- El cliente debe enviar al laboratorio, para los ensayo en suelo y agregados, la cantidad minima de 100 kg por cada muestra.\\n- El cliente deber√° de entregar las muestras debidamente identificadas.\\n- El cliente deber√° especificar la Norma a ser utilizada para la ejecuci√≥n del ensayo, caso contrario se considera Norma ASTM o NTP vigente de acuerdo con el alcance del laboratorio.\\n- El cliente deber√° entregar las muestras en las instalaciones del LEM, ubicado en la Av. Mara√±√≥n N¬∞ 763, Los Olivos, Lima.`,\r\n  [normalizeKey('PROBETAS')]: `CONDICIONES ESPEC√çFICAS:\\n- El cliente debe proporcionar las probetas antes del ingreso a obra.\\n- El cliente deber√° de entregar las muestras debidamente identificadas.\\n- El cliente deber√° especificar la Norma a ser utilizada para la ejecuci√≥n del ensayo, caso contrario se considera Norma ASTM o NTP vigente de acuerdo con el alcance del laboratorio.\\n- El cliente deber√° entregar las muestras en las instalaciones del LEM, ubicado en la Av. Mara√±√≥n N¬∞ 763, Los Olivos, Lima.`,\r\n  [normalizeKey('DENSIDAD DE CAMPO Y MUESTREO')]: `CONDICIONES ESPEC√çFICAS:\\n- El cliente deber√° enviar al laboratorio, para los ensayo en suelo y agregados, la cantidad minima de 100 kg por cada muestra.\\n- Para el ensayo de Densidad de campo, la cantidad de puntos/salida minimo 4 und.\\n- El cliente deber√° de programar el servicio, Densidad de campo, con 24 horas de anticipaci√≥n.\\n- El cliente deber√° especificar la Norma a ser utilizada para la ejecuci√≥n del ensayo, caso contrario se considera Norma ASTM o NTP vigente de acuerdo con el alcance del laboratorio.\\n- El cliente deber√° entregar las muestras en las instalaciones del LEM, ubicado en la Av. Mara√±√≥n N¬∞ 763, Los Olivos, Lima.`,\r\n  [normalizeKey('EXTRACCI√ìN DE DIAMANTINA')]: `CONDICIONES ESPEC√çFICAS:\\n- Movilizaci√≥n y desmovilizaci√≥n de equipos y del personal t√©cnico, estara a cargo de GEOFAL.\\n- Resane de estructura de concreto con sika rep 500 y Sikadur 32, estara a cargo de GEOFAL.\\n- El servicio no incluye trabajos de acabados como pintura, mayolica y otros.\\n- El area de trabajo, zona de extracci√≥n de diamantina, tiene que estar libre de interferencia.\\n- La extracci√≥n de diamantina se realizara en 2 dia en campo, en laboratorio se realizar√° el tallado y refrentado de diamantina, el ensayo de resistencia a la compresi√≥n de testigo de diamantina se realizara en 5 dias (el tiempo de ensayo obedece a la normativa vigente).\\n- Costo de resane insumos 250 soles, este costo se distribuira de acuerdo con el numero de perforaciones Donde se hara las extracciones de diamantina`,\r\n  [normalizeKey('DIAMANTINA PARA PASES')]: `CONDICIONES ESPEC√çFICAS:\\n- El cliente deber√° de programar el servicio, Extracci√≥n diamantina, con 24 horas de anticipaci√≥n.\\n- El area de trabajo, zona de extraccion de diamantina, debera estar libre de interferencia.\\n- Para extraer la diamantina, se ubicara el acero con un escaneador.\\n- Movilizacion y desmovilizacion de equipos y del personal tecnico, estara a cargo de Geofal.`,\r\n  [normalizeKey('ALBA√ëILER√çA')]: `CONDICIONES ESPEC√çFICAS:\\n- El cliente deber√° enviar al laboratorio, 20 ladrillo de cada tipo, en buen estado y sin presentar fisuras.\\n- El cliente deber√° de entregar las muestras debidamente identificadas.\\n- El cliente deber√° especificar la Norma a ser utilizada para la ejecuci√≥n del ensayo, caso contrario se considera Norma ASTM o NTP vigente de acuerdo con el alcance del laboratorio.\\n- El cliente deber√° entregar las muestras en las instalaciones del LEM, ubicado en la Av. Mara√±√≥n N¬∞ 763, Los Olivos, Lima`,\r\n  [normalizeKey('VIGA BECKELMAN')]: `CONDICIONES ESPEC√çFICAS:\\n- El cliente deber√° de programar el servicio, Ensayo de Deflexi√≥n, con 24 horas de anticipaci√≥n.\\n- El area de trabajo tiene que estar habilitado.\\n- El cliente deber√° especificar la Norma a ser utilizada para la ejecuci√≥n del ensayo, caso contrario se considera Norma ASTM o NTP o MTC vigente de acuerdo con el alcance del laboratorio.\\n- Especificar las caracteristicas del camion`,\r\n  [normalizeKey('CONTROL DE CALIDAD DE CONCRETO FRESCO EN OBRA')]: `CONDICIONES ESPEC√çFICAS:\\n- El cliente deber√° de programar el servicio, con 24 horas de anticipaci√≥n.\\n- Para el ensayo de control de calidad de concreto fresco en obra, se moldeara 6 probetas, ensayo slump, control de temperatura, en laboratorio las probetas se colocara en camara de curado, el ensayo de compresi√≥n de las probetas seran 3 a 7 dias y 3 a 28 dias.\\n- El control de calidad del concreto fresco se sacara cada 50m3 a uno de los mixer donde se hara todos los ensayos respectivos mencionados, o por dia asi no se halla llegado los 50m3.\\n- El cliente deber√° especificar la Norma a ser utilizada para la ejecuci√≥n del ensayo, caso contrario se considera Norma ASTM o NTP vigente de acuerdo con el alcance del laboratorio.`,\r\n};\r\n\r\nconst getVariantText = (v) => {\r\n  const t = normalizeKey(v?.title || '');\r\n  if (VARIANT_TEXTS[t]) return VARIANT_TEXTS[t];\r\n  const entry = Object.entries(VARIANT_TEXTS).find(([k]) => t.includes(k) || k.includes(t));\r\n  return entry ? entry[1] : '';\r\n};\r\n\r\nexport default function CotizacionInteligente() {\r\n  const [searchParams] = useSearchParams();\r\n  const location = useLocation();\r\n  const editQuoteId = searchParams.get('edit');\r\n  \r\n  const [variants, setVariants] = useState([]);\r\n  const [variantId, setVariantId] = useState('');\r\n  const [client, setClient] = useState(emptyClient);\r\n  const [selection, setSelection] = useState({ company_id: null, project_id: null, company: null, project: null });\r\n  const [quote, setQuote] = useState(emptyQuote);\r\n  const [items, setItems] = useState([{ ...emptyItem }]);\r\n  const [saving, setSaving] = useState(false);\r\n  const [error, setError] = useState('');\r\n  const [conditionsText, setConditionsText] = useState('');\r\n  const [lastSavedId, setLastSavedId] = useState(null);\r\n  const [allProjects, setAllProjects] = useState([]);\r\n  const [projectSuggestions, setProjectSuggestions] = useState([]);\r\n  const [showProjectSuggestions, setShowProjectSuggestions] = useState(false);\r\n  const [suggestedFileName, setSuggestedFileName] = useState('');\r\n  const [loadingQuote, setLoadingQuote] = useState(false);\r\n  const [currentUser, setCurrentUser] = useState(null);\r\n  \r\n  // Estados para el buscador de clientes\r\n  const [clients, setClients] = useState([]);\r\n  const [filteredClients, setFilteredClients] = useState([]);\r\n  const [clientSearch, setClientSearch] = useState('');\r\n  const [selectedClient, setSelectedClient] = useState(null);\r\n  const [showClientDropdown, setShowClientDropdown] = useState(false);\r\n  \r\n  // Estado para el modal de √©xito\r\n  const [showSuccessModal, setShowSuccessModal] = useState(false);\r\n  const [successData, setSuccessData] = useState(null);\r\n  \r\n  // Estados para el modal de selecci√≥n de proyecto\r\n  const [showProjectSelectionModal, setShowProjectSelectionModal] = useState(false);\r\n  const [pendingProjectName, setPendingProjectName] = useState('');\r\n  const [pendingCompanyId, setPendingCompanyId] = useState(null);\r\n  const [searchTimeout, setSearchTimeout] = useState(null);\r\n  const [duplicateWarning, setDuplicateWarning] = useState(null);\r\n  \r\n  // Etiquetas predefinidas para referencia\r\n  const referenceTypes = [\r\n    { value: 'email', label: 'üìß Correo electr√≥nico', icon: 'üìß' },\r\n    { value: 'phone', label: 'üìû Llamada telef√≥nica', icon: 'üìû' },\r\n    { value: 'ticket', label: 'üéØ Sistema de tickets', icon: 'üéØ' },\r\n    { value: 'meeting', label: 'ü§ù Reuni√≥n presencial', icon: 'ü§ù' },\r\n    { value: 'form', label: 'üìã Formulario web', icon: 'üìã' },\r\n    { value: 'referral', label: 'üë• Referido', icon: 'üë•' },\r\n    { value: 'other', label: 'üìù Otro', icon: 'üìù' }\r\n  ];\r\n\r\n  // Cargar variantes\r\n  useEffect(() => {\r\n    const fallback = [\r\n      { id: 'V1', code: 'V1', title: 'MUESTRA DE SUELO Y AGREGADO', description: getVariantText({ title: 'MUESTRA DE SUELO Y AGREGADO' }) },\r\n      { id: 'V2', code: 'V2', title: 'PROBETAS', description: getVariantText({ title: 'PROBETAS' }) },\r\n      { id: 'V3', code: 'V3', title: 'DENSIDAD DE CAMPO Y MUESTREO', description: getVariantText({ title: 'DENSIDAD DE CAMPO Y MUESTREO' }) },\r\n      { id: 'V4', code: 'V4', title: 'EXTRACCI√ìN DE DIAMANTINA', description: getVariantText({ title: 'EXTRACCI√ìN DE DIAMANTINA' }) },\r\n      { id: 'V5', code: 'V5', title: 'DIAMANTINA PARA PASES', description: getVariantText({ title: 'DIAMANTINA PARA PASES' }) },\r\n      { id: 'V6', code: 'V6', title: 'ALBA√ëILER√çA', description: getVariantText({ title: 'ALBA√ëILER√çA' }) },\r\n      { id: 'V7', code: 'V7', title: 'VIGA BECKELMAN', description: getVariantText({ title: 'VIGA BECKELMAN' }) },\r\n      { id: 'V8', code: 'V8', title: 'CONTROL DE CALIDAD DE CONCRETO FRESCO EN OBRA', description: getVariantText({ title: 'CONTROL DE CALIDAD DE CONCRETO FRESCO EN OBRA' }) },\r\n    ];\r\n    setVariants(fallback);\r\n  }, []);\r\n\r\n  // Cargar proyectos existentes\r\n  useEffect(() => {\r\n    (async () => {\r\n      try {\r\n        const response = await listProjects({ page: 1, limit: 100 });\r\n        const projects = response.data || [];\r\n        setAllProjects(projects);\r\n        setProjectSuggestions(projects);\r\n      } catch (e) {\r\n        console.warn('No se pudieron cargar proyectos existentes:', e);\r\n        setAllProjects([]);\r\n        setProjectSuggestions([]);\r\n      }\r\n    })();\r\n  }, []);\r\n\r\n  // Auto-completar datos del cliente cuando se selecciona\r\n  useEffect(() => {\r\n    if (selection.company) {\r\n      setClient(prev => ({\r\n        ...prev,\r\n        company_name: selection.company.name || prev.company_name,\r\n        ruc: selection.company.ruc || prev.ruc,\r\n        contact_name: selection.company.contact_name || prev.contact_name,\r\n        contact_phone: selection.company.phone || prev.contact_phone,\r\n        contact_email: selection.company.email || prev.contact_email,\r\n        project_location: selection.project?.location || prev.project_location,\r\n        project_name: selection.project?.name || prev.project_name\r\n      }));\r\n    }\r\n  }, [selection.company, selection.project]);\r\n\r\n  // Auto-completar datos del asesor comercial desde el API\r\n  useEffect(() => {\r\n    const loadUserData = async () => {\r\n      try {\r\n        const token = localStorage.getItem('token');\r\n        if (!token) return;\r\n        \r\n        const response = await fetch('http://localhost:4000/api/auth/me', {\r\n          headers: {\r\n            'Authorization': `Bearer ${token}`\r\n          }\r\n        });\r\n        \r\n        if (response.ok) {\r\n          const data = await response.json();\r\n          if (data.user) {\r\n            setCurrentUser(data.user); // Guardar usuario actual\r\n            setQuote(prev => ({\r\n              ...prev,\r\n              commercial_name: data.user.name || prev.commercial_name,\r\n              commercial_phone: data.user.phone || prev.commercial_phone,\r\n              // Inicializar fecha de emisi√≥n con la fecha actual si est√° vac√≠a\r\n              issue_date: prev.issue_date || new Date().toISOString().slice(0, 10),\r\n              // Inicializar fecha de solicitud con la fecha actual si est√° vac√≠a\r\n              request_date: prev.request_date || new Date().toISOString().slice(0, 10)\r\n            }));\r\n          }\r\n        }\r\n      } catch (e) {\r\n        console.warn('No se pudo obtener datos del usuario:', e);\r\n      }\r\n    };\r\n    \r\n    loadUserData();\r\n  }, []);\r\n\r\n\r\n  // Autocompletar desde la variante seleccionada\r\n  useEffect(() => {\r\n    if (!variantId) return;\r\n    const v = (variants || []).find(x => String(x.id) === String(variantId));\r\n    if (!v) return;\r\n    const c = v.conditions || {};\r\n    setQuote(prev => ({\r\n      ...prev,\r\n      payment_terms: c.default_payment_terms || prev.payment_terms,\r\n      igv: typeof c.default_igv === 'boolean' ? c.default_igv : prev.igv,\r\n      reference: c.default_reference || prev.reference,\r\n    }));\r\n    const extra = getVariantText(v) || v.description || '';\r\n    if (extra) setConditionsText(extra);\r\n  }, [variantId]);\r\n\r\n  const subtotal = useMemo(() => items.reduce((acc, it) => acc + computePartial(it), 0), [items]);\r\n  const igvAmount = useMemo(() => (quote.igv ? Number((subtotal * 0.18).toFixed(2)) : 0), [subtotal, quote.igv]);\r\n  const total = useMemo(() => Number((subtotal + igvAmount).toFixed(2)), [subtotal, igvAmount]);\r\n\r\n  const onAddItem = () => setItems([...items, { ...emptyItem }]);\r\n  const onRemoveItem = (idx) => setItems(items.filter((_, i) => i !== idx));\r\n  const onChangeItem = (idx, patch) => setItems(items.map((it, i) => (i === idx ? { ...it, ...patch } : it)));\r\n\r\n  // Funciones para el buscador de clientes\r\n  const fetchClients = async () => {\r\n    try {\r\n      console.log('üîç fetchClients - Llamando a /api/companies');\r\n      const clientsData = await listCompanies({ limit: 500 });\r\n      console.log('üîç fetchClients - Respuesta recibida:', clientsData);\r\n      \r\n      const clientsList = clientsData?.data || clientsData || [];\r\n      console.log('üîç fetchClients - Lista de clientes:', clientsList.length, 'clientes');\r\n      \r\n      setClients(clientsList);\r\n    } catch (err) {\r\n      console.error('‚ùå Error fetching clients:', err);\r\n      setError('Error al cargar los clientes: ' + (err.message || 'Error desconocido'));\r\n      setClients([]);\r\n    }\r\n  };\r\n\r\n  const handleClientSearch = (searchTerm) => {\r\n    console.log('üîç handleClientSearch - T√©rmino de b√∫squeda:', searchTerm);\r\n    setClientSearch(searchTerm);\r\n    \r\n    if (!searchTerm.trim()) {\r\n      setFilteredClients([]);\r\n      setShowClientDropdown(false);\r\n      return;\r\n    }\r\n    \r\n    const searchLower = searchTerm.toLowerCase();\r\n    console.log('üîç handleClientSearch - B√∫squeda en min√∫sculas:', searchLower);\r\n    \r\n    const filtered = clients.filter(client => {\r\n      const nameMatch = client.name?.toLowerCase().includes(searchLower);\r\n      const rucMatch = client.ruc?.toLowerCase().includes(searchLower);\r\n      const emailMatch = client.email?.toLowerCase().includes(searchLower);\r\n      const phoneMatch = client.phone?.toLowerCase().includes(searchLower);\r\n      \r\n      // B√∫squeda por palabras individuales\r\n      const nameWordsMatch = client.name?.toLowerCase().split(' ').some(word => \r\n        word.includes(searchLower)\r\n      );\r\n      \r\n      const match = nameMatch || rucMatch || emailMatch || phoneMatch || nameWordsMatch;\r\n      \r\n      if (match) {\r\n        console.log('‚úÖ Cliente encontrado:', client.name, '- Match:', { nameMatch, nameWordsMatch, rucMatch, emailMatch, phoneMatch });\r\n      }\r\n      \r\n      return match;\r\n    });\r\n    \r\n    console.log('üîç handleClientSearch - Resultados encontrados:', filtered.length);\r\n    setFilteredClients(filtered);\r\n    setShowClientDropdown(true);\r\n  };\r\n\r\n  const handleClientSelect = (client) => {\r\n    console.log('üîç handleClientSelect - Cliente seleccionado:', client.name, 'ID:', client.id);\r\n    setSelectedClient(client);\r\n    setClientSearch(client.name);\r\n    setShowClientDropdown(false);\r\n    \r\n    // Llenar autom√°ticamente los campos del cliente\r\n    setClient(prev => ({\r\n      ...prev,\r\n      company_name: client.name || '',\r\n      ruc: client.ruc || '',\r\n      contact_name: client.contact_name || '',\r\n      contact_phone: client.phone || '',\r\n      contact_email: client.email || '',\r\n      project_location: client.address || ''\r\n    }));\r\n    \r\n    console.log('‚úÖ Campos del cliente llenados autom√°ticamente:', {\r\n      company_name: client.name,\r\n      ruc: client.ruc,\r\n      contact_name: client.contact_name,\r\n      contact_phone: client.phone,\r\n      contact_email: client.email,\r\n      project_location: client.address\r\n    });\r\n  };\r\n\r\n  const handleClientClear = () => {\r\n    console.log('üîç handleClientClear - Limpiando selecci√≥n de cliente');\r\n    setSelectedClient(null);\r\n    setClientSearch('');\r\n    setShowClientDropdown(false);\r\n    setClient(emptyClient);\r\n  };\r\n\r\n\r\n  // Cargar cotizaci√≥n existente para edici√≥n\r\n  useEffect(() => {\r\n    if (editQuoteId && clients.length > 0) {\r\n      loadExistingQuote(editQuoteId);\r\n    }\r\n  }, [editQuoteId, clients]);\r\n\r\n  const loadExistingQuote = async (quoteId) => {\r\n    setLoadingQuote(true);\r\n    try {\r\n      console.log('üîÑ Cargando cotizaci√≥n existente:', quoteId);\r\n      const existingQuote = await getQuote(quoteId);\r\n      console.log('‚úÖ Cotizaci√≥n cargada:', existingQuote);\r\n      \r\n      // Si no tenemos datos del usuario, cargarlos\r\n      if (!currentUser) {\r\n        try {\r\n          const token = localStorage.getItem('token');\r\n          if (token) {\r\n            const response = await fetch('http://localhost:4000/api/auth/me', {\r\n              headers: {\r\n                'Authorization': `Bearer ${token}`\r\n              }\r\n            });\r\n            \r\n            if (response.ok) {\r\n              const data = await response.json();\r\n              if (data.user) {\r\n                setCurrentUser(data.user);\r\n                console.log('‚úÖ Usuario cargado para edici√≥n:', data.user);\r\n              }\r\n            }\r\n          }\r\n        } catch (e) {\r\n          console.warn('No se pudo obtener datos del usuario para edici√≥n:', e);\r\n        }\r\n      }\r\n      \r\n      // Parsear meta si viene como string JSON\r\n      if (existingQuote.meta && typeof existingQuote.meta === 'string') {\r\n        try {\r\n          existingQuote.meta = JSON.parse(existingQuote.meta);\r\n          console.log('‚úÖ Meta parseado correctamente:', existingQuote.meta);\r\n        } catch (error) {\r\n          console.error('‚ùå Error parseando meta:', error);\r\n          existingQuote.meta = {};\r\n        }\r\n      }\r\n      \r\n      // Cargar datos del cliente\r\n      if (existingQuote.client_contact || existingQuote.company_name) {\r\n        // Usar company_name del JOIN con companies (raz√≥n social real) como prioridad\r\n        const companyName = existingQuote.company_name || existingQuote.client_company || existingQuote.client_contact || '';\r\n        const contactName = existingQuote.client_contact || '';\r\n        \r\n        setClient(prev => ({\r\n          ...prev,\r\n          company_name: companyName, // ‚úÖ Usar la raz√≥n social real de la empresa\r\n          ruc: existingQuote.company_ruc || existingQuote.client_ruc || '', // ‚úÖ Usar RUC de la empresa\r\n          contact_name: contactName,\r\n          contact_phone: existingQuote.client_phone || '',\r\n          contact_email: existingQuote.client_email || '',\r\n          project_location: existingQuote.project_location || '',\r\n          project_name: existingQuote.project_name || ''\r\n        }));\r\n        \r\n        // Configurar el campo de b√∫squeda de clientes con la raz√≥n social\r\n        setClientSearch(companyName);\r\n        console.log('üîç Configurando b√∫squeda de cliente:', companyName);\r\n        console.log('üîç RUC del cliente:', existingQuote.company_ruc || existingQuote.client_ruc);\r\n        console.log('üîç Tel√©fono del cliente:', existingQuote.client_phone);\r\n        \r\n        // Si hay RUC, buscar el cliente en la lista\r\n        const rucToSearch = existingQuote.company_ruc || existingQuote.client_ruc;\r\n        if (rucToSearch) {\r\n          console.log('üîç Buscando cliente por RUC:', rucToSearch);\r\n          const foundClient = clients.find(c => c.ruc === rucToSearch);\r\n          if (foundClient) {\r\n            console.log('‚úÖ Cliente encontrado:', foundClient);\r\n            setSelectedClient(foundClient);\r\n          } else {\r\n            console.log('‚ùå Cliente no encontrado en la lista, creando cliente simulado');\r\n            // Si no se encuentra el cliente, crear un objeto simulado con los datos de la cotizaci√≥n\r\n            const simulatedClient = {\r\n              id: 'existing',\r\n              name: companyName,\r\n              ruc: rucToSearch || '',\r\n              email: existingQuote.client_email || '',\r\n              phone: existingQuote.client_phone || '',\r\n              contact_name: contactName,\r\n              address: existingQuote.project_location || ''\r\n            };\r\n            setSelectedClient(simulatedClient);\r\n            console.log('‚úÖ Cliente simulado creado:', simulatedClient);\r\n          }\r\n        } else {\r\n          // Si no hay RUC pero hay nombre de cliente, crear cliente simulado\r\n          const simulatedClient = {\r\n            id: 'existing',\r\n            name: companyName,\r\n            ruc: '',\r\n            email: existingQuote.client_email || '',\r\n            phone: existingQuote.client_phone || '',\r\n            contact_name: contactName,\r\n            address: existingQuote.project_location || ''\r\n          };\r\n          setSelectedClient(simulatedClient);\r\n          console.log('‚úÖ Cliente simulado creado (sin RUC):', simulatedClient);\r\n        }\r\n      }\r\n      \r\n      // Cargar datos de la cotizaci√≥n\r\n      setQuote(prev => ({\r\n        ...prev,\r\n        request_date: existingQuote.meta?.quote?.request_date || existingQuote.request_date || new Date().toISOString().slice(0, 10),\r\n        issue_date: existingQuote.issue_date || new Date().toISOString().slice(0, 10), // Mantener fecha original o usar actual\r\n        commercial_name: existingQuote.commercial_name || currentUser?.name || '',\r\n        commercial_phone: existingQuote.commercial_phone || currentUser?.phone || '',\r\n        payment_terms: existingQuote.payment_terms || 'adelantado',\r\n        reference: existingQuote.reference || '',\r\n        reference_type: existingQuote.reference_type || ['email', 'phone'],\r\n        igv: existingQuote.igv !== false,\r\n        delivery_days: existingQuote.meta?.quote?.delivery_days || existingQuote.delivery_days || 4, // Mantener d√≠as h√°biles originales\r\n        category_main: existingQuote.category_main || 'laboratorio'\r\n      }));\r\n      \r\n      // Cargar items si existen (desde meta.items)\r\n      let itemsToLoad = [];\r\n      if (existingQuote.meta && existingQuote.meta.items && existingQuote.meta.items.length > 0) {\r\n        itemsToLoad = existingQuote.meta.items;\r\n        console.log('‚úÖ Cargando √≠tems desde meta.items:', itemsToLoad.length);\r\n      } else if (existingQuote.items && existingQuote.items.length > 0) {\r\n        itemsToLoad = existingQuote.items;\r\n        console.log('‚úÖ Cargando √≠tems desde items directo:', itemsToLoad.length);\r\n      }\r\n      \r\n      if (itemsToLoad.length > 0) {\r\n        setItems(itemsToLoad);\r\n        console.log('üì¶ √çtems cargados para edici√≥n:', itemsToLoad);\r\n      } else {\r\n        console.log('üì¶ No hay √≠tems para cargar, usando √≠tem vac√≠o por defecto');\r\n        setItems([{ ...emptyItem }]);\r\n      }\r\n      \r\n      // Cargar variante si existe\r\n      if (existingQuote.variant_id) {\r\n        setVariantId(existingQuote.variant_id);\r\n        console.log('üîÑ Variante cargada:', existingQuote.variant_id);\r\n      }\r\n      \r\n      // Cargar condiciones espec√≠ficas si existen\r\n      if (existingQuote.meta && existingQuote.meta.conditions_text) {\r\n        setConditionsText(existingQuote.meta.conditions_text);\r\n        console.log('üìù Condiciones espec√≠ficas cargadas');\r\n      }\r\n      \r\n      console.log('‚úÖ Datos de cotizaci√≥n cargados para edici√≥n');\r\n    } catch (error) {\r\n      console.error('‚ùå Error cargando cotizaci√≥n:', error);\r\n      setError('Error al cargar la cotizaci√≥n existente: ' + (error.message || 'Error desconocido'));\r\n    } finally {\r\n      setLoadingQuote(false);\r\n    }\r\n  };\r\n\r\n  // Cargar clientes al montar el componente\r\n  useEffect(() => {\r\n    fetchClients();\r\n  }, []);\r\n\r\n  // Manejar cliente pre-seleccionado desde la navegaci√≥n\r\n  useEffect(() => {\r\n    if (location.state?.selectedClient && clients.length > 0) {\r\n      const preSelectedClient = location.state.selectedClient;\r\n      console.log('üéØ Cliente pre-seleccionado desde navegaci√≥n:', preSelectedClient);\r\n      \r\n      // Buscar el cliente en la lista cargada\r\n      const foundClient = clients.find(c => c.id === preSelectedClient.id);\r\n      if (foundClient) {\r\n        console.log('‚úÖ Cliente encontrado en la lista, pre-llenando datos');\r\n        setSelectedClient(foundClient);\r\n        setClientSearch(foundClient.name);\r\n        \r\n        // Pre-llenar los campos del cliente\r\n        setClient(prev => ({\r\n          ...prev,\r\n          company_name: foundClient.name || '',\r\n          ruc: foundClient.ruc || foundClient.dni || '',\r\n          contact_name: foundClient.contact_name || '',\r\n          contact_phone: foundClient.phone || '',\r\n          contact_email: foundClient.email || '',\r\n          project_location: foundClient.address || ''\r\n        }));\r\n      } else {\r\n        console.log('‚ö†Ô∏è Cliente no encontrado en la lista, usando datos de navegaci√≥n');\r\n        // Si no se encuentra en la lista, usar los datos de navegaci√≥n\r\n        setSelectedClient(preSelectedClient);\r\n        setClientSearch(preSelectedClient.name);\r\n        \r\n        // Pre-llenar los campos del cliente\r\n        setClient(prev => ({\r\n          ...prev,\r\n          company_name: preSelectedClient.name || '',\r\n          ruc: preSelectedClient.ruc || preSelectedClient.dni || '',\r\n          contact_name: preSelectedClient.contact_name || '',\r\n          contact_phone: preSelectedClient.phone || '',\r\n          contact_email: preSelectedClient.email || '',\r\n          project_location: preSelectedClient.address || ''\r\n        }));\r\n      }\r\n    }\r\n  }, [location.state?.selectedClient, clients]);\r\n\r\n  // Cleanup timeout al desmontar el componente\r\n  useEffect(() => {\r\n    return () => {\r\n      if (searchTimeout) {\r\n        clearTimeout(searchTimeout);\r\n      }\r\n    };\r\n  }, [searchTimeout]);\r\n\r\n  const onSubmit = async (e) => {\r\n    e.preventDefault();\r\n    setSaving(true);\r\n    setError('');\r\n    try {\r\n      if (!client.company_name) {\r\n        throw new Error('Debe ingresar al menos el nombre de la empresa');\r\n      }\r\n      \r\n      let projectId = selection.project?.id || selection.project_id;\r\n      let companyId = selection.company?.id;\r\n      \r\n      // Si no hay empresa seleccionada, crear una autom√°ticamente\r\n      if (!companyId) {\r\n        if (!client.ruc) {\r\n          throw new Error('Debe ingresar el RUC de la empresa');\r\n        }\r\n        \r\n        // Obtener o crear empresa autom√°ticamente\r\n        const newCompany = await getOrCreateCompany({\r\n          type: 'empresa',\r\n          ruc: client.ruc,\r\n          name: client.company_name,\r\n          address: client.project_location || '',\r\n          email: client.contact_email || '',\r\n          phone: client.contact_phone || '',\r\n          contact_name: client.contact_name || '',\r\n          city: client.project_location || '',\r\n          sector: 'servicios'\r\n        });\r\n        \r\n        companyId = newCompany.id;\r\n        console.log('‚úÖ Empresa obtenida/creada:', newCompany);\r\n      }\r\n      \r\n      // Si no hay proyecto seleccionado, crear uno autom√°ticamente\r\n      if (!projectId) {\r\n        // Crear proyecto autom√°ticamente con vendedor asignado\r\n        const newProject = await createProject({\r\n          company_id: companyId,\r\n          name: client.project_name || `Proyecto ${client.company_name}`,\r\n          location: client.project_location || 'Por definir',\r\n          contact_name: client.contact_name,\r\n          contact_phone: client.contact_phone,\r\n          contact_email: client.contact_email,\r\n          status: 'activo',\r\n          priority: 'normal',\r\n          // Asignar autom√°ticamente el vendedor que cre√≥ la cotizaci√≥n\r\n          vendedor_id: currentUser?.id || null,\r\n          // Si es categor√≠a laboratorio, permitir asignar usuario de laboratorio\r\n          requiere_laboratorio: quote.category_main === 'laboratorio',\r\n          laboratorio_status: quote.category_main === 'laboratorio' ? 'pendiente' : 'no_requerido'\r\n        });\r\n        \r\n        projectId = newProject.id;\r\n        console.log('‚úÖ Proyecto creado autom√°ticamente:', newProject);\r\n        console.log('üë§ Vendedor asignado:', currentUser?.name);\r\n      }\r\n      \r\n      const quoteCode = generateQuoteCode();\r\n      \r\n      const payload = {\r\n        project_id: projectId,\r\n        variant_id: variantId || null,\r\n        client_contact: client.contact_name,\r\n        client_email: client.contact_email,\r\n        client_phone: client.contact_phone,\r\n        client_company: client.company_name, // ‚úÖ NUEVO: Raz√≥n social de la empresa\r\n        client_ruc: client.ruc, // ‚úÖ NUEVO: RUC de la empresa\r\n        project_name: client.project_name, // ‚úÖ NUEVO: Nombre del proyecto\r\n        project_location: client.project_location, // ‚úÖ NUEVO: Ubicaci√≥n del proyecto\r\n        request_date: quote.request_date || new Date().toISOString().slice(0, 10), // ‚úÖ NUEVO: Fecha de solicitud\r\n        issue_date: quote.issue_date || new Date().toISOString().slice(0, 10),\r\n        subtotal,\r\n        igv: igvAmount,\r\n        total,\r\n        status: 'borrador',\r\n        reference: quote.reference,\r\n        reference_type: JSON.stringify(quote.reference_type),\r\n        category_main: quote.category_main, // ‚úÖ NUEVO: Categor√≠a principal\r\n        quote_code: quoteCode, // ‚úÖ NUEVO: C√≥digo √∫nico\r\n        meta: JSON.stringify({\r\n          customer: client,\r\n          quote: {\r\n            ...quote,\r\n            request_date: quote.request_date || new Date().toISOString().slice(0, 10),\r\n            delivery_days: quote.delivery_days || 4,\r\n            reference: quote.reference,\r\n            category_main: quote.category_main, // ‚úÖ NUEVO: Categor√≠a en meta\r\n            quote_code: quoteCode // ‚úÖ NUEVO: C√≥digo en meta\r\n          },\r\n          items: items, // Agregar √≠tems al meta\r\n          conditions_text: conditionsText,\r\n          payment_terms: quote.payment_terms,\r\n          file_name: suggestedFileName || `Cotizaci√≥n ${new Date().getFullYear()}-${String(new Date().getMonth() + 1).padStart(2, '0')}${String(new Date().getDate()).padStart(2, '0')} LEM-GEOFAL-${client.company_name?.toUpperCase() || 'CLIENTE'}`,\r\n        })\r\n      };\r\n      \r\n      let saved;\r\n      let successMessage;\r\n      \r\n      if (editQuoteId) {\r\n        // Actualizar cotizaci√≥n existente\r\n        saved = await updateQuote(editQuoteId, payload);\r\n        successMessage = 'Cotizaci√≥n actualizada exitosamente';\r\n        console.log('‚úÖ Cotizaci√≥n actualizada:', saved);\r\n      } else {\r\n        // Crear nueva cotizaci√≥n\r\n        saved = await createQuote(payload);\r\n        successMessage = 'Cotizaci√≥n creada exitosamente';\r\n        console.log('‚úÖ Nueva cotizaci√≥n creada:', saved);\r\n      }\r\n      \r\n      // Mostrar modal de √©xito con los datos\r\n      setSuccessData({\r\n        code: quoteCode,\r\n        category: quote.category_main === 'laboratorio' ? 'üß™ Laboratorio' : '‚öôÔ∏è Ingenier√≠a',\r\n        itemsCount: items.length,\r\n        total: total.toLocaleString(),\r\n        isEdit: !!editQuoteId,\r\n        message: successMessage\r\n      });\r\n      setShowSuccessModal(true);\r\n      setLastSavedId(saved.id);\r\n    } catch (e) {\r\n      console.error('Error:', e);\r\n      setError(e.message || 'Error al crear cotizaci√≥n');\r\n    } finally {\r\n      setSaving(false);\r\n    }\r\n  };\r\n\r\n  const exportFile = async (type) => {\r\n    try {\r\n      const id = lastSavedId;\r\n      if (!id) return alert('Guarde la cotizaci√≥n antes de exportar');\r\n      \r\n      const base = import.meta.env?.VITE_API_URL?.replace(/\\/$/, '') || '';\r\n      const path = `/api/quotes/${id}/export/${type}`;\r\n      const url = base && /\\/api$/i.test(base) ? `${base}${path.replace(/^\\/api/, '')}` : `${base}${path}`;\r\n      \r\n      // Obtener token de autenticaci√≥n\r\n      const token = localStorage.getItem('token');\r\n      if (!token) {\r\n        throw new Error('No se encontr√≥ token de autenticaci√≥n');\r\n      }\r\n      \r\n      // Realizar la petici√≥n con el token\r\n      const response = await fetch(url, {\r\n        method: 'GET',\r\n        headers: {\r\n          'Authorization': `Bearer ${token}`,\r\n          'Content-Type': 'application/json',\r\n        },\r\n      });\r\n      \r\n      if (!response.ok) {\r\n        throw new Error(`Error ${response.status}: ${response.statusText}`);\r\n      }\r\n      \r\n      // Obtener el blob del archivo\r\n      const blob = await response.blob();\r\n      \r\n      // Crear URL temporal y descargar\r\n      const downloadUrl = window.URL.createObjectURL(blob);\r\n      const link = document.createElement('a');\r\n      link.href = downloadUrl;\r\n      link.download = `cotizacion-${id}.${type === 'excel' ? 'xlsx' : 'pdf'}`;\r\n      document.body.appendChild(link);\r\n      link.click();\r\n      document.body.removeChild(link);\r\n      window.URL.revokeObjectURL(downloadUrl);\r\n      \r\n    } catch (e) {\r\n      console.error('Error al exportar:', e);\r\n      alert(`No se pudo exportar: ${e.message}`);\r\n    }\r\n  };\r\n\r\n  const exportDraft = async () => {\r\n    try {\r\n      const id = lastSavedId;\r\n      if (!id) return alert('Guarde la cotizaci√≥n antes de generar el borrador');\r\n      \r\n      const base = import.meta.env?.VITE_API_URL?.replace(/\\/$/, '') || '';\r\n      const path = `/api/quotes/${id}/export/pdf-draft`;\r\n      const url = base && /\\/api$/i.test(base) ? `${base}${path.replace(/^\\/api/, '')}` : `${base}${path}`;\r\n      \r\n      // Obtener token de autenticaci√≥n\r\n      const token = localStorage.getItem('token');\r\n      if (!token) {\r\n        throw new Error('No se encontr√≥ token de autenticaci√≥n');\r\n      }\r\n      \r\n      // Realizar la petici√≥n con el token\r\n      const response = await fetch(url, {\r\n        method: 'GET',\r\n        headers: {\r\n          'Authorization': `Bearer ${token}`,\r\n          'Content-Type': 'application/json',\r\n        },\r\n      });\r\n      \r\n      if (!response.ok) {\r\n        throw new Error(`Error ${response.status}: ${response.statusText}`);\r\n      }\r\n      \r\n      // Obtener el blob del archivo\r\n      const blob = await response.blob();\r\n      \r\n      // Crear URL temporal y descargar\r\n      const downloadUrl = window.URL.createObjectURL(blob);\r\n      const link = document.createElement('a');\r\n      link.href = downloadUrl;\r\n      // Generar nombre en formato COT-DDMMYY-YY\r\n      const now = new Date();\r\n      const day = String(now.getDate()).padStart(2, '0');\r\n      const month = String(now.getMonth() + 1).padStart(2, '0');\r\n      const year = String(now.getFullYear()).slice(-2);\r\n      const fileName = `COT-${day}${month}${year}-${year}.pdf`;\r\n      \r\n      link.download = fileName;\r\n      document.body.appendChild(link);\r\n      link.click();\r\n      document.body.removeChild(link);\r\n      window.URL.revokeObjectURL(downloadUrl);\r\n      \r\n    } catch (e) {\r\n      console.error('Error al exportar borrador:', e);\r\n      alert(`No se pudo exportar borrador: ${e.message}`);\r\n    }\r\n  };\r\n\r\n  // Funci√≥n para detectar proyectos existentes cuando el usuario termina de escribir\r\n  const handleProjectNameChange = (value) => {\r\n    setClient({...client, project_name: value});\r\n    \r\n    // Detectar autom√°ticamente si hay proyectos duplicados\r\n    if (value && value.trim().length >= 3) {\r\n      const companyId = selection.company?.id || selectedClient?.id;\r\n      if (companyId) {\r\n        // Verificar si hay proyectos existentes con este nombre\r\n        checkForDuplicateProjects(value.trim(), companyId);\r\n      }\r\n    }\r\n  };\r\n\r\n  // Funci√≥n para verificar proyectos duplicados autom√°ticamente\r\n  const checkForDuplicateProjects = async (projectName, companyId) => {\r\n    try {\r\n      const projects = await searchProjectsByName(projectName, companyId);\r\n      if (projects && projects.length > 0) {\r\n        // Mostrar advertencia visual\r\n        setDuplicateWarning({\r\n          count: projects.length,\r\n          suggestedName: `${projectName} (${projects.length + 1})`\r\n        });\r\n      } else {\r\n        setDuplicateWarning(null);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error verificando proyectos duplicados:', error);\r\n      setDuplicateWarning(null);\r\n    }\r\n  };\r\n\r\n  // Funci√≥n para verificar proyectos existentes manualmente\r\n  const checkExistingProjects = async () => {\r\n    const projectName = client.project_name?.trim();\r\n    \r\n    if (!projectName || projectName.length < 3) {\r\n      alert('Por favor ingresa al menos 3 caracteres en el nombre del proyecto');\r\n      return;\r\n    }\r\n    \r\n    // Buscar la empresa seleccionada en diferentes lugares\r\n    let companyId = selection.company?.id;\r\n    \r\n    // Si no est√° en selection, buscar en selectedClient\r\n    if (!companyId && selectedClient) {\r\n      companyId = selectedClient.id;\r\n    }\r\n    \r\n    // Si a√∫n no hay companyId, mostrar error m√°s espec√≠fico\r\n    if (!companyId) {\r\n      alert('Por favor selecciona una empresa primero usando el buscador de clientes');\r\n      return;\r\n    }\r\n    \r\n    console.log('üîç Verificando proyectos existentes para:', projectName, 'empresa:', companyId);\r\n    console.log('üîç selectedClient:', selectedClient);\r\n    console.log('üîç selection.company:', selection.company);\r\n    \r\n    setPendingProjectName(projectName);\r\n    setPendingCompanyId(companyId);\r\n    setShowProjectSelectionModal(true);\r\n  };\r\n\r\n  // Funci√≥n para continuar con un proyecto existente\r\n  const handleSelectExistingProject = (project) => {\r\n    console.log('üîÑ Seleccionando proyecto existente:', project);\r\n    \r\n    setSelection(prev => ({\r\n      ...prev,\r\n      project: project,\r\n      project_id: project.id\r\n    }));\r\n    \r\n    // Actualizar los datos del cliente con la informaci√≥n del proyecto\r\n    setClient(prev => ({\r\n      ...prev,\r\n      project_name: project.name,\r\n      project_location: project.location || prev.project_location\r\n    }));\r\n    \r\n    // Limpiar la advertencia de duplicados\r\n    setDuplicateWarning(null);\r\n    \r\n    console.log('‚úÖ Proyecto existente seleccionado y estado actualizado:', project);\r\n  };\r\n\r\n  // Funci√≥n para crear un nuevo proyecto\r\n  const handleCreateNewProject = (differentiatedName = null) => {\r\n    console.log('üîÑ Creando nuevo proyecto:', differentiatedName);\r\n    \r\n    // Limpiar la selecci√≥n de proyecto para que se cree uno nuevo\r\n    setSelection(prev => ({\r\n      ...prev,\r\n      project: null,\r\n      project_id: null\r\n    }));\r\n    \r\n    // Si se proporciona un nombre diferenciado, actualizarlo en el campo\r\n    if (differentiatedName) {\r\n      setClient(prev => ({\r\n        ...prev,\r\n        project_name: differentiatedName\r\n      }));\r\n      console.log('‚úÖ Se crear√° un nuevo proyecto con nombre diferenciado:', differentiatedName);\r\n    } else {\r\n      console.log('‚úÖ Se crear√° un nuevo proyecto con nombre original');\r\n    }\r\n    \r\n    // Limpiar la advertencia de duplicados\r\n    setDuplicateWarning(null);\r\n  };\r\n\r\n  return (\r\n    <ModuloBase \r\n      titulo={editQuoteId ? \"üìù Editar Cotizaci√≥n\" : \"üìã Cotizaci√≥n Inteligente\"} \r\n      descripcion={editQuoteId ? \"Edita una cotizaci√≥n existente con nueva fecha\" : \"Formulario unificado para crear cotizaciones de forma r√°pida e intuitiva\"}\r\n    >\r\n      {loadingQuote && (\r\n        <div className=\"alert alert-info\">\r\n          <div className=\"d-flex align-items-center\">\r\n            <div className=\"spinner-border spinner-border-sm me-2\" role=\"status\">\r\n              <span className=\"visually-hidden\">Cargando...</span>\r\n            </div>\r\n            Cargando cotizaci√≥n existente...\r\n          </div>\r\n        </div>\r\n      )}\r\n      {error && <div className=\"alert alert-danger\">{error}</div>}\r\n\r\n      <form onSubmit={onSubmit} className=\"intelligent-quote-form\">\r\n        <div className=\"alert alert-light border mt-3 intelligent-intro\">\r\n          <h5>üöÄ Flujo Simplificado</h5>\r\n          <p className=\"mb-0\">Completa los datos del cliente, proyecto y cotizaci√≥n. Usa el bot√≥n \"üíæ GUARDAR COTIZACI√ìN\" para guardar tu trabajo.</p>\r\n        </div>\r\n\r\n        {/* Secci√≥n Cliente */}\r\n        <div className=\"intelligent-section\">\r\n          <div className=\"section-header\">\r\n            <span className=\"section-icon\">üè¢</span>\r\n            <h4>CLIENTE</h4>\r\n            <span className=\"section-status\">\r\n              {client.company_name ? '‚úÖ Cliente configurado' : '‚è≥ Pendiente'}\r\n            </span>\r\n          </div>\r\n          <div className=\"section-content\">\r\n            {/* Buscador de Clientes */}\r\n            <div className=\"row g-3 mb-4\">\r\n              <div className=\"col-md-12\">\r\n                <label className=\"form-label\">Buscar Cliente Existente</label>\r\n                <div className=\"position-relative\">\r\n                  <input \r\n                    type=\"text\"\r\n                    className=\"form-control\" \r\n                    value={clientSearch}\r\n                    onChange={(e) => handleClientSearch(e.target.value)}\r\n                    onFocus={() => setShowClientDropdown(true)}\r\n                    placeholder=\"Buscar por nombre, RUC, email o tel√©fono...\"\r\n                  />\r\n                  {selectedClient && (\r\n                    <button\r\n                      type=\"button\"\r\n                      className=\"btn btn-outline-secondary btn-sm position-absolute end-0 top-50 translate-middle-y me-2\"\r\n                      onClick={handleClientClear}\r\n                    >\r\n                      ‚úï\r\n                    </button>\r\n                  )}\r\n                </div>\r\n                {clientSearch && showClientDropdown && filteredClients.length > 0 && (\r\n                  <div className=\"border rounded mt-2\" style={{maxHeight: '200px', overflowY: 'auto'}}>\r\n                    <div className=\"p-2 bg-light border-bottom\">\r\n                      <small className=\"text-muted\">\r\n                        {filteredClients.length} cliente{filteredClients.length !== 1 ? 's' : ''} encontrado{filteredClients.length !== 1 ? 's' : ''}\r\n                      </small>\r\n                    </div>\r\n                    {filteredClients.map((clientItem) => (\r\n                      <div\r\n                        key={clientItem.id}\r\n                        className=\"p-2 border-bottom cursor-pointer hover-bg-light\"\r\n                        onClick={() => handleClientSelect(clientItem)}\r\n                        style={{cursor: 'pointer'}}\r\n                      >\r\n                        <div className=\"fw-bold\">{clientItem.name}</div>\r\n                        <small className=\"text-muted\">\r\n                          RUC: {clientItem.ruc} | Email: {clientItem.email}\r\n                          {clientItem.phone && ` | Tel: ${clientItem.phone}`}\r\n                        </small>\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n                )}\r\n                {clientSearch && showClientDropdown && filteredClients.length === 0 && (\r\n                  <div className=\"border rounded mt-2 p-3 text-center\">\r\n                    <small className=\"text-muted\">\r\n                      No se encontraron clientes con \"{clientSearch}\"\r\n                    </small>\r\n                  </div>\r\n                )}\r\n                {selectedClient && (\r\n                  <div className=\"mt-2 p-2 bg-light rounded\">\r\n                    <strong>Cliente seleccionado:</strong> {selectedClient.name}\r\n                    <br />\r\n                    <small className=\"text-muted\">\r\n                      RUC: {selectedClient.ruc} | Email: {selectedClient.email}\r\n                      {selectedClient.phone && ` | Tel: ${selectedClient.phone}`}\r\n                    </small>\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </div>\r\n\r\n            {/* Campos del Cliente */}\r\n            <div className=\"row g-3\">\r\n              <div className=\"col-md-6\">\r\n                <label className=\"form-label\">Empresa</label>\r\n                <input \r\n                  className=\"form-control\" \r\n                  value={client.company_name} \r\n                  onChange={e => setClient({...client, company_name: e.target.value})} \r\n                  required \r\n                  placeholder=\"Nombre de la empresa\"\r\n                />\r\n              </div>\r\n              <div className=\"col-md-6\">\r\n                <label className=\"form-label\">R.U.C. *</label>\r\n                <input \r\n                  className=\"form-control\" \r\n                  value={client.ruc} \r\n                  onChange={e => setClient({...client, ruc: e.target.value})} \r\n                  placeholder=\"RUC de la empresa\"\r\n                  required\r\n                />\r\n              </div>\r\n              <div className=\"col-md-6\">\r\n                <label className=\"form-label\">Contacto</label>\r\n                <input \r\n                  className=\"form-control\" \r\n                  value={client.contact_name} \r\n                  onChange={e => setClient({...client, contact_name: e.target.value})} \r\n                  required \r\n                  placeholder=\"Nombre del contacto\"\r\n                />\r\n              </div>\r\n              <div className=\"col-md-6\">\r\n                <label className=\"form-label\">Tel√©fono</label>\r\n                <input \r\n                  className=\"form-control\" \r\n                  value={client.contact_phone} \r\n                  onChange={e => setClient({...client, contact_phone: e.target.value})} \r\n                  placeholder=\"Tel√©fono del contacto\"\r\n                />\r\n              </div>\r\n              <div className=\"col-md-12\">\r\n                <label className=\"form-label\">Correo</label>\r\n                <input \r\n                  type=\"email\" \r\n                  className=\"form-control\" \r\n                  value={client.contact_email} \r\n                  onChange={e => setClient({...client, contact_email: e.target.value})} \r\n                  placeholder=\"Correo del contacto\"\r\n                />\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Secci√≥n Proyecto */}\r\n        <div className=\"intelligent-section\">\r\n          <div className=\"section-header\">\r\n            <span className=\"section-icon\">üìÅ</span>\r\n            <h4>PROYECTO</h4>\r\n            <span className=\"section-status\">\r\n              {client.project_name ? '‚úÖ Proyecto configurado' : '‚è≥ Pendiente'}\r\n            </span>\r\n          </div>\r\n          <div className=\"section-content\">\r\n            <div className=\"row g-3\">\r\n              <div className=\"col-md-6\">\r\n                <label className=\"form-label\">\r\n                  Nombre del Proyecto\r\n                  {selection.project && (\r\n                    <span className=\"badge bg-success ms-2\">\r\n                      ‚úÖ Proyecto existente seleccionado\r\n                    </span>\r\n                  )}\r\n                </label>\r\n                <div className=\"input-group\">\r\n                  <input \r\n                    className={`form-control ${duplicateWarning ? 'is-warning' : selection.project ? 'is-success' : ''}`}\r\n                    value={client.project_name} \r\n                    onChange={e => handleProjectNameChange(e.target.value)} \r\n                    required \r\n                    placeholder=\"Nombre del proyecto\"\r\n                  />\r\n                  <button \r\n                    type=\"button\" \r\n                    className=\"btn btn-outline-info\"\r\n                    onClick={checkExistingProjects}\r\n                    title=\"Verificar si ya existen proyectos con este nombre\"\r\n                  >\r\n                    üîç Verificar\r\n                  </button>\r\n                </div>\r\n                {duplicateWarning && (\r\n                  <div className=\"alert alert-warning mt-2 mb-0\">\r\n                    <strong>‚ö†Ô∏è Advertencia:</strong> Se encontraron {duplicateWarning.count} proyecto(s) con este nombre.\r\n                    <br />\r\n                    <small>\r\n                      Sugerencia: <code>{duplicateWarning.suggestedName}</code>\r\n                      <button \r\n                        type=\"button\" \r\n                        className=\"btn btn-sm btn-outline-warning ms-2\"\r\n                        onClick={() => {\r\n                          setClient(prev => ({\r\n                            ...prev,\r\n                            project_name: duplicateWarning.suggestedName\r\n                          }));\r\n                          setDuplicateWarning(null);\r\n                        }}\r\n                      >\r\n                        Usar sugerencia\r\n                      </button>\r\n                    </small>\r\n                  </div>\r\n                )}\r\n                {selection.project && (\r\n                  <div className=\"alert alert-success mt-2 mb-0\">\r\n                    <div className=\"d-flex justify-content-between align-items-start\">\r\n                      <div>\r\n                        <strong>‚úÖ Proyecto existente seleccionado:</strong> {selection.project.name}\r\n                        <br />\r\n                        <small>\r\n                          Ubicaci√≥n: {selection.project.location || 'No especificada'} | \r\n                          Vendedor: {selection.project.vendedor_name || 'No asignado'} |\r\n                          Cotizaciones: {selection.project.quotes_count || 0}\r\n                        </small>\r\n                      </div>\r\n                      <button \r\n                        type=\"button\" \r\n                        className=\"btn btn-sm btn-outline-danger\"\r\n                        onClick={() => {\r\n                          setSelection(prev => ({\r\n                            ...prev,\r\n                            project: null,\r\n                            project_id: null\r\n                          }));\r\n                          console.log('üîÑ Proyecto existente deseleccionado');\r\n                        }}\r\n                        title=\"Deseleccionar proyecto existente\"\r\n                      >\r\n                        ‚úï\r\n                      </button>\r\n                    </div>\r\n                  </div>\r\n                )}\r\n              </div>\r\n              <div className=\"col-md-6\">\r\n                <label className=\"form-label\">Ubicaci√≥n</label>\r\n                <input \r\n                  className=\"form-control\" \r\n                  value={client.project_location} \r\n                  onChange={e => setClient({...client, project_location: e.target.value})} \r\n                  placeholder=\"Ubicaci√≥n del proyecto\"\r\n                />\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Secci√≥n Cotizaci√≥n */}\r\n        <div className=\"intelligent-section\">\r\n          <div className=\"section-header\">\r\n            <span className=\"section-icon\">üìã</span>\r\n            <h4>COTIZACI√ìN</h4>\r\n            <span className=\"section-status\">\r\n              {variantId ? '‚úÖ Variante seleccionada' : '‚è≥ Pendiente'}\r\n            </span>\r\n          </div>\r\n          <div className=\"section-content\">\r\n            <div className=\"row g-3\">\r\n              <div className=\"col-md-6\">\r\n                <label className=\"form-label\">Fecha de Solicitud</label>\r\n                <input \r\n                  type=\"date\" \r\n                  className=\"form-control\" \r\n                  value={quote.request_date} \r\n                  onChange={e => setQuote({...quote, request_date: e.target.value})} \r\n                />\r\n              </div>\r\n              <div className=\"col-md-6\">\r\n                <label className=\"form-label\">Fecha de Emisi√≥n</label>\r\n                <input \r\n                  type=\"date\" \r\n                  className=\"form-control\" \r\n                  value={quote.issue_date} \r\n                  onChange={e => setQuote({...quote, issue_date: e.target.value})} \r\n                />\r\n              </div>\r\n              <div className=\"col-md-6\">\r\n                <label className=\"form-label\">Comercial</label>\r\n                <input \r\n                  className=\"form-control\" \r\n                  value={quote.commercial_name} \r\n                  onChange={e => setQuote({...quote, commercial_name: e.target.value})} \r\n                  placeholder=\"Nombre del comercial\"\r\n                />\r\n              </div>\r\n              <div className=\"col-md-6\">\r\n                <label className=\"form-label\">Tel√©fono Comercial</label>\r\n                <input \r\n                  type=\"tel\" \r\n                  className=\"form-control\" \r\n                  value={quote.commercial_phone} \r\n                  onChange={e => setQuote({...quote, commercial_phone: e.target.value})} \r\n                  required \r\n                  placeholder=\"Tel√©fono del comercial\"\r\n                />\r\n              </div>\r\n              <div className=\"col-md-6\">\r\n                <label className=\"form-label\">Variante</label>\r\n                <select \r\n                  className=\"form-select\" \r\n                  value={variantId} \r\n                  onChange={e => setVariantId(e.target.value)}\r\n                >\r\n                  <option value=\"\">Seleccionar variante</option>\r\n                  {(variants || []).map(v => (\r\n                    <option key={v.id} value={v.id}>{v.code} - {v.title}</option>\r\n                  ))}\r\n                </select>\r\n              </div>\r\n              <div className=\"col-md-6\">\r\n                <label className=\"form-label\">Forma de Pago</label>\r\n                <select \r\n                  className=\"form-select\" \r\n                  value={quote.payment_terms} \r\n                  onChange={e => setQuote({...quote, payment_terms: e.target.value})}\r\n                >\r\n                  <option value=\"adelantado\">Adelantado</option>\r\n                  <option value=\"50%\">Adelanto 50% y saldo previo al informe</option>\r\n                  <option value=\"credito7\">Cr√©dito 7 d√≠as con OS</option>\r\n                  <option value=\"credito15\">Cr√©dito 15 d√≠as con OS</option>\r\n                  <option value=\"credito30\">Cr√©dito 30 d√≠as con OS</option>\r\n                </select>\r\n              </div>\r\n              <div className=\"col-md-6\">\r\n                <label className=\"form-label\">D√≠as H√°biles</label>\r\n                <input \r\n                  type=\"number\" \r\n                  className=\"form-control\" \r\n                  value={quote.delivery_days} \r\n                  onChange={e => setQuote({...quote, delivery_days: parseInt(e.target.value) || 4})} \r\n                  min=\"1\"\r\n                  max=\"30\"\r\n                />\r\n              </div>\r\n              <div className=\"col-md-6\">\r\n                <div className=\"form-check mt-4\">\r\n                  <input \r\n                    className=\"form-check-input\" \r\n                    type=\"checkbox\" \r\n                    id=\"igv\" \r\n                    checked={quote.igv} \r\n                    onChange={e => setQuote({...quote, igv: e.target.checked})}\r\n                  />\r\n                  <label className=\"form-check-label\" htmlFor=\"igv\">\r\n                    Aplicar IGV 18%\r\n                  </label>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Referencia */}\r\n            <div className=\"mt-3\">\r\n              <label className=\"form-label\">Referencia</label>\r\n              <input \r\n                className=\"form-control\" \r\n                value={quote.reference} \r\n                onChange={e => setQuote({...quote, reference: e.target.value})} \r\n                placeholder=\"SEG√öN LO SOLICITADO V√çA CORREO ELECTR√ìNICO / LLAMADA TELEF√ìNICA\"\r\n              />\r\n            </div>\r\n\r\n            {/* Selector de Categor√≠a Principal */}\r\n            <div className=\"mt-4\">\r\n              <label className=\"form-label\">Categor√≠a Principal</label>\r\n              <div className=\"row g-3\">\r\n                <div className=\"col-md-6\">\r\n                  <div className=\"form-check\">\r\n                    <input \r\n                      className=\"form-check-input\" \r\n                      type=\"radio\" \r\n                      name=\"categoryMain\" \r\n                      id=\"laboratorio\" \r\n                      value=\"laboratorio\"\r\n                      checked={quote.category_main === 'laboratorio'}\r\n                      onChange={e => setQuote({...quote, category_main: e.target.value})}\r\n                    />\r\n                    <label className=\"form-check-label\" htmlFor=\"laboratorio\">\r\n                      üß™ Laboratorio\r\n                    </label>\r\n                  </div>\r\n                </div>\r\n                <div className=\"col-md-6\">\r\n                  <div className=\"form-check\">\r\n                    <input \r\n                      className=\"form-check-input\" \r\n                      type=\"radio\" \r\n                      name=\"categoryMain\" \r\n                      id=\"ingenieria\" \r\n                      value=\"ingenieria\"\r\n                      checked={quote.category_main === 'ingenieria'}\r\n                      onChange={e => setQuote({...quote, category_main: e.target.value})}\r\n                    />\r\n                    <label className=\"form-check-label\" htmlFor=\"ingenieria\">\r\n                      ‚öôÔ∏è Ingenier√≠a\r\n                    </label>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n              <div className=\"alert alert-info mt-2\">\r\n                <small>\r\n                  <strong>üí° Importante:</strong> Selecciona la categor√≠a principal para que el sistema pueda categorizar autom√°ticamente los √≠tems y alimentar el embudo de ventas.\r\n                </small>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Condiciones espec√≠ficas */}\r\n            <div className=\"mt-3\">\r\n              <label className=\"form-label\">Condiciones Espec√≠ficas</label>\r\n              <textarea\r\n                className=\"form-control\"\r\n                rows={4}\r\n                placeholder=\"Las condiciones se auto-completan seg√∫n la variante seleccionada\"\r\n                value={conditionsText}\r\n                onChange={e => setConditionsText(e.target.value)}\r\n              />\r\n            </div>\r\n\r\n            {/* √çtems */}\r\n            <div className=\"mt-4\">\r\n              <label className=\"form-label\">√çtems de la Cotizaci√≥n</label>\r\n              <div className=\"table-responsive\">\r\n                <table className=\"table table-bordered table-striped\">\r\n                  <thead className=\"table-dark\">\r\n                    <tr>\r\n                      <th style={{width: '10%'}}>C√≥digo</th>\r\n                      <th style={{width: '35%'}}>Descripci√≥n</th>\r\n                      <th style={{width: '15%'}}>Norma</th>\r\n                      <th style={{width: '12%'}}>Precio Unit.</th>\r\n                      <th style={{width: '10%'}}>Cantidad</th>\r\n                      <th style={{width: '12%'}}>Parcial</th>\r\n                      <th style={{width: '6%'}}></th>\r\n                    </tr>\r\n                  </thead>\r\n                  <tbody>\r\n                    {items.map((it, idx) => (\r\n                      <tr key={idx}>\r\n                        <td>\r\n                          <input \r\n                            className=\"form-control form-control-sm\" \r\n                            value={it.code} \r\n                            onChange={e => onChangeItem(idx, { code: e.target.value })}\r\n                            placeholder=\"C√≥digo\"\r\n                          />\r\n                        </td>\r\n                        <td>\r\n                          <SubserviceAutocompleteFinal\r\n                            value={it.description}\r\n                            onChange={(value) => onChangeItem(idx, { description: value })}\r\n                            onSelect={(subservice) => {\r\n                              if (subservice) {\r\n                                onChangeItem(idx, {\r\n                                  code: subservice.codigo,\r\n                                  description: subservice.descripcion,\r\n                                  norm: subservice.norma,\r\n                                  unit_price: subservice.precio\r\n                                });\r\n                              }\r\n                            }}\r\n                            placeholder=\"Buscar servicio...\"\r\n                            size=\"sm\"\r\n                          />\r\n                        </td>\r\n                        <td>\r\n                          <input \r\n                            className=\"form-control form-control-sm\" \r\n                            value={it.norm} \r\n                            onChange={e => onChangeItem(idx, { norm: e.target.value })}\r\n                            placeholder=\"Norma\"\r\n                          />\r\n                        </td>\r\n                        <td>\r\n                          <input \r\n                            type=\"number\" \r\n                            step=\"0.01\" \r\n                            className=\"form-control form-control-sm\" \r\n                            value={it.unit_price} \r\n                            onChange={e => onChangeItem(idx, { unit_price: e.target.value })}\r\n                            placeholder=\"0.00\"\r\n                          />\r\n                        </td>\r\n                        <td>\r\n                          <input \r\n                            type=\"number\" \r\n                            className=\"form-control form-control-sm\" \r\n                            value={it.quantity} \r\n                            onChange={e => onChangeItem(idx, { quantity: e.target.value })}\r\n                            min=\"1\"\r\n                          />\r\n                        </td>\r\n                        <td>\r\n                          <span className=\"fw-bold text-success\">S/ {computePartial(it).toFixed(2)}</span>\r\n                        </td>\r\n                        <td>\r\n                          <button \r\n                            type=\"button\" \r\n                            className=\"btn btn-sm btn-outline-danger\" \r\n                            onClick={() => onRemoveItem(idx)} \r\n                            disabled={items.length === 1}\r\n                            title=\"Eliminar √≠tem\"\r\n                          >\r\n                            üóëÔ∏è\r\n                          </button>\r\n                        </td>\r\n                      </tr>\r\n                    ))}\r\n                  </tbody>\r\n                </table>\r\n              </div>\r\n              <div className=\"d-flex justify-content-between align-items-center mt-3\">\r\n                <button type=\"button\" className=\"btn btn-outline-primary\" onClick={onAddItem}>\r\n                  ‚ûï Agregar √≠tem\r\n                </button>\r\n                <div className=\"text-end\">\r\n                  <div className=\"h6 mb-1\">Subtotal: <span className=\"text-primary\">S/ {subtotal.toFixed(2)}</span></div>\r\n                  <div className=\"h6 mb-1\">IGV 18%: <span className=\"text-primary\">S/ {igvAmount.toFixed(2)}</span></div>\r\n                  <div className=\"h5 mb-0\">Total: <span className=\"text-success fw-bold\">S/ {total.toFixed(2)}</span></div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n          </div>\r\n        </div>\r\n\r\n        {/* Botones de acci√≥n */}\r\n        <div className=\"intelligent-actions\">\r\n          <button \r\n            type=\"submit\" \r\n            className=\"btn btn-success btn-lg\"\r\n            disabled={saving || !client.company_name || !client.ruc}\r\n          >\r\n            {saving ? (editQuoteId ? 'üîÑ Actualizando...' : 'üíæ Guardando...') : (editQuoteId ? 'üîÑ GUARDAR CAMBIOS' : 'üíæ CREAR COTIZACI√ìN')}\r\n          </button>\r\n          <button \r\n            type=\"button\" \r\n            className=\"btn btn-outline-warning btn-lg\"\r\n            onClick={exportDraft}\r\n            disabled={!lastSavedId}\r\n          >\r\n            üìÑ Generar cotizaci√≥n\r\n          </button>\r\n        </div>\r\n      </form>\r\n      \r\n      {/* Modal de √©xito */}\r\n      <SuccessModal\r\n        show={showSuccessModal}\r\n        onHide={() => setShowSuccessModal(false)}\r\n        data={successData}\r\n        buttonText=\"Aceptar\"\r\n      />\r\n\r\n      {/* Modal de selecci√≥n de proyecto */}\r\n      <ProjectSelectionModal\r\n        show={showProjectSelectionModal}\r\n        onHide={() => setShowProjectSelectionModal(false)}\r\n        projectName={pendingProjectName}\r\n        companyId={pendingCompanyId}\r\n        onSelectExisting={handleSelectExistingProject}\r\n        onCreateNew={handleCreateNewProject}\r\n      />\r\n    </ModuloBase>\r\n  );\r\n}\r\n"],"names":["SubserviceAutocompleteFinal","value","onChange","onSelect","placeholder","disabled","size","searchTerm","setSearchTerm","useState","isOpen","setIsOpen","dropdownPosition","setDropdownPosition","inputRef","useRef","dropdownRef","debouncedTerm","setDebouncedTerm","useEffect","timer","data","isLoading","useQuery","searchSubservices","results","updatePosition","rect","handleScroll","handleResize","handleInputChange","e","newValue","handleFocus","handleItemSelect","item","handleClear","handleClickOutside","formatPrice","precio","getServiceColor","serviceName","dropdownContent","jsxs","jsx","Spinner","Badge","FiFileText","FiDollarSign","Fragment","Form","FiX","FiSearch","ReactDOM","ProjectSelectionModal","show","onHide","projectName","companyId","onSelectExisting","onCreateNew","existingProjects","setExistingProjects","loading","setLoading","error","setError","searchExistingProjects","projects","searchProjectsByName","err","handleSelectExisting","project","handleCreateNew","handleCreateDifferentiated","nextNumber","differentiatedName","handleEditProject","newName","formatDate","dateString","Modal","FiFolder","Alert","ListGroup","FiMapPin","FiUser","FiCalendar","Button","FiEdit3","FiPlus","emptyClient","emptyQuote","emptyItem","computePartial","u","q","generateQuoteCode","year","month","day","random","normalizeKey","s","VARIANT_TEXTS","getVariantText","v","t","entry","k","CotizacionInteligente","searchParams","useSearchParams","location","useLocation","editQuoteId","variants","setVariants","variantId","setVariantId","client","setClient","selection","setSelection","quote","setQuote","items","setItems","saving","setSaving","conditionsText","setConditionsText","lastSavedId","setLastSavedId","allProjects","setAllProjects","projectSuggestions","setProjectSuggestions","showProjectSuggestions","setShowProjectSuggestions","suggestedFileName","setSuggestedFileName","loadingQuote","setLoadingQuote","currentUser","setCurrentUser","clients","setClients","filteredClients","setFilteredClients","clientSearch","setClientSearch","selectedClient","setSelectedClient","showClientDropdown","setShowClientDropdown","showSuccessModal","setShowSuccessModal","successData","setSuccessData","showProjectSelectionModal","setShowProjectSelectionModal","pendingProjectName","setPendingProjectName","pendingCompanyId","setPendingCompanyId","searchTimeout","setSearchTimeout","duplicateWarning","setDuplicateWarning","fallback","listProjects","prev","_a","_b","token","response","x","c","extra","subtotal","useMemo","acc","it","igvAmount","total","onAddItem","onRemoveItem","idx","_","i","onChangeItem","patch","fetchClients","clientsData","listCompanies","clientsList","handleClientSearch","searchLower","filtered","nameMatch","rucMatch","emailMatch","phoneMatch","nameWordsMatch","word","match","handleClientSelect","handleClientClear","loadExistingQuote","quoteId","existingQuote","getQuote","companyName","contactName","rucToSearch","foundClient","simulatedClient","_d","_c","itemsToLoad","preSelectedClient","onSubmit","projectId","newCompany","getOrCreateCompany","newProject","createProject","quoteCode","payload","saved","successMessage","updateQuote","createQuote","exportDraft","id","base","path","url","blob","downloadUrl","link","now","fileName","handleProjectNameChange","checkForDuplicateProjects","checkExistingProjects","handleSelectExistingProject","handleCreateNewProject","ModuloBase","clientItem","subservice","SuccessModal"],"mappings":"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"}