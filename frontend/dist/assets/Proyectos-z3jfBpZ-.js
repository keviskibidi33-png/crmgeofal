import{r as i,u as ea,P as aa,E as sa,c as ue,G as b,j as e,H as ra,h as y,n as m,m as P,B as h,I as oa,d as ia,Q as he,S as ta,K as ca,k as xe,O as pe,l as ge,f as la,T as be,v as na,U as B,t as je,p as da,M as ma}from"./index-VjS0hY4d.js";import{P as ua}from"./PageHeader-s2EwJBI9.js";import{D as ha}from"./DataTable-DC-fV_34.js";import{M as ve}from"./ModalForm-Ccb1MyAk.js";import{S as A}from"./StatsCard-CQWt6EQk.js";import{d as xa,c as pa,u as ga,a as ba,b as ja,e as va,f as ya,l as Na,g as fa}from"./projects-x-AZJvXx.js";import{l as _a,a as Ca}from"./categories-CYZIxNuw.js";import{l as Q,u as Sa,d as Ea,a as qa}from"./attachments-B0ysfLLF.js";import{R as ka,C as w}from"./Row-Ra1wnXQ8.js";import{C as V}from"./Card-Bl_n2eis.js";import{T as Pa,a as j}from"./Tabs-pEHNsDl3.js";import"./InputGroup-D28bQjEt.js";import"./Form-f81hzvzI.js";import"./ElementChildren-DGNtIhpN.js";import"./Table-BrpyFtCQ.js";/* empty css                     */import"./Modal-Dz5NhyjX.js";import"./Spinner-CSZmUozg.js";const K={company_id:"",name:"",location:"",vendedor_id:"",laboratorio_id:"",requiere_laboratorio:!1,requiere_ingenieria:!1,requiere_consultoria:!1,requiere_capacitacion:!1,requiere_auditoria:!1,contact_name:"",contact_phone:"",contact_email:"",queries:"",priority:"normal",marked:!1,category_id:"",subcategory_id:"",category_name:"",subcategory_name:""};function ss(){var le,ne,de,me;const[ye,C]=i.useState(!1),[x,S]=i.useState(null),[Aa,Ne]=i.useState(null),[wa,Fa]=i.useState(!1),[Ma,Da]=i.useState(!1),[Ia,Ta]=i.useState(!1),[O,F]=i.useState(!1),[o,v]=i.useState(null),[fe,H]=i.useState("view"),[r,l]=i.useState({}),[_e,M]=i.useState(!1),[Ce,Se]=i.useState(""),[X,Ee]=i.useState("success"),[qe,ke]=i.useState([]),[Pe,W]=i.useState([]),[E,Ae]=i.useState(""),[D,I]=i.useState([]),[J,T]=i.useState(!1),[g,Y]=i.useState(null),[z,L]=i.useState(1),[Z,we]=i.useState(""),[ee,Fe]=i.useState(""),[ae,Me]=i.useState(""),[se,De]=i.useState(""),[re,Ie]=i.useState(""),[Te,oe]=i.useState(!1);ea();const u=(le=aa().state)==null?void 0:le.selectedClient,q=sa(),{data:d,isLoading:ie,refetch:ze}=ue(["projects",z,Z,ee,ae,se,re],()=>Na({page:z,limit:20,search:Z,status:ee,company_id:ae,project_type:se,priority:re}),{keepPreviousData:!0,refetchOnWindowFocus:!1,refetchOnMount:!1,staleTime:3e4,cacheTime:3e5,retry:2,retryDelay:1e3}),{data:p,isLoading:k}=ue(["projectStats"],fa,{refetchOnWindowFocus:!1,refetchOnMount:!1,staleTime:6e4,cacheTime:3e5,retry:1,onSuccess:a=>{console.log("üìä Frontend - Estad√≠sticas recibidas:",a),console.log("üìä Frontend - alta_prioridad:",a==null?void 0:a.alta_prioridad)}});i.useEffect(()=>{(async()=>{try{const s=await _a();ke(s)}catch(s){console.error("Error al cargar categor√≠as:",s)}})()},[]),i.useEffect(()=>{(async()=>{if(E)try{const s=await Ca(E);W(s)}catch(s){console.error("Error al cargar subcategor√≠as:",s)}else W([])})()},[E]),i.useEffect(()=>{(async()=>{if(o!=null&&o.id)try{const s=await Q(o.id);I(s)}catch(s){console.error("Error al cargar adjuntos:",s)}})()},[o==null?void 0:o.id,O]);const N=a=>{q.invalidateQueries("projects"),q.invalidateQueries("projectStats"),C(!1),S(null),Ne(null)},t=(a,s="success")=>{Se(a),Ee(s),M(!0),setTimeout(()=>{M(!1)},5e3)},Le=a=>{console.log("üîç handleSearch - B√∫squeda:",a),we(a),L(1),oe(!0),setTimeout(()=>oe(!1),1e3)},Ge=a=>{console.log("üîç handleFilter - Filtros:",a),Fe(a.status||""),Me(a.company_id||""),De(a.project_type||""),Ie(a.priority||""),L(1)},Re=a=>{const s=a.target.files[0];s&&Y(s)},Ue=async()=>{if(!g||!(o!=null&&o.id)){t("‚ùå Por favor selecciona un archivo","danger");return}T(!0);try{const a=new FormData;a.append("file",g),a.append("description",`Archivo subido: ${g.name}`),await Sa(o.id,a);const s=await Q(o.id);I(s),Y(null),T(!1),t("‚úÖ Archivo subido correctamente","success")}catch(a){console.error("Error al subir archivo:",a),T(!1),t("‚ùå Error al subir archivo","danger")}},$e=async a=>{try{await Ea(a),t("‚úÖ Archivo descargado correctamente","success")}catch(s){console.error("Error al descargar archivo:",s),t("‚ùå Error al descargar archivo","danger")}},Be=async a=>{if(window.confirm("¬øEst√°s seguro de que quieres eliminar este archivo?"))try{await qa(a);const s=await Q(o.id);I(s),t("‚úÖ Archivo eliminado correctamente","success")}catch(s){console.error("Error al eliminar archivo:",s),t("‚ùå Error al eliminar archivo","danger")}},Qe=[{title:"Por Estado",options:[{label:"Pendientes",filter:{status:"pendiente"}},{label:"Activos",filter:{status:"activo"}},{label:"Completados",filter:{status:"completado"}},{label:"Cancelados",filter:{status:"cancelado"}}]},{title:"Por Prioridad",options:[{label:"üî¥ Urgente",filter:{priority:"urgent"}},{label:"üü† Alta",filter:{priority:"high"}},{label:"üîµ Activo",filter:{priority:"active"}},{label:"üü¢ Normal",filter:{priority:"normal"}},{label:"üîµ Baja",filter:{priority:"low"}}]},{title:"Por Tipo de Proyecto",options:[{label:"An√°lisis de Suelos",filter:{project_type:"An√°lisis de Suelos"}},{label:"Estudio Geot√©cnico",filter:{project_type:"Estudio Geot√©cnico"}},{label:"Evaluaci√≥n Ambiental",filter:{project_type:"Evaluaci√≥n Ambiental"}},{label:"Control de Calidad",filter:{project_type:"Control de Calidad"}},{label:"An√°lisis de Agua",filter:{project_type:"An√°lisis de Agua"}},{label:"Estudio de Impacto",filter:{project_type:"Estudio de Impacto"}},{label:"An√°lisis Qu√≠mico",filter:{project_type:"An√°lisis Qu√≠mico"}},{label:"Pruebas de Laboratorio",filter:{project_type:"Pruebas de Laboratorio"}},{label:"Inspecci√≥n T√©cnica",filter:{project_type:"Inspecci√≥n T√©cnica"}},{label:"Certificaci√≥n de Materiales",filter:{project_type:"Certificaci√≥n de Materiales"}}]}],te=b(pa,{onSuccess:()=>N(),onError:a=>console.error("Error creating project:",a)}),f=b(({id:a,data:s})=>ga(a,s),{onSuccess:a=>{console.log("‚úÖ updateMutation - Success:",a),v(a),l(a),t("‚úÖ Proyecto actualizado exitosamente!","success"),q.invalidateQueries("projects")},onError:a=>{console.error("‚ùå updateMutation - Error:",a),t("‚ùå Error al actualizar proyecto","danger")}}),Ve=b(xa,{onSuccess:()=>N(),onError:a=>console.error("Error deleting project:",a)}),G=b(({id:a,...s})=>ba(a,s),{onSuccess:a=>{v(a),l(a),N()},onError:a=>console.error("Error updating project status:",a)}),R=b(({id:a,...s})=>ja(a,s),{onSuccess:a=>{console.log("‚úÖ updateCategoriesMutation - Success:",a),v(a),l(a),t("‚úÖ Categor√≠as guardadas correctamente!","success"),q.invalidateQueries("projects")},onError:a=>{console.error("‚ùå updateCategoriesMutation - Error:",a),t("‚ùå Error al guardar categor√≠as","danger")}}),U=b(({id:a,...s})=>va(a,s),{onSuccess:a=>{v(a),l(a),N()},onError:a=>console.error("Error updating project queries:",a)}),$=b(({id:a,...s})=>ya(a,s),{onSuccess:a=>{v(a),l(a),N()},onError:a=>console.error("Error updating project mark:",a)}),Ke=()=>{const a=u?{...K,company_id:u.id,name:`${u.sector||"Proyecto"} - ${u.name}`,location:u.city||"",contact_name:u.contact_name||"",contact_phone:u.phone||"",contact_email:u.email||""}:K;S(a),C(!0)},Oe=a=>{S(a),C(!0)},ce=a=>{window.confirm(`¬øEst√°s seguro de que quieres eliminar el proyecto "${a.name}"?`)&&Ve.mutate(a.id)},He=a=>{console.log("üîç handleViewProject - Project recibido:",a),console.log("üîç handleViewProject - Project.id:",a==null?void 0:a.id),console.log("üîç handleViewProject - Type of project.id:",typeof(a==null?void 0:a.id)),v(a);const s={...a,requiere_laboratorio:a.requiere_laboratorio||!1,requiere_ingenieria:a.requiere_ingenieria||!1,requiere_consultoria:a.requiere_consultoria||!1,requiere_capacitacion:a.requiere_capacitacion||!1,requiere_auditoria:a.requiere_auditoria||!1,marked:a.marked||!1,priority:a.priority||"normal",queries:a.queries||"",contact_name:a.contact_name||"",contact_phone:a.contact_phone||"",contact_email:a.contact_email||"",category_id:a.category_id||"",subcategory_id:a.subcategory_id||"",category_name:a.category_name||"",subcategory_name:a.subcategory_name||""};console.log("üîç handleViewProject - editingData inicializado:",s),l(s),H("view"),F(!0)},Xe=async a=>{x.id?await f.mutateAsync({id:x.id,...a}):await te.mutateAsync(a)},We=a=>{const c={activo:{bg:"success",text:"Activo"},pendiente:{bg:"warning",text:"Pendiente"},completado:{bg:"primary",text:"Completado"},cancelado:{bg:"danger",text:"Cancelado"}}[a]||{bg:"secondary",text:a};return e.jsx(m,{bg:c.bg,className:"status-badge",children:c.text})},Je=[{header:"ID",accessor:"id",width:"80px"},{header:"Proyecto",accessor:"name",render:(a,s)=>e.jsxs("div",{children:[e.jsx("div",{className:"fw-medium",children:s.name}),s.location&&e.jsxs("small",{className:"text-muted",children:[e.jsx(ma,{size:12,className:"me-1"}),s.location]})]})},{header:"Tipo de Proyecto",accessor:"project_type",render:(a,s)=>{const c=s.project_type||"General";let n="secondary";switch(c){case"An√°lisis de Suelos":n="success";break;case"Estudio Geot√©cnico":n="primary";break;case"Evaluaci√≥n Ambiental":n="info";break;case"Control de Calidad":n="warning";break;case"An√°lisis de Agua":n="info";break;case"Estudio de Impacto":n="danger";break;case"An√°lisis Qu√≠mico":n="primary";break;case"Pruebas de Laboratorio":n="success";break;case"Inspecci√≥n T√©cnica":n="warning";break;case"Certificaci√≥n de Materiales":n="info";break;default:n="secondary"}return e.jsx(m,{bg:n,className:"px-2 py-1",children:c})}},{header:"Categor√≠a",accessor:"category_name",render:(a,s)=>e.jsxs("div",{children:[s.category_name&&e.jsx(m,{bg:"primary",className:"px-2 py-1 mb-1 d-block",children:s.category_name}),s.subcategory_name&&e.jsx(m,{bg:"secondary",className:"px-2 py-1 d-block",children:s.subcategory_name}),!s.category_name&&e.jsx("span",{className:"text-muted",children:"Sin categor√≠a"})]})},{header:"Empresa",accessor:"company_name",render:(a,s)=>e.jsxs("div",{children:[e.jsx("div",{className:"fw-medium",children:s.company_name||"Sin empresa"}),s.company_ruc&&e.jsxs("small",{className:"text-muted",children:["RUC: ",s.company_ruc]})]})},{header:"Estado",accessor:"status",render:a=>We(a||"activo")},{header:"Servicios Requeridos",accessor:"services",render:(a,s)=>e.jsxs("div",{className:"d-flex flex-wrap gap-1",children:[s.requiere_laboratorio&&e.jsxs(m,{bg:"info",className:"px-2 py-1",children:[e.jsx(y,{size:12,className:"me-1"}),"Laboratorio"]}),s.requiere_ingenieria&&e.jsxs(m,{bg:"primary",className:"px-2 py-1",children:[e.jsx(P,{size:12,className:"me-1"}),"Ingenier√≠a"]}),!s.requiere_laboratorio&&!s.requiere_ingenieria&&e.jsx(m,{bg:"secondary",className:"px-2 py-1",children:"Sin servicios"})]})},{header:"Prioridad",accessor:"priority",render:(a,s)=>{const n=(Ze=>{switch(Ze){case"urgent":return{emoji:"üî¥",text:"Urgente",color:"text-danger",bgColor:"bg-danger"};case"high":return{emoji:"üü†",text:"Alta",color:"text-warning",bgColor:"bg-warning"};case"active":return{emoji:"üîµ",text:"Activo",color:"text-info",bgColor:"bg-info"};case"low":return{emoji:"üîµ",text:"Baja",color:"text-primary",bgColor:"bg-primary"};case"normal":default:return{emoji:"üü¢",text:"Normal",color:"text-success",bgColor:"bg-success"}}})(s.priority);return e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("span",{className:"me-2",style:{fontSize:"1.2em"},children:n.emoji}),e.jsx("span",{className:`small ${n.color} fw-medium`,children:n.text}),(s.priority==="urgent"||s.priority==="high")&&s.requiere_laboratorio&&e.jsx("span",{className:"ms-2",title:"Requiere atenci√≥n prioritaria del laboratorio",children:e.jsx(he,{className:"text-warning",size:14})})]})}},{header:"Contacto",accessor:"contacto",render:(a,s)=>e.jsxs("div",{className:"small",children:[s.contact_name&&e.jsx("div",{children:e.jsx("strong",{children:s.contact_name})}),s.contact_phone&&e.jsx("div",{className:"text-muted",children:s.contact_phone}),s.contact_email&&e.jsx("div",{className:"text-muted",children:s.contact_email}),!s.contact_name&&!s.contact_phone&&!s.contact_email&&e.jsx("span",{className:"text-muted",children:"Sin contacto"})]})},{header:"Asignado a",accessor:"vendedor_name",render:(a,s)=>e.jsxs("div",{children:[s.vendedor_name&&e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx(P,{size:14,className:"me-1 text-muted"}),e.jsx("span",{children:s.vendedor_name})]}),s.laboratorio_name&&e.jsxs("div",{className:"d-flex align-items-center mt-1",children:[e.jsx(y,{size:14,className:"me-1 text-muted"}),e.jsx("span",{className:"small text-muted",children:s.laboratorio_name})]})]})},{header:"Fecha Creaci√≥n",accessor:"created_at",type:"date"}],Ye=[{name:"company_id",label:"Empresa/Cliente",type:"select",required:!0,options:((ne=d==null?void 0:d.companies)==null?void 0:ne.map(a=>({value:a.id,label:`${a.name} (${a.ruc||a.dni||"Sin RUC/DNI"})`})))||[],description:"Selecciona un cliente existente o crea uno nuevo desde el m√≥dulo de clientes"},{name:"name",label:"Nombre del Proyecto",type:"text",required:!0,placeholder:"Ingresa el nombre del proyecto"},{name:"location",label:"Ubicaci√≥n del Proyecto",type:"text",placeholder:"Ingresa la ubicaci√≥n del proyecto",required:!0},{name:"category_id",label:"Categor√≠a del Proyecto",type:"select",options:qe.map(a=>({value:a.id,label:a.name})),description:"Selecciona la categor√≠a principal del proyecto",onChange:a=>{Ae(a),S(s=>({...s,subcategory_id:"",subcategory_name:""}))}},{name:"subcategory_id",label:"Subcategor√≠a del Proyecto",type:"select",options:Pe.map(a=>({value:a.id,label:a.name})),description:"Selecciona la subcategor√≠a espec√≠fica del proyecto",disabled:!E},{name:"contact_name",label:"Persona de Contacto",type:"text",placeholder:"Nombre de la persona con quien negociar",description:"Persona responsable del proyecto en el cliente"},{name:"contact_phone",label:"Tel√©fono de Contacto",type:"text",placeholder:"Tel√©fono para comunicaci√≥n directa",description:"N√∫mero para llamadas urgentes o seguimiento"},{name:"contact_email",label:"Email de Contacto",type:"email",placeholder:"Email para comunicaci√≥n",description:"Email para env√≠o de reportes y documentos"},{name:"requiere_laboratorio",label:"Requiere Laboratorio",type:"checkbox",description:"Marcar si el proyecto necesita servicios de laboratorio"},{name:"requiere_ingenieria",label:"Requiere Ingenier√≠a",type:"checkbox",description:"Marcar si el proyecto necesita servicios de ingenier√≠a"},{name:"requiere_consultoria",label:"Requiere Consultor√≠a",type:"checkbox",description:"Marcar si el proyecto necesita servicios de consultor√≠a"},{name:"requiere_capacitacion",label:"Requiere Capacitaci√≥n",type:"checkbox",description:"Marcar si el proyecto necesita servicios de capacitaci√≥n"},{name:"requiere_auditoria",label:"Requiere Auditor√≠a",type:"checkbox",description:"Marcar si el proyecto necesita servicios de auditor√≠a"},{name:"queries",label:"Consultas del Cliente",type:"textarea",placeholder:"Ingresa las consultas o dudas del cliente...",description:"Preguntas o dudas espec√≠ficas del cliente sobre el proyecto"},{name:"priority",label:"Prioridad del Proyecto",type:"select",options:[{value:"low",label:"Baja"},{value:"normal",label:"Normal"},{value:"high",label:"Alta"},{value:"urgent",label:"Urgente"}],description:"Nivel de prioridad para la ejecuci√≥n del proyecto"},{name:"vendedor_id",label:"Vendedor Asignado",type:"select",options:((de=d==null?void 0:d.users)==null?void 0:de.filter(a=>["vendedor_comercial","jefa_comercial"].includes(a.role)).map(a=>({value:a.id,label:`${a.name} ${a.apellido}`})))||[]},{name:"laboratorio_id",label:"Responsable de Laboratorio",type:"select",options:((me=d==null?void 0:d.users)==null?void 0:me.filter(a=>["jefe_laboratorio","usuario_laboratorio","laboratorio"].includes(a.role)).map(a=>({value:a.id,label:`${a.name} ${a.apellido}`})))||[]},{name:"requiere_laboratorio",label:"Requiere Servicios de Laboratorio",type:"checkbox",description:"Marcar si el proyecto necesita an√°lisis o pruebas de laboratorio"},{name:"requiere_ingenieria",label:"Requiere Servicios de Ingenier√≠a",type:"checkbox",description:"Marcar si el proyecto necesita estudios o consultor√≠a de ingenier√≠a"}],_=i.useMemo(()=>{if(p)return console.log("üìä Stats - Usando estad√≠sticas reales del backend:",p),{total:p.total||0,activos:p.activos||0,completados:p.completados||0,pendientes:p.pendientes||0,cancelados:p.cancelados||0,alta_prioridad:p.alta_prioridad||0};const a=(d==null?void 0:d.data)||[];return console.log("üìä Stats - Fallback: calculando desde p√°gina actual:",a),{total:a.length,activos:a.filter(s=>s.status==="activo").length,completados:a.filter(s=>s.status==="completado").length,pendientes:a.filter(s=>s.status==="pendiente").length,cancelados:a.filter(s=>s.status==="cancelado").length,alta_prioridad:a.filter(s=>s.priority==="urgent"||s.priority==="high").length}},[p,d]);return e.jsxs(e.Fragment,{children:[e.jsx(ra,{fluid:!0,className:"py-4",children:e.jsxs("div",{className:"fade-in",children:[e.jsx(ua,{title:"Gesti√≥n de Proyectos",subtitle:u?`Crear proyecto para: ${u.name}`:"Crear, editar y gestionar proyectos del sistema",icon:y,actions:e.jsxs("div",{className:"d-flex gap-2",children:[u&&e.jsxs(m,{bg:"info",className:"px-3 py-2 d-flex align-items-center",children:[e.jsx(P,{className:"me-1"}),"Cliente: ",u.name]}),e.jsxs(h,{variant:"primary",onClick:Ke,children:[e.jsx(oa,{className:"me-2"}),u?"Crear Proyecto":"Nuevo Proyecto"]})]})}),e.jsxs(ka,{className:"g-4 mb-4",children:[e.jsx(w,{md:6,lg:3,children:e.jsx(A,{title:"Total Proyectos",value:_.total,icon:y,color:"primary",subtitle:"Proyectos registrados",loading:k})}),e.jsx(w,{md:6,lg:3,children:e.jsx(A,{title:"Proyectos Activos",value:_.activos,icon:ia,color:"success",subtitle:"En desarrollo",loading:k})}),e.jsx(w,{md:6,lg:3,children:e.jsx(A,{title:"Alta Prioridad",value:_.alta_prioridad||0,icon:he,color:"danger",subtitle:"üî¥ Urgente + üü† Alta",loading:k})}),e.jsx(w,{md:6,lg:3,children:e.jsx(A,{title:"Pendientes",value:_.pendientes,icon:ta,color:"warning",subtitle:"Por iniciar",loading:k})})]}),e.jsxs(V,{className:"shadow-sm border-0",children:[e.jsx(V.Header,{className:"bg-white border-bottom",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("h5",{className:"mb-0",children:[e.jsx(y,{className:"me-2 text-primary"}),"Lista de Proyectos"]}),e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx(h,{variant:"outline-secondary",size:"sm",onClick:()=>ze(),className:"d-flex align-items-center",title:"Actualizar datos",children:e.jsx(ca,{className:`${ie?"spinning":""}`})}),e.jsxs(m,{bg:"light",text:"dark",className:"px-3 py-2",children:[_.total," proyectos"]})]})]})}),e.jsx(V.Body,{className:"p-0",children:e.jsx(ha,{data:(d==null?void 0:d.data)||[],columns:Je,loading:ie||Te,onEdit:Oe,onDelete:ce,actions:[{label:"Gestionar",icon:xe,onClick:He,variant:"outline-primary"},{label:"Eliminar",icon:pe,onClick:ce,variant:"outline-danger"}],emptyMessage:"No hay proyectos registrados",totalItems:(d==null?void 0:d.total)||0,itemsPerPage:20,currentPage:z,onPageChange:L,onSearch:Le,onFilter:Ge,filterOptions:Qe,getRowClassName:a=>a.status==="cancelado"?"table-secondary opacity-50 text-muted":""})})]}),e.jsx(ve,{show:ye,onHide:()=>C(!1),title:x!=null&&x.id?"Editar Proyecto":"Nuevo Proyecto",data:x||K,fields:Ye,onSubmit:Xe,loading:te.isLoading||f.isLoading,submitText:x!=null&&x.id?"Actualizar":"Crear"}),e.jsx(ve,{show:O,onHide:()=>F(!1),title:`Gestionar Proyecto - ${(o==null?void 0:o.name)||""}`,data:r,fields:[{name:"project_management",label:"Gesti√≥n del Proyecto",type:"custom",render:a=>e.jsxs(Pa,{activeKey:fe,onSelect:s=>H(s),className:"mb-3",children:[e.jsx(j,{eventKey:"view",title:e.jsxs("span",{children:[e.jsx(xe,{className:"me-1"}),"Ver"]}),children:e.jsxs("div",{className:"row g-3",children:[e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"border rounded p-3 h-100",children:[e.jsxs("h6",{className:"text-primary mb-3",children:[e.jsx(y,{className:"me-2"}),"Datos Generales"]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"ID:"})," ",a.id]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Nombre:"})," ",a.name]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Ubicaci√≥n:"})," ",a.location]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Tipo:"}),e.jsx(m,{bg:"info",className:"ms-2",children:a.project_type})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Estado:"}),e.jsx(m,{bg:"primary",className:"ms-2",children:a.status})]})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"border rounded p-3 h-100",children:[e.jsxs("h6",{className:"text-success mb-3",children:[e.jsx(P,{className:"me-2"}),"Informaci√≥n de Contacto"]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Empresa:"})," ",a.company_name]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"RUC:"})," ",a.company_ruc]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Contacto:"})," ",a.contact_name||"Sin contacto"]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Tel√©fono:"})," ",a.contact_phone||"Sin tel√©fono"]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Email:"})," ",a.contact_email||"Sin email"]})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"border rounded p-3 h-100",children:[e.jsxs("h6",{className:"text-warning mb-3",children:[e.jsx(ge,{className:"me-2"}),"Servicios Requeridos"]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Laboratorio:"}),a.requiere_laboratorio?e.jsx(m,{bg:"info",className:"ms-2",children:"Requerido"}):e.jsx(m,{bg:"secondary",className:"ms-2",children:"No requerido"})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Ingenier√≠a:"}),a.requiere_ingenieria?e.jsx(m,{bg:"success",className:"ms-2",children:"Requerido"}):e.jsx(m,{bg:"secondary",className:"ms-2",children:"No requerido"})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Estado Lab:"}),e.jsx(m,{bg:"info",className:"ms-2",children:a.laboratorio_status})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Estado Ing:"}),e.jsx(m,{bg:"success",className:"ms-2",children:a.ingenieria_status})]})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"border rounded p-3 h-100",children:[e.jsxs("h6",{className:"text-info mb-3",children:[e.jsx(la,{className:"me-2"}),"Asignaciones"]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Vendedor:"})," ",a.vendedor_name||"Sin asignar"]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Laboratorio:"})," ",a.laboratorio_name||"Sin asignar"]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Fecha Creaci√≥n:"})," ",new Date(a.created_at).toLocaleDateString()]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"√öltima Actualizaci√≥n:"})," ",new Date(a.updated_at).toLocaleDateString()]})]})}),a.status_notes&&e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"border rounded p-3",children:[e.jsxs("h6",{className:"text-muted mb-3",children:[e.jsx(be,{className:"me-2"}),"Notas del Estado"]}),e.jsx("p",{className:"mb-0",children:a.status_notes})]})})]})}),e.jsx(j,{eventKey:"edit",title:e.jsxs("span",{children:[e.jsx(na,{className:"me-1"}),"Editar"]}),children:e.jsxs("div",{className:"row g-3",children:[e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Nombre del Proyecto"}),e.jsx("input",{type:"text",className:"form-control",value:r.name||"",onChange:s=>l({...r,name:s.target.value})})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Ubicaci√≥n"}),e.jsx("input",{type:"text",className:"form-control",value:r.location||"",onChange:s=>l({...r,location:s.target.value})})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Persona de Contacto"}),e.jsx("input",{type:"text",className:"form-control",value:r.contact_name||"",onChange:s=>l({...r,contact_name:s.target.value})})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Tel√©fono de Contacto"}),e.jsx("input",{type:"text",className:"form-control",value:r.contact_phone||"",onChange:s=>l({...r,contact_phone:s.target.value})})]})}),e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Email de Contacto"}),e.jsx("input",{type:"email",className:"form-control",value:r.contact_email||"",onChange:s=>l({...r,contact_email:s.target.value})})]})}),e.jsx("div",{className:"col-12",children:e.jsx(h,{variant:"primary",onClick:()=>{const s=o==null?void 0:o.id;if(!s){console.error("No se encontr√≥ el ID del proyecto"),t("‚ùå Error: No se encontr√≥ el ID del proyecto","danger");return}const c=typeof s=="object"?s.id:s;f.mutate({id:c,data:r},{onSuccess:n=>{t("‚úÖ Proyecto actualizado exitosamente!","success")},onError:n=>{console.error("‚ùå Guardar Cambios - Error:",n),t("‚ùå Error al actualizar proyecto","danger")}})},disabled:f.isLoading,children:f.isLoading?"Guardando...":"Guardar Cambios"})})]})}),e.jsx(j,{eventKey:"status",title:e.jsxs("span",{children:[e.jsx(ge,{className:"me-1"}),"Estado"]}),children:e.jsxs("div",{className:"row g-3",children:[e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Estado del Proyecto"}),e.jsxs("select",{className:"form-select",value:r.status||"",onChange:s=>l({...r,status:s.target.value}),children:[e.jsx("option",{value:"pendiente",children:"Pendiente"}),e.jsx("option",{value:"activo",children:"Activo"}),e.jsx("option",{value:"en_proceso",children:"En Proceso"}),e.jsx("option",{value:"completado",children:"Completado"}),e.jsx("option",{value:"pausado",children:"Pausado"}),e.jsx("option",{value:"cancelado",children:"Cancelado"})]})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Estado del Laboratorio"}),e.jsxs("select",{className:"form-select",value:r.laboratorio_status||"",onChange:s=>l({...r,laboratorio_status:s.target.value}),children:[e.jsx("option",{value:"no_requerido",children:"No Requerido"}),e.jsx("option",{value:"pendiente",children:"Pendiente"}),e.jsx("option",{value:"en_proceso",children:"En Proceso"}),e.jsx("option",{value:"completado",children:"Completado"}),e.jsx("option",{value:"pausado",children:"Pausado"}),e.jsx("option",{value:"cancelado",children:"Cancelado"})]})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Estado de Ingenier√≠a"}),e.jsxs("select",{className:"form-select",value:r.ingenieria_status||"",onChange:s=>l({...r,ingenieria_status:s.target.value}),children:[e.jsx("option",{value:"no_requerido",children:"No Requerido"}),e.jsx("option",{value:"pendiente",children:"Pendiente"}),e.jsx("option",{value:"en_proceso",children:"En Proceso"}),e.jsx("option",{value:"completado",children:"Completado"}),e.jsx("option",{value:"pausado",children:"Pausado"}),e.jsx("option",{value:"cancelado",children:"Cancelado"})]})]})}),e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Notas del Estado"}),e.jsx("textarea",{className:"form-control",rows:"3",value:r.status_notes||"",onChange:s=>l({...r,status_notes:s.target.value}),placeholder:"Agrega comentarios sobre el cambio de estado..."})]})}),e.jsx("div",{className:"col-12",children:e.jsx(h,{variant:"success",onClick:()=>{const s=o==null?void 0:o.id;if(!s){console.error("No se encontr√≥ el ID del proyecto"),t("‚ùå Error: No se encontr√≥ el ID del proyecto","danger");return}G.mutate({id:s,...r},{onSuccess:c=>{console.log("‚úÖ Actualizar Estado - √âxito:",c),t("‚úÖ Estado actualizado correctamente!","success")},onError:c=>{console.error("‚ùå Actualizar Estado - Error:",c),t("‚ùå Error al actualizar estado","danger")}})},disabled:G.isLoading,children:G.isLoading?"Actualizando...":"Actualizar Estado"})})]})}),e.jsx(j,{eventKey:"categories",title:e.jsxs("span",{children:[e.jsx(B,{className:"me-1"}),"Categor√≠as"]}),children:e.jsxs("div",{className:"row g-3",children:[e.jsxs("div",{className:"col-12",children:[e.jsx("h6",{className:"mb-3",children:"Categor√≠as del Proyecto"}),e.jsxs("div",{className:"form-check",children:[e.jsx("input",{className:"form-check-input",type:"checkbox",id:"cat_laboratorio",checked:r.requiere_laboratorio||!1,onChange:s=>{console.log("üîç requiere_laboratorio onChange:",s.target.checked),l({...r,requiere_laboratorio:s.target.checked})}}),e.jsx("label",{className:"form-check-label",htmlFor:"cat_laboratorio",children:"Laboratorio"})]}),e.jsxs("div",{className:"form-check",children:[e.jsx("input",{className:"form-check-input",type:"checkbox",id:"cat_ingenieria",checked:r.requiere_ingenieria||!1,onChange:s=>l({...r,requiere_ingenieria:s.target.checked})}),e.jsx("label",{className:"form-check-label",htmlFor:"cat_ingenieria",children:"Ingenier√≠a"})]}),e.jsxs("div",{className:"form-check",children:[e.jsx("input",{className:"form-check-input",type:"checkbox",id:"cat_consultoria",checked:r.requiere_consultoria||!1,onChange:s=>l({...r,requiere_consultoria:s.target.checked})}),e.jsx("label",{className:"form-check-label",htmlFor:"cat_consultoria",children:"Consultor√≠a"})]}),e.jsxs("div",{className:"form-check",children:[e.jsx("input",{className:"form-check-input",type:"checkbox",id:"cat_capacitacion",checked:r.requiere_capacitacion||!1,onChange:s=>l({...r,requiere_capacitacion:s.target.checked})}),e.jsx("label",{className:"form-check-label",htmlFor:"cat_capacitacion",children:"Capacitaci√≥n"})]}),e.jsxs("div",{className:"form-check",children:[e.jsx("input",{className:"form-check-input",type:"checkbox",id:"cat_auditoria",checked:r.requiere_auditoria||!1,onChange:s=>l({...r,requiere_auditoria:s.target.checked})}),e.jsx("label",{className:"form-check-label",htmlFor:"cat_auditoria",children:"Auditor√≠a"})]})]}),e.jsx("div",{className:"col-12",children:e.jsx(h,{variant:"info",onClick:()=>{const s=o==null?void 0:o.id;if(!s){console.error("No se encontr√≥ el ID del proyecto"),t("‚ùå Error: No se encontr√≥ el ID del proyecto","danger");return}R.mutate({id:s,requiere_laboratorio:r.requiere_laboratorio||!1,requiere_ingenieria:r.requiere_ingenieria||!1,requiere_consultoria:r.requiere_consultoria||!1,requiere_capacitacion:r.requiere_capacitacion||!1,requiere_auditoria:r.requiere_auditoria||!1},{onSuccess:c=>{console.log("‚úÖ Guardar Categor√≠as - √âxito:",c),t("‚úÖ Categor√≠as guardadas correctamente!","success")},onError:c=>{console.error("‚ùå Guardar Categor√≠as - Error:",c),t("‚ùå Error al guardar categor√≠as","danger")}})},disabled:R.isLoading,children:R.isLoading?"Guardando...":"Guardar Categor√≠as"})})]})}),e.jsx(j,{eventKey:"queries",title:e.jsxs("span",{children:[e.jsx(be,{className:"me-1"}),"Consultas"]}),children:e.jsxs("div",{className:"row g-3",children:[e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Consultas y Dudas del Cliente"}),e.jsx("textarea",{className:"form-control",rows:"8",value:r.queries||"",onChange:s=>l({...r,queries:s.target.value}),placeholder:"Ingresa las consultas o dudas del cliente..."})]})}),e.jsx("div",{className:"col-12",children:e.jsx(h,{variant:"warning",onClick:()=>{const s=o==null?void 0:o.id;if(!s){console.error("No se encontr√≥ el ID del proyecto"),t("‚ùå Error: No se encontr√≥ el ID del proyecto","danger");return}U.mutate({id:s,queries:r.queries||""},{onSuccess:c=>{console.log("‚úÖ Guardar Consultas - √âxito:",c),t("‚úÖ Consultas guardadas correctamente!","success")},onError:c=>{console.error("‚ùå Guardar Consultas - Error:",c),t("‚ùå Error al guardar consultas","danger")}})},disabled:U.isLoading,children:U.isLoading?"Guardando...":"Guardar Consultas"})})]})}),e.jsx(j,{eventKey:"mark",title:e.jsxs("span",{children:[e.jsx(je,{className:"me-1"}),"Marcar"]}),children:e.jsx("div",{className:"row g-3",children:e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h6",{className:"mb-3",children:"Marcar Proyecto"}),e.jsx("p",{className:"text-muted mb-4",children:"Marca este proyecto para seguimiento especial o prioridad alta."}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Prioridad"}),e.jsxs("select",{className:"form-select",value:r.priority||"normal",onChange:s=>l({...r,priority:s.target.value}),children:[e.jsx("option",{value:"low",children:"Baja"}),e.jsx("option",{value:"normal",children:"Normal"}),e.jsx("option",{value:"active",children:"Activo"}),e.jsx("option",{value:"high",children:"Alta"}),e.jsx("option",{value:"urgent",children:"Urgente"})]})]}),e.jsxs(h,{variant:"success",size:"lg",onClick:()=>{const s=o==null?void 0:o.id;if(!s){console.error("No se encontr√≥ el ID del proyecto"),t("‚ùå Error: No se encontr√≥ el ID del proyecto","danger");return}$.mutate({id:s,marked:!r.marked,priority:r.priority||"normal"},{onSuccess:c=>{console.log("‚úÖ Marcar Proyecto - √âxito:",c);const n=r.marked?"desmarcado":"marcado";t(`‚úÖ Proyecto ${n} correctamente!`,"success")},onError:c=>{console.error("‚ùå Marcar Proyecto - Error:",c),t("‚ùå Error al marcar proyecto","danger")}})},disabled:$.isLoading,children:[e.jsx(je,{className:"me-2"}),$.isLoading?"Procesando...":r.marked?"Desmarcar Proyecto":"Marcar Proyecto"]})]})})})}),e.jsx(j,{eventKey:"attachments",title:e.jsxs("span",{children:[e.jsx(B,{className:"me-1"}),"Adjuntos"]}),children:e.jsx("div",{className:"row g-3",children:e.jsxs("div",{className:"col-12",children:[e.jsx("h6",{className:"mb-3",children:"Gesti√≥n de Archivos"}),e.jsxs("div",{className:"card mb-4",children:[e.jsx("div",{className:"card-header",children:e.jsx("h6",{className:"mb-0",children:"Subir Nuevo Archivo"})}),e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Seleccionar Archivo"}),e.jsx("input",{type:"file",className:"form-control",onChange:Re,accept:".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.jpg,.jpeg,.png,.gif,.txt"}),e.jsx("div",{className:"form-text",children:"Formatos permitidos: PDF, DOC, DOCX, XLS, XLSX, PPT, PPTX, JPG, JPEG, PNG, GIF, TXT (m√°x. 10MB)"})]}),g&&e.jsx("div",{className:"mb-3",children:e.jsxs("div",{className:"alert alert-info",children:[e.jsx("strong",{children:"Archivo seleccionado:"})," ",g.name,e.jsx("br",{}),e.jsxs("small",{children:["Tama√±o: ",(g.size/1024/1024).toFixed(2)," MB"]})]})}),e.jsx(h,{variant:"primary",onClick:Ue,disabled:!g||J,children:J?"Subiendo...":"Subir Archivo"})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsxs("h6",{className:"mb-0",children:["Archivos Adjuntos (",D.length,")"]})}),e.jsx("div",{className:"card-body",children:D.length===0?e.jsxs("div",{className:"text-center text-muted py-4",children:[e.jsx(B,{size:48,className:"mb-3"}),e.jsx("p",{children:"No hay archivos adjuntos"}),e.jsx("small",{children:"Sube archivos como cotizaciones, documentos t√©cnicos, etc."})]}):e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-hover",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Archivo"}),e.jsx("th",{children:"Tama√±o"}),e.jsx("th",{children:"Fecha"}),e.jsx("th",{children:"Subido por"}),e.jsx("th",{children:"Acciones"})]})}),e.jsx("tbody",{children:D.map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("div",{children:[e.jsx("strong",{children:s.original_name}),s.description&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),e.jsx("small",{className:"text-muted",children:s.description})]})]})}),e.jsx("td",{children:s.file_size?`${(s.file_size/1024/1024).toFixed(2)} MB`:"N/A"}),e.jsx("td",{children:new Date(s.created_at).toLocaleDateString()}),e.jsx("td",{children:s.uploaded_by_name||"Usuario"}),e.jsx("td",{children:e.jsxs("div",{className:"btn-group btn-group-sm",children:[e.jsx(h,{variant:"outline-primary",size:"sm",onClick:()=>$e(s),title:"Descargar",children:e.jsx(da,{size:14})}),e.jsx(h,{variant:"outline-danger",size:"sm",onClick:()=>Be(s.id),title:"Eliminar",children:e.jsx(pe,{size:14})})]})})]},s.id))})]})})})]})]})})})]})}],onSubmit:()=>F(!1),submitText:"Cerrar",size:"xl"})]})}),_e&&e.jsxs("div",{style:{position:"fixed",top:"20px",right:"20px",zIndex:99999,backgroundColor:X==="success"?"#28a745":"#dc3545",color:"white",padding:"15px 20px",borderRadius:"8px",boxShadow:"0 4px 12px rgba(0,0,0,0.3)",minWidth:"300px",border:"none"},onClick:()=>M(!1),children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"5px"},children:X==="success"?"‚úÖ √âxito":"‚ùå Error"}),e.jsx("div",{children:Ce})]})]})}export{ss as default};
//# sourceMappingURL=Proyectos-z3jfBpZ-.js.map
