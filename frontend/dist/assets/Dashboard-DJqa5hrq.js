import{b as $,u as R,a as S,c as B,F as m,d as n,e as x,f as u,j as e,g as l,h as p,B as h,i as g,k as I}from"./index-o7c7tdkB.js";import{P as Q,R as k,C as c}from"./PageHeader-C0hqpNJa.js";import{S as N}from"./StatsCard-Sqt5gmwc.js";import{u as D}from"./useActivities-DI44htsz.js";import{C as i}from"./Card-B7TGPdeB.js";import"./Spinner-H_v7OS2w.js";const E=()=>$("/api/dashboard/stats"),Z=()=>{var P,A,F,z,q;const d=R(),{user:t}=S(),{data:v,isLoading:j}=B(["dashboardStats"],E,{refetchInterval:3e5,staleTime:6e4}),{data:f,isLoading:y,activitiesCount:b,refreshActivities:C}=D({limit:4,refetchInterval:3e5,staleTime:6e4,userId:t==null?void 0:t.id,role:t==null?void 0:t.role}),a=(v==null?void 0:v.stats)||{totalUsers:0,totalProjects:0,totalQuotes:0,totalTickets:0,activeProjects:0,pendingQuotes:0,openTickets:0,completedProjects:0,changePercentages:{users:0,projects:0,quotes:0,tickets:0}},T=s=>{const r=new Date,_=new Date(s),o=Math.floor((r-_)/(1e3*60));return o<1?"Ahora":o<60?`Hace ${o} min`:o<1440?`Hace ${Math.floor(o/60)} h`:`Hace ${Math.floor(o/1440)} días`},H=s=>({quote_created:m,quote_assigned:m,quote_approved:n,quote_rejected:FiX,quote_completed:n,project_created:p,project_assigned:p,project_started:l,project_completed:n,project_delayed:FiClock,ticket_created:x,ticket_assigned:x,ticket_resolved:n,ticket_escalated:FiAlertTriangle,evidence_uploaded:FiPaperclip,evidence_approved:n,evidence_rejected:FiX,user_registered:u,user_assigned:u,user_role_changed:FiSettings,client_created:FiUser,client_updated:FiUser,system_maintenance:FiSettings,system_update:FiSettings})[s]||g,M=s=>({quote_created:"primary",quote_assigned:"primary",quote_approved:"success",quote_rejected:"danger",quote_completed:"success",project_created:"info",project_assigned:"info",project_started:"info",project_completed:"success",project_delayed:"warning",ticket_created:"warning",ticket_assigned:"warning",ticket_resolved:"success",ticket_escalated:"danger",evidence_uploaded:"secondary",evidence_approved:"success",evidence_rejected:"danger",user_registered:"info",user_assigned:"info",user_role_changed:"secondary",client_created:"primary",client_updated:"primary",system_maintenance:"secondary",system_update:"secondary"})[s]||"secondary",w=((P=f==null?void 0:f.activities)==null?void 0:P.map(s=>({id:s.id,type:s.type,title:s.title,description:s.description,time:T(s.created_at),icon:H(s.type),color:M(s.type),user:s.user_name})))||[{id:1,type:"quote_created",title:"Nueva cotización creada",description:"Cotización #2024-001 para Proyecto ABC",time:"Hace 2 horas",icon:m,color:"primary"},{id:2,type:"project_completed",title:"Proyecto completado",description:"Proyecto XYZ finalizado exitosamente",time:"Hace 4 horas",icon:n,color:"success"},{id:3,type:"ticket_created",title:"Nuevo ticket de soporte",description:"Solicitud de soporte técnico",time:"Hace 6 horas",icon:x,color:"warning"},{id:4,type:"user_registered",title:"Usuario registrado",description:"Nuevo usuario agregado al sistema",time:"Hace 8 horas",icon:u,color:"info"}],U=[{title:"Nuevo Proyecto",description:"Crear un nuevo proyecto",icon:p,color:"primary",onClick:()=>d("/proyectos")},{title:"Nueva Cotización",description:"Generar cotización",icon:m,color:"success",onClick:()=>d("/cotizaciones/nueva/lem")},{title:"Nuevo Ticket",description:"Crear ticket de soporte",icon:x,color:"warning",onClick:()=>d("/tickets")},{title:"Ver Reportes",description:"Analizar datos del sistema",icon:l,color:"info",onClick:()=>d("/reportes")}];return e.jsxs("div",{className:"fade-in",children:[e.jsx(Q,{title:"Dashboard",subtitle:"Resumen general del sistema CRM GeoFal",icon:l}),e.jsxs(k,{className:"mb-4",children:[e.jsx(c,{lg:3,md:6,className:"mb-3",children:e.jsx(N,{title:"Total Usuarios",value:a.totalUsers,icon:u,color:"primary",trend:((A=a.changePercentages)==null?void 0:A.users)||0,subtitle:"Usuarios activos",loading:j})}),e.jsx(c,{lg:3,md:6,className:"mb-3",children:e.jsx(N,{title:"Proyectos Activos",value:a.activeProjects,icon:p,color:"success",trend:((F=a.changePercentages)==null?void 0:F.projects)||0,subtitle:`${a.totalProjects} proyectos totales`,loading:j})}),e.jsx(c,{lg:3,md:6,className:"mb-3",children:e.jsx(N,{title:"Cotizaciones Pendientes",value:a.pendingQuotes,icon:m,color:"warning",trend:((z=a.changePercentages)==null?void 0:z.quotes)||0,subtitle:`${a.totalQuotes} cotizaciones totales`,loading:j})}),e.jsx(c,{lg:3,md:6,className:"mb-3",children:e.jsx(N,{title:"Tickets Abiertos",value:a.openTickets,icon:x,color:"danger",trend:((q=a.changePercentages)==null?void 0:q.tickets)||0,subtitle:`${a.totalTickets} tickets totales`,loading:j})})]}),e.jsxs(k,{children:[e.jsx(c,{lg:8,className:"mb-4",children:e.jsxs(i,{className:"h-100",children:[e.jsxs(i.Header,{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"mb-0",children:"Actividades Recientes"}),b>0&&e.jsxs("small",{className:"text-muted",children:[b," actividad",b!==1?"es":""," • Actualizado automáticamente"]}),(t==null?void 0:t.role)!=="admin"&&e.jsxs("small",{className:"text-info d-block",children:["Mostrando solo actividades relevantes a tu rol: ",t==null?void 0:t.role]})]}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx(h,{variant:"outline-secondary",size:"sm",onClick:C,disabled:y,title:"Actualizar actividades",className:"refresh-btn",children:e.jsx(g,{className:y?"spinning":""})}),(t==null?void 0:t.role)==="admin"&&e.jsxs(h,{variant:"outline-primary",size:"sm",onClick:()=>d("/actividades"),title:"Ver todas las actividades (Solo Admin)",children:[e.jsx(I,{className:"me-1"}),"Ver todas"]})]})]}),e.jsx(i.Body,{children:y?e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"spinner-border text-primary",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Cargando actividades..."})}),e.jsx("p",{className:"mt-2 text-muted",children:"Cargando actividades recientes..."})]}):w.length===0?e.jsxs("div",{className:"activity-empty-state text-center",children:[e.jsx("div",{className:"mb-3",children:e.jsx(g,{size:48,className:"text-muted icon"})}),e.jsx("h6",{className:"text-muted mb-2",children:"No hay actividades recientes"}),e.jsx("p",{className:"text-muted small mb-3",children:(t==null?void 0:t.role)==="admin"?"Aún no hay actividades registradas en el sistema.":"No hay actividades relevantes a tu rol en este momento."}),e.jsxs(h,{variant:"outline-primary",size:"sm",onClick:C,className:"mt-2",children:[e.jsx(g,{className:"me-1"}),"Actualizar"]})]}):e.jsx("div",{className:"activity-list",children:w.map(s=>{const r=s.icon;return e.jsxs("div",{className:"activity-item d-flex align-items-start mb-3",children:[e.jsx("div",{className:`activity-icon bg-${s.color} bg-opacity-10 rounded-circle p-2 me-3`,children:e.jsx(r,{size:20,className:`text-${s.color}`})}),e.jsxs("div",{className:"flex-grow-1",children:[e.jsx("h6",{className:"mb-1",children:s.title}),e.jsx("p",{className:"text-muted mb-1 small",children:s.description}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsx("small",{className:"text-muted",children:s.time}),s.user&&e.jsxs("small",{className:"text-muted",children:["por ",s.user]})]})]})]},s.id)})})})]})}),e.jsx(c,{lg:4,className:"mb-4",children:e.jsxs(i,{className:"h-100",children:[e.jsx(i.Header,{children:e.jsx("h5",{className:"mb-0",children:"Acciones Rápidas"})}),e.jsx(i.Body,{children:e.jsx("div",{className:"quick-actions",children:U.map((s,r)=>{const _=s.icon;return e.jsxs(h,{variant:`outline-${s.color}`,className:"w-100 mb-3 d-flex align-items-center justify-content-start",onClick:s.onClick,children:[e.jsx("div",{className:`me-3 bg-${s.color} bg-opacity-10 rounded-circle p-2`,children:e.jsx(_,{size:20,className:`text-${s.color}`})}),e.jsxs("div",{className:"text-start",children:[e.jsx("div",{className:"fw-medium",children:s.title}),e.jsx("small",{className:"text-muted",children:s.description})]})]},r)})})})]})})]}),e.jsxs(k,{children:[e.jsx(c,{lg:6,className:"mb-4",children:e.jsxs(i,{children:[e.jsx(i.Header,{children:e.jsx("h5",{className:"mb-0",children:"Resumen de Proyectos"})}),e.jsxs(i.Body,{children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsx("span",{children:"Proyectos Completados"}),e.jsx("span",{className:"fw-bold text-success",children:a.completedProjects})]}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsx("span",{children:"Proyectos Activos"}),e.jsx("span",{className:"fw-bold text-primary",children:a.activeProjects})]}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsx("span",{children:"Total Proyectos"}),e.jsx("span",{className:"fw-bold",children:a.totalProjects})]})]})]})}),e.jsx(c,{lg:6,className:"mb-4",children:e.jsxs(i,{children:[e.jsx(i.Header,{children:e.jsx("h5",{className:"mb-0",children:"Estado del Sistema"})}),e.jsxs(i.Body,{children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsx("span",{children:"Usuarios Online"}),e.jsxs("span",{className:"fw-bold text-success",children:[e.jsx(l,{className:"me-1"}),Math.floor(a.totalUsers*.3)]})]}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsx("span",{children:"Cotizaciones Este Mes"}),e.jsxs("span",{className:"fw-bold text-primary",children:[e.jsx(l,{className:"me-1"}),Math.floor(a.totalQuotes*.4)]})]}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsx("span",{children:"Tickets Resueltos"}),e.jsxs("span",{className:"fw-bold text-success",children:[e.jsx(l,{className:"me-1"}),Math.floor(a.totalTickets*.7)]})]})]})]})})]})]})};export{Z as default};
//# sourceMappingURL=Dashboard-DJqa5hrq.js.map
