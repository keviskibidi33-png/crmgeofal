import{b as d,r as i,Q,c as I,R as b,j as a,U as V,f as j,B as E,V as z,W,x as X,w as K,X as Y,y as v,J as Z}from"./index-B6K4MeZ_.js";import{P as ee,R as ae,C as h}from"./PageHeader-ZaYSeG4B.js";import{D as se}from"./DataTable-DtW7TOza.js";import{M as R}from"./ModalForm-DoSAJory.js";import{S as p}from"./StatsCard-BQEilZ7W.js";import{C as y}from"./Card-C3FyhA6L.js";import"./InputGroup-B3UJk0zl.js";import"./Form-DajNugM3.js";import"./Spinner-Cd5nug_F.js";const re=(s={})=>{const o=new URLSearchParams;s.page&&o.set("page",s.page),s.limit&&o.set("limit",s.limit),s.search&&o.set("search",s.search),s.area&&o.set("area",s.area),s.role&&o.set("role",s.role);const r=o.toString(),n=r?`/api/users?${r}`:"/api/users";return d(n)},oe=s=>d("/api/users",{method:"POST",body:JSON.stringify(s)}),te=(s,o)=>d(`/api/users/${s}`,{method:"PATCH",body:JSON.stringify(o)}),le=s=>d(`/api/users/${s}`,{method:"DELETE"}),ie=(s,o)=>d(`/api/users/${s}/reset-password`,{method:"POST",body:JSON.stringify({password:o})}),L={name:"",apellido:"",email:"",role:"vendedor_comercial",area:"Comercial",password:""},M=[{value:"admin",label:"Administrador"},{value:"jefa_comercial",label:"Jefa Comercial"},{value:"vendedor_comercial",label:"Vendedor Comercial"},{value:"jefe_laboratorio",label:"Jefe Laboratorio"},{value:"usuario_laboratorio",label:"Usuario Laboratorio"},{value:"laboratorio",label:"Laboratorio"},{value:"soporte",label:"Soporte"},{value:"gerencia",label:"Gerencia"}],ne=[{value:"Comercial",label:"Comercial"},{value:"Laboratorio",label:"Laboratorio"},{value:"Sistemas",label:"Sistemas"},{value:"Gerencia",label:"Gerencia"},{value:"Soporte",label:"Soporte"}];function je(){const[s,o]=i.useState(!1),[r,n]=i.useState(null),[ce,P]=i.useState(null),[u,g]=i.useState(null),[f,w]=i.useState(""),U=Q(),{data:l,isLoading:x,refetch:F}=I(["users"],()=>re(),{keepPreviousData:!0,refetchOnWindowFocus:!0,refetchOnMount:!0,staleTime:0,cacheTime:0}),m=e=>{U.invalidateQueries("users"),o(!1),n(null),P(null),g(null),w("")},S=b(oe,{onSuccess:()=>m(),onError:e=>console.error("Error creating user:",e)}),N=b(te,{onSuccess:()=>m(),onError:e=>console.error("Error updating user:",e)}),_=b(le,{onSuccess:()=>m(),onError:e=>console.error("Error deleting user:",e)}),C=b(ie,{onSuccess:()=>m(),onError:e=>console.error("Error resetting password:",e)}),q=()=>{n(L),o(!0)},A=e=>{n(e),o(!0)},T=e=>{window.confirm(`¿Estás seguro de que quieres eliminar al usuario ${e.name}?`)&&_.mutate(e.id)},O=e=>{g(e),w("")},k=async e=>{r.id?await N.mutateAsync({id:r.id,...e}):await S.mutateAsync(e)},D=async()=>{f&&u&&await C.mutateAsync({id:u.id,password:f})},J=e=>({admin:"danger",jefa_comercial:"warning",vendedor_comercial:"primary",jefe_laboratorio:"info",usuario_laboratorio:"secondary",laboratorio:"secondary",soporte:"success",gerencia:"dark"})[e]||"secondary",B=e=>{const t=M.find(G=>G.value===e);return t?t.label:e},H=[{header:"ID",accessor:"id",width:"80px"},{header:"Nombre",accessor:"name",render:(e,t)=>a.jsxs("div",{children:[a.jsxs("div",{className:"fw-medium",children:[t.name," ",t.apellido]}),a.jsx("small",{className:"text-muted",children:t.email})]})},{header:"Rol",accessor:"role",render:e=>a.jsx(v,{bg:J(e),className:"status-badge",children:B(e)})},{header:"Área",accessor:"area",render:e=>a.jsx(v,{bg:"light",text:"dark",className:"status-badge",children:e})},{header:"Fecha Creación",accessor:"created_at",type:"date"}],$=[{name:"name",label:"Nombre",type:"text",required:!0,placeholder:"Ingresa el nombre"},{name:"apellido",label:"Apellido",type:"text",required:!0,placeholder:"Ingresa el apellido"},{name:"email",label:"Email",type:"email",required:!0,placeholder:"usuario@ejemplo.com"},{name:"role",label:"Rol",type:"select",required:!0,options:M},{name:"area",label:"Área",type:"select",required:!0,options:ne},{name:"password",label:"Contraseña",type:"password",required:!(r!=null&&r.id),placeholder:"Mínimo 6 caracteres",help:r!=null&&r.id?"Dejar vacío para mantener la contraseña actual":"Mínimo 6 caracteres"}],c=i.useMemo(()=>{const e=(l==null?void 0:l.users)||[];return{total:e.length,admins:e.filter(t=>t.role==="admin").length,vendedores:e.filter(t=>t.role==="vendedor_comercial").length,laboratorio:e.filter(t=>["jefe_laboratorio","usuario_laboratorio","laboratorio"].includes(t.role)).length,activos:e.filter(t=>t.active!==!1).length}},[l]);return a.jsx(V,{fluid:!0,className:"py-4",children:a.jsxs("div",{className:"fade-in",children:[a.jsx(ee,{title:"Gestión de Usuarios",subtitle:"Crear, editar, eliminar y gestionar usuarios del sistema",icon:j,actions:a.jsxs(E,{variant:"primary",onClick:q,children:[a.jsx(z,{className:"me-2"}),"Nuevo Usuario"]})}),a.jsxs(ae,{className:"g-4 mb-4",children:[a.jsx(h,{md:6,lg:3,children:a.jsx(p,{title:"Total Usuarios",value:c.total,icon:j,color:"primary",subtitle:"Usuarios registrados"})}),a.jsx(h,{md:6,lg:3,children:a.jsx(p,{title:"Administradores",value:c.admins,icon:W,color:"danger",subtitle:"Usuarios con privilegios"})}),a.jsx(h,{md:6,lg:3,children:a.jsx(p,{title:"Vendedores",value:c.vendedores,icon:X,color:"success",subtitle:"Equipo comercial"})}),a.jsx(h,{md:6,lg:3,children:a.jsx(p,{title:"Laboratorio",value:c.laboratorio,icon:K,color:"info",subtitle:"Personal técnico"})})]}),a.jsxs(y,{className:"shadow-sm border-0",children:[a.jsx(y.Header,{className:"bg-white border-bottom",children:a.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[a.jsxs("h5",{className:"mb-0",children:[a.jsx(j,{className:"me-2 text-primary"}),"Lista de Usuarios"]}),a.jsxs("div",{className:"d-flex align-items-center gap-2",children:[a.jsx(E,{variant:"outline-primary",size:"sm",onClick:()=>F(),disabled:x,className:"refresh-btn",children:a.jsx(Y,{className:x?"spinning":""})}),a.jsxs(v,{bg:"light",text:"dark",className:"px-3 py-2",children:[c.total," usuarios"]})]})]})}),a.jsx(y.Body,{className:"p-0",children:a.jsx(se,{data:(l==null?void 0:l.users)||[],columns:H,loading:x,onEdit:A,onDelete:T,emptyMessage:"No hay usuarios registrados",actions:[{label:"Restablecer Contraseña",icon:Z,onClick:O,variant:"outline-warning"}]})})]}),a.jsx(R,{show:s,onHide:()=>o(!1),title:r!=null&&r.id?"Editar Usuario":"Nuevo Usuario",data:r||L,fields:$,onSubmit:k,loading:S.isLoading||N.isLoading,submitText:r!=null&&r.id?"Actualizar":"Crear"}),u&&a.jsx(R,{show:!!u,onHide:()=>g(null),title:"Restablecer Contraseña",data:{password:f},fields:[{name:"password",label:"Nueva Contraseña",type:"password",required:!0,placeholder:"Mínimo 6 caracteres"}],onSubmit:D,loading:C.isLoading,submitText:"Restablecer"})]})})}export{je as default};
//# sourceMappingURL=Usuarios-Bq1WImY4.js.map
