import{r as c,j as e,B as N,o as Z,w as Js,e as ye,a2 as Ys,C as I,T as he,O as He,W as Xs,z as ve,k as te,b as Ks,f as ue,y as ys,n as xe,g as Pe,a3 as Ue,a4 as ps,L as Ge,a as Zs,u as ea,a5 as sa,c as aa,x as me,A as ia,m as ra,J as gs,X as ta,Z as bs,F as je,a6 as js,a1 as fs,K as na}from"./index-Bcrgukx7.js";import{P as oa}from"./PageHeader-BXdzGOF9.js";import{D as la}from"./DataTable-BA50ScQ0.js";/* empty css                     */import{M as fe}from"./Modal-CPMvw6Im.js";import{F as d}from"./Form-DBWuP9iW.js";import{R as K,C as ca}from"./Row-B5ljKXp5.js";import{C as S}from"./Col-C5Zwr_ej.js";import{S as Qe}from"./Spinner-jUAz7otr.js";import{S as ze}from"./StatsCard-Bg6TicJV.js";import{C as Ve}from"./ConfirmModal-om5z7whj.js";import{c as da,u as ma,d as ha,a as ua,b as xa,e as pa,l as ga,g as ba}from"./projects-CVN8cRbd.js";import{l as Oe,u as ja,d as fa,a as ya}from"./attachments-CeT6BzfH.js";import{l as va}from"./users-B9PRke9c.js";import{l as Na,a as _a}from"./services-CdWVxOMp.js";import{C as h}from"./Card-C96hNOBG.js";import{A as Le}from"./Alert-C1-1JEUj.js";/* empty css                  */import"./InputGroup-B7PnIA03.js";import"./Table-CY_xt81j.js";import"./ElementChildren-BWXp08bt.js";const Te=({show:y,onHide:_,title:C,data:f={},fields:i=[],onSubmit:P,loading:x=!1,size:D="lg",submitText:u="Guardar",cancelText:v="Cancelar",validation:k={},className:X=""})=>{const[L,M]=c.useState({}),[V,R]=c.useState({}),[Q,$]=c.useState({}),[E,r]=c.useState({}),[p,j]=c.useState({});c.useEffect(()=>{y&&(M(f),R({}),$({}))},[y,f]);const z=(t,n)=>{M(q=>({...q,[t]:n})),V[t]&&R(q=>({...q,[t]:null}));const m=i.find(q=>q.name===t);if(m&&m.autocomplete&&m.suggestions&&n.length>0){const q=m.suggestions.filter(g=>g.toLowerCase().includes(n.toLowerCase()));r(g=>({...g,[t]:q.slice(0,5)})),j(g=>({...g,[t]:!0}))}else j(q=>({...q,[t]:!1}))},U=t=>{if($(n=>({...n,[t]:!0})),setTimeout(()=>{j(n=>({...n,[t]:!1}))},200),k[t]){const n=k[t](L[t],L);n&&R(m=>({...m,[t]:n}))}},ee=(t,n)=>{M(m=>({...m,[t]:n})),j(m=>({...m,[t]:!1}))},H=()=>{const t={};let n=!0;return i.forEach(m=>{if(m.required&&(!L[m.name]||L[m.name]===""))t[m.name]=`${m.label} es requerido`,n=!1;else if(k[m.name]){const q=k[m.name](L[m.name],L);q&&(t[m.name]=q,n=!1)}}),R(t),n},ne=async t=>{if(t.preventDefault(),H())try{await P(L),_()}catch(n){console.error("Error submitting form:",n)}},oe=t=>{var q;const n=Q[t.name]&&V[t.name],m=L[t.name]||"";switch(t.type){case"text":case"email":case"password":return e.jsxs(d.Group,{className:"mb-3 position-relative",children:[e.jsxs(d.Label,{children:[t.label,t.required&&e.jsx("span",{className:"text-danger ms-1",children:"*"})]}),e.jsx(d.Control,{type:t.type,name:t.name,value:m,onChange:g=>z(t.name,g.target.value),onBlur:()=>U(t.name),isInvalid:n,placeholder:t.placeholder,disabled:t.disabled}),n&&e.jsx(d.Control.Feedback,{type:"invalid",children:V[t.name]}),t.help&&e.jsx(d.Text,{className:"text-muted",children:t.help}),t.autocomplete&&p[t.name]&&E[t.name]&&E[t.name].length>0&&e.jsx("div",{className:"autocomplete-suggestions position-absolute w-100",style:{zIndex:1e3,top:"100%"},children:e.jsx("div",{className:"list-group",children:E[t.name].map((g,l)=>e.jsx("button",{type:"button",className:"list-group-item list-group-item-action",onClick:()=>ee(t.name,g),style:{fontSize:"0.875rem",padding:"0.5rem 0.75rem"},children:g},l))})})]},t.name);case"textarea":return e.jsxs(d.Group,{className:"mb-3",children:[e.jsxs(d.Label,{children:[t.label,t.required&&e.jsx("span",{className:"text-danger ms-1",children:"*"})]}),e.jsx(d.Control,{as:"textarea",rows:t.rows||3,name:t.name,value:m,onChange:g=>z(t.name,g.target.value),onBlur:()=>U(t.name),isInvalid:n,placeholder:t.placeholder}),n&&e.jsx(d.Control.Feedback,{type:"invalid",children:V[t.name]})]},t.name);case"select":return e.jsxs(d.Group,{className:"mb-3",children:[e.jsxs(d.Label,{children:[t.label,t.required&&e.jsx("span",{className:"text-danger ms-1",children:"*"})]}),e.jsxs(d.Select,{name:t.name,value:m,onChange:g=>z(t.name,g.target.value),onBlur:()=>U(t.name),isInvalid:n,children:[e.jsx("option",{value:"",children:"Seleccionar..."}),(q=t.options)==null?void 0:q.map(g=>e.jsx("option",{value:g.value,children:g.label},g.value))]}),n&&e.jsx(d.Control.Feedback,{type:"invalid",children:V[t.name]})]},t.name);case"number":return e.jsxs(d.Group,{className:"mb-3",children:[e.jsxs(d.Label,{children:[t.label,t.required&&e.jsx("span",{className:"text-danger ms-1",children:"*"})]}),e.jsx(d.Control,{type:"number",name:t.name,value:m,onChange:g=>z(t.name,parseFloat(g.target.value)||""),onBlur:()=>U(t.name),isInvalid:n,placeholder:t.placeholder,min:t.min,max:t.max,step:t.step}),n&&e.jsx(d.Control.Feedback,{type:"invalid",children:V[t.name]})]},t.name);case"checkbox":return e.jsx(d.Group,{className:"mb-3",children:e.jsx(d.Check,{type:"checkbox",name:t.name,checked:!!m,onChange:g=>z(t.name,g.target.checked),label:t.label})},t.name);case"custom":return e.jsx("div",{className:"mb-3",children:t.render&&t.render(L)},t.name);default:return null}};return e.jsxs(fe,{show:y,onHide:_,size:D,className:X,children:[e.jsx(fe.Header,{closeButton:!0,className:"border-0 pb-0",children:e.jsx(fe.Title,{className:"fw-bold",children:C})}),e.jsxs(d,{onSubmit:ne,children:[e.jsx(fe.Body,{className:"pt-0",children:e.jsx(K,{children:i.map(t=>e.jsx(S,{md:t.col||12,children:oe(t)},t.name))})}),e.jsxs(fe.Footer,{className:"border-0 pt-0",children:[e.jsxs(N,{variant:"outline-secondary",onClick:_,disabled:x,children:[e.jsx(Z,{className:"me-1"}),v]}),e.jsx(N,{type:"submit",variant:"primary",disabled:x,children:x?e.jsxs(e.Fragment,{children:[e.jsx(Qe,{size:"sm",className:"me-1"}),"Guardando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Js,{className:"me-1"}),u]})})]})]})]})};function wa({selectedServices:y=[],onServicesChange:_}){const[C,f]=c.useState(""),[i,P]=c.useState(null),[x,D]=c.useState([]),{data:u,isLoading:v}=ye(["services"],()=>Na({}),{staleTime:5*60*1e3,cacheTime:10*60*1e3}),{data:k,isLoading:X}=ye(["subservices",i==null?void 0:i.id],()=>i?_a({service_id:i.id}):null,{enabled:!!i,staleTime:5*60*1e3,cacheTime:10*60*1e3}),L=(u==null?void 0:u.data)||(u==null?void 0:u.rows)||[],M=(k==null?void 0:k.data)||(k==null?void 0:k.rows)||[],V=L.filter(r=>{var p,j;return((p=r.name)==null?void 0:p.toLowerCase().includes(C.toLowerCase()))||((j=r.description)==null?void 0:j.toLowerCase().includes(C.toLowerCase()))}),R=r=>{if(!y.some(j=>j.ensayo.id===r.id)){if(y.length>=5){alert("Máximo 5 servicios pueden ser seleccionados");return}P(r),D([])}},Q=r=>{const p=x.some(j=>j.id===r.id);D(p?j=>j.filter(z=>z.id!==r.id):j=>[...j,r])},$=()=>{if(i&&x.length>0){const r={ensayo:i,subservices:x,total:x.reduce((p,j)=>p+(j.precio||0),0)};_([...y,r]),P(null),D([])}},E=r=>{const p=y.filter((j,z)=>z!==r);_(p)};return e.jsxs("div",{className:"service-selection",children:[e.jsxs(h,{className:"mb-4",children:[e.jsx(h.Header,{children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("h6",{className:"mb-0",children:[e.jsx(Ys,{className:"me-2"}),"Selección de Servicios"]}),e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsxs(I,{bg:"info",children:[y.length,"/5 seleccionados"]}),y.length>0&&e.jsxs(N,{variant:"outline-danger",size:"sm",onClick:()=>_([]),children:[e.jsx(Z,{size:12,className:"me-1"}),"Limpiar"]})]})]})}),e.jsxs(h.Body,{children:[e.jsx("div",{className:"mb-3",children:e.jsx(d.Control,{type:"text",placeholder:"Buscar servicios...",value:C,onChange:r=>f(r.target.value)})}),v?e.jsxs("div",{className:"text-center py-4",children:[e.jsx(Qe,{animation:"border",variant:"primary"}),e.jsx("p",{className:"mt-2 text-muted",children:"Cargando servicios..."})]}):e.jsx(K,{className:"g-3",children:V.map(r=>{const p=y.some(z=>z.ensayo.id===r.id),j=(i==null?void 0:i.id)===r.id;return e.jsx(S,{md:6,lg:4,children:e.jsx(h,{className:`h-100 cursor-pointer ${p?"border-success":j?"border-primary":""} ${p?"bg-light":""}`,onClick:()=>R(r),children:e.jsxs(h.Body,{children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-start mb-2",children:[e.jsx("h6",{className:"mb-1",children:r.name}),p?e.jsx(I,{bg:"success",children:e.jsx(he,{size:14})}):j?e.jsx(I,{bg:"primary",children:e.jsx(he,{size:14})}):null]}),e.jsx("p",{className:"text-muted small mb-2",children:r.description||"Sin descripción"}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("small",{className:"text-muted",children:[e.jsx(He,{className:"me-1",size:12}),r.norma||"N/A"]}),e.jsxs(I,{bg:r.subservices_count>0?"info":"secondary",children:[r.subservices_count||0," subservicios"]})]})]})})},r.id)})}),i&&e.jsxs(h,{className:"mt-4 border-primary",children:[e.jsx(h.Header,{children:e.jsxs("h6",{className:"mb-0",children:["Subservicios de: ",i.name]})}),e.jsxs(h.Body,{children:[X?e.jsxs("div",{className:"text-center py-3",children:[e.jsx(Qe,{animation:"border",size:"sm",variant:"primary"}),e.jsx("p",{className:"mt-2 text-muted small",children:"Cargando subservicios..."})]}):M.length>0?e.jsx(K,{className:"g-2",children:M.map(r=>{const p=x.some(j=>j.id===r.id);return e.jsx(S,{md:6,lg:4,children:e.jsx(h,{className:`h-100 cursor-pointer ${p?"border-success":""}`,onClick:()=>Q(r),children:e.jsxs(h.Body,{className:"p-3",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-start mb-2",children:[e.jsx("h6",{className:"mb-1 small",children:r.codigo}),p&&e.jsx(I,{bg:"success",children:e.jsx(he,{size:12})})]}),e.jsx("p",{className:"text-muted small mb-2",children:r.descripcion}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsx("small",{className:"text-muted",children:r.norma||"-"}),e.jsxs(I,{bg:r.precio>0?"success":"warning",children:[e.jsx(Xs,{className:"me-1",size:10}),r.precio>0?`S/ ${r.precio}`:"Sujeto a evaluación"]})]})]})})},r.id)})}):e.jsx(Le,{variant:"info",className:"mb-0",children:"No hay subservicios disponibles para este servicio."}),x.length>0&&e.jsx("div",{className:"mt-3 text-center",children:e.jsxs(N,{variant:"success",onClick:$,disabled:x.length===0,children:[e.jsx(he,{className:"me-1"}),"Agregar ",x.length," subservicio(s) seleccionado(s)"]})})]})]})]})]}),y.length>0&&e.jsxs(h,{className:"border-success",children:[e.jsx(h.Header,{children:e.jsxs("h6",{className:"mb-0 text-success",children:[e.jsx(he,{className:"me-2"}),"Servicios Seleccionados (",y.length,")"]})}),e.jsx(h.Body,{children:y.map((r,p)=>e.jsx(h,{className:"mb-3",children:e.jsx(h.Body,{children:e.jsxs("div",{className:"d-flex justify-content-between align-items-start",children:[e.jsxs("div",{children:[e.jsx("h6",{className:"mb-1",children:r.ensayo.name}),e.jsx("p",{className:"text-muted small mb-2",children:r.ensayo.description}),e.jsx("div",{className:"d-flex flex-wrap gap-1",children:r.subservices.map((j,z)=>e.jsx(I,{bg:"info",className:"me-1",children:j.codigo},z))})]}),e.jsxs("div",{className:"text-end",children:[e.jsxs("h6",{className:"text-success mb-1",children:["S/ ",r.total.toFixed(2)]}),e.jsx(N,{variant:"outline-danger",size:"sm",onClick:()=>E(p),children:e.jsx(Z,{size:14})})]})]})})},p))})]})]})}function Sa({onServicesChange:y,selectedServices:_=[]}){const C=f=>{y(f)};return e.jsxs(h,{className:"mb-4",children:[e.jsx(h.Header,{children:e.jsxs("h6",{className:"mb-0",children:[e.jsx(ve,{className:"me-2"}),"Configuración de Servicios del Proyecto"]})}),e.jsxs(h.Body,{children:[e.jsxs(Le,{variant:"info",className:"mb-4",children:[e.jsx(te,{className:"me-2"}),e.jsxs("div",{children:[e.jsx("strong",{children:"Servicios:"})," Selecciona los servicios que necesitas para este proyecto.",e.jsx("br",{}),e.jsx("small",{className:"text-muted",children:"Puedes elegir entre diferentes tipos de servicios (Laboratorio, Ingeniería, etc.) y sus subservicios correspondientes. Máximo 5 servicios."})]})]}),e.jsx(wa,{selectedServices:_,onServicesChange:C}),_.length>0&&e.jsxs(h,{className:"border-success mt-4",children:[e.jsx(h.Header,{children:e.jsxs("h6",{className:"mb-0 text-success",children:[e.jsx(he,{className:"me-2"}),"Resumen de Servicios Seleccionados"]})}),e.jsx(h.Body,{children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Total de Servicios:"})," ",_.length]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Total de Subservicios:"})," ",_.reduce((f,i)=>f+i.subservices.length,0)]})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Subtotal:"})," S/ ",_.reduce((f,i)=>f+i.total,0).toFixed(2)]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"IGV (18%):"})," S/ ",(_.reduce((f,i)=>f+i.total,0)*.18).toFixed(2)]}),e.jsxs("div",{className:"fw-bold text-success",children:[e.jsx("strong",{children:"Total:"})," S/ ",(_.reduce((f,i)=>f+i.total,0)*1.18).toFixed(2)]})]})]})})]})]})]})}const Ca=async(y,_)=>{try{const C=new URLSearchParams({type:y,q:_});return await Ks(`/companies/search?${C.toString()}`)}catch(C){throw console.error("Error en búsqueda de empresas:",C),C}};function qa({data:y={},onSubmit:_,loading:C=!1,onCancel:f}){const[i,P]=c.useState({clientType:"",client_id:"",client_name:"",client_info:{},name:"",location:"",vendedor_id:"",laboratorio_id:"",contact_name:"",contact_phone:"",contact_email:"",priority:"normal",marked:!1,requiere_laboratorio:!1,requiere_ingenieria:!1,requiere_capacitacion:!1}),[x,D]=c.useState(1),[u,v]=c.useState({}),[k,X]=c.useState(""),[L,M]=c.useState([]),[V,R]=c.useState(!1),[Q,$]=c.useState(!1),E=4;c.useEffect(()=>{y&&P(l=>({...l,...y}))},[y]);const r=(l,b)=>{P(A=>({...A,[l]:b})),u[l]&&v(A=>({...A,[l]:null}))},p=async l=>{if(!l||l.length<2){M([]),$(!1);return}if(!i.clientType){M([]),$(!1);return}R(!0);try{const b=await Ca(i.clientType,l);b.success?(M(b.data||[]),$(!0)):(M([]),$(!1))}catch(b){console.error("Error en búsqueda:",b),M([]),$(!1)}finally{R(!1)}},j=l=>{P(b=>({...b,client_id:l.id,client_name:l.name,client_info:l})),X(l.name),$(!1)},z=()=>{P(l=>({...l,client_id:"",client_name:"",client_info:{}})),X(""),M([]),$(!1)},U=l=>{const b={};switch(l){case 1:i.clientType||(b.clientType="Selecciona el tipo de cliente"),i.client_id||(b.client_id="Selecciona un cliente"),i.name||(b.name="Nombre del proyecto es requerido"),i.location||(b.location="Ubicación es requerida");break;case 2:i.contact_name||(b.contact_name="Persona de contacto es requerida"),i.contact_phone||(b.contact_phone="Teléfono es requerido");break;case 3:!i.requiere_laboratorio&&!i.requiere_ingenieria&&!i.requiere_capacitacion&&(b.services="Debes seleccionar al menos un tipo de servicio");break}return v(b),Object.keys(b).length===0},ee=()=>{U(x)&&D(l=>Math.min(l+1,E))},H=()=>{D(l=>Math.max(l-1,1))},ne=()=>{U(x)&&_(i)},oe=l=>{switch(l){case 1:return e.jsx(xe,{});case 2:return e.jsx(Pe,{});case 3:return e.jsx(ve,{});case 4:return e.jsx(ue,{});default:return e.jsx(xe,{})}},t=l=>{switch(l){case 1:return"Información Básica";case 2:return"Contacto";case 3:return"Requisitos del Proyecto";case 4:return"Resumen";default:return"Paso"}},n=()=>e.jsxs("div",{className:"step-content",children:[e.jsxs("div",{className:"text-center mb-5",children:[e.jsx("div",{className:"d-inline-flex align-items-center justify-content-center rounded-circle bg-primary bg-opacity-10 mb-3",style:{width:"64px",height:"64px"},children:e.jsx(xe,{size:28,className:"text-primary"})}),e.jsx("h3",{className:"fw-bold text-dark mb-2",children:"Información Básica"}),e.jsx("p",{className:"text-muted",children:"Completa los datos del cliente y del proyecto"})]}),e.jsxs(K,{className:"g-3",children:[e.jsx(S,{md:12,children:e.jsxs(d.Group,{children:[e.jsx(d.Label,{className:"fw-bold",children:"Tipo de Cliente *"}),e.jsxs("div",{className:"d-flex gap-3",children:[e.jsx(d.Check,{type:"radio",id:"empresa",name:"clientType",label:"Empresa",checked:i.clientType==="empresa",onChange:()=>r("clientType","empresa"),className:"d-flex align-items-center"}),e.jsx(d.Check,{type:"radio",id:"persona_natural",name:"clientType",label:"Persona Natural",checked:i.clientType==="persona_natural",onChange:()=>r("clientType","persona_natural"),className:"d-flex align-items-center"})]}),u.clientType&&e.jsx(d.Control.Feedback,{type:"invalid",children:u.clientType})]})}),i.clientType&&e.jsx(S,{md:12,children:e.jsxs(d.Group,{children:[e.jsxs(d.Label,{className:"fw-bold",children:["Buscar ",i.clientType==="empresa"?"Empresa":"Persona Natural"," *"]}),e.jsxs("div",{className:"position-relative",children:[e.jsx(d.Control,{type:"text",value:k,onChange:l=>{const b=l.target.value;X(b),p(b)},placeholder:`Buscar ${i.clientType==="empresa"?"empresa":"persona natural"}...`,isInvalid:!!u.client_id}),V&&e.jsx("div",{className:"position-absolute top-50 end-0 translate-middle-y me-3",children:e.jsx("div",{className:"spinner-border spinner-border-sm",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Buscando..."})})}),Q&&k&&e.jsx("div",{className:"position-absolute w-100 bg-white border rounded shadow-lg",style:{zIndex:1e3,maxHeight:"300px",overflowY:"auto"},children:L.length>0?L.map((l,b)=>e.jsxs("div",{className:"p-3 border-bottom cursor-pointer hover-bg-light",onClick:()=>j(l),children:[e.jsx("div",{className:"fw-bold",children:l.name}),e.jsxs("div",{className:"text-muted small",children:[i.clientType==="empresa"?l.ruc:l.dni," • ",l.address]})]},b)):e.jsx("div",{className:"p-3 text-muted text-center",children:"No se encontraron resultados"})})]}),u.client_id&&e.jsx(d.Control.Feedback,{type:"invalid",children:u.client_id})]})}),i.client_id&&e.jsx(S,{md:12,children:e.jsxs(h,{className:"border-success",children:[e.jsxs(h.Header,{className:"bg-success text-white d-flex justify-content-between align-items-center",children:[e.jsxs("h6",{className:"mb-0",children:[e.jsx(ue,{className:"me-2"}),"Cliente Seleccionado"]}),e.jsxs(N,{variant:"outline-light",size:"sm",onClick:z,className:"d-flex align-items-center",children:[e.jsx(Z,{className:"me-1"}),"Cambiar"]})]}),e.jsx(h.Body,{children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsx("strong",{children:"Nombre:"})," ",i.client_name]}),e.jsxs("div",{className:"col-md-6",children:[e.jsxs("strong",{children:[i.clientType==="empresa"?"RUC":"DNI",":"]})," ",i.client_info.ruc||i.client_info.dni]}),e.jsxs("div",{className:"col-md-12 mt-2",children:[e.jsx("strong",{children:"Dirección:"})," ",i.client_info.address]}),i.client_info.phone&&e.jsxs("div",{className:"col-md-6 mt-2",children:[e.jsx("strong",{children:"Teléfono:"})," ",i.client_info.phone]}),i.client_info.email&&e.jsxs("div",{className:"col-md-6 mt-2",children:[e.jsx("strong",{children:"Email:"})," ",i.client_info.email]})]})})]})}),e.jsx(S,{md:12,children:e.jsxs(d.Group,{children:[e.jsx(d.Label,{className:"fw-bold",children:"Nombre del Proyecto *"}),e.jsx(d.Control,{type:"text",value:i.name,onChange:l=>r("name",l.target.value),placeholder:"Ingresa el nombre del proyecto",isInvalid:!!u.name}),u.name&&e.jsx(d.Control.Feedback,{type:"invalid",children:u.name})]})}),e.jsx(S,{md:12,children:e.jsxs(d.Group,{children:[e.jsx(d.Label,{className:"fw-bold",children:"Ubicación *"}),e.jsx(d.Control,{type:"text",value:i.location,onChange:l=>r("location",l.target.value),placeholder:"Ingresa la ubicación del proyecto",isInvalid:!!u.location}),u.location&&e.jsx(d.Control.Feedback,{type:"invalid",children:u.location})]})})]})]}),m=()=>e.jsxs("div",{className:"step-content",children:[e.jsxs("div",{className:"text-center mb-5",children:[e.jsx("div",{className:"d-inline-flex align-items-center justify-content-center rounded-circle bg-success bg-opacity-10 mb-3",style:{width:"64px",height:"64px"},children:e.jsx(Pe,{size:28,className:"text-success"})}),e.jsx("h3",{className:"fw-bold text-dark mb-2",children:"Información de Contacto"}),e.jsx("p",{className:"text-muted",children:"Datos de la persona responsable del proyecto"})]}),e.jsxs(K,{className:"g-3",children:[e.jsx(S,{md:6,children:e.jsxs(d.Group,{children:[e.jsx(d.Label,{className:"fw-bold",children:"Persona de Contacto *"}),e.jsx(d.Control,{type:"text",value:i.contact_name,onChange:l=>r("contact_name",l.target.value),placeholder:"Nombre completo",isInvalid:!!u.contact_name}),u.contact_name&&e.jsx(d.Control.Feedback,{type:"invalid",children:u.contact_name})]})}),e.jsx(S,{md:6,children:e.jsxs(d.Group,{children:[e.jsx(d.Label,{className:"fw-bold",children:"Teléfono *"}),e.jsx(d.Control,{type:"tel",value:i.contact_phone,onChange:l=>r("contact_phone",l.target.value),placeholder:"Número de teléfono",isInvalid:!!u.contact_phone}),u.contact_phone&&e.jsx(d.Control.Feedback,{type:"invalid",children:u.contact_phone})]})}),e.jsx(S,{md:12,children:e.jsxs(d.Group,{children:[e.jsx(d.Label,{className:"fw-bold",children:"Email"}),e.jsx(d.Control,{type:"email",value:i.contact_email,onChange:l=>r("contact_email",l.target.value),placeholder:"Email para comunicación"})]})})]})]}),q=()=>e.jsxs("div",{className:"step-content",children:[e.jsxs("div",{className:"text-center mb-5",children:[e.jsx("div",{className:"d-inline-flex align-items-center justify-content-center rounded-circle bg-warning bg-opacity-10 mb-3",style:{width:"64px",height:"64px"},children:e.jsx(ve,{size:28,className:"text-warning"})}),e.jsx("h3",{className:"fw-bold text-dark mb-2",children:"Requisitos del Proyecto"}),e.jsx("p",{className:"text-muted",children:"Selecciona los tipos de servicios que requiere este proyecto"})]}),e.jsx(Le,{variant:"info",className:"mb-4",children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx(Ue,{className:"me-2"}),e.jsxs("div",{children:[e.jsx("strong",{children:"Selecciona los tipos de servicios que requiere este proyecto"}),e.jsx("br",{}),e.jsx("small",{children:"Esto ayudará a determinar qué áreas del laboratorio trabajarán en el proyecto"})]})]})}),e.jsxs(K,{className:"g-4",children:[e.jsx(S,{md:6,children:e.jsx(h,{className:`h-100 border-0 shadow-sm service-card ${i.requiere_laboratorio?"selected":""}`,style:{borderRadius:"16px",transition:"all 0.3s ease",cursor:"pointer",border:i.requiere_laboratorio?"2px solid #667eea":"2px solid transparent"},onClick:()=>r("requiere_laboratorio",!i.requiere_laboratorio),children:e.jsxs(h.Body,{className:"text-center p-4",children:[e.jsx("div",{className:"service-icon mb-3",children:e.jsx(Ue,{size:48,className:i.requiere_laboratorio?"text-white":"text-primary"})}),e.jsx("h5",{className:"fw-bold mb-2",children:"Laboratorio"}),e.jsx("p",{className:"text-muted small mb-4",children:"Ensayos de laboratorio, análisis de muestras, pruebas técnicas"}),e.jsx(d.Check,{type:"checkbox",id:"requiere_laboratorio",label:"Requiere servicios de laboratorio",checked:i.requiere_laboratorio||!1,onChange:l=>r("requiere_laboratorio",l.target.checked),className:"d-flex justify-content-center",style:{pointerEvents:"none"}})]})})}),e.jsx(S,{md:6,children:e.jsx(h,{className:`h-100 border-0 shadow-sm service-card ${i.requiere_ingenieria?"selected":""}`,style:{borderRadius:"16px",transition:"all 0.3s ease",cursor:"pointer",border:i.requiere_ingenieria?"2px solid #56ab2f":"2px solid transparent"},onClick:()=>r("requiere_ingenieria",!i.requiere_ingenieria),children:e.jsxs(h.Body,{className:"text-center p-4",children:[e.jsx("div",{className:"service-icon mb-3",children:e.jsx(te,{size:48,className:i.requiere_ingenieria?"text-white":"text-success"})}),e.jsx("h5",{className:"fw-bold mb-2",children:"Ingeniería"}),e.jsx("p",{className:"text-muted small mb-4",children:"Diseño, consultoría técnica, supervisión de obras"}),e.jsx(d.Check,{type:"checkbox",id:"requiere_ingenieria",label:"Requiere servicios de ingeniería",checked:i.requiere_ingenieria||!1,onChange:l=>r("requiere_ingenieria",l.target.checked),className:"d-flex justify-content-center",style:{pointerEvents:"none"}})]})})}),e.jsx(S,{md:6,children:e.jsx(h,{className:`h-100 border-0 shadow-sm service-card ${i.requiere_capacitacion?"selected":""}`,style:{borderRadius:"16px",transition:"all 0.3s ease",cursor:"pointer",border:i.requiere_capacitacion?"2px solid #3498db":"2px solid transparent"},onClick:()=>r("requiere_capacitacion",!i.requiere_capacitacion),children:e.jsxs(h.Body,{className:"text-center p-4",children:[e.jsx("div",{className:"service-icon mb-3",children:e.jsx(ps,{size:48,className:i.requiere_capacitacion?"text-white":"text-info"})}),e.jsx("h5",{className:"fw-bold mb-2",children:"Capacitación"}),e.jsx("p",{className:"text-muted small mb-4",children:"Entrenamiento, cursos, formación técnica"}),e.jsx(d.Check,{type:"checkbox",id:"requiere_capacitacion",label:"Requiere servicios de capacitación",checked:i.requiere_capacitacion||!1,onChange:l=>r("requiere_capacitacion",l.target.checked),className:"d-flex justify-content-center",style:{pointerEvents:"none"}})]})})})]}),!i.requiere_laboratorio&&!i.requiere_ingenieria&&!i.requiere_capacitacion&&e.jsxs(Le,{variant:"warning",className:"mt-3",children:[e.jsx(Ge,{className:"me-2"}),"Debes seleccionar al menos un tipo de servicio para el proyecto"]})]}),g=()=>e.jsxs("div",{className:"step-content",children:[e.jsxs("div",{className:"text-center mb-5",children:[e.jsx("div",{className:"d-inline-flex align-items-center justify-content-center rounded-circle bg-info bg-opacity-10 mb-3",style:{width:"64px",height:"64px"},children:e.jsx(ue,{size:28,className:"text-info"})}),e.jsx("h3",{className:"fw-bold text-dark mb-2",children:"Resumen del Proyecto"}),e.jsx("p",{className:"text-muted",children:"Revisa la información antes de crear el proyecto"})]}),e.jsxs(K,{className:"g-4",children:[e.jsx(S,{md:6,children:e.jsxs(h,{children:[e.jsx(h.Header,{children:e.jsx("h6",{className:"mb-0",children:"Información Básica"})}),e.jsxs(h.Body,{children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Proyecto:"})," ",i.name]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Ubicación:"})," ",i.location]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Contacto:"})," ",i.contact_name]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Teléfono:"})," ",i.contact_phone]}),i.contact_email&&e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Email:"})," ",i.contact_email]})]})]})}),e.jsx(S,{md:6,children:e.jsxs(h,{children:[e.jsx(h.Header,{children:e.jsx("h6",{className:"mb-0",children:"Requisitos del Proyecto"})}),e.jsxs(h.Body,{children:[e.jsx("div",{className:"mb-3",children:e.jsx("strong",{children:"Tipos de servicios requeridos:"})}),e.jsxs("div",{className:"d-flex flex-column gap-2",children:[i.requiere_laboratorio&&e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx(Ue,{className:"text-primary me-2"}),e.jsx("span",{children:"Laboratorio"})]}),i.requiere_ingenieria&&e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx(te,{className:"text-success me-2"}),e.jsx("span",{children:"Ingeniería"})]}),i.requiere_capacitacion&&e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx(ps,{className:"text-info me-2"}),e.jsx("span",{children:"Capacitación"})]}),!i.requiere_laboratorio&&!i.requiere_ingenieria&&!i.requiere_capacitacion&&e.jsxs("div",{className:"text-muted",children:[e.jsx(Z,{className:"me-1"}),"No hay requisitos seleccionados"]})]})]})]})})]})]});return e.jsxs("div",{className:"project-form-redesigned",style:{fontFamily:"Inter, -apple-system, BlinkMacSystemFont, sans-serif"},children:[e.jsxs("div",{className:"mb-5",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsx("h4",{className:"mb-0 fw-bold text-dark",children:"Crear Nuevo Proyecto"}),e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsxs("span",{className:"text-muted me-2",children:["Paso ",x," de ",E]}),e.jsx("div",{className:"progress",style:{width:"120px",height:"6px"},children:e.jsx("div",{className:"progress-bar bg-gradient-primary",style:{width:`${x/E*100}%`,background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",borderRadius:"3px"}})})]})]}),e.jsx("div",{className:"step-navigation",children:Array.from({length:E},(l,b)=>{const A=b+1,pe=A===x,se=A<x;return e.jsxs("div",{className:`step-item ${pe?"active":se?"completed":""}`,onClick:()=>D(A),children:[e.jsx("div",{className:"step-icon",children:se?e.jsx(ue,{}):oe(A)}),e.jsxs("div",{className:"step-content",children:[e.jsx("div",{className:"step-title",children:t(A)}),e.jsxs("div",{className:"step-subtitle",children:[A===1&&"Información del cliente y proyecto",A===2&&"Datos de contacto",A===3&&"Tipos de servicios requeridos",A===4&&"Revisar y confirmar"]})]}),A<E&&e.jsx("div",{className:"step-connector"})]},A)})})]}),e.jsx(h,{className:"border-0 shadow-lg mb-4",style:{borderRadius:"16px",overflow:"hidden"},children:e.jsx(h.Body,{className:"p-5",children:e.jsxs("div",{className:"step-content-wrapper",children:[x===1&&n(),x===2&&m(),x===3&&q(),x===4&&g()]})})}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs(N,{variant:"outline-secondary",onClick:H,disabled:x===1,className:"px-4 py-2 rounded-pill",style:{border:"2px solid #e9ecef",fontWeight:"500",minWidth:"120px"},children:[e.jsx(Z,{className:"me-2"}),"Anterior"]}),e.jsxs("div",{className:"d-flex gap-3",children:[x<E?e.jsxs(N,{variant:"primary",onClick:ee,className:"px-5 py-2 rounded-pill fw-bold",style:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",border:"none",minWidth:"140px",boxShadow:"0 4px 15px rgba(102, 126, 234, 0.4)"},children:["Siguiente",e.jsx(ys,{className:"ms-2"})]}):e.jsx(N,{variant:"success",onClick:ne,disabled:C,className:"px-5 py-2 rounded-pill fw-bold",style:{background:"linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%)",border:"none",minWidth:"160px",boxShadow:"0 4px 15px rgba(86, 171, 47, 0.4)"},children:C?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"spinner-border spinner-border-sm me-2",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Cargando..."})}),"Creando..."]}):e.jsxs(e.Fragment,{children:["Crear Proyecto",e.jsx(ue,{className:"ms-2"})]})}),e.jsx(N,{variant:"outline-danger",onClick:f,className:"px-4 py-2 rounded-pill",style:{border:"2px solid #dc3545",color:"#dc3545",fontWeight:"500",minWidth:"120px"},children:"Cancelar"})]})]}),e.jsx("style",{jsx:!0,children:`
        .step-navigation {
          display: flex;
          align-items: center;
          justify-content: space-between;
          position: relative;
          margin: 2rem 0;
        }
        
        .step-item {
          display: flex;
          align-items: center;
          cursor: pointer;
          transition: all 0.3s ease;
          position: relative;
          z-index: 2;
        }
        
        .step-item:hover {
          transform: translateY(-2px);
        }
        
        .step-icon {
          width: 48px;
          height: 48px;
          border-radius: 50%;
          display: flex;
          align-items: center;
          justify-content: center;
          font-size: 20px;
          font-weight: bold;
          transition: all 0.3s ease;
          margin-right: 12px;
          background: #f8f9fa;
          color: #6c757d;
          border: 3px solid #e9ecef;
        }
        
        .step-item.active .step-icon {
          background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
          color: white;
          border-color: #667eea;
          box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }
        
        .step-item.completed .step-icon {
          background: linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%);
          color: white;
          border-color: #56ab2f;
        }
        
        .step-content {
          flex: 1;
        }
        
        .step-title {
          font-weight: 600;
          font-size: 14px;
          color: #495057;
          margin-bottom: 2px;
        }
        
        .step-item.active .step-title {
          color: #667eea;
          font-weight: 700;
        }
        
        .step-item.completed .step-title {
          color: #56ab2f;
        }
        
        .step-subtitle {
          font-size: 12px;
          color: #6c757d;
          line-height: 1.3;
        }
        
        .step-connector {
          position: absolute;
          top: 24px;
          left: 100%;
          width: 100%;
          height: 2px;
          background: #e9ecef;
          z-index: 1;
        }
        
        .step-item.completed + .step-item .step-connector {
          background: linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%);
        }
        
        .step-content-wrapper {
          min-height: 400px;
        }
        
        .bg-gradient-primary {
          background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .service-card {
          transition: all 0.3s ease;
        }
        
        .service-card:hover {
          transform: translateY(-4px);
          box-shadow: 0 8px 25px rgba(0,0,0,0.15) !important;
        }
        
        .service-card.selected {
          transform: translateY(-2px);
          box-shadow: 0 8px 25px rgba(0,0,0,0.2) !important;
        }
        
        .service-card.selected .service-icon {
          background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
          border-radius: 50%;
          width: 80px;
          height: 80px;
          display: flex;
          align-items: center;
          justify-content: center;
          margin: 0 auto 1rem auto;
        }
        
        .service-card:not(.selected) .service-icon {
          background: rgba(0,0,0,0.05);
          border-radius: 50%;
          width: 80px;
          height: 80px;
          display: flex;
          align-items: center;
          justify-content: center;
          margin: 0 auto 1rem auto;
        }
        
        @media (max-width: 768px) {
          .step-navigation {
            flex-direction: column;
            align-items: flex-start;
          }
          
          .step-item {
            width: 100%;
            margin-bottom: 1rem;
          }
          
          .step-connector {
            display: none;
          }
        }
      `})]})}const ka={company_id:"",name:"",location:"",vendedor_id:"",laboratorio_id:"",requiere_laboratorio:!1,requiere_ingenieria:!1,requiere_consultoria:!1,requiere_capacitacion:!1,requiere_auditoria:!1,contact_name:"",contact_phone:"",contact_email:"",queries:"",priority:"normal",marked:!1};function ei(){var ms,hs,us,xs;const{user:y}=Zs(),[_,C]=c.useState(!1),[f,i]=c.useState(null),[P,x]=c.useState(null),[D,u]=c.useState(null),[v,k]=c.useState(null),[X,L]=c.useState(!1),[M,V]=c.useState(!1),[R,Q]=c.useState(!1),[$,E]=c.useState(!1),[r,p]=c.useState(null),[j,z]=c.useState("info"),[U,ee]=c.useState([]),[H,ne]=c.useState(null),[oe,t]=c.useState(!1),[n,m]=c.useState({}),[q,g]=c.useState(!1),[l,b]=c.useState(""),[A,pe]=c.useState("success"),[se,Ne]=c.useState(""),[_e,we]=c.useState(""),[vs,Se]=c.useState(!1),[Ns,Ce]=c.useState(!1),[le,We]=c.useState(""),[W,Je]=c.useState([]),[_s,Ie]=c.useState(!1),[Ea,Aa]=c.useState(!0),[ws,qe]=c.useState(!1),[Me,$e]=c.useState(1),[Ye,Ss]=c.useState(""),[Xe,Cs]=c.useState(""),[Ke,qs]=c.useState(""),[Ze,ks]=c.useState(""),[es,Es]=c.useState(""),[As,ss]=c.useState(!1),Be=ea(),as=sa(),De=new URLSearchParams(as.search).get("view"),ae=(ms=as.state)==null?void 0:ms.selectedClient,ke=aa(),{data:w,isLoading:is,refetch:Fs}=ye(["projects",Me,Ye,Xe,Ke,Ze,es],()=>ga({page:Me,limit:20,search:Ye,status:Xe,company_id:Ke,project_type:Ze,priority:es}),{keepPreviousData:!0,refetchOnWindowFocus:!1,refetchOnMount:!1,staleTime:3e4,cacheTime:3e5,retry:2,retryDelay:1e3}),{data:B,isLoading:za}=ye("users",()=>va(),{keepPreviousData:!0,refetchOnWindowFocus:!1,staleTime:3e5,cacheTime:6e5}),{data:J,isLoading:Ee}=ye(["projectStats"],ba,{refetchOnWindowFocus:!1,refetchOnMount:!1,staleTime:6e4,cacheTime:3e5,retry:1,onSuccess:s=>{console.log("📊 Frontend - Estadísticas recibidas:",s),console.log("📊 Frontend - alta_prioridad:",s==null?void 0:s.alta_prioridad)}});c.useEffect(()=>{if(De&&(w!=null&&w.data)){const s=w.data.find(a=>a.id==De);s&&(ds(s),Be("/proyectos",{replace:!0}))}},[De,w==null?void 0:w.data]),c.useEffect(()=>{(async()=>{if(r!=null&&r.id)try{const a=await Oe(r.id);ee(a)}catch(a){console.error("Error al cargar adjuntos:",a)}})()},[r==null?void 0:r.id,R]),c.useEffect(()=>{const s=a=>{a.target.closest(".position-relative")||(Se(!1),Ce(!1))};return document.addEventListener("mousedown",s),()=>{document.removeEventListener("mousedown",s)}},[]);const ge=s=>{ke.invalidateQueries("projects"),ke.invalidateQueries("projectStats"),C(!1),i(null),x(null)},T=(s,a="success")=>{b(s),pe(a),g(!0),setTimeout(()=>{g(!1)},5e3)},zs=s=>{console.log("🔍 handleSearch - Búsqueda:",s),Ss(s),$e(1),ss(!0),setTimeout(()=>ss(!1),1e3)},Ts=s=>{console.log("🔍 handleFilter - Filtros:",s),Cs(s.status||""),qs(s.company_id||""),ks(s.project_type||""),Es(s.priority||""),$e(1)},Ps=s=>{const a=s.target.files[0];a&&ne(a)},Ls=async()=>{if(!H||!(r!=null&&r.id)){T("❌ Por favor selecciona un archivo","danger");return}t(!0);try{const s=new FormData;s.append("file",H),s.append("description",`Archivo subido: ${H.name}`),await ja(r.id,s);const a=await Oe(r.id);ee(a),ne(null),t(!1),T("✅ Archivo subido correctamente","success")}catch(s){console.error("Error al subir archivo:",s),t(!1),T("❌ Error al subir archivo","danger")}},rs=async s=>{try{await fa(s),T("✅ Archivo descargado correctamente","success")}catch(a){console.error("Error al descargar archivo:",a),T("❌ Error al descargar archivo","danger")}},Is=async s=>{u(s)},Ms=async()=>{try{await ya(D);const s=await Oe(r.id);ee(s),T("✅ Archivo eliminado correctamente","success"),u(null)}catch(s){console.error("Error al eliminar archivo:",s),T("❌ Error al eliminar archivo","danger"),u(null)}},$s=s=>{m({...n,vendedor_id:s.id}),Ne(`${s.name} ${s.apellido}`),Se(!1),s.id&&r&&ts(s.id,"vendedor",r)},Bs=s=>{m({...n,laboratorio_id:s.id}),we(`${s.name} ${s.apellido}`),Ce(!1),s.id&&r&&ts(s.id,"laboratorio",r)},ts=async(s,a,o)=>{try{const Y="http://localhost:4000/api".replace(/\/api$/,""),ce=localStorage.getItem("token"),ie=new Date,re=ie.toLocaleString("es-PE",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}),O=a==="vendedor"?"vendedor comercial responsable":"usuario de laboratorio responsable",G={user_id:s,type:"project_assignment",title:`🎯 Proyecto Asignado - ${o.name}`,message:`Se te ha asignado el proyecto "${o.name}" como ${O}.

📅 Fecha y hora: ${re}
🏢 Empresa: ${o.company_name||"No especificada"}
📍 Ubicación: ${o.location||"No especificada"}
📞 Contacto: ${o.contact_name||"No especificado"}`,project_id:o.id,priority:"high",metadata:{assignment_date:ie.toISOString(),role:a,project_name:o.name,company_name:o.company_name}};console.log("📤 Enviando notificación:",G);const de=await fetch(`${Y}/api/notifications`,{method:"POST",headers:{Authorization:`Bearer ${ce}`,"Content-Type":"application/json"},body:JSON.stringify(G)});if(de.ok){const Re=await de.json();console.log("✅ Notificación enviada exitosamente:",Re),T(`✅ Notificación enviada al ${O} - ${re}`,"success")}else{const Re=await de.text();console.warn("⚠️ No se pudo enviar la notificación:",de.status,Re),T(`⚠️ Error enviando notificación al ${O}`,"warning")}}catch(F){console.error("❌ Error enviando notificación:",F),T(`❌ Error enviando notificación al ${a==="vendedor"?"vendedor comercial":"usuario de laboratorio"}`,"danger")}},ns=()=>B!=null&&B.data?B.data.filter(s=>{var a;return s.role==="vendedor_comercial"&&(se===""||`${s.name} ${s.apellido}`.toLowerCase().includes(se.toLowerCase())||((a=s.email)==null?void 0:a.toLowerCase().includes(se.toLowerCase())))}):[],os=()=>B!=null&&B.data?B.data.filter(s=>{var a;return s.role==="usuario_laboratorio"&&(_e===""||`${s.name} ${s.apellido}`.toLowerCase().includes(_e.toLowerCase())||((a=s.email)==null?void 0:a.toLowerCase().includes(_e.toLowerCase())))}):[],Ds=[{title:"Por Estado",options:[{label:"Pendientes",filter:{status:"pendiente"}},{label:"Activos",filter:{status:"activo"}},{label:"Completados",filter:{status:"completado"}},{label:"Cancelados",filter:{status:"cancelado"}}]},{title:"Por Prioridad",options:[{label:"🔴 Urgente",filter:{priority:"urgent"}},{label:"🟠 Alta",filter:{priority:"high"}},{label:"🔵 Activo",filter:{priority:"active"}},{label:"🟢 Normal",filter:{priority:"normal"}},{label:"🔵 Baja",filter:{priority:"low"}}]},{title:"Por Tipo de Proyecto",options:[{label:"Análisis de Suelos",filter:{project_type:"Análisis de Suelos"}},{label:"Estudio Geotécnico",filter:{project_type:"Estudio Geotécnico"}},{label:"Evaluación Ambiental",filter:{project_type:"Evaluación Ambiental"}},{label:"Control de Calidad",filter:{project_type:"Control de Calidad"}},{label:"Análisis de Agua",filter:{project_type:"Análisis de Agua"}},{label:"Estudio de Impacto",filter:{project_type:"Estudio de Impacto"}},{label:"Análisis Químico",filter:{project_type:"Análisis Químico"}},{label:"Pruebas de Laboratorio",filter:{project_type:"Pruebas de Laboratorio"}},{label:"Inspección Técnica",filter:{project_type:"Inspección Técnica"}},{label:"Certificación de Materiales",filter:{project_type:"Certificación de Materiales"}}]}],Ae=me(da,{onSuccess:()=>ge(),onError:s=>console.error("Error creating project:",s)}),Fe=me(({id:s,data:a})=>ma(s,a),{onSuccess:s=>{console.log("✅ updateMutation - Success:",s),p(s);const a={...s,queries_history:(()=>{try{if(s.queries_history&&Array.isArray(s.queries_history))return s.queries_history;if(s.queries_history&&typeof s.queries_history=="string"){const o=JSON.parse(s.queries_history);return Array.isArray(o)?o:[]}return[]}catch(o){return console.warn("❌ Error procesando queries_history en updateMutation:",o),[]}})()};m(a),T("✅ Proyecto actualizado exitosamente!","success"),ke.invalidateQueries(["projects"])},onError:s=>{console.error("❌ updateMutation - Error:",s),T("❌ Error al actualizar proyecto","danger")}}),ls=me(ha,{onSuccess:()=>ge(),onError:s=>console.error("Error deleting project:",s)});me(({id:s,...a})=>ua(s,a),{onSuccess:s=>{p(s);const a={...s,queries_history:(()=>{try{if(s.queries_history&&Array.isArray(s.queries_history))return s.queries_history;if(s.queries_history&&typeof s.queries_history=="string"){const o=JSON.parse(s.queries_history);return Array.isArray(o)?o:[]}return[]}catch(o){return console.warn("❌ Error procesando queries_history en updateStatusMutation:",o),[]}})()};m(a),ge()},onError:s=>console.error("Error updating project status:",s)}),me(({id:s,...a})=>xa(s,a),{onSuccess:s=>{p(s);const a={...s,queries_history:(()=>{try{if(s.queries_history&&Array.isArray(s.queries_history))return s.queries_history;if(s.queries_history&&typeof s.queries_history=="string"){const o=JSON.parse(s.queries_history);return Array.isArray(o)?o:[]}return[]}catch(o){return console.warn("❌ Error procesando queries_history en updateQueriesMutation:",o),[]}})()};m(a),ge()},onError:s=>console.error("Error updating project queries:",s)}),me(({id:s,...a})=>pa(s,a),{onSuccess:s=>{p(s);const a={...s,queries_history:(()=>{try{if(s.queries_history&&Array.isArray(s.queries_history))return s.queries_history;if(s.queries_history&&typeof s.queries_history=="string"){const o=JSON.parse(s.queries_history);return Array.isArray(o)?o:[]}return[]}catch(o){return console.warn("❌ Error procesando queries_history en updateMarkMutation:",o),[]}})()};m(a),ge()},onError:s=>console.error("Error updating project mark:",s)});const Rs=s=>{i(s),C(!0)},cs=s=>{x(s)},Us=async()=>{try{await ls.mutateAsync(P.id),x(null)}catch(s){console.error("Error eliminando proyecto:",s),x(null)}},Vs=async()=>{try{console.log("Marcar/desmarcar proyecto:",v),T(`Proyecto ${v.marked?"desmarcado":"marcado"}: ${v.name}`,"success"),k(null)}catch(s){console.error("Error al marcar proyecto:",s),T("Error al marcar proyecto","danger"),k(null)}},Os=s=>{p(s),E(!0)},ds=s=>{console.log("🔍 handleViewProject - Project recibido:",s),console.log("🔍 handleViewProject - Project.id:",s==null?void 0:s.id),console.log("🔍 handleViewProject - Type of project.id:",typeof(s==null?void 0:s.id)),console.log("🔍 handleViewProject - Project.queries:",s==null?void 0:s.queries),console.log("🔍 handleViewProject - Project.queries_history:",s==null?void 0:s.queries_history),p(s);const a={...s,requiere_laboratorio:s.requiere_laboratorio||!1,requiere_ingenieria:s.requiere_ingenieria||!1,requiere_consultoria:s.requiere_consultoria||!1,requiere_capacitacion:s.requiere_capacitacion||!1,requiere_auditoria:s.requiere_auditoria||!1,marked:s.marked||!1,priority:s.priority||"normal",queries:s.queries||"",contact_name:s.contact_name||"",contact_phone:s.contact_phone||"",contact_email:s.contact_email||"",category_id:s.category_id||"",subcategory_id:s.subcategory_id||"",category_name:s.category_name||"",subcategory_name:s.subcategory_name||"",vendedor_id:s.vendedor_id||"",laboratorio_id:s.laboratorio_id||"",queries_history:(()=>{try{if(console.log("🔍 Parseando queries_history - project.queries_history:",s.queries_history),console.log("🔍 Parseando queries_history - project.queries:",s.queries),s.queries_history&&Array.isArray(s.queries_history))return console.log("✅ Usando project.queries_history como array:",s.queries_history),s.queries_history;if(s.queries&&typeof s.queries=="string")try{const o=JSON.parse(s.queries);if(console.log("✅ Parseado project.queries como JSON:",o),Array.isArray(o))return o}catch{if(console.log("⚠️ project.queries no es JSON válido, tratando como texto plano"),s.queries.trim()){const F={message:s.queries.trim(),user_name:"Usuario Anterior",created_at:new Date().toISOString()};return console.log("✅ Creado historial desde texto plano:",F),[F]}}return console.log("⚠️ No se encontró queries_history válido, retornando array vacío"),[]}catch(o){return console.warn("❌ Error parseando queries_history:",o),[]}})()};console.log("🔍 handleViewProject - editingData inicializado:",a),m(a),s.vendedor_name?Ne(s.vendedor_name):Ne(""),s.laboratorio_name?we(s.laboratorio_name):we(""),z("info"),Q(!0)},Hs=async s=>{f.id?await Fe.mutateAsync({id:f.id,...s}):await Ae.mutateAsync(s)},Gs=s=>{const o={activo:{bg:"success",text:"Activo"},pendiente:{bg:"warning",text:"Pendiente"},completado:{bg:"primary",text:"Completado"},cancelado:{bg:"danger",text:"Cancelado"}}[s]||{bg:"secondary",text:s};return e.jsx(I,{bg:o.bg,className:"status-badge",children:o.text})},Qs=[{header:"ID",accessor:"id",width:"60px"},{header:"Proyecto",accessor:"name",render:(s,a)=>e.jsxs("div",{children:[e.jsx("div",{className:"fw-medium",children:a.name}),a.location&&e.jsxs("small",{className:"text-muted",children:[e.jsx(na,{size:12,className:"me-1"}),a.location]}),a.project_type&&e.jsx("div",{className:"mt-1",children:e.jsx(I,{bg:"outline-secondary",size:"sm",className:"px-1 py-0 small",children:a.project_type})})]})},{header:"Empresa",accessor:"company_name",render:(s,a)=>e.jsxs("div",{children:[e.jsx("div",{className:"fw-medium",children:a.company_name||"Sin empresa"}),a.contact_name&&e.jsxs("small",{className:"text-muted",children:[e.jsx(xe,{size:12,className:"me-1"}),a.contact_name]})]})},{header:"Estado",accessor:"status",width:"100px",render:s=>Gs(s||"activo")},{header:"Servicios",accessor:"services",width:"180px",className:"d-none d-lg-table-cell",render:(s,a)=>{if(a.requiere_laboratorio){const F={no_requerido:"N/A",pendiente:"Pendiente",en_proceso:"En Proceso",completado:"Completado"}[a.laboratorio_status]||"N/A";return e.jsxs("div",{className:"d-flex flex-column gap-1",children:[e.jsx(I,{bg:"info",size:"sm",className:"px-2",children:"🔬 Laboratorio"}),e.jsx("span",{className:"small text-muted",children:F})]})}if(a.requiere_ingenieria){const F={no_requerido:"N/A",pendiente:"Pendiente",en_proceso:"En Proceso",completado:"Completado"}[a.ingenieria_status]||"N/A";return e.jsxs("div",{className:"d-flex flex-column gap-1",children:[e.jsx(I,{bg:"primary",size:"sm",className:"px-2",children:"⚙️ Ingeniería"}),e.jsx("span",{className:"small text-muted",children:F})]})}return a.requiere_consultoria?e.jsx(I,{bg:"success",size:"sm",className:"px-2",children:"💼 Consultoría"}):e.jsx(I,{bg:"secondary",size:"sm",className:"px-1",children:"N/A"})}},{header:"Prioridad",accessor:"priority",width:"100px",render:(s,a)=>{const F=(Y=>{switch(Y){case"urgent":return{emoji:"🔴",text:"Urgente",color:"text-danger"};case"high":return{emoji:"🟠",text:"Alta",color:"text-warning"};case"active":return{emoji:"🔵",text:"Activo",color:"text-info"};case"low":return{emoji:"🔵",text:"Baja",color:"text-primary"};case"normal":default:return{emoji:"🟢",text:"Normal",color:"text-success"}}})(a.priority);return e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("span",{className:"me-1",style:{fontSize:"1em"},children:F.emoji}),e.jsx("span",{className:`small ${F.color} fw-medium`,children:F.text}),(a.priority==="urgent"||a.priority==="high")&&a.requiere_laboratorio&&e.jsx(Ge,{className:"text-warning ms-1",size:12})]})}},{header:"Asignado a",accessor:"vendedor_name",className:"d-none d-md-table-cell",render:(s,a)=>e.jsxs("div",{children:[a.vendedor_name&&e.jsxs("div",{className:"small",children:[e.jsx(xe,{size:12,className:"me-1 text-muted"}),e.jsx("span",{children:a.vendedor_name})]}),a.laboratorio_name&&e.jsxs("div",{className:"small text-muted mt-1",children:[e.jsx(te,{size:12,className:"me-1"}),e.jsx("span",{children:a.laboratorio_name})]}),!a.vendedor_name&&!a.laboratorio_name&&e.jsx("span",{className:"text-muted small",children:"Sin asignar"})]})},{header:"Fecha",accessor:"created_at",width:"100px",className:"d-none d-xl-table-cell",render:s=>{if(!s)return"-";const a=new Date(s);return e.jsx("div",{className:"small",children:e.jsx("div",{children:a.toLocaleDateString("es-ES")})})}}],Ws=[{name:"company_id",label:"Empresa/Cliente",type:"select",required:!0,options:((hs=w==null?void 0:w.companies)==null?void 0:hs.map(s=>({value:s.id,label:`${s.name} (${s.ruc||s.dni||"Sin RUC/DNI"})`})))||[],description:"Selecciona un cliente existente o crea uno nuevo desde el módulo de clientes"},{name:"name",label:"Nombre del Proyecto",type:"text",required:!0,placeholder:"Ingresa el nombre del proyecto"},{name:"location",label:"Ubicación del Proyecto",type:"text",placeholder:"Ingresa la ubicación del proyecto",required:!0},{name:"contact_name",label:"Persona de Contacto",type:"text",placeholder:"Nombre de la persona con quien negociar",description:"Persona responsable del proyecto en el cliente"},{name:"contact_phone",label:"Teléfono de Contacto",type:"text",placeholder:"Teléfono para comunicación directa",description:"Número para llamadas urgentes o seguimiento"},{name:"contact_email",label:"Email de Contacto",type:"email",placeholder:"Email para comunicación",description:"Email para envío de reportes y documentos"},{name:"requiere_laboratorio",label:"Requiere Laboratorio",type:"checkbox",description:"Marcar si el proyecto necesita servicios de laboratorio"},{name:"requiere_ingenieria",label:"Requiere Ingeniería",type:"checkbox",description:"Marcar si el proyecto necesita servicios de ingeniería"},{name:"requiere_consultoria",label:"Requiere Consultoría",type:"checkbox",description:"Marcar si el proyecto necesita servicios de consultoría"},{name:"requiere_capacitacion",label:"Requiere Capacitación",type:"checkbox",description:"Marcar si el proyecto necesita servicios de capacitación"},{name:"requiere_auditoria",label:"Requiere Auditoría",type:"checkbox",description:"Marcar si el proyecto necesita servicios de auditoría"},{name:"queries",label:"Consultas del Cliente",type:"textarea",placeholder:"Ingresa las consultas o dudas del cliente...",description:"Preguntas o dudas específicas del cliente sobre el proyecto"},{name:"services",label:"Servicios del Proyecto",type:"custom",component:e.jsxs("div",{children:[e.jsx("div",{className:"mb-3",children:e.jsxs(N,{variant:"outline-primary",onClick:()=>Ie(!0),className:"w-100",children:[e.jsx(ve,{className:"me-2"}),W.length>0?`Configurar Servicios (${W.length} seleccionados)`:"Seleccionar Servicios"]})}),W.length>0&&e.jsxs("div",{className:"border rounded p-3 bg-light",children:[e.jsx("h6",{className:"mb-2",children:"Servicios Seleccionados:"}),W.map((s,a)=>e.jsx("div",{className:"mb-2 p-2 border rounded bg-white",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-start",children:[e.jsxs("div",{children:[e.jsx("strong",{children:s.ensayo.name}),e.jsx("div",{className:"small text-muted",children:s.subservices.map(o=>o.codigo).join(", ")})]}),e.jsxs("div",{className:"text-end",children:[e.jsxs("div",{className:"fw-bold text-success",children:["S/ ",s.total.toFixed(2)]}),e.jsx(N,{variant:"outline-danger",size:"sm",onClick:()=>{const o=W.filter((F,Y)=>Y!==a);Je(o)},children:e.jsx(Z,{size:12})})]})]})},a)),e.jsxs("div",{className:"mt-2 pt-2 border-top",children:[e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsx("strong",{children:"Subtotal:"}),e.jsxs("strong",{children:["S/ ",W.reduce((s,a)=>s+a.total,0).toFixed(2)]})]}),e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsx("span",{children:"IGV (18%):"}),e.jsxs("span",{children:["S/ ",(W.reduce((s,a)=>s+a.total,0)*.18).toFixed(2)]})]}),e.jsxs("div",{className:"d-flex justify-content-between fw-bold text-success",children:[e.jsx("span",{children:"Total:"}),e.jsxs("span",{children:["S/ ",(W.reduce((s,a)=>s+a.total,0)*1.18).toFixed(2)]})]})]})]})]})},{name:"priority",label:"Prioridad del Proyecto",type:"select",options:[{value:"low",label:"Baja"},{value:"normal",label:"Normal"},{value:"high",label:"Alta"},{value:"urgent",label:"Urgente"}],description:"Nivel de prioridad para la ejecución del proyecto"},{name:"vendedor_id",label:"Vendedor Asignado",type:"select",options:((us=B==null?void 0:B.data)==null?void 0:us.filter(s=>s.role==="vendedor_comercial").map(s=>({value:s.id,label:`${s.name} ${s.apellido}`})))||[]},{name:"laboratorio_id",label:"Responsable de Laboratorio",type:"select",options:((xs=B==null?void 0:B.data)==null?void 0:xs.filter(s=>s.role==="usuario_laboratorio").map(s=>({value:s.id,label:`${s.name} ${s.apellido}`})))||[]}],be=c.useMemo(()=>{if(J)return console.log("📊 Stats - Usando estadísticas reales del backend:",J),{total:J.total||0,activos:J.activos||0,completados:J.completados||0,pendientes:J.pendientes||0,cancelados:J.cancelados||0,alta_prioridad:J.alta_prioridad||0};const s=(w==null?void 0:w.data)||[];return console.log("📊 Stats - Fallback: calculando desde página actual:",s),{total:s.length,activos:s.filter(a=>a.status==="activo").length,completados:s.filter(a=>a.status==="completado").length,pendientes:s.filter(a=>a.status==="pendiente").length,cancelados:s.filter(a=>a.status==="cancelado").length,alta_prioridad:s.filter(a=>a.priority==="urgent"||a.priority==="high").length}},[J,w]);return e.jsxs(e.Fragment,{children:[e.jsx(ca,{fluid:!0,className:"py-4",children:e.jsxs("div",{className:"fade-in",children:[e.jsx(oa,{title:"Gestión de Proyectos",subtitle:ae?`Crear proyecto para: ${ae.name}`:"Crear, editar y gestionar proyectos del sistema",icon:te,actions:e.jsxs("div",{className:"d-flex gap-2",children:[ae&&e.jsxs(I,{bg:"info",className:"px-3 py-2 d-flex align-items-center",children:[e.jsx(xe,{className:"me-1"}),"Cliente: ",ae.name]}),e.jsxs(N,{variant:"primary",onClick:()=>qe(!0),children:[e.jsx(ys,{className:"me-2"}),ae?"Crear Proyecto":"Nuevo Proyecto"]})]})}),e.jsxs(K,{className:"g-2 mb-4",children:[e.jsx(S,{md:6,lg:3,children:e.jsx(ze,{title:"Total Proyectos",value:be.total,icon:te,color:"primary",subtitle:"Proyectos registrados",loading:Ee,size:"compact"})}),e.jsx(S,{md:6,lg:3,children:e.jsx(ze,{title:"Proyectos Activos",value:be.activos,icon:ue,color:"success",subtitle:"En desarrollo",loading:Ee,size:"compact"})}),e.jsx(S,{md:6,lg:3,children:e.jsx(ze,{title:"Alta Prioridad",value:be.alta_prioridad||0,icon:Ge,color:"danger",subtitle:"🔴 Urgente + 🟠 Alta",loading:Ee,size:"compact"})}),e.jsx(S,{md:6,lg:3,children:e.jsx(ze,{title:"Pendientes",value:be.pendientes,icon:He,color:"warning",subtitle:"Por iniciar",loading:Ee,size:"compact"})})]}),e.jsxs(h,{className:"shadow-sm border-0",children:[e.jsx(h.Header,{className:"bg-white border-bottom",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("h5",{className:"mb-0",children:[e.jsx(te,{className:"me-2 text-primary"}),"Lista de Proyectos"]}),e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx(N,{variant:"outline-secondary",size:"sm",onClick:()=>Fs(),className:"d-flex align-items-center",title:"Actualizar datos",children:e.jsx(ia,{className:`${is?"spinning":""}`})}),e.jsxs(I,{bg:"light",text:"dark",className:"px-3 py-2",children:[be.total," proyectos"]})]})]})}),e.jsx(h.Body,{className:"p-0",children:e.jsx(la,{data:(w==null?void 0:w.data)||[],columns:Qs,loading:is||As,onEdit:Rs,onDelete:cs,actions:[{label:"Ver",icon:ra,onClick:Os,variant:"primary",style:{backgroundColor:"#f84616",borderColor:"#f84616"}},{label:"Eliminar",icon:gs,onClick:cs,variant:"outline-danger"}],emptyMessage:"No hay proyectos registrados",totalItems:(w==null?void 0:w.total)||0,itemsPerPage:20,currentPage:Me,onPageChange:$e,onSearch:zs,onFilter:Ts,filterOptions:Ds,getRowClassName:s=>s.status==="cancelado"?"table-secondary opacity-50 text-muted":""})})]}),e.jsx(Te,{show:_,onHide:()=>C(!1),title:f!=null&&f.id?"Editar Proyecto":"Nuevo Proyecto",data:f||ka,fields:Ws,onSubmit:Hs,loading:Ae.isLoading||Fe.isLoading,submitText:f!=null&&f.id?"Actualizar":"Crear"}),e.jsx(Te,{show:R,onHide:()=>Q(!1),title:`📋 Gestionar Proyecto - ${(r==null?void 0:r.name)||""}`,data:{...n,queries_history:Array.isArray(n==null?void 0:n.queries_history)?n.queries_history:[]},size:"xl",fields:[{name:"project_management",label:"Gestión del Proyecto",type:"custom",render:s=>e.jsxs("div",{className:"project-management-modal",children:[e.jsx("style",{children:`
                  .project-management-modal {
                    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
                  }
                  .project-header {
                    background: #f84616;
                    color: white;
                    padding: 1.5rem;
                    border-radius: 12px;
                    margin-bottom: 2rem;
                    box-shadow: 0 8px 25px rgba(248, 70, 22, 0.3);
                  }
                  .project-header h4 {
                    margin: 0;
                    font-weight: 600;
                    font-size: 1.5rem;
                  }
                  .project-header .project-id {
                    background: rgba(255, 255, 255, 0.2);
                    padding: 0.5rem 1rem;
                    border-radius: 20px;
                    font-size: 0.9rem;
                    margin-top: 0.5rem;
                    display: inline-block;
                  }
                  .info-card {
                    background: white;
                    border-radius: 12px;
                    padding: 1.5rem;
                    margin-bottom: 1.5rem;
                    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
                    border: 1px solid #e9ecef;
                  }
                  .info-card h6 {
                    color: #495057;
                    font-weight: 600;
                      margin-bottom: 1rem;
                    padding-bottom: 0.5rem;
                    border-bottom: 2px solid #f8f9fa;
                  }
                  .info-grid {
                    display: grid;
                    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                    gap: 1rem;
                  }
                  .info-item {
                    display: flex;
                    flex-direction: column;
                    gap: 0.25rem;
                    }
                    .info-item label {
                      font-size: 0.75rem;
                      font-weight: 600;
                    color: #6c757d;
                      text-transform: uppercase;
                      letter-spacing: 0.5px;
                  }
                  .info-item .value {
                    font-weight: 500;
                    color: #212529;
                    font-size: 0.95rem;
                  }
                  .priority-badge {
                    display: inline-flex;
                    align-items: center;
                    gap: 0.5rem;
                    padding: 0.5rem 1rem;
                    border-radius: 20px;
                    font-weight: 600;
                    font-size: 0.85rem;
                  }
                  .priority-urgent { background: #fee2e2; color: #dc2626; }
                  .priority-high { background: #fef3c7; color: #d97706; }
                  .priority-normal { background: #d1fae5; color: #059669; }
                  .priority-low { background: #e0e7ff; color: #3730a3; }
                  .status-badge {
                    padding: 0.5rem 1rem;
                    border-radius: 20px;
                    font-weight: 600;
                    font-size: 0.85rem;
                  }
                  .status-pendiente { background: #fef3c7; color: #d97706; }
                  .status-activo { background: #d1fae5; color: #059669; }
                  .status-completado { background: #dbeafe; color: #2563eb; }
                  .status-cancelado { background: #fee2e2; color: #dc2626; }
                  .form-control, .form-select {
                    border-radius: 8px;
                    border: 1px solid #d1d5db;
                    padding: 0.75rem;
                    font-size: 0.9rem;
                    transition: all 0.2s ease;
                  }
                  .form-control:focus, .form-select:focus {
                    border-color: #f84616;
                    box-shadow: 0 0 0 3px rgba(248, 70, 22, 0.1);
                  }
                  .btn-primary {
                    background: #f84616;
                    border: none;
                    border-radius: 8px;
                    padding: 0.75rem 2rem;
                    font-weight: 600;
                    transition: all 0.2s ease;
                  }
                  .btn-primary:hover {
                    background: #e03d14;
                    transform: translateY(-2px);
                    box-shadow: 0 8px 25px rgba(248, 70, 22, 0.3);
                  }
                  .btn-secondary {
                    border-radius: 8px;
                    padding: 0.75rem 2rem;
                    font-weight: 600;
                  }
                  .file-upload-area {
                    border: 2px dashed #d1d5db;
                    border-radius: 12px;
                    padding: 2rem;
                    text-align: center;
                    background: #f9fafb;
                    transition: all 0.2s ease;
                    cursor: pointer;
                  }
                  .file-upload-area:hover {
                    border-color: #f84616;
                    background: #fff5f2;
                  }
                  .file-item {
                    background: white;
                    border: 1px solid #e5e7eb;
                    border-radius: 8px;
                    padding: 1rem;
                    margin-bottom: 0.5rem;
                    display: flex;
                    align-items: center;
                    justify-content: space-between;
                  }
                  .file-item:hover {
                    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
                    }
                  `}),e.jsxs("div",{className:"project-header",children:[e.jsxs("h4",{children:["📋 ",s.name]}),e.jsxs("div",{className:"project-id",children:["ID: #",s.id]})]}),e.jsxs("div",{className:"row g-4",children:[e.jsxs("div",{className:"col-lg-8",children:[e.jsxs("div",{className:"info-card",children:[e.jsx("h6",{children:"📊 Información del Proyecto"}),e.jsxs("div",{className:"info-grid",children:[e.jsxs("div",{className:"info-item",children:[e.jsx("label",{children:"Ubicación"}),e.jsx("div",{className:"value",children:s.location||"No especificada"})]}),e.jsxs("div",{className:"info-item",children:[e.jsx("label",{children:"Estado Actual"}),e.jsx("div",{children:e.jsx("span",{className:`status-badge status-${s.status||"pendiente"}`,children:s.status==="pendiente"?"Pendiente":s.status==="activo"?"Activo":s.status==="completado"?"Completado":s.status==="cancelado"?"Cancelado":s.status})})]}),e.jsxs("div",{className:"info-item",children:[e.jsx("label",{children:"Prioridad"}),e.jsx("div",{children:e.jsx("span",{className:`priority-badge priority-${s.priority||"normal"}`,children:s.priority==="urgent"?"🔴 Urgente":s.priority==="high"?"🟠 Alta":s.priority==="normal"?"🟢 Normal":s.priority==="low"?"🔵 Baja":"🟢 Normal"})})]})]})]}),e.jsxs("div",{className:"info-card",children:[e.jsx("h6",{children:"🏢 Información de la Empresa"}),e.jsxs("div",{className:"info-grid",children:[e.jsxs("div",{className:"info-item",children:[e.jsx("label",{children:"Empresa"}),e.jsx("div",{className:"value fw-bold",children:s.company_name||"Sin empresa"})]}),e.jsxs("div",{className:"info-item",children:[e.jsx("label",{children:"RUC"}),e.jsx("div",{className:"value",children:s.company_ruc||"Sin RUC"})]}),e.jsxs("div",{className:"info-item",children:[e.jsx("label",{children:"Contacto"}),e.jsx("div",{className:"value fw-bold",children:s.contact_name||"Sin contacto"})]}),e.jsxs("div",{className:"info-item",children:[e.jsx("label",{children:"Teléfono"}),e.jsx("div",{className:"value",children:s.contact_phone||"Sin teléfono"})]}),e.jsxs("div",{className:"info-item",children:[e.jsx("label",{children:"Email"}),e.jsx("div",{className:"value",children:s.contact_email||"Sin email"})]}),e.jsxs("div",{className:"info-item",children:[e.jsx("label",{children:"Vendedor Asignado"}),e.jsxs("div",{className:"position-relative",children:[e.jsx("input",{type:"text",className:"form-control form-control-sm",placeholder:"Buscar vendedor...",value:se,onChange:a=>{Ne(a.target.value),Se(!0)},onFocus:()=>Se(!0)}),vs&&e.jsx("div",{className:"position-absolute w-100 bg-white border rounded shadow-lg",style:{zIndex:1e3,maxHeight:"200px",overflowY:"auto"},children:ns().length>0?ns().map(a=>e.jsxs("div",{className:"p-2 border-bottom cursor-pointer hover-bg-light",onClick:()=>$s(a),style:{cursor:"pointer"},children:[e.jsxs("div",{className:"fw-bold",children:[a.name," ",a.apellido]}),e.jsxs("div",{className:"small text-muted",children:["📧 ",a.email,a.phone&&e.jsxs("span",{children:[" • 📞 ",a.phone]})]}),e.jsx("div",{className:"small",children:e.jsx("span",{className:"badge bg-primary",children:"Vendedor Comercial"})})]},a.id)):e.jsx("div",{className:"p-2 text-muted",children:"No se encontraron vendedores"})})]})]}),e.jsxs("div",{className:"info-item",children:[e.jsx("label",{children:"Responsable Laboratorio"}),e.jsxs("div",{className:"position-relative",children:[e.jsx("input",{type:"text",className:"form-control form-control-sm",placeholder:"Buscar responsable de laboratorio...",value:_e,onChange:a=>{we(a.target.value),Ce(!0)},onFocus:()=>Ce(!0)}),Ns&&e.jsx("div",{className:"position-absolute w-100 bg-white border rounded shadow-lg",style:{zIndex:1e3,maxHeight:"200px",overflowY:"auto"},children:os().length>0?os().map(a=>e.jsxs("div",{className:"p-2 border-bottom cursor-pointer hover-bg-light",onClick:()=>Bs(a),style:{cursor:"pointer"},children:[e.jsxs("div",{className:"fw-bold",children:[a.name," ",a.apellido]}),e.jsxs("div",{className:"small text-muted",children:["📧 ",a.email,a.phone&&e.jsxs("span",{children:[" • 📞 ",a.phone]})]}),e.jsx("div",{className:"small",children:e.jsx("span",{className:"badge bg-info",children:"Usuario Laboratorio"})})]},a.id)):e.jsx("div",{className:"p-2 text-muted",children:"No se encontraron responsables de laboratorio"})})]})]})]})]})]}),e.jsxs("div",{className:"col-lg-4",children:[e.jsxs("div",{className:"info-card",children:[e.jsx("h6",{children:"⚙️ Configuración Rápida"}),e.jsxs("div",{className:"d-grid gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"form-label small fw-bold",children:"Estado del Proyecto"}),e.jsxs("select",{className:"form-select",value:n.status||"pendiente",onChange:a=>m({...n,status:a.target.value}),children:[e.jsx("option",{value:"pendiente",children:"🟡 Pendiente"}),e.jsx("option",{value:"activo",children:"🟢 Activo"}),e.jsx("option",{value:"en_proceso",children:"🔵 En Proceso"}),e.jsx("option",{value:"completado",children:"✅ Completado"}),e.jsx("option",{value:"pausado",children:"⏸️ Pausado"}),e.jsx("option",{value:"cancelado",children:"❌ Cancelado"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label small fw-bold",children:"Prioridad"}),e.jsxs("select",{className:"form-select",value:n.priority||"normal",onChange:a=>m({...n,priority:a.target.value}),children:[e.jsx("option",{value:"low",children:"🔵 Baja"}),e.jsx("option",{value:"normal",children:"🟢 Normal"}),e.jsx("option",{value:"high",children:"🟠 Alta"}),e.jsx("option",{value:"urgent",children:"🔴 Urgente"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"form-label small fw-bold",children:["Estado Laboratorio",n.ingenieria_status&&n.ingenieria_status!=="no_requerido"&&e.jsx("span",{className:"text-muted small ms-2",children:"(Bloqueado - Ingeniería activa)"})]}),e.jsxs("select",{className:"form-select",disabled:n.ingenieria_status&&n.ingenieria_status!=="no_requerido",value:n.laboratorio_status||"no_requerido",onChange:a=>{const o=a.target.value;m(o!=="no_requerido"?{...n,laboratorio_status:o,ingenieria_status:"no_requerido",requiere_laboratorio:!0,requiere_ingenieria:!1}:{...n,laboratorio_status:o,requiere_laboratorio:!1})},children:[e.jsx("option",{value:"no_requerido",children:"No Requerido"}),e.jsx("option",{value:"pendiente",children:"Pendiente"}),e.jsx("option",{value:"en_proceso",children:"En Proceso"}),e.jsx("option",{value:"completado",children:"Completado"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"form-label small fw-bold",children:["Estado Ingeniería",n.laboratorio_status&&n.laboratorio_status!=="no_requerido"&&e.jsx("span",{className:"text-muted small ms-2",children:"(Bloqueado - Laboratorio activo)"})]}),e.jsxs("select",{className:"form-select",disabled:n.laboratorio_status&&n.laboratorio_status!=="no_requerido",value:n.ingenieria_status||"no_requerido",onChange:a=>{const o=a.target.value;m(o!=="no_requerido"?{...n,ingenieria_status:o,laboratorio_status:"no_requerido",requiere_ingenieria:!0,requiere_laboratorio:!1}:{...n,ingenieria_status:o,requiere_ingenieria:!1})},children:[e.jsx("option",{value:"no_requerido",children:"No Requerido"}),e.jsx("option",{value:"pendiente",children:"Pendiente"}),e.jsx("option",{value:"en_proceso",children:"En Proceso"}),e.jsx("option",{value:"completado",children:"Completado"})]})]})]})]}),e.jsxs("div",{className:"info-card",children:[e.jsx("h6",{children:"📅 Fechas"}),e.jsxs("div",{className:"d-grid gap-2",children:[e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx(ta,{className:"text-muted",size:16}),e.jsxs("div",{children:[e.jsx("div",{className:"small text-muted",children:"Creado"}),e.jsx("div",{className:"fw-bold",children:new Date(s.created_at).toLocaleDateString()})]})]}),e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx(He,{className:"text-muted",size:16}),e.jsxs("div",{children:[e.jsx("div",{className:"small text-muted",children:"Actualizado"}),e.jsx("div",{className:"fw-bold",children:new Date(s.updated_at).toLocaleDateString()})]})]})]})]})]})]}),e.jsxs("div",{className:"row g-4 mt-2",children:[e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"info-card",children:[e.jsx("h6",{children:"📝 Notas del Estado"}),e.jsx("textarea",{className:"form-control",rows:"4",value:n.status_notes||"",onChange:a=>m({...n,status_notes:a.target.value}),placeholder:"Agrega comentarios sobre el estado del proyecto..."})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"info-card",children:[e.jsx("h6",{children:"❓ Consultas del Cliente"}),e.jsx("div",{className:"mb-3",style:{maxHeight:"200px",overflowY:"auto"},children:n.queries_history&&Array.isArray(n.queries_history)&&n.queries_history.length>0?n.queries_history.map((a,o)=>{const Y=(ce=>{const ie=["#3b82f6","#ef4444"],re=ce.split("").reduce((O,G)=>(O=(O<<5)-O+G.charCodeAt(0),O&O),0);return ie[Math.abs(re)%ie.length]})(a.user_name||"Usuario");return e.jsxs("div",{className:"mb-2 p-2 bg-light rounded border-start border-3",style:{borderLeftColor:Y},children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-start mb-1",children:[e.jsxs("small",{className:"fw-bold",style:{color:Y},children:["👤 ",a.user_name||"Usuario"]}),e.jsx("small",{className:"text-muted",children:new Date(a.created_at).toLocaleString("es-ES",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"})})]}),e.jsx("div",{className:"small",children:a.message})]},o)}):e.jsx("div",{className:"text-center text-muted py-3",children:e.jsx("small",{children:"No hay consultas registradas"})})}),e.jsxs("div",{className:"border-top pt-3",children:[e.jsx("label",{className:"form-label small fw-bold",children:"Agregar consulta:"}),e.jsx("textarea",{className:"form-control",rows:"3",value:le,onChange:a=>We(a.target.value),placeholder:"Escribe una nueva consulta o respuesta..."}),e.jsx("div",{className:"d-flex justify-content-end mt-2",children:e.jsxs(N,{variant:"primary",size:"sm",onClick:()=>{if(le&&le.trim()){const a={message:le.trim(),user_name:(y==null?void 0:y.name)||"Usuario",created_at:new Date().toISOString()},o=[...n.queries_history||[],a];m({...n,queries_history:o,queries:JSON.stringify(o)}),We("")}},disabled:!le||!le.trim(),children:[e.jsx(Pe,{className:"me-1"}),"Agregar"]})})]})]})})]}),e.jsxs("div",{className:"info-card mt-3",children:[e.jsx("h6",{children:"📎 Archivos Adjuntos"}),e.jsxs("div",{className:"file-upload-area mb-3",onClick:()=>document.getElementById("fileInput").click(),children:[e.jsx(bs,{size:32,className:"text-muted mb-2"}),e.jsx("div",{className:"fw-bold text-muted",children:"Hacer clic para subir archivo"}),e.jsx("div",{className:"small text-muted",children:"PDF, Word, Excel, PowerPoint, Imágenes (máx. 10MB)"}),e.jsx("input",{type:"file",id:"fileInput",style:{display:"none"},onChange:Ps,accept:".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.jpg,.jpeg,.png,.gif,.txt"})]}),H&&e.jsxs("div",{className:"alert alert-info d-flex align-items-center mb-3",children:[e.jsx(je,{className:"me-2"}),e.jsxs("div",{children:[e.jsx("strong",{children:H.name}),e.jsx("br",{}),e.jsxs("small",{children:["📏 ",(H.size/1024/1024).toFixed(2)," MB"]})]}),e.jsxs(N,{variant:"primary",size:"sm",onClick:Ls,disabled:oe,className:"ms-auto",children:[e.jsx(bs,{className:"me-1"}),oe?"Subiendo...":"Subir"]})]}),U.length===0?e.jsxs("div",{className:"text-center py-4 text-muted",children:[e.jsx(js,{size:48,className:"mb-2 opacity-50"}),e.jsx("div",{children:"No hay archivos adjuntos"}),e.jsx("small",{children:"Sube cotizaciones, documentos técnicos, planos, etc."})]}):e.jsx("div",{className:"row g-2",children:U.map(a=>e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"file-item",children:[e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx(je,{className:"text-primary me-3",size:20}),e.jsxs("div",{children:[e.jsx("div",{className:"fw-bold",children:a.original_name}),e.jsxs("div",{className:"small text-muted",children:["📏 ",a.file_size?`${(a.file_size/1024/1024).toFixed(2)} MB`:"N/A",e.jsx("span",{className:"mx-2",children:"•"}),"📅 ",new Date(a.created_at).toLocaleDateString(),e.jsx("span",{className:"mx-2",children:"•"}),"👤 ",a.uploaded_by_name||"Usuario"]}),a.description&&e.jsx("div",{className:"small text-muted mt-1",children:a.description})]})]}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx(N,{variant:"outline-primary",size:"sm",onClick:()=>rs(a),children:e.jsx(fs,{size:14})}),e.jsx(N,{variant:"outline-danger",size:"sm",onClick:()=>Is(a.id),children:e.jsx(gs,{size:14})})]})]})},a.id))})]}),e.jsx("div",{className:"d-flex justify-content-between align-items-center gap-3 mt-4 pt-3 border-top",children:e.jsx("div",{children:(r==null?void 0:r.quote_id)&&e.jsxs(N,{variant:"outline-info",onClick:()=>Be(`/cotizaciones?view=${r.quote_id}`),className:"px-3",children:[e.jsx(je,{className:"me-2"}),"📄 Ver Cotización Relacionada"]})})})]})}],onSubmit:()=>{const s=r==null?void 0:r.id;if(!s){T("❌ Error: No se encontró el ID del proyecto","danger");return}Fe.mutate({id:s,data:n},{onSuccess:a=>{T("✅ Proyecto actualizado exitosamente!","success"),Q(!1)},onError:a=>{console.error("❌ Error al actualizar:",a),T("❌ Error al actualizar proyecto","danger")}})},submitText:Fe.isLoading?"Guardando...":"Guardar Cambios",cancelText:"Cancelar"}),e.jsx(Te,{show:$,onHide:()=>E(!1),title:`👁️ Ver Proyecto - ${(r==null?void 0:r.name)||""}`,data:{...r,queries_history:Array.isArray(r==null?void 0:r.queries_history)?r.queries_history:[]},size:"lg",fields:[{name:"project_view",label:"Información del Proyecto",type:"custom",render:s=>e.jsxs("div",{className:"project-view-modal",children:[e.jsx("style",{children:`
                  .project-view-modal {
                    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
                  }
                  .project-header {
                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                    color: white;
                    padding: 1.5rem;
                    border-radius: 12px;
                    margin-bottom: 2rem;
                    box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
                  }
                  .project-header h4 {
                    margin: 0;
                    font-weight: 600;
                    font-size: 1.5rem;
                  }
                  .project-header .project-id {
                    background: rgba(255, 255, 255, 0.2);
                    padding: 0.5rem 1rem;
                    border-radius: 20px;
                    font-size: 0.9rem;
                    margin-top: 0.5rem;
                    display: inline-block;
                  }
                  .info-card {
                    background: white;
                    border-radius: 12px;
                    padding: 1.5rem;
                    margin-bottom: 1.5rem;
                    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
                    border: 1px solid #e9ecef;
                  }
                  .info-card h6 {
                    color: #495057;
                    font-weight: 600;
                    margin-bottom: 1rem;
                    padding-bottom: 0.5rem;
                    border-bottom: 2px solid #f8f9fa;
                  }
                  .info-grid {
                    display: grid;
                    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                    gap: 1rem;
                  }
                  .info-item {
                    display: flex;
                    flex-direction: column;
                    gap: 0.25rem;
                  }
                  .info-item label {
                    font-size: 0.75rem;
                    font-weight: 600;
                    color: #6c757d;
                    text-transform: uppercase;
                    letter-spacing: 0.5px;
                  }
                  .info-item .value {
                    font-weight: 500;
                    color: #212529;
                    font-size: 0.95rem;
                  }
                  .priority-badge {
                    display: inline-flex;
                    align-items: center;
                    gap: 0.5rem;
                    padding: 0.5rem 1rem;
                    border-radius: 20px;
                    font-weight: 600;
                    font-size: 0.85rem;
                  }
                  .priority-urgent { background: #fee2e2; color: #dc2626; }
                  .priority-high { background: #fef3c7; color: #d97706; }
                  .priority-normal { background: #d1fae5; color: #059669; }
                  .priority-low { background: #e0e7ff; color: #3730a3; }
                  .status-badge {
                    padding: 0.5rem 1rem;
                    border-radius: 20px;
                    font-weight: 600;
                    font-size: 0.85rem;
                  }
                  .status-pendiente { background: #fef3c7; color: #d97706; }
                  .status-activo { background: #d1fae5; color: #059669; }
                  .status-completado { background: #dbeafe; color: #2563eb; }
                  .status-cancelado { background: #fee2e2; color: #dc2626; }
                `}),e.jsxs("div",{className:"project-header",children:[e.jsxs("h4",{children:["👁️ ",s.name]}),e.jsxs("div",{className:"project-id",children:["ID: #",s.id]})]}),e.jsxs("div",{className:"row g-4",children:[e.jsxs("div",{className:"col-lg-8",children:[e.jsxs("div",{className:"info-card",children:[e.jsx("h6",{children:"📊 Información del Proyecto"}),e.jsxs("div",{className:"info-grid",children:[e.jsxs("div",{className:"info-item",children:[e.jsx("label",{children:"Ubicación"}),e.jsx("div",{className:"value",children:s.location||"No especificada"})]}),e.jsxs("div",{className:"info-item",children:[e.jsx("label",{children:"Estado Actual"}),e.jsx("div",{children:e.jsx("span",{className:`status-badge status-${s.status||"pendiente"}`,children:s.status==="pendiente"?"Pendiente":s.status==="activo"?"Activo":s.status==="completado"?"Completado":s.status==="cancelado"?"Cancelado":s.status})})]}),e.jsxs("div",{className:"info-item",children:[e.jsx("label",{children:"Prioridad"}),e.jsx("div",{children:e.jsx("span",{className:`priority-badge priority-${s.priority||"normal"}`,children:s.priority==="urgent"?"🔴 Urgente":s.priority==="high"?"🟠 Alta":s.priority==="normal"?"🟢 Normal":s.priority==="low"?"🔵 Baja":"🟢 Normal"})})]})]})]}),e.jsxs("div",{className:"info-card",children:[e.jsx("h6",{children:"🏢 Información de la Empresa"}),e.jsxs("div",{className:"info-grid",children:[e.jsxs("div",{className:"info-item",children:[e.jsx("label",{children:"Empresa"}),e.jsx("div",{className:"value fw-bold",children:s.company_name||"Sin empresa"})]}),e.jsxs("div",{className:"info-item",children:[e.jsx("label",{children:"RUC"}),e.jsx("div",{className:"value",children:s.company_ruc||"Sin RUC"})]}),e.jsxs("div",{className:"info-item",children:[e.jsx("label",{children:"Contacto"}),e.jsx("div",{className:"value fw-bold",children:s.contact_name||"Sin contacto"})]}),e.jsxs("div",{className:"info-item",children:[e.jsx("label",{children:"Teléfono"}),e.jsx("div",{className:"value",children:s.contact_phone||"Sin teléfono"})]}),e.jsxs("div",{className:"info-item",children:[e.jsx("label",{children:"Email"}),e.jsx("div",{className:"value",children:s.contact_email||"Sin email"})]}),e.jsxs("div",{className:"info-item",children:[e.jsx("label",{children:"Vendedor Asignado"}),e.jsx("div",{className:"value fw-bold",children:s.vendedor_name||"Sin asignar"})]}),e.jsxs("div",{className:"info-item",children:[e.jsx("label",{children:"Responsable Laboratorio"}),e.jsx("div",{className:"value fw-bold",children:s.laboratorio_name||"Sin asignar"})]})]})]})]}),e.jsx("div",{className:"col-lg-4",children:e.jsxs("div",{className:"info-card",children:[e.jsx("h6",{children:"📅 Detalles del Proyecto"}),e.jsxs("div",{className:"info-item mb-3",children:[e.jsx("label",{children:"Fecha de Creación"}),e.jsx("div",{className:"value",children:s.created_at?new Date(s.created_at).toLocaleDateString("es-ES"):"No disponible"})]}),e.jsxs("div",{className:"info-item mb-3",children:[e.jsx("label",{children:"Última Actualización"}),e.jsx("div",{className:"value",children:s.updated_at?new Date(s.updated_at).toLocaleDateString("es-ES"):"No disponible"})]}),s.queries&&e.jsxs("div",{className:"info-item",children:[e.jsx("label",{children:"Consultas/Notas"}),e.jsx("div",{className:"value",style:{fontSize:"0.9rem",lineHeight:"1.4",maxHeight:"200px",overflowY:"auto",border:"1px solid #eee",borderRadius:"5px",padding:"10px"},children:(()=>{try{const a=JSON.parse(s.queries);return Array.isArray(a)&&a.length>0?a.map((o,F)=>{const ce=(ie=>{const re=["#3b82f6","#ef4444"],O=ie.split("").reduce((G,de)=>(G=(G<<5)-G+de.charCodeAt(0),G&G),0);return re[Math.abs(O)%re.length]})(o.user_name||"Usuario Desconocido");return e.jsxs("div",{className:"mb-2 pb-2",style:{borderBottom:F<a.length-1?"1px dotted #eee":"none"},children:[e.jsxs("div",{className:"fw-bold d-flex align-items-center",children:[e.jsx("div",{className:"me-2",style:{width:"4px",height:"20px",backgroundColor:ce,borderRadius:"2px"}}),e.jsx(Pe,{className:"me-1",style:{color:ce}}),"👤 ",o.user_name||"Usuario Desconocido",e.jsx("span",{className:"ms-auto text-muted small",style:{fontSize:"0.75rem"},children:new Date(o.created_at).toLocaleString("es-ES",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"})})]}),e.jsx("p",{className:"mb-0 ms-3",style:{fontSize:"0.85rem"},children:o.message})]},F)}):e.jsx("p",{className:"text-muted",children:"No hay consultas registradas."})}catch{return e.jsx("p",{className:"text-muted",children:s.queries})}})()})]})]})})]}),e.jsxs("div",{className:"info-card",children:[e.jsx("h6",{children:"📎 Archivos Adjuntos"}),U.length===0?e.jsxs("div",{className:"text-center py-4 text-muted",children:[e.jsx(js,{size:48,className:"mb-2 opacity-50"}),e.jsx("div",{children:"No hay archivos adjuntos"}),e.jsx("small",{children:"Este proyecto no tiene archivos adjuntos"})]}):e.jsx("div",{className:"row g-2",children:U.map(a=>e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"file-item",children:[e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx(je,{className:"text-primary me-3",size:20}),e.jsxs("div",{children:[e.jsx("div",{className:"fw-bold",children:a.original_name}),e.jsxs("div",{className:"small text-muted",children:["📏 ",a.file_size?`${(a.file_size/1024/1024).toFixed(2)} MB`:"N/A",e.jsx("span",{className:"mx-2",children:"•"}),"📅 ",new Date(a.created_at).toLocaleDateString(),e.jsx("span",{className:"mx-2",children:"•"}),"👤 ",a.uploaded_by_name||"Usuario"]}),a.description&&e.jsx("div",{className:"small text-muted mt-1",children:a.description})]})]}),e.jsx("div",{className:"d-flex gap-2",children:e.jsx(N,{variant:"outline-primary",size:"sm",onClick:()=>rs(a),children:e.jsx(fs,{size:14})})})]})},a.id))})]}),e.jsxs("div",{className:"d-flex justify-content-center gap-3 mt-4 pt-3 border-top",children:[e.jsxs(N,{variant:"primary",onClick:()=>{E(!1),ds(s)},className:"px-4",style:{backgroundColor:"#f84616",borderColor:"#f84616"},children:[e.jsx(ve,{className:"me-2"}),"⚙️ Gestionar Proyecto"]}),s.quote_id&&e.jsxs(N,{variant:"primary",onClick:()=>{E(!1),Be(`/cotizaciones?view=${s.quote_id}`)},className:"px-4",style:{backgroundColor:"#f84616",borderColor:"#f84616"},children:[e.jsx(je,{className:"me-2"}),"📄 Ver Evidencias"]})]})]})}],onSubmit:()=>E(!1),submitText:"Cerrar"})]})}),q&&e.jsxs("div",{style:{position:"fixed",top:"20px",right:"20px",zIndex:99999,backgroundColor:A==="success"?"#28a745":"#dc3545",color:"white",padding:"15px 20px",borderRadius:"8px",boxShadow:"0 4px 12px rgba(0,0,0,0.3)",minWidth:"300px",border:"none"},onClick:()=>g(!1),children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"5px"},children:A==="success"?"✅ Éxito":"❌ Error"}),e.jsx("div",{children:l})]}),e.jsx(Te,{show:_s,onHide:()=>Ie(!1),title:"Seleccionar Servicios del Proyecto",size:"xl",data:{},fields:[],onSubmit:()=>Ie(!1),loading:!1,submitText:"Cerrar",customBody:e.jsx(Sa,{selectedServices:W,onServicesChange:Je,serviceType:"laboratorio"})}),ws&&e.jsx("div",{className:"modal-backdrop",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:1050,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsxs("div",{className:"modal-content bg-white rounded shadow-lg",style:{width:"90%",maxWidth:"1200px",maxHeight:"90vh",overflow:"auto"},children:[e.jsxs("div",{className:"modal-header p-4 border-bottom d-flex justify-content-between align-items-center",children:[e.jsx("h5",{className:"mb-0",children:"Crear Nuevo Proyecto"}),e.jsx(N,{variant:"outline-secondary",size:"sm",onClick:()=>qe(!1),children:e.jsx(Z,{})})]}),e.jsx("div",{className:"modal-body p-4",children:e.jsx(qa,{data:ae?{company_id:ae.id}:{},onSubmit:async s=>{try{console.log("Datos del formulario:",s);const a={company_id:s.client_id,name:s.name,location:s.location,contact_name:s.contact_name,contact_phone:s.contact_phone,contact_email:s.contact_email,priority:s.priority||"normal",marked:s.marked||!1,requiere_laboratorio:s.requiere_laboratorio||!1,requiere_ingenieria:s.requiere_ingenieria||!1,requiere_capacitacion:s.requiere_capacitacion||!1};await Ae.mutateAsync(a),b("Proyecto creado exitosamente"),pe("success"),g(!0),qe(!1),ke.invalidateQueries("projects")}catch(a){console.error("Error al crear proyecto:",a),b("Error al crear el proyecto"),pe("danger"),g(!0)}},onCancel:()=>qe(!1),loading:Ae.isLoading})})]})}),e.jsx(Ve,{show:!!P,onHide:()=>x(null),onConfirm:Us,title:"Eliminar Proyecto",message:`¿Estás seguro de que quieres eliminar el proyecto "${P==null?void 0:P.name}"?`,confirmText:"Eliminar",variant:"danger",isLoading:ls.isLoading,alertMessage:"Esta acción eliminará permanentemente el proyecto y todos sus datos asociados.",alertVariant:"danger"}),e.jsx(Ve,{show:!!D,onHide:()=>u(null),onConfirm:Ms,title:"Eliminar Archivo",message:"¿Estás seguro de que quieres eliminar este archivo?",confirmText:"Eliminar",variant:"danger",alertMessage:"El archivo se eliminará permanentemente y no se puede recuperar.",alertVariant:"warning"}),e.jsx(Ve,{show:!!v,onHide:()=>k(null),onConfirm:Vs,title:`${v!=null&&v.marked?"Desmarcar":"Marcar"} Proyecto`,message:`¿Estás seguro de que quieres ${v!=null&&v.marked?"desmarcar":"marcar"} el proyecto "${v==null?void 0:v.name}"?`,confirmText:v!=null&&v.marked?"Desmarcar":"Marcar",variant:v!=null&&v.marked?"warning":"success"})]})}export{ei as default};
//# sourceMappingURL=Proyectos-uX0fCKey.js.map
