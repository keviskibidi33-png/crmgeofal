import{j as e,b as qe,r as n,V as Re,c as Ge,e as H,H as se,p as m,B as o,s as He,x as J,P as ie,I as Je,Y as _e,Z as Ye,h as Qe,W as Ne,$ as Ve,L as Ze,a0 as w,f as Ke}from"./index-D5j7Etbr.js";import{P as ea}from"./PageHeader-BAMnoJ00.js";import{D as aa}from"./DataTable-BSDUXWv5.js";import{S as Y}from"./StatsCard-CrtJfzkh.js";import{T as sa}from"./Toast-CFNdnVp0.js";import{d as ia,u as ta,b as ra,a as ca,g as na}from"./attachments-BDNHx2oQ.js";import{l as la}from"./projects-C9osJ5rC.js";import{C as Ce}from"./CompanyProjectPicker-BsZ_ZGoi.js";import{R as _,C as r,a as b}from"./Row-BbCd5WYq.js";import{A as Se}from"./Alert-5CgP0oJh.js";import{F as t}from"./InputGroup-CuAl69_P.js";import{P as oa}from"./ProgressBar-rK63zS-N.js";import{S as E}from"./Spinner-DkvOZ9XA.js";import"./Table-BrvfnYPw.js";import"./companies-BQpw0ewS.js";import"./ElementChildren-BZ8oKQvH.js";const da={position:"fixed",top:0,left:0,width:"100vw",height:"100vh",background:"rgba(0,0,0,0.18)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center"},ma=(p,j)=>{const u={background:"#fff",borderRadius:12,boxShadow:"0 2px 16px #0002",padding:"2rem 2.5rem"};if(j)return{...u,minWidth:340,maxWidth:"none",width:"auto",height:"auto"};switch(p){case"sm":return{...u,minWidth:300,maxWidth:400};case"lg":return{...u,minWidth:500,maxWidth:800};case"xl":return{...u,minWidth:800,maxWidth:1200};default:return{...u,minWidth:340,maxWidth:420}}};function te({open:p,onClose:j,children:u,size:k,className:q}){if(!p)return null;const T=ma(k,q);return e.jsx("div",{style:da,onClick:j,children:e.jsx("div",{style:T,className:q,onClick:Q=>Q.stopPropagation(),children:u})})}const ua=()=>qe("/api/project-categories"),ha=(p=null)=>{const j=p?`/api/project-subcategories?category_id=${p}`:"/api/project-subcategories";return qe(j)},ke={project_id:"",company_id:"",company:null,project:null,project_name:"",location:"",description:"",file:null,category_id:"",subcategory_id:"",requiere_laboratorio:!1,requiere_ingenieria:!1,requiere_consultoria:!1,requiere_capacitacion:!1,requiere_auditoria:!1};function Fa(){var ge;const[p,j]=n.useState(1),[u]=n.useState(20),[k,q]=n.useState(""),[T,Q]=n.useState(""),[re,Ae]=n.useState(""),[ce,N]=n.useState({message:"",type:"success",show:!1}),V=Re(),[f,Pe]=n.useState({company_id:null,company:null,project_id:null,project:null,project_name:"",location:""}),[M,A]=n.useState(!1),[I,P]=n.useState(!1),[i,l]=n.useState(ke),[h,ne]=n.useState(null),[v,B]=n.useState(null),[le,oe]=n.useState(0),[Fe,Z]=n.useState(!1),De=Ge();n.useEffect(()=>{var a;(a=V.state)!=null&&a.search&&q(V.state.search)},[V.state]);const{data:C,isLoading:F,refetch:Le}=H(["allAttachments",p,u,k,T,re,f.project_id],()=>na({page:p,limit:u,search:k,project_id:f.project_id||T,file_type:re}),{keepPreviousData:!0,refetchOnWindowFocus:!1,staleTime:3e4}),{data:O}=H("projectsList",()=>la({page:1,limit:500}),{staleTime:1/0}),D=n.useMemo(()=>(O==null?void 0:O.data)||[],[O]),{data:de,refetch:me}=H("categoriesList",ua,{staleTime:3e4,refetchOnWindowFocus:!0}),U=n.useMemo(()=>de||[],[de]),{data:ue,refetch:he}=H("subcategoriesList",()=>ha(),{staleTime:3e4,refetchOnWindowFocus:!0}),$=n.useMemo(()=>ue||[],[ue]);n.useMemo(()=>D.find(a=>a.id===parseInt(i.project_id)),[D,i.project_id]),n.useMemo(()=>h?D.find(a=>a.id===parseInt(h.project_id)):null,[D,h]);const L=()=>{me(),he()};n.useEffect(()=>{(M||I)&&L()},[M,I,me,he]);const K=a=>{N({message:a,type:"success",show:!0}),De.invalidateQueries("allAttachments"),A(!1),P(!1),l(ke),ne(null),B(null),oe(0)},ee=(a,s)=>{N({message:(a==null?void 0:a.message)||s,type:"error",show:!0}),oe(0)},g=se(a=>ta(i.project_id,a),{onSuccess:()=>K("Archivo subido correctamente."),onError:a=>ee(a,"Error al subir archivo.")}),y=se(({id:a,formData:s})=>ra(a,s),{onSuccess:()=>K("Archivo actualizado correctamente."),onError:a=>ee(a,"Error al actualizar archivo.")}),W=se(ca,{onSuccess:()=>K("Adjunto eliminado correctamente."),onError:a=>ee(a,"Error al eliminar adjunto.")}),xe=a=>{if(a.preventDefault(),!i.file||!i.project_id){N({message:"Debe seleccionar un proyecto y un archivo.",type:"error",show:!0});return}const s=new FormData;s.append("file",i.file),s.append("description",i.description||""),i.category_id&&s.append("category_id",i.category_id),i.subcategory_id&&s.append("subcategory_id",i.subcategory_id),s.append("requiere_laboratorio",i.requiere_laboratorio),s.append("requiere_ingenieria",i.requiere_ingenieria),s.append("requiere_consultoria",i.requiere_consultoria),s.append("requiere_capacitacion",i.requiere_capacitacion),s.append("requiere_auditoria",i.requiere_auditoria),g.mutate(s)},ze=a=>{ne(a),l({project_id:a.project_id,description:a.description||"",file:null,category_id:a.category_id||"",subcategory_id:a.subcategory_id||"",requiere_laboratorio:a.requiere_laboratorio||!1,requiere_ingenieria:a.requiere_ingenieria||!1,requiere_consultoria:a.requiere_consultoria||!1,requiere_capacitacion:a.requiere_capacitacion||!1,requiere_auditoria:a.requiere_auditoria||!1}),P(!0)},pe=a=>{if(a.preventDefault(),!h)return;const s={description:i.description||"",category_id:i.category_id||null,subcategory_id:i.subcategory_id||null,requiere_laboratorio:i.requiere_laboratorio,requiere_ingenieria:i.requiere_ingenieria,requiere_consultoria:i.requiere_consultoria,requiere_capacitacion:i.requiere_capacitacion,requiere_auditoria:i.requiere_auditoria};console.log("🔄 handleEditSubmit - Editing attachment ID:",h.id),console.log("🔄 handleEditSubmit - Upload form data:",i),console.log("🔄 handleEditSubmit - Update data:",s);const c=new FormData;i.file&&c.append("file",i.file),Object.keys(s).forEach(d=>{s[d]!==null&&s[d]!==void 0&&(c.append(d,s[d]),console.log(`🔄 FormData - ${d}:`,s[d]))}),console.log("🔄 FormData entries:");for(let[d,z]of c.entries())console.log(`  ${d}:`,z);y.mutate({id:h.id,formData:c})},we=()=>{v&&W.mutate(v.id)},Ee=async a=>{try{await ia(a),N({message:"Descarga iniciada correctamente.",type:"success",show:!0})}catch(s){console.error("Error al descargar archivo:",s),N({message:"Error al descargar el archivo.",type:"error",show:!0})}},Te=a=>{a.preventDefault(),a.stopPropagation(),Z(!0)},Me=a=>{a.preventDefault(),a.stopPropagation(),Z(!1)},Ie=a=>{a.preventDefault(),a.stopPropagation()},Be=a=>{a.preventDefault(),a.stopPropagation(),Z(!1);const s=a.dataTransfer.files;s&&s[0]&&l(c=>({...c,file:s[0]}))},Oe=a=>{Q(a.project_id||""),Ae(a.file_type||""),j(1)},ae=a=>{var c;switch((c=a.split(".").pop())==null?void 0:c.toLowerCase()){case"pdf":return"📄";case"doc":case"docx":return"📝";case"xls":case"xlsx":return"📊";case"ppt":case"pptx":return"📈";case"jpg":case"jpeg":case"png":case"gif":return"🖼️";case"txt":return"📃";default:return"📎"}},Ue=a=>{var d;const s=(d=a.split(".").pop())==null?void 0:d.toLowerCase();return{pdf:{variant:"danger",text:"PDF"},doc:{variant:"primary",text:"DOC"},docx:{variant:"primary",text:"DOCX"},xls:{variant:"success",text:"XLS"},xlsx:{variant:"success",text:"XLSX"},ppt:{variant:"warning",text:"PPT"},pptx:{variant:"warning",text:"PPTX"},jpg:{variant:"info",text:"JPG"},jpeg:{variant:"info",text:"JPEG"},png:{variant:"info",text:"PNG"},gif:{variant:"info",text:"GIF"},txt:{variant:"secondary",text:"TXT"}}[s]||{variant:"secondary",text:(s==null?void 0:s.toUpperCase())||"FILE"}},S=a=>({admin:{variant:"danger",text:"Admin"},jefa_comercial:{variant:"primary",text:"Jefa Comercial"},jefe_laboratorio:{variant:"info",text:"Jefe Lab"},vendedor_comercial:{variant:"success",text:"Vendedor"},usuario_laboratorio:{variant:"warning",text:"Lab User"}})[a]||{variant:"secondary",text:a||"N/A"},je=a=>({activo:{variant:"success",text:"Activo"},pendiente:{variant:"warning",text:"Pendiente"},completado:{variant:"primary",text:"Completado"},cancelado:{variant:"danger",text:"Cancelado"},pausado:{variant:"secondary",text:"Pausado"}})[a]||{variant:"secondary",text:a||"N/A"},$e=n.useMemo(()=>[{header:"ID",accessor:"id",width:60},{header:"Proyecto",accessor:"project_name",render:(a,s)=>e.jsxs("div",{children:[e.jsx("div",{className:"fw-medium",children:a||"Sin proyecto"}),e.jsxs("div",{className:"small text-muted",children:[e.jsxs("div",{children:["📍 ",s.project_location||"Sin ubicación"]}),e.jsxs("div",{className:"d-flex align-items-center gap-2 mt-1",children:[e.jsx(m,{bg:je(s.project_status).variant,className:"small",children:je(s.project_status).text}),s.project_priority&&e.jsx(m,{bg:s.project_priority==="urgent"?"danger":s.project_priority==="high"?"warning":"info",className:"small",children:s.project_priority})]})]})]})},{header:"Empresa",accessor:"company_name",render:(a,s)=>e.jsxs("div",{children:[e.jsx("div",{className:"fw-medium",children:a||"Sin empresa"}),e.jsxs("small",{className:"text-muted",children:["RUC: ",s.company_ruc||"N/A"]})]})},{header:"Archivo",accessor:"original_name",render:(a,s)=>{const c=Ue(a);return e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("span",{className:"me-2",style:{fontSize:"1.2em"},children:ae(a)}),e.jsxs("div",{children:[e.jsx("div",{className:"fw-medium",children:a}),e.jsx(m,{bg:c.variant,className:"small",children:c.text})]})]})}},{header:"Categorías",accessor:"category_name",render:(a,s)=>e.jsxs("div",{children:[a&&e.jsx("div",{className:"mb-1",children:e.jsxs(m,{bg:"primary",className:"small",children:["📁 ",a]})}),s.subcategory_name&&e.jsx("div",{children:e.jsxs(m,{bg:"info",className:"small",children:["📂 ",s.subcategory_name]})}),!a&&!s.subcategory_name&&e.jsx("span",{className:"text-muted small",children:"Sin categoría"})]})},{header:"Servicios",accessor:"requiere_laboratorio",render:(a,s)=>e.jsxs("div",{className:"d-flex flex-wrap gap-1",children:[s.requiere_laboratorio&&e.jsx(m,{bg:"warning",className:"small",children:"🧪 Lab"}),s.requiere_ingenieria&&e.jsx(m,{bg:"info",className:"small",children:"⚙️ Ing"}),s.requiere_consultoria&&e.jsx(m,{bg:"success",className:"small",children:"💼 Cons"}),s.requiere_capacitacion&&e.jsx(m,{bg:"primary",className:"small",children:"🎓 Cap"}),s.requiere_auditoria&&e.jsx(m,{bg:"secondary",className:"small",children:"📋 Aud"}),!s.requiere_laboratorio&&!s.requiere_ingenieria&&!s.requiere_consultoria&&!s.requiere_capacitacion&&!s.requiere_auditoria&&e.jsx("span",{className:"text-muted small",children:"Sin servicios"})]})},{header:"Roles",accessor:"vendedor_name",render:(a,s)=>e.jsxs("div",{children:[a&&e.jsx("div",{className:"mb-1",children:e.jsxs("div",{className:"small",children:[e.jsx(m,{bg:S(s.vendedor_role).variant,className:"small me-1",children:S(s.vendedor_role).text}),e.jsx("span",{className:"text-muted",children:a})]})}),s.laboratorio_name&&e.jsxs("div",{className:"small",children:[e.jsx(m,{bg:S(s.laboratorio_role).variant,className:"small me-1",children:S(s.laboratorio_role).text}),e.jsx("span",{className:"text-muted",children:s.laboratorio_name})]}),!a&&!s.laboratorio_name&&e.jsx("span",{className:"text-muted small",children:"Sin asignación"})]})},{header:"Subido por",accessor:"uploaded_by_name",render:(a,s)=>e.jsxs("div",{children:[e.jsx("div",{className:"fw-medium",children:a||"Usuario desconocido"}),e.jsx("div",{className:"small",children:e.jsx(m,{bg:S(s.uploaded_by_role).variant,className:"small",children:S(s.uploaded_by_role).text})})]})},{header:"Fecha",accessor:"created_at",render:a=>e.jsxs("div",{children:[e.jsx("div",{children:new Date(a).toLocaleDateString()}),e.jsx("small",{className:"text-muted",children:new Date(a).toLocaleTimeString()})]}),width:120},{header:"Acciones",accessor:"actions",width:180,render:(a,s)=>e.jsxs("div",{className:"d-flex gap-1",children:[e.jsx(o,{variant:"outline-primary",size:"sm",onClick:()=>Ee(s),title:"Descargar",children:e.jsx(He,{})}),e.jsx(o,{variant:"outline-success",size:"sm",onClick:()=>ze(s),title:"Editar",children:e.jsx(J,{})}),e.jsx(o,{variant:"outline-danger",size:"sm",onClick:()=>B(s),title:"Eliminar",children:e.jsx(ie,{})})]})}],[]),X=(C==null?void 0:C.data)||[],R=(C==null?void 0:C.total)||0,We=Math.max(1,Math.ceil(R/u)),G=n.useMemo(()=>{const a={},s=new Set,c=new Set,d=new Set,z=new Set;let be=0;return X.forEach(x=>{var ve,ye;const fe=((ye=(ve=x.original_name)==null?void 0:ve.split(".").pop())==null?void 0:ye.toLowerCase())||"unknown";a[fe]=(a[fe]||0)+1,x.project_id&&s.add(x.project_id),x.category_name&&c.add(x.category_name),x.subcategory_name&&d.add(x.subcategory_name),x.vendedor_name&&z.add("vendedor"),x.laboratorio_name&&z.add("laboratorio"),x.file_size&&(be+=parseInt(x.file_size))}),{total:R,totalFiles:X.length,totalProjects:s.size,totalCategories:c.size,totalSubcategories:d.size,totalRoles:z.size,fileTypes:Object.keys(a).length,totalSize:(be/1024/1024).toFixed(1)+" MB"}},[X,R]),Xe=[{title:"Por Proyecto",options:D.map(a=>({label:`${a.name} - ${a.location}`,filter:{project_id:a.id}}))},{title:"Por Tipo de Archivo",options:[{label:"📄 PDF",filter:{file_type:"pdf"}},{label:"📝 Documentos",filter:{file_type:"doc"}},{label:"📊 Excel",filter:{file_type:"xls"}},{label:"🖼️ Imágenes",filter:{file_type:"img"}}]},{title:"Por Estado de Proyecto",options:[{label:"🟢 Activos",filter:{project_status:"activo"}},{label:"🟡 Pendientes",filter:{project_status:"pendiente"}},{label:"🔵 Completados",filter:{project_status:"completado"}},{label:"🔴 Cancelados",filter:{project_status:"cancelado"}}]}];return e.jsxs(e.Fragment,{children:[e.jsxs(Je,{fluid:!0,className:"py-4",children:[e.jsx(ea,{title:"Gestión de Adjuntos",subtitle:"Archivos relacionados a proyectos y cotizaciones",icon:_e}),e.jsxs(_,{className:"mb-4",children:[e.jsx(r,{md:6,lg:3,children:e.jsx(Y,{title:"Total Archivos",value:G.total,icon:Ye,color:"primary",subtitle:"Archivos en el sistema",loading:F})}),e.jsx(r,{md:6,lg:3,children:e.jsx(Y,{title:"Proyectos",value:G.totalProjects,icon:_e,color:"info",subtitle:"Con archivos adjuntos",loading:F})}),e.jsx(r,{md:6,lg:3,children:e.jsx(Y,{title:"Categorías",value:G.totalCategories,icon:Qe,color:"success",subtitle:"Con archivos asignados",loading:F})}),e.jsx(r,{md:6,lg:3,children:e.jsx(Y,{title:"Espacio Usado",value:G.totalSize,icon:Ne,color:"warning",subtitle:"Almacenamiento total",loading:F})})]}),e.jsx(b,{className:"mb-4",children:e.jsx(b.Body,{children:e.jsx(_,{children:e.jsxs(r,{md:12,children:[e.jsx("h6",{className:"mb-3",children:"Filtro por Cliente y Proyecto"}),e.jsx(Ce,{value:f,onChange:Pe}),f.project&&e.jsx("div",{className:"mt-3",children:e.jsx(Se,{variant:"info",className:"py-2",children:e.jsxs("small",{children:[e.jsx("strong",{children:"Proyecto seleccionado:"})," ",f.project.name," |",e.jsx("strong",{children:" Cliente:"})," ",(ge=f.company)==null?void 0:ge.name," |",e.jsx("strong",{children:" Ubicación:"})," ",f.project.location]})})})]})})})}),e.jsx(b,{className:"mb-4",children:e.jsx(b.Body,{children:e.jsxs(_,{className:"align-items-center",children:[e.jsx(r,{md:6,children:e.jsxs("div",{className:"d-flex gap-2",children:[e.jsxs("div",{className:"position-relative flex-grow-1",children:[e.jsx(Ve,{className:"position-absolute top-50 start-0 translate-middle-y ms-3 text-muted"}),e.jsx(t.Control,{type:"text",placeholder:"Buscar por archivo, proyecto...",value:k,onChange:a=>{q(a.target.value),j(1)},className:"ps-5"})]}),e.jsx(o,{variant:"outline-secondary",onClick:()=>Le(),title:"Actualizar",children:e.jsx(Ze,{})})]})}),e.jsx(r,{md:6,className:"text-end",children:e.jsx("div",{className:"d-flex gap-2 justify-content-end",children:e.jsxs(o,{variant:"outline-primary",onClick:()=>A(!0),children:[e.jsx(w,{className:"me-2"}),"Subir Archivo"]})})})]})})}),e.jsx(b,{children:e.jsx(b.Body,{className:"p-0",children:e.jsx(aa,{columns:$e,data:X,loading:F,currentPage:p,totalPages:We,onPageChange:j,totalItems:R,itemsPerPage:u,filterOptions:Xe,onFilter:Oe,emptyMessage:"No hay archivos adjuntos",emptyDescription:"Sube tu primer archivo usando el botón 'Subir Archivo'"})})})]}),M&&e.jsxs(te,{open:M,onClose:()=>A(!1),size:"xl",className:"adjuntos-modal",children:[e.jsx("div",{className:"modal-header",children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx(w,{className:"me-2 text-primary",size:24}),e.jsx("h4",{className:"mb-0",children:"Subir Archivo Adjunto"})]})}),e.jsx("div",{className:"modal-body",children:e.jsxs("form",{onSubmit:xe,children:[e.jsxs(_,{className:"g-3",children:[e.jsxs(r,{md:12,children:[e.jsx(t.Label,{className:"fw-medium",children:"Cliente y Proyecto *"}),e.jsx(Ce,{value:{company_id:i.company_id||null,company:i.company||null,project_id:i.project_id||null,project:i.project||null,project_name:i.project_name||"",location:i.location||""},onChange:a=>{l(s=>{var c,d;return{...s,company_id:a.company_id,company:a.company,project_id:a.project_id,project:a.project,project_name:a.project_name,location:a.location,category_id:((c=a.project)==null?void 0:c.category_id)||"",subcategory_id:((d=a.project)==null?void 0:d.subcategory_id)||""}})}})]}),e.jsxs(r,{md:12,children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[e.jsx(t.Label,{className:"fw-medium mb-0",children:"Categorías Disponibles"}),e.jsx(o,{variant:"outline-secondary",size:"sm",onClick:L,title:"Actualizar lista de categorías",children:"🔄 Actualizar"})]}),e.jsx("div",{className:"border rounded p-3 bg-light",style:{maxHeight:"200px",overflowY:"auto"},children:U.length>0?U.map(a=>e.jsx(t.Check,{type:"checkbox",id:`category-${a.id}`,label:`📁 ${a.name}`,checked:i.category_id===a.id,onChange:s=>l(c=>({...c,category_id:s.target.checked?a.id:""})),className:"mb-2"},a.id)):e.jsx("p",{className:"text-muted mb-0",children:"No hay categorías disponibles"})}),e.jsx(t.Text,{className:"text-muted d-block mt-1",children:"Selecciona una categoría para asignar al archivo"})]}),e.jsxs(r,{md:12,children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[e.jsx(t.Label,{className:"fw-medium mb-0",children:"Subcategorías Disponibles"}),e.jsx(o,{variant:"outline-secondary",size:"sm",onClick:L,title:"Actualizar lista de subcategorías",children:"🔄 Actualizar"})]}),e.jsx("div",{className:"border rounded p-3 bg-light",style:{maxHeight:"200px",overflowY:"auto"},children:$.length>0?$.map(a=>e.jsx(t.Check,{type:"checkbox",id:`subcategory-${a.id}`,label:`📂 ${a.name}`,checked:i.subcategory_id===a.id,onChange:s=>l(c=>({...c,subcategory_id:s.target.checked?a.id:""})),className:"mb-2"},a.id)):e.jsx("p",{className:"text-muted mb-0",children:"No hay subcategorías disponibles"})}),e.jsx(t.Text,{className:"text-muted d-block mt-1",children:"Selecciona una subcategoría para asignar al archivo"})]}),e.jsxs(r,{md:12,children:[e.jsx(t.Label,{className:"fw-medium",children:"Descripción (Opcional)"}),e.jsx(t.Control,{as:"textarea",rows:3,value:i.description,onChange:a=>l(s=>({...s,description:a.target.value})),placeholder:"Describe el contenido del archivo..."})]}),e.jsxs(r,{md:12,children:[e.jsx(t.Label,{className:"fw-medium",children:"Servicios Requeridos"}),e.jsxs("div",{className:"border rounded p-3 bg-light",children:[e.jsxs(_,{children:[e.jsx(r,{md:6,children:e.jsx(t.Check,{type:"checkbox",id:"upload-requiere-laboratorio",label:"🧪 Laboratorio",checked:i.requiere_laboratorio,onChange:a=>l(s=>({...s,requiere_laboratorio:a.target.checked}))})}),e.jsx(r,{md:6,children:e.jsx(t.Check,{type:"checkbox",id:"upload-requiere-ingenieria",label:"⚙️ Ingeniería",checked:i.requiere_ingenieria,onChange:a=>l(s=>({...s,requiere_ingenieria:a.target.checked}))})}),e.jsx(r,{md:6,children:e.jsx(t.Check,{type:"checkbox",id:"upload-requiere-consultoria",label:"💼 Consultoría",checked:i.requiere_consultoria,onChange:a=>l(s=>({...s,requiere_consultoria:a.target.checked}))})}),e.jsx(r,{md:6,children:e.jsx(t.Check,{type:"checkbox",id:"upload-requiere-capacitacion",label:"🎓 Capacitación",checked:i.requiere_capacitacion,onChange:a=>l(s=>({...s,requiere_capacitacion:a.target.checked}))})}),e.jsx(r,{md:6,children:e.jsx(t.Check,{type:"checkbox",id:"upload-requiere-auditoria",label:"📋 Auditoría",checked:i.requiere_auditoria,onChange:a=>l(s=>({...s,requiere_auditoria:a.target.checked}))})})]}),e.jsx(t.Text,{className:"text-muted d-block mt-2",children:"Marca los servicios que requiere este archivo"})]})]}),e.jsxs(r,{md:12,children:[e.jsx(t.Label,{className:"fw-medium",children:"Archivo *"}),e.jsx("div",{className:`border-2 border-dashed rounded p-4 text-center ${Fe?"border-primary bg-light":"border-secondary"}`,onDragEnter:Te,onDragLeave:Me,onDragOver:Ie,onDrop:Be,style:{minHeight:"120px",cursor:"pointer"},onClick:()=>document.getElementById("fileInput").click(),children:i.file?e.jsxs("div",{children:[e.jsx(Ke,{className:"text-success mb-2",size:32}),e.jsx("div",{className:"fw-medium",children:i.file.name}),e.jsxs("small",{className:"text-muted",children:[(i.file.size/1024/1024).toFixed(2)," MB"]})]}):e.jsxs("div",{children:[e.jsx(w,{className:"text-muted mb-2",size:32}),e.jsx("div",{className:"fw-medium",children:"Arrastra y suelta tu archivo aquí"}),e.jsx("small",{className:"text-muted",children:"o haz clic para seleccionar"}),e.jsx("div",{className:"mt-2",children:e.jsx("small",{className:"text-muted",children:"Formatos permitidos: PDF, DOC, DOCX, XLS, XLSX, PPT, PPTX, JPG, PNG, GIF, TXT"})})]})}),e.jsx(t.Control,{id:"fileInput",type:"file",className:"d-none",onChange:a=>l(s=>({...s,file:a.target.files[0]})),accept:".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.jpg,.jpeg,.png,.gif,.txt",required:!0})]})]}),g.isLoading&&e.jsxs("div",{className:"mt-3",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[e.jsx("small",{children:"Subiendo archivo..."}),e.jsxs("small",{children:[le,"%"]})]}),e.jsx(oa,{now:le,animated:!0})]}),e.jsxs("div",{className:"d-flex justify-content-end gap-2 mt-4",children:[e.jsx(o,{type:"button",variant:"outline-secondary",onClick:()=>A(!1),disabled:g.isLoading,children:"Cancelar"}),e.jsx(o,{type:"submit",variant:"primary",disabled:g.isLoading||!i.file||!i.project_id,children:g.isLoading?e.jsxs(e.Fragment,{children:[e.jsx(E,{size:"sm",className:"me-2"}),"Subiendo..."]}):e.jsxs(e.Fragment,{children:[e.jsx(w,{className:"me-2"}),"Subir Archivo"]})})]})]})}),e.jsx("div",{className:"modal-footer",children:e.jsxs("div",{className:"d-flex gap-2 justify-content-end",children:[e.jsx(o,{type:"button",variant:"outline-secondary",onClick:()=>A(!1),disabled:g.isLoading,children:"Cancelar"}),e.jsx(o,{type:"submit",variant:"primary",disabled:g.isLoading,onClick:xe,children:g.isLoading?e.jsxs(e.Fragment,{children:[e.jsx(E,{size:"sm",className:"me-2"}),"Subiendo..."]}):e.jsxs(e.Fragment,{children:[e.jsx(w,{className:"me-2"}),"Subir Archivo"]})})]})})]}),I&&h&&e.jsxs(te,{open:I,onClose:()=>P(!1),size:"xl",className:"adjuntos-modal",children:[e.jsx("div",{className:"modal-header",children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx(J,{className:"me-2 text-success",size:24}),e.jsx("h4",{className:"mb-0",children:"Editar Archivo Adjunto"})]})}),e.jsx("div",{className:"modal-body",children:e.jsxs("form",{onSubmit:pe,children:[e.jsxs(_,{className:"g-3",children:[e.jsxs(r,{md:12,children:[e.jsx(t.Label,{className:"fw-medium",children:"Proyecto"}),e.jsx(t.Control,{type:"text",value:h.project_name||"Sin proyecto",readOnly:!0,className:"bg-light"})]}),e.jsxs(r,{md:12,children:[e.jsx(t.Label,{className:"fw-medium",children:"Archivo Actual"}),e.jsxs("div",{className:"d-flex align-items-center p-3 bg-light rounded",children:[e.jsx("span",{className:"me-2",style:{fontSize:"1.2em"},children:ae(h.original_name)}),e.jsxs("div",{children:[e.jsx("div",{className:"fw-medium",children:h.original_name}),e.jsxs("small",{className:"text-muted",children:[(h.file_size/1024/1024).toFixed(2)," MB"]})]})]})]}),e.jsxs(r,{md:12,children:[e.jsx(t.Label,{className:"fw-medium",children:"Nuevo Archivo (Opcional)"}),e.jsx(t.Control,{type:"file",onChange:a=>l(s=>({...s,file:a.target.files[0]})),accept:".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.jpg,.jpeg,.png,.gif,.txt"}),e.jsx(t.Text,{className:"text-muted",children:"Deja vacío para mantener el archivo actual"})]}),e.jsxs(r,{md:12,children:[e.jsx(t.Label,{className:"fw-medium",children:"Descripción"}),e.jsx(t.Control,{as:"textarea",rows:3,value:i.description,onChange:a=>l(s=>({...s,description:a.target.value})),placeholder:"Describe el contenido del archivo..."})]}),e.jsxs(r,{md:12,children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[e.jsx(t.Label,{className:"fw-medium mb-0",children:"Categorías Disponibles"}),e.jsx(o,{variant:"outline-secondary",size:"sm",onClick:L,title:"Actualizar lista de categorías",children:"🔄 Actualizar"})]}),e.jsx("div",{className:"border rounded p-3 bg-light",style:{maxHeight:"200px",overflowY:"auto"},children:U.length>0?U.map(a=>e.jsx(t.Check,{type:"checkbox",id:`edit-category-${a.id}`,label:`📁 ${a.name}`,checked:i.category_id===a.id,onChange:s=>l(c=>({...c,category_id:s.target.checked?a.id:""})),className:"mb-2"},a.id)):e.jsx("p",{className:"text-muted mb-0",children:"No hay categorías disponibles"})}),e.jsx(t.Text,{className:"text-muted d-block mt-1",children:"Selecciona una categoría para asignar al archivo"})]}),e.jsxs(r,{md:12,children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[e.jsx(t.Label,{className:"fw-medium mb-0",children:"Subcategorías Disponibles"}),e.jsx(o,{variant:"outline-secondary",size:"sm",onClick:L,title:"Actualizar lista de subcategorías",children:"🔄 Actualizar"})]}),e.jsx("div",{className:"border rounded p-3 bg-light",style:{maxHeight:"200px",overflowY:"auto"},children:$.length>0?$.map(a=>e.jsx(t.Check,{type:"checkbox",id:`edit-subcategory-${a.id}`,label:`📂 ${a.name}`,checked:i.subcategory_id===a.id,onChange:s=>l(c=>({...c,subcategory_id:s.target.checked?a.id:""})),className:"mb-2"},a.id)):e.jsx("p",{className:"text-muted mb-0",children:"No hay subcategorías disponibles"})}),e.jsx(t.Text,{className:"text-muted d-block mt-1",children:"Selecciona una subcategoría para asignar al archivo"})]}),e.jsxs(r,{md:12,children:[e.jsx(t.Label,{className:"fw-medium",children:"Servicios Requeridos"}),e.jsxs("div",{className:"border rounded p-3 bg-light",children:[e.jsxs(_,{children:[e.jsx(r,{md:6,children:e.jsx(t.Check,{type:"checkbox",id:"requiere-laboratorio",label:"🧪 Laboratorio",checked:i.requiere_laboratorio,onChange:a=>l(s=>({...s,requiere_laboratorio:a.target.checked}))})}),e.jsx(r,{md:6,children:e.jsx(t.Check,{type:"checkbox",id:"requiere-ingenieria",label:"⚙️ Ingeniería",checked:i.requiere_ingenieria,onChange:a=>l(s=>({...s,requiere_ingenieria:a.target.checked}))})}),e.jsx(r,{md:6,children:e.jsx(t.Check,{type:"checkbox",id:"requiere-consultoria",label:"💼 Consultoría",checked:i.requiere_consultoria,onChange:a=>l(s=>({...s,requiere_consultoria:a.target.checked}))})}),e.jsx(r,{md:6,children:e.jsx(t.Check,{type:"checkbox",id:"requiere-capacitacion",label:"🎓 Capacitación",checked:i.requiere_capacitacion,onChange:a=>l(s=>({...s,requiere_capacitacion:a.target.checked}))})}),e.jsx(r,{md:6,children:e.jsx(t.Check,{type:"checkbox",id:"requiere-auditoria",label:"📋 Auditoría",checked:i.requiere_auditoria,onChange:a=>l(s=>({...s,requiere_auditoria:a.target.checked}))})})]}),e.jsx(t.Text,{className:"text-muted d-block mt-2",children:"Marca los servicios que requiere este archivo"})]})]})]}),e.jsxs("div",{className:"d-flex justify-content-end gap-2 mt-4",children:[e.jsx(o,{type:"button",variant:"outline-secondary",onClick:()=>P(!1),disabled:y.isLoading,children:"Cancelar"}),e.jsx(o,{type:"submit",variant:"success",disabled:y.isLoading,children:y.isLoading?e.jsxs(e.Fragment,{children:[e.jsx(E,{size:"sm",className:"me-2"}),"Actualizando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(J,{className:"me-2"}),"Actualizar Archivo"]})})]})]})}),e.jsx("div",{className:"modal-footer",children:e.jsxs("div",{className:"d-flex gap-2 justify-content-end",children:[e.jsx(o,{type:"button",variant:"outline-secondary",onClick:()=>P(!1),disabled:y.isLoading,children:"Cancelar"}),e.jsx(o,{type:"submit",variant:"success",disabled:y.isLoading,onClick:pe,children:y.isLoading?e.jsxs(e.Fragment,{children:[e.jsx(E,{size:"sm",className:"me-2"}),"Actualizando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(J,{className:"me-2"}),"Actualizar Archivo"]})})]})})]}),v&&e.jsx(te,{open:!!v,onClose:()=>B(null),children:e.jsxs("div",{children:[e.jsxs("div",{className:"d-flex align-items-center mb-4",children:[e.jsx(ie,{className:"me-2 text-danger",size:24}),e.jsx("h4",{className:"mb-0",children:"Confirmar Eliminación"})]}),e.jsxs(Se,{variant:"warning",className:"mb-4",children:[e.jsx(Ne,{className:"me-2"}),e.jsx("strong",{children:"¡Atención!"})," Esta acción no se puede deshacer."]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{children:"¿Estás seguro de que quieres eliminar el siguiente archivo?"}),e.jsx(b,{className:"bg-light",children:e.jsx(b.Body,{children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("span",{className:"me-3",style:{fontSize:"1.5em"},children:ae(v.original_name)}),e.jsxs("div",{children:[e.jsx("div",{className:"fw-medium",children:v.original_name}),e.jsxs("small",{className:"text-muted",children:["Proyecto: ",v.project_name||"Sin proyecto"]})]})]})})})]}),e.jsxs("div",{className:"d-flex justify-content-end gap-2",children:[e.jsx(o,{variant:"outline-secondary",onClick:()=>B(null),disabled:W.isLoading,children:"Cancelar"}),e.jsx(o,{variant:"danger",onClick:we,disabled:W.isLoading,children:W.isLoading?e.jsxs(e.Fragment,{children:[e.jsx(E,{size:"sm",className:"me-2"}),"Eliminando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ie,{className:"me-2"}),"Eliminar Archivo"]})})]})]})}),e.jsx(sa,{message:ce.message,type:ce.type,onClose:()=>N({message:"",type:"success",show:!1})})]})}export{Fa as default};
//# sourceMappingURL=Adjuntos-f89ZPNp7.js.map
