import{b as z,a as k,c as B,r as g,e as E,j as e,B as l,F as T,C as p,o as P,m as Q}from"./index-Cuktr-pt.js";import{C as u,R as i}from"./Row-DXxIMG7u.js";import{S as L}from"./Spinner-B39M6lL3.js";import{A as R}from"./Alert-D03HJGca.js";import{C as n}from"./Col-nNxAn9NL.js";import{F as $}from"./Form-luTHskiS.js";import{C as h}from"./Card-B0ZWfcwD.js";import"./ElementChildren-CA6H3NXv.js";const D=async(c={})=>{try{const r=new URLSearchParams;c.status&&r.append("status",c.status),c.page&&r.append("page",c.page),c.limit&&r.append("limit",c.limit);const m=r.toString(),a=`/api/quote-approval/my-quotes${m?`?${m}`:""}`;return await z(a)}catch(r){throw console.error("Error getting my quotes:",r),r}},I=()=>{const{user:c}=k();B();const[r,m]=g.useState({status:"",page:1,limit:20}),[a,N]=g.useState(null),[C,j]=g.useState(!1),{data:d,isLoading:_,error:y,refetch:A}=E(["myQuotes",r],()=>D(r),{enabled:!!c,refetchOnWindowFocus:!1}),F=s=>{const{name:t,value:x}=s.target;m(w=>({...w,[t]:x,page:1}))},b=s=>{m(t=>({...t,page:s}))},v=s=>{const x={borrador:{variant:"warning",text:"Borrador"},aprobada:{variant:"success",text:"Aprobada"},facturada:{variant:"info",text:"Facturada"}}[s]||{variant:"secondary",text:s};return e.jsx(p,{bg:x.variant,children:x.text})},S=s=>{const t=[];return t.push(e.jsxs(l,{variant:"primary",size:"sm",onClick:()=>{N(s),j(!0)},children:[e.jsx(Q,{className:"me-1"}),"Ver más"]},"view-more")),t};if(_)return e.jsx(u,{className:"py-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx(L,{animation:"border"}),e.jsx("p",{className:"mt-2",children:"Cargando mis cotizaciones..."})]})});if(y)return e.jsx(u,{className:"py-4",children:e.jsxs(R,{variant:"danger",children:["Error cargando cotizaciones: ",y.message]})});const f=(d==null?void 0:d.data)||[],o=(d==null?void 0:d.pagination)||{};return e.jsxs(u,{className:"py-4",children:[e.jsx(i,{className:"mb-4",children:e.jsxs(n,{children:[e.jsx("h2",{children:"Mis Cotizaciones"}),e.jsx("p",{className:"text-muted",children:"Gestiona tus cotizaciones de forma autónoma"})]})}),e.jsxs(i,{className:"mb-4",children:[e.jsx(n,{md:4,children:e.jsxs($.Select,{name:"status",value:r.status,onChange:F,children:[e.jsx("option",{value:"",children:"Todos los estados"}),e.jsx("option",{value:"borrador",children:"Borrador"}),e.jsx("option",{value:"aprobada",children:"Aprobada"}),e.jsx("option",{value:"facturada",children:"Facturada"})]})}),e.jsx(n,{md:4,children:e.jsx(l,{variant:"outline-secondary",onClick:()=>A(),children:"🔄 Actualizar"})})]}),e.jsx(i,{children:f.length===0?e.jsx(n,{children:e.jsx(h,{children:e.jsxs(h.Body,{className:"text-center py-5",children:[e.jsx(T,{size:48,className:"text-muted mb-3"}),e.jsx("h5",{children:"No hay cotizaciones"}),e.jsx("p",{className:"text-muted",children:r.status?`No se encontraron cotizaciones en estado "${r.status}"`:"No tienes cotizaciones registradas"})]})})}):f.map(s=>{var t;return e.jsx(n,{md:6,lg:4,className:"mb-3",children:e.jsxs(h,{children:[e.jsxs(h.Header,{className:"d-flex justify-content-between align-items-center",children:[e.jsx("strong",{children:s.quote_number||`COT-${s.id}`}),v(s.status)]}),e.jsxs(h.Body,{children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Cliente:"})," ",s.company_name||"N/A"]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Proyecto:"})," ",s.project_name||"N/A"]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Total:"})," S/ ",parseFloat(s.total||0).toFixed(2)]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Autor:"})," ",s.created_by_name||"N/A",s.created_by_role&&e.jsx(p,{bg:"info",className:"ms-2",children:s.created_by_role})]}),((t=s.meta)==null?void 0:t.file_name)&&e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Archivo:"})," ",s.meta.file_name]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"Fecha:"})," ",new Date(s.created_at).toLocaleDateString()]}),e.jsx("div",{className:"d-flex gap-2 flex-wrap",children:S(s)})]})]})},s.id)})}),o.pages>1&&e.jsx(i,{className:"mt-4",children:e.jsx(n,{children:e.jsx("div",{className:"d-flex justify-content-center",children:e.jsxs("div",{className:"btn-group",children:[e.jsx(l,{variant:"outline-secondary",disabled:o.page===1,onClick:()=>b(o.page-1),children:"Anterior"}),e.jsxs(l,{variant:"outline-secondary",disabled:!0,children:["Página ",o.page," de ",o.pages]}),e.jsx(l,{variant:"outline-secondary",disabled:o.page===o.pages,onClick:()=>b(o.page+1),children:"Siguiente"})]})})})}),C&&a&&e.jsx("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.5)"},children:e.jsx("div",{className:"modal-dialog modal-lg",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h5",{className:"modal-title",children:"Detalles de Cotización"}),e.jsx(l,{variant:"outline-secondary",onClick:()=>j(!1),children:e.jsx(P,{})})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs(i,{children:[e.jsxs(n,{md:6,children:[e.jsx("strong",{children:"Número:"})," ",a.quote_number||`COT-${a.id}`]}),e.jsxs(n,{md:6,children:[e.jsx("strong",{children:"Estado:"})," ",v(a.status)]})]}),e.jsx("hr",{}),e.jsxs(i,{children:[e.jsxs(n,{md:6,children:[e.jsx("strong",{children:"Cliente:"})," ",a.company_name||"N/A"]}),e.jsxs(n,{md:6,children:[e.jsx("strong",{children:"RUC:"})," ",a.company_ruc||"N/A"]})]}),e.jsxs(i,{children:[e.jsxs(n,{md:6,children:[e.jsx("strong",{children:"Proyecto:"})," ",a.project_name||"N/A"]}),e.jsxs(n,{md:6,children:[e.jsx("strong",{children:"Total:"})," S/ ",parseFloat(a.total||0).toFixed(2)]})]}),e.jsxs(i,{children:[e.jsxs(n,{md:6,children:[e.jsx("strong",{children:"Autor:"})," ",a.created_by_name||"N/A",a.created_by_role&&e.jsx(p,{bg:"info",className:"ms-2",children:a.created_by_role})]}),e.jsxs(n,{md:6,children:[e.jsx("strong",{children:"Contacto:"})," ",a.client_contact||"N/A"]})]}),e.jsxs(i,{children:[e.jsxs(n,{md:6,children:[e.jsx("strong",{children:"Email:"})," ",a.client_email||"N/A"]}),e.jsxs(n,{md:6,children:[e.jsx("strong",{children:"Teléfono:"})," ",a.client_phone||"N/A"]})]}),e.jsx("hr",{}),e.jsxs(i,{children:[e.jsxs(n,{md:6,children:[e.jsx("strong",{children:"Fecha de creación:"})," ",new Date(a.created_at).toLocaleString()]}),e.jsxs(n,{md:6,children:[e.jsx("strong",{children:"Última actualización:"})," ",new Date(a.updated_at).toLocaleString()]})]})]}),e.jsx("div",{className:"modal-footer",children:e.jsx(l,{variant:"secondary",onClick:()=>j(!1),children:"Cerrar"})})]})})})]})};export{I as default};
//# sourceMappingURL=MisCotizaciones-CvcKaiKA.js.map
