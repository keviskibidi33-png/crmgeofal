{"version":3,"file":"Clientes-CKdiExsN.js","sources":["../../src/pages/Clientes.jsx"],"sourcesContent":["import React, { useState, useMemo } from 'react';\r\nimport { useQuery, useMutation, useQueryClient } from 'react-query';\r\nimport { Button, Badge, Row, Col, Card, Container } from 'react-bootstrap';\r\nimport { FiPlus, FiEdit, FiTrash2, FiUser, FiHome, FiMail, FiPhone, FiMapPin, FiUsers, FiHome as FiBuilding } from 'react-icons/fi';\r\nimport PageHeader from '../components/common/PageHeader';\r\nimport DataTable from '../components/common/DataTable';\r\nimport ModalForm from '../components/common/ModalForm';\r\nimport StatsCard from '../components/common/StatsCard';\r\nimport { listCompanies, createCompany, updateCompany, deleteCompany } from '../services/companies';\r\n\r\nconst emptyForm = {\r\n  type: 'empresa',\r\n  ruc: '',\r\n  dni: '',\r\n  name: '',\r\n  address: '',\r\n  email: '',\r\n  phone: '',\r\n  contact_name: '',\r\n};\r\n\r\nexport default function Clientes() {\r\n  const [showModal, setShowModal] = useState(false);\r\n  const [editingClient, setEditingClient] = useState(null);\r\n  const [deletingClient, setDeletingClient] = useState(null);\r\n\r\n  const queryClient = useQueryClient();\r\n\r\n  const { data, isLoading } = useQuery(\r\n    ['clients'],\r\n    () => listCompanies(),\r\n    { keepPreviousData: true }\r\n  );\r\n\r\n  const handleMutationSuccess = (message) => {\r\n    queryClient.invalidateQueries('clients');\r\n    setShowModal(false);\r\n    setEditingClient(null);\r\n    setDeletingClient(null);\r\n  };\r\n\r\n  const createMutation = useMutation(createCompany, {\r\n    onSuccess: () => handleMutationSuccess('Cliente creado exitosamente'),\r\n    onError: (error) => console.error('Error creating client:', error)\r\n  });\r\n\r\n  const updateMutation = useMutation(updateCompany, {\r\n    onSuccess: () => handleMutationSuccess('Cliente actualizado exitosamente'),\r\n    onError: (error) => console.error('Error updating client:', error)\r\n  });\r\n\r\n  const deleteMutation = useMutation(deleteCompany, {\r\n    onSuccess: () => handleMutationSuccess('Cliente eliminado exitosamente'),\r\n    onError: (error) => console.error('Error deleting client:', error)\r\n  });\r\n\r\n  const handleCreate = () => {\r\n    setEditingClient(emptyForm);\r\n    setShowModal(true);\r\n  };\r\n\r\n  const handleEdit = (client) => {\r\n    setEditingClient(client);\r\n    setShowModal(true);\r\n  };\r\n\r\n  const handleDelete = (client) => {\r\n    if (window.confirm(`¿Estás seguro de que quieres eliminar el cliente \"${client.name}\"?`)) {\r\n      deleteMutation.mutate(client.id);\r\n    }\r\n  };\r\n\r\n  const handleSubmit = async (formData) => {\r\n    if (editingClient.id) {\r\n      await updateMutation.mutateAsync({ id: editingClient.id, ...formData });\r\n    } else {\r\n      await createMutation.mutateAsync(formData);\r\n    }\r\n  };\r\n\r\n  const getTypeBadge = (type) => {\r\n    const typeConfig = {\r\n      'empresa': { bg: 'primary', text: 'Empresa', icon: FiHome },\r\n      'persona': { bg: 'info', text: 'Persona Natural', icon: FiUser }\r\n    };\r\n    \r\n    const config = typeConfig[type] || { bg: 'secondary', text: type, icon: FiUser };\r\n    const Icon = config.icon;\r\n    \r\n    return (\r\n      <Badge bg={config.bg} className=\"status-badge d-flex align-items-center\">\r\n        <Icon size={12} className=\"me-1\" />\r\n        {config.text}\r\n      </Badge>\r\n    );\r\n  };\r\n\r\n  const columns = [\r\n    {\r\n      header: 'ID',\r\n      accessor: 'id',\r\n      width: '80px'\r\n    },\r\n    {\r\n      header: 'Cliente',\r\n      accessor: 'name',\r\n      render: (value, row) => (\r\n        <div>\r\n          <div className=\"fw-medium\">{row.name}</div>\r\n          <div className=\"d-flex align-items-center gap-2 mt-1\">\r\n            {getTypeBadge(row.type)}\r\n            {row.ruc && (\r\n              <small className=\"text-muted\">RUC: {row.ruc}</small>\r\n            )}\r\n            {row.dni && (\r\n              <small className=\"text-muted\">DNI: {row.dni}</small>\r\n            )}\r\n          </div>\r\n        </div>\r\n      )\r\n    },\r\n    {\r\n      header: 'Contacto',\r\n      accessor: 'contact',\r\n      render: (value, row) => (\r\n        <div>\r\n          {row.contact_name && (\r\n            <div className=\"fw-medium\">{row.contact_name}</div>\r\n          )}\r\n          {row.email && (\r\n            <div className=\"d-flex align-items-center mt-1\">\r\n              <FiMail size={12} className=\"me-1 text-muted\" />\r\n              <small className=\"text-muted\">{row.email}</small>\r\n            </div>\r\n          )}\r\n          {row.phone && (\r\n            <div className=\"d-flex align-items-center mt-1\">\r\n              <FiPhone size={12} className=\"me-1 text-muted\" />\r\n              <small className=\"text-muted\">{row.phone}</small>\r\n            </div>\r\n          )}\r\n        </div>\r\n      )\r\n    },\r\n    {\r\n      header: 'Dirección',\r\n      accessor: 'address',\r\n      render: (value) => (\r\n        value ? (\r\n          <div className=\"d-flex align-items-center\">\r\n            <FiMapPin size={12} className=\"me-1 text-muted\" />\r\n            <small className=\"text-muted\">{value}</small>\r\n          </div>\r\n        ) : (\r\n          <small className=\"text-muted\">Sin dirección</small>\r\n        )\r\n      )\r\n    },\r\n    {\r\n      header: 'Fecha Registro',\r\n      accessor: 'created_at',\r\n      type: 'date'\r\n    }\r\n  ];\r\n\r\n  const formFields = [\r\n    {\r\n      name: 'type',\r\n      label: 'Tipo de Cliente',\r\n      type: 'select',\r\n      required: true,\r\n      options: [\r\n        { value: 'empresa', label: 'Empresa' },\r\n        { value: 'persona', label: 'Persona Natural' }\r\n      ]\r\n    },\r\n    {\r\n      name: 'name',\r\n      label: 'Nombre/Razón Social',\r\n      type: 'text',\r\n      required: true,\r\n      placeholder: 'Ingresa el nombre o razón social'\r\n    },\r\n    {\r\n      name: 'ruc',\r\n      label: 'RUC',\r\n      type: 'text',\r\n      placeholder: 'Ingresa el RUC (solo para empresas)',\r\n      help: 'Solo para empresas'\r\n    },\r\n    {\r\n      name: 'dni',\r\n      label: 'DNI',\r\n      type: 'text',\r\n      placeholder: 'Ingresa el DNI (solo para personas)',\r\n      help: 'Solo para personas naturales'\r\n    },\r\n    {\r\n      name: 'contact_name',\r\n      label: 'Nombre de Contacto',\r\n      type: 'text',\r\n      placeholder: 'Ingresa el nombre del contacto'\r\n    },\r\n    {\r\n      name: 'email',\r\n      label: 'Email',\r\n      type: 'email',\r\n      placeholder: 'contacto@empresa.com'\r\n    },\r\n    {\r\n      name: 'phone',\r\n      label: 'Teléfono',\r\n      type: 'text',\r\n      placeholder: '+51 999 999 999'\r\n    },\r\n    {\r\n      name: 'address',\r\n      label: 'Dirección',\r\n      type: 'textarea',\r\n      placeholder: 'Ingresa la dirección completa'\r\n    }\r\n  ];\r\n\r\n  // Calcular estadísticas\r\n  const stats = useMemo(() => {\r\n    const companies = data?.companies || [];\r\n    return {\r\n      total: companies.length,\r\n      empresas: companies.filter(c => c.type === 'empresa').length,\r\n      personas: companies.filter(c => c.type === 'persona').length,\r\n      conEmail: companies.filter(c => c.email).length,\r\n      conTelefono: companies.filter(c => c.phone).length\r\n    };\r\n  }, [data]);\r\n\r\n  return (\r\n    <Container fluid className=\"py-4\">\r\n      <div className=\"fade-in\">\r\n        <PageHeader\r\n          title=\"Gestión de Clientes\"\r\n          subtitle=\"Crear, editar y gestionar clientes del sistema\"\r\n          icon={FiUsers}\r\n          actions={\r\n            <Button variant=\"primary\" onClick={handleCreate}>\r\n              <FiPlus className=\"me-2\" />\r\n              Nuevo Cliente\r\n            </Button>\r\n          }\r\n        />\r\n\r\n        {/* Estadísticas */}\r\n        <Row className=\"g-4 mb-4\">\r\n          <Col md={6} lg={3}>\r\n            <StatsCard\r\n              title=\"Total Clientes\"\r\n              value={stats.total}\r\n              icon={FiUsers}\r\n              color=\"primary\"\r\n              subtitle=\"Clientes registrados\"\r\n            />\r\n          </Col>\r\n          <Col md={6} lg={3}>\r\n            <StatsCard\r\n              title=\"Empresas\"\r\n              value={stats.empresas}\r\n              icon={FiBuilding}\r\n              color=\"success\"\r\n              subtitle=\"Clientes corporativos\"\r\n            />\r\n          </Col>\r\n          <Col md={6} lg={3}>\r\n            <StatsCard\r\n              title=\"Personas\"\r\n              value={stats.personas}\r\n              icon={FiUser}\r\n              color=\"info\"\r\n              subtitle=\"Clientes individuales\"\r\n            />\r\n          </Col>\r\n          <Col md={6} lg={3}>\r\n            <StatsCard\r\n              title=\"Con Contacto\"\r\n              value={stats.conEmail}\r\n              icon={FiMail}\r\n              color=\"warning\"\r\n              subtitle=\"Con email registrado\"\r\n            />\r\n          </Col>\r\n        </Row>\r\n\r\n        {/* Tabla de clientes */}\r\n        <Card className=\"shadow-sm border-0\">\r\n          <Card.Header className=\"bg-white border-bottom\">\r\n            <div className=\"d-flex justify-content-between align-items-center\">\r\n              <h5 className=\"mb-0\">\r\n                <FiUsers className=\"me-2 text-primary\" />\r\n                Lista de Clientes\r\n              </h5>\r\n              <Badge bg=\"light\" text=\"dark\" className=\"px-3 py-2\">\r\n                {stats.total} clientes\r\n              </Badge>\r\n            </div>\r\n          </Card.Header>\r\n          <Card.Body className=\"p-0\">\r\n            <DataTable\r\n              data={data?.companies || []}\r\n              columns={columns}\r\n              loading={isLoading}\r\n              onEdit={handleEdit}\r\n              onDelete={handleDelete}\r\n              emptyMessage=\"No hay clientes registrados\"\r\n            />\r\n          </Card.Body>\r\n        </Card>\r\n\r\n      <ModalForm\r\n        show={showModal}\r\n        onHide={() => setShowModal(false)}\r\n        title={editingClient?.id ? 'Editar Cliente' : 'Nuevo Cliente'}\r\n        data={editingClient || emptyForm}\r\n        fields={formFields}\r\n        onSubmit={handleSubmit}\r\n        loading={createMutation.isLoading || updateMutation.isLoading}\r\n        submitText={editingClient?.id ? 'Actualizar' : 'Crear'}\r\n      />\r\n      </div>\r\n    </Container>\r\n  );\r\n};"],"names":["emptyForm","Clientes","showModal","setShowModal","useState","editingClient","setEditingClient","deletingClient","setDeletingClient","queryClient","useQueryClient","data","isLoading","useQuery","listCompanies","handleMutationSuccess","message","createMutation","useMutation","createCompany","error","updateMutation","updateCompany","deleteMutation","deleteCompany","handleCreate","handleEdit","client","handleDelete","handleSubmit","formData","getTypeBadge","type","config","FiHome","FiUser","Icon","Badge","jsx","columns","value","row","jsxs","FiMail","FiPhone","FiMapPin","formFields","stats","useMemo","companies","c","Container","PageHeader","FiUsers","Button","FiPlus","Row","Col","StatsCard","FiBuilding","Card","DataTable","ModalForm"],"mappings":"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"}