import{r as c,j as e,B as N,o as O,w as Js,e as Ne,Z as Ws,C as P,T as ne,O as He,V as Ys,z as xe,k as ye,b as Ks,y as bs,f as ue,n as pe,g as Ae,_ as Xs,a as Zs,u as ea,$ as sa,c as aa,x as he,L as us,A as ia,m as ra,J as xs,W as ta,a0 as ps,F as ve,a1 as gs,a2 as js,K as oa}from"./index-Cuktr-pt.js";import{P as na}from"./PageHeader-BYHPV7CG.js";import{D as la}from"./DataTable-C6u_tpkV.js";/* empty css                     */import{M as fe}from"./Modal-DX3fBC5J.js";import{F as d}from"./Form-luTHskiS.js";import{R as Z,C as ca}from"./Row-DXxIMG7u.js";import{C as _}from"./Col-nNxAn9NL.js";import{S as Ge}from"./Spinner-B39M6lL3.js";import{S as ke}from"./StatsCard-BrhQkFRp.js";import{C as Re}from"./ConfirmModal-BG0s3nBn.js";import{c as da,u as ma,d as ha,a as ua,b as xa,e as pa,l as ga,g as ja}from"./projects-Bepwnn11.js";import{l as Ve,u as ba,d as va,a as fa}from"./attachments-Da5n6gEq.js";import{l as ya}from"./users-MgGfGVTX.js";import{l as Na,a as Sa}from"./services-Do7Z9djk.js";import{C as u}from"./Card-B0ZWfcwD.js";import{A as ze}from"./Alert-D03HJGca.js";import{P as _a}from"./ProgressBar-Cuk399x_.js";/* empty css                  */import"./InputGroup-aBcikS0_.js";import"./Table-BqADrEzs.js";import"./ElementChildren-CA6H3NXv.js";/* empty css                  */const Fe=({show:v,onHide:S,title:C,data:f={},fields:t=[],onSubmit:z,loading:j=!1,size:D="lg",submitText:L="Guardar",cancelText:y="Cancelar",validation:x={},className:se=""})=>{const[I,U]=c.useState({}),[B,T]=c.useState({}),[Q,J]=c.useState({}),[$,r]=c.useState({}),[g,p]=c.useState({});c.useEffect(()=>{v&&(U(f),T({}),J({}))},[v,f]);const k=(i,n)=>{U(q=>({...q,[i]:n})),B[i]&&T(q=>({...q,[i]:null}));const h=t.find(q=>q.name===i);if(h&&h.autocomplete&&h.suggestions&&n.length>0){const q=h.suggestions.filter(b=>b.toLowerCase().includes(n.toLowerCase()));r(b=>({...b,[i]:q.slice(0,5)})),p(b=>({...b,[i]:!0}))}else p(q=>({...q,[i]:!1}))},R=i=>{if(J(n=>({...n,[i]:!0})),setTimeout(()=>{p(n=>({...n,[i]:!1}))},200),x[i]){const n=x[i](I[i],I);n&&T(h=>({...h,[i]:n}))}},ae=(i,n)=>{U(h=>({...h,[i]:n})),p(h=>({...h,[i]:!1}))},H=()=>{const i={};let n=!0;return t.forEach(h=>{if(h.required&&(!I[h.name]||I[h.name]===""))i[h.name]=`${h.label} es requerido`,n=!1;else if(x[h.name]){const q=x[h.name](I[h.name],I);q&&(i[h.name]=q,n=!1)}}),T(i),n},ie=async i=>{if(i.preventDefault(),H())try{await z(I),S()}catch(n){console.error("Error submitting form:",n)}},le=i=>{var q;const n=Q[i.name]&&B[i.name],h=I[i.name]||"";switch(i.type){case"text":case"email":case"password":return e.jsxs(d.Group,{className:"mb-3 position-relative",children:[e.jsxs(d.Label,{children:[i.label,i.required&&e.jsx("span",{className:"text-danger ms-1",children:"*"})]}),e.jsx(d.Control,{type:i.type,name:i.name,value:h,onChange:b=>k(i.name,b.target.value),onBlur:()=>R(i.name),isInvalid:n,placeholder:i.placeholder,disabled:i.disabled}),n&&e.jsx(d.Control.Feedback,{type:"invalid",children:B[i.name]}),i.help&&e.jsx(d.Text,{className:"text-muted",children:i.help}),i.autocomplete&&g[i.name]&&$[i.name]&&$[i.name].length>0&&e.jsx("div",{className:"autocomplete-suggestions position-absolute w-100",style:{zIndex:1e3,top:"100%"},children:e.jsx("div",{className:"list-group",children:$[i.name].map((b,ge)=>e.jsx("button",{type:"button",className:"list-group-item list-group-item-action",onClick:()=>ae(i.name,b),style:{fontSize:"0.875rem",padding:"0.5rem 0.75rem"},children:b},ge))})})]},i.name);case"textarea":return e.jsxs(d.Group,{className:"mb-3",children:[e.jsxs(d.Label,{children:[i.label,i.required&&e.jsx("span",{className:"text-danger ms-1",children:"*"})]}),e.jsx(d.Control,{as:"textarea",rows:i.rows||3,name:i.name,value:h,onChange:b=>k(i.name,b.target.value),onBlur:()=>R(i.name),isInvalid:n,placeholder:i.placeholder}),n&&e.jsx(d.Control.Feedback,{type:"invalid",children:B[i.name]})]},i.name);case"select":return e.jsxs(d.Group,{className:"mb-3",children:[e.jsxs(d.Label,{children:[i.label,i.required&&e.jsx("span",{className:"text-danger ms-1",children:"*"})]}),e.jsxs(d.Select,{name:i.name,value:h,onChange:b=>k(i.name,b.target.value),onBlur:()=>R(i.name),isInvalid:n,children:[e.jsx("option",{value:"",children:"Seleccionar..."}),(q=i.options)==null?void 0:q.map(b=>e.jsx("option",{value:b.value,children:b.label},b.value))]}),n&&e.jsx(d.Control.Feedback,{type:"invalid",children:B[i.name]})]},i.name);case"number":return e.jsxs(d.Group,{className:"mb-3",children:[e.jsxs(d.Label,{children:[i.label,i.required&&e.jsx("span",{className:"text-danger ms-1",children:"*"})]}),e.jsx(d.Control,{type:"number",name:i.name,value:h,onChange:b=>k(i.name,parseFloat(b.target.value)||""),onBlur:()=>R(i.name),isInvalid:n,placeholder:i.placeholder,min:i.min,max:i.max,step:i.step}),n&&e.jsx(d.Control.Feedback,{type:"invalid",children:B[i.name]})]},i.name);case"checkbox":return e.jsx(d.Group,{className:"mb-3",children:e.jsx(d.Check,{type:"checkbox",name:i.name,checked:!!h,onChange:b=>k(i.name,b.target.checked),label:i.label})},i.name);case"custom":return e.jsx("div",{className:"mb-3",children:i.render&&i.render(I)},i.name);default:return null}};return e.jsxs(fe,{show:v,onHide:S,size:D,className:se,children:[e.jsx(fe.Header,{closeButton:!0,className:"border-0 pb-0",children:e.jsx(fe.Title,{className:"fw-bold",children:C})}),e.jsxs(d,{onSubmit:ie,children:[e.jsx(fe.Body,{className:"pt-0",children:e.jsx(Z,{children:t.map(i=>e.jsx(_,{md:i.col||12,children:le(i)},i.name))})}),e.jsxs(fe.Footer,{className:"border-0 pt-0",children:[e.jsxs(N,{variant:"outline-secondary",onClick:S,disabled:j,children:[e.jsx(O,{className:"me-1"}),y]}),e.jsx(N,{type:"submit",variant:"primary",disabled:j,children:j?e.jsxs(e.Fragment,{children:[e.jsx(Ge,{size:"sm",className:"me-1"}),"Guardando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Js,{className:"me-1"}),L]})})]})]})]})};function wa({selectedServices:v=[],onServicesChange:S}){const[C,f]=c.useState(""),[t,z]=c.useState(null),[j,D]=c.useState([]),{data:L,isLoading:y}=Ne(["services"],()=>Na({}),{staleTime:5*60*1e3,cacheTime:10*60*1e3}),{data:x,isLoading:se}=Ne(["subservices",t==null?void 0:t.id],()=>t?Sa({service_id:t.id}):null,{enabled:!!t,staleTime:5*60*1e3,cacheTime:10*60*1e3}),I=(L==null?void 0:L.data)||(L==null?void 0:L.rows)||[],U=(x==null?void 0:x.data)||(x==null?void 0:x.rows)||[],B=I.filter(r=>{var g,p;return((g=r.name)==null?void 0:g.toLowerCase().includes(C.toLowerCase()))||((p=r.description)==null?void 0:p.toLowerCase().includes(C.toLowerCase()))}),T=r=>{if(!v.some(p=>p.ensayo.id===r.id)){if(v.length>=5){alert("MÃ¡ximo 5 servicios pueden ser seleccionados");return}z(r),D([])}},Q=r=>{const g=j.some(p=>p.id===r.id);D(g?p=>p.filter(k=>k.id!==r.id):p=>[...p,r])},J=()=>{if(t&&j.length>0){const r={ensayo:t,subservices:j,total:j.reduce((g,p)=>g+(p.precio||0),0)};S([...v,r]),z(null),D([])}},$=r=>{const g=v.filter((p,k)=>k!==r);S(g)};return e.jsxs("div",{className:"service-selection",children:[e.jsxs(u,{className:"mb-4",children:[e.jsx(u.Header,{children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("h6",{className:"mb-0",children:[e.jsx(Ws,{className:"me-2"}),"SelecciÃ³n de Servicios"]}),e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsxs(P,{bg:"info",children:[v.length,"/5 seleccionados"]}),v.length>0&&e.jsxs(N,{variant:"outline-danger",size:"sm",onClick:()=>S([]),children:[e.jsx(O,{size:12,className:"me-1"}),"Limpiar"]})]})]})}),e.jsxs(u.Body,{children:[e.jsx("div",{className:"mb-3",children:e.jsx(d.Control,{type:"text",placeholder:"Buscar servicios...",value:C,onChange:r=>f(r.target.value)})}),y?e.jsxs("div",{className:"text-center py-4",children:[e.jsx(Ge,{animation:"border",variant:"primary"}),e.jsx("p",{className:"mt-2 text-muted",children:"Cargando servicios..."})]}):e.jsx(Z,{className:"g-3",children:B.map(r=>{const g=v.some(k=>k.ensayo.id===r.id),p=(t==null?void 0:t.id)===r.id;return e.jsx(_,{md:6,lg:4,children:e.jsx(u,{className:`h-100 cursor-pointer ${g?"border-success":p?"border-primary":""} ${g?"bg-light":""}`,onClick:()=>T(r),children:e.jsxs(u.Body,{children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-start mb-2",children:[e.jsx("h6",{className:"mb-1",children:r.name}),g?e.jsx(P,{bg:"success",children:e.jsx(ne,{size:14})}):p?e.jsx(P,{bg:"primary",children:e.jsx(ne,{size:14})}):null]}),e.jsx("p",{className:"text-muted small mb-2",children:r.description||"Sin descripciÃ³n"}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("small",{className:"text-muted",children:[e.jsx(He,{className:"me-1",size:12}),r.norma||"N/A"]}),e.jsxs(P,{bg:r.subservices_count>0?"info":"secondary",children:[r.subservices_count||0," subservicios"]})]})]})})},r.id)})}),t&&e.jsxs(u,{className:"mt-4 border-primary",children:[e.jsx(u.Header,{children:e.jsxs("h6",{className:"mb-0",children:["Subservicios de: ",t.name]})}),e.jsxs(u.Body,{children:[se?e.jsxs("div",{className:"text-center py-3",children:[e.jsx(Ge,{animation:"border",size:"sm",variant:"primary"}),e.jsx("p",{className:"mt-2 text-muted small",children:"Cargando subservicios..."})]}):U.length>0?e.jsx(Z,{className:"g-2",children:U.map(r=>{const g=j.some(p=>p.id===r.id);return e.jsx(_,{md:6,lg:4,children:e.jsx(u,{className:`h-100 cursor-pointer ${g?"border-success":""}`,onClick:()=>Q(r),children:e.jsxs(u.Body,{className:"p-3",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-start mb-2",children:[e.jsx("h6",{className:"mb-1 small",children:r.codigo}),g&&e.jsx(P,{bg:"success",children:e.jsx(ne,{size:12})})]}),e.jsx("p",{className:"text-muted small mb-2",children:r.descripcion}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsx("small",{className:"text-muted",children:r.norma||"-"}),e.jsxs(P,{bg:r.precio>0?"success":"warning",children:[e.jsx(Ys,{className:"me-1",size:10}),r.precio>0?`S/ ${r.precio}`:"Sujeto a evaluaciÃ³n"]})]})]})})},r.id)})}):e.jsx(ze,{variant:"info",className:"mb-0",children:"No hay subservicios disponibles para este servicio."}),j.length>0&&e.jsx("div",{className:"mt-3 text-center",children:e.jsxs(N,{variant:"success",onClick:J,disabled:j.length===0,children:[e.jsx(ne,{className:"me-1"}),"Agregar ",j.length," subservicio(s) seleccionado(s)"]})})]})]})]})]}),v.length>0&&e.jsxs(u,{className:"border-success",children:[e.jsx(u.Header,{children:e.jsxs("h6",{className:"mb-0 text-success",children:[e.jsx(ne,{className:"me-2"}),"Servicios Seleccionados (",v.length,")"]})}),e.jsx(u.Body,{children:v.map((r,g)=>e.jsx(u,{className:"mb-3",children:e.jsx(u.Body,{children:e.jsxs("div",{className:"d-flex justify-content-between align-items-start",children:[e.jsxs("div",{children:[e.jsx("h6",{className:"mb-1",children:r.ensayo.name}),e.jsx("p",{className:"text-muted small mb-2",children:r.ensayo.description}),e.jsx("div",{className:"d-flex flex-wrap gap-1",children:r.subservices.map((p,k)=>e.jsx(P,{bg:"info",className:"me-1",children:p.codigo},k))})]}),e.jsxs("div",{className:"text-end",children:[e.jsxs("h6",{className:"text-success mb-1",children:["S/ ",r.total.toFixed(2)]}),e.jsx(N,{variant:"outline-danger",size:"sm",onClick:()=>$(g),children:e.jsx(O,{size:14})})]})]})})},g))})]})]})}function vs({onServicesChange:v,selectedServices:S=[]}){const C=f=>{v(f)};return e.jsxs(u,{className:"mb-4",children:[e.jsx(u.Header,{children:e.jsxs("h6",{className:"mb-0",children:[e.jsx(xe,{className:"me-2"}),"ConfiguraciÃ³n de Servicios del Proyecto"]})}),e.jsxs(u.Body,{children:[e.jsxs(ze,{variant:"info",className:"mb-4",children:[e.jsx(ye,{className:"me-2"}),e.jsxs("div",{children:[e.jsx("strong",{children:"Servicios:"})," Selecciona los servicios que necesitas para este proyecto.",e.jsx("br",{}),e.jsx("small",{className:"text-muted",children:"Puedes elegir entre diferentes tipos de servicios (Laboratorio, IngenierÃ­a, etc.) y sus subservicios correspondientes. MÃ¡ximo 5 servicios."})]})]}),e.jsx(wa,{selectedServices:S,onServicesChange:C}),S.length>0&&e.jsxs(u,{className:"border-success mt-4",children:[e.jsx(u.Header,{children:e.jsxs("h6",{className:"mb-0 text-success",children:[e.jsx(ne,{className:"me-2"}),"Resumen de Servicios Seleccionados"]})}),e.jsx(u.Body,{children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Total de Servicios:"})," ",S.length]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Total de Subservicios:"})," ",S.reduce((f,t)=>f+t.subservices.length,0)]})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Subtotal:"})," S/ ",S.reduce((f,t)=>f+t.total,0).toFixed(2)]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"IGV (18%):"})," S/ ",(S.reduce((f,t)=>f+t.total,0)*.18).toFixed(2)]}),e.jsxs("div",{className:"fw-bold text-success",children:[e.jsx("strong",{children:"Total:"})," S/ ",(S.reduce((f,t)=>f+t.total,0)*1.18).toFixed(2)]})]})]})})]})]})]})}const Ca=async(v,S)=>{try{const C=new URLSearchParams({type:v,q:S});return await Ks(`/companies/search?${C.toString()}`)}catch(C){throw console.error("Error en bÃºsqueda de empresas:",C),C}};function qa({data:v={},onSubmit:S,loading:C=!1,onCancel:f}){const[t,z]=c.useState({clientType:"",client_id:"",client_name:"",client_info:{},name:"",location:"",vendedor_id:"",laboratorio_id:"",contact_name:"",contact_phone:"",contact_email:"",queries:"",priority:"normal",marked:!1,selectedServices:[]}),[j,D]=c.useState(1),[L,y]=c.useState(!1),[x,se]=c.useState({}),[I,U]=c.useState(""),[B,T]=c.useState([]),[Q,J]=c.useState(!1),[$,r]=c.useState(!1),g=4;c.useEffect(()=>{v&&z(o=>({...o,...v,selectedServices:v.selectedServices||[]}))},[v]);const p=(o,m)=>{z(E=>({...E,[o]:m})),x[o]&&se(E=>({...E,[o]:null}))},k=o=>{z(m=>({...m,selectedServices:o}))},R=async o=>{if(!o||o.length<2){T([]),r(!1);return}if(!t.clientType){T([]),r(!1);return}J(!0);try{const m=await Ca(t.clientType,o);m.success?(T(m.data||[]),r(!0)):(T([]),r(!1))}catch(m){console.error("Error en bÃºsqueda:",m),T([]),r(!1)}finally{J(!1)}},ae=o=>{z(m=>({...m,client_id:o.id,client_name:o.name,client_info:o})),U(o.name),r(!1)},H=()=>{z(o=>({...o,client_id:"",client_name:"",client_info:{}})),U(""),T([]),r(!1)},ie=o=>{const m={};switch(o){case 1:t.clientType||(m.clientType="Selecciona el tipo de cliente"),t.client_id||(m.client_id="Selecciona un cliente"),t.name||(m.name="Nombre del proyecto es requerido"),t.location||(m.location="UbicaciÃ³n es requerida");break;case 2:t.contact_name||(m.contact_name="Persona de contacto es requerida"),t.contact_phone||(m.contact_phone="TelÃ©fono es requerido");break;case 3:t.selectedServices.length===0&&(m.services="Debes seleccionar al menos un servicio");break}return se(m),Object.keys(m).length===0},le=()=>{ie(j)&&D(o=>Math.min(o+1,g))},i=()=>{D(o=>Math.max(o-1,1))},n=()=>{ie(j)&&S(t)},h=o=>{switch(o){case 1:return e.jsx(pe,{});case 2:return e.jsx(Ae,{});case 3:return e.jsx(xe,{});case 4:return e.jsx(ue,{});default:return e.jsx(pe,{})}},q=o=>{switch(o){case 1:return"InformaciÃ³n BÃ¡sica";case 2:return"Contacto";case 3:return"Servicios";case 4:return"Resumen";default:return"Paso"}},b=()=>e.jsxs("div",{className:"step-content",children:[e.jsxs("h5",{className:"mb-4",children:[e.jsx(pe,{className:"me-2"}),"InformaciÃ³n BÃ¡sica del Proyecto"]}),e.jsxs(Z,{className:"g-3",children:[e.jsx(_,{md:12,children:e.jsxs(d.Group,{children:[e.jsx(d.Label,{className:"fw-bold",children:"Tipo de Cliente *"}),e.jsxs("div",{className:"d-flex gap-3",children:[e.jsx(d.Check,{type:"radio",id:"empresa",name:"clientType",label:"Empresa",checked:t.clientType==="empresa",onChange:()=>p("clientType","empresa"),className:"d-flex align-items-center"}),e.jsx(d.Check,{type:"radio",id:"persona_natural",name:"clientType",label:"Persona Natural",checked:t.clientType==="persona_natural",onChange:()=>p("clientType","persona_natural"),className:"d-flex align-items-center"})]}),x.clientType&&e.jsx(d.Control.Feedback,{type:"invalid",children:x.clientType})]})}),t.clientType&&e.jsx(_,{md:12,children:e.jsxs(d.Group,{children:[e.jsxs(d.Label,{className:"fw-bold",children:["Buscar ",t.clientType==="empresa"?"Empresa":"Persona Natural"," *"]}),e.jsxs("div",{className:"position-relative",children:[e.jsx(d.Control,{type:"text",value:I,onChange:o=>{const m=o.target.value;U(m),R(m)},placeholder:`Buscar ${t.clientType==="empresa"?"empresa":"persona natural"}...`,isInvalid:!!x.client_id}),Q&&e.jsx("div",{className:"position-absolute top-50 end-0 translate-middle-y me-3",children:e.jsx("div",{className:"spinner-border spinner-border-sm",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Buscando..."})})}),$&&I&&e.jsx("div",{className:"position-absolute w-100 bg-white border rounded shadow-lg",style:{zIndex:1e3,maxHeight:"300px",overflowY:"auto"},children:B.length>0?B.map((o,m)=>e.jsxs("div",{className:"p-3 border-bottom cursor-pointer hover-bg-light",onClick:()=>ae(o),children:[e.jsx("div",{className:"fw-bold",children:o.name}),e.jsxs("div",{className:"text-muted small",children:[t.clientType==="empresa"?o.ruc:o.dni," â€¢ ",o.address]})]},m)):e.jsx("div",{className:"p-3 text-muted text-center",children:"No se encontraron resultados"})})]}),x.client_id&&e.jsx(d.Control.Feedback,{type:"invalid",children:x.client_id})]})}),t.client_id&&e.jsx(_,{md:12,children:e.jsxs(u,{className:"border-success",children:[e.jsxs(u.Header,{className:"bg-success text-white d-flex justify-content-between align-items-center",children:[e.jsxs("h6",{className:"mb-0",children:[e.jsx(ue,{className:"me-2"}),"Cliente Seleccionado"]}),e.jsxs(N,{variant:"outline-light",size:"sm",onClick:H,className:"d-flex align-items-center",children:[e.jsx(O,{className:"me-1"}),"Cambiar"]})]}),e.jsx(u.Body,{children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsx("strong",{children:"Nombre:"})," ",t.client_name]}),e.jsxs("div",{className:"col-md-6",children:[e.jsxs("strong",{children:[t.clientType==="empresa"?"RUC":"DNI",":"]})," ",t.client_info.ruc||t.client_info.dni]}),e.jsxs("div",{className:"col-md-12 mt-2",children:[e.jsx("strong",{children:"DirecciÃ³n:"})," ",t.client_info.address]}),t.client_info.phone&&e.jsxs("div",{className:"col-md-6 mt-2",children:[e.jsx("strong",{children:"TelÃ©fono:"})," ",t.client_info.phone]}),t.client_info.email&&e.jsxs("div",{className:"col-md-6 mt-2",children:[e.jsx("strong",{children:"Email:"})," ",t.client_info.email]})]})})]})}),e.jsx(_,{md:12,children:e.jsxs(d.Group,{children:[e.jsx(d.Label,{className:"fw-bold",children:"Nombre del Proyecto *"}),e.jsx(d.Control,{type:"text",value:t.name,onChange:o=>p("name",o.target.value),placeholder:"Ingresa el nombre del proyecto",isInvalid:!!x.name}),x.name&&e.jsx(d.Control.Feedback,{type:"invalid",children:x.name})]})}),e.jsx(_,{md:12,children:e.jsxs(d.Group,{children:[e.jsx(d.Label,{className:"fw-bold",children:"UbicaciÃ³n *"}),e.jsx(d.Control,{type:"text",value:t.location,onChange:o=>p("location",o.target.value),placeholder:"Ingresa la ubicaciÃ³n del proyecto",isInvalid:!!x.location}),x.location&&e.jsx(d.Control.Feedback,{type:"invalid",children:x.location})]})})]})]}),ge=()=>e.jsxs("div",{className:"step-content",children:[e.jsxs("h5",{className:"mb-4",children:[e.jsx(Ae,{className:"me-2"}),"InformaciÃ³n de Contacto"]}),e.jsxs(Z,{className:"g-3",children:[e.jsx(_,{md:6,children:e.jsxs(d.Group,{children:[e.jsx(d.Label,{className:"fw-bold",children:"Persona de Contacto *"}),e.jsx(d.Control,{type:"text",value:t.contact_name,onChange:o=>p("contact_name",o.target.value),placeholder:"Nombre completo",isInvalid:!!x.contact_name}),x.contact_name&&e.jsx(d.Control.Feedback,{type:"invalid",children:x.contact_name})]})}),e.jsx(_,{md:6,children:e.jsxs(d.Group,{children:[e.jsx(d.Label,{className:"fw-bold",children:"TelÃ©fono *"}),e.jsx(d.Control,{type:"tel",value:t.contact_phone,onChange:o=>p("contact_phone",o.target.value),placeholder:"NÃºmero de telÃ©fono",isInvalid:!!x.contact_phone}),x.contact_phone&&e.jsx(d.Control.Feedback,{type:"invalid",children:x.contact_phone})]})}),e.jsx(_,{md:12,children:e.jsxs(d.Group,{children:[e.jsx(d.Label,{className:"fw-bold",children:"Email"}),e.jsx(d.Control,{type:"email",value:t.contact_email,onChange:o=>p("contact_email",o.target.value),placeholder:"Email para comunicaciÃ³n"})]})}),e.jsx(_,{md:12,children:e.jsxs(d.Group,{children:[e.jsx(d.Label,{className:"fw-bold",children:"Consultas/Notas"}),e.jsx(d.Control,{as:"textarea",rows:4,value:t.queries,onChange:o=>p("queries",o.target.value),placeholder:"Consultas, notas o comentarios adicionales"})]})})]})]}),Te=()=>e.jsxs("div",{className:"step-content",children:[e.jsxs("h5",{className:"mb-4",children:[e.jsx(xe,{className:"me-2"}),"SelecciÃ³n de Servicios"]}),e.jsx(ze,{variant:"info",className:"mb-4",children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx(Xs,{className:"me-2"}),e.jsxs("div",{children:[e.jsx("strong",{children:"Selecciona los servicios que requiere este proyecto"}),e.jsx("br",{}),e.jsx("small",{children:"Puedes elegir entre servicios de Laboratorio o IngenierÃ­a"})]})]})}),e.jsxs("div",{className:"mb-4",children:[e.jsxs(N,{variant:"outline-primary",onClick:()=>y(!0),className:"w-100 py-3",size:"lg",children:[e.jsx(xe,{className:"me-2"}),t.selectedServices.length>0?`Configurar Servicios (${t.selectedServices.length} seleccionados)`:"Seleccionar Servicios del Proyecto"]}),x.services&&e.jsx(ze,{variant:"danger",className:"mt-2",children:x.services})]}),t.selectedServices.length>0&&e.jsxs(u,{className:"border-success",children:[e.jsx(u.Header,{className:"bg-success text-white",children:e.jsxs("h6",{className:"mb-0",children:[e.jsx(ue,{className:"me-2"}),"Servicios Seleccionados (",t.selectedServices.length,")"]})}),e.jsxs(u.Body,{children:[t.selectedServices.map((o,m)=>e.jsx("div",{className:"mb-3 p-3 border rounded bg-light",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-start",children:[e.jsxs("div",{children:[e.jsx("h6",{className:"mb-1",children:o.ensayo.name}),e.jsx("p",{className:"text-muted small mb-2",children:o.ensayo.description}),e.jsx("div",{className:"d-flex flex-wrap gap-1",children:o.subservices.map((E,W)=>e.jsx(P,{bg:"info",className:"me-1",children:E.codigo},W))})]}),e.jsxs("div",{className:"text-end",children:[e.jsxs("div",{className:"fw-bold text-success h5 mb-1",children:["S/ ",o.total.toFixed(2)]}),e.jsx(N,{variant:"outline-danger",size:"sm",onClick:()=>{const E=t.selectedServices.filter((W,ee)=>ee!==m);k(E)},children:e.jsx(O,{size:12})})]})]})},m)),e.jsx("div",{className:"mt-3 pt-3 border-top",children:e.jsxs(Z,{children:[e.jsxs(_,{md:6,children:[e.jsxs("div",{className:"d-flex justify-content-between mb-2",children:[e.jsx("span",{children:"Subtotal:"}),e.jsxs("strong",{children:["S/ ",t.selectedServices.reduce((o,m)=>o+m.total,0).toFixed(2)]})]}),e.jsxs("div",{className:"d-flex justify-content-between mb-2",children:[e.jsx("span",{children:"IGV (18%):"}),e.jsxs("span",{children:["S/ ",(t.selectedServices.reduce((o,m)=>o+m.total,0)*.18).toFixed(2)]})]})]}),e.jsx(_,{md:6,children:e.jsxs("div",{className:"d-flex justify-content-between fw-bold text-success h5",children:[e.jsx("span",{children:"Total:"}),e.jsxs("span",{children:["S/ ",(t.selectedServices.reduce((o,m)=>o+m.total,0)*1.18).toFixed(2)]})]})})]})})]})]})]}),Se=()=>e.jsxs("div",{className:"step-content",children:[e.jsxs("h5",{className:"mb-4",children:[e.jsx(ue,{className:"me-2"}),"Resumen del Proyecto"]}),e.jsxs(Z,{className:"g-4",children:[e.jsx(_,{md:6,children:e.jsxs(u,{children:[e.jsx(u.Header,{children:e.jsx("h6",{className:"mb-0",children:"InformaciÃ³n BÃ¡sica"})}),e.jsxs(u.Body,{children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Proyecto:"})," ",t.name]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"UbicaciÃ³n:"})," ",t.location]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Contacto:"})," ",t.contact_name]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"TelÃ©fono:"})," ",t.contact_phone]}),t.contact_email&&e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Email:"})," ",t.contact_email]})]})]})}),e.jsx(_,{md:6,children:e.jsxs(u,{children:[e.jsx(u.Header,{children:e.jsx("h6",{className:"mb-0",children:"Servicios Seleccionados"})}),e.jsx(u.Body,{children:t.selectedServices.length>0?e.jsxs("div",{children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Total de Servicios:"})," ",t.selectedServices.length]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Total de Subservicios:"})," ",t.selectedServices.reduce((o,m)=>o+m.subservices.length,0)]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Subtotal:"})," S/ ",t.selectedServices.reduce((o,m)=>o+m.total,0).toFixed(2)]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"IGV (18%):"})," S/ ",(t.selectedServices.reduce((o,m)=>o+m.total,0)*.18).toFixed(2)]}),e.jsxs("div",{className:"fw-bold text-success h5",children:[e.jsx("strong",{children:"Total:"})," S/ ",(t.selectedServices.reduce((o,m)=>o+m.total,0)*1.18).toFixed(2)]})]}):e.jsxs("div",{className:"text-muted",children:[e.jsx(O,{className:"me-1"}),"No hay servicios seleccionados"]})})]})})]}),t.queries&&e.jsxs(u,{className:"mt-4",children:[e.jsx(u.Header,{children:e.jsx("h6",{className:"mb-0",children:"Consultas/Notas"})}),e.jsx(u.Body,{children:e.jsx("p",{className:"mb-0",children:t.queries})})]})]});return e.jsxs("div",{className:"project-form-redesigned",children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[e.jsx("h6",{className:"mb-0",children:"Progreso del Formulario"}),e.jsxs("span",{className:"text-muted",children:[j," de ",g]})]}),e.jsx(_a,{now:j/g*100,variant:"primary",style:{height:"8px"}})]}),e.jsx("div",{className:"mb-4",children:e.jsx(Z,{className:"g-2",children:Array.from({length:g},(o,m)=>{const E=m+1,W=E===j,ee=E<j;return e.jsx(_,{md:3,children:e.jsxs("div",{className:`step-indicator text-center p-3 rounded ${W?"bg-primary text-white":ee?"bg-success text-white":"bg-light"}`,style:{cursor:"pointer"},onClick:()=>D(E),children:[e.jsx("div",{className:"mb-2",children:h(E)}),e.jsx("div",{className:"small fw-bold",children:q(E)})]})},E)})})}),e.jsx(u,{className:"mb-4",children:e.jsxs(u.Body,{children:[j===1&&b(),j===2&&ge(),j===3&&Te(),j===4&&Se()]})}),e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsxs(N,{variant:"outline-secondary",onClick:i,disabled:j===1,children:[e.jsx(O,{className:"me-1"}),"Anterior"]}),e.jsxs("div",{children:[j<g?e.jsxs(N,{variant:"primary",onClick:le,className:"me-2",children:["Siguiente",e.jsx(bs,{className:"ms-1"})]}):e.jsxs(N,{variant:"success",onClick:n,disabled:C,className:"me-2",children:[C?"Creando...":"Crear Proyecto",e.jsx(ue,{className:"ms-1"})]}),e.jsx(N,{variant:"outline-danger",onClick:f,children:"Cancelar"})]})]}),L&&e.jsx("div",{className:"modal-backdrop",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:1050,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsxs("div",{className:"modal-content bg-white rounded shadow-lg",style:{width:"90%",maxWidth:"1200px",maxHeight:"90vh",overflow:"auto"},children:[e.jsxs("div",{className:"modal-header p-4 border-bottom",children:[e.jsx("h5",{className:"mb-0",children:"Seleccionar Servicios del Proyecto"}),e.jsx(N,{variant:"outline-secondary",size:"sm",onClick:()=>y(!1),children:e.jsx(O,{})})]}),e.jsx("div",{className:"modal-body p-4",children:e.jsx(vs,{selectedServices:t.selectedServices,onServicesChange:k})}),e.jsx("div",{className:"modal-footer p-4 border-top",children:e.jsxs(N,{variant:"success",onClick:()=>y(!1),children:[e.jsx(ne,{className:"me-1"}),"Confirmar SelecciÃ³n"]})})]})})]})}const Ea={company_id:"",name:"",location:"",vendedor_id:"",laboratorio_id:"",requiere_laboratorio:!1,requiere_ingenieria:!1,requiere_consultoria:!1,requiere_capacitacion:!1,requiere_auditoria:!1,contact_name:"",contact_phone:"",contact_email:"",queries:"",priority:"normal",marked:!1};function ai(){var cs,ds,ms,hs;const{user:v}=Zs(),[S,C]=c.useState(!1),[f,t]=c.useState(null),[z,j]=c.useState(null),[D,L]=c.useState(null),[y,x]=c.useState(null),[se,I]=c.useState(!1),[U,B]=c.useState(!1),[T,Q]=c.useState(!1),[J,$]=c.useState(!1),[r,g]=c.useState(null),[p,k]=c.useState("info"),[R,ae]=c.useState([]),[H,ie]=c.useState(null),[le,i]=c.useState(!1),[n,h]=c.useState({}),[q,b]=c.useState(!1),[ge,Te]=c.useState(""),[Se,o]=c.useState("success"),[m,E]=c.useState(""),[W,ee]=c.useState(""),[fs,_e]=c.useState(!1),[ys,we]=c.useState(!1),[ce,Oe]=c.useState(""),[Y,Qe]=c.useState([]),[Ns,Pe]=c.useState(!1),[ka,Fa]=c.useState(!0),[Ss,Ce]=c.useState(!1),[Le,Ie]=c.useState(1),[Je,_s]=c.useState(""),[We,ws]=c.useState(""),[Ye,Cs]=c.useState(""),[Ke,qs]=c.useState(""),[Xe,Es]=c.useState(""),[ks,Ze]=c.useState(!1),Me=ea(),es=sa(),De=new URLSearchParams(es.search).get("view"),re=(cs=es.state)==null?void 0:cs.selectedClient,$e=aa(),{data:w,isLoading:ss,refetch:Fs}=Ne(["projects",Le,Je,We,Ye,Ke,Xe],()=>ga({page:Le,limit:20,search:Je,status:We,company_id:Ye,project_type:Ke,priority:Xe}),{keepPreviousData:!0,refetchOnWindowFocus:!1,refetchOnMount:!1,staleTime:3e4,cacheTime:3e5,retry:2,retryDelay:1e3}),{data:M,isLoading:za}=Ne("users",()=>ya(),{keepPreviousData:!0,refetchOnWindowFocus:!1,staleTime:3e5,cacheTime:6e5}),{data:K,isLoading:qe}=Ne(["projectStats"],ja,{refetchOnWindowFocus:!1,refetchOnMount:!1,staleTime:6e4,cacheTime:3e5,retry:1,onSuccess:s=>{console.log("ðŸ“Š Frontend - EstadÃ­sticas recibidas:",s),console.log("ðŸ“Š Frontend - alta_prioridad:",s==null?void 0:s.alta_prioridad)}});c.useEffect(()=>{if(De&&(w!=null&&w.data)){const s=w.data.find(a=>a.id==De);s&&(ls(s),Me("/proyectos",{replace:!0}))}},[De,w==null?void 0:w.data]),c.useEffect(()=>{(async()=>{if(r!=null&&r.id)try{const a=await Ve(r.id);ae(a)}catch(a){console.error("Error al cargar adjuntos:",a)}})()},[r==null?void 0:r.id,T]),c.useEffect(()=>{const s=a=>{a.target.closest(".position-relative")||(_e(!1),we(!1))};return document.addEventListener("mousedown",s),()=>{document.removeEventListener("mousedown",s)}},[]);const je=s=>{$e.invalidateQueries("projects"),$e.invalidateQueries("projectStats"),C(!1),t(null),j(null)},A=(s,a="success")=>{Te(s),o(a),b(!0),setTimeout(()=>{b(!1)},5e3)},As=s=>{console.log("ðŸ” handleSearch - BÃºsqueda:",s),_s(s),Ie(1),Ze(!0),setTimeout(()=>Ze(!1),1e3)},zs=s=>{console.log("ðŸ” handleFilter - Filtros:",s),ws(s.status||""),Cs(s.company_id||""),qs(s.project_type||""),Es(s.priority||""),Ie(1)},Ts=s=>{const a=s.target.files[0];a&&ie(a)},Ps=async()=>{if(!H||!(r!=null&&r.id)){A("âŒ Por favor selecciona un archivo","danger");return}i(!0);try{const s=new FormData;s.append("file",H),s.append("description",`Archivo subido: ${H.name}`),await ba(r.id,s);const a=await Ve(r.id);ae(a),ie(null),i(!1),A("âœ… Archivo subido correctamente","success")}catch(s){console.error("Error al subir archivo:",s),i(!1),A("âŒ Error al subir archivo","danger")}},as=async s=>{try{await va(s),A("âœ… Archivo descargado correctamente","success")}catch(a){console.error("Error al descargar archivo:",a),A("âŒ Error al descargar archivo","danger")}},Ls=async s=>{L(s)},Is=async()=>{try{await fa(D);const s=await Ve(r.id);ae(s),A("âœ… Archivo eliminado correctamente","success"),L(null)}catch(s){console.error("Error al eliminar archivo:",s),A("âŒ Error al eliminar archivo","danger"),L(null)}},Ms=s=>{h({...n,vendedor_id:s.id}),E(`${s.name} ${s.apellido}`),_e(!1),s.id&&r&&is(s.id,"vendedor",r)},Ds=s=>{h({...n,laboratorio_id:s.id}),ee(`${s.name} ${s.apellido}`),we(!1),s.id&&r&&is(s.id,"laboratorio",r)},is=async(s,a,l)=>{try{const X="http://localhost:4000/api".replace(/\/api$/,""),de=localStorage.getItem("token"),te=new Date,oe=te.toLocaleString("es-PE",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}),V=a==="vendedor"?"vendedor comercial responsable":"usuario de laboratorio responsable",G={user_id:s,type:"project_assignment",title:`ðŸŽ¯ Proyecto Asignado - ${l.name}`,message:`Se te ha asignado el proyecto "${l.name}" como ${V}.

ðŸ“… Fecha y hora: ${oe}
ðŸ¢ Empresa: ${l.company_name||"No especificada"}
ðŸ“ UbicaciÃ³n: ${l.location||"No especificada"}
ðŸ“ž Contacto: ${l.contact_name||"No especificado"}`,project_id:l.id,priority:"high",metadata:{assignment_date:te.toISOString(),role:a,project_name:l.name,company_name:l.company_name}};console.log("ðŸ“¤ Enviando notificaciÃ³n:",G);const me=await fetch(`${X}/api/notifications`,{method:"POST",headers:{Authorization:`Bearer ${de}`,"Content-Type":"application/json"},body:JSON.stringify(G)});if(me.ok){const Ue=await me.json();console.log("âœ… NotificaciÃ³n enviada exitosamente:",Ue),A(`âœ… NotificaciÃ³n enviada al ${V} - ${oe}`,"success")}else{const Ue=await me.text();console.warn("âš ï¸ No se pudo enviar la notificaciÃ³n:",me.status,Ue),A(`âš ï¸ Error enviando notificaciÃ³n al ${V}`,"warning")}}catch(F){console.error("âŒ Error enviando notificaciÃ³n:",F),A(`âŒ Error enviando notificaciÃ³n al ${a==="vendedor"?"vendedor comercial":"usuario de laboratorio"}`,"danger")}},rs=()=>M!=null&&M.data?M.data.filter(s=>{var a;return s.role==="vendedor_comercial"&&(m===""||`${s.name} ${s.apellido}`.toLowerCase().includes(m.toLowerCase())||((a=s.email)==null?void 0:a.toLowerCase().includes(m.toLowerCase())))}):[],ts=()=>M!=null&&M.data?M.data.filter(s=>{var a;return s.role==="usuario_laboratorio"&&(W===""||`${s.name} ${s.apellido}`.toLowerCase().includes(W.toLowerCase())||((a=s.email)==null?void 0:a.toLowerCase().includes(W.toLowerCase())))}):[],$s=[{title:"Por Estado",options:[{label:"Pendientes",filter:{status:"pendiente"}},{label:"Activos",filter:{status:"activo"}},{label:"Completados",filter:{status:"completado"}},{label:"Cancelados",filter:{status:"cancelado"}}]},{title:"Por Prioridad",options:[{label:"ðŸ”´ Urgente",filter:{priority:"urgent"}},{label:"ðŸŸ  Alta",filter:{priority:"high"}},{label:"ðŸ”µ Activo",filter:{priority:"active"}},{label:"ðŸŸ¢ Normal",filter:{priority:"normal"}},{label:"ðŸ”µ Baja",filter:{priority:"low"}}]},{title:"Por Tipo de Proyecto",options:[{label:"AnÃ¡lisis de Suelos",filter:{project_type:"AnÃ¡lisis de Suelos"}},{label:"Estudio GeotÃ©cnico",filter:{project_type:"Estudio GeotÃ©cnico"}},{label:"EvaluaciÃ³n Ambiental",filter:{project_type:"EvaluaciÃ³n Ambiental"}},{label:"Control de Calidad",filter:{project_type:"Control de Calidad"}},{label:"AnÃ¡lisis de Agua",filter:{project_type:"AnÃ¡lisis de Agua"}},{label:"Estudio de Impacto",filter:{project_type:"Estudio de Impacto"}},{label:"AnÃ¡lisis QuÃ­mico",filter:{project_type:"AnÃ¡lisis QuÃ­mico"}},{label:"Pruebas de Laboratorio",filter:{project_type:"Pruebas de Laboratorio"}},{label:"InspecciÃ³n TÃ©cnica",filter:{project_type:"InspecciÃ³n TÃ©cnica"}},{label:"CertificaciÃ³n de Materiales",filter:{project_type:"CertificaciÃ³n de Materiales"}}]}],Be=he(da,{onSuccess:()=>je(),onError:s=>console.error("Error creating project:",s)}),Ee=he(({id:s,data:a})=>ma(s,a),{onSuccess:s=>{console.log("âœ… updateMutation - Success:",s),g(s);const a={...s,queries_history:(()=>{try{if(s.queries_history&&Array.isArray(s.queries_history))return s.queries_history;if(s.queries_history&&typeof s.queries_history=="string"){const l=JSON.parse(s.queries_history);return Array.isArray(l)?l:[]}return[]}catch(l){return console.warn("âŒ Error procesando queries_history en updateMutation:",l),[]}})()};h(a),A("âœ… Proyecto actualizado exitosamente!","success"),$e.invalidateQueries(["projects"])},onError:s=>{console.error("âŒ updateMutation - Error:",s),A("âŒ Error al actualizar proyecto","danger")}}),os=he(ha,{onSuccess:()=>je(),onError:s=>console.error("Error deleting project:",s)});he(({id:s,...a})=>ua(s,a),{onSuccess:s=>{g(s);const a={...s,queries_history:(()=>{try{if(s.queries_history&&Array.isArray(s.queries_history))return s.queries_history;if(s.queries_history&&typeof s.queries_history=="string"){const l=JSON.parse(s.queries_history);return Array.isArray(l)?l:[]}return[]}catch(l){return console.warn("âŒ Error procesando queries_history en updateStatusMutation:",l),[]}})()};h(a),je()},onError:s=>console.error("Error updating project status:",s)}),he(({id:s,...a})=>xa(s,a),{onSuccess:s=>{g(s);const a={...s,queries_history:(()=>{try{if(s.queries_history&&Array.isArray(s.queries_history))return s.queries_history;if(s.queries_history&&typeof s.queries_history=="string"){const l=JSON.parse(s.queries_history);return Array.isArray(l)?l:[]}return[]}catch(l){return console.warn("âŒ Error procesando queries_history en updateQueriesMutation:",l),[]}})()};h(a),je()},onError:s=>console.error("Error updating project queries:",s)}),he(({id:s,...a})=>pa(s,a),{onSuccess:s=>{g(s);const a={...s,queries_history:(()=>{try{if(s.queries_history&&Array.isArray(s.queries_history))return s.queries_history;if(s.queries_history&&typeof s.queries_history=="string"){const l=JSON.parse(s.queries_history);return Array.isArray(l)?l:[]}return[]}catch(l){return console.warn("âŒ Error procesando queries_history en updateMarkMutation:",l),[]}})()};h(a),je()},onError:s=>console.error("Error updating project mark:",s)});const Bs=s=>{t(s),C(!0)},ns=s=>{j(s)},Us=async()=>{try{await os.mutateAsync(z.id),j(null)}catch(s){console.error("Error eliminando proyecto:",s),j(null)}},Rs=async()=>{try{console.log("Marcar/desmarcar proyecto:",y),A(`Proyecto ${y.marked?"desmarcado":"marcado"}: ${y.name}`,"success"),x(null)}catch(s){console.error("Error al marcar proyecto:",s),A("Error al marcar proyecto","danger"),x(null)}},Vs=s=>{g(s),$(!0)},ls=s=>{console.log("ðŸ” handleViewProject - Project recibido:",s),console.log("ðŸ” handleViewProject - Project.id:",s==null?void 0:s.id),console.log("ðŸ” handleViewProject - Type of project.id:",typeof(s==null?void 0:s.id)),console.log("ðŸ” handleViewProject - Project.queries:",s==null?void 0:s.queries),console.log("ðŸ” handleViewProject - Project.queries_history:",s==null?void 0:s.queries_history),g(s);const a={...s,requiere_laboratorio:s.requiere_laboratorio||!1,requiere_ingenieria:s.requiere_ingenieria||!1,requiere_consultoria:s.requiere_consultoria||!1,requiere_capacitacion:s.requiere_capacitacion||!1,requiere_auditoria:s.requiere_auditoria||!1,marked:s.marked||!1,priority:s.priority||"normal",queries:s.queries||"",contact_name:s.contact_name||"",contact_phone:s.contact_phone||"",contact_email:s.contact_email||"",category_id:s.category_id||"",subcategory_id:s.subcategory_id||"",category_name:s.category_name||"",subcategory_name:s.subcategory_name||"",vendedor_id:s.vendedor_id||"",laboratorio_id:s.laboratorio_id||"",queries_history:(()=>{try{if(console.log("ðŸ” Parseando queries_history - project.queries_history:",s.queries_history),console.log("ðŸ” Parseando queries_history - project.queries:",s.queries),s.queries_history&&Array.isArray(s.queries_history))return console.log("âœ… Usando project.queries_history como array:",s.queries_history),s.queries_history;if(s.queries&&typeof s.queries=="string")try{const l=JSON.parse(s.queries);if(console.log("âœ… Parseado project.queries como JSON:",l),Array.isArray(l))return l}catch{if(console.log("âš ï¸ project.queries no es JSON vÃ¡lido, tratando como texto plano"),s.queries.trim()){const F={message:s.queries.trim(),user_name:"Usuario Anterior",created_at:new Date().toISOString()};return console.log("âœ… Creado historial desde texto plano:",F),[F]}}return console.log("âš ï¸ No se encontrÃ³ queries_history vÃ¡lido, retornando array vacÃ­o"),[]}catch(l){return console.warn("âŒ Error parseando queries_history:",l),[]}})()};console.log("ðŸ” handleViewProject - editingData inicializado:",a),h(a),s.vendedor_name?E(s.vendedor_name):E(""),s.laboratorio_name?ee(s.laboratorio_name):ee(""),k("info"),Q(!0)},Hs=async s=>{f.id?await Ee.mutateAsync({id:f.id,...s}):await Be.mutateAsync(s)},Gs=s=>{const l={activo:{bg:"success",text:"Activo"},pendiente:{bg:"warning",text:"Pendiente"},completado:{bg:"primary",text:"Completado"},cancelado:{bg:"danger",text:"Cancelado"}}[s]||{bg:"secondary",text:s};return e.jsx(P,{bg:l.bg,className:"status-badge",children:l.text})},Os=[{header:"ID",accessor:"id",width:"60px"},{header:"Proyecto",accessor:"name",render:(s,a)=>e.jsxs("div",{children:[e.jsx("div",{className:"fw-medium",children:a.name}),a.location&&e.jsxs("small",{className:"text-muted",children:[e.jsx(oa,{size:12,className:"me-1"}),a.location]}),a.project_type&&e.jsx("div",{className:"mt-1",children:e.jsx(P,{bg:"outline-secondary",size:"sm",className:"px-1 py-0 small",children:a.project_type})})]})},{header:"Empresa",accessor:"company_name",render:(s,a)=>e.jsxs("div",{children:[e.jsx("div",{className:"fw-medium",children:a.company_name||"Sin empresa"}),a.contact_name&&e.jsxs("small",{className:"text-muted",children:[e.jsx(pe,{size:12,className:"me-1"}),a.contact_name]})]})},{header:"Estado",accessor:"status",width:"100px",render:s=>Gs(s||"activo")},{header:"Servicios",accessor:"services",width:"180px",className:"d-none d-lg-table-cell",render:(s,a)=>{if(a.requiere_laboratorio){const F={no_requerido:"N/A",pendiente:"Pendiente",en_proceso:"En Proceso",completado:"Completado"}[a.laboratorio_status]||"N/A";return e.jsxs("div",{className:"d-flex flex-column gap-1",children:[e.jsx(P,{bg:"info",size:"sm",className:"px-2",children:"ðŸ”¬ Laboratorio"}),e.jsx("span",{className:"small text-muted",children:F})]})}if(a.requiere_ingenieria){const F={no_requerido:"N/A",pendiente:"Pendiente",en_proceso:"En Proceso",completado:"Completado"}[a.ingenieria_status]||"N/A";return e.jsxs("div",{className:"d-flex flex-column gap-1",children:[e.jsx(P,{bg:"primary",size:"sm",className:"px-2",children:"âš™ï¸ IngenierÃ­a"}),e.jsx("span",{className:"small text-muted",children:F})]})}return a.requiere_consultoria?e.jsx(P,{bg:"success",size:"sm",className:"px-2",children:"ðŸ’¼ ConsultorÃ­a"}):e.jsx(P,{bg:"secondary",size:"sm",className:"px-1",children:"N/A"})}},{header:"Prioridad",accessor:"priority",width:"100px",render:(s,a)=>{const F=(X=>{switch(X){case"urgent":return{emoji:"ðŸ”´",text:"Urgente",color:"text-danger"};case"high":return{emoji:"ðŸŸ ",text:"Alta",color:"text-warning"};case"active":return{emoji:"ðŸ”µ",text:"Activo",color:"text-info"};case"low":return{emoji:"ðŸ”µ",text:"Baja",color:"text-primary"};case"normal":default:return{emoji:"ðŸŸ¢",text:"Normal",color:"text-success"}}})(a.priority);return e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("span",{className:"me-1",style:{fontSize:"1em"},children:F.emoji}),e.jsx("span",{className:`small ${F.color} fw-medium`,children:F.text}),(a.priority==="urgent"||a.priority==="high")&&a.requiere_laboratorio&&e.jsx(us,{className:"text-warning ms-1",size:12})]})}},{header:"Asignado a",accessor:"vendedor_name",className:"d-none d-md-table-cell",render:(s,a)=>e.jsxs("div",{children:[a.vendedor_name&&e.jsxs("div",{className:"small",children:[e.jsx(pe,{size:12,className:"me-1 text-muted"}),e.jsx("span",{children:a.vendedor_name})]}),a.laboratorio_name&&e.jsxs("div",{className:"small text-muted mt-1",children:[e.jsx(ye,{size:12,className:"me-1"}),e.jsx("span",{children:a.laboratorio_name})]}),!a.vendedor_name&&!a.laboratorio_name&&e.jsx("span",{className:"text-muted small",children:"Sin asignar"})]})},{header:"Fecha",accessor:"created_at",width:"100px",className:"d-none d-xl-table-cell",render:s=>{if(!s)return"-";const a=new Date(s);return e.jsx("div",{className:"small",children:e.jsx("div",{children:a.toLocaleDateString("es-ES")})})}}],Qs=[{name:"company_id",label:"Empresa/Cliente",type:"select",required:!0,options:((ds=w==null?void 0:w.companies)==null?void 0:ds.map(s=>({value:s.id,label:`${s.name} (${s.ruc||s.dni||"Sin RUC/DNI"})`})))||[],description:"Selecciona un cliente existente o crea uno nuevo desde el mÃ³dulo de clientes"},{name:"name",label:"Nombre del Proyecto",type:"text",required:!0,placeholder:"Ingresa el nombre del proyecto"},{name:"location",label:"UbicaciÃ³n del Proyecto",type:"text",placeholder:"Ingresa la ubicaciÃ³n del proyecto",required:!0},{name:"contact_name",label:"Persona de Contacto",type:"text",placeholder:"Nombre de la persona con quien negociar",description:"Persona responsable del proyecto en el cliente"},{name:"contact_phone",label:"TelÃ©fono de Contacto",type:"text",placeholder:"TelÃ©fono para comunicaciÃ³n directa",description:"NÃºmero para llamadas urgentes o seguimiento"},{name:"contact_email",label:"Email de Contacto",type:"email",placeholder:"Email para comunicaciÃ³n",description:"Email para envÃ­o de reportes y documentos"},{name:"requiere_laboratorio",label:"Requiere Laboratorio",type:"checkbox",description:"Marcar si el proyecto necesita servicios de laboratorio"},{name:"requiere_ingenieria",label:"Requiere IngenierÃ­a",type:"checkbox",description:"Marcar si el proyecto necesita servicios de ingenierÃ­a"},{name:"requiere_consultoria",label:"Requiere ConsultorÃ­a",type:"checkbox",description:"Marcar si el proyecto necesita servicios de consultorÃ­a"},{name:"requiere_capacitacion",label:"Requiere CapacitaciÃ³n",type:"checkbox",description:"Marcar si el proyecto necesita servicios de capacitaciÃ³n"},{name:"requiere_auditoria",label:"Requiere AuditorÃ­a",type:"checkbox",description:"Marcar si el proyecto necesita servicios de auditorÃ­a"},{name:"queries",label:"Consultas del Cliente",type:"textarea",placeholder:"Ingresa las consultas o dudas del cliente...",description:"Preguntas o dudas especÃ­ficas del cliente sobre el proyecto"},{name:"services",label:"Servicios del Proyecto",type:"custom",component:e.jsxs("div",{children:[e.jsx("div",{className:"mb-3",children:e.jsxs(N,{variant:"outline-primary",onClick:()=>Pe(!0),className:"w-100",children:[e.jsx(xe,{className:"me-2"}),Y.length>0?`Configurar Servicios (${Y.length} seleccionados)`:"Seleccionar Servicios"]})}),Y.length>0&&e.jsxs("div",{className:"border rounded p-3 bg-light",children:[e.jsx("h6",{className:"mb-2",children:"Servicios Seleccionados:"}),Y.map((s,a)=>e.jsx("div",{className:"mb-2 p-2 border rounded bg-white",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-start",children:[e.jsxs("div",{children:[e.jsx("strong",{children:s.ensayo.name}),e.jsx("div",{className:"small text-muted",children:s.subservices.map(l=>l.codigo).join(", ")})]}),e.jsxs("div",{className:"text-end",children:[e.jsxs("div",{className:"fw-bold text-success",children:["S/ ",s.total.toFixed(2)]}),e.jsx(N,{variant:"outline-danger",size:"sm",onClick:()=>{const l=Y.filter((F,X)=>X!==a);Qe(l)},children:e.jsx(O,{size:12})})]})]})},a)),e.jsxs("div",{className:"mt-2 pt-2 border-top",children:[e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsx("strong",{children:"Subtotal:"}),e.jsxs("strong",{children:["S/ ",Y.reduce((s,a)=>s+a.total,0).toFixed(2)]})]}),e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsx("span",{children:"IGV (18%):"}),e.jsxs("span",{children:["S/ ",(Y.reduce((s,a)=>s+a.total,0)*.18).toFixed(2)]})]}),e.jsxs("div",{className:"d-flex justify-content-between fw-bold text-success",children:[e.jsx("span",{children:"Total:"}),e.jsxs("span",{children:["S/ ",(Y.reduce((s,a)=>s+a.total,0)*1.18).toFixed(2)]})]})]})]})]})},{name:"priority",label:"Prioridad del Proyecto",type:"select",options:[{value:"low",label:"Baja"},{value:"normal",label:"Normal"},{value:"high",label:"Alta"},{value:"urgent",label:"Urgente"}],description:"Nivel de prioridad para la ejecuciÃ³n del proyecto"},{name:"vendedor_id",label:"Vendedor Asignado",type:"select",options:((ms=M==null?void 0:M.data)==null?void 0:ms.filter(s=>s.role==="vendedor_comercial").map(s=>({value:s.id,label:`${s.name} ${s.apellido}`})))||[]},{name:"laboratorio_id",label:"Responsable de Laboratorio",type:"select",options:((hs=M==null?void 0:M.data)==null?void 0:hs.filter(s=>s.role==="usuario_laboratorio").map(s=>({value:s.id,label:`${s.name} ${s.apellido}`})))||[]}],be=c.useMemo(()=>{if(K)return console.log("ðŸ“Š Stats - Usando estadÃ­sticas reales del backend:",K),{total:K.total||0,activos:K.activos||0,completados:K.completados||0,pendientes:K.pendientes||0,cancelados:K.cancelados||0,alta_prioridad:K.alta_prioridad||0};const s=(w==null?void 0:w.data)||[];return console.log("ðŸ“Š Stats - Fallback: calculando desde pÃ¡gina actual:",s),{total:s.length,activos:s.filter(a=>a.status==="activo").length,completados:s.filter(a=>a.status==="completado").length,pendientes:s.filter(a=>a.status==="pendiente").length,cancelados:s.filter(a=>a.status==="cancelado").length,alta_prioridad:s.filter(a=>a.priority==="urgent"||a.priority==="high").length}},[K,w]);return e.jsxs(e.Fragment,{children:[e.jsx(ca,{fluid:!0,className:"py-4",children:e.jsxs("div",{className:"fade-in",children:[e.jsx(na,{title:"GestiÃ³n de Proyectos",subtitle:re?`Crear proyecto para: ${re.name}`:"Crear, editar y gestionar proyectos del sistema",icon:ye,actions:e.jsxs("div",{className:"d-flex gap-2",children:[re&&e.jsxs(P,{bg:"info",className:"px-3 py-2 d-flex align-items-center",children:[e.jsx(pe,{className:"me-1"}),"Cliente: ",re.name]}),e.jsxs(N,{variant:"primary",onClick:()=>Ce(!0),children:[e.jsx(bs,{className:"me-2"}),re?"Crear Proyecto":"Nuevo Proyecto"]})]})}),e.jsxs(Z,{className:"g-2 mb-4",children:[e.jsx(_,{md:6,lg:3,children:e.jsx(ke,{title:"Total Proyectos",value:be.total,icon:ye,color:"primary",subtitle:"Proyectos registrados",loading:qe,size:"compact"})}),e.jsx(_,{md:6,lg:3,children:e.jsx(ke,{title:"Proyectos Activos",value:be.activos,icon:ue,color:"success",subtitle:"En desarrollo",loading:qe,size:"compact"})}),e.jsx(_,{md:6,lg:3,children:e.jsx(ke,{title:"Alta Prioridad",value:be.alta_prioridad||0,icon:us,color:"danger",subtitle:"ðŸ”´ Urgente + ðŸŸ  Alta",loading:qe,size:"compact"})}),e.jsx(_,{md:6,lg:3,children:e.jsx(ke,{title:"Pendientes",value:be.pendientes,icon:He,color:"warning",subtitle:"Por iniciar",loading:qe,size:"compact"})})]}),e.jsxs(u,{className:"shadow-sm border-0",children:[e.jsx(u.Header,{className:"bg-white border-bottom",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("h5",{className:"mb-0",children:[e.jsx(ye,{className:"me-2 text-primary"}),"Lista de Proyectos"]}),e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx(N,{variant:"outline-secondary",size:"sm",onClick:()=>Fs(),className:"d-flex align-items-center",title:"Actualizar datos",children:e.jsx(ia,{className:`${ss?"spinning":""}`})}),e.jsxs(P,{bg:"light",text:"dark",className:"px-3 py-2",children:[be.total," proyectos"]})]})]})}),e.jsx(u.Body,{className:"p-0",children:e.jsx(la,{data:(w==null?void 0:w.data)||[],columns:Os,loading:ss||ks,onEdit:Bs,onDelete:ns,actions:[{label:"Ver",icon:ra,onClick:Vs,variant:"primary",style:{backgroundColor:"#f84616",borderColor:"#f84616"}},{label:"Eliminar",icon:xs,onClick:ns,variant:"outline-danger"}],emptyMessage:"No hay proyectos registrados",totalItems:(w==null?void 0:w.total)||0,itemsPerPage:20,currentPage:Le,onPageChange:Ie,onSearch:As,onFilter:zs,filterOptions:$s,getRowClassName:s=>s.status==="cancelado"?"table-secondary opacity-50 text-muted":""})})]}),e.jsx(Fe,{show:S,onHide:()=>C(!1),title:f!=null&&f.id?"Editar Proyecto":"Nuevo Proyecto",data:f||Ea,fields:Qs,onSubmit:Hs,loading:Be.isLoading||Ee.isLoading,submitText:f!=null&&f.id?"Actualizar":"Crear"}),e.jsx(Fe,{show:T,onHide:()=>Q(!1),title:`ðŸ“‹ Gestionar Proyecto - ${(r==null?void 0:r.name)||""}`,data:{...n,queries_history:Array.isArray(n==null?void 0:n.queries_history)?n.queries_history:[]},size:"xl",fields:[{name:"project_management",label:"GestiÃ³n del Proyecto",type:"custom",render:s=>e.jsxs("div",{className:"project-management-modal",children:[e.jsx("style",{children:`
                  .project-management-modal {
                    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
                  }
                  .project-header {
                    background: #f84616;
                    color: white;
                    padding: 1.5rem;
                    border-radius: 12px;
                    margin-bottom: 2rem;
                    box-shadow: 0 8px 25px rgba(248, 70, 22, 0.3);
                  }
                  .project-header h4 {
                    margin: 0;
                    font-weight: 600;
                    font-size: 1.5rem;
                  }
                  .project-header .project-id {
                    background: rgba(255, 255, 255, 0.2);
                    padding: 0.5rem 1rem;
                    border-radius: 20px;
                    font-size: 0.9rem;
                    margin-top: 0.5rem;
                    display: inline-block;
                  }
                  .info-card {
                    background: white;
                    border-radius: 12px;
                    padding: 1.5rem;
                    margin-bottom: 1.5rem;
                    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
                    border: 1px solid #e9ecef;
                  }
                  .info-card h6 {
                    color: #495057;
                    font-weight: 600;
                      margin-bottom: 1rem;
                    padding-bottom: 0.5rem;
                    border-bottom: 2px solid #f8f9fa;
                  }
                  .info-grid {
                    display: grid;
                    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                    gap: 1rem;
                  }
                  .info-item {
                    display: flex;
                    flex-direction: column;
                    gap: 0.25rem;
                    }
                    .info-item label {
                      font-size: 0.75rem;
                      font-weight: 600;
                    color: #6c757d;
                      text-transform: uppercase;
                      letter-spacing: 0.5px;
                  }
                  .info-item .value {
                    font-weight: 500;
                    color: #212529;
                    font-size: 0.95rem;
                  }
                  .priority-badge {
                    display: inline-flex;
                    align-items: center;
                    gap: 0.5rem;
                    padding: 0.5rem 1rem;
                    border-radius: 20px;
                    font-weight: 600;
                    font-size: 0.85rem;
                  }
                  .priority-urgent { background: #fee2e2; color: #dc2626; }
                  .priority-high { background: #fef3c7; color: #d97706; }
                  .priority-normal { background: #d1fae5; color: #059669; }
                  .priority-low { background: #e0e7ff; color: #3730a3; }
                  .status-badge {
                    padding: 0.5rem 1rem;
                    border-radius: 20px;
                    font-weight: 600;
                    font-size: 0.85rem;
                  }
                  .status-pendiente { background: #fef3c7; color: #d97706; }
                  .status-activo { background: #d1fae5; color: #059669; }
                  .status-completado { background: #dbeafe; color: #2563eb; }
                  .status-cancelado { background: #fee2e2; color: #dc2626; }
                  .form-control, .form-select {
                    border-radius: 8px;
                    border: 1px solid #d1d5db;
                    padding: 0.75rem;
                    font-size: 0.9rem;
                    transition: all 0.2s ease;
                  }
                  .form-control:focus, .form-select:focus {
                    border-color: #f84616;
                    box-shadow: 0 0 0 3px rgba(248, 70, 22, 0.1);
                  }
                  .btn-primary {
                    background: #f84616;
                    border: none;
                    border-radius: 8px;
                    padding: 0.75rem 2rem;
                    font-weight: 600;
                    transition: all 0.2s ease;
                  }
                  .btn-primary:hover {
                    background: #e03d14;
                    transform: translateY(-2px);
                    box-shadow: 0 8px 25px rgba(248, 70, 22, 0.3);
                  }
                  .btn-secondary {
                    border-radius: 8px;
                    padding: 0.75rem 2rem;
                    font-weight: 600;
                  }
                  .file-upload-area {
                    border: 2px dashed #d1d5db;
                    border-radius: 12px;
                    padding: 2rem;
                    text-align: center;
                    background: #f9fafb;
                    transition: all 0.2s ease;
                    cursor: pointer;
                  }
                  .file-upload-area:hover {
                    border-color: #f84616;
                    background: #fff5f2;
                  }
                  .file-item {
                    background: white;
                    border: 1px solid #e5e7eb;
                    border-radius: 8px;
                    padding: 1rem;
                    margin-bottom: 0.5rem;
                    display: flex;
                    align-items: center;
                    justify-content: space-between;
                  }
                  .file-item:hover {
                    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
                    }
                  `}),e.jsxs("div",{className:"project-header",children:[e.jsxs("h4",{children:["ðŸ“‹ ",s.name]}),e.jsxs("div",{className:"project-id",children:["ID: #",s.id]})]}),e.jsxs("div",{className:"row g-4",children:[e.jsxs("div",{className:"col-lg-8",children:[e.jsxs("div",{className:"info-card",children:[e.jsx("h6",{children:"ðŸ“Š InformaciÃ³n del Proyecto"}),e.jsxs("div",{className:"info-grid",children:[e.jsxs("div",{className:"info-item",children:[e.jsx("label",{children:"UbicaciÃ³n"}),e.jsx("div",{className:"value",children:s.location||"No especificada"})]}),e.jsxs("div",{className:"info-item",children:[e.jsx("label",{children:"Estado Actual"}),e.jsx("div",{children:e.jsx("span",{className:`status-badge status-${s.status||"pendiente"}`,children:s.status==="pendiente"?"Pendiente":s.status==="activo"?"Activo":s.status==="completado"?"Completado":s.status==="cancelado"?"Cancelado":s.status})})]}),e.jsxs("div",{className:"info-item",children:[e.jsx("label",{children:"Prioridad"}),e.jsx("div",{children:e.jsx("span",{className:`priority-badge priority-${s.priority||"normal"}`,children:s.priority==="urgent"?"ðŸ”´ Urgente":s.priority==="high"?"ðŸŸ  Alta":s.priority==="normal"?"ðŸŸ¢ Normal":s.priority==="low"?"ðŸ”µ Baja":"ðŸŸ¢ Normal"})})]})]})]}),e.jsxs("div",{className:"info-card",children:[e.jsx("h6",{children:"ðŸ¢ InformaciÃ³n de la Empresa"}),e.jsxs("div",{className:"info-grid",children:[e.jsxs("div",{className:"info-item",children:[e.jsx("label",{children:"Empresa"}),e.jsx("div",{className:"value fw-bold",children:s.company_name||"Sin empresa"})]}),e.jsxs("div",{className:"info-item",children:[e.jsx("label",{children:"RUC"}),e.jsx("div",{className:"value",children:s.company_ruc||"Sin RUC"})]}),e.jsxs("div",{className:"info-item",children:[e.jsx("label",{children:"Contacto"}),e.jsx("div",{className:"value fw-bold",children:s.contact_name||"Sin contacto"})]}),e.jsxs("div",{className:"info-item",children:[e.jsx("label",{children:"TelÃ©fono"}),e.jsx("div",{className:"value",children:s.contact_phone||"Sin telÃ©fono"})]}),e.jsxs("div",{className:"info-item",children:[e.jsx("label",{children:"Email"}),e.jsx("div",{className:"value",children:s.contact_email||"Sin email"})]}),e.jsxs("div",{className:"info-item",children:[e.jsx("label",{children:"Vendedor Asignado"}),e.jsxs("div",{className:"position-relative",children:[e.jsx("input",{type:"text",className:"form-control form-control-sm",placeholder:"Buscar vendedor...",value:m,onChange:a=>{E(a.target.value),_e(!0)},onFocus:()=>_e(!0)}),fs&&e.jsx("div",{className:"position-absolute w-100 bg-white border rounded shadow-lg",style:{zIndex:1e3,maxHeight:"200px",overflowY:"auto"},children:rs().length>0?rs().map(a=>e.jsxs("div",{className:"p-2 border-bottom cursor-pointer hover-bg-light",onClick:()=>Ms(a),style:{cursor:"pointer"},children:[e.jsxs("div",{className:"fw-bold",children:[a.name," ",a.apellido]}),e.jsxs("div",{className:"small text-muted",children:["ðŸ“§ ",a.email,a.phone&&e.jsxs("span",{children:[" â€¢ ðŸ“ž ",a.phone]})]}),e.jsx("div",{className:"small",children:e.jsx("span",{className:"badge bg-primary",children:"Vendedor Comercial"})})]},a.id)):e.jsx("div",{className:"p-2 text-muted",children:"No se encontraron vendedores"})})]})]}),e.jsxs("div",{className:"info-item",children:[e.jsx("label",{children:"Responsable Laboratorio"}),e.jsxs("div",{className:"position-relative",children:[e.jsx("input",{type:"text",className:"form-control form-control-sm",placeholder:"Buscar responsable de laboratorio...",value:W,onChange:a=>{ee(a.target.value),we(!0)},onFocus:()=>we(!0)}),ys&&e.jsx("div",{className:"position-absolute w-100 bg-white border rounded shadow-lg",style:{zIndex:1e3,maxHeight:"200px",overflowY:"auto"},children:ts().length>0?ts().map(a=>e.jsxs("div",{className:"p-2 border-bottom cursor-pointer hover-bg-light",onClick:()=>Ds(a),style:{cursor:"pointer"},children:[e.jsxs("div",{className:"fw-bold",children:[a.name," ",a.apellido]}),e.jsxs("div",{className:"small text-muted",children:["ðŸ“§ ",a.email,a.phone&&e.jsxs("span",{children:[" â€¢ ðŸ“ž ",a.phone]})]}),e.jsx("div",{className:"small",children:e.jsx("span",{className:"badge bg-info",children:"Usuario Laboratorio"})})]},a.id)):e.jsx("div",{className:"p-2 text-muted",children:"No se encontraron responsables de laboratorio"})})]})]})]})]})]}),e.jsxs("div",{className:"col-lg-4",children:[e.jsxs("div",{className:"info-card",children:[e.jsx("h6",{children:"âš™ï¸ ConfiguraciÃ³n RÃ¡pida"}),e.jsxs("div",{className:"d-grid gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"form-label small fw-bold",children:"Estado del Proyecto"}),e.jsxs("select",{className:"form-select",value:n.status||"pendiente",onChange:a=>h({...n,status:a.target.value}),children:[e.jsx("option",{value:"pendiente",children:"ðŸŸ¡ Pendiente"}),e.jsx("option",{value:"activo",children:"ðŸŸ¢ Activo"}),e.jsx("option",{value:"en_proceso",children:"ðŸ”µ En Proceso"}),e.jsx("option",{value:"completado",children:"âœ… Completado"}),e.jsx("option",{value:"pausado",children:"â¸ï¸ Pausado"}),e.jsx("option",{value:"cancelado",children:"âŒ Cancelado"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label small fw-bold",children:"Prioridad"}),e.jsxs("select",{className:"form-select",value:n.priority||"normal",onChange:a=>h({...n,priority:a.target.value}),children:[e.jsx("option",{value:"low",children:"ðŸ”µ Baja"}),e.jsx("option",{value:"normal",children:"ðŸŸ¢ Normal"}),e.jsx("option",{value:"high",children:"ðŸŸ  Alta"}),e.jsx("option",{value:"urgent",children:"ðŸ”´ Urgente"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"form-label small fw-bold",children:["Estado Laboratorio",n.ingenieria_status&&n.ingenieria_status!=="no_requerido"&&e.jsx("span",{className:"text-muted small ms-2",children:"(Bloqueado - IngenierÃ­a activa)"})]}),e.jsxs("select",{className:"form-select",disabled:n.ingenieria_status&&n.ingenieria_status!=="no_requerido",value:n.laboratorio_status||"no_requerido",onChange:a=>{const l=a.target.value;h(l!=="no_requerido"?{...n,laboratorio_status:l,ingenieria_status:"no_requerido",requiere_laboratorio:!0,requiere_ingenieria:!1}:{...n,laboratorio_status:l,requiere_laboratorio:!1})},children:[e.jsx("option",{value:"no_requerido",children:"No Requerido"}),e.jsx("option",{value:"pendiente",children:"Pendiente"}),e.jsx("option",{value:"en_proceso",children:"En Proceso"}),e.jsx("option",{value:"completado",children:"Completado"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"form-label small fw-bold",children:["Estado IngenierÃ­a",n.laboratorio_status&&n.laboratorio_status!=="no_requerido"&&e.jsx("span",{className:"text-muted small ms-2",children:"(Bloqueado - Laboratorio activo)"})]}),e.jsxs("select",{className:"form-select",disabled:n.laboratorio_status&&n.laboratorio_status!=="no_requerido",value:n.ingenieria_status||"no_requerido",onChange:a=>{const l=a.target.value;h(l!=="no_requerido"?{...n,ingenieria_status:l,laboratorio_status:"no_requerido",requiere_ingenieria:!0,requiere_laboratorio:!1}:{...n,ingenieria_status:l,requiere_ingenieria:!1})},children:[e.jsx("option",{value:"no_requerido",children:"No Requerido"}),e.jsx("option",{value:"pendiente",children:"Pendiente"}),e.jsx("option",{value:"en_proceso",children:"En Proceso"}),e.jsx("option",{value:"completado",children:"Completado"})]})]})]})]}),e.jsxs("div",{className:"info-card",children:[e.jsx("h6",{children:"ðŸ“… Fechas"}),e.jsxs("div",{className:"d-grid gap-2",children:[e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx(ta,{className:"text-muted",size:16}),e.jsxs("div",{children:[e.jsx("div",{className:"small text-muted",children:"Creado"}),e.jsx("div",{className:"fw-bold",children:new Date(s.created_at).toLocaleDateString()})]})]}),e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx(He,{className:"text-muted",size:16}),e.jsxs("div",{children:[e.jsx("div",{className:"small text-muted",children:"Actualizado"}),e.jsx("div",{className:"fw-bold",children:new Date(s.updated_at).toLocaleDateString()})]})]})]})]})]})]}),e.jsxs("div",{className:"row g-4 mt-2",children:[e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"info-card",children:[e.jsx("h6",{children:"ðŸ“ Notas del Estado"}),e.jsx("textarea",{className:"form-control",rows:"4",value:n.status_notes||"",onChange:a=>h({...n,status_notes:a.target.value}),placeholder:"Agrega comentarios sobre el estado del proyecto..."})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"info-card",children:[e.jsx("h6",{children:"â“ Consultas del Cliente"}),e.jsx("div",{className:"mb-3",style:{maxHeight:"200px",overflowY:"auto"},children:n.queries_history&&Array.isArray(n.queries_history)&&n.queries_history.length>0?n.queries_history.map((a,l)=>{const X=(de=>{const te=["#3b82f6","#ef4444"],oe=de.split("").reduce((V,G)=>(V=(V<<5)-V+G.charCodeAt(0),V&V),0);return te[Math.abs(oe)%te.length]})(a.user_name||"Usuario");return e.jsxs("div",{className:"mb-2 p-2 bg-light rounded border-start border-3",style:{borderLeftColor:X},children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-start mb-1",children:[e.jsxs("small",{className:"fw-bold",style:{color:X},children:["ðŸ‘¤ ",a.user_name||"Usuario"]}),e.jsx("small",{className:"text-muted",children:new Date(a.created_at).toLocaleString("es-ES",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"})})]}),e.jsx("div",{className:"small",children:a.message})]},l)}):e.jsx("div",{className:"text-center text-muted py-3",children:e.jsx("small",{children:"No hay consultas registradas"})})}),e.jsxs("div",{className:"border-top pt-3",children:[e.jsx("label",{className:"form-label small fw-bold",children:"Agregar consulta:"}),e.jsx("textarea",{className:"form-control",rows:"3",value:ce,onChange:a=>Oe(a.target.value),placeholder:"Escribe una nueva consulta o respuesta..."}),e.jsx("div",{className:"d-flex justify-content-end mt-2",children:e.jsxs(N,{variant:"primary",size:"sm",onClick:()=>{if(ce&&ce.trim()){const a={message:ce.trim(),user_name:(v==null?void 0:v.name)||"Usuario",created_at:new Date().toISOString()},l=[...n.queries_history||[],a];h({...n,queries_history:l,queries:JSON.stringify(l)}),Oe("")}},disabled:!ce||!ce.trim(),children:[e.jsx(Ae,{className:"me-1"}),"Agregar"]})})]})]})})]}),e.jsxs("div",{className:"info-card mt-3",children:[e.jsx("h6",{children:"ðŸ“Ž Archivos Adjuntos"}),e.jsxs("div",{className:"file-upload-area mb-3",onClick:()=>document.getElementById("fileInput").click(),children:[e.jsx(ps,{size:32,className:"text-muted mb-2"}),e.jsx("div",{className:"fw-bold text-muted",children:"Hacer clic para subir archivo"}),e.jsx("div",{className:"small text-muted",children:"PDF, Word, Excel, PowerPoint, ImÃ¡genes (mÃ¡x. 10MB)"}),e.jsx("input",{type:"file",id:"fileInput",style:{display:"none"},onChange:Ts,accept:".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.jpg,.jpeg,.png,.gif,.txt"})]}),H&&e.jsxs("div",{className:"alert alert-info d-flex align-items-center mb-3",children:[e.jsx(ve,{className:"me-2"}),e.jsxs("div",{children:[e.jsx("strong",{children:H.name}),e.jsx("br",{}),e.jsxs("small",{children:["ðŸ“ ",(H.size/1024/1024).toFixed(2)," MB"]})]}),e.jsxs(N,{variant:"primary",size:"sm",onClick:Ps,disabled:le,className:"ms-auto",children:[e.jsx(ps,{className:"me-1"}),le?"Subiendo...":"Subir"]})]}),R.length===0?e.jsxs("div",{className:"text-center py-4 text-muted",children:[e.jsx(gs,{size:48,className:"mb-2 opacity-50"}),e.jsx("div",{children:"No hay archivos adjuntos"}),e.jsx("small",{children:"Sube cotizaciones, documentos tÃ©cnicos, planos, etc."})]}):e.jsx("div",{className:"row g-2",children:R.map(a=>e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"file-item",children:[e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx(ve,{className:"text-primary me-3",size:20}),e.jsxs("div",{children:[e.jsx("div",{className:"fw-bold",children:a.original_name}),e.jsxs("div",{className:"small text-muted",children:["ðŸ“ ",a.file_size?`${(a.file_size/1024/1024).toFixed(2)} MB`:"N/A",e.jsx("span",{className:"mx-2",children:"â€¢"}),"ðŸ“… ",new Date(a.created_at).toLocaleDateString(),e.jsx("span",{className:"mx-2",children:"â€¢"}),"ðŸ‘¤ ",a.uploaded_by_name||"Usuario"]}),a.description&&e.jsx("div",{className:"small text-muted mt-1",children:a.description})]})]}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx(N,{variant:"outline-primary",size:"sm",onClick:()=>as(a),children:e.jsx(js,{size:14})}),e.jsx(N,{variant:"outline-danger",size:"sm",onClick:()=>Ls(a.id),children:e.jsx(xs,{size:14})})]})]})},a.id))})]}),e.jsx("div",{className:"d-flex justify-content-between align-items-center gap-3 mt-4 pt-3 border-top",children:e.jsx("div",{children:(r==null?void 0:r.quote_id)&&e.jsxs(N,{variant:"outline-info",onClick:()=>Me(`/cotizaciones?view=${r.quote_id}`),className:"px-3",children:[e.jsx(ve,{className:"me-2"}),"ðŸ“„ Ver CotizaciÃ³n Relacionada"]})})})]})}],onSubmit:()=>{const s=r==null?void 0:r.id;if(!s){A("âŒ Error: No se encontrÃ³ el ID del proyecto","danger");return}Ee.mutate({id:s,data:n},{onSuccess:a=>{A("âœ… Proyecto actualizado exitosamente!","success"),Q(!1)},onError:a=>{console.error("âŒ Error al actualizar:",a),A("âŒ Error al actualizar proyecto","danger")}})},submitText:Ee.isLoading?"Guardando...":"Guardar Cambios",cancelText:"Cancelar"}),e.jsx(Fe,{show:J,onHide:()=>$(!1),title:`ðŸ‘ï¸ Ver Proyecto - ${(r==null?void 0:r.name)||""}`,data:{...r,queries_history:Array.isArray(r==null?void 0:r.queries_history)?r.queries_history:[]},size:"lg",fields:[{name:"project_view",label:"InformaciÃ³n del Proyecto",type:"custom",render:s=>e.jsxs("div",{className:"project-view-modal",children:[e.jsx("style",{children:`
                  .project-view-modal {
                    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
                  }
                  .project-header {
                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                    color: white;
                    padding: 1.5rem;
                    border-radius: 12px;
                    margin-bottom: 2rem;
                    box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
                  }
                  .project-header h4 {
                    margin: 0;
                    font-weight: 600;
                    font-size: 1.5rem;
                  }
                  .project-header .project-id {
                    background: rgba(255, 255, 255, 0.2);
                    padding: 0.5rem 1rem;
                    border-radius: 20px;
                    font-size: 0.9rem;
                    margin-top: 0.5rem;
                    display: inline-block;
                  }
                  .info-card {
                    background: white;
                    border-radius: 12px;
                    padding: 1.5rem;
                    margin-bottom: 1.5rem;
                    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
                    border: 1px solid #e9ecef;
                  }
                  .info-card h6 {
                    color: #495057;
                    font-weight: 600;
                    margin-bottom: 1rem;
                    padding-bottom: 0.5rem;
                    border-bottom: 2px solid #f8f9fa;
                  }
                  .info-grid {
                    display: grid;
                    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                    gap: 1rem;
                  }
                  .info-item {
                    display: flex;
                    flex-direction: column;
                    gap: 0.25rem;
                  }
                  .info-item label {
                    font-size: 0.75rem;
                    font-weight: 600;
                    color: #6c757d;
                    text-transform: uppercase;
                    letter-spacing: 0.5px;
                  }
                  .info-item .value {
                    font-weight: 500;
                    color: #212529;
                    font-size: 0.95rem;
                  }
                  .priority-badge {
                    display: inline-flex;
                    align-items: center;
                    gap: 0.5rem;
                    padding: 0.5rem 1rem;
                    border-radius: 20px;
                    font-weight: 600;
                    font-size: 0.85rem;
                  }
                  .priority-urgent { background: #fee2e2; color: #dc2626; }
                  .priority-high { background: #fef3c7; color: #d97706; }
                  .priority-normal { background: #d1fae5; color: #059669; }
                  .priority-low { background: #e0e7ff; color: #3730a3; }
                  .status-badge {
                    padding: 0.5rem 1rem;
                    border-radius: 20px;
                    font-weight: 600;
                    font-size: 0.85rem;
                  }
                  .status-pendiente { background: #fef3c7; color: #d97706; }
                  .status-activo { background: #d1fae5; color: #059669; }
                  .status-completado { background: #dbeafe; color: #2563eb; }
                  .status-cancelado { background: #fee2e2; color: #dc2626; }
                `}),e.jsxs("div",{className:"project-header",children:[e.jsxs("h4",{children:["ðŸ‘ï¸ ",s.name]}),e.jsxs("div",{className:"project-id",children:["ID: #",s.id]})]}),e.jsxs("div",{className:"row g-4",children:[e.jsxs("div",{className:"col-lg-8",children:[e.jsxs("div",{className:"info-card",children:[e.jsx("h6",{children:"ðŸ“Š InformaciÃ³n del Proyecto"}),e.jsxs("div",{className:"info-grid",children:[e.jsxs("div",{className:"info-item",children:[e.jsx("label",{children:"UbicaciÃ³n"}),e.jsx("div",{className:"value",children:s.location||"No especificada"})]}),e.jsxs("div",{className:"info-item",children:[e.jsx("label",{children:"Estado Actual"}),e.jsx("div",{children:e.jsx("span",{className:`status-badge status-${s.status||"pendiente"}`,children:s.status==="pendiente"?"Pendiente":s.status==="activo"?"Activo":s.status==="completado"?"Completado":s.status==="cancelado"?"Cancelado":s.status})})]}),e.jsxs("div",{className:"info-item",children:[e.jsx("label",{children:"Prioridad"}),e.jsx("div",{children:e.jsx("span",{className:`priority-badge priority-${s.priority||"normal"}`,children:s.priority==="urgent"?"ðŸ”´ Urgente":s.priority==="high"?"ðŸŸ  Alta":s.priority==="normal"?"ðŸŸ¢ Normal":s.priority==="low"?"ðŸ”µ Baja":"ðŸŸ¢ Normal"})})]})]})]}),e.jsxs("div",{className:"info-card",children:[e.jsx("h6",{children:"ðŸ¢ InformaciÃ³n de la Empresa"}),e.jsxs("div",{className:"info-grid",children:[e.jsxs("div",{className:"info-item",children:[e.jsx("label",{children:"Empresa"}),e.jsx("div",{className:"value fw-bold",children:s.company_name||"Sin empresa"})]}),e.jsxs("div",{className:"info-item",children:[e.jsx("label",{children:"RUC"}),e.jsx("div",{className:"value",children:s.company_ruc||"Sin RUC"})]}),e.jsxs("div",{className:"info-item",children:[e.jsx("label",{children:"Contacto"}),e.jsx("div",{className:"value fw-bold",children:s.contact_name||"Sin contacto"})]}),e.jsxs("div",{className:"info-item",children:[e.jsx("label",{children:"TelÃ©fono"}),e.jsx("div",{className:"value",children:s.contact_phone||"Sin telÃ©fono"})]}),e.jsxs("div",{className:"info-item",children:[e.jsx("label",{children:"Email"}),e.jsx("div",{className:"value",children:s.contact_email||"Sin email"})]}),e.jsxs("div",{className:"info-item",children:[e.jsx("label",{children:"Vendedor Asignado"}),e.jsx("div",{className:"value fw-bold",children:s.vendedor_name||"Sin asignar"})]}),e.jsxs("div",{className:"info-item",children:[e.jsx("label",{children:"Responsable Laboratorio"}),e.jsx("div",{className:"value fw-bold",children:s.laboratorio_name||"Sin asignar"})]})]})]})]}),e.jsx("div",{className:"col-lg-4",children:e.jsxs("div",{className:"info-card",children:[e.jsx("h6",{children:"ðŸ“… Detalles del Proyecto"}),e.jsxs("div",{className:"info-item mb-3",children:[e.jsx("label",{children:"Fecha de CreaciÃ³n"}),e.jsx("div",{className:"value",children:s.created_at?new Date(s.created_at).toLocaleDateString("es-ES"):"No disponible"})]}),e.jsxs("div",{className:"info-item mb-3",children:[e.jsx("label",{children:"Ãšltima ActualizaciÃ³n"}),e.jsx("div",{className:"value",children:s.updated_at?new Date(s.updated_at).toLocaleDateString("es-ES"):"No disponible"})]}),s.queries&&e.jsxs("div",{className:"info-item",children:[e.jsx("label",{children:"Consultas/Notas"}),e.jsx("div",{className:"value",style:{fontSize:"0.9rem",lineHeight:"1.4",maxHeight:"200px",overflowY:"auto",border:"1px solid #eee",borderRadius:"5px",padding:"10px"},children:(()=>{try{const a=JSON.parse(s.queries);return Array.isArray(a)&&a.length>0?a.map((l,F)=>{const de=(te=>{const oe=["#3b82f6","#ef4444"],V=te.split("").reduce((G,me)=>(G=(G<<5)-G+me.charCodeAt(0),G&G),0);return oe[Math.abs(V)%oe.length]})(l.user_name||"Usuario Desconocido");return e.jsxs("div",{className:"mb-2 pb-2",style:{borderBottom:F<a.length-1?"1px dotted #eee":"none"},children:[e.jsxs("div",{className:"fw-bold d-flex align-items-center",children:[e.jsx("div",{className:"me-2",style:{width:"4px",height:"20px",backgroundColor:de,borderRadius:"2px"}}),e.jsx(Ae,{className:"me-1",style:{color:de}}),"ðŸ‘¤ ",l.user_name||"Usuario Desconocido",e.jsx("span",{className:"ms-auto text-muted small",style:{fontSize:"0.75rem"},children:new Date(l.created_at).toLocaleString("es-ES",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"})})]}),e.jsx("p",{className:"mb-0 ms-3",style:{fontSize:"0.85rem"},children:l.message})]},F)}):e.jsx("p",{className:"text-muted",children:"No hay consultas registradas."})}catch{return e.jsx("p",{className:"text-muted",children:s.queries})}})()})]})]})})]}),e.jsxs("div",{className:"info-card",children:[e.jsx("h6",{children:"ðŸ“Ž Archivos Adjuntos"}),R.length===0?e.jsxs("div",{className:"text-center py-4 text-muted",children:[e.jsx(gs,{size:48,className:"mb-2 opacity-50"}),e.jsx("div",{children:"No hay archivos adjuntos"}),e.jsx("small",{children:"Este proyecto no tiene archivos adjuntos"})]}):e.jsx("div",{className:"row g-2",children:R.map(a=>e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"file-item",children:[e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx(ve,{className:"text-primary me-3",size:20}),e.jsxs("div",{children:[e.jsx("div",{className:"fw-bold",children:a.original_name}),e.jsxs("div",{className:"small text-muted",children:["ðŸ“ ",a.file_size?`${(a.file_size/1024/1024).toFixed(2)} MB`:"N/A",e.jsx("span",{className:"mx-2",children:"â€¢"}),"ðŸ“… ",new Date(a.created_at).toLocaleDateString(),e.jsx("span",{className:"mx-2",children:"â€¢"}),"ðŸ‘¤ ",a.uploaded_by_name||"Usuario"]}),a.description&&e.jsx("div",{className:"small text-muted mt-1",children:a.description})]})]}),e.jsx("div",{className:"d-flex gap-2",children:e.jsx(N,{variant:"outline-primary",size:"sm",onClick:()=>as(a),children:e.jsx(js,{size:14})})})]})},a.id))})]}),e.jsxs("div",{className:"d-flex justify-content-center gap-3 mt-4 pt-3 border-top",children:[e.jsxs(N,{variant:"primary",onClick:()=>{$(!1),ls(s)},className:"px-4",style:{backgroundColor:"#f84616",borderColor:"#f84616"},children:[e.jsx(xe,{className:"me-2"}),"âš™ï¸ Gestionar Proyecto"]}),s.quote_id&&e.jsxs(N,{variant:"primary",onClick:()=>{$(!1),Me(`/cotizaciones?view=${s.quote_id}`)},className:"px-4",style:{backgroundColor:"#f84616",borderColor:"#f84616"},children:[e.jsx(ve,{className:"me-2"}),"ðŸ“„ Ver Evidencias"]})]})]})}],onSubmit:()=>$(!1),submitText:"Cerrar"})]})}),q&&e.jsxs("div",{style:{position:"fixed",top:"20px",right:"20px",zIndex:99999,backgroundColor:Se==="success"?"#28a745":"#dc3545",color:"white",padding:"15px 20px",borderRadius:"8px",boxShadow:"0 4px 12px rgba(0,0,0,0.3)",minWidth:"300px",border:"none"},onClick:()=>b(!1),children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"5px"},children:Se==="success"?"âœ… Ã‰xito":"âŒ Error"}),e.jsx("div",{children:ge})]}),e.jsx(Fe,{show:Ns,onHide:()=>Pe(!1),title:"Seleccionar Servicios del Proyecto",size:"xl",data:{},fields:[],onSubmit:()=>Pe(!1),loading:!1,submitText:"Cerrar",customBody:e.jsx(vs,{selectedServices:Y,onServicesChange:Qe,serviceType:"laboratorio"})}),Ss&&e.jsx("div",{className:"modal-backdrop",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:1050,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsxs("div",{className:"modal-content bg-white rounded shadow-lg",style:{width:"90%",maxWidth:"1200px",maxHeight:"90vh",overflow:"auto"},children:[e.jsxs("div",{className:"modal-header p-4 border-bottom d-flex justify-content-between align-items-center",children:[e.jsx("h5",{className:"mb-0",children:"Crear Nuevo Proyecto"}),e.jsx(N,{variant:"outline-secondary",size:"sm",onClick:()=>Ce(!1),children:e.jsx(O,{})})]}),e.jsx("div",{className:"modal-body p-4",children:e.jsx(qa,{data:re?{company_id:re.id}:{},onSubmit:s=>{console.log("Datos del formulario:",s),Ce(!1)},onCancel:()=>Ce(!1),loading:Be.isLoading})})]})}),e.jsx(Re,{show:!!z,onHide:()=>j(null),onConfirm:Us,title:"Eliminar Proyecto",message:`Â¿EstÃ¡s seguro de que quieres eliminar el proyecto "${z==null?void 0:z.name}"?`,confirmText:"Eliminar",variant:"danger",isLoading:os.isLoading,alertMessage:"Esta acciÃ³n eliminarÃ¡ permanentemente el proyecto y todos sus datos asociados.",alertVariant:"danger"}),e.jsx(Re,{show:!!D,onHide:()=>L(null),onConfirm:Is,title:"Eliminar Archivo",message:"Â¿EstÃ¡s seguro de que quieres eliminar este archivo?",confirmText:"Eliminar",variant:"danger",alertMessage:"El archivo se eliminarÃ¡ permanentemente y no se puede recuperar.",alertVariant:"warning"}),e.jsx(Re,{show:!!y,onHide:()=>x(null),onConfirm:Rs,title:`${y!=null&&y.marked?"Desmarcar":"Marcar"} Proyecto`,message:`Â¿EstÃ¡s seguro de que quieres ${y!=null&&y.marked?"desmarcar":"marcar"} el proyecto "${y==null?void 0:y.name}"?`,confirmText:y!=null&&y.marked?"Desmarcar":"Marcar",variant:y!=null&&y.marked?"warning":"success"})]})}export{ai as default};
//# sourceMappingURL=Proyectos-D7jzt6We.js.map
