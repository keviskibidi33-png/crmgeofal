import{b as g,r as h,c as S,e as b,H as k,j as e}from"./index-D5j7Etbr.js";const A=async(a={})=>{try{console.log("ðŸ”¬ getProyectosAsignados - Llamando a: /api/laboratorio/proyectos");const r=new URLSearchParams;a.estado&&r.append("estado",a.estado),a.search&&r.append("search",a.search),a.page&&r.append("page",a.page),a.limit&&r.append("limit",a.limit);const s=r.toString(),l=`/api/laboratorio/proyectos${s?`?${s}`:""}`,d=await g(l);return console.log("âœ… getProyectosAsignados - Respuesta recibida:",d),d}catch(r){throw console.error("âŒ getProyectosAsignados - Error:",r),r}},_=async()=>{try{console.log("ðŸ“Š getEstadisticasLaboratorio - Llamando a: /api/laboratorio/estadisticas");const a=await g("/api/laboratorio/estadisticas");return console.log("âœ… getEstadisticasLaboratorio - Respuesta recibida:",a),a}catch(a){throw console.error("âŒ getEstadisticasLaboratorio - Error:",a),a}},M=async(a,r)=>{try{console.log("ðŸ”„ actualizarEstadoProyecto - Llamando a: /api/laboratorio/proyectos/"+a+"/estado");const s=await g(`/api/laboratorio/proyectos/${a}/estado`,{method:"PUT",body:JSON.stringify(r)});return console.log("âœ… actualizarEstadoProyecto - Respuesta recibida:",s),s}catch(s){throw console.error("âŒ actualizarEstadoProyecto - Error:",s),s}},F=async(a,r)=>{try{console.log("ðŸ“ subirArchivosLaboratorio - Llamando a: /api/laboratorio/proyectos/"+a+"/archivos");const s=await g(`/api/laboratorio/proyectos/${a}/archivos`,{method:"POST",body:JSON.stringify(r)});return console.log("âœ… subirArchivosLaboratorio - Respuesta recibida:",s),s}catch(s){throw console.error("âŒ subirArchivosLaboratorio - Error:",s),s}},q=async(a,r="")=>{try{console.log("ðŸ“‚ obtenerArchivosProyecto - Llamando a: /api/laboratorio/proyectos/"+a+"/archivos");const s=new URLSearchParams;r&&s.append("tipo",r);const l=s.toString(),d=`/api/laboratorio/proyectos/${a}/archivos${l?`?${l}`:""}`,n=await g(d);return console.log("âœ… obtenerArchivosProyecto - Respuesta recibida:",n),n}catch(s){throw console.error("âŒ obtenerArchivosProyecto - Error:",s),s}},Q=()=>{var P;const[a,r]=h.useState({estado:"",search:"",page:1}),[s,l]=h.useState(null),[d,n]=h.useState(!1),[z,E]=h.useState([]),[y,j]=h.useState(""),p=S(),{data:o,isLoading:L,error:v}=b({queryKey:["laboratorio-proyectos",a],queryFn:()=>A(a),keepPreviousData:!0}),{data:c,isLoading:$}=b({queryKey:["laboratorio-estadisticas"],queryFn:_}),{data:R,isLoading:T}=b({queryKey:["laboratorio-archivos",s==null?void 0:s.id],queryFn:()=>q(s.id),enabled:!!s}),x=k({mutationFn:({projectId:t,estado:i,notas:m})=>M(t,{estado:i,notas_laboratorio:m}),onSuccess:()=>{p.invalidateQueries(["laboratorio-proyectos"]),p.invalidateQueries(["laboratorio-estadisticas"]),n(!1),l(null)}});k({mutationFn:({projectId:t,archivos:i,notas:m})=>F(t,{archivos:i,notas_laboratorio:m}),onSuccess:()=>{p.invalidateQueries(["laboratorio-archivos"]),E([]),j("")}});const u=(t,i)=>{r(m=>({...m,[t]:i,page:t!=="page"?1:i}))},C=t=>{l(t),n(!0)},f=t=>{s&&x.mutate({projectId:s.id,estado:t,notas:y})},N=t=>({en_laboratorio:"bg-yellow-100 text-yellow-800",completado:"bg-green-100 text-green-800",cancelado:"bg-red-100 text-red-800"})[t]||"bg-gray-100 text-gray-800",w=t=>({en_laboratorio:"En Proceso",completado:"Completado",cancelado:"Cancelado"})[t]||t;return L?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-500"})}):v?e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:e.jsx("div",{className:"flex",children:e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-sm font-medium text-red-800",children:"Error"}),e.jsx("div",{className:"mt-2 text-sm text-red-700",children:v.message})]})})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white shadow rounded-lg p-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Dashboard de Laboratorio"}),e.jsx("p",{className:"text-gray-600",children:"Gestiona los proyectos asignados al laboratorio"})]}),c&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsx("div",{className:"bg-white overflow-hidden shadow rounded-lg",children:e.jsx("div",{className:"p-5",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-8 h-8 bg-blue-500 rounded-md flex items-center justify-center",children:e.jsx("span",{className:"text-white font-bold",children:"T"})})}),e.jsx("div",{className:"ml-5 w-0 flex-1",children:e.jsxs("dl",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500 truncate",children:"Total Proyectos"}),e.jsx("dd",{className:"text-lg font-medium text-gray-900",children:c.data.total_proyectos})]})})]})})}),e.jsx("div",{className:"bg-white overflow-hidden shadow rounded-lg",children:e.jsx("div",{className:"p-5",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-8 h-8 bg-yellow-500 rounded-md flex items-center justify-center",children:e.jsx("span",{className:"text-white font-bold",children:"P"})})}),e.jsx("div",{className:"ml-5 w-0 flex-1",children:e.jsxs("dl",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500 truncate",children:"En Proceso"}),e.jsx("dd",{className:"text-lg font-medium text-gray-900",children:c.data.en_proceso})]})})]})})}),e.jsx("div",{className:"bg-white overflow-hidden shadow rounded-lg",children:e.jsx("div",{className:"p-5",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-8 h-8 bg-green-500 rounded-md flex items-center justify-center",children:e.jsx("span",{className:"text-white font-bold",children:"C"})})}),e.jsx("div",{className:"ml-5 w-0 flex-1",children:e.jsxs("dl",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500 truncate",children:"Completados"}),e.jsx("dd",{className:"text-lg font-medium text-gray-900",children:c.data.completados})]})})]})})}),e.jsx("div",{className:"bg-white overflow-hidden shadow rounded-lg",children:e.jsx("div",{className:"p-5",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-8 h-8 bg-purple-500 rounded-md flex items-center justify-center",children:e.jsx("span",{className:"text-white font-bold",children:"S"})})}),e.jsx("div",{className:"ml-5 w-0 flex-1",children:e.jsxs("dl",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500 truncate",children:"Esta Semana"}),e.jsx("dd",{className:"text-lg font-medium text-gray-900",children:c.data.esta_semana})]})})]})})})]}),e.jsx("div",{className:"bg-white shadow rounded-lg p-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Estado"}),e.jsxs("select",{value:a.estado,onChange:t=>u("estado",t.target.value),className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"",children:"Todos los estados"}),e.jsx("option",{value:"en_laboratorio",children:"En Proceso"}),e.jsx("option",{value:"completado",children:"Completado"}),e.jsx("option",{value:"cancelado",children:"Cancelado"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Buscar"}),e.jsx("input",{type:"text",value:a.search,onChange:t=>u("search",t.target.value),placeholder:"Buscar por proyecto o cliente...",className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500"})]}),e.jsx("div",{className:"flex items-end",children:e.jsx("button",{onClick:()=>r({estado:"",search:"",page:1}),className:"w-full bg-gray-500 text-white px-4 py-2 rounded-md hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-gray-500",children:"Limpiar Filtros"})})]})}),e.jsxs("div",{className:"bg-white shadow rounded-lg",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Proyectos Asignados"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Proyecto"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Cliente"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Estado"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Fecha EnvÃ­o"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Acciones"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:(P=o==null?void 0:o.data)==null?void 0:P.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:t.proyecto_nombre}),e.jsx("div",{className:"text-sm text-gray-500",children:t.description})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:t.cliente_nombre}),e.jsx("div",{className:"text-sm text-gray-500",children:t.cliente_email})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${N(t.estado)}`,children:w(t.estado)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:t.fecha_envio_laboratorio?new Date(t.fecha_envio_laboratorio).toLocaleDateString():"N/A"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsx("button",{onClick:()=>C(t),className:"text-blue-600 hover:text-blue-900 mr-3",children:"Ver Detalles"})})]},t.id))})]})}),(o==null?void 0:o.pagination)&&e.jsx("div",{className:"px-6 py-3 border-t border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-700",children:["Mostrando ",(o.pagination.page-1)*o.pagination.limit+1," a"," ",Math.min(o.pagination.page*o.pagination.limit,o.pagination.total)," de"," ",o.pagination.total," resultados"]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>u("page",a.page-1),disabled:a.page<=1,className:"px-3 py-1 border border-gray-300 rounded-md text-sm disabled:opacity-50 disabled:cursor-not-allowed",children:"Anterior"}),e.jsx("button",{onClick:()=>u("page",a.page+1),disabled:a.page>=o.pagination.pages,className:"px-3 py-1 border border-gray-300 rounded-md text-sm disabled:opacity-50 disabled:cursor-not-allowed",children:"Siguiente"})]})]})})]}),d&&s&&e.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:e.jsx("div",{className:"relative top-20 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-lg rounded-md bg-white",children:e.jsxs("div",{className:"mt-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:s.proyecto_nombre}),e.jsxs("button",{onClick:()=>n(!1),className:"text-gray-400 hover:text-gray-600",children:[e.jsx("span",{className:"sr-only",children:"Cerrar"}),e.jsx("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Cliente"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:s.cliente_nombre}),e.jsx("p",{className:"text-sm text-gray-500",children:s.cliente_email})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Estado Actual"}),e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${N(s.estado)}`,children:w(s.estado)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Notas del Vendedor"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:s.notas_vendedor||"Sin notas"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Notas del Laboratorio"}),e.jsx("textarea",{value:y,onChange:t=>j(t.target.value),rows:3,className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500",placeholder:"Agregar notas sobre el trabajo realizado..."})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:()=>f("en_laboratorio"),disabled:x.isPending,className:"flex-1 bg-yellow-600 text-white px-4 py-2 rounded-md hover:bg-yellow-700 focus:outline-none focus:ring-2 focus:ring-yellow-500 disabled:opacity-50",children:x.isPending?"Actualizando...":"Marcar En Proceso"}),e.jsx("button",{onClick:()=>f("completado"),disabled:x.isPending,className:"flex-1 bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 disabled:opacity-50",children:x.isPending?"Completando...":"Marcar Completado"})]})]})]})})})]})};export{Q as default};
//# sourceMappingURL=Laboratorio-BJ2X_EUq.js.map
