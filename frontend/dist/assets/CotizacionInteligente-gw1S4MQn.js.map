{"version":3,"file":"CotizacionInteligente-gw1S4MQn.js","sources":["../../src/pages/CotizacionInteligente.jsx"],"sourcesContent":["import React, { useEffect, useMemo, useState } from 'react';\nimport ModuloBase from '../components/ModuloBase';\nimport { createQuote } from '../services/quotes';\nimport { getExistingServices, listProjects, createProject } from '../services/projects';\nimport { getOrCreateCompany, listCompanies } from '../services/companies';\nimport CompanyProjectPicker from '../components/CompanyProjectPicker';\nimport SubserviceAutocomplete from '../components/SubserviceAutocomplete';\nimport './CotizacionInteligente.css';\nimport '../styles/autocomplete.css';\n\nconst emptyClient = {\n  company_name: '', ruc: '', contact_name: '', contact_phone: '', contact_email: '',\n  project_location: '', project_name: '',\n};\n\nconst emptyQuote = {\n  request_date: '', issue_date: '', commercial_name: '', commercial_phone: '', \n  payment_terms: 'adelantado', reference: '', reference_type: ['email', 'phone'], \n  igv: true, delivery_days: 4, category_main: 'laboratorio',\n};\n\nconst emptyItem = { code: '', description: '', norm: '', unit_price: 0, quantity: 1 };\n\nfunction computePartial(item) {\n  const u = Number(item.unit_price || 0);\n  const q = Number(item.quantity || 0);\n  return Number((u * q).toFixed(2));\n}\n\nfunction suggestedFileName(seq = 'xxx-XX', client = '') {\n  const clientName = (client || '').toUpperCase().trim() || 'NOMBRE DEL CLIENTE';\n  return `Cotizaci√≥n ${seq} LEM-GEOFAL-${clientName}`;\n}\n\nfunction generateQuoteCode() {\n  const year = new Date().getFullYear();\n  const month = String(new Date().getMonth() + 1).padStart(2, '0');\n  const day = String(new Date().getDate()).padStart(2, '0');\n  const random = Math.floor(Math.random() * 1000).toString().padStart(3, '0');\n  return `COT-${year}${month}${day}-${random}`;\n}\n\nconst normalizeKey = (s = '') => (s || '')\n  .normalize('NFD')\n  .replace(/[\\u0300-\\u036f]/g, '')\n  .toUpperCase()\n  .trim();\n\nconst VARIANT_TEXTS = {\n  [normalizeKey('MUESTRA DE SUELO Y AGREGADO')]: `CONDICIONES ESPEC√çFICAS:\\n- El cliente debe enviar al laboratorio, para los ensayo en suelo y agregados, la cantidad minima de 100 kg por cada muestra.\\n- El cliente deber√° de entregar las muestras debidamente identificadas.\\n- El cliente deber√° especificar la Norma a ser utilizada para la ejecuci√≥n del ensayo, caso contrario se considera Norma ASTM o NTP vigente de acuerdo con el alcance del laboratorio.\\n- El cliente deber√° entregar las muestras en las instalaciones del LEM, ubicado en la Av. Mara√±√≥n N¬∞ 763, Los Olivos, Lima.`,\n  [normalizeKey('PROBETAS')]: `CONDICIONES ESPEC√çFICAS:\\n- El cliente debe proporcionar las probetas antes del ingreso a obra.\\n- El cliente deber√° de entregar las muestras debidamente identificadas.\\n- El cliente deber√° especificar la Norma a ser utilizada para la ejecuci√≥n del ensayo, caso contrario se considera Norma ASTM o NTP vigente de acuerdo con el alcance del laboratorio.\\n- El cliente deber√° entregar las muestras en las instalaciones del LEM, ubicado en la Av. Mara√±√≥n N¬∞ 763, Los Olivos, Lima.`,\n  [normalizeKey('DENSIDAD DE CAMPO Y MUESTREO')]: `CONDICIONES ESPEC√çFICAS:\\n- El cliente deber√° enviar al laboratorio, para los ensayo en suelo y agregados, la cantidad minima de 100 kg por cada muestra.\\n- Para el ensayo de Densidad de campo, la cantidad de puntos/salida minimo 4 und.\\n- El cliente deber√° de programar el servicio, Densidad de campo, con 24 horas de anticipaci√≥n.\\n- El cliente deber√° especificar la Norma a ser utilizada para la ejecuci√≥n del ensayo, caso contrario se considera Norma ASTM o NTP vigente de acuerdo con el alcance del laboratorio.\\n- El cliente deber√° entregar las muestras en las instalaciones del LEM, ubicado en la Av. Mara√±√≥n N¬∞ 763, Los Olivos, Lima.`,\n  [normalizeKey('EXTRACCI√ìN DE DIAMANTINA')]: `CONDICIONES ESPEC√çFICAS:\\n- Movilizaci√≥n y desmovilizaci√≥n de equipos y del personal t√©cnico, estara a cargo de GEOFAL.\\n- Resane de estructura de concreto con sika rep 500 y Sikadur 32, estara a cargo de GEOFAL.\\n- El servicio no incluye trabajos de acabados como pintura, mayolica y otros.\\n- El area de trabajo, zona de extracci√≥n de diamantina, tiene que estar libre de interferencia.\\n- La extracci√≥n de diamantina se realizara en 2 dia en campo, en laboratorio se realizar√° el tallado y refrentado de diamantina, el ensayo de resistencia a la compresi√≥n de testigo de diamantina se realizara en 5 dias (el tiempo de ensayo obedece a la normativa vigente).\\n- Costo de resane insumos 250 soles, este costo se distribuira de acuerdo con el numero de perforaciones Donde se hara las extracciones de diamantina`,\n  [normalizeKey('DIAMANTINA PARA PASES')]: `CONDICIONES ESPEC√çFICAS:\\n- El cliente deber√° de programar el servicio, Extracci√≥n diamantina, con 24 horas de anticipaci√≥n.\\n- El area de trabajo, zona de extraccion de diamantina, debera estar libre de interferencia.\\n- Para extraer la diamantina, se ubicara el acero con un escaneador.\\n- Movilizacion y desmovilizacion de equipos y del personal tecnico, estara a cargo de Geofal.`,\n  [normalizeKey('ALBA√ëILER√çA')]: `CONDICIONES ESPEC√çFICAS:\\n- El cliente deber√° enviar al laboratorio, 20 ladrillo de cada tipo, en buen estado y sin presentar fisuras.\\n- El cliente deber√° de entregar las muestras debidamente identificadas.\\n- El cliente deber√° especificar la Norma a ser utilizada para la ejecuci√≥n del ensayo, caso contrario se considera Norma ASTM o NTP vigente de acuerdo con el alcance del laboratorio.\\n- El cliente deber√° entregar las muestras en las instalaciones del LEM, ubicado en la Av. Mara√±√≥n N¬∞ 763, Los Olivos, Lima`,\n  [normalizeKey('VIGA BECKELMAN')]: `CONDICIONES ESPEC√çFICAS:\\n- El cliente deber√° de programar el servicio, Ensayo de Deflexi√≥n, con 24 horas de anticipaci√≥n.\\n- El area de trabajo tiene que estar habilitado.\\n- El cliente deber√° especificar la Norma a ser utilizada para la ejecuci√≥n del ensayo, caso contrario se considera Norma ASTM o NTP o MTC vigente de acuerdo con el alcance del laboratorio.\\n- Especificar las caracteristicas del camion`,\n  [normalizeKey('CONTROL DE CALIDAD DE CONCRETO FRESCO EN OBRA')]: `CONDICIONES ESPEC√çFICAS:\\n- El cliente deber√° de programar el servicio, con 24 horas de anticipaci√≥n.\\n- Para el ensayo de control de calidad de concreto fresco en obra, se moldeara 6 probetas, ensayo slump, control de temperatura, en laboratorio las probetas se colocara en camara de curado, el ensayo de compresi√≥n de las probetas seran 3 a 7 dias y 3 a 28 dias.\\n- El control de calidad del concreto fresco se sacara cada 50m3 a uno de los mixer donde se hara todos los ensayos respectivos mencionados, o por dia asi no se halla llegado los 50m3.\\n- El cliente deber√° especificar la Norma a ser utilizada para la ejecuci√≥n del ensayo, caso contrario se considera Norma ASTM o NTP vigente de acuerdo con el alcance del laboratorio.`,\n};\n\nconst getVariantText = (v) => {\n  const t = normalizeKey(v?.title || '');\n  if (VARIANT_TEXTS[t]) return VARIANT_TEXTS[t];\n  const entry = Object.entries(VARIANT_TEXTS).find(([k]) => t.includes(k) || k.includes(t));\n  return entry ? entry[1] : '';\n};\n\nexport default function CotizacionInteligente() {\n  const [variants, setVariants] = useState([]);\n  const [variantId, setVariantId] = useState('');\n  const [client, setClient] = useState(emptyClient);\n  const [selection, setSelection] = useState({ company_id: null, project_id: null, company: null, project: null });\n  const [quote, setQuote] = useState(emptyQuote);\n  const [items, setItems] = useState([{ ...emptyItem }]);\n  const [saving, setSaving] = useState(false);\n  const [error, setError] = useState('');\n  const [conditionsText, setConditionsText] = useState('');\n  const [lastSavedId, setLastSavedId] = useState(null);\n  const [allProjects, setAllProjects] = useState([]);\n  const [projectSuggestions, setProjectSuggestions] = useState([]);\n  const [showProjectSuggestions, setShowProjectSuggestions] = useState(false);\n  const [suggestedFileName, setSuggestedFileName] = useState('');\n  \n  // Estados para el buscador de clientes\n  const [clients, setClients] = useState([]);\n  const [filteredClients, setFilteredClients] = useState([]);\n  const [clientSearch, setClientSearch] = useState('');\n  const [selectedClient, setSelectedClient] = useState(null);\n  const [showClientDropdown, setShowClientDropdown] = useState(false);\n  \n  // Etiquetas predefinidas para referencia\n  const referenceTypes = [\n    { value: 'email', label: 'üìß Correo electr√≥nico', icon: 'üìß' },\n    { value: 'phone', label: 'üìû Llamada telef√≥nica', icon: 'üìû' },\n    { value: 'ticket', label: 'üéØ Sistema de tickets', icon: 'üéØ' },\n    { value: 'meeting', label: 'ü§ù Reuni√≥n presencial', icon: 'ü§ù' },\n    { value: 'form', label: 'üìã Formulario web', icon: 'üìã' },\n    { value: 'referral', label: 'üë• Referido', icon: 'üë•' },\n    { value: 'other', label: 'üìù Otro', icon: 'üìù' }\n  ];\n\n  // Cargar variantes\n  useEffect(() => {\n    const fallback = [\n      { id: 'V1', code: 'V1', title: 'MUESTRA DE SUELO Y AGREGADO', description: getVariantText({ title: 'MUESTRA DE SUELO Y AGREGADO' }) },\n      { id: 'V2', code: 'V2', title: 'PROBETAS', description: getVariantText({ title: 'PROBETAS' }) },\n      { id: 'V3', code: 'V3', title: 'DENSIDAD DE CAMPO Y MUESTREO', description: getVariantText({ title: 'DENSIDAD DE CAMPO Y MUESTREO' }) },\n      { id: 'V4', code: 'V4', title: 'EXTRACCI√ìN DE DIAMANTINA', description: getVariantText({ title: 'EXTRACCI√ìN DE DIAMANTINA' }) },\n      { id: 'V5', code: 'V5', title: 'DIAMANTINA PARA PASES', description: getVariantText({ title: 'DIAMANTINA PARA PASES' }) },\n      { id: 'V6', code: 'V6', title: 'ALBA√ëILER√çA', description: getVariantText({ title: 'ALBA√ëILER√çA' }) },\n      { id: 'V7', code: 'V7', title: 'VIGA BECKELMAN', description: getVariantText({ title: 'VIGA BECKELMAN' }) },\n      { id: 'V8', code: 'V8', title: 'CONTROL DE CALIDAD DE CONCRETO FRESCO EN OBRA', description: getVariantText({ title: 'CONTROL DE CALIDAD DE CONCRETO FRESCO EN OBRA' }) },\n    ];\n    setVariants(fallback);\n  }, []);\n\n  // Cargar proyectos existentes\n  useEffect(() => {\n    (async () => {\n      try {\n        const response = await listProjects({ page: 1, limit: 100 });\n        const projects = response.data || [];\n        setAllProjects(projects);\n        setProjectSuggestions(projects);\n      } catch (e) {\n        console.warn('No se pudieron cargar proyectos existentes:', e);\n        setAllProjects([]);\n        setProjectSuggestions([]);\n      }\n    })();\n  }, []);\n\n  // Auto-completar datos del cliente cuando se selecciona\n  useEffect(() => {\n    if (selection.company) {\n      setClient(prev => ({\n        ...prev,\n        company_name: selection.company.name || prev.company_name,\n        ruc: selection.company.ruc || prev.ruc,\n        contact_name: selection.company.contact_name || prev.contact_name,\n        contact_phone: selection.company.phone || prev.contact_phone,\n        contact_email: selection.company.email || prev.contact_email,\n        project_location: selection.project?.location || prev.project_location,\n        project_name: selection.project?.name || prev.project_name\n      }));\n    }\n  }, [selection.company, selection.project]);\n\n  // Auto-completar datos del asesor comercial\n  useEffect(() => {\n    const token = localStorage.getItem('token');\n    if (token) {\n      try {\n        const payload = JSON.parse(atob(token.split('.')[1]));\n        if (payload.name) {\n          setQuote(prev => ({\n            ...prev,\n            commercial_name: payload.name,\n            commercial_phone: payload.phone || ''\n          }));\n        }\n      } catch (e) {\n        console.warn('No se pudo decodificar el token:', e);\n      }\n    }\n  }, []);\n\n\n  // Autocompletar desde la variante seleccionada\n  useEffect(() => {\n    if (!variantId) return;\n    const v = (variants || []).find(x => String(x.id) === String(variantId));\n    if (!v) return;\n    const c = v.conditions || {};\n    setQuote(prev => ({\n      ...prev,\n      payment_terms: c.default_payment_terms || prev.payment_terms,\n      igv: typeof c.default_igv === 'boolean' ? c.default_igv : prev.igv,\n      reference: c.default_reference || prev.reference,\n    }));\n    const extra = getVariantText(v) || v.description || '';\n    if (extra) setConditionsText(extra);\n  }, [variantId]);\n\n  const subtotal = useMemo(() => items.reduce((acc, it) => acc + computePartial(it), 0), [items]);\n  const igvAmount = useMemo(() => (quote.igv ? Number((subtotal * 0.18).toFixed(2)) : 0), [subtotal, quote.igv]);\n  const total = useMemo(() => Number((subtotal + igvAmount).toFixed(2)), [subtotal, igvAmount]);\n\n  const onAddItem = () => setItems([...items, { ...emptyItem }]);\n  const onRemoveItem = (idx) => setItems(items.filter((_, i) => i !== idx));\n  const onChangeItem = (idx, patch) => setItems(items.map((it, i) => (i === idx ? { ...it, ...patch } : it)));\n\n  // Funciones para el buscador de clientes\n  const fetchClients = async () => {\n    try {\n      console.log('üîç fetchClients - Llamando a /api/companies');\n      const clientsData = await listCompanies({ limit: 500 });\n      console.log('üîç fetchClients - Respuesta recibida:', clientsData);\n      \n      const clientsList = clientsData?.data || clientsData || [];\n      console.log('üîç fetchClients - Lista de clientes:', clientsList.length, 'clientes');\n      \n      setClients(clientsList);\n    } catch (err) {\n      console.error('‚ùå Error fetching clients:', err);\n      setError('Error al cargar los clientes: ' + (err.message || 'Error desconocido'));\n      setClients([]);\n    }\n  };\n\n  const handleClientSearch = (searchTerm) => {\n    console.log('üîç handleClientSearch - T√©rmino de b√∫squeda:', searchTerm);\n    setClientSearch(searchTerm);\n    \n    if (!searchTerm.trim()) {\n      setFilteredClients([]);\n      setShowClientDropdown(false);\n      return;\n    }\n    \n    const searchLower = searchTerm.toLowerCase();\n    console.log('üîç handleClientSearch - B√∫squeda en min√∫sculas:', searchLower);\n    \n    const filtered = clients.filter(client => {\n      const nameMatch = client.name?.toLowerCase().includes(searchLower);\n      const rucMatch = client.ruc?.toLowerCase().includes(searchLower);\n      const emailMatch = client.email?.toLowerCase().includes(searchLower);\n      const phoneMatch = client.phone?.toLowerCase().includes(searchLower);\n      \n      // B√∫squeda por palabras individuales\n      const nameWordsMatch = client.name?.toLowerCase().split(' ').some(word => \n        word.includes(searchLower)\n      );\n      \n      const match = nameMatch || rucMatch || emailMatch || phoneMatch || nameWordsMatch;\n      \n      if (match) {\n        console.log('‚úÖ Cliente encontrado:', client.name, '- Match:', { nameMatch, nameWordsMatch, rucMatch, emailMatch, phoneMatch });\n      }\n      \n      return match;\n    });\n    \n    console.log('üîç handleClientSearch - Resultados encontrados:', filtered.length);\n    setFilteredClients(filtered);\n    setShowClientDropdown(true);\n  };\n\n  const handleClientSelect = (client) => {\n    console.log('üîç handleClientSelect - Cliente seleccionado:', client.name, 'ID:', client.id);\n    setSelectedClient(client);\n    setClientSearch(client.name);\n    setShowClientDropdown(false);\n    \n    // Llenar autom√°ticamente los campos del cliente\n    setClient(prev => ({\n      ...prev,\n      company_name: client.name || '',\n      ruc: client.ruc || '',\n      contact_name: client.contact_name || '',\n      contact_phone: client.phone || '',\n      contact_email: client.email || '',\n      project_location: client.address || ''\n    }));\n    \n    console.log('‚úÖ Campos del cliente llenados autom√°ticamente:', {\n      company_name: client.name,\n      ruc: client.ruc,\n      contact_name: client.contact_name,\n      contact_phone: client.phone,\n      contact_email: client.email,\n      project_location: client.address\n    });\n  };\n\n  const handleClientClear = () => {\n    console.log('üîç handleClientClear - Limpiando selecci√≥n de cliente');\n    setSelectedClient(null);\n    setClientSearch('');\n    setShowClientDropdown(false);\n    setClient(emptyClient);\n  };\n\n  // Cargar clientes al montar el componente\n  useEffect(() => {\n    fetchClients();\n  }, []);\n\n  const onSubmit = async (e) => {\n    e.preventDefault();\n    setSaving(true);\n    setError('');\n    try {\n      if (!client.company_name) {\n        throw new Error('Debe ingresar al menos el nombre de la empresa');\n      }\n      \n      let projectId = selection.project?.id || selection.project_id;\n      let companyId = selection.company?.id;\n      \n      // Si no hay empresa seleccionada, crear una autom√°ticamente\n      if (!companyId) {\n        if (!client.ruc) {\n          throw new Error('Debe ingresar el RUC de la empresa');\n        }\n        \n        // Obtener o crear empresa autom√°ticamente\n        const newCompany = await getOrCreateCompany({\n          type: 'empresa',\n          ruc: client.ruc,\n          name: client.company_name,\n          address: client.project_location || '',\n          email: client.contact_email || '',\n          phone: client.contact_phone || '',\n          contact_name: client.contact_name || '',\n          city: client.project_location || '',\n          sector: 'servicios'\n        });\n        \n        companyId = newCompany.id;\n        console.log('‚úÖ Empresa obtenida/creada:', newCompany);\n      }\n      \n      // Si no hay proyecto seleccionado, crear uno autom√°ticamente\n      if (!projectId) {\n        // Crear proyecto autom√°ticamente\n        const newProject = await createProject({\n          company_id: companyId,\n          name: client.project_name || `Proyecto ${client.company_name}`,\n          location: client.project_location || 'Por definir',\n          contact_name: client.contact_name,\n          contact_phone: client.contact_phone,\n          contact_email: client.contact_email,\n          status: 'activo',\n          project_type: 'cotizacion',\n          priority: 'normal'\n        });\n        \n        projectId = newProject.id;\n        console.log('‚úÖ Proyecto creado autom√°ticamente:', newProject);\n      }\n      \n      const quoteCode = generateQuoteCode();\n      \n      const payload = {\n        project_id: projectId,\n        variant_id: variantId || null,\n        client_contact: client.contact_name,\n        client_email: client.contact_email,\n        client_phone: client.contact_phone,\n        issue_date: quote.issue_date || new Date().toISOString().slice(0, 10),\n        subtotal,\n        igv: igvAmount,\n        total,\n        status: 'borrador',\n        reference: quote.reference,\n        reference_type: JSON.stringify(quote.reference_type),\n        category_main: quote.category_main, // ‚úÖ NUEVO: Categor√≠a principal\n        quote_code: quoteCode, // ‚úÖ NUEVO: C√≥digo √∫nico\n        meta: JSON.stringify({\n          customer: client,\n          quote: {\n            ...quote,\n            request_date: quote.request_date || new Date().toISOString().slice(0, 10),\n            delivery_days: quote.delivery_days || 4,\n            reference: quote.reference,\n            category_main: quote.category_main, // ‚úÖ NUEVO: Categor√≠a en meta\n            quote_code: quoteCode // ‚úÖ NUEVO: C√≥digo en meta\n          },\n          items: items, // Agregar √≠tems al meta\n          conditions_text: conditionsText,\n          payment_terms: quote.payment_terms,\n          file_name: suggestedFileName || `Cotizaci√≥n ${new Date().getFullYear()}-${String(new Date().getMonth() + 1).padStart(2, '0')}${String(new Date().getDate()).padStart(2, '0')} LEM-GEOFAL-${client.company_name?.toUpperCase() || 'CLIENTE'}`,\n        })\n      };\n      \n      const saved = await createQuote(payload);\n      alert(`‚úÖ Cotizaci√≥n creada exitosamente\\nüìã C√≥digo: ${quoteCode}\\nüè∑Ô∏è Categor√≠a: ${quote.category_main === 'laboratorio' ? 'üß™ Laboratorio' : '‚öôÔ∏è Ingenier√≠a'}\\nüìä √çtems guardados: ${items.length} √≠tems\\nüí∞ Total: S/ ${quote.total?.toLocaleString() || '0.00'}`);\n      setLastSavedId(saved.id);\n    } catch (e) {\n      console.error('Error:', e);\n      setError(e.message || 'Error al crear cotizaci√≥n');\n    } finally {\n      setSaving(false);\n    }\n  };\n\n  const exportFile = async (type) => {\n    try {\n      const id = lastSavedId;\n      if (!id) return alert('Guarde la cotizaci√≥n antes de exportar');\n      \n      const base = import.meta.env?.VITE_API_URL?.replace(/\\/$/, '') || '';\n      const path = `/api/quotes/${id}/export/${type}`;\n      const url = base && /\\/api$/i.test(base) ? `${base}${path.replace(/^\\/api/, '')}` : `${base}${path}`;\n      \n      // Obtener token de autenticaci√≥n\n      const token = localStorage.getItem('token');\n      if (!token) {\n        throw new Error('No se encontr√≥ token de autenticaci√≥n');\n      }\n      \n      // Realizar la petici√≥n con el token\n      const response = await fetch(url, {\n        method: 'GET',\n        headers: {\n          'Authorization': `Bearer ${token}`,\n          'Content-Type': 'application/json',\n        },\n      });\n      \n      if (!response.ok) {\n        throw new Error(`Error ${response.status}: ${response.statusText}`);\n      }\n      \n      // Obtener el blob del archivo\n      const blob = await response.blob();\n      \n      // Crear URL temporal y descargar\n      const downloadUrl = window.URL.createObjectURL(blob);\n      const link = document.createElement('a');\n      link.href = downloadUrl;\n      link.download = `cotizacion-${id}.${type === 'excel' ? 'xlsx' : 'pdf'}`;\n      document.body.appendChild(link);\n      link.click();\n      document.body.removeChild(link);\n      window.URL.revokeObjectURL(downloadUrl);\n      \n    } catch (e) {\n      console.error('Error al exportar:', e);\n      alert(`No se pudo exportar: ${e.message}`);\n    }\n  };\n\n  const exportDraft = async () => {\n    try {\n      const id = lastSavedId;\n      if (!id) return alert('Guarde la cotizaci√≥n antes de generar el borrador');\n      \n      const base = import.meta.env?.VITE_API_URL?.replace(/\\/$/, '') || '';\n      const path = `/api/quotes/${id}/export/pdf-draft`;\n      const url = base && /\\/api$/i.test(base) ? `${base}${path.replace(/^\\/api/, '')}` : `${base}${path}`;\n      \n      // Obtener token de autenticaci√≥n\n      const token = localStorage.getItem('token');\n      if (!token) {\n        throw new Error('No se encontr√≥ token de autenticaci√≥n');\n      }\n      \n      // Realizar la petici√≥n con el token\n      const response = await fetch(url, {\n        method: 'GET',\n        headers: {\n          'Authorization': `Bearer ${token}`,\n          'Content-Type': 'application/json',\n        },\n      });\n      \n      if (!response.ok) {\n        throw new Error(`Error ${response.status}: ${response.statusText}`);\n      }\n      \n      // Obtener el blob del archivo\n      const blob = await response.blob();\n      \n      // Crear URL temporal y descargar\n      const downloadUrl = window.URL.createObjectURL(blob);\n      const link = document.createElement('a');\n      link.href = downloadUrl;\n      link.download = `cotizacion-borrador-${id}.pdf`;\n      document.body.appendChild(link);\n      link.click();\n      document.body.removeChild(link);\n      window.URL.revokeObjectURL(downloadUrl);\n      \n    } catch (e) {\n      console.error('Error al exportar borrador:', e);\n      alert(`No se pudo exportar borrador: ${e.message}`);\n    }\n  };\n\n  return (\n    <ModuloBase titulo=\"üìã Cotizaci√≥n Inteligente\" descripcion=\"Formulario unificado para crear cotizaciones de forma r√°pida e intuitiva\">\n      {error && <div className=\"alert alert-danger\">{error}</div>}\n\n      <form onSubmit={onSubmit} className=\"intelligent-quote-form\">\n        <div className=\"alert alert-light border mt-3 intelligent-intro\">\n          <h5>üöÄ Flujo Simplificado</h5>\n          <p className=\"mb-0\">Completa los datos del cliente, proyecto y cotizaci√≥n. Usa el bot√≥n \"üíæ GUARDAR COTIZACI√ìN\" para guardar tu trabajo.</p>\n        </div>\n\n        {/* Secci√≥n Cliente */}\n        <div className=\"intelligent-section\">\n          <div className=\"section-header\">\n            <span className=\"section-icon\">üè¢</span>\n            <h4>CLIENTE</h4>\n            <span className=\"section-status\">\n              {client.company_name ? '‚úÖ Cliente configurado' : '‚è≥ Pendiente'}\n            </span>\n          </div>\n          <div className=\"section-content\">\n            {/* Buscador de Clientes */}\n            <div className=\"row g-3 mb-4\">\n              <div className=\"col-md-12\">\n                <label className=\"form-label\">Buscar Cliente Existente</label>\n                <div className=\"position-relative\">\n                  <input \n                    type=\"text\"\n                    className=\"form-control\" \n                    value={clientSearch}\n                    onChange={(e) => handleClientSearch(e.target.value)}\n                    onFocus={() => setShowClientDropdown(true)}\n                    placeholder=\"Buscar por nombre, RUC, email o tel√©fono...\"\n                  />\n                  {selectedClient && (\n                    <button\n                      type=\"button\"\n                      className=\"btn btn-outline-secondary btn-sm position-absolute end-0 top-50 translate-middle-y me-2\"\n                      onClick={handleClientClear}\n                    >\n                      ‚úï\n                    </button>\n                  )}\n                </div>\n                {clientSearch && showClientDropdown && filteredClients.length > 0 && (\n                  <div className=\"border rounded mt-2\" style={{maxHeight: '200px', overflowY: 'auto'}}>\n                    <div className=\"p-2 bg-light border-bottom\">\n                      <small className=\"text-muted\">\n                        {filteredClients.length} cliente{filteredClients.length !== 1 ? 's' : ''} encontrado{filteredClients.length !== 1 ? 's' : ''}\n                      </small>\n                    </div>\n                    {filteredClients.map((clientItem) => (\n                      <div\n                        key={clientItem.id}\n                        className=\"p-2 border-bottom cursor-pointer hover-bg-light\"\n                        onClick={() => handleClientSelect(clientItem)}\n                        style={{cursor: 'pointer'}}\n                      >\n                        <div className=\"fw-bold\">{clientItem.name}</div>\n                        <small className=\"text-muted\">\n                          RUC: {clientItem.ruc} | Email: {clientItem.email}\n                          {clientItem.phone && ` | Tel: ${clientItem.phone}`}\n                        </small>\n                      </div>\n                    ))}\n                  </div>\n                )}\n                {clientSearch && showClientDropdown && filteredClients.length === 0 && (\n                  <div className=\"border rounded mt-2 p-3 text-center\">\n                    <small className=\"text-muted\">\n                      No se encontraron clientes con \"{clientSearch}\"\n                    </small>\n                  </div>\n                )}\n                {selectedClient && (\n                  <div className=\"mt-2 p-2 bg-light rounded\">\n                    <strong>Cliente seleccionado:</strong> {selectedClient.name}\n                    <br />\n                    <small className=\"text-muted\">\n                      RUC: {selectedClient.ruc} | Email: {selectedClient.email}\n                      {selectedClient.phone && ` | Tel: ${selectedClient.phone}`}\n                    </small>\n                  </div>\n                )}\n              </div>\n            </div>\n\n            {/* Campos del Cliente */}\n            <div className=\"row g-3\">\n              <div className=\"col-md-6\">\n                <label className=\"form-label\">Empresa</label>\n                <input \n                  className=\"form-control\" \n                  value={client.company_name} \n                  onChange={e => setClient({...client, company_name: e.target.value})} \n                  required \n                  placeholder=\"Nombre de la empresa\"\n                />\n              </div>\n              <div className=\"col-md-6\">\n                <label className=\"form-label\">R.U.C. *</label>\n                <input \n                  className=\"form-control\" \n                  value={client.ruc} \n                  onChange={e => setClient({...client, ruc: e.target.value})} \n                  placeholder=\"RUC de la empresa\"\n                  required\n                />\n              </div>\n              <div className=\"col-md-6\">\n                <label className=\"form-label\">Contacto</label>\n                <input \n                  className=\"form-control\" \n                  value={client.contact_name} \n                  onChange={e => setClient({...client, contact_name: e.target.value})} \n                  required \n                  placeholder=\"Nombre del contacto\"\n                />\n              </div>\n              <div className=\"col-md-6\">\n                <label className=\"form-label\">Tel√©fono</label>\n                <input \n                  className=\"form-control\" \n                  value={client.contact_phone} \n                  onChange={e => setClient({...client, contact_phone: e.target.value})} \n                  placeholder=\"Tel√©fono del contacto\"\n                />\n              </div>\n              <div className=\"col-md-12\">\n                <label className=\"form-label\">Correo</label>\n                <input \n                  type=\"email\" \n                  className=\"form-control\" \n                  value={client.contact_email} \n                  onChange={e => setClient({...client, contact_email: e.target.value})} \n                  placeholder=\"Correo del contacto\"\n                />\n              </div>\n            </div>\n          </div>\n        </div>\n\n        {/* Secci√≥n Proyecto */}\n        <div className=\"intelligent-section\">\n          <div className=\"section-header\">\n            <span className=\"section-icon\">üìÅ</span>\n            <h4>PROYECTO</h4>\n            <span className=\"section-status\">\n              {client.project_name ? '‚úÖ Proyecto configurado' : '‚è≥ Pendiente'}\n            </span>\n          </div>\n          <div className=\"section-content\">\n            <div className=\"row g-3\">\n              <div className=\"col-md-6\">\n                <label className=\"form-label\">Nombre del Proyecto</label>\n                <input \n                  className=\"form-control\" \n                  value={client.project_name} \n                  onChange={e => setClient({...client, project_name: e.target.value})} \n                  required \n                  placeholder=\"Nombre del proyecto\"\n                />\n              </div>\n              <div className=\"col-md-6\">\n                <label className=\"form-label\">Ubicaci√≥n</label>\n                <input \n                  className=\"form-control\" \n                  value={client.project_location} \n                  onChange={e => setClient({...client, project_location: e.target.value})} \n                  placeholder=\"Ubicaci√≥n del proyecto\"\n                />\n              </div>\n            </div>\n          </div>\n        </div>\n\n        {/* Secci√≥n Cotizaci√≥n */}\n        <div className=\"intelligent-section\">\n          <div className=\"section-header\">\n            <span className=\"section-icon\">üìã</span>\n            <h4>COTIZACI√ìN</h4>\n            <span className=\"section-status\">\n              {variantId ? '‚úÖ Variante seleccionada' : '‚è≥ Pendiente'}\n            </span>\n          </div>\n          <div className=\"section-content\">\n            <div className=\"row g-3\">\n              <div className=\"col-md-6\">\n                <label className=\"form-label\">Fecha de Solicitud</label>\n                <input \n                  type=\"date\" \n                  className=\"form-control\" \n                  value={quote.request_date} \n                  onChange={e => setQuote({...quote, request_date: e.target.value})} \n                />\n              </div>\n              <div className=\"col-md-6\">\n                <label className=\"form-label\">Fecha de Emisi√≥n</label>\n                <input \n                  type=\"date\" \n                  className=\"form-control\" \n                  value={quote.issue_date} \n                  onChange={e => setQuote({...quote, issue_date: e.target.value})} \n                />\n              </div>\n              <div className=\"col-md-6\">\n                <label className=\"form-label\">Comercial</label>\n                <input \n                  className=\"form-control\" \n                  value={quote.commercial_name} \n                  onChange={e => setQuote({...quote, commercial_name: e.target.value})} \n                  placeholder=\"Nombre del comercial\"\n                />\n              </div>\n              <div className=\"col-md-6\">\n                <label className=\"form-label\">Tel√©fono Comercial</label>\n                <input \n                  type=\"tel\" \n                  className=\"form-control\" \n                  value={quote.commercial_phone} \n                  onChange={e => setQuote({...quote, commercial_phone: e.target.value})} \n                  required \n                  placeholder=\"Tel√©fono del comercial\"\n                />\n              </div>\n              <div className=\"col-md-6\">\n                <label className=\"form-label\">Variante</label>\n                <select \n                  className=\"form-select\" \n                  value={variantId} \n                  onChange={e => setVariantId(e.target.value)}\n                >\n                  <option value=\"\">Seleccionar variante</option>\n                  {(variants || []).map(v => (\n                    <option key={v.id} value={v.id}>{v.code} - {v.title}</option>\n                  ))}\n                </select>\n              </div>\n              <div className=\"col-md-6\">\n                <label className=\"form-label\">Forma de Pago</label>\n                <select \n                  className=\"form-select\" \n                  value={quote.payment_terms} \n                  onChange={e => setQuote({...quote, payment_terms: e.target.value})}\n                >\n                  <option value=\"adelantado\">Adelantado</option>\n                  <option value=\"50%\">Adelanto 50% y saldo previo al informe</option>\n                  <option value=\"credito7\">Cr√©dito 7 d√≠as con OS</option>\n                  <option value=\"credito15\">Cr√©dito 15 d√≠as con OS</option>\n                  <option value=\"credito30\">Cr√©dito 30 d√≠as con OS</option>\n                </select>\n              </div>\n              <div className=\"col-md-6\">\n                <label className=\"form-label\">D√≠as H√°biles</label>\n                <input \n                  type=\"number\" \n                  className=\"form-control\" \n                  value={quote.delivery_days} \n                  onChange={e => setQuote({...quote, delivery_days: parseInt(e.target.value) || 4})} \n                  min=\"1\"\n                  max=\"30\"\n                />\n              </div>\n              <div className=\"col-md-6\">\n                <div className=\"form-check mt-4\">\n                  <input \n                    className=\"form-check-input\" \n                    type=\"checkbox\" \n                    id=\"igv\" \n                    checked={quote.igv} \n                    onChange={e => setQuote({...quote, igv: e.target.checked})}\n                  />\n                  <label className=\"form-check-label\" htmlFor=\"igv\">\n                    Aplicar IGV 18%\n                  </label>\n                </div>\n              </div>\n            </div>\n\n            {/* Referencia */}\n            <div className=\"mt-3\">\n              <label className=\"form-label\">Referencia</label>\n              <input \n                className=\"form-control\" \n                value={quote.reference} \n                onChange={e => setQuote({...quote, reference: e.target.value})} \n                placeholder=\"SEG√öN LO SOLICITADO V√çA CORREO ELECTR√ìNICO / LLAMADA TELEF√ìNICA\"\n              />\n            </div>\n\n            {/* Selector de Categor√≠a Principal */}\n            <div className=\"mt-4\">\n              <label className=\"form-label\">Categor√≠a Principal</label>\n              <div className=\"row g-3\">\n                <div className=\"col-md-6\">\n                  <div className=\"form-check\">\n                    <input \n                      className=\"form-check-input\" \n                      type=\"radio\" \n                      name=\"categoryMain\" \n                      id=\"laboratorio\" \n                      value=\"laboratorio\"\n                      checked={quote.category_main === 'laboratorio'}\n                      onChange={e => setQuote({...quote, category_main: e.target.value})}\n                    />\n                    <label className=\"form-check-label\" htmlFor=\"laboratorio\">\n                      üß™ Laboratorio\n                    </label>\n                  </div>\n                </div>\n                <div className=\"col-md-6\">\n                  <div className=\"form-check\">\n                    <input \n                      className=\"form-check-input\" \n                      type=\"radio\" \n                      name=\"categoryMain\" \n                      id=\"ingenieria\" \n                      value=\"ingenieria\"\n                      checked={quote.category_main === 'ingenieria'}\n                      onChange={e => setQuote({...quote, category_main: e.target.value})}\n                    />\n                    <label className=\"form-check-label\" htmlFor=\"ingenieria\">\n                      ‚öôÔ∏è Ingenier√≠a\n                    </label>\n                  </div>\n                </div>\n              </div>\n              <div className=\"alert alert-info mt-2\">\n                <small>\n                  <strong>üí° Importante:</strong> Selecciona la categor√≠a principal para que el sistema pueda categorizar autom√°ticamente los √≠tems y alimentar el embudo de ventas.\n                </small>\n              </div>\n            </div>\n\n            {/* Condiciones espec√≠ficas */}\n            <div className=\"mt-3\">\n              <label className=\"form-label\">Condiciones Espec√≠ficas</label>\n              <textarea\n                className=\"form-control\"\n                rows={4}\n                placeholder=\"Las condiciones se auto-completan seg√∫n la variante seleccionada\"\n                value={conditionsText}\n                onChange={e => setConditionsText(e.target.value)}\n              />\n            </div>\n\n            {/* √çtems */}\n            <div className=\"mt-4\">\n              <label className=\"form-label\">√çtems de la Cotizaci√≥n</label>\n              <div className=\"table-responsive\">\n                <table className=\"table table-bordered table-striped\">\n                  <thead className=\"table-dark\">\n                    <tr>\n                      <th style={{width: '10%'}}>C√≥digo</th>\n                      <th style={{width: '35%'}}>Descripci√≥n</th>\n                      <th style={{width: '15%'}}>Norma</th>\n                      <th style={{width: '12%'}}>Precio Unit.</th>\n                      <th style={{width: '10%'}}>Cantidad</th>\n                      <th style={{width: '12%'}}>Parcial</th>\n                      <th style={{width: '6%'}}></th>\n                    </tr>\n                  </thead>\n                  <tbody>\n                    {items.map((it, idx) => (\n                      <tr key={idx}>\n                        <td>\n                          <input \n                            className=\"form-control form-control-sm\" \n                            value={it.code} \n                            onChange={e => onChangeItem(idx, { code: e.target.value })}\n                            placeholder=\"C√≥digo\"\n                          />\n                        </td>\n                        <td>\n                          <SubserviceAutocomplete\n                            value={it.description}\n                            onChange={(value) => onChangeItem(idx, { description: value })}\n                            onSelect={(subservice) => {\n                              if (subservice) {\n                                onChangeItem(idx, {\n                                  code: subservice.codigo,\n                                  description: subservice.descripcion,\n                                  norm: subservice.norma,\n                                  unit_price: subservice.precio\n                                });\n                              }\n                            }}\n                            placeholder=\"Buscar servicio...\"\n                            size=\"sm\"\n                          />\n                        </td>\n                        <td>\n                          <input \n                            className=\"form-control form-control-sm\" \n                            value={it.norm} \n                            onChange={e => onChangeItem(idx, { norm: e.target.value })}\n                            placeholder=\"Norma\"\n                          />\n                        </td>\n                        <td>\n                          <input \n                            type=\"number\" \n                            step=\"0.01\" \n                            className=\"form-control form-control-sm\" \n                            value={it.unit_price} \n                            onChange={e => onChangeItem(idx, { unit_price: e.target.value })}\n                            placeholder=\"0.00\"\n                          />\n                        </td>\n                        <td>\n                          <input \n                            type=\"number\" \n                            className=\"form-control form-control-sm\" \n                            value={it.quantity} \n                            onChange={e => onChangeItem(idx, { quantity: e.target.value })}\n                            min=\"1\"\n                          />\n                        </td>\n                        <td>\n                          <span className=\"fw-bold text-success\">S/ {computePartial(it).toFixed(2)}</span>\n                        </td>\n                        <td>\n                          <button \n                            type=\"button\" \n                            className=\"btn btn-sm btn-outline-danger\" \n                            onClick={() => onRemoveItem(idx)} \n                            disabled={items.length === 1}\n                            title=\"Eliminar √≠tem\"\n                          >\n                            üóëÔ∏è\n                          </button>\n                        </td>\n                      </tr>\n                    ))}\n                  </tbody>\n                </table>\n              </div>\n              <div className=\"d-flex justify-content-between align-items-center mt-3\">\n                <button type=\"button\" className=\"btn btn-outline-primary\" onClick={onAddItem}>\n                  ‚ûï Agregar √≠tem\n                </button>\n                <div className=\"text-end\">\n                  <div className=\"h6 mb-1\">Subtotal: <span className=\"text-primary\">S/ {subtotal.toFixed(2)}</span></div>\n                  <div className=\"h6 mb-1\">IGV 18%: <span className=\"text-primary\">S/ {igvAmount.toFixed(2)}</span></div>\n                  <div className=\"h5 mb-0\">Total: <span className=\"text-success fw-bold\">S/ {total.toFixed(2)}</span></div>\n                </div>\n              </div>\n            </div>\n\n          </div>\n        </div>\n\n        {/* Botones de acci√≥n */}\n        <div className=\"intelligent-actions\">\n          <button \n            type=\"submit\" \n            className=\"btn btn-success btn-lg\"\n            disabled={saving || !client.company_name || !client.ruc}\n          >\n            {saving ? 'üíæ Guardando...' : 'üíæ GUARDAR COTIZACI√ìN'}\n          </button>\n          <button \n            type=\"button\" \n            className=\"btn btn-outline-primary btn-lg\"\n            onClick={() => window.print()}\n          >\n            üëÅÔ∏è Vista Previa\n          </button>\n          <button \n            type=\"button\" \n            className=\"btn btn-outline-warning btn-lg\"\n            onClick={exportDraft}\n            disabled={!lastSavedId}\n          >\n            üìÑ PDF Borrador\n          </button>\n        </div>\n      </form>\n    </ModuloBase>\n  );\n}\n"],"names":["emptyClient","emptyQuote","emptyItem","computePartial","item","u","q","generateQuoteCode","year","month","day","random","normalizeKey","s","VARIANT_TEXTS","getVariantText","v","t","entry","k","CotizacionInteligente","variants","setVariants","useState","variantId","setVariantId","client","setClient","selection","setSelection","quote","setQuote","items","setItems","saving","setSaving","error","setError","conditionsText","setConditionsText","lastSavedId","setLastSavedId","allProjects","setAllProjects","projectSuggestions","setProjectSuggestions","showProjectSuggestions","setShowProjectSuggestions","suggestedFileName","setSuggestedFileName","clients","setClients","filteredClients","setFilteredClients","clientSearch","setClientSearch","selectedClient","setSelectedClient","showClientDropdown","setShowClientDropdown","useEffect","fallback","projects","listProjects","e","prev","_a","_b","token","payload","x","c","extra","subtotal","useMemo","acc","it","igvAmount","total","onAddItem","onRemoveItem","idx","_","i","onChangeItem","patch","fetchClients","clientsData","listCompanies","clientsList","err","handleClientSearch","searchTerm","searchLower","filtered","nameMatch","rucMatch","emailMatch","phoneMatch","nameWordsMatch","word","match","handleClientSelect","handleClientClear","onSubmit","projectId","companyId","newCompany","getOrCreateCompany","newProject","createProject","quoteCode","_c","saved","createQuote","_d","exportDraft","id","base","path","url","response","blob","downloadUrl","link","ModuloBase","jsxs","jsx","clientItem","SubserviceAutocomplete","value","subservice"],"mappings":"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"}