{"version":3,"file":"HistorialTickets-ChPYLqUC.js","sources":["../../src/pages/HistorialTickets.jsx"],"sourcesContent":["import React from 'react';\r\nimport ModuloBase from '../components/ModuloBase';\r\nimport DataTable from '../components/DataTable';\r\nimport Toolbar from '../components/Toolbar';\r\nimport { useQuery } from 'react-query';\r\nimport { listTicketHistory, listTicketHistoryGlobal } from '../services/tickets';\r\n\r\nexport default function HistorialTickets() {\r\n  const [ticketId, setTicketId] = React.useState('');\r\n  const [q, setQ] = React.useState('');\r\n  const [action, setAction] = React.useState('');\r\n  const [range, setRange] = React.useState('30');\r\n  const [page, setPage] = React.useState(1);\r\n  const [limit] = React.useState(10);\r\n\r\n  const { data, isLoading } = useQuery(\r\n    ['ticket-history', { ticketId, page, limit, q, action, range }],\r\n    async () => {\r\n      if (ticketId) {\r\n        const resp = await listTicketHistory(ticketId, { page, limit });\r\n        const rows = Array.isArray(resp?.data) ? resp.data : (resp?.rows || resp || []);\r\n        const total = Number(resp?.total || rows.length || 0);\r\n        return { rows, total };\r\n      } else {\r\n        const resp = await listTicketHistoryGlobal({ page, limit, q, action, range });\r\n        const rows = Array.isArray(resp?.data) ? resp.data : (resp?.rows || resp || []);\r\n        const total = Number(resp?.total || rows.length || 0);\r\n        return { rows, total };\r\n      }\r\n    },\r\n    { keepPreviousData: true }\r\n  );\r\n\r\n  return (\r\n    <ModuloBase titulo=\"Historial de Tickets\" descripcion=\"Listado de cambios de estado y acciones sobre tickets.\">\r\n      <Toolbar\r\n        compact\r\n        left={(\r\n          <>\r\n            <input className=\"form-control\" style={{ minWidth: 160 }} placeholder=\"ID de ticket (opcional)\"\r\n                   value={ticketId} onChange={e=>{ setTicketId(e.target.value); setPage(1); }} />\r\n            {!ticketId && (\r\n              <>\r\n                <input className=\"form-control\" style={{ minWidth: 180 }} placeholder=\"Buscar (ticket/usuario)\" value={q} onChange={e=>{ setQ(e.target.value); setPage(1); }} />\r\n                <select className=\"form-select\" value={action} onChange={e=>{ setAction(e.target.value); setPage(1); }}>\r\n                  <option value=\"\">Todas las acciones</option>\r\n                  <option value=\"creado\">Creado</option>\r\n                  <option value=\"cambio\">Cambio</option>\r\n                  <option value=\"cambio a abierto\">Cambio a abierto</option>\r\n                  <option value=\"cambio a en_proceso\">Cambio a en_proceso</option>\r\n                  <option value=\"cambio a resuelto\">Cambio a resuelto</option>\r\n                  <option value=\"cambio a cerrado\">Cambio a cerrado</option>\r\n                </select>\r\n                <select className=\"form-select\" value={range} onChange={e=>{ setRange(e.target.value); setPage(1); }}>\r\n                  <option value=\"7\">Últimos 7 días</option>\r\n                  <option value=\"30\">Últimos 30 días</option>\r\n                  <option value=\"90\">Últimos 90 días</option>\r\n                  <option value=\"all\">Todo</option>\r\n                </select>\r\n              </>\r\n            )}\r\n            <div className=\"text-muted small d-flex align-items-center\">{data?.total || 0} eventos</div>\r\n          </>\r\n        )}\r\n        right={null}\r\n      />\r\n      <DataTable\r\n        columns={[\r\n          { header: 'ID', key: 'id', width: 80 },\r\n          { header: 'Ticket', key: 'ticket_id' },\r\n          { header: 'Acción', key: 'action' },\r\n          { header: 'Usuario', key: 'user_name', render: r => r.user_name || r.performed_by },\r\n          { header: 'Fecha', key: 'created_at', render: r => (r.created_at ? String(r.created_at).slice(0,19).replace('T',' ') : '—'), width: 160 },\r\n        ]}\r\n        rows={data?.rows || []}\r\n        loading={isLoading}\r\n      />\r\n      <div className=\"d-flex justify-content-between align-items-center mt-2\">\r\n        <div className=\"text-muted small\">Página {page}</div>\r\n        <div className=\"btn-group\">\r\n          <button className=\"btn btn-outline-secondary\" disabled={page<=1 || isLoading} onClick={()=>setPage(p=>Math.max(1,p-1))}>Anterior</button>\r\n          <button className=\"btn btn-outline-secondary\" disabled={(data?.rows?.length||0) < limit || isLoading} onClick={()=>setPage(p=>p+1)}>Siguiente</button>\r\n        </div>\r\n      </div>\r\n    </ModuloBase>\r\n  );\r\n}\r\n"],"names":["HistorialTickets","ticketId","setTicketId","React","q","setQ","action","setAction","range","setRange","page","setPage","limit","data","isLoading","useQuery","resp","listTicketHistory","rows","total","listTicketHistoryGlobal","jsxs","ModuloBase","jsx","Toolbar","Fragment","DataTable","r","p","_a"],"mappings":"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"}