import{r as t,j as e,B as c,_ as V,V as Q,A as _,Q as Z,a0 as $,m as v,C as E,I as H,b as L}from"./index-CDayYYh0.js";import{C as J,R as A}from"./Row-CeY1UBxE.js";import{C as d}from"./Col-Bcdl2XMD.js";import{F as i}from"./Form-CukTEVnv.js";import{I as R}from"./InputGroup-BfugZ8Gm.js";import{C as O}from"./Card-DxGUdTXm.js";import{T as q}from"./Table-DcOWcae_.js";import{S as K}from"./Spinner-BFSKMpy4.js";import"./ElementChildren-DjJrrPtR.js";const le=()=>{const[h,C]=t.useState([]),[U,b]=t.useState(!1),[x,I]=t.useState(""),[l,P]=t.useState({categoria:"",ubicacion:""}),[r,m]=t.useState({page:1,limit:50,total:0,pages:0}),[o,j]=t.useState([]),[W,T]=t.useState(!1),[w,g]=t.useState(!1),[p,N]=t.useState([]),k=["ENSAYO ESTÁNDAR SUELO","ENSAYOS ESPECIALES SUELO","ENSAYO QUÍMICO SUELO Y AGUA SUBTERRÁNEO","ENSAYOS DE CAMPO EN SUELO","ENSAYO AGREGADO","ENSAYO QUÍMICO AGREGADO","ENSAYO CONCRETO","ENSAYO ALBAÑILERÍA","ENSAYO ROCA","CEMENTO","ENSAYO PAVIMENTO","ENSAYO MEZCLA ASFÁLTICA","EVALUACIONES ESTRUCTURALES","OTROS SERVICIOS"],Y=["LABORATORIO","CAMPO"],S=async()=>{console.log("🔄 Iniciando carga de ensayos..."),b(!0);try{const s=new URLSearchParams({page:r.page,limit:r.limit,...x&&{search:x},...l.categoria&&{categoria:l.categoria},...l.ubicacion&&{ubicacion:l.ubicacion}});console.log("📡 Parámetros:",s.toString()),console.log("🌐 Llamando a API:",`/ensayos?${s}`);const a=await L(`/ensayos/temp?${s}`);console.log("✅ Respuesta de API:",a),C(a.data||[]),m(a.pagination||{page:1,limit:20,total:0,totalPages:1})}catch(s){console.error("❌ Error cargando ensayos:",s),C([])}finally{b(!1)}};t.useEffect(()=>{console.log("🚀 useEffect ejecutado - Cargando ensayos"),S()},[r.page,x,l]);const z=s=>{I(s.target.value),m(a=>({...a,page:1}))},f=(s,a)=>{P(n=>({...n,[s]:a})),m(n=>({...n,page:1}))},G=(s,a)=>{j(a?n=>[...n,s]:n=>n.filter(u=>u.codigo!==s.codigo))},M=s=>{j(s?h:[])},F=()=>{if(o.length===0){alert("Selecciona al menos un ensayo");return}N(o.map(s=>({codigo:s.codigo,precio:s.precio}))),g(!0)},B=async()=>{try{await L("/ensayos/precios/masivos",{method:"PUT",body:JSON.stringify({actualizaciones:p})}),alert("Precios actualizados exitosamente"),g(!1),N([]),S()}catch(s){console.error("Error:",s),alert("Error actualizando precios")}},D=s=>new Intl.NumberFormat("es-PE",{style:"currency",currency:"PEN"}).format(s),y=s=>({"ENSAYO ESTÁNDAR SUELO":"primary","ENSAYOS ESPECIALES SUELO":"warning","ENSAYO QUÍMICO SUELO Y AGUA SUBTERRÁNEO":"info","ENSAYOS DE CAMPO EN SUELO":"success","ENSAYO AGREGADO":"secondary","ENSAYO QUÍMICO AGREGADO":"dark","ENSAYO CONCRETO":"danger","ENSAYO ALBAÑILERÍA":"light","ENSAYO ROCA":"primary",CEMENTO:"warning","ENSAYO PAVIMENTO":"info","ENSAYO MEZCLA ASFÁLTICA":"success","EVALUACIONES ESTRUCTURALES":"secondary","OTROS SERVICIOS":"dark"})[s]||"light";return e.jsxs(J,{fluid:!0,className:"py-4",children:[e.jsx(A,{className:"mb-4",children:e.jsx(d,{children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"mb-1",children:"Lista de Precios - Ensayos"}),e.jsx("p",{className:"text-muted mb-0",children:"Gestiona los ensayos y sus precios"})]}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsxs(c,{variant:"outline-primary",size:"sm",children:[e.jsx(V,{className:"me-1"}),"Exportar"]}),e.jsxs(c,{variant:"outline-success",size:"sm",onClick:()=>T(!0),children:[e.jsx(Q,{className:"me-1"}),"Importar"]}),e.jsxs(c,{variant:"primary",size:"sm",onClick:S,children:[e.jsx(_,{className:"me-1"}),"Actualizar"]})]})]})})}),e.jsxs(A,{className:"mb-4",children:[e.jsx(d,{md:4,children:e.jsxs(i.Group,{children:[e.jsx(i.Label,{children:"Buscar"}),e.jsxs(R,{children:[e.jsx(R.Text,{children:e.jsx(Z,{})}),e.jsx(i.Control,{type:"text",placeholder:"Buscar por código o descripción...",value:x,onChange:z})]})]})}),e.jsx(d,{md:3,children:e.jsxs(i.Group,{children:[e.jsx(i.Label,{children:"Categoría"}),e.jsxs(i.Select,{value:l.categoria,onChange:s=>f("categoria",s.target.value),children:[e.jsx("option",{value:"",children:"Todas las categorías"}),k.map(s=>e.jsx("option",{value:s,children:s},s))]})]})}),e.jsx(d,{md:3,children:e.jsxs(i.Group,{children:[e.jsx(i.Label,{children:"Ubicación"}),e.jsxs(i.Select,{value:l.ubicacion,onChange:s=>f("ubicacion",s.target.value),children:[e.jsx("option",{value:"",children:"Todas las ubicaciones"}),Y.map(s=>e.jsx("option",{value:s,children:s},s))]})]})}),e.jsx(d,{md:2,children:e.jsxs(i.Group,{children:[e.jsx(i.Label,{children:" "}),e.jsx("div",{className:"d-flex gap-2",children:o.length>0&&e.jsxs(c,{variant:"warning",size:"sm",onClick:F,children:[e.jsx($,{className:"me-1"}),"Actualizar Precios (",o.length,")"]})})]})})]}),e.jsxs(O,{className:"shadow-sm",children:[e.jsx(O.Header,{className:"bg-white border-bottom",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("h6",{className:"mb-0",children:[e.jsx(v,{className:"me-1 text-primary"}),"Lista de Ensayos"]}),e.jsxs(E,{bg:"light",text:"dark",className:"px-2 py-1",children:[r.total," ensayos"]})]})}),e.jsx(O.Body,{className:"p-0",children:e.jsx("div",{className:"table-responsive",children:e.jsxs(q,{hover:!0,className:"mb-0",children:[e.jsx("thead",{className:"table-light",children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:"50px"},children:e.jsx(i.Check,{type:"checkbox",checked:o.length===h.length&&h.length>0,onChange:s=>M(s.target.checked)})}),e.jsx("th",{children:"Código"}),e.jsx("th",{children:"Descripción"}),e.jsx("th",{children:"Norma"}),e.jsx("th",{children:"Ubicación"}),e.jsx("th",{children:"Precio"}),e.jsx("th",{children:"Categoría"}),e.jsx("th",{children:"Acciones"})]})}),e.jsx("tbody",{children:U?e.jsx("tr",{children:e.jsxs("td",{colSpan:8,className:"text-center py-4",children:[e.jsx(K,{animation:"border",size:"sm",className:"me-2"}),"Cargando ensayos..."]})}):h.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"text-center py-4 text-muted",children:"No se encontraron ensayos"})}):h.map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx(i.Check,{type:"checkbox",checked:o.some(a=>a.codigo===s.codigo),onChange:a=>G(s,a.target.checked)})}),e.jsx("td",{children:e.jsx(E,{bg:"primary",className:"font-monospace",children:s.codigo})}),e.jsx("td",{children:e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"fw-medium",children:s.descripcion}),s.comentarios&&e.jsxs("small",{className:"text-muted d-block mt-1",children:[s.comentarios.substring(0,80),"..."]})]})}),e.jsx("td",{children:e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"fw-medium",children:s.norma}),s.referencia_otra_norma&&e.jsx("small",{className:"text-muted d-block",children:s.referencia_otra_norma})]})}),e.jsx("td",{children:e.jsx(E,{bg:s.ubicacion==="LABORATORIO"?"info":"success",children:s.ubicacion})}),e.jsx("td",{children:e.jsx("div",{className:"fw-bold text-success",children:D(s.precio)})}),e.jsx("td",{children:e.jsx(E,{bg:y(s.categoria),text:y(s.categoria)==="light"?"dark":void 0,children:s.categoria})}),e.jsx("td",{children:e.jsxs("div",{className:"d-flex gap-1",children:[e.jsx(c,{variant:"outline-primary",size:"sm",children:e.jsx(v,{})}),e.jsx(c,{variant:"outline-warning",size:"sm",children:e.jsx(H,{})})]})})]},s.id))})]})})})]}),r.pages>1&&e.jsx(A,{className:"mt-3",children:e.jsx(d,{children:e.jsx("div",{className:"d-flex justify-content-center",children:e.jsxs("div",{className:"btn-group",children:[e.jsx(c,{variant:"outline-secondary",size:"sm",disabled:r.page===1,onClick:()=>m(s=>({...s,page:s.page-1})),children:"Anterior"}),e.jsxs(c,{variant:"outline-secondary",size:"sm",disabled:!0,children:["Página ",r.page," de ",r.pages]}),e.jsx(c,{variant:"outline-secondary",size:"sm",disabled:r.page===r.pages,onClick:()=>m(s=>({...s,page:s.page+1})),children:"Siguiente"})]})})})}),w&&e.jsx("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.5)"},children:e.jsx("div",{className:"modal-dialog",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h5",{className:"modal-title",children:"Actualizar Precios"}),e.jsx(c,{variant:"close",onClick:()=>g(!1)})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("p",{children:["Actualizando precios para ",p.length," ensayos..."]}),p.map((s,a)=>e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[e.jsx("span",{children:s.codigo}),e.jsx(i.Control,{type:"number",value:s.precio,onChange:n=>{const u=[...p];u[a].precio=parseFloat(n.target.value),N(u)},style:{width:"120px"}})]},a))]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx(c,{variant:"secondary",onClick:()=>g(!1),children:"Cancelar"}),e.jsx(c,{variant:"primary",onClick:B,children:"Guardar Cambios"})]})]})})})]})};export{le as default};
//# sourceMappingURL=EnsayosList-wGnOxQco.js.map
