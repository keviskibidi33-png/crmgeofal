import{r,Q as w,c as B,R as u,j as e,U as L,f as x,B as _,V as H,h as y,x as h,L as C,y as N,Y as Q,Z as k}from"./index-B6K4MeZ_.js";import{P as A,R as G,C as o}from"./PageHeader-ZaYSeG4B.js";import{D as V}from"./DataTable-DtW7TOza.js";import{M as Y}from"./ModalForm-DoSAJory.js";import{S as c}from"./StatsCard-BQEilZ7W.js";import{d as Z,c as $,u as J,l as K}from"./companies-DH28II_N.js";import{C as g}from"./Card-C3FyhA6L.js";import"./InputGroup-B3UJk0zl.js";import"./Form-DajNugM3.js";import"./Spinner-Cd5nug_F.js";const b={type:"empresa",ruc:"",dni:"",name:"",address:"",email:"",phone:"",contact_name:""};function oe(){const[v,i]=r.useState(!1),[t,m]=r.useState(null),[O,E]=r.useState(null),S=w(),{data:l,isLoading:M}=B(["clients"],()=>K(),{keepPreviousData:!0}),d=s=>{S.invalidateQueries("clients"),i(!1),m(null),E(null)},j=u($,{onSuccess:()=>d(),onError:s=>console.error("Error creating client:",s)}),f=u(J,{onSuccess:()=>d(),onError:s=>console.error("Error updating client:",s)}),D=u(Z,{onSuccess:()=>d(),onError:s=>console.error("Error deleting client:",s)}),F=()=>{m(b),i(!0)},I=s=>{m(s),i(!0)},P=s=>{window.confirm(`¿Estás seguro de que quieres eliminar el cliente "${s.name}"?`)&&D.mutate(s.id)},R=async s=>{t.id?await f.mutateAsync({id:t.id,...s}):await j.mutateAsync(s)},z=s=>{const p={empresa:{bg:"primary",text:"Empresa",icon:y},persona:{bg:"info",text:"Persona Natural",icon:h}}[s]||{bg:"secondary",text:s,icon:h},q=p.icon;return e.jsxs(N,{bg:p.bg,className:"status-badge d-flex align-items-center",children:[e.jsx(q,{size:12,className:"me-1"}),p.text]})},T=[{header:"ID",accessor:"id",width:"80px"},{header:"Cliente",accessor:"name",render:(s,a)=>e.jsxs("div",{children:[e.jsx("div",{className:"fw-medium",children:a.name}),e.jsxs("div",{className:"d-flex align-items-center gap-2 mt-1",children:[z(a.type),a.ruc&&e.jsxs("small",{className:"text-muted",children:["RUC: ",a.ruc]}),a.dni&&e.jsxs("small",{className:"text-muted",children:["DNI: ",a.dni]})]})]})},{header:"Contacto",accessor:"contact",render:(s,a)=>e.jsxs("div",{children:[a.contact_name&&e.jsx("div",{className:"fw-medium",children:a.contact_name}),a.email&&e.jsxs("div",{className:"d-flex align-items-center mt-1",children:[e.jsx(C,{size:12,className:"me-1 text-muted"}),e.jsx("small",{className:"text-muted",children:a.email})]}),a.phone&&e.jsxs("div",{className:"d-flex align-items-center mt-1",children:[e.jsx(Q,{size:12,className:"me-1 text-muted"}),e.jsx("small",{className:"text-muted",children:a.phone})]})]})},{header:"Dirección",accessor:"address",render:s=>s?e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx(k,{size:12,className:"me-1 text-muted"}),e.jsx("small",{className:"text-muted",children:s})]}):e.jsx("small",{className:"text-muted",children:"Sin dirección"})},{header:"Fecha Registro",accessor:"created_at",type:"date"}],U=[{name:"type",label:"Tipo de Cliente",type:"select",required:!0,options:[{value:"empresa",label:"Empresa"},{value:"persona",label:"Persona Natural"}]},{name:"name",label:"Nombre/Razón Social",type:"text",required:!0,placeholder:"Ingresa el nombre o razón social"},{name:"ruc",label:"RUC",type:"text",placeholder:"Ingresa el RUC (solo para empresas)",help:"Solo para empresas"},{name:"dni",label:"DNI",type:"text",placeholder:"Ingresa el DNI (solo para personas)",help:"Solo para personas naturales"},{name:"contact_name",label:"Nombre de Contacto",type:"text",placeholder:"Ingresa el nombre del contacto"},{name:"email",label:"Email",type:"email",placeholder:"contacto@empresa.com"},{name:"phone",label:"Teléfono",type:"text",placeholder:"+51 999 999 999"},{name:"address",label:"Dirección",type:"textarea",placeholder:"Ingresa la dirección completa"}],n=r.useMemo(()=>{const s=(l==null?void 0:l.companies)||[];return{total:s.length,empresas:s.filter(a=>a.type==="empresa").length,personas:s.filter(a=>a.type==="persona").length,conEmail:s.filter(a=>a.email).length,conTelefono:s.filter(a=>a.phone).length}},[l]);return e.jsx(L,{fluid:!0,className:"py-4",children:e.jsxs("div",{className:"fade-in",children:[e.jsx(A,{title:"Gestión de Clientes",subtitle:"Crear, editar y gestionar clientes del sistema",icon:x,actions:e.jsxs(_,{variant:"primary",onClick:F,children:[e.jsx(H,{className:"me-2"}),"Nuevo Cliente"]})}),e.jsxs(G,{className:"g-4 mb-4",children:[e.jsx(o,{md:6,lg:3,children:e.jsx(c,{title:"Total Clientes",value:n.total,icon:x,color:"primary",subtitle:"Clientes registrados"})}),e.jsx(o,{md:6,lg:3,children:e.jsx(c,{title:"Empresas",value:n.empresas,icon:y,color:"success",subtitle:"Clientes corporativos"})}),e.jsx(o,{md:6,lg:3,children:e.jsx(c,{title:"Personas",value:n.personas,icon:h,color:"info",subtitle:"Clientes individuales"})}),e.jsx(o,{md:6,lg:3,children:e.jsx(c,{title:"Con Contacto",value:n.conEmail,icon:C,color:"warning",subtitle:"Con email registrado"})})]}),e.jsxs(g,{className:"shadow-sm border-0",children:[e.jsx(g.Header,{className:"bg-white border-bottom",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("h5",{className:"mb-0",children:[e.jsx(x,{className:"me-2 text-primary"}),"Lista de Clientes"]}),e.jsxs(N,{bg:"light",text:"dark",className:"px-3 py-2",children:[n.total," clientes"]})]})}),e.jsx(g.Body,{className:"p-0",children:e.jsx(V,{data:(l==null?void 0:l.companies)||[],columns:T,loading:M,onEdit:I,onDelete:P,emptyMessage:"No hay clientes registrados"})})]}),e.jsx(Y,{show:v,onHide:()=>i(!1),title:t!=null&&t.id?"Editar Cliente":"Nuevo Cliente",data:t||b,fields:U,onSubmit:R,loading:j.isLoading||f.isLoading,submitText:t!=null&&t.id?"Actualizar":"Crear"})]})})}export{oe as default};
//# sourceMappingURL=Clientes-CKdiExsN.js.map
