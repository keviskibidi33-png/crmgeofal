import{b as w,R as u,e as k,j as e}from"./index-CDayYYh0.js";import{M as E}from"./ModuloBase-BzOcH9cf.js";import{D as N}from"./DataTable-C9sD-KoM.js";import{T as C}from"./TableEmpty-DpVg9MUO.js";async function S({type:o="leads"}={}){const n="https://sublustrous-odelia-uninsured.ngrok-free.dev/api".replace(/\/$/,""),s="/api/export/excel?type="+encodeURIComponent(o),i=n?n+s:s,r=localStorage.getItem("token"),l=await fetch(i,{method:"GET",headers:r?{Authorization:`Bearer ${r}`}:{}});if(!l.ok)throw new Error("No se pudo exportar Excel");const c=await l.blob(),a=document.createElement("a");a.href=URL.createObjectURL(c),a.download=`reporte_${o}.xlsx`,document.body.appendChild(a),a.click(),a.remove()}async function D({type:o="leads"}={}){const n="https://sublustrous-odelia-uninsured.ngrok-free.dev/api".replace(/\/$/,""),s="/api/export/pdf?type="+encodeURIComponent(o),i=n?n+s:s,r=localStorage.getItem("token"),l=await fetch(i,{method:"GET",headers:r?{Authorization:`Bearer ${r}`}:{}});if(!l.ok)throw new Error("No se pudo exportar PDF");const c=await l.blob(),a=document.createElement("a");a.href=URL.createObjectURL(c),a.download=`reporte_${o}.pdf`,document.body.appendChild(a),a.click(),a.remove()}const R=(o={})=>{const n=new URLSearchParams;o.page&&n.set("page",o.page),o.limit&&n.set("limit",o.limit),o.q&&n.set("q",o.q),o.type&&n.set("type",o.type),o.range&&n.set("range",o.range);const s=n.toString();return w("/api/export/history"+(s?`?${s}`:""))};function L(){const[o,n]=u.useState(""),[s,i]=u.useState(""),[r,l]=u.useState("30"),[c,a]=u.useState(!1),[h,p]=u.useState(1),[x]=u.useState(10),{data:d,isLoading:m}=k(["export-history",{page:h,limit:x,q:o,type:s,range:r}],async()=>{const t=await R({page:h,limit:x,q:o,type:s,range:r}),f=Array.isArray(t==null?void 0:t.data)?t.data:(t==null?void 0:t.rows)||t||[],v=Number((t==null?void 0:t.total)||f.length||0);return{rows:f,total:v}},{keepPreviousData:!0}),y=(d==null?void 0:d.rows)||[],g=(d==null?void 0:d.total)||0,b=Math.max(1,Math.ceil(g/x)),j=()=>{n(""),i(""),l("30"),p(1)};return e.jsxs(E,{titulo:"Exportaciones",descripcion:"Historial de exportaciones realizadas (PDF/Excel/CSV).",children:[e.jsx(C,{compact:!0,left:e.jsxs(e.Fragment,{children:[e.jsx("input",{className:"form-control",style:{minWidth:220},placeholder:"Buscar por recurso o usuario",value:o,onChange:t=>n(t.target.value)}),e.jsxs("select",{className:"form-select",value:s,onChange:t=>i(t.target.value),children:[e.jsx("option",{value:"",children:"Todos los tipos"}),e.jsx("option",{value:"pdf",children:"PDF"}),e.jsx("option",{value:"xlsx",children:"Excel"}),e.jsx("option",{value:"csv",children:"CSV"})]}),e.jsxs("select",{className:"form-select",value:r,onChange:t=>l(t.target.value),children:[e.jsx("option",{value:"7",children:"Últimos 7 días"}),e.jsx("option",{value:"30",children:"Últimos 30 días"}),e.jsx("option",{value:"90",children:"Últimos 90 días"}),e.jsx("option",{value:"all",children:"Todo"})]})]}),right:e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"btn btn-outline-secondary",onClick:j,children:"Limpiar"}),e.jsx("div",{className:"vr mx-2"}),e.jsx("button",{className:"btn btn-success",disabled:!s||c,onClick:async()=>{try{a(!0),await S({type:s})}finally{a(!1)}},children:c?"Descargando...":"Exportar Excel"}),e.jsx("button",{className:"btn btn-danger",disabled:!s||c,onClick:async()=>{try{a(!0),await D({type:s})}finally{a(!1)}},children:c?"Descargando...":"Exportar PDF"})]})}),e.jsx(N,{columns:[{header:"ID",key:"id",width:80},{header:"Tipo",key:"type"},{header:"Recurso",key:"resource"},{header:"Fecha",key:"created_at",render:t=>t.created_at?String(t.created_at).slice(0,19).replace("T"," "):"—",width:160},{header:"Usuario",key:"user_name"}],rows:y,loading:m}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center mt-2",children:[e.jsxs("div",{className:"text-muted small",children:["Total: ",g]}),e.jsxs("div",{className:"btn-group",children:[e.jsx("button",{className:"btn btn-outline-secondary",disabled:h<=1||m,onClick:()=>p(t=>Math.max(1,t-1)),children:"Anterior"}),e.jsxs("span",{className:"btn btn-outline-secondary disabled",children:[h,"/",b]}),e.jsx("button",{className:"btn btn-outline-secondary",disabled:h>=b||m,onClick:()=>p(t=>Math.min(b,t+1)),children:"Siguiente"})]})]})]})}export{L as default};
//# sourceMappingURL=Exportaciones-B6izoFFK.js.map
