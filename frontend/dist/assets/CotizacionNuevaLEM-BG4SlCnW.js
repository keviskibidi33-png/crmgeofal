import{r,j as e}from"./index-xQVByYRi.js";import{M as re}from"./ModuloBase-uxYeg0t6.js";import{c as ce}from"./quotes-B0lnb_TG.js";import{l as le}from"./projects-B4CBwGKg.js";import{C as ie}from"./CompanyProjectPicker-CvG8aMI1.js";import{S as de}from"./SubserviceAutocomplete-BNw3rrJ6.js";/* empty css                     */import"./companies-P0mPl86d.js";import"./subservices-BpjbwGE9.js";import"./Form-BAZkilfb.js";import"./ElementChildren-BP-7Da5j.js";import"./Col-Dz9zKzWQ.js";import"./Spinner-C2jXaFYJ.js";const me={company_name:"",ruc:"",contact_name:"",contact_phone:"",contact_email:"",project_location:"",project_name:""},ue={request_date:"",issue_date:"",commercial_name:"",commercial_phone:"",payment_terms:"adelantado",reference:"",reference_type:["email","phone"],igv:!0,delivery_days:4},Z={code:"",description:"",norm:"",unit_price:0,quantity:1};function H(h){const f=Number(h.unit_price||0),p=Number(h.quantity||0);return Number((f*p).toFixed(2))}const j=(h="")=>(h||"").normalize("NFD").replace(/[\u0300-\u036f]/g,"").toUpperCase().trim(),P={[j("MUESTRA DE SUELO Y AGREGADO")]:`CONDICIONES ESPECÍFICAS:
- El cliente debe enviar al laboratorio, para los ensayo en suelo y agregados, la cantidad minima de 100 kg por cada muestra.
- El cliente deberá de entregar las muestras debidamente identificadas.
- El cliente deberá especificar la Norma a ser utilizada para la ejecución del ensayo, caso contrario se considera Norma ASTM o NTP vigente de acuerdo con el alcance del laboratorio.
- El cliente deberá entregar las muestras en las instalaciones del LEM, ubicado en la Av. Marañón N° 763, Los Olivos, Lima.`,[j("PROBETAS")]:`CONDICIONES ESPECÍFICAS:
- El cliente debe proporcionar las probetas antes del ingreso a obra.
- El cliente deberá de entregar las muestras debidamente identificadas.
- El cliente deberá especificar la Norma a ser utilizada para la ejecución del ensayo, caso contrario se considera Norma ASTM o NTP vigente de acuerdo con el alcance del laboratorio.
- El cliente deberá entregar las muestras en las instalaciones del LEM, ubicado en la Av. Marañón N° 763, Los Olivos, Lima.`,[j("DENSIDAD DE CAMPO Y MUESTREO")]:`CONDICIONES ESPECÍFICAS:
- El cliente deberá enviar al laboratorio, para los ensayo en suelo y agregados, la cantidad minima de 100 kg por cada muestra.
- Para el ensayo de Densidad de campo, la cantidad de puntos/salida minimo 4 und.
- El cliente deberá de programar el servicio, Densidad de campo, con 24 horas de anticipación.
- El cliente deberá especificar la Norma a ser utilizada para la ejecución del ensayo, caso contrario se considera Norma ASTM o NTP vigente de acuerdo con el alcance del laboratorio.
- El cliente deberá entregar las muestras en las instalaciones del LEM, ubicado en la Av. Marañón N° 763, Los Olivos, Lima.`,[j("EXTRACCIÓN DE DIAMANTINA")]:`CONDICIONES ESPECÍFICAS:
- Movilización y desmovilización de equipos y del personal técnico, estara a cargo de GEOFAL.
- Resane de estructura de concreto con sika rep 500 y Sikadur 32, estara a cargo de GEOFAL.
- El servicio no incluye trabajos de acabados como pintura, mayolica y otros.
- El area de trabajo, zona de extracción de diamantina, tiene que estar libre de interferencia.
- La extracción de diamantina se realizara en 2 dia en campo, en laboratorio se realizará el tallado y refrentado de diamantina, el ensayo de resistencia a la compresión de testigo de diamantina se realizara en 5 dias (el tiempo de ensayo obedece a la normativa vigente).
- Costo de resane insumos 250 soles, este costo se distribuira de acuerdo con el numero de perforaciones Donde se hara las extracciones de diamantina`,[j("DIAMANTINA PARA PASES")]:`CONDICIONES ESPECÍFICAS:
- El cliente deberá de programar el servicio, Extracción diamantina, con 24 horas de anticipación.
- El area de trabajo, zona de extraccion de diamantina, debera estar libre de interferencia.
- Para extraer la diamantina, se ubicara el acero con un escaneador.
- Movilizacion y desmovilizacion de equipos y del personal tecnico, estara a cargo de Geofal.`,[j("ALBAÑILERÍA")]:`CONDICIONES ESPECÍFICAS:
- El cliente deberá enviar al laboratorio, 20 ladrillo de cada tipo, en buen estado y sin presentar fisuras.
- El cliente deberá de entregar las muestras debidamente identificadas.
- El cliente deberá especificar la Norma a ser utilizada para la ejecución del ensayo, caso contrario se considera Norma ASTM o NTP vigente de acuerdo con el alcance del laboratorio.
- El cliente deberá entregar las muestras en las instalaciones del LEM, ubicado en la Av. Marañón N° 763, Los Olivos, Lima`,[j("VIGA BECKELMAN")]:`CONDICIONES ESPECÍFICAS:
- El cliente deberá de programar el servicio, Ensayo de Deflexión, con 24 horas de anticipación.
- El area de trabajo tiene que estar habilitado.
- El cliente deberá especificar la Norma a ser utilizada para la ejecución del ensayo, caso contrario se considera Norma ASTM o NTP o MTC vigente de acuerdo con el alcance del laboratorio.
- Especificar las caracteristicas del camion`,[j("CONTROL DE CALIDAD DE CONCRETO FRESCO EN OBRA")]:`CONDICIONES ESPECÍFICAS:
- El cliente deberá de programar el servicio, con 24 horas de anticipación.
- Para el ensayo de control de calidad de concreto fresco en obra, se moldeara 6 probetas, ensayo slump, control de temperatura, en laboratorio las probetas se colocara en camara de curado, el ensayo de compresión de las probetas seran 3 a 7 dias y 3 a 28 dias.
- El control de calidad del concreto fresco se sacara cada 50m3 a uno de los mixer donde se hara todos los ensayos respectivos mencionados, o por dia asi no se halla llegado los 50m3.
- El cliente deberá especificar la Norma a ser utilizada para la ejecución del ensayo, caso contrario se considera Norma ASTM o NTP vigente de acuerdo con el alcance del laboratorio.`},d=h=>{const f=j((h==null?void 0:h.title)||"");if(P[f])return P[f];const p=Object.entries(P).find(([S])=>f.includes(S)||S.includes(f));return p?p[1]:""};function Ie(){var X,J,Q;const[h,f]=r.useState([]),[p,S]=r.useState(""),[l,v]=r.useState(me),[c,ee]=r.useState({company_id:null,project_id:null,company:null,project:null}),[o,m]=r.useState(ue),[u,C]=r.useState([{...Z}]),[D,k]=r.useState(!1),[w,z]=r.useState(""),[V,I]=r.useState(""),[b,T]=r.useState(1),[$,ae]=r.useState(null),[te,ne]=r.useState(!1),[pe,F]=r.useState([]),[he,U]=r.useState([]),[be,Ne]=r.useState(!1),[G,R]=r.useState(""),q=[{value:"email",label:"📧 Correo electrónico",icon:"📧"},{value:"phone",label:"📞 Llamada telefónica",icon:"📞"},{value:"ticket",label:"🎯 Sistema de tickets",icon:"🎯"},{value:"meeting",label:"🤝 Reunión presencial",icon:"🤝"},{value:"form",label:"📋 Formulario web",icon:"📋"},{value:"referral",label:"👥 Referido",icon:"👥"},{value:"other",label:"📝 Otro",icon:"📝"}];r.useEffect(()=>{(async()=>{try{const t=[]||[];if(t.length>0)f(t);else{const n=[{id:"V1",code:"V1",title:"MUESTRA DE SUELO Y AGREGADO",description:d({title:"MUESTRA DE SUELO Y AGREGADO"})},{id:"V2",code:"V2",title:"PROBETAS",description:d({title:"PROBETAS"})},{id:"V3",code:"V3",title:"DENSIDAD DE CAMPO Y MUESTREO",description:d({title:"DENSIDAD DE CAMPO Y MUESTREO"})},{id:"V4",code:"V4",title:"EXTRACCIÓN DE DIAMANTINA",description:d({title:"EXTRACCIÓN DE DIAMANTINA"})},{id:"V5",code:"V5",title:"DIAMANTINA PARA PASES",description:d({title:"DIAMANTINA PARA PASES"})},{id:"V6",code:"V6",title:"ALBAÑILERÍA",description:d({title:"ALBAÑILERÍA"})},{id:"V7",code:"V7",title:"VIGA BECKELMAN",description:d({title:"VIGA BECKELMAN"})},{id:"V8",code:"V8",title:"CONTROL DE CALIDAD DE CONCRETO FRESCO EN OBRA",description:d({title:"CONTROL DE CALIDAD DE CONCRETO FRESCO EN OBRA"})}];f(n)}}catch{f([{id:"V1",code:"V1",title:"MUESTRA DE SUELO Y AGREGADO",description:d({title:"MUESTRA DE SUELO Y AGREGADO"})},{id:"V2",code:"V2",title:"PROBETAS",description:d({title:"PROBETAS"})},{id:"V3",code:"V3",title:"DENSIDAD DE CAMPO Y MUESTREO",description:d({title:"DENSIDAD DE CAMPO Y MUESTREO"})},{id:"V4",code:"V4",title:"EXTRACCIÓN DE DIAMANTINA",description:d({title:"EXTRACCIÓN DE DIAMANTINA"})},{id:"V5",code:"V5",title:"DIAMANTINA PARA PASES",description:d({title:"DIAMANTINA PARA PASES"})},{id:"V6",code:"V6",title:"ALBAÑILERÍA",description:d({title:"ALBAÑILERÍA"})},{id:"V7",code:"V7",title:"VIGA BECKELMAN",description:d({title:"VIGA BECKELMAN"})},{id:"V8",code:"V8",title:"CONTROL DE CALIDAD DE CONCRETO FRESCO EN OBRA",description:d({title:"CONTROL DE CALIDAD DE CONCRETO FRESCO EN OBRA"})}])}})()},[]),r.useEffect(()=>{(async()=>{try{const t=(await le({page:1,limit:100})).data||[];F(t),U(t)}catch(a){console.warn("No se pudieron cargar proyectos existentes:",a),F([]),U([])}})()},[]),r.useEffect(()=>{const a=()=>{const s=document.querySelector(".sidebar");s&&ne(s.classList.contains("collapsed"))};a();const t=new MutationObserver(a),n=document.querySelector(".sidebar");return n&&t.observe(n,{attributes:!0,attributeFilter:["class"]}),()=>t.disconnect()},[]),r.useEffect(()=>{c.company&&v(a=>{var t,n;return{...a,company_name:c.company.name||a.company_name,ruc:c.company.ruc||a.ruc,contact_name:c.company.contact_name||a.contact_name,contact_phone:c.company.phone||a.contact_phone,contact_email:c.company.email||a.contact_email,project_location:((t=c.project)==null?void 0:t.location)||a.project_location,project_name:((n=c.project)==null?void 0:n.name)||a.project_name}})},[c.company,c.project]),r.useEffect(()=>{const a=localStorage.getItem("token");if(a)try{const t=JSON.parse(atob(a.split(".")[1]));t.name&&m(n=>({...n,commercial_name:t.name,commercial_phone:t.phone||""}))}catch(t){console.warn("No se pudo decodificar el token:",t)}},[]),r.useEffect(()=>{if(l.company_name){const a=L();R(a)}},[l.company_name]),r.useEffect(()=>{if(o.reference_type&&o.reference_type.length>0){const a=M(o.reference_type);m(t=>({...t,reference:a}))}},[o.reference_type]),r.useEffect(()=>{if(o.reference_type&&o.reference_type.length>0&&!o.reference){const a=M(o.reference_type);m(t=>({...t,reference:a}))}},[]);const L=()=>{const a=new Date().getFullYear(),t=String(new Date().getMonth()+1).padStart(2,"0"),n=String(new Date().getDate()).padStart(2,"0"),s=`COT-${a}-${t}${n}-${String(Math.floor(Math.random()*1e3)).padStart(3,"0")}`,N=(l.company_name||"CLIENTE").replace(/[^a-zA-Z0-9\s]/g,"").replace(/\s+/g,"_").toUpperCase().substring(0,30);return`${s} LEM-GEOFAL-${N}`},M=a=>{if(!a||a.length===0)return"SEGÚN LO SOLICITADO";const t=a.map(n=>{const s=q.find(i=>i.value===n);return s?s.label.replace(/^[^\s]+\s/,""):n});if(t.length===1)return`SEGÚN LO SOLICITADO VÍA ${t[0].toUpperCase()}`;if(t.length===2)return`SEGÚN LO SOLICITADO VÍA ${t[0].toUpperCase()} / ${t[1].toUpperCase()}`;{const n=t.pop();return`SEGÚN LO SOLICITADO VÍA ${t.join(", ").toUpperCase()} Y ${n.toUpperCase()}`}},g=r.useMemo(()=>u.reduce((a,t)=>a+H(t),0),[u]),A=r.useMemo(()=>o.igv?Number((g*.18).toFixed(2)):0,[g,o.igv]),B=r.useMemo(()=>Number((g+A).toFixed(2)),[g,A]),oe=()=>C([...u,{...Z}]),se=a=>C(u.filter((t,n)=>n!==a)),y=(a,t)=>C(u.map((n,s)=>s===a?{...n,...t}:n));r.useEffect(()=>{if(!p)return;const a=(h||[]).find(s=>String(s.id)===String(p));if(!a)return;const t=a.conditions||{};m(s=>({...s,payment_terms:t.default_payment_terms||s.payment_terms,igv:typeof t.default_igv=="boolean"?t.default_igv:s.igv,reference:t.default_reference||s.reference}));const n=d(a)||a.description||"";if(n&&I(n),Array.isArray(t.default_items)&&u.length<=1&&!u[0].code&&!u[0].description&&!u[0].norm){const s=t.default_items.map(i=>({code:i.code||"",description:i.description||"",norm:i.norm||"",unit_price:Number(i.unit_price||0),quantity:Number(i.quantity||1)}));s.length&&C(s)}},[p]);const Y=async a=>{var t;a.preventDefault(),k(!0),z("");try{console.log("🔍 onSubmit - Iniciando creación de cotización..."),console.log("🔍 onSubmit - Selection:",c),console.log("🔍 onSubmit - Client:",l),console.log("🔍 onSubmit - Quote:",o);const n=((t=c.project)==null?void 0:t.id)||c.project_id;if(!n)throw new Error("Debe seleccionar un proyecto para crear la cotización");console.log("🔍 onSubmit - Project ID validado:",n);const s={project_id:n,variant_id:p||null,client_contact:l.contact_name,client_email:l.contact_email,client_phone:l.contact_phone,issue_date:o.issue_date||new Date().toISOString().slice(0,10),subtotal:g,igv:A,total:B,status:"borrador",reference:o.reference,reference_type:JSON.stringify(o.reference_type),meta:JSON.stringify({customer:l,quote:{...o,delivery_days:o.delivery_days||4},conditions_text:V,payment_terms:o.payment_terms,file_name:G||L()})};console.log("🔍 onSubmit - Payload:",s),console.log("🔍 onSubmit - Meta type:",typeof s.meta),console.log("🔍 onSubmit - Reference Type type:",typeof s.reference_type),console.log("🔍 onSubmit - Meta content:",s.meta),console.log("🔍 onSubmit - Reference Type content:",s.reference_type);const i=await ce(s);console.log("✅ onSubmit - Cotización creada:",i),console.log("📋 Ítems de la cotización:",u),alert("Cotización creada exitosamente"),ae(i.id)}catch(n){console.error("❌ onSubmit - Error:",n),z(n.message||"Error al crear cotización")}finally{k(!1)}},_=async a=>{try{const t=$;if(!t)return alert("Guarde la cotización antes de exportar");const n="http://localhost:4000/api".replace(/\/$/,"")||"",s=`/api/quotes/${t}/export/${a}`,i=n&&/\/api$/i.test(n)?`${n}${s.replace(/^\/api/,"")}`:`${n}${s}`,N=localStorage.getItem("token");if(!N){alert("No se encontró token de autenticación. Por favor, inicie sesión nuevamente.");return}const x=document.createElement("a");x.href=i,x.download=`cotizacion_${t}.${a}`;const E=await fetch(i,{method:"POST",headers:{Authorization:`Bearer ${N}`,"Content-Type":"application/json"},body:JSON.stringify({items:u})});if(!E.ok)throw new Error(`Error ${E.status}: ${E.statusText}`);const O=await E.blob(),W=URL.createObjectURL(O);x.href=W,document.body.appendChild(x),x.click(),document.body.removeChild(x),URL.revokeObjectURL(W)}catch(t){console.error("Error al exportar:",t),alert(`No se pudo exportar: ${t.message}`)}},K=async()=>{try{const a=$;if(!a)return alert("Guarde la cotización antes de generar el borrador");const t="http://localhost:4000/api".replace(/\/$/,"")||"",n=`/api/quotes/${a}/export/pdf-draft`,s=t&&/\/api$/i.test(t)?`${t}${n.replace(/^\/api/,"")}`:`${t}${n}`,i=localStorage.getItem("token");if(!i){alert("No se encontró token de autenticación. Por favor, inicie sesión nuevamente.");return}const N=document.createElement("a");N.href=s,N.download=`borrador_cotizacion_${a}.pdf`;const x=await fetch(s,{method:"POST",headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/json"},body:JSON.stringify({items:u})});if(!x.ok)throw new Error(`Error ${x.status}: ${x.statusText}`);const E=await x.blob(),O=URL.createObjectURL(E);N.href=O,document.body.appendChild(N),N.click(),document.body.removeChild(N),URL.revokeObjectURL(O)}catch(a){console.error("Error al generar borrador:",a),alert(`No se pudo generar el borrador: ${a.message}`)}};return e.jsxs(re,{titulo:"Nueva Cotización LEM",descripcion:"Plantilla de cotización para Laboratorio con variantes y condiciones",children:[w&&e.jsx("div",{className:"alert alert-danger",children:w}),e.jsxs("form",{onSubmit:Y,className:"lem-quote-page",children:[e.jsx("div",{className:"alert alert-light border mt-3 lem-intro",children:"Completa el formulario para crear una nueva cotización del Laboratorio (LEM). Los campos están agrupados por sección para facilitar el flujo."}),e.jsx("div",{className:"lem-stepper card shadow-sm mt-3",children:e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"d-flex justify-content-between align-items-center lem-steps",children:[{id:1,label:"Cliente y Proyecto"},{id:2,label:"Condiciones"},{id:3,label:"Ítems"},{id:4,label:"Resumen"}].map(a=>e.jsxs("div",{className:`lem-step ${b===a.id?"active":""} ${b>a.id?"done":""}`,onClick:()=>T(a.id),role:"button",children:[e.jsx("div",{className:"lem-step-index",children:a.id}),e.jsx("div",{className:"lem-step-label",children:a.label})]},a.id))})})}),b===1&&e.jsxs("div",{className:"row g-4 mt-3",children:[e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"card shadow-sm",children:[e.jsxs("div",{className:"card-header py-2",children:[e.jsx("strong",{children:"Proyecto"}),e.jsx("div",{className:"lem-subtitle",children:"Selecciona la empresa y el proyecto al que se asociará la cotización."})]}),e.jsx("div",{className:"card-body",children:e.jsx(ie,{value:c,onChange:ee})})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"card shadow-sm",children:[e.jsxs("div",{className:"card-header py-2",children:[e.jsx("strong",{children:"Datos del Cliente"}),e.jsx("div",{className:"lem-subtitle",children:"Información del cliente vinculada a esta cotización."}),c.company&&e.jsx("div",{className:"alert alert-info py-1 mt-2 mb-0",children:e.jsx("small",{children:"✅ Datos autocompletados desde la selección de cliente"})})]}),e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Empresa"}),e.jsx("input",{className:"form-control",value:l.company_name,onChange:a=>v({...l,company_name:a.target.value}),required:!0}),e.jsx("div",{className:"form-text",children:"Razón social o nombre comercial del cliente."})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"R.U.C."}),e.jsx("input",{className:"form-control",value:l.ruc,onChange:a=>v({...l,ruc:a.target.value})}),e.jsx("div",{className:"form-text",children:"RUC de la empresa (si aplica). Para persona natural, deja vacío."})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Contacto"}),e.jsx("input",{className:"form-control",value:l.contact_name,onChange:a=>v({...l,contact_name:a.target.value}),required:!0}),e.jsx("div",{className:"form-text",children:"Nombre de la persona que solicita la cotización."})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Teléfono"}),e.jsx("input",{className:"form-control",value:l.contact_phone,onChange:a=>v({...l,contact_phone:a.target.value})}),e.jsx("div",{className:"form-text",children:"Teléfono del contacto para coordinaciones."})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Correo"}),e.jsx("input",{type:"email",className:"form-control",value:l.contact_email,onChange:a=>v({...l,contact_email:a.target.value})}),e.jsx("div",{className:"form-text",children:"Correo del contacto para envío de la cotización."})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Ubicación del proyecto"}),e.jsx("input",{className:"form-control",value:l.project_location,readOnly:!0,style:{backgroundColor:"#f8f9fa",cursor:"not-allowed"}}),e.jsx("div",{className:"form-text",children:"Se actualiza automáticamente desde la selección de arriba"})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Nombre del proyecto"}),e.jsx("input",{className:"form-control",value:l.project_name,readOnly:!0,style:{backgroundColor:"#f8f9fa",cursor:"not-allowed"}}),e.jsx("div",{className:"form-text",children:"Se actualiza automáticamente desde la selección de arriba"})]})]})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"card shadow-sm",children:[e.jsxs("div",{className:"card-header py-2",children:[e.jsx("strong",{children:"Datos de la Cotización"}),e.jsx("div",{className:"lem-subtitle",children:"Fechas, referencia y configuración principal."})]}),e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Fecha de Solicitud"}),e.jsx("input",{type:"date",className:"form-control",value:o.request_date,onChange:a=>m({...o,request_date:a.target.value})})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Fecha de Emisión"}),e.jsx("input",{type:"date",className:"form-control",value:o.issue_date,onChange:a=>m({...o,issue_date:a.target.value})})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Comercial"}),e.jsx("input",{className:"form-control",value:o.commercial_name,onChange:a=>m({...o,commercial_name:a.target.value})}),e.jsx("div",{className:"form-text",children:"Nombre del asesor comercial que atiende al cliente."})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Teléfono Comercial"}),e.jsx("input",{type:"tel",className:"form-control",value:o.commercial_phone,onChange:a=>m({...o,commercial_phone:a.target.value}),required:!0}),e.jsx("div",{className:"form-text",children:"Teléfono del asesor comercial para contacto."})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Días de Entrega"}),e.jsx("input",{type:"number",className:"form-control",value:o.delivery_days||4,onChange:a=>m({...o,delivery_days:parseInt(a.target.value)||4}),min:"1",max:"30"}),e.jsx("div",{className:"form-text",children:"Número de días hábiles para entrega de resultados."})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Referencia"}),e.jsx("div",{className:"mb-2",children:e.jsx("div",{className:"row g-2",children:q.map(a=>{var t;return e.jsx("div",{className:"col-md-3 col-sm-4 col-6",children:e.jsxs("div",{className:"form-check",children:[e.jsx("input",{className:"form-check-input",type:"checkbox",id:`ref-${a.value}`,checked:((t=o.reference_type)==null?void 0:t.includes(a.value))||!1,onChange:n=>{const s=o.reference_type||[];n.target.checked?m({...o,reference_type:[...s,a.value]}):m({...o,reference_type:s.filter(i=>i!==a.value)})}}),e.jsx("label",{className:"form-check-label",htmlFor:`ref-${a.value}`,children:a.label})]})},a.value)})})}),e.jsxs("div",{className:"input-group",children:[e.jsx("input",{className:"form-control",value:o.reference,onChange:a=>m({...o,reference:a.target.value}),readOnly:!0,style:{backgroundColor:"#f8f9fa",cursor:"not-allowed"}}),e.jsx("button",{className:"btn btn-outline-secondary",type:"button",onClick:()=>{const a=M(o.reference_type);m(t=>({...t,reference:a}))},title:"Regenerar texto de referencia",children:"🔄"})]}),e.jsx("div",{className:"form-text",children:"Se genera automáticamente basado en las etiquetas seleccionadas. Puedes editarlo si necesitas."})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Variante"}),e.jsxs("div",{className:"d-flex gap-2 align-items-center",children:[e.jsxs("select",{className:"form-select",value:p,onChange:a=>S(a.target.value),style:{maxWidth:"70%"},children:[e.jsx("option",{value:"",children:"Sin variante"}),(h||[]).map(a=>e.jsxs("option",{value:a.id,children:[a.code," - ",a.title]},a.id))]}),p?e.jsx("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{S(""),I("")},children:"Quitar"}):null]}),p?(()=>{const a=(h||[]).find(n=>String(n.id)===String(p));if(!a)return null;const t=d(a)||a.description||"";return e.jsxs("div",{className:"alert alert-info mt-2 p-2",children:[e.jsxs("div",{className:"fw-semibold small",children:[a.code," - ",a.title]}),t?e.jsx("div",{className:"small text-muted",style:{whiteSpace:"pre-line"},children:t}):null]})})():e.jsx("div",{className:"form-text",children:"Selecciona una variante del listado."})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Forma de pago"}),e.jsxs("select",{className:"form-select",value:o.payment_terms,onChange:a=>m({...o,payment_terms:a.target.value}),children:[e.jsx("option",{value:"adelantado",children:"Adelantado"}),e.jsx("option",{value:"50%",children:"Adelanto 50% y saldo previo al informe"}),e.jsx("option",{value:"credito7",children:"Crédito 7 días con OS"}),e.jsx("option",{value:"credito15",children:"Crédito 15 días con OS"}),e.jsx("option",{value:"credito30",children:"Crédito 30 días con OS"})]})]}),e.jsxs("div",{className:"form-check mb-3",children:[e.jsx("input",{className:"form-check-input",type:"checkbox",id:"igv",checked:o.igv,onChange:a=>m({...o,igv:a.target.checked})}),e.jsx("label",{className:"form-check-label",htmlFor:"igv",children:"Aplicar IGV 18%"})]}),e.jsxs("div",{className:"mb-0",children:[e.jsx("label",{className:"form-label",children:"Nombre de archivo sugerido"}),e.jsxs("div",{className:"input-group",children:[e.jsx("input",{className:"form-control",value:G,onChange:a=>R(a.target.value),placeholder:"Se genera automáticamente..."}),e.jsx("button",{className:"btn btn-outline-secondary",type:"button",onClick:()=>R(L()),title:"Regenerar nombre automáticamente",children:"🔄"})]}),e.jsx("div",{className:"form-text",children:"Se genera automáticamente basado en el cliente. Puedes editarlo si necesitas."})]})]})]})})]}),b===2&&e.jsxs("div",{className:"card shadow-sm lem-section-gap",children:[e.jsxs("div",{className:"card-header py-2",children:[e.jsx("strong",{children:"Condiciones específicas"}),e.jsx("div",{className:"lem-subtitle",children:"Se auto-completan según la variante; puedes editarlas."})]}),e.jsxs("div",{className:"card-body",children:[e.jsx("textarea",{className:"form-control lem-monospace",rows:8,placeholder:"Aquí aparecerán las condiciones de la variante seleccionada; puedes editarlas si es necesario.",value:V,onChange:a=>I(a.target.value)}),e.jsx("div",{className:"form-text mt-2",children:"Este texto se guardará en la cotización y se usará para PDF/Excel."})]})]}),b===3&&e.jsxs("div",{className:"card shadow-sm mt-4",children:[e.jsxs("div",{className:"card-header py-2",children:[e.jsx("strong",{children:"Ítems"}),e.jsx("div",{className:"lem-subtitle",children:"Detalle de ensayos/servicios cotizados."})]}),e.jsxs("div",{className:"card-body",children:[e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-bordered table-striped align-middle",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Código/N° ensayo"}),e.jsx("th",{children:"Descripción"}),e.jsx("th",{children:"Norma"}),e.jsx("th",{className:"text-right",children:"Unitario (S/)"}),e.jsx("th",{className:"text-right",children:"Cantidad"}),e.jsx("th",{className:"text-right",children:"Parcial (S/)"}),e.jsx("th",{})]})}),e.jsx("tbody",{children:u.map((a,t)=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("input",{className:"form-control",value:a.code,onChange:n=>y(t,{code:n.target.value})})}),e.jsx("td",{children:e.jsx(de,{value:a.description,onChange:n=>y(t,{description:n}),onSelect:n=>{n&&y(t,{code:n.codigo,description:n.descripcion,norm:n.norma,unit_price:n.precio})},placeholder:"Buscar por código, descripción o norma...",size:"sm"})}),e.jsx("td",{children:e.jsx("input",{className:"form-control",value:a.norm,onChange:n=>y(t,{norm:n.target.value})})}),e.jsx("td",{style:{width:120},children:e.jsx("input",{type:"number",step:"0.01",className:"form-control",value:a.unit_price,onChange:n=>y(t,{unit_price:n.target.value})})}),e.jsx("td",{style:{width:100},children:e.jsx("input",{type:"number",className:"form-control",value:a.quantity,onChange:n=>y(t,{quantity:n.target.value})})}),e.jsx("td",{style:{width:120},children:H(a)}),e.jsx("td",{style:{width:80},children:e.jsx("button",{type:"button",className:"btn btn-sm btn-link text-danger",title:"Eliminar",onClick:()=>se(t),disabled:u.length===1,children:"🗑️"})})]},t))})]})}),e.jsx("div",{className:"mb-2",children:e.jsx("button",{type:"button",className:"btn btn-outline-primary",onClick:oe,children:"Agregar ítem"})})]})]}),b===4&&e.jsxs("div",{className:"card shadow-sm mt-3 mb-2",children:[e.jsxs("div",{className:"card-header py-2",children:[e.jsx("strong",{children:"Resumen y Acciones"}),e.jsx("div",{className:"lem-subtitle",children:"Revisa montos y genera tus archivos."})]}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"row align-items-center g-3",children:[e.jsx("div",{className:"col-md",children:e.jsxs("div",{className:"text-md-end",children:[e.jsxs("div",{children:["Subtotal: S/ ",g.toFixed(2)]}),e.jsxs("div",{children:["IGV 18%: S/ ",A.toFixed(2)]}),e.jsx("div",{children:e.jsxs("strong",{children:["Total: S/ ",B.toFixed(2)]})})]})}),e.jsxs("div",{className:"col-md-auto",children:[!((X=c.project)!=null&&X.id)&&!c.project_id&&e.jsxs("div",{className:"alert alert-warning mb-2",style:{fontSize:"0.875rem"},children:[e.jsx("i",{className:"fas fa-exclamation-triangle me-1"}),"Debe seleccionar un proyecto para poder guardar la cotización"]}),e.jsxs("div",{className:"d-flex flex-wrap gap-2 lem-actions",children:[e.jsx("button",{type:"submit",className:"btn btn-success",disabled:D||!((J=c.project)!=null&&J.id)&&!c.project_id,title:!((Q=c.project)!=null&&Q.id)&&!c.project_id?"Debe seleccionar un proyecto primero":"",children:D?"Guardando...":"Guardar borrador"}),e.jsx("button",{type:"button",className:"btn btn-outline-warning",onClick:K,children:"PDF Borrador"}),e.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>_("pdf"),children:"Exportar PDF"}),e.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>_("excel"),children:"Exportar Excel"})]})]})]})})]}),e.jsx("div",{className:`lem-sticky-actions ${te?"sidebar-collapsed":""}`,children:e.jsx("div",{className:"lem-action-content",children:e.jsx("div",{className:"container-fluid px-0",children:e.jsxs("div",{className:"row align-items-center",children:[e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"d-flex gap-3",children:[e.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>T(Math.max(1,b-1)),disabled:b===1,children:"← Anterior"}),e.jsx("button",{type:"button",className:"btn btn-primary",onClick:()=>b<4?T(b+1):Y({preventDefault:()=>{}}),children:b<4?"Siguiente →":D?"Guardando...":"Guardar borrador"})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"d-flex gap-2 justify-content-md-end flex-wrap",children:[e.jsx("button",{type:"button",className:"btn btn-outline-warning",onClick:K,children:"📄 PDF Borrador"}),e.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>_("pdf"),children:"📋 Exportar PDF"}),e.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>_("excel"),children:"📊 Exportar Excel"})]})})]})})})})]})]})}export{Ie as default};
//# sourceMappingURL=CotizacionNuevaLEM-BG4SlCnW.js.map
