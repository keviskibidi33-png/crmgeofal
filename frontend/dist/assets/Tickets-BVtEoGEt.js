import{r as n,c as B,e as q,H as y,j as e,I as z,g as l,B as I,J as L,S as k,W as x,f as N,p,y as R,a1 as C,o as H,a2 as Q}from"./index-D5j7Etbr.js";import{P as _}from"./PageHeader-BAMnoJ00.js";import{D as U}from"./DataTable-BSDUXWv5.js";import{M as W}from"./ModalForm-OWlJb50t.js";import{S as d}from"./StatsCard-CrtJfzkh.js";import{c as G,u as J,l as X}from"./tickets-CvYZMdq1.js";import{R as K,C as u,a as h}from"./Row-BbCd5WYq.js";import"./InputGroup-CuAl69_P.js";import"./ElementChildren-BZ8oKQvH.js";import"./Table-BrvfnYPw.js";/* empty css                     */import"./Modal-BtZGspVd.js";import"./Spinner-DkvOZ9XA.js";const v={title:"",description:"",priority:"media"};function de(){const[T,c]=n.useState(!1),[i,m]=n.useState(null),[O,V]=n.useState(null),b=B(),{data:r,isLoading:S}=q(["tickets"],()=>X(),{keepPreviousData:!0}),j=y(G,{onSuccess:()=>{b.invalidateQueries("tickets"),c(!1),m(null)},onError:t=>console.error("Error creating ticket:",t)}),f=y(J,{onSuccess:()=>{b.invalidateQueries("tickets")},onError:t=>console.error("Error updating ticket:",t)}),w=()=>{m(v),c(!0)},E=t=>{m(t),c(!0)},F=async t=>{i.id?await f.mutateAsync({id:i.id,...t}):await j.mutateAsync(t)},M=t=>{const a={abierto:{bg:"primary",text:"Abierto",icon:l},en_progreso:{bg:"warning",text:"En Progreso",icon:k},resuelto:{bg:"success",text:"Resuelto",icon:N},cerrado:{bg:"secondary",text:"Cerrado",icon:R}}[t]||{bg:"secondary",text:t,icon:l},g=a.icon;return e.jsxs(p,{bg:a.bg,className:"status-badge d-flex align-items-center",children:[e.jsx(g,{size:12,className:"me-1"}),a.text]})},P=t=>{const a={baja:{bg:"success",text:"Baja",icon:C},media:{bg:"warning",text:"Media",icon:x},alta:{bg:"danger",text:"Alta",icon:x}}[t]||{bg:"secondary",text:t,icon:C},g=a.icon;return e.jsxs(p,{bg:a.bg,className:"status-badge d-flex align-items-center",children:[e.jsx(g,{size:12,className:"me-1"}),a.text]})},D=[{header:"ID",accessor:"id",width:"80px"},{header:"Título",accessor:"title",render:(t,s)=>{var a;return e.jsxs("div",{children:[e.jsx("div",{className:"fw-medium",children:s.title}),e.jsxs("small",{className:"text-muted",children:[e.jsx(H,{size:12,className:"me-1"}),((a=s.user)==null?void 0:a.name)||"Usuario"]})]})}},{header:"Descripción",accessor:"description",render:t=>e.jsx("div",{className:"text-truncate",style:{maxWidth:"200px"},title:t,children:t})},{header:"Prioridad",accessor:"priority",render:t=>P(t)},{header:"Estado",accessor:"status",render:t=>M(t)},{header:"Fecha",accessor:"created_at",render:t=>e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx(Q,{size:12,className:"me-1 text-muted"}),e.jsx("small",{children:new Date(t).toLocaleDateString("es-ES")})]})}],A=[{name:"title",label:"Título",type:"text",required:!0,placeholder:"Ingresa el título del ticket"},{name:"description",label:"Descripción",type:"textarea",required:!0,placeholder:"Describe el problema o solicitud",rows:4},{name:"priority",label:"Prioridad",type:"select",required:!0,options:[{value:"baja",label:"Baja"},{value:"media",label:"Media"},{value:"alta",label:"Alta"}]}],o=n.useMemo(()=>{const t=(r==null?void 0:r.tickets)||[];return{total:t.length,abiertos:t.filter(s=>s.status==="abierto").length,enProgreso:t.filter(s=>s.status==="en_progreso").length,resueltos:t.filter(s=>s.status==="resuelto").length,cerrados:t.filter(s=>s.status==="cerrado").length,alta:t.filter(s=>s.priority==="alta").length,media:t.filter(s=>s.priority==="media").length,baja:t.filter(s=>s.priority==="baja").length}},[r]);return e.jsx(z,{fluid:!0,className:"py-4",children:e.jsxs("div",{className:"fade-in",children:[e.jsx(_,{title:"Gestión de Tickets",subtitle:"Crear, editar y gestionar tickets de soporte",icon:l,actions:e.jsxs(I,{variant:"primary",onClick:w,children:[e.jsx(L,{className:"me-2"}),"Nuevo Ticket"]})}),e.jsxs(K,{className:"g-4 mb-4",children:[e.jsx(u,{md:6,lg:3,children:e.jsx(d,{title:"Total Tickets",value:o.total,icon:l,color:"primary",subtitle:"Tickets registrados"})}),e.jsx(u,{md:6,lg:3,children:e.jsx(d,{title:"Abiertos",value:o.abiertos,icon:k,color:"warning",subtitle:"Pendientes de atención"})}),e.jsx(u,{md:6,lg:3,children:e.jsx(d,{title:"En Progreso",value:o.enProgreso,icon:x,color:"info",subtitle:"En proceso de resolución"})}),e.jsx(u,{md:6,lg:3,children:e.jsx(d,{title:"Resueltos",value:o.resueltos,icon:N,color:"success",subtitle:"Completados"})})]}),e.jsxs(h,{className:"shadow-sm border-0",children:[e.jsx(h.Header,{className:"bg-white border-bottom",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("h5",{className:"mb-0",children:[e.jsx(l,{className:"me-2 text-primary"}),"Lista de Tickets"]}),e.jsxs(p,{bg:"light",text:"dark",className:"px-3 py-2",children:[o.total," tickets"]})]})}),e.jsx(h.Body,{className:"p-0",children:e.jsx(U,{data:(r==null?void 0:r.tickets)||[],columns:D,loading:S,onEdit:E,emptyMessage:"No hay tickets registrados"})})]}),e.jsx(W,{show:T,onHide:()=>c(!1),title:i!=null&&i.id?"Editar Ticket":"Nuevo Ticket",data:i||v,fields:A,onSubmit:F,loading:j.isLoading||f.isLoading,submitText:i!=null&&i.id?"Actualizar":"Crear"})]})})}export{de as default};
//# sourceMappingURL=Tickets-BVtEoGEt.js.map
