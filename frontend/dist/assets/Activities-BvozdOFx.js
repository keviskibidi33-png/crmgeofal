import{u as H,a as B,r as N,j as e,U as I,aq as U,av as M,a6 as $,B as l,X as b,aw as D,A as G,i as a,y as A,_ as V,x as m,k as X,H as k,d as u,a2 as T}from"./index-B6K4MeZ_.js";import{u as J}from"./useActivities-CK5vK0mM.js";import{P as K,R as q,C as p}from"./PageHeader-ZaYSeG4B.js";import{C as j}from"./Card-C3FyhA6L.js";import{F as r}from"./Form-DajNugM3.js";import{S as O}from"./Spinner-Cd5nug_F.js";import{A as w}from"./Alert-DpUsPmby.js";const ae=()=>{var C;const z=H(),{user:o}=B(),[s,x]=N.useState({type:"",entityType:"",limit:20,offset:0}),[n,y]=N.useState(""),{data:h,isLoading:v,error:F,refreshActivities:g,activitiesCount:L}=J({limit:s.limit,refetchInterval:0,staleTime:3e4,userId:o==null?void 0:o.id,role:o==null?void 0:o.role}),R=t=>{const c=new Date,d=new Date(t),i=Math.floor((c-d)/(1e3*60));return i<1?"Ahora":i<60?`Hace ${i} min`:i<1440?`Hace ${Math.floor(i/60)} h`:`Hace ${Math.floor(i/1440)} días`},E=t=>({quote_created:a,quote_assigned:a,quote_approved:u,quote_rejected:k,quote_completed:u,project_created:a,project_assigned:a,project_started:a,project_completed:u,project_delayed:T,ticket_created:a,ticket_assigned:a,ticket_resolved:u,ticket_escalated:T,evidence_uploaded:a,evidence_approved:u,evidence_rejected:k,user_registered:m,user_assigned:m,user_role_changed:m,client_created:m,client_updated:m,system_maintenance:a,system_update:a})[t]||a,S=t=>({quote_created:"primary",quote_assigned:"primary",quote_approved:"success",quote_rejected:"danger",quote_completed:"success",project_created:"info",project_assigned:"info",project_started:"info",project_completed:"success",project_delayed:"warning",ticket_created:"warning",ticket_assigned:"warning",ticket_resolved:"success",ticket_escalated:"danger",evidence_uploaded:"secondary",evidence_approved:"success",evidence_rejected:"danger",user_registered:"info",user_assigned:"info",user_role_changed:"secondary",client_created:"primary",client_updated:"primary",system_maintenance:"secondary",system_update:"secondary"})[t]||"secondary",P=t=>({quote_created:"Cotización Creada",quote_assigned:"Cotización Asignada",quote_approved:"Cotización Aprobada",quote_rejected:"Cotización Rechazada",quote_completed:"Cotización Completada",project_created:"Proyecto Creado",project_assigned:"Proyecto Asignado",project_started:"Proyecto Iniciado",project_completed:"Proyecto Completado",project_delayed:"Proyecto Retrasado",ticket_created:"Ticket Creado",ticket_assigned:"Ticket Asignado",ticket_resolved:"Ticket Resuelto",ticket_escalated:"Ticket Escalado",evidence_uploaded:"Evidencia Subida",evidence_approved:"Evidencia Aprobada",evidence_rejected:"Evidencia Rechazada",user_registered:"Usuario Registrado",user_assigned:"Usuario Asignado",user_role_changed:"Rol Cambiado",client_created:"Cliente Creado",client_updated:"Cliente Actualizado",system_maintenance:"Mantenimiento",system_update:"Actualización"})[t]||t,_=((C=h==null?void 0:h.activities)==null?void 0:C.filter(t=>{var f;const c=!n||t.title.toLowerCase().includes(n.toLowerCase())||t.description.toLowerCase().includes(n.toLowerCase())||((f=t.user_name)==null?void 0:f.toLowerCase().includes(n.toLowerCase())),d=!s.type||t.type===s.type,i=!s.entityType||t.entity_type===s.entityType;return c&&d&&i}))||[];return e.jsxs(I,{fluid:!0,className:"py-4",children:[e.jsx(K,{title:"Actividades del Sistema",subtitle:"Historial completo de actividades y eventos",breadcrumb:[{label:"Dashboard",href:"/dashboard"},{label:"Actividades",active:!0}]}),e.jsxs(q,{children:[e.jsx(p,{lg:12,className:"mb-4",children:e.jsx(j,{children:e.jsx(j.Body,{children:e.jsxs(q,{className:"align-items-center",children:[e.jsx(p,{md:4,children:e.jsxs(r.Group,{children:[e.jsxs(r.Label,{children:[e.jsx(U,{className:"me-1"}),"Buscar"]}),e.jsx(r.Control,{type:"text",placeholder:"Buscar en actividades...",value:n,onChange:t=>y(t.target.value)})]})}),e.jsx(p,{md:3,children:e.jsxs(r.Group,{children:[e.jsxs(r.Label,{children:[e.jsx(M,{className:"me-1"}),"Tipo"]}),e.jsxs(r.Select,{value:s.type,onChange:t=>x({...s,type:t.target.value}),children:[e.jsx("option",{value:"",children:"Todos los tipos"}),e.jsx("option",{value:"quote_created",children:"Cotización Creada"}),e.jsx("option",{value:"quote_assigned",children:"Cotización Asignada"}),e.jsx("option",{value:"quote_approved",children:"Cotización Aprobada"}),e.jsx("option",{value:"quote_completed",children:"Cotización Completada"}),e.jsx("option",{value:"project_created",children:"Proyecto Creado"}),e.jsx("option",{value:"project_completed",children:"Proyecto Completado"}),e.jsx("option",{value:"ticket_created",children:"Ticket Creado"}),e.jsx("option",{value:"ticket_resolved",children:"Ticket Resuelto"}),e.jsx("option",{value:"evidence_uploaded",children:"Evidencia Subida"}),e.jsx("option",{value:"user_registered",children:"Usuario Registrado"}),e.jsx("option",{value:"client_created",children:"Cliente Creado"})]})]})}),e.jsx(p,{md:3,children:e.jsxs(r.Group,{children:[e.jsxs(r.Label,{children:[e.jsx($,{className:"me-1"}),"Entidad"]}),e.jsxs(r.Select,{value:s.entityType,onChange:t=>x({...s,entityType:t.target.value}),children:[e.jsx("option",{value:"",children:"Todas las entidades"}),e.jsx("option",{value:"quote",children:"Cotizaciones"}),e.jsx("option",{value:"project",children:"Proyectos"}),e.jsx("option",{value:"ticket",children:"Tickets"}),e.jsx("option",{value:"evidence",children:"Evidencias"}),e.jsx("option",{value:"user",children:"Usuarios"}),e.jsx("option",{value:"client",children:"Clientes"})]})]})}),e.jsx(p,{md:2,children:e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx(l,{variant:"outline-primary",onClick:g,disabled:v,title:"Actualizar actividades",children:e.jsx(b,{className:v?"spinning":""})}),e.jsx(l,{variant:"outline-secondary",onClick:()=>z("/dashboard"),title:"Volver al Dashboard",children:e.jsx(D,{})})]})})]})})})}),e.jsx(p,{lg:12,children:e.jsxs(j,{children:[e.jsxs(j.Header,{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"mb-0",children:"Actividades Recientes"}),e.jsxs("small",{className:"text-muted",children:[_.length," de ",L," actividades"]})]}),e.jsx("div",{className:"d-flex gap-2",children:e.jsxs(l,{variant:"outline-success",size:"sm",children:[e.jsx(G,{className:"me-1"}),"Exportar"]})})]}),e.jsx(j.Body,{children:v?e.jsxs("div",{className:"text-center py-5",children:[e.jsx(O,{animation:"border",variant:"primary"}),e.jsx("p",{className:"mt-3 text-muted",children:"Cargando actividades..."})]}):F?e.jsxs(w,{variant:"danger",children:[e.jsx(w.Heading,{children:"Error al cargar actividades"}),e.jsx("p",{children:"No se pudieron cargar las actividades. Por favor, intenta nuevamente."}),e.jsxs(l,{variant:"outline-danger",onClick:g,children:[e.jsx(b,{className:"me-1"}),"Reintentar"]})]}):_.length===0?e.jsxs("div",{className:"text-center py-5",children:[e.jsx(a,{size:48,className:"text-muted mb-3"}),e.jsx("h5",{className:"text-muted",children:"No hay actividades"}),e.jsx("p",{className:"text-muted",children:n||s.type||s.entityType?"No se encontraron actividades con los filtros aplicados.":"Aún no hay actividades registradas en el sistema."}),(n||s.type||s.entityType)&&e.jsx(l,{variant:"outline-primary",onClick:()=>{y(""),x({type:"",entityType:"",limit:20,offset:0})},children:"Limpiar filtros"})]}):e.jsx("div",{className:"activity-list",children:_.map(t=>{const c=E(t.type),d=S(t.type),i=P(t.type);return e.jsxs("div",{className:"activity-item d-flex align-items-start mb-4 p-3 border rounded",children:[e.jsx("div",{className:`activity-icon bg-${d} bg-opacity-10 rounded-circle p-3 me-3`,children:e.jsx(c,{size:24,className:`text-${d}`})}),e.jsxs("div",{className:"flex-grow-1",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-start mb-2",children:[e.jsxs("div",{children:[e.jsx("h6",{className:"mb-1",children:t.title}),e.jsx(A,{bg:d,className:"me-2",children:i}),t.entity_type&&e.jsx(A,{bg:"secondary",variant:"outline",children:t.entity_type})]}),e.jsx("div",{className:"text-end",children:e.jsxs("small",{className:"text-muted d-flex align-items-center",children:[e.jsx(V,{className:"me-1"}),R(t.created_at)]})})]}),e.jsx("p",{className:"text-muted mb-2",children:t.description}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsx("small",{className:"text-muted",children:t.user_name&&e.jsxs("span",{children:[e.jsx(m,{className:"me-1"}),"por ",t.user_name]})}),e.jsxs(l,{variant:"outline-primary",size:"sm",children:[e.jsx(X,{className:"me-1"}),"Ver detalles"]})]})]})]},t.id)})})})]})})]})]})};export{ae as default};
//# sourceMappingURL=Activities-BvozdOFx.js.map
