import{r as l,j as e}from"./index-DEOVmouH.js";import{M as X}from"./ModuloBase-D7hsd1iJ.js";import{l as Y}from"./quoteVariants-DUGt3etc.js";import{c as K,a as Q}from"./quotes-0LdIpxEP.js";import{l as W}from"./companies-CQE8_azb.js";import{c as H}from"./projects-CIJM5hiT.js";function J({value:N,onChange:u}){const[d,E]=l.useState([]),[n,b]=l.useState(!1),[c,g]=l.useState({company_id:"",project_name:"",location:""}),[r,x]=l.useState("");l.useEffect(()=>{(async()=>{try{b(!0);const i=await W({page:1,limit:50}),f=Array.isArray(i==null?void 0:i.data)?i.data:i;E(f||[])}catch{x("No se pudo cargar empresas")}finally{b(!1)}})()},[]);const m=l.useMemo(()=>d.find(i=>String(i.id)===String(c.company_id)),[d,c.company_id]);l.useEffect(()=>{typeof u=="function"&&u({company_id:c.company_id?Number(c.company_id):null,company:m||null,project_name:c.project_name,location:c.location})},[c,m,u]);const A=async()=>{if(!(!c.company_id||!c.project_name))try{const i={company_id:Number(c.company_id),name:c.project_name,location:c.location},f=await H(i);typeof u=="function"&&u({...N,project_id:f.id,project:f})}catch(i){x(i.message||"No se pudo crear proyecto")}};return e.jsxs("div",{className:"border rounded p-3",children:[e.jsx("h6",{children:"Cliente y Proyecto"}),r&&e.jsx("div",{className:"alert alert-warning py-1 my-2",children:r}),e.jsxs("div",{className:"row g-2 align-items-end",children:[e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label",children:"Cliente"}),e.jsxs("select",{className:"form-select",value:c.company_id,disabled:n,onChange:i=>g({...c,company_id:i.target.value}),children:[e.jsx("option",{value:"",children:"Seleccione..."}),d.map(i=>e.jsxs("option",{value:i.id,children:[i.name," ",i.ruc?`(RUC ${i.ruc})`:""]},i.id))]})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label",children:"Nombre del proyecto"}),e.jsx("input",{className:"form-control",value:c.project_name,onChange:i=>g({...c,project_name:i.target.value}),placeholder:"Ej. Control de calidad de mezclas"})]}),e.jsxs("div",{className:"col-md-3",children:[e.jsx("label",{className:"form-label",children:"Ubicación"}),e.jsx("input",{className:"form-control",value:c.location,onChange:i=>g({...c,location:i.target.value})})]}),e.jsx("div",{className:"col-md-1 d-grid",children:e.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:A,disabled:!c.company_id||!c.project_name,children:"Crear"})})]}),m&&e.jsxs("div",{className:"small text-muted mt-2",children:["Contacto: ",m.contact_name," · Tel: ",m.phone," · Email: ",m.email]})]})}const Z={company_name:"",ruc:"",contact_name:"",contact_phone:"",contact_email:"",project_location:"",project_name:"",service_name:""},ee={request_date:"",issue_date:"",commercial_name:"",payment_terms:"adelantado",acceptance:!1,reference:"",igv:!0},G={code:"",description:"",norm:"",unit_price:0,quantity:1};function R(N){const u=Number(N.unit_price||0),d=Number(N.quantity||0);return Number((u*d).toFixed(2))}function q(N="xxx-XX",u=""){const d=(u||"").toUpperCase().trim()||"NOMBRE DEL CLIENTE";return`Cotización ${N} LEM-GEOFAL-${d}`}const h=(N="")=>(N||"").normalize("NFD").replace(/[\u0300-\u036f]/g,"").toUpperCase().trim(),T={[h("MUESTRA DE SUELO Y AGREGADO")]:`CONDICIONES ESPECÍFICAS:
- El cliente deberá enviar al laboratorio, para los ensayo en suelo y agregados, la cantidad minima de 100 kg por cada muestra.
- El cliente deberá de entregar las muestras debidamente identificadas.
- El cliente deberá especificar la Norma a ser utilizada para la ejecución del ensayo, caso contrario se considera Norma ASTM o NTP vigente de acuerdo con el alcance del laboratorio.
- El cliente deberá entregar las muestras en las instalaciones del LEM, ubicado en la Av. Marañón N° 763, Los Olivos, Lima.`,[h("PROBETAS")]:`CONDICIONES ESPECÍFICAS:
- El cliente debe proporcionar las probetas antes del ingreso a obra.
- El cliente deberá de entregar las muestras debidamente identificadas.
- El cliente deberá especificar la Norma a ser utilizada para la ejecución del ensayo, caso contrario se considera Norma ASTM o NTP vigente de acuerdo con el alcance del laboratorio.
- El cliente deberá entregar las muestras en las instalaciones del LEM, ubicado en la Av. Marañón N° 763, Los Olivos, Lima.`,[h("DENSIDAD DE CAMPO Y MUESTREO")]:`CONDICIONES ESPECÍFICAS:
- El cliente deberá enviar al laboratorio, para los ensayo en suelo y agregados, la cantidad minima de 100 kg por cada muestra.
- Para el ensayo de Densidad de campo, la cantidad de puntos/salida minimo 4 und.
- El cliente deberá de programar el servicio, Densidad de campo, con 24 horas de anticipación.
- El cliente deberá especificar la Norma a ser utilizada para la ejecución del ensayo, caso contrario se considera Norma ASTM o NTP vigente de acuerdo con el alcance del laboratorio.
- El cliente deberá entregar las muestras en las instalaciones del LEM, ubicado en la Av. Marañón N° 763, Los Olivos, Lima.`,[h("EXTRACCIÓN DE DIAMANTINA")]:`CONDICIONES ESPECÍFICAS:
- Movilización y desmovilización de equipos y del personal técnico, estara a cargo de GEOFAL.
- Resane de estructura de concreto con sika rep 500 y Sikadur 32, estara a cargo de GEOFAL.
- El servicio no incluye trabajos de acabados como pintura, mayolica y otros.
- El area de trabajo, zona de extracción de diamantina, tiene que estar libre de interferencia.
- La extracción de diamantina se realizara en 2 dia en campo, en laboratorio se realizará el tallado y refrentado de diamantina, el ensayo de resistencia a la compresión de testigo de diamantina se realizara en 5 dias (el tiempo de ensayo obedece a la normativa vigente).
- Costo de resane insumos 250 soles, este costo se distribuira de acuerdo con el numero de perforaciones Donde se hara las extracciones de diamantina`,[h("EXTRACCION DE DIAMANTINA")]:`CONDICIONES ESPECÍFICAS:
- Movilización y desmovilización de equipos y del personal técnico, estara a cargo de GEOFAL.
- Resane de estructura de concreto con sika rep 500 y Sikadur 32, estara a cargo de GEOFAL.
- El servicio no incluye trabajos de acabados como pintura, mayolica y otros.
- El area de trabajo, zona de extracción de diamantina, tiene que estar libre de interferencia.
- La extracción de diamantina se realizara en 2 dia en campo, en laboratorio se realizará el tallado y refrentado de diamantina, el ensayo de resistencia a la compresión de testigo de diamantina se realizara en 5 dias (el tiempo de ensayo obedece a la normativa vigente).
- Costo de resane insumos 250 soles, este costo se distribuira de acuerdo con el numero de perforaciones Donde se hara las extracciones de diamantina`,[h("DIAMANTINA PARA PASES")]:`CONDICIONES ESPECÍFICAS:
- El cliente deberá de programar el servicio, Extracción diamantina, con 24 horas de anticipación.
- El area de trabajo, zona de extraccion de diamantina, debera estar libre de interferencia.
- Para extraer la diamantina, se ubicara el acero con un escaneador.
- Movilizacion y desmovilizacion de equipos y del personal tecnico, estara a cargo de Geofal.`,[h("ALBAÑILERÍA")]:`CONDICIONES ESPECÍFICAS:
- El cliente deberá enviar al laboratorio, 20 ladrillo de cada tipo, en buen estado y sin presentar fisuras.
- El cliente deberá de entregar las muestras debidamente identificadas.
- El cliente deberá especificar la Norma a ser utilizada para la ejecución del ensayo, caso contrario se considera Norma ASTM o NTP vigente de acuerdo con el alcance del laboratorio.
- El cliente deberá entregar las muestras en las instalaciones del LEM, ubicado en la Av. Marañón N° 763, Los Olivos, Lima`,[h("ALBANILERIA")]:`CONDICIONES ESPECÍFICAS:
- El cliente deberá enviar al laboratorio, 20 ladrillo de cada tipo, en buen estado y sin presentar fisuras.
- El cliente deberá de entregar las muestras debidamente identificadas.
- El cliente deberá especificar la Norma a ser utilizada para la ejecución del ensayo, caso contrario se considera Norma ASTM o NTP vigente de acuerdo con el alcance del laboratorio.
- El cliente deberá entregar las muestras en las instalaciones del LEM, ubicado en la Av. Marañón N° 763, Los Olivos, Lima`,[h("VIGA BECKELMAN")]:`CONDICIONES ESPECÍFICAS:
- El cliente deberá de programar el servicio, Ensayo de Deflexión, con 24 horas de anticipación.
- El area de trabajo tiene que estar habilitado.
- El cliente deberá especificar la Norma a ser utilizada para la ejecución del ensayo, caso contrario se considera Norma ASTM o NTP o MTC vigente de acuerdo con el alcance del laboratorio.
- Especificar las caracteristicas del camion`,[h("CONTROL DE CALIDAD DE CONCRETO FRESCO EN OBRA")]:`CONDICIONES ESPECÍFICAS:
- El cliente deberá de programar el servicio, con 24 horas de anticipación.
- Para el ensayo de control de calidad de concreto fresco en obra, se moldeara 6 probetas, ensayo slump, control de temperatura, en laboratorio las probetas se colocara en camara de curado, el ensayo de compresión de las probetas seran 3 a 7 dias y 3 a 28 dias.
- El control de calidad del concreto fresco se sacara cada 50m3 a uno de los mixer donde se hara todos los ensayos respectivos mencionados, o por dia asi no se halla llegado los 50m3.
- El cliente deberá especificar la Norma a ser utilizada para la ejecución del ensayo, caso contrario se considera Norma ASTM o NTP vigente de acuerdo con el alcance del laboratorio.`,[h("CONTROL DE CALIDAD DE CONCRETO FRESCO")]:`CONDICIONES ESPECÍFICAS:
- El cliente deberá de programar el servicio, con 24 horas de anticipación.
- Para el ensayo de control de calidad de concreto fresco en obra, se moldeara 6 probetas, ensayo slump, control de temperatura, en laboratorio las probetas se colocara en camara de curado, el ensayo de compresión de las probetas seran 3 a 7 dias y 3 a 28 dias.
- El control de calidad del concreto fresco se sacara cada 50m3 a uno de los mixer donde se hara todos los ensayos respectivos mencionados, o por dia asi no se halla llegado los 50m3.
- El cliente deberá especificar la Norma a ser utilizada para la ejecución del ensayo, caso contrario se considera Norma ASTM o NTP vigente de acuerdo con el alcance del laboratorio.`},p=N=>{const u=h((N==null?void 0:N.title)||"");if(T[u])return T[u];const d=Object.entries(T).find(([E])=>u.includes(E)||E.includes(u));return d?d[1]:""};function re(){var w;const[N,u]=l.useState([]),[d,E]=l.useState(""),[n,b]=l.useState(Z),[c,g]=l.useState({company_id:null,project_id:null,company:null,project:null}),[r,x]=l.useState(ee),[m,A]=l.useState([{...G}]),[i,f]=l.useState(!1),[L,M]=l.useState(""),[P,D]=l.useState(""),[j,I]=l.useState(1),[V,B]=l.useState(null);l.useEffect(()=>{(async()=>{try{const t=await Y({active:!0})||[];if(t.length>0)u(t);else{const s=[{id:"V1",code:"V1",title:"MUESTRA DE SUELO Y AGREGADO",description:p({title:"MUESTRA DE SUELO Y AGREGADO"})},{id:"V2",code:"V2",title:"PROBETAS",description:p({title:"PROBETAS"})},{id:"V3",code:"V3",title:"DENSIDAD DE CAMPO Y MUESTREO",description:p({title:"DENSIDAD DE CAMPO Y MUESTREO"})},{id:"V4",code:"V4",title:"EXTRACCIÓN DE DIAMANTINA",description:p({title:"EXTRACCIÓN DE DIAMANTINA"})},{id:"V5",code:"V5",title:"DIAMANTINA PARA PASES",description:p({title:"DIAMANTINA PARA PASES"})},{id:"V6",code:"V6",title:"ALBAÑILERÍA",description:p({title:"ALBAÑILERÍA"})},{id:"V7",code:"V7",title:"VIGA BECKELMAN",description:p({title:"VIGA BECKELMAN"})},{id:"V8",code:"V8",title:"CONTROL DE CALIDAD DE CONCRETO FRESCO EN OBRA",description:p({title:"CONTROL DE CALIDAD DE CONCRETO FRESCO EN OBRA"})}];u(s)}}catch{u([{id:"V1",code:"V1",title:"MUESTRA DE SUELO Y AGREGADO",description:p({title:"MUESTRA DE SUELO Y AGREGADO"})},{id:"V2",code:"V2",title:"PROBETAS",description:p({title:"PROBETAS"})},{id:"V3",code:"V3",title:"DENSIDAD DE CAMPO Y MUESTREO",description:p({title:"DENSIDAD DE CAMPO Y MUESTREO"})},{id:"V4",code:"V4",title:"EXTRACCIÓN DE DIAMANTINA",description:p({title:"EXTRACCIÓN DE DIAMANTINA"})},{id:"V5",code:"V5",title:"DIAMANTINA PARA PASES",description:p({title:"DIAMANTINA PARA PASES"})},{id:"V6",code:"V6",title:"ALBAÑILERÍA",description:p({title:"ALBAÑILERÍA"})},{id:"V7",code:"V7",title:"VIGA BECKELMAN",description:p({title:"VIGA BECKELMAN"})},{id:"V8",code:"V8",title:"CONTROL DE CALIDAD DE CONCRETO FRESCO EN OBRA",description:p({title:"CONTROL DE CALIDAD DE CONCRETO FRESCO EN OBRA"})}])}})()},[]);const y=l.useMemo(()=>m.reduce((a,t)=>a+R(t),0),[m]),S=l.useMemo(()=>r.igv?Number((y*.18).toFixed(2)):0,[y,r.igv]),z=l.useMemo(()=>Number((y+S).toFixed(2)),[y,S]),U=()=>A([...m,{...G}]),$=a=>A(m.filter((t,s)=>s!==a)),_=(a,t)=>A(m.map((s,o)=>o===a?{...s,...t}:s));l.useEffect(()=>{if(!d)return;const a=(N||[]).find(o=>String(o.id)===String(d));if(!a)return;const t=a.conditions||{};x(o=>({...o,payment_terms:t.default_payment_terms||o.payment_terms,acceptance:typeof t.default_acceptance=="boolean"?t.default_acceptance:o.acceptance,igv:typeof t.default_igv=="boolean"?t.default_igv:o.igv,reference:t.default_reference||o.reference}));const s=p(a)||a.description||"";if(s&&D(s),Array.isArray(t.default_items)&&m.length<=1&&!m[0].code&&!m[0].description&&!m[0].norm){const o=t.default_items.map(v=>({code:v.code||"",description:v.description||"",norm:v.norm||"",unit_price:Number(v.unit_price||0),quantity:Number(v.quantity||1)}));o.length&&A(o)}t.default_service_name&&!n.service_name&&b(o=>({...o,service_name:t.default_service_name}))},[d]);const F=async a=>{var t;a.preventDefault(),f(!0),M("");try{const s=/^\d+$/.test(String(d))?Number(d):null,o={project_id:((t=c.project)==null?void 0:t.id)||c.project_id||null,variant_id:s,client_contact:n.contact_name,client_email:n.contact_email,client_phone:n.contact_phone,issue_date:r.issue_date||new Date().toISOString().slice(0,10),subtotal:y,igv:S,total:z,status:"borrador",meta:{customer:n,quote:r,conditions_text:P,payment_terms:r.payment_terms,acceptance:r.acceptance,reference:r.reference,subtotal:y,igv:S,file_name:q("xxx-XX",n.company_name)}},v=await K(o);for(const C of m)await Q({quote_id:v.id,code:C.code,description:C.description,norm:C.norm,unit_price:Number(C.unit_price||0),quantity:Number(C.quantity||0),partial_price:R(C)});alert("Cotización creada"),B(v.id)}catch(s){M(s.message||"Error al crear cotización")}finally{f(!1)}},O=async a=>{try{const t=V;if(!t)return alert("Guarde la cotización antes de exportar");const s="http://localhost:4000/api".replace(/\/$/,"")||"",o=`/api/quotes/${t}/export/${a}`,v=s&&/\/api$/i.test(s)?`${s}${o.replace(/^\/api/,"")}`:`${s}${o}`;window.open(v,"_blank")}catch{alert("No se pudo exportar")}},k=async()=>{try{const a=V;if(!a)return alert("Guarde la cotización antes de generar el borrador");const t="http://localhost:4000/api".replace(/\/$/,"")||"",s=`/api/quotes/${a}/export/pdf-draft`,o=t&&/\/api$/i.test(t)?`${t}${s.replace(/^\/api/,"")}`:`${t}${s}`;window.open(o,"_blank")}catch{alert("No se pudo generar el borrador")}};return e.jsxs(X,{titulo:"Nueva Cotización LEM",descripcion:"Plantilla de cotización para Laboratorio con variantes y condiciones",children:[L&&e.jsx("div",{className:"alert alert-danger",children:L}),e.jsxs("form",{onSubmit:F,className:"lem-quote-page",children:[e.jsx("div",{className:"alert alert-light border mt-3 lem-intro",children:"Completa el formulario para crear una nueva cotización del Laboratorio (LEM). Los campos están agrupados por sección para facilitar el flujo."}),e.jsx("div",{className:"lem-stepper card shadow-sm mt-3",children:e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"d-flex justify-content-between align-items-center lem-steps",children:[{id:1,label:"Cliente y Proyecto"},{id:2,label:"Condiciones"},{id:3,label:"Ítems"},{id:4,label:"Resumen"}].map(a=>e.jsxs("div",{className:`lem-step ${j===a.id?"active":""} ${j>a.id?"done":""}`,onClick:()=>I(a.id),role:"button",children:[e.jsx("div",{className:"lem-step-index",children:a.id}),e.jsx("div",{className:"lem-step-label",children:a.label})]},a.id))})})}),j===1&&e.jsxs("div",{className:"row g-4 mt-3",children:[e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"card shadow-sm",children:[e.jsxs("div",{className:"card-header py-2",children:[e.jsx("strong",{children:"Proyecto"}),e.jsx("div",{className:"lem-subtitle",children:"Selecciona la empresa y el proyecto al que se asociará la cotización."})]}),e.jsx("div",{className:"card-body",children:e.jsx(J,{value:c,onChange:g})})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"card shadow-sm",children:[e.jsxs("div",{className:"card-header py-2",children:[e.jsx("strong",{children:"Datos del Cliente"}),e.jsx("div",{className:"lem-subtitle",children:"Información del cliente vinculada a esta cotización."})]}),e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Empresa"}),e.jsx("input",{className:"form-control",value:n.company_name,onChange:a=>b({...n,company_name:a.target.value}),required:!0}),e.jsx("div",{className:"form-text",children:"Razón social o nombre comercial del cliente."})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"R.U.C."}),e.jsx("input",{className:"form-control",value:n.ruc,onChange:a=>b({...n,ruc:a.target.value})}),e.jsx("div",{className:"form-text",children:"RUC de la empresa (si aplica). Para persona natural, deja vacío."})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Contacto"}),e.jsx("input",{className:"form-control",value:n.contact_name,onChange:a=>b({...n,contact_name:a.target.value}),required:!0}),e.jsx("div",{className:"form-text",children:"Nombre de la persona que solicita la cotización."})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Teléfono"}),e.jsx("input",{className:"form-control",value:n.contact_phone,onChange:a=>b({...n,contact_phone:a.target.value})}),e.jsx("div",{className:"form-text",children:"Teléfono del contacto para coordinaciones."})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Correo"}),e.jsx("input",{type:"email",className:"form-control",value:n.contact_email,onChange:a=>b({...n,contact_email:a.target.value})}),e.jsx("div",{className:"form-text",children:"Correo del contacto para envío de la cotización."})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Ubicación del proyecto"}),e.jsx("input",{className:"form-control",value:n.project_location,onChange:a=>b({...n,project_location:a.target.value})})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Nombre del proyecto"}),e.jsx("input",{className:"form-control",value:n.project_name,onChange:a=>b({...n,project_name:a.target.value})})]}),e.jsxs("div",{className:"mb-0",children:[e.jsx("label",{className:"form-label",children:"Nombre del servicio"}),e.jsx("input",{className:"form-control",value:n.service_name,onChange:a=>b({...n,service_name:a.target.value})}),e.jsx("div",{className:"form-text",children:"Ej.: Ensayos de suelo y agregado, Extracción de diamantina, etc."})]})]})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"card shadow-sm",children:[e.jsxs("div",{className:"card-header py-2",children:[e.jsx("strong",{children:"Datos de la Cotización"}),e.jsx("div",{className:"lem-subtitle",children:"Fechas, referencia y configuración principal."})]}),e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Fecha de Solicitud"}),e.jsx("input",{type:"date",className:"form-control",value:r.request_date,onChange:a=>x({...r,request_date:a.target.value})})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Fecha de Emisión"}),e.jsx("input",{type:"date",className:"form-control",value:r.issue_date,onChange:a=>x({...r,issue_date:a.target.value})})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Comercial"}),e.jsx("input",{className:"form-control",value:r.commercial_name,onChange:a=>x({...r,commercial_name:a.target.value})}),e.jsx("div",{className:"form-text",children:"Nombre del asesor comercial que atiende al cliente."})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Referencia"}),e.jsx("input",{className:"form-control",placeholder:"SEGÚN LO SOLICITADO VÍA correo / llamada",value:r.reference,onChange:a=>x({...r,reference:a.target.value})}),e.jsx("div",{className:"form-text",children:"Contexto corto de la solicitud (llamada, correo, OS, etc.)."})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Variante"}),e.jsxs("div",{className:"d-flex gap-2 align-items-center",children:[e.jsxs("select",{className:"form-select",value:d,onChange:a=>E(a.target.value),style:{maxWidth:"70%"},children:[e.jsx("option",{value:"",children:"Sin variante"}),(N||[]).map(a=>e.jsxs("option",{value:a.id,children:[a.code," - ",a.title]},a.id))]}),d?e.jsx("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{E(""),D("")},children:"Quitar"}):null]}),d?(()=>{const a=(N||[]).find(s=>String(s.id)===String(d));if(!a)return null;const t=p(a)||a.description||"";return e.jsxs("div",{className:"alert alert-info mt-2 p-2",children:[e.jsxs("div",{className:"fw-semibold small",children:[a.code," - ",a.title]}),t?e.jsx("div",{className:"small text-muted",style:{whiteSpace:"pre-line"},children:t}):null]})})():e.jsx("div",{className:"form-text",children:"Selecciona una variante del listado."})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Forma de pago"}),e.jsxs("select",{className:"form-select",value:r.payment_terms,onChange:a=>x({...r,payment_terms:a.target.value}),children:[e.jsx("option",{value:"adelantado",children:"Adelantado"}),e.jsx("option",{value:"50%",children:"Adelanto 50% y saldo previo al informe"}),e.jsx("option",{value:"credito7",children:"Crédito 7 días con OS"}),e.jsx("option",{value:"credito15",children:"Crédito 15 días con OS"}),e.jsx("option",{value:"credito30",children:"Crédito 30 días con OS"})]})]}),e.jsxs("div",{className:"form-check mb-3",children:[e.jsx("input",{className:"form-check-input",type:"checkbox",id:"igv",checked:r.igv,onChange:a=>x({...r,igv:a.target.checked})}),e.jsx("label",{className:"form-check-label",htmlFor:"igv",children:"Aplicar IGV 18%"})]}),e.jsxs("div",{className:"form-check mb-3",children:[e.jsx("input",{className:"form-check-input",type:"checkbox",id:"acceptance",checked:r.acceptance,onChange:a=>x({...r,acceptance:a.target.checked})}),e.jsx("label",{className:"form-check-label",htmlFor:"acceptance",children:"Aceptación de cotización"})]}),e.jsxs("div",{className:"mb-0",children:[e.jsx("label",{className:"form-label",children:"Nombre de archivo sugerido"}),e.jsx("input",{className:"form-control",value:q("xxx-XX",n.company_name),readOnly:!0})]})]})]})})]}),j===2&&e.jsxs("div",{className:"card shadow-sm lem-section-gap",children:[e.jsxs("div",{className:"card-header py-2",children:[e.jsx("strong",{children:"Condiciones específicas"}),e.jsx("div",{className:"lem-subtitle",children:"Se auto-completan según la variante; puedes editarlas."})]}),e.jsxs("div",{className:"card-body",children:[e.jsx("textarea",{className:"form-control lem-monospace",rows:8,placeholder:"Aquí aparecerán las condiciones de la variante seleccionada; puedes editarlas si es necesario.",value:P,onChange:a=>D(a.target.value)}),e.jsx("div",{className:"form-text mt-2",children:"Este texto se guardará en la cotización y se usará para PDF/Excel."})]})]}),j===3&&e.jsxs("div",{className:"card shadow-sm mt-4",children:[e.jsxs("div",{className:"card-header py-2",children:[e.jsx("strong",{children:"Ítems"}),e.jsx("div",{className:"lem-subtitle",children:"Detalle de ensayos/servicios cotizados."})]}),e.jsxs("div",{className:"card-body",children:[e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-bordered table-striped align-middle",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Código/N° ensayo"}),e.jsx("th",{children:"Descripción"}),e.jsx("th",{children:"Norma"}),e.jsx("th",{className:"text-right",children:"Unitario (S/)"}),e.jsx("th",{className:"text-right",children:"Cantidad"}),e.jsx("th",{className:"text-right",children:"Parcial (S/)"}),e.jsx("th",{})]})}),e.jsx("tbody",{children:m.map((a,t)=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("input",{className:"form-control",value:a.code,onChange:s=>_(t,{code:s.target.value})})}),e.jsx("td",{children:e.jsx("textarea",{className:"form-control",rows:1,value:a.description,onChange:s=>_(t,{description:s.target.value})})}),e.jsx("td",{children:e.jsx("input",{className:"form-control",value:a.norm,onChange:s=>_(t,{norm:s.target.value})})}),e.jsx("td",{style:{width:120},children:e.jsx("input",{type:"number",step:"0.01",className:"form-control",value:a.unit_price,onChange:s=>_(t,{unit_price:s.target.value})})}),e.jsx("td",{style:{width:100},children:e.jsx("input",{type:"number",className:"form-control",value:a.quantity,onChange:s=>_(t,{quantity:s.target.value})})}),e.jsx("td",{style:{width:120},children:R(a)}),e.jsx("td",{style:{width:80},children:e.jsx("button",{type:"button",className:"btn btn-sm btn-link text-danger",title:"Eliminar",onClick:()=>$(t),disabled:m.length===1,children:"🗑️"})})]},t))})]})}),e.jsx("div",{className:"mb-2",children:e.jsx("button",{type:"button",className:"btn btn-outline-primary",onClick:U,children:"Agregar ítem"})})]})]}),j===4&&e.jsxs("div",{className:"card shadow-sm mt-3",children:[e.jsxs("div",{className:"card-header py-2",children:[e.jsx("strong",{children:"Resumen y Acciones"}),e.jsx("div",{className:"lem-subtitle",children:"Revisa montos y genera tus archivos."})]}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"row align-items-center g-3",children:[e.jsx("div",{className:"col-md",children:e.jsxs("div",{className:"text-md-end",children:[e.jsxs("div",{children:["Subtotal: S/ ",y.toFixed(2)]}),e.jsxs("div",{children:["IGV 18%: S/ ",S.toFixed(2)]}),e.jsx("div",{children:e.jsxs("strong",{children:["Total: S/ ",z.toFixed(2)]})})]})}),e.jsx("div",{className:"col-md-auto",children:e.jsxs("div",{className:"d-flex flex-wrap gap-2 lem-actions",children:[e.jsx("button",{type:"submit",className:"btn btn-success",disabled:i||!((w=c.project)!=null&&w.id)&&!c.project_id,children:i?"Guardando...":"Guardar borrador"}),e.jsx("button",{type:"button",className:"btn btn-outline-warning",onClick:k,children:"PDF Borrador"}),e.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>O("pdf"),children:"Exportar PDF"}),e.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>O("excel"),children:"Exportar Excel"})]})})]})})]}),e.jsx("div",{className:"lem-sticky-actions",children:e.jsxs("div",{className:"container-fluid px-0 d-flex justify-content-between align-items-center gap-2 flex-wrap",children:[e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>I(Math.max(1,j-1)),disabled:j===1,children:"Anterior"}),e.jsx("button",{type:"button",className:"btn btn-primary",onClick:()=>j<4?I(j+1):F({preventDefault:()=>{}}),children:j<4?"Siguiente":i?"Guardando...":"Guardar borrador"})]}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx("button",{type:"button",className:"btn btn-outline-warning",onClick:k,children:"PDF Borrador"}),e.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>O("pdf"),children:"Exportar PDF"}),e.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>O("excel"),children:"Exportar Excel"})]})]})})]})]})}export{re as default};
//# sourceMappingURL=CotizacionNuevaLEM-CUYMo7iR.js.map
