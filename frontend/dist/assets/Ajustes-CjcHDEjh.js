import{a as O,r as o,b as F,j as e,z as V,n as X,C as Q,aH as Z,B as m,Z as $,X as W,aI as Y,T as ee,I as se,a9 as E,o as ae,aJ as re,m as ie,v as le,p as ne,aK as L,w as oe}from"./index-Dcu-y_Nk.js";import{P as ce}from"./PageHeader-PmjZbYHY.js";import{R as f}from"./Row-WYeb25UG.js";import{C as n}from"./Col-c57Xg6FM.js";import{C as h}from"./Card-CTICXyCo.js";import{T as te,a as N}from"./Tabs-D4nEbgrV.js";import{S as de}from"./Spinner-B-FgOVHr.js";import{A as g}from"./Alert-CXOKGb3T.js";import{F as r}from"./Form-DatFUB1A.js";import{I as me}from"./InputGroup-DtNgqv5E.js";import"./ElementChildren-BevWbOM2.js";const Ce=()=>{const{user:a,logout:z,updateUser:R}=O(),[T,B]=o.useState("profile"),[y,D]=o.useState(!1),[c,C]=o.useState(!1),[d,v]=o.useState(!1),[k,t]=o.useState(null),[A,u]=o.useState(null),[i,x]=o.useState({name:(a==null?void 0:a.name)||"",apellido:(a==null?void 0:a.apellido)||"",email:(a==null?void 0:a.email)||"",phone:(a==null?void 0:a.phone)||"",area:(a==null?void 0:a.area)||""}),[I,_]=o.useState([]),[j,b]=o.useState({currentPassword:"",newPassword:"",confirmPassword:""}),[w,K]=o.useState({email:!0,push:!1,sms:!1});o.useEffect(()=>{G(),U()},[]);const G=async()=>{try{v(!0),t(null);const l=(await F("/api/auth/me")).user;x({name:l.name||"",apellido:l.apellido||"",email:l.email||"",phone:l.phone||"",area:l.area||""})}catch(s){console.error("Error cargando perfil:",s),t("Error al cargar los datos del perfil")}finally{v(!1)}},U=async()=>{try{const s=await F("/api/users/areas");_(s.areas||[])}catch(s){console.error("Error cargando áreas:",s)}},q=s=>({admin:"danger",jefa_comercial:"warning",vendedor_comercial:"primary",jefe_laboratorio:"info",usuario_laboratorio:"secondary",laboratorio:"secondary",facturacion:"success",soporte:"success",gerencia:"dark"})[s]||"secondary",H=s=>({admin:"Administrador",jefa_comercial:"Jefa Comercial",vendedor_comercial:"Vendedor",jefe_laboratorio:"Jefe Laboratorio",usuario_laboratorio:"Usuario Laboratorio",laboratorio:"Laboratorio",facturacion:"Facturación",soporte:"Soporte",gerencia:"Gerencia"})[s]||s,J=async()=>{var s,l;try{if(v(!0),t(null),u(null),!i.name.trim()){t("El nombre es requerido");return}if(!i.email.trim()){t("El email es requerido");return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(i.email)){t("El formato del email no es válido");return}const S=await F("/api/auth/me",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});S.user&&R(S.user),C(!1),u("Perfil actualizado exitosamente"),console.log("Perfil actualizado:",S),setTimeout(()=>u(null),3e3)}catch(p){console.error("Error actualizando perfil:",p),t(((l=(s=p.response)==null?void 0:s.data)==null?void 0:l.error)||"Error al actualizar el perfil")}finally{v(!1)}},M=()=>{b({currentPassword:"",newPassword:"",confirmPassword:""}),console.log("Contraseña actualizada")},P=(s,l)=>{K(p=>({...p,[s]:l}))};return e.jsxs("div",{className:"fade-in",children:[e.jsx(ce,{title:"Configuración y Ajustes",subtitle:"Gestiona tu perfil, configuración y preferencias del sistema",icon:V}),e.jsxs(f,{className:"g-4",children:[e.jsxs(n,{lg:4,children:[e.jsx(h,{className:"h-100",children:e.jsxs(h.Body,{className:"text-center",children:[e.jsx("div",{className:"mb-3",children:e.jsx("div",{className:"bg-primary bg-opacity-10 rounded-circle p-4 d-inline-flex align-items-center justify-content-center",children:e.jsx(X,{size:48,className:"text-primary"})})}),e.jsx("h4",{className:"fw-bold",children:a==null?void 0:a.name}),e.jsx("p",{className:"text-muted mb-2",children:a==null?void 0:a.email}),e.jsx(Q,{bg:q(a==null?void 0:a.role),className:"status-badge mb-3",children:H(a==null?void 0:a.role)}),(a==null?void 0:a.area)&&e.jsxs("div",{className:"text-muted small",children:[e.jsx(Z,{className:"me-1"}),"Área: ",a.area]})]})}),e.jsxs(h,{className:"mt-4",children:[e.jsx(h.Header,{children:e.jsx("h6",{className:"mb-0",children:"Acciones Rápidas"})}),e.jsx(h.Body,{children:e.jsxs("div",{className:"d-grid gap-2",children:[e.jsxs(m,{variant:"outline-primary",size:"sm",children:[e.jsx($,{className:"me-2"}),"Exportar Datos"]}),e.jsxs(m,{variant:"outline-secondary",size:"sm",children:[e.jsx(W,{className:"me-2"}),"Historial de Actividad"]}),e.jsxs(m,{variant:"outline-danger",size:"sm",onClick:z,children:[e.jsx(Y,{className:"me-2"}),"Cerrar Sesión"]})]})})]})]}),e.jsx(n,{lg:8,children:e.jsx(h,{children:e.jsx(h.Body,{children:e.jsxs(te,{activeKey:T,onSelect:s=>B(s),className:"mb-4",children:[e.jsx(N,{eventKey:"profile",title:"Perfil",children:e.jsxs("div",{className:"p-3",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[e.jsx("h5",{children:"Información Personal"}),(a==null?void 0:a.role)==="admin"&&e.jsx(m,{variant:c?"success":"outline-primary",size:"sm",onClick:()=>c?J():C(!0),disabled:d,children:d?e.jsxs(e.Fragment,{children:[e.jsx(de,{size:"sm",className:"me-1"}),"Guardando..."]}):c?e.jsxs(e.Fragment,{children:[e.jsx(ee,{className:"me-1"}),"Guardar"]}):e.jsxs(e.Fragment,{children:[e.jsx(se,{className:"me-1"}),"Editar"]})}),(a==null?void 0:a.role)!=="admin"&&e.jsxs("div",{className:"alert alert-info",children:[e.jsx(E,{className:"me-2"}),"Solo los administradores pueden editar la información del perfil."]})]}),k&&e.jsx(g,{variant:"danger",dismissible:!0,onClose:()=>t(null),children:k}),A&&e.jsx(g,{variant:"success",dismissible:!0,onClose:()=>u(null),children:A}),e.jsxs(f,{className:"g-3",children:[e.jsx(n,{md:6,children:e.jsxs(r.Group,{children:[e.jsx(r.Label,{children:"Nombre"}),e.jsx(r.Control,{type:"text",value:i.name,onChange:s=>x({...i,name:s.target.value}),disabled:!c||d,required:!0})]})}),e.jsx(n,{md:6,children:e.jsxs(r.Group,{children:[e.jsx(r.Label,{children:"Apellido"}),e.jsx(r.Control,{type:"text",value:i.apellido,onChange:s=>x({...i,apellido:s.target.value}),disabled:!c||d})]})}),e.jsx(n,{md:6,children:e.jsxs(r.Group,{children:[e.jsx(r.Label,{children:"Email"}),e.jsx(r.Control,{type:"email",value:i.email,onChange:s=>x({...i,email:s.target.value}),disabled:!c||d,required:!0})]})}),e.jsx(n,{md:6,children:e.jsxs(r.Group,{children:[e.jsx(r.Label,{children:"Teléfono"}),e.jsx(r.Control,{type:"tel",value:i.phone,onChange:s=>x({...i,phone:s.target.value}),disabled:!c||d,placeholder:"Número de teléfono"})]})})]}),e.jsx(f,{children:e.jsx(n,{md:6,children:e.jsxs(r.Group,{children:[e.jsx(r.Label,{children:"Área"}),e.jsxs(r.Select,{value:i.area,onChange:s=>x({...i,area:s.target.value}),disabled:!c||d,children:[e.jsx("option",{value:"",children:"Seleccionar área"}),I.map((s,l)=>e.jsx("option",{value:s,children:s},l))]})]})})}),c&&e.jsx("div",{className:"mt-3",children:e.jsxs(m,{variant:"outline-secondary",size:"sm",onClick:()=>{C(!1),t(null),u(null),G()},disabled:d,children:[e.jsx(ae,{className:"me-1"}),"Cancelar"]})})]})}),e.jsx(N,{eventKey:"security",title:"Seguridad",children:e.jsxs("div",{className:"p-3",children:[e.jsx("h5",{className:"mb-4",children:"Cambiar Contraseña"}),e.jsxs(f,{className:"g-3",children:[e.jsx(n,{md:12,children:e.jsxs(r.Group,{children:[e.jsx(r.Label,{children:"Contraseña Actual"}),e.jsxs(me,{children:[e.jsx(r.Control,{type:y?"text":"password",value:j.currentPassword,onChange:s=>b({...j,currentPassword:s.target.value})}),e.jsx(m,{variant:"outline-secondary",onClick:()=>D(!y),children:y?e.jsx(re,{}):e.jsx(ie,{})})]})]})}),e.jsx(n,{md:6,children:e.jsxs(r.Group,{children:[e.jsx(r.Label,{children:"Nueva Contraseña"}),e.jsx(r.Control,{type:"password",value:j.newPassword,onChange:s=>b({...j,newPassword:s.target.value})})]})}),e.jsx(n,{md:6,children:e.jsxs(r.Group,{children:[e.jsx(r.Label,{children:"Confirmar Contraseña"}),e.jsx(r.Control,{type:"password",value:j.confirmPassword,onChange:s=>b({...j,confirmPassword:s.target.value})})]})})]}),e.jsx("div",{className:"mt-3",children:e.jsxs(m,{variant:"primary",onClick:M,children:[e.jsx(le,{className:"me-1"}),"Cambiar Contraseña"]})}),e.jsxs(g,{variant:"info",className:"mt-4",children:[e.jsx(E,{className:"me-2"}),e.jsx("strong",{children:"Recomendaciones de seguridad:"}),e.jsxs("ul",{className:"mb-0 mt-2",children:[e.jsx("li",{children:"Usa al menos 8 caracteres"}),e.jsx("li",{children:"Incluye mayúsculas, minúsculas y números"}),e.jsx("li",{children:"Evita información personal"})]})]})]})}),e.jsx(N,{eventKey:"notifications",title:"Notificaciones",children:e.jsxs("div",{className:"p-3",children:[e.jsx("h5",{className:"mb-4",children:"Preferencias de Notificaciones"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center p-3 border rounded",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"fw-medium",children:[e.jsx(ne,{className:"me-2"}),"Notificaciones por Email"]}),e.jsx("small",{className:"text-muted",children:"Recibe notificaciones importantes por correo electrónico"})]}),e.jsx(r.Check,{type:"switch",checked:w.email,onChange:s=>P("email",s.target.checked)})]}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center p-3 border rounded",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"fw-medium",children:[e.jsx(L,{className:"me-2"}),"Notificaciones Push"]}),e.jsx("small",{className:"text-muted",children:"Recibe notificaciones en tiempo real en el navegador"})]}),e.jsx(r.Check,{type:"switch",checked:w.push,onChange:s=>P("push",s.target.checked)})]}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center p-3 border rounded",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"fw-medium",children:[e.jsx(L,{className:"me-2"}),"Notificaciones SMS"]}),e.jsx("small",{className:"text-muted",children:"Recibe notificaciones críticas por mensaje de texto"})]}),e.jsx(r.Check,{type:"switch",checked:w.sms,onChange:s=>P("sms",s.target.checked)})]})]}),e.jsx("div",{className:"mt-4",children:e.jsxs(m,{variant:"primary",children:[e.jsx(oe,{className:"me-1"}),"Guardar Preferencias"]})})]})}),e.jsx(N,{eventKey:"system",title:"Sistema",children:e.jsxs("div",{className:"p-3",children:[e.jsx("h5",{className:"mb-4",children:"Información del Sistema"}),e.jsxs(f,{className:"g-3",children:[e.jsx(n,{md:6,children:e.jsxs("div",{className:"p-3 border rounded",children:[e.jsx("h6",{children:"Versión del Sistema"}),e.jsx("p",{className:"text-muted mb-0",children:"CRM GeoFal v1.0.0"})]})}),e.jsx(n,{md:6,children:e.jsxs("div",{className:"p-3 border rounded",children:[e.jsx("h6",{children:"Última Actualización"}),e.jsx("p",{className:"text-muted mb-0",children:"15 de Enero, 2025"})]})}),e.jsx(n,{md:6,children:e.jsxs("div",{className:"p-3 border rounded",children:[e.jsx("h6",{children:"Base de Datos"}),e.jsx("p",{className:"text-muted mb-0",children:"PostgreSQL 14.0"})]})}),e.jsx(n,{md:6,children:e.jsxs("div",{className:"p-3 border rounded",children:[e.jsx("h6",{children:"Servidor"}),e.jsx("p",{className:"text-muted mb-0",children:"Node.js 18.0"})]})})]}),e.jsxs(g,{variant:"info",className:"mt-4",children:[e.jsx(E,{className:"me-2"}),"Para más información sobre el sistema, contacta al administrador."]})]})})]})})})})]})]})};export{Ce as default};
//# sourceMappingURL=Ajustes-CjcHDEjh.js.map
