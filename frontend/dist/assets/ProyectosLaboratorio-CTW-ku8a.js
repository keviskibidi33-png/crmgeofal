import{a as P,r as c,b as S,j as e,C as p,B as x,t as B,F as _,a9 as D,N as L,q as T,m as Q,W as M,v as k}from"./index-xQVByYRi.js";import{S as R}from"./Spinner-C2jXaFYJ.js";import{A as U}from"./Alert-BijlR5uZ.js";import{R as h,C as r}from"./Row-mPOlevGM.js";import{C as n}from"./Col-Dz9zKzWQ.js";import{F as v}from"./Form-BAZkilfb.js";import{T as V}from"./Table-6IySdngi.js";import"./ElementChildren-BP-7Da5j.js";const X=()=>{const{user:$}=P(),[l,A]=c.useState([]),[j,z]=c.useState([]),[E,f]=c.useState(!0),[g,N]=c.useState(null),[i,d]=c.useState({status:"",vendedor:"",cliente:""});c.useEffect(()=>{y()},[]);const y=async()=>{try{f(!0),N(null);const s=await S("/api/projects/laboratory");A(s||[]);const t=await S("/api/quotes/with-projects");z(t||[])}catch(s){console.error("Error fetching data:",s),N("Error al cargar los datos: "+(s.message||"Error desconocido"))}finally{f(!1)}},b=s=>{const a={borrador:{variant:"warning",text:"Borrador"},aprobada:{variant:"success",text:"Aprobada"},facturada:{variant:"info",text:"Facturada"},activo:{variant:"primary",text:"Activo"},completado:{variant:"success",text:"Completado"}}[s]||{variant:"secondary",text:s};return e.jsx(k,{bg:a.variant,children:a.text})},u=s=>{const t=j.filter(a=>a.project_id===s.id);return t.length===0?"sin_cotizaciones":t.some(a=>a.status==="facturada")?"completado":t.some(a=>a.status==="aprobada")?"en_proceso":t.some(a=>a.status==="borrador")?"pendiente":"activo"},C=s=>{const t=j.filter(a=>a.project_id===s.id);return{totalQuotes:t.length,approvedQuotes:t.filter(a=>a.status==="aprobada").length,invoicedQuotes:t.filter(a=>a.status==="facturada").length,totalAmount:t.reduce((a,m)=>a+(m.total||0),0),lastActivity:t.length>0?new Date(Math.max(...t.map(a=>new Date(a.updated_at)))):new Date(s.updated_at)}},w=l.filter(s=>{var t,a;return!(i.status&&u(s)!==i.status||i.vendedor&&!((t=s.created_by_name)!=null&&t.toLowerCase().includes(i.vendedor.toLowerCase()))||i.cliente&&!((a=s.company_name)!=null&&a.toLowerCase().includes(i.cliente.toLowerCase())))});return E?e.jsx(p,{className:"py-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx(R,{animation:"border"}),e.jsx("p",{className:"mt-2",children:"Cargando proyectos de laboratorio..."})]})}):g?e.jsx(p,{className:"py-4",children:e.jsx(U,{variant:"danger",children:g})}):e.jsxs(p,{className:"py-4",children:[e.jsxs(h,{className:"mb-4",children:[e.jsxs(n,{children:[e.jsx("h2",{children:"ðŸ§ª Proyectos de Laboratorio"}),e.jsx("p",{className:"text-muted",children:"Proyectos asignados para trabajo de laboratorio"})]}),e.jsx(n,{md:"auto",children:e.jsxs(x,{variant:"outline-secondary",onClick:y,children:[e.jsx(B,{className:"me-2"}),"Actualizar"]})})]}),e.jsxs(h,{className:"mb-4",children:[e.jsx(n,{md:3,children:e.jsxs(v.Select,{value:i.status,onChange:s=>d(t=>({...t,status:s.target.value})),children:[e.jsx("option",{value:"",children:"Todos los estados"}),e.jsx("option",{value:"pendiente",children:"Pendiente"}),e.jsx("option",{value:"en_proceso",children:"En Proceso"}),e.jsx("option",{value:"completado",children:"Completado"}),e.jsx("option",{value:"sin_cotizaciones",children:"Sin Cotizaciones"})]})}),e.jsx(n,{md:3,children:e.jsx(v.Control,{type:"text",placeholder:"Filtrar por vendedor...",value:i.vendedor,onChange:s=>d(t=>({...t,vendedor:s.target.value}))})}),e.jsx(n,{md:3,children:e.jsx(v.Control,{type:"text",placeholder:"Filtrar por cliente...",value:i.cliente,onChange:s=>d(t=>({...t,cliente:s.target.value}))})}),e.jsx(n,{md:3,children:e.jsx("div",{className:"d-flex gap-2",children:e.jsx(x,{variant:"outline-secondary",onClick:()=>d({status:"",vendedor:"",cliente:""}),children:"Limpiar"})})})]}),e.jsxs(h,{className:"mb-4",children:[e.jsx(n,{md:3,children:e.jsx(r,{className:"text-center",children:e.jsxs(r.Body,{children:[e.jsx(_,{size:24,className:"text-primary mb-2"}),e.jsx("h4",{children:l.length}),e.jsx("small",{className:"text-muted",children:"Total Proyectos"})]})})}),e.jsx(n,{md:3,children:e.jsx(r,{className:"text-center",children:e.jsxs(r.Body,{children:[e.jsx(D,{size:24,className:"text-success mb-2"}),e.jsx("h4",{children:l.filter(s=>u(s)==="en_proceso").length}),e.jsx("small",{className:"text-muted",children:"En Proceso"})]})})}),e.jsx(n,{md:3,children:e.jsx(r,{className:"text-center",children:e.jsxs(r.Body,{children:[e.jsx(L,{size:24,className:"text-info mb-2"}),e.jsxs("h4",{children:["S/ ",l.reduce((s,t)=>{const a=C(t);return s+a.totalAmount},0).toFixed(2)]}),e.jsx("small",{className:"text-muted",children:"Monto Total"})]})})}),e.jsx(n,{md:3,children:e.jsx(r,{className:"text-center",children:e.jsxs(r.Body,{children:[e.jsx(T,{size:24,className:"text-warning mb-2"}),e.jsx("h4",{children:new Set(l.map(s=>s.created_by_name)).size}),e.jsx("small",{className:"text-muted",children:"Vendedores Asignados"})]})})})]}),e.jsx(h,{children:w.length===0?e.jsx(n,{children:e.jsx(r,{children:e.jsxs(r.Body,{className:"text-center py-5",children:[e.jsx(_,{size:48,className:"text-muted mb-3"}),e.jsx("h5",{children:"No hay proyectos"}),e.jsx("p",{className:"text-muted",children:Object.values(i).some(s=>s)?"No se encontraron proyectos con los filtros aplicados":"No hay proyectos asignados para laboratorio"})]})})}):w.map(s=>{const t=C(s),a=u(s),m=j.filter(o=>o.project_id===s.id);return e.jsx(n,{md:6,lg:4,className:"mb-3",children:e.jsxs(r,{children:[e.jsxs(r.Header,{className:"d-flex justify-content-between align-items-center",children:[e.jsx("strong",{children:s.name}),b(a)]}),e.jsxs(r.Body,{children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Cliente:"})," ",s.company_name||"N/A"]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Vendedor:"})," ",s.created_by_name||"N/A"]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"UbicaciÃ³n:"})," ",s.location||"N/A"]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"DescripciÃ³n:"})," ",s.description||"Sin descripciÃ³n"]}),e.jsx("hr",{}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Cotizaciones:"})," ",t.totalQuotes]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Monto Total:"})," S/ ",t.totalAmount.toFixed(2)]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Ãšltima Actividad:"})," ",t.lastActivity.toLocaleDateString()]}),m.length>0&&e.jsxs("div",{className:"mt-3",children:[e.jsx("h6",{children:"Cotizaciones del Proyecto:"}),e.jsxs(V,{size:"sm",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"NÃºmero"}),e.jsx("th",{children:"Estado"}),e.jsx("th",{children:"Monto"})]})}),e.jsx("tbody",{children:m.map(o=>{var F;return e.jsxs("tr",{children:[e.jsx("td",{children:o.quote_number||`COT-${o.id}`}),e.jsx("td",{children:b(o.status)}),e.jsxs("td",{children:["S/ ",((F=o.total)==null?void 0:F.toFixed(2))||"0.00"]})]},o.id)})})]})]}),e.jsxs("div",{className:"d-flex gap-2 mt-3",children:[e.jsxs(x,{variant:"outline-primary",size:"sm",onClick:()=>{window.location.href=`/proyectos/${s.id}`},children:[e.jsx(Q,{className:"me-1"}),"Ver Detalles"]}),e.jsxs(x,{variant:"outline-success",size:"sm",onClick:()=>{window.location.href=`/proyectos/${s.id}/evidencias`},children:[e.jsx(M,{className:"me-1"}),"Subir Evidencias"]})]})]})]})},s.id)})})]})};export{X as default};
//# sourceMappingURL=ProyectosLaboratorio-CTW-ku8a.js.map
