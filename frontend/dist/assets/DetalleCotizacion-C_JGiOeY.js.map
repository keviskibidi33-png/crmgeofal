{"version":3,"file":"DetalleCotizacion-C_JGiOeY.js","sources":["../../src/pages/DetalleCotizacion.jsx"],"sourcesContent":["import React, { useEffect, useMemo, useState } from 'react';\r\nimport { useParams } from 'react-router-dom';\r\nimport ModuloBase from '../components/ModuloBase';\r\nimport { getQuote, listQuoteItems } from '../services/quotes';\r\n\r\nexport default function DetalleCotizacion() {\r\n  const { id } = useParams();\r\n  const [row, setRow] = useState(null);\r\n  const [items, setItems] = useState([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState('');\r\n\r\n  useEffect(() => {\r\n    (async () => {\r\n      try {\r\n        setLoading(true);\r\n        setError('');\r\n        const [q, its] = await Promise.all([\r\n          getQuote(id),\r\n          listQuoteItems(id)\r\n        ]);\r\n        setRow(q);\r\n        setItems(Array.isArray(its?.data) ? its.data : (its || []));\r\n      } catch (e) {\r\n        setError(e.message || 'No se pudo cargar la cotización');\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    })();\r\n  }, [id]);\r\n\r\n  const subtotal = useMemo(() => {\r\n    return items.reduce((acc, it) => acc + Number(it.partial_price || 0), 0);\r\n  }, [items]);\r\n  const igvAmount = useMemo(() => Number(row?.igv || 0), [row]);\r\n  const total = useMemo(() => Number(row?.total || (subtotal + igvAmount)), [row, subtotal, igvAmount]);\r\n\r\n  const exportUrl = (type) => {\r\n    const base = import.meta.env?.VITE_API_URL?.replace(/\\/$/, '') || '';\r\n    const path = `/api/quotes/${id}/export/${type}`;\r\n    return base && /\\/api$/i.test(base) ? `${base}${path.replace(/^\\/api/, '')}` : `${base}${path}`;\r\n  };\r\n\r\n  return (\r\n    <ModuloBase titulo={`Cotización #${id}`} descripcion=\"Detalle y edición básica de la cotización\">\r\n      {loading && <div>Cargando...</div>}\r\n      {error && <div className=\"alert alert-danger\">{error}</div>}\r\n      {row && (\r\n        <>\r\n          <div className=\"row g-3\">\r\n            <div className=\"col-md-4\"><strong>Proyecto:</strong> {row.project_name || row.project_id}</div>\r\n            <div className=\"col-md-4\"><strong>Emisión:</strong> {row.issue_date?.slice(0,10)}</div>\r\n            <div className=\"col-md-4\"><strong>Estado:</strong> {row.status}</div>\r\n          </div>\r\n          <div className=\"table-responsive mt-3\">\r\n            <table className=\"table table-bordered align-middle\">\r\n              <thead>\r\n                <tr>\r\n                  <th>Código</th>\r\n                  <th>Descripción</th>\r\n                  <th>Norma</th>\r\n                  <th>Unitario</th>\r\n                  <th>Cantidad</th>\r\n                  <th>Parcial</th>\r\n                </tr>\r\n              </thead>\r\n              <tbody>\r\n                {items.map(it => (\r\n                  <tr key={it.id}>\r\n                    <td>{it.code}</td>\r\n                    <td>{it.description}</td>\r\n                    <td>{it.norm}</td>\r\n                    <td>S/ {Number(it.unit_price||0).toFixed(2)}</td>\r\n                    <td>{it.quantity}</td>\r\n                    <td>S/ {Number(it.partial_price||0).toFixed(2)}</td>\r\n                  </tr>\r\n                ))}\r\n                {items.length === 0 && (\r\n                  <tr><td colSpan=\"6\" className=\"text-center text-muted\">Sin ítems</td></tr>\r\n                )}\r\n              </tbody>\r\n            </table>\r\n          </div>\r\n          <div className=\"d-flex justify-content-end gap-4\">\r\n            <div className=\"text-end\">\r\n              <div>Subtotal: S/ {subtotal.toFixed(2)}</div>\r\n              <div>IGV: S/ {igvAmount.toFixed(2)}</div>\r\n              <div><strong>Total: S/ {total.toFixed(2)}</strong></div>\r\n            </div>\r\n            <a className=\"btn btn-outline-secondary\" href={exportUrl('pdf')} target=\"_blank\" rel=\"noreferrer\">PDF</a>\r\n            <a className=\"btn btn-outline-secondary\" href={exportUrl('excel')} target=\"_blank\" rel=\"noreferrer\">Excel</a>\r\n          </div>\r\n        </>\r\n      )}\r\n    </ModuloBase>\r\n  );\r\n}\r\n"],"names":["DetalleCotizacion","id","useParams","row","setRow","useState","items","setItems","loading","setLoading","error","setError","useEffect","q","its","getQuote","listQuoteItems","e","subtotal","useMemo","acc","it","igvAmount","total","exportUrl","type","base","path","ModuloBase","jsx","jsxs","Fragment","_a"],"mappings":"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"}