import{r as c,e as na,j as e,C as de,ac as sa,F as ca,y as xe,a0 as ra,ad as la,o as ia,Q as da,a8 as we,K as ma,n as ua,a1 as pa,B as re,a9 as ha,ae as ga,a7 as xa}from"./index-_ax5caxz.js";import{M as ja}from"./ModuloBase-IKDNeIaP.js";import{g as fa,u as Na,c as ba}from"./quotes-0wRJnrS0.js";import{s as Le,l as ya,c as va}from"./projects-Bg-18s7b.js";import{l as _a,j as Ca}from"./companies-abHNH47F.js";import{s as Ea}from"./subservices-BDRQcziS.js";import{S as je}from"./Spinner-CWz_2665.js";import{F as De}from"./Form-Bfp_I-3p.js";import{S as Sa}from"./SuccessModal-klYMzJZS.js";import{M as Z}from"./Modal-CGO4qTye.js";import{A as le}from"./Alert-e0x4JDT9.js";import{L as Ie}from"./ListGroup-NnvU_iu4.js";/* empty css                     */import"./ElementChildren-B77MQmQf.js";import"./Col-DhWa0-63.js";function Oe(u){if(!u||typeof u!="string")return[];const p=[],d=/\b([A-Z]{2}\d{2,3})\b/g;let N;for(;(N=d.exec(u))!==null;){const P=N[1];P&&!p.includes(P)&&p.push(P)}return p}function Aa(u){if(!u||u.length===0)return"";if(u.length===1)return`Requiere: ${u[0].codigo}`;if(u.length<=3)return`Requiere: ${u.map(P=>P.codigo).join(", ")}`;const p=u.slice(0,3).map(N=>N.codigo).join(", "),d=u.length-3;return`Requiere: ${p} y ${d} mÃ¡s`}const wa=({value:u="",onChange:p,onSelect:d,onDependenciesSelect:N,placeholder:P="Buscar servicio...",disabled:w=!1,size:T="sm"})=>{const[s,g]=c.useState(u),[m,A]=c.useState(!1),[r,_]=c.useState({top:0,left:0,width:0}),y=c.useRef(null),O=c.useRef(null),[z,U]=c.useState(s);c.useEffect(()=>{const i=setTimeout(()=>U(s),400);return()=>clearTimeout(i)},[s]);const{data:F,isLoading:l}=na(["subservices",z],()=>Ea(z),{enabled:z.length>=2,staleTime:10*60*1e3,keepPreviousData:!0,refetchOnWindowFocus:!1}),C=(F==null?void 0:F.data)||[],k=()=>{if(y.current&&m){const i=y.current.getBoundingClientRect();_({top:i.bottom+window.scrollY+2,left:i.left+window.scrollX,width:i.width})}};c.useEffect(()=>{if(m){k();const i=()=>{m&&k()},v=()=>{m&&k()};return window.addEventListener("scroll",i,!0),window.addEventListener("resize",v),()=>{window.removeEventListener("scroll",i,!0),window.removeEventListener("resize",v)}}},[m]);const H=i=>{const v=i.target.value;g(v),p==null||p(v),v.length>=2?A(!0):A(!1)},me=()=>{s.length>=2&&(A(!0),k())},fe=i=>{if(g(i.display_text),A(!1),d==null||d(i),N&&i.comentarios){console.log("ðŸ” Analizando dependencias para:",i.codigo),console.log("ðŸ“ Comentario:",i.comentarios);const v=Oe(i.comentarios);if(console.log("ðŸ”— Dependencias encontradas:",v),v.length>0){const q=C.filter(L=>v.includes(L.codigo));console.log("ðŸ“‹ Items dependientes encontrados:",q),q.length>0&&N(q)}}},ee=()=>{g(""),A(!1),p==null||p(""),d==null||d(null)};c.useEffect(()=>{const i=v=>{y.current&&!y.current.contains(v.target)&&O.current&&!O.current.contains(v.target)&&A(!1)};if(m)return document.addEventListener("mousedown",i),()=>document.removeEventListener("mousedown",i)},[m]);const Ne=i=>i===0?"Sujeto a evaluaciÃ³n":`S/ ${i.toFixed(2)}`,ae=i=>({"ENSAYO ESTÃNDAR":"primary","ENSAYOS ESPECIALES":"success","ENSAYOS DE CAMPO":"info","ENSAYO AGREGADO":"warning"})[i]||"secondary",ue=m&&s.length>=2&&e.jsxs("div",{ref:O,style:{position:"absolute",top:`${r.top}px`,left:`${r.left}px`,width:`${r.width}px`,zIndex:999999,maxHeight:"300px",overflowY:"auto",backgroundColor:"white",border:"1px solid #dee2e6",borderRadius:"4px",boxShadow:"0 4px 12px rgba(0,0,0,0.15)"},onMouseDown:i=>i.preventDefault(),children:[l&&e.jsxs("div",{className:"p-3 text-center text-muted",children:[e.jsx(je,{animation:"border",size:"sm",className:"me-2"}),e.jsx("small",{children:"Buscando..."})]}),!l&&C.length===0&&e.jsx("div",{className:"p-3 text-center text-muted",children:e.jsx("small",{children:"No se encontraron resultados"})}),!l&&C.length>0&&C.map(i=>{const v=Oe(i.comentarios),q=v.length>0;return e.jsx("div",{className:"p-2 border-bottom",onClick:()=>fe(i),style:{cursor:"pointer",transition:"background-color 0.15s"},onMouseEnter:L=>L.currentTarget.style.backgroundColor="#f8f9fa",onMouseLeave:L=>L.currentTarget.style.backgroundColor="white",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-start",children:[e.jsxs("div",{className:"flex-grow-1",children:[e.jsxs("div",{className:"d-flex align-items-center gap-2 mb-1",children:[e.jsx(de,{bg:ae(i.service_name),className:"small",children:i.codigo}),q&&e.jsxs(de,{bg:"warning",text:"dark",className:"small",children:[e.jsx(sa,{size:10,className:"me-1"}),"Con dependencias"]})]}),e.jsx("div",{className:"fw-bold small text-dark",children:i.descripcion}),i.norma&&i.norma!=="-"&&e.jsxs("div",{className:"text-muted",style:{fontSize:"0.75rem"},children:[e.jsx(ca,{size:10,className:"me-1"}),i.norma]}),q&&e.jsxs("div",{className:"text-info mt-1",style:{fontSize:"0.7rem"},children:[e.jsx(xe,{size:8,className:"me-1"}),Aa(v.map(L=>({codigo:L})))]})]}),e.jsx("div",{className:"text-end ms-2",children:e.jsxs("div",{className:"fw-bold text-success small",children:[e.jsx(ra,{size:12}),Ne(i.precio)]})})]})},i.id)})]});return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"position-relative",children:e.jsx(De.Group,{className:"mb-0",children:e.jsxs("div",{className:"position-relative",children:[e.jsx(De.Control,{ref:y,type:"text",value:s,onChange:H,onFocus:me,placeholder:P,disabled:w,size:T,className:"pe-5",autoComplete:"off"}),e.jsxs("div",{className:"position-absolute top-50 end-0 translate-middle-y pe-3 d-flex align-items-center gap-2",children:[l&&e.jsx(je,{animation:"border",size:"sm",variant:"primary"}),!l&&s&&e.jsx(ia,{className:"text-muted",onClick:ee,onMouseDown:i=>i.preventDefault(),style:{cursor:"pointer"}}),!l&&!s&&e.jsx(da,{className:"text-muted"})]})]})})}),typeof document<"u"&&ue&&la.createPortal(ue,document.body)]})},Da=({show:u,onHide:p,projectName:d,companyId:N,onSelectExisting:P,onCreateNew:w})=>{const[T,s]=c.useState([]),[g,m]=c.useState(!1),[A,r]=c.useState(null);c.useEffect(()=>{console.log("ðŸ” ProjectSelectionModal - useEffect triggered:",{show:u,projectName:d,companyId:N}),u&&d&&d.trim().length>=2&&_()},[u,d,N]);const _=async()=>{try{console.log("ðŸ” ProjectSelectionModal - Iniciando bÃºsqueda:",{projectName:d,companyId:N}),m(!0),r(null);const l=await Le(d,N);console.log("âœ… ProjectSelectionModal - Proyectos encontrados:",l),s(l||[])}catch(l){console.error("âŒ ProjectSelectionModal - Error searching projects:",l),r("Error al buscar proyectos existentes")}finally{m(!1)}},y=l=>{P(l),p()},O=()=>{w(),p()},z=()=>{const l=T.length+1,C=`${d} (${l})`;w(C),p()},U=l=>{const C=prompt(`Editar nombre del proyecto "${l.name}":`,l.name);C&&C.trim()!==l.name&&(console.log("Editar proyecto:",l.id,"nuevo nombre:",C),alert(`Funcionalidad de ediciÃ³n en desarrollo. Proyecto: ${l.name} â†’ ${C}`))},F=l=>new Date(l).toLocaleDateString("es-PE");return e.jsxs(Z,{show:u,onHide:p,size:"lg",centered:!0,style:{zIndex:9999},children:[e.jsx(Z.Header,{closeButton:!0,children:e.jsxs(Z.Title,{children:[e.jsx(we,{className:"me-2"}),'Proyectos Existentes: "',d,'"']})}),e.jsxs(Z.Body,{children:[g&&e.jsxs("div",{className:"text-center py-4",children:[e.jsx(je,{animation:"border"}),e.jsx("p",{className:"mt-2",children:"Buscando proyectos existentes..."})]}),A&&e.jsx(le,{variant:"danger",children:A}),!g&&!A&&T.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(le,{variant:"warning",className:"mb-3",children:e.jsxs("div",{children:[e.jsxs("strong",{children:["âš ï¸ Se encontraron ",T.length,' proyecto(s) con el nombre "',d,'" en esta empresa.']}),e.jsx("br",{}),"Para evitar confusiones, el sistema sugiere diferenciarlos automÃ¡ticamente."]})}),e.jsx(le,{variant:"info",className:"mb-3",children:e.jsxs("div",{children:[e.jsx("strong",{children:"ðŸ’¡ Opciones disponibles:"}),e.jsxs("ul",{className:"mb-0 mt-2",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Continuar con proyecto existente:"})," Usar uno de los proyectos listados"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Crear nuevo diferenciado:"}),' El sistema agregarÃ¡ automÃ¡ticamente "(2)", "(3)", etc.']}),e.jsxs("li",{children:[e.jsx("strong",{children:"Editar manualmente:"})," Puedes cambiar el nombre despuÃ©s de crear el proyecto"]})]})]})}),e.jsx(Ie,{children:T.map(l=>e.jsxs(Ie.Item,{className:"d-flex justify-content-between align-items-start",style:{cursor:"pointer"},onClick:()=>y(l),children:[e.jsxs("div",{className:"ms-2 me-auto",children:[e.jsxs("div",{className:"fw-bold",children:[e.jsx(we,{className:"me-1"}),l.name]}),e.jsxs("div",{className:"text-muted small",children:[e.jsx("strong",{children:"Empresa:"})," ",l.company_name," (RUC: ",l.company_ruc,")"]}),e.jsxs("div",{className:"text-muted small",children:[e.jsx(ma,{className:"me-1"}),l.location||"Sin ubicaciÃ³n"]}),e.jsxs("div",{className:"text-muted small",children:[e.jsx(ua,{className:"me-1"}),"Vendedor: ",l.vendedor_name||"No asignado"]}),e.jsxs("div",{className:"text-muted small",children:[e.jsx(pa,{className:"me-1"}),"Creado: ",F(l.created_at)]})]}),e.jsxs("div",{className:"text-end",children:[e.jsx("div",{className:"mb-2",children:e.jsxs(re,{variant:"outline-secondary",size:"sm",onClick:C=>{C.stopPropagation(),U(l)},title:"Editar nombre para unificar proyectos",children:[e.jsx(ha,{className:"me-1"}),"Editar"]})}),e.jsxs("div",{children:[e.jsxs(de,{bg:"secondary",className:"me-2",children:[l.quotes_count," cotizaciÃ³n(es)"]}),e.jsx(de,{bg:l.status==="activo"?"success":"warning",children:l.status})]})]})]},l.id))})]}),!g&&!A&&T.length===0&&e.jsxs(le,{variant:"success",children:[e.jsx("strong",{children:"No se encontraron proyectos con ese nombre."}),e.jsx("br",{}),"Puedes crear un nuevo proyecto sin problemas."]})]}),e.jsxs(Z.Footer,{children:[e.jsx(re,{variant:"outline-secondary",onClick:p,children:"Cancelar"}),e.jsxs(re,{variant:"warning",onClick:z,children:[e.jsx(xe,{className:"me-1"}),'Crear "',d," (",T.length+1,')"']}),e.jsxs(re,{variant:"primary",onClick:O,children:[e.jsx(xe,{className:"me-1"}),"Crear Nuevo (Nombre Original)"]})]})]})},Pe={company_name:"",ruc:"",contact_name:"",contact_phone:"",contact_email:"",project_location:"",project_name:""},Ia={request_date:"",issue_date:"",commercial_name:"",commercial_phone:"",payment_terms:"adelantado",reference:"",reference_type:["email","phone"],igv:!0,delivery_days:4,category_main:"laboratorio"},ie={code:"",description:"",norm:"",unit_price:0,quantity:1};function Te(u){const p=Number(u.unit_price||0),d=Number(u.quantity||0);return Number((p*d).toFixed(2))}function Oa(){const u=new Date().getFullYear(),p=String(new Date().getMonth()+1).padStart(2,"0"),d=String(new Date().getDate()).padStart(2,"0"),N=Math.floor(Math.random()*1e3).toString().padStart(3,"0");return`COT-${u}${p}${d}-${N}`}const R=(u="")=>(u||"").normalize("NFD").replace(/[\u0300-\u036f]/g,"").toUpperCase().trim(),ge={[R("MUESTRA DE SUELO Y AGREGADO")]:`CONDICIONES ESPECÃFICAS:
- El cliente debe enviar al laboratorio, para los ensayo en suelo y agregados, la cantidad minima de 100 kg por cada muestra.
- El cliente deberÃ¡ de entregar las muestras debidamente identificadas.
- El cliente deberÃ¡ especificar la Norma a ser utilizada para la ejecuciÃ³n del ensayo, caso contrario se considera Norma ASTM o NTP vigente de acuerdo con el alcance del laboratorio.
- El cliente deberÃ¡ entregar las muestras en las instalaciones del LEM, ubicado en la Av. MaraÃ±Ã³n NÂ° 763, Los Olivos, Lima.`,[R("PROBETAS")]:`CONDICIONES ESPECÃFICAS:
- El cliente debe proporcionar las probetas antes del ingreso a obra.
- El cliente deberÃ¡ de entregar las muestras debidamente identificadas.
- El cliente deberÃ¡ especificar la Norma a ser utilizada para la ejecuciÃ³n del ensayo, caso contrario se considera Norma ASTM o NTP vigente de acuerdo con el alcance del laboratorio.
- El cliente deberÃ¡ entregar las muestras en las instalaciones del LEM, ubicado en la Av. MaraÃ±Ã³n NÂ° 763, Los Olivos, Lima.`,[R("DENSIDAD DE CAMPO Y MUESTREO")]:`CONDICIONES ESPECÃFICAS:
- El cliente deberÃ¡ enviar al laboratorio, para los ensayo en suelo y agregados, la cantidad minima de 100 kg por cada muestra.
- Para el ensayo de Densidad de campo, la cantidad de puntos/salida minimo 4 und.
- El cliente deberÃ¡ de programar el servicio, Densidad de campo, con 24 horas de anticipaciÃ³n.
- El cliente deberÃ¡ especificar la Norma a ser utilizada para la ejecuciÃ³n del ensayo, caso contrario se considera Norma ASTM o NTP vigente de acuerdo con el alcance del laboratorio.
- El cliente deberÃ¡ entregar las muestras en las instalaciones del LEM, ubicado en la Av. MaraÃ±Ã³n NÂ° 763, Los Olivos, Lima.`,[R("EXTRACCIÃ“N DE DIAMANTINA")]:`CONDICIONES ESPECÃFICAS:
- MovilizaciÃ³n y desmovilizaciÃ³n de equipos y del personal tÃ©cnico, estara a cargo de GEOFAL.
- Resane de estructura de concreto con sika rep 500 y Sikadur 32, estara a cargo de GEOFAL.
- El servicio no incluye trabajos de acabados como pintura, mayolica y otros.
- El area de trabajo, zona de extracciÃ³n de diamantina, tiene que estar libre de interferencia.
- La extracciÃ³n de diamantina se realizara en 2 dia en campo, en laboratorio se realizarÃ¡ el tallado y refrentado de diamantina, el ensayo de resistencia a la compresiÃ³n de testigo de diamantina se realizara en 5 dias (el tiempo de ensayo obedece a la normativa vigente).
- Costo de resane insumos 250 soles, este costo se distribuira de acuerdo con el numero de perforaciones Donde se hara las extracciones de diamantina`,[R("DIAMANTINA PARA PASES")]:`CONDICIONES ESPECÃFICAS:
- El cliente deberÃ¡ de programar el servicio, ExtracciÃ³n diamantina, con 24 horas de anticipaciÃ³n.
- El area de trabajo, zona de extraccion de diamantina, debera estar libre de interferencia.
- Para extraer la diamantina, se ubicara el acero con un escaneador.
- Movilizacion y desmovilizacion de equipos y del personal tecnico, estara a cargo de Geofal.`,[R("ALBAÃ‘ILERÃA")]:`CONDICIONES ESPECÃFICAS:
- El cliente deberÃ¡ enviar al laboratorio, 20 ladrillo de cada tipo, en buen estado y sin presentar fisuras.
- El cliente deberÃ¡ de entregar las muestras debidamente identificadas.
- El cliente deberÃ¡ especificar la Norma a ser utilizada para la ejecuciÃ³n del ensayo, caso contrario se considera Norma ASTM o NTP vigente de acuerdo con el alcance del laboratorio.
- El cliente deberÃ¡ entregar las muestras en las instalaciones del LEM, ubicado en la Av. MaraÃ±Ã³n NÂ° 763, Los Olivos, Lima`,[R("VIGA BECKELMAN")]:`CONDICIONES ESPECÃFICAS:
- El cliente deberÃ¡ de programar el servicio, Ensayo de DeflexiÃ³n, con 24 horas de anticipaciÃ³n.
- El area de trabajo tiene que estar habilitado.
- El cliente deberÃ¡ especificar la Norma a ser utilizada para la ejecuciÃ³n del ensayo, caso contrario se considera Norma ASTM o NTP o MTC vigente de acuerdo con el alcance del laboratorio.
- Especificar las caracteristicas del camion`,[R("CONTROL DE CALIDAD DE CONCRETO FRESCO EN OBRA")]:`CONDICIONES ESPECÃFICAS:
- El cliente deberÃ¡ de programar el servicio, con 24 horas de anticipaciÃ³n.
- Para el ensayo de control de calidad de concreto fresco en obra, se moldeara 6 probetas, ensayo slump, control de temperatura, en laboratorio las probetas se colocara en camara de curado, el ensayo de compresiÃ³n de las probetas seran 3 a 7 dias y 3 a 28 dias.
- El control de calidad del concreto fresco se sacara cada 50m3 a uno de los mixer donde se hara todos los ensayos respectivos mencionados, o por dia asi no se halla llegado los 50m3.
- El cliente deberÃ¡ especificar la Norma a ser utilizada para la ejecuciÃ³n del ensayo, caso contrario se considera Norma ASTM o NTP vigente de acuerdo con el alcance del laboratorio.`},M=u=>{const p=R((u==null?void 0:u.title)||"");if(ge[p])return ge[p];const d=Object.entries(ge).find(([N])=>p.includes(N)||N.includes(p));return d?d[1]:""};function Xa(){var Ae;const[u]=ga(),p=xa(),d=u.get("edit"),[N,P]=c.useState([]),[w,T]=c.useState(""),[s,g]=c.useState(Pe),[m,A]=c.useState({company_id:null,project_id:null,company:null,project:null}),[r,_]=c.useState(Ia),[y,O]=c.useState([{...ie}]),[z,U]=c.useState(!1),[F,l]=c.useState(""),[C,k]=c.useState(""),[H,me]=c.useState(null),[fe,ee]=c.useState([]),[Ne,ae]=c.useState([]),[ue,i]=c.useState(!1),[v,q]=c.useState(""),[L,be]=c.useState(!1),[D,ye]=c.useState(null),[$,ve]=c.useState([]),[B,_e]=c.useState([]),[te,G]=c.useState(""),[I,V]=c.useState(null),[Ce,K]=c.useState(!1),[Me,Ee]=c.useState(!1),[Re,ze]=c.useState(null),[Fe,Se]=c.useState(!1),[ke,qe]=c.useState(""),[$e,Ve]=c.useState(null),[pe,Pa]=c.useState(null),[J,Y]=c.useState(null);c.useEffect(()=>{const a=[{id:"V1",code:"V1",title:"MUESTRA DE SUELO Y AGREGADO",description:M({title:"MUESTRA DE SUELO Y AGREGADO"})},{id:"V2",code:"V2",title:"PROBETAS",description:M({title:"PROBETAS"})},{id:"V3",code:"V3",title:"DENSIDAD DE CAMPO Y MUESTREO",description:M({title:"DENSIDAD DE CAMPO Y MUESTREO"})},{id:"V4",code:"V4",title:"EXTRACCIÃ“N DE DIAMANTINA",description:M({title:"EXTRACCIÃ“N DE DIAMANTINA"})},{id:"V5",code:"V5",title:"DIAMANTINA PARA PASES",description:M({title:"DIAMANTINA PARA PASES"})},{id:"V6",code:"V6",title:"ALBAÃ‘ILERÃA",description:M({title:"ALBAÃ‘ILERÃA"})},{id:"V7",code:"V7",title:"VIGA BECKELMAN",description:M({title:"VIGA BECKELMAN"})},{id:"V8",code:"V8",title:"CONTROL DE CALIDAD DE CONCRETO FRESCO EN OBRA",description:M({title:"CONTROL DE CALIDAD DE CONCRETO FRESCO EN OBRA"})}];P(a)},[]),c.useEffect(()=>{(async()=>{try{const o=(await ya({page:1,limit:100})).data||[];ee(o),ae(o)}catch(a){console.warn("No se pudieron cargar proyectos existentes:",a),ee([]),ae([])}})()},[]),c.useEffect(()=>{m.company&&g(a=>{var o,n;return{...a,company_name:m.company.name||a.company_name,ruc:m.company.ruc||a.ruc,contact_name:m.company.contact_name||a.contact_name,contact_phone:m.company.phone||a.contact_phone,contact_email:m.company.email||a.contact_email,project_location:((o=m.project)==null?void 0:o.location)||a.project_location,project_name:((n=m.project)==null?void 0:n.name)||a.project_name}})},[m.company,m.project]),c.useEffect(()=>{(async()=>{try{const o=localStorage.getItem("token");if(!o)return;const n=await fetch("http://localhost:4000/api/auth/me",{headers:{Authorization:`Bearer ${o}`}});if(n.ok){const t=await n.json();t.user&&(ye(t.user),_(x=>({...x,commercial_name:t.user.name||x.commercial_name,commercial_phone:t.user.phone||x.commercial_phone,issue_date:x.issue_date||new Date().toISOString().slice(0,10),request_date:x.request_date||new Date().toISOString().slice(0,10)})))}}catch(o){console.warn("No se pudo obtener datos del usuario:",o)}})()},[]),c.useEffect(()=>{if(!w)return;const a=(N||[]).find(t=>String(t.id)===String(w));if(!a)return;const o=a.conditions||{};_(t=>({...t,payment_terms:o.default_payment_terms||t.payment_terms,igv:typeof o.default_igv=="boolean"?o.default_igv:t.igv,reference:o.default_reference||t.reference}));const n=M(a)||a.description||"";n&&k(n)},[w]);const Q=c.useMemo(()=>y.reduce((a,o)=>a+Te(o),0),[y]),oe=c.useMemo(()=>r.igv?Number((Q*.18).toFixed(2)):0,[Q,r.igv]),he=c.useMemo(()=>Number((Q+oe).toFixed(2)),[Q,oe]),Ue=()=>O([...y,{...ie}]),Be=a=>O(y.filter((o,n)=>n!==a)),X=(a,o)=>O(y.map((n,t)=>t===a?{...n,...o}:n)),Ge=async()=>{try{console.log("ðŸ” fetchClients - Llamando a /api/companies");const a=await _a({limit:500});console.log("ðŸ” fetchClients - Respuesta recibida:",a);const o=(a==null?void 0:a.data)||a||[];console.log("ðŸ” fetchClients - Lista de clientes:",o.length,"clientes"),ve(o)}catch(a){console.error("âŒ Error fetching clients:",a),l("Error al cargar los clientes: "+(a.message||"Error desconocido")),ve([])}},Ye=a=>{if(console.log("ðŸ” handleClientSearch - TÃ©rmino de bÃºsqueda:",a),G(a),!a.trim()){_e([]),K(!1);return}const o=a.toLowerCase();console.log("ðŸ” handleClientSearch - BÃºsqueda en minÃºsculas:",o);const n=$.filter(t=>{var S,ne,se,W,ce;const x=(S=t.name)==null?void 0:S.toLowerCase().includes(o),f=(ne=t.ruc)==null?void 0:ne.toLowerCase().includes(o),h=(se=t.email)==null?void 0:se.toLowerCase().includes(o),E=(W=t.phone)==null?void 0:W.toLowerCase().includes(o),j=(ce=t.name)==null?void 0:ce.toLowerCase().split(" ").some(oa=>oa.includes(o)),b=x||f||h||E||j;return b&&console.log("âœ… Cliente encontrado:",t.name,"- Match:",{nameMatch:x,nameWordsMatch:j,rucMatch:f,emailMatch:h,phoneMatch:E}),b});console.log("ðŸ” handleClientSearch - Resultados encontrados:",n.length),_e(n),K(!0)},Qe=a=>{console.log("ðŸ” handleClientSelect - Cliente seleccionado:",a.name,"ID:",a.id),V(a),G(a.name),K(!1),g(o=>({...o,company_name:a.name||"",ruc:a.ruc||"",contact_name:a.contact_name||"",contact_phone:a.phone||"",contact_email:a.email||"",project_location:a.address||""})),console.log("âœ… Campos del cliente llenados automÃ¡ticamente:",{company_name:a.name,ruc:a.ruc,contact_name:a.contact_name,contact_phone:a.phone,contact_email:a.email,project_location:a.address})},Xe=()=>{console.log("ðŸ” handleClientClear - Limpiando selecciÃ³n de cliente"),V(null),G(""),K(!1),g(Pe)};c.useEffect(()=>{d&&$.length>0&&Ke(d)},[d,$]);const Ke=async a=>{var o,n;be(!0);try{console.log("ðŸ”„ Cargando cotizaciÃ³n existente:",a);const t=await fa(a);if(console.log("âœ… CotizaciÃ³n cargada:",t),!D)try{const h=localStorage.getItem("token");if(h){const E=await fetch("http://localhost:4000/api/auth/me",{headers:{Authorization:`Bearer ${h}`}});if(E.ok){const j=await E.json();j.user&&(ye(j.user),console.log("âœ… Usuario cargado para ediciÃ³n:",j.user))}}}catch(h){console.warn("No se pudo obtener datos del usuario para ediciÃ³n:",h)}if(t.meta&&typeof t.meta=="string")try{t.meta=JSON.parse(t.meta),console.log("âœ… Meta parseado correctamente:",t.meta)}catch(h){console.error("âŒ Error parseando meta:",h),t.meta={}}if(t.client_contact||t.company_name){const h=t.company_name||t.client_company||t.client_contact||"",E=t.client_contact||"";g(b=>({...b,company_name:h,ruc:t.company_ruc||t.client_ruc||"",contact_name:E,contact_phone:t.client_phone||"",contact_email:t.client_email||"",project_location:t.project_location||"",project_name:t.project_name||""})),G(h),console.log("ðŸ” Configurando bÃºsqueda de cliente:",h),console.log("ðŸ” RUC del cliente:",t.company_ruc||t.client_ruc),console.log("ðŸ” TelÃ©fono del cliente:",t.client_phone);const j=t.company_ruc||t.client_ruc;if(j){console.log("ðŸ” Buscando cliente por RUC:",j);const b=$.find(S=>S.ruc===j);if(b)console.log("âœ… Cliente encontrado:",b),V(b);else{console.log("âŒ Cliente no encontrado en la lista, creando cliente simulado");const S={id:"existing",name:h,ruc:j||"",email:t.client_email||"",phone:t.client_phone||"",contact_name:E,address:t.project_location||""};V(S),console.log("âœ… Cliente simulado creado:",S)}}else{const b={id:"existing",name:h,ruc:"",email:t.client_email||"",phone:t.client_phone||"",contact_name:E,address:t.project_location||""};V(b),console.log("âœ… Cliente simulado creado (sin RUC):",b)}}const x=((n=(o=t.meta)==null?void 0:o.quote)==null?void 0:n.delivery_days)||t.delivery_days||4;_(h=>{var E,j;return{...h,request_date:((j=(E=t.meta)==null?void 0:E.quote)==null?void 0:j.request_date)||t.request_date||new Date().toISOString().slice(0,10),issue_date:t.issue_date||new Date().toISOString().slice(0,10),commercial_name:t.commercial_name||(D==null?void 0:D.name)||"",commercial_phone:t.commercial_phone||(D==null?void 0:D.phone)||"",payment_terms:t.payment_terms||"adelantado",reference:t.reference||"",reference_type:t.reference_type||["email","phone"],igv:t.igv!==!1,delivery_days:x,category_main:t.category_main||"laboratorio"}});let f=[];t.meta&&t.meta.items&&t.meta.items.length>0?(f=t.meta.items,console.log("âœ… Cargando Ã­tems desde meta.items:",f.length)):t.items&&t.items.length>0&&(f=t.items,console.log("âœ… Cargando Ã­tems desde items directo:",f.length)),f.length>0?(O(f),console.log("ðŸ“¦ Ãtems cargados para ediciÃ³n:",f)):(console.log("ðŸ“¦ No hay Ã­tems para cargar, usando Ã­tem vacÃ­o por defecto"),O([{...ie}])),t.variant_id&&(T(t.variant_id),console.log("ðŸ”„ Variante cargada:",t.variant_id)),t.meta&&t.meta.conditions_text&&(k(t.meta.conditions_text),console.log("ðŸ“ Condiciones especÃ­ficas cargadas")),t.project_id&&(A(h=>({...h,project_id:t.project_id})),console.log("âœ… Project ID cargado para ediciÃ³n:",t.project_id)),console.log("âœ… Datos de cotizaciÃ³n cargados para ediciÃ³n")}catch(t){console.error("âŒ Error cargando cotizaciÃ³n:",t),l("Error al cargar la cotizaciÃ³n existente: "+(t.message||"Error desconocido"))}finally{be(!1)}};c.useEffect(()=>{Ge()},[]),c.useEffect(()=>{var a;if((a=p.state)!=null&&a.selectedClient&&$.length>0){const o=p.state.selectedClient;console.log("ðŸŽ¯ Cliente pre-seleccionado desde navegaciÃ³n:",o);const n=$.find(t=>t.id===o.id);n?(console.log("âœ… Cliente encontrado en la lista, pre-llenando datos"),V(n),G(n.name),g(t=>({...t,company_name:n.name||"",ruc:n.ruc||n.dni||"",contact_name:n.contact_name||"",contact_phone:n.phone||"",contact_email:n.email||"",project_location:n.address||""}))):(console.log("âš ï¸ Cliente no encontrado en la lista, usando datos de navegaciÃ³n"),V(o),G(o.name),g(t=>({...t,company_name:o.name||"",ruc:o.ruc||o.dni||"",contact_name:o.contact_name||"",contact_phone:o.phone||"",contact_email:o.email||"",project_location:o.address||""})))}},[(Ae=p.state)==null?void 0:Ae.selectedClient,$]),c.useEffect(()=>()=>{pe&&clearTimeout(pe)},[pe]);const Je=async a=>{var o,n,t;a.preventDefault(),U(!0),l("");try{if(!s.company_name)throw new Error("Debe ingresar al menos el nombre de la empresa");let x=((o=m.project)==null?void 0:o.id)||m.project_id,f=(n=m.company)==null?void 0:n.id;if(!f){if(!s.ruc)throw new Error("Debe ingresar el RUC de la empresa");const S=await Ca({type:"empresa",ruc:s.ruc,name:s.company_name,address:s.project_location||"",email:s.contact_email||"",phone:s.contact_phone||"",contact_name:s.contact_name||"",city:s.project_location||"",sector:"servicios"});f=S.id,console.log("âœ… Empresa obtenida/creada:",S)}if(!x){const S=await va({company_id:f,name:s.project_name||`Proyecto ${s.company_name}`,location:s.project_location||"Por definir",contact_name:s.contact_name,contact_phone:s.contact_phone,contact_email:s.contact_email,status:"activo",priority:"normal",vendedor_id:(D==null?void 0:D.id)||null,requiere_laboratorio:r.category_main==="laboratorio",laboratorio_status:r.category_main==="laboratorio"?"pendiente":"no_requerido"});x=S.id,console.log("âœ… Proyecto creado automÃ¡ticamente:",S),console.log("ðŸ‘¤ Vendedor asignado:",D==null?void 0:D.name)}const h=Oa(),E={project_id:x,variant_id:w||null,client_contact:s.contact_name,client_email:s.contact_email,client_phone:s.contact_phone,client_company:s.company_name,client_ruc:s.ruc,project_name:s.project_name,project_location:s.project_location,request_date:r.request_date||new Date().toISOString().slice(0,10),issue_date:r.issue_date||new Date().toISOString().slice(0,10),subtotal:Q,igv:oe,total:he,status:"borrador",reference:r.reference,reference_type:JSON.stringify(r.reference_type),category_main:r.category_main,quote_code:h,meta:JSON.stringify({customer:s,quote:{...r,request_date:r.request_date||new Date().toISOString().slice(0,10),delivery_days:r.delivery_days||4,reference:r.reference,category_main:r.category_main,quote_code:h},items:y,conditions_text:C,payment_terms:r.payment_terms,file_name:v||`CotizaciÃ³n ${new Date().getFullYear()}-${String(new Date().getMonth()+1).padStart(2,"0")}${String(new Date().getDate()).padStart(2,"0")} LEM-GEOFAL-${((t=s.company_name)==null?void 0:t.toUpperCase())||"CLIENTE"}`})};let j,b;d?(j=await Na(d,E),b="CotizaciÃ³n actualizada exitosamente",console.log("âœ… CotizaciÃ³n actualizada:",j)):(j=await ba(E),b="CotizaciÃ³n creada exitosamente",console.log("âœ… Nueva cotizaciÃ³n creada:",j)),ze({code:h,category:r.category_main==="laboratorio"?"ðŸ§ª Laboratorio":"âš™ï¸ IngenierÃ­a",itemsCount:y.length,total:he.toLocaleString(),isEdit:!!d,message:b}),Ee(!0),me(j.id)}catch(x){console.error("Error:",x),l(x.message||"Error al crear cotizaciÃ³n")}finally{U(!1)}},We=async()=>{try{const a=H;if(!a)return alert("Guarde la cotizaciÃ³n antes de generar el borrador");const o="https://sublustrous-odelia-uninsured.ngrok-free.dev/api".replace(/\/$/,"")||"",n=`/api/quotes/${a}/export/pdf-draft`,t=o&&/\/api$/i.test(o)?`${o}${n.replace(/^\/api/,"")}`:`${o}${n}`,x=localStorage.getItem("token");if(!x)throw new Error("No se encontrÃ³ token de autenticaciÃ³n");const f={variant_id:w,delivery_days:r.delivery_days,meta:{customer:s,quote:{...r,delivery_days:r.delivery_days,variant_id:w},items:y,conditions_text:C,payment_terms:r.payment_terms},items:y};console.log("ðŸ” exportDraft - Enviando datos:",f);const h=await fetch(t,{method:"POST",headers:{Authorization:`Bearer ${x}`,"Content-Type":"application/json"},body:JSON.stringify(f)});if(!h.ok)throw new Error(`Error ${h.status}: ${h.statusText}`);const E=await h.blob(),j=window.URL.createObjectURL(E),b=document.createElement("a");b.href=j;const S=new Date,ne=String(S.getDate()).padStart(2,"0"),se=String(S.getMonth()+1).padStart(2,"0"),W=String(S.getFullYear()).slice(-2),ce=`COT-${ne}${se}${W}-${W}.pdf`;b.download=ce,document.body.appendChild(b),b.click(),document.body.removeChild(b),window.URL.revokeObjectURL(j)}catch(a){console.error("Error al exportar borrador:",a),alert(`No se pudo exportar borrador: ${a.message}`)}},Ze=a=>{var o;if(g({...s,project_name:a}),a&&a.trim().length>=3){const n=((o=m.company)==null?void 0:o.id)||(I==null?void 0:I.id);n&&He(a.trim(),n)}},He=async(a,o)=>{try{const n=await Le(a,o);n&&n.length>0?Y({count:n.length,suggestedName:`${a} (${n.length+1})`}):Y(null)}catch(n){console.error("Error verificando proyectos duplicados:",n),Y(null)}},ea=async()=>{var n,t;const a=(n=s.project_name)==null?void 0:n.trim();if(!a||a.length<3){alert("Por favor ingresa al menos 3 caracteres en el nombre del proyecto");return}let o=(t=m.company)==null?void 0:t.id;if(!o&&I&&(o=I.id),!o){alert("Por favor selecciona una empresa primero usando el buscador de clientes");return}console.log("ðŸ” Verificando proyectos existentes para:",a,"empresa:",o),console.log("ðŸ” selectedClient:",I),console.log("ðŸ” selection.company:",m.company),qe(a),Ve(o),Se(!0)},aa=a=>{console.log("ðŸ”„ Seleccionando proyecto existente:",a),A(o=>({...o,project:a,project_id:a.id})),g(o=>({...o,project_name:a.name,project_location:a.location||o.project_location})),Y(null),console.log("âœ… Proyecto existente seleccionado y estado actualizado:",a)},ta=(a=null)=>{console.log("ðŸ”„ Creando nuevo proyecto:",a),A(o=>({...o,project:null,project_id:null})),a?(g(o=>({...o,project_name:a})),console.log("âœ… Se crearÃ¡ un nuevo proyecto con nombre diferenciado:",a)):console.log("âœ… Se crearÃ¡ un nuevo proyecto con nombre original"),Y(null)};return e.jsxs(ja,{titulo:d?"ðŸ“ Editar CotizaciÃ³n":"ðŸ“‹ CotizaciÃ³n Inteligente",descripcion:d?"Edita una cotizaciÃ³n existente con nueva fecha":"Formulario unificado para crear cotizaciones de forma rÃ¡pida e intuitiva",children:[L&&e.jsx("div",{className:"alert alert-info",children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"spinner-border spinner-border-sm me-2",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Cargando..."})}),"Cargando cotizaciÃ³n existente..."]})}),F&&e.jsx("div",{className:"alert alert-danger",children:F}),e.jsxs("form",{onSubmit:Je,className:"intelligent-quote-form",children:[e.jsxs("div",{className:"alert alert-light border mt-3 intelligent-intro",children:[e.jsx("h5",{children:"ðŸš€ Flujo Simplificado"}),e.jsx("p",{className:"mb-0",children:'Completa los datos del cliente, proyecto y cotizaciÃ³n. Usa el botÃ³n "ðŸ’¾ GUARDAR COTIZACIÃ“N" para guardar tu trabajo.'})]}),e.jsxs("div",{className:"intelligent-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("span",{className:"section-icon",children:"ðŸ¢"}),e.jsx("h4",{children:"CLIENTE"}),e.jsx("span",{className:"section-status",children:s.company_name?"âœ… Cliente configurado":"â³ Pendiente"})]}),e.jsxs("div",{className:"section-content",children:[e.jsx("div",{className:"row g-3 mb-4",children:e.jsxs("div",{className:"col-md-12",children:[e.jsx("label",{className:"form-label",children:"Buscar Cliente Existente"}),e.jsxs("div",{className:"position-relative",children:[e.jsx("input",{type:"text",className:"form-control",value:te,onChange:a=>Ye(a.target.value),onFocus:()=>K(!0),placeholder:"Buscar por nombre, RUC, email o telÃ©fono..."}),I&&e.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm position-absolute end-0 top-50 translate-middle-y me-2",onClick:Xe,children:"âœ•"})]}),te&&Ce&&B.length>0&&e.jsxs("div",{className:"border rounded mt-2",style:{maxHeight:"200px",overflowY:"auto"},children:[e.jsx("div",{className:"p-2 bg-light border-bottom",children:e.jsxs("small",{className:"text-muted",children:[B.length," cliente",B.length!==1?"s":""," encontrado",B.length!==1?"s":""]})}),B.map(a=>e.jsxs("div",{className:"p-2 border-bottom cursor-pointer hover-bg-light",onClick:()=>Qe(a),style:{cursor:"pointer"},children:[e.jsx("div",{className:"fw-bold",children:a.name}),e.jsxs("small",{className:"text-muted",children:["RUC: ",a.ruc," | Email: ",a.email,a.phone&&` | Tel: ${a.phone}`]})]},a.id))]}),te&&Ce&&B.length===0&&e.jsx("div",{className:"border rounded mt-2 p-3 text-center",children:e.jsxs("small",{className:"text-muted",children:['No se encontraron clientes con "',te,'"']})}),I&&e.jsxs("div",{className:"mt-2 p-2 bg-light rounded",children:[e.jsx("strong",{children:"Cliente seleccionado:"})," ",I.name,e.jsx("br",{}),e.jsxs("small",{className:"text-muted",children:["RUC: ",I.ruc," | Email: ",I.email,I.phone&&` | Tel: ${I.phone}`]})]})]})}),e.jsxs("div",{className:"row g-3",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"Empresa"}),e.jsx("input",{className:"form-control",value:s.company_name,onChange:a=>g({...s,company_name:a.target.value}),required:!0,placeholder:"Nombre de la empresa"})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"R.U.C. *"}),e.jsx("input",{className:"form-control",value:s.ruc,onChange:a=>g({...s,ruc:a.target.value}),placeholder:"RUC de la empresa",required:!0})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"Contacto"}),e.jsx("input",{className:"form-control",value:s.contact_name,onChange:a=>g({...s,contact_name:a.target.value}),required:!0,placeholder:"Nombre del contacto"})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"TelÃ©fono"}),e.jsx("input",{className:"form-control",value:s.contact_phone,onChange:a=>g({...s,contact_phone:a.target.value}),placeholder:"TelÃ©fono del contacto"})]}),e.jsxs("div",{className:"col-md-12",children:[e.jsx("label",{className:"form-label",children:"Correo"}),e.jsx("input",{type:"email",className:"form-control",value:s.contact_email,onChange:a=>g({...s,contact_email:a.target.value}),placeholder:"Correo del contacto"})]})]})]})]}),e.jsxs("div",{className:"intelligent-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("span",{className:"section-icon",children:"ðŸ“"}),e.jsx("h4",{children:"PROYECTO"}),e.jsx("span",{className:"section-status",children:s.project_name?"âœ… Proyecto configurado":"â³ Pendiente"})]}),e.jsx("div",{className:"section-content",children:e.jsxs("div",{className:"row g-3",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsxs("label",{className:"form-label",children:["Nombre del Proyecto",m.project&&e.jsx("span",{className:"badge bg-success ms-2",children:"âœ… Proyecto existente seleccionado"})]}),e.jsxs("div",{className:"input-group",children:[e.jsx("input",{className:`form-control ${J?"is-warning":m.project?"is-success":""}`,value:s.project_name,onChange:a=>Ze(a.target.value),required:!0,placeholder:"Nombre del proyecto"}),e.jsx("button",{type:"button",className:"btn btn-outline-info",onClick:ea,title:"Verificar si ya existen proyectos con este nombre",children:"ðŸ” Verificar"})]}),J&&e.jsxs("div",{className:"alert alert-warning mt-2 mb-0",children:[e.jsx("strong",{children:"âš ï¸ Advertencia:"})," Se encontraron ",J.count," proyecto(s) con este nombre.",e.jsx("br",{}),e.jsxs("small",{children:["Sugerencia: ",e.jsx("code",{children:J.suggestedName}),e.jsx("button",{type:"button",className:"btn btn-sm btn-outline-warning ms-2",onClick:()=>{g(a=>({...a,project_name:J.suggestedName})),Y(null)},children:"Usar sugerencia"})]})]}),m.project&&e.jsx("div",{className:"alert alert-success mt-2 mb-0",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-start",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"âœ… Proyecto existente seleccionado:"})," ",m.project.name,e.jsx("br",{}),e.jsxs("small",{children:["UbicaciÃ³n: ",m.project.location||"No especificada"," | Vendedor: ",m.project.vendedor_name||"No asignado"," | Cotizaciones: ",m.project.quotes_count||0]})]}),e.jsx("button",{type:"button",className:"btn btn-sm btn-outline-danger",onClick:()=>{A(a=>({...a,project:null,project_id:null})),console.log("ðŸ”„ Proyecto existente deseleccionado")},title:"Deseleccionar proyecto existente",children:"âœ•"})]})})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"UbicaciÃ³n"}),e.jsx("input",{className:"form-control",value:s.project_location,onChange:a=>g({...s,project_location:a.target.value}),placeholder:"UbicaciÃ³n del proyecto"})]})]})})]}),e.jsxs("div",{className:"intelligent-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("span",{className:"section-icon",children:"ðŸ“‹"}),e.jsx("h4",{children:"COTIZACIÃ“N"}),e.jsx("span",{className:"section-status",children:w?"âœ… Variante seleccionada":"â³ Pendiente"})]}),e.jsxs("div",{className:"section-content",children:[e.jsxs("div",{className:"row g-3",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"Fecha de Solicitud"}),e.jsx("input",{type:"date",className:"form-control",value:r.request_date,onChange:a=>_({...r,request_date:a.target.value})})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"Fecha de EmisiÃ³n"}),e.jsx("input",{type:"date",className:"form-control",value:r.issue_date,onChange:a=>_({...r,issue_date:a.target.value})})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"Comercial"}),e.jsx("input",{className:"form-control",value:r.commercial_name,onChange:a=>_({...r,commercial_name:a.target.value}),placeholder:"Nombre del comercial"})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"TelÃ©fono Comercial"}),e.jsx("input",{type:"tel",className:"form-control",value:r.commercial_phone,onChange:a=>_({...r,commercial_phone:a.target.value}),required:!0,placeholder:"TelÃ©fono del comercial"})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"Variante"}),e.jsxs("select",{className:"form-select",value:w,onChange:a=>T(a.target.value),children:[e.jsx("option",{value:"",children:"Seleccionar variante"}),(N||[]).map(a=>e.jsxs("option",{value:a.id,children:[a.code," - ",a.title]},a.id))]})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"Forma de Pago"}),e.jsxs("select",{className:"form-select",value:r.payment_terms,onChange:a=>_({...r,payment_terms:a.target.value}),children:[e.jsx("option",{value:"adelantado",children:"Adelantado"}),e.jsx("option",{value:"50%",children:"Adelanto 50% y saldo previo al informe"}),e.jsx("option",{value:"credito7",children:"CrÃ©dito 7 dÃ­as con OS"}),e.jsx("option",{value:"credito15",children:"CrÃ©dito 15 dÃ­as con OS"}),e.jsx("option",{value:"credito30",children:"CrÃ©dito 30 dÃ­as con OS"})]})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"DÃ­as HÃ¡biles"}),e.jsx("input",{type:"number",className:"form-control",value:r.delivery_days||4,onChange:a=>{const o=parseInt(a.target.value)||4;_(n=>({...n,delivery_days:o}))},min:"1",max:"30"},`delivery-days-${r.delivery_days}`),e.jsxs("small",{className:"text-muted",children:["Estado actual: ",r.delivery_days]})]}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"form-check mt-4",children:[e.jsx("input",{className:"form-check-input",type:"checkbox",id:"igv",checked:r.igv,onChange:a=>_({...r,igv:a.target.checked})}),e.jsx("label",{className:"form-check-label",htmlFor:"igv",children:"Aplicar IGV 18%"})]})})]}),e.jsxs("div",{className:"mt-3",children:[e.jsx("label",{className:"form-label",children:"Referencia"}),e.jsx("input",{className:"form-control",value:r.reference,onChange:a=>_({...r,reference:a.target.value}),placeholder:"SEGÃšN LO SOLICITADO VÃA CORREO ELECTRÃ“NICO / LLAMADA TELEFÃ“NICA"})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"form-label",children:"CategorÃ­a Principal"}),e.jsxs("div",{className:"row g-3",children:[e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"form-check",children:[e.jsx("input",{className:"form-check-input",type:"radio",name:"categoryMain",id:"laboratorio",value:"laboratorio",checked:r.category_main==="laboratorio",onChange:a=>_({...r,category_main:a.target.value})}),e.jsx("label",{className:"form-check-label",htmlFor:"laboratorio",children:"ðŸ§ª Laboratorio"})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"form-check",children:[e.jsx("input",{className:"form-check-input",type:"radio",name:"categoryMain",id:"ingenieria",value:"ingenieria",checked:r.category_main==="ingenieria",onChange:a=>_({...r,category_main:a.target.value})}),e.jsx("label",{className:"form-check-label",htmlFor:"ingenieria",children:"âš™ï¸ IngenierÃ­a"})]})})]}),e.jsx("div",{className:"alert alert-info mt-2",children:e.jsxs("small",{children:[e.jsx("strong",{children:"ðŸ’¡ Importante:"})," Selecciona la categorÃ­a principal para que el sistema pueda categorizar automÃ¡ticamente los Ã­tems y alimentar el embudo de ventas."]})})]}),e.jsxs("div",{className:"mt-3",children:[e.jsx("label",{className:"form-label",children:"Condiciones EspecÃ­ficas"}),e.jsx("textarea",{className:"form-control",rows:4,placeholder:"Las condiciones se auto-completan segÃºn la variante seleccionada",value:C,onChange:a=>k(a.target.value)})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"form-label",children:"Ãtems de la CotizaciÃ³n"}),e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-bordered table-striped",children:[e.jsx("thead",{className:"table-dark",children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:"10%"},children:"CÃ³digo"}),e.jsx("th",{style:{width:"35%"},children:"DescripciÃ³n"}),e.jsx("th",{style:{width:"15%"},children:"Norma"}),e.jsx("th",{style:{width:"12%"},children:"Precio Unit."}),e.jsx("th",{style:{width:"10%"},children:"Cantidad"}),e.jsx("th",{style:{width:"12%"},children:"Parcial"}),e.jsx("th",{style:{width:"6%"}})]})}),e.jsx("tbody",{children:y.map((a,o)=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("input",{className:"form-control form-control-sm",value:a.code,onChange:n=>X(o,{code:n.target.value}),placeholder:"CÃ³digo"})}),e.jsx("td",{children:e.jsx(wa,{value:a.description,onChange:n=>X(o,{description:n}),onSelect:n=>{n&&X(o,{code:n.codigo,description:n.descripcion,norm:n.norma,unit_price:n.precio})},onDependenciesSelect:n=>{console.log("ðŸš€ Agregando dependencias automÃ¡ticamente:",n);const t=n.map(f=>({...ie,code:f.codigo,description:f.descripcion,norm:f.norma,unit_price:f.precio,quantity:1}));console.log("ðŸ“¦ Nuevos items a agregar:",t);const x=[...y];x.splice(o+1,0,...t),O(x),console.log("âœ… Items actualizados:",x)},placeholder:"Buscar servicio...",size:"sm"})}),e.jsx("td",{children:e.jsx("input",{className:"form-control form-control-sm",value:a.norm,onChange:n=>X(o,{norm:n.target.value}),placeholder:"Norma"})}),e.jsx("td",{children:e.jsx("input",{type:"number",step:"0.01",className:"form-control form-control-sm",value:a.unit_price,onChange:n=>X(o,{unit_price:n.target.value}),placeholder:"0.00"})}),e.jsx("td",{children:e.jsx("input",{type:"number",className:"form-control form-control-sm",value:a.quantity,onChange:n=>X(o,{quantity:n.target.value}),min:"1"})}),e.jsx("td",{children:e.jsxs("span",{className:"fw-bold text-success",children:["S/ ",Te(a).toFixed(2)]})}),e.jsx("td",{children:e.jsx("button",{type:"button",className:"btn btn-sm btn-outline-danger",onClick:()=>Be(o),disabled:y.length===1,title:"Eliminar Ã­tem",children:"ðŸ—‘ï¸"})})]},o))})]})}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center mt-3",children:[e.jsx("button",{type:"button",className:"btn btn-outline-primary",onClick:Ue,children:"âž• Agregar Ã­tem"}),e.jsxs("div",{className:"text-end",children:[e.jsxs("div",{className:"h6 mb-1",children:["Subtotal: ",e.jsxs("span",{className:"text-primary",children:["S/ ",Q.toFixed(2)]})]}),e.jsxs("div",{className:"h6 mb-1",children:["IGV 18%: ",e.jsxs("span",{className:"text-primary",children:["S/ ",oe.toFixed(2)]})]}),e.jsxs("div",{className:"h5 mb-0",children:["Total: ",e.jsxs("span",{className:"text-success fw-bold",children:["S/ ",he.toFixed(2)]})]})]})]})]})]})]}),e.jsxs("div",{className:"intelligent-actions",children:[e.jsx("button",{type:"submit",className:"btn btn-success btn-lg",disabled:z||!s.company_name||!s.ruc,children:z?d?"ðŸ”„ Actualizando...":"ðŸ’¾ Guardando...":d?"ðŸ”„ GUARDAR CAMBIOS":"ðŸ’¾ CREAR COTIZACIÃ“N"}),e.jsx("button",{type:"button",className:"btn btn-outline-warning btn-lg",onClick:We,disabled:!H,children:"ðŸ“„ Generar cotizaciÃ³n"})]})]}),e.jsx(Sa,{show:Me,onHide:()=>Ee(!1),data:Re,buttonText:"Aceptar"}),e.jsx(Da,{show:Fe,onHide:()=>Se(!1),projectName:ke,companyId:$e,onSelectExisting:aa,onCreateNew:ta})]})}export{Xa as default};
//# sourceMappingURL=CotizacionInteligente-Bbs_zxNC.js.map
