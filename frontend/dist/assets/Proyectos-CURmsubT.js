import{r as o,j as e,P as Xe,Q as Ye,R as Ze,S as B,T as Je,U as Q,V as ea,u as aa,W as sa,E as ta,c as be,G as f,H as oa,h as E,n as u,m as G,B as y,I as ia,d as ve,X as ra,K as na,k as Ne,O as la,l as fe,f as ca,Y as ye,v as da,Z as ma,t as _e,M as ua}from"./index-DHooE7hD.js";import{P as ha,R as xa,C as z}from"./PageHeader-DnOBhSeR.js";import{D as pa}from"./DataTable-Bvk6NRGo.js";import{u as ga,M as Ce}from"./ModalForm-BuRch1O-.js";import{S as $}from"./StatsCard-c_wJqtq4.js";import{d as ja,c as ba,u as va,a as Na,b as fa,e as ya,f as _a,l as Ca,g as Sa}from"./projects-DMuUpP6n.js";import{C as J}from"./Card-DJNCxncY.js";import{T as qa,a as k}from"./Tabs-17qdr1kZ.js";import"./InputGroup-D1Ua8Ud8.js";import"./Form-B2jByG-z.js";import"./Spinner-jG3H4Vuk.js";function Ea(){const r=o.useRef(!0),i=o.useRef(()=>r.current);return o.useEffect(()=>(r.current=!0,()=>{r.current=!1}),[]),i.current}const se=2**31-1;function Se(r,i,n){const m=n-Date.now();r.current=m<=se?setTimeout(i,m):setTimeout(()=>Se(r,i,n),se)}function ka(){const r=Ea(),i=o.useRef();return ga(()=>clearTimeout(i.current)),o.useMemo(()=>{const n=()=>clearTimeout(i.current);function m(g,h=0){r()&&(n(),h<=se?i.current=setTimeout(g,h):Se(i,g,Date.now()+h))}return{set:m,clear:n,handleRef:i}},[])}const Ta={[Ze]:"showing",[Ye]:"showing show"},qe=o.forwardRef((r,i)=>e.jsx(Xe,{...r,ref:i,transitionClasses:Ta}));qe.displayName="ToastFade";const Ee=o.createContext({onClose(){}}),ke=o.forwardRef(({bsPrefix:r,closeLabel:i="Close",closeVariant:n,closeButton:m=!0,className:g,children:h,..._},j)=>{r=B(r,"toast-header");const C=o.useContext(Ee),I=Je(A=>{C==null||C.onClose==null||C.onClose(A)});return e.jsxs("div",{ref:j,..._,className:Q(r,g),children:[h,m&&e.jsx(ea,{"aria-label":i,variant:n,onClick:I,"data-dismiss":"toast"})]})});ke.displayName="ToastHeader";const Te=o.forwardRef(({className:r,bsPrefix:i,as:n="div",...m},g)=>(i=B(i,"toast-body"),e.jsx(n,{ref:g,className:Q(r,i),...m})));Te.displayName="ToastBody";const Pe=o.forwardRef(({bsPrefix:r,className:i,transition:n=qe,show:m=!0,animation:g=!0,delay:h=5e3,autohide:_=!1,onClose:j,onEntered:C,onExit:I,onExiting:A,onEnter:te,onEntering:U,onExited:b,bg:l,...N},V)=>{r=B(r,"toast");const T=o.useRef(h),t=o.useRef(j);o.useEffect(()=>{T.current=h,t.current=j},[h,j]);const c=ka(),D=!!(_&&m),P=o.useCallback(()=>{D&&(t.current==null||t.current())},[D]);o.useEffect(()=>{c.set(P,T.current)},[c,P]);const H=o.useMemo(()=>({onClose:j}),[j]),L=!!(n&&g),w=e.jsx("div",{...N,ref:V,className:Q(r,i,l&&`bg-${l}`,!L&&(m?"show":"hide")),role:"alert","aria-live":"assertive","aria-atomic":"true"});return e.jsx(Ee.Provider,{value:H,children:L&&n?e.jsx(n,{in:m,onEnter:te,onEntering:U,onEntered:C,onExit:I,onExiting:A,onExited:b,unmountOnExit:!0,children:w}):w})});Pe.displayName="Toast";const ee=Object.assign(Pe,{Body:Te,Header:ke}),Pa={"top-start":"top-0 start-0","top-center":"top-0 start-50 translate-middle-x","top-end":"top-0 end-0","middle-start":"top-50 start-0 translate-middle-y","middle-center":"top-50 start-50 translate-middle","middle-end":"top-50 end-0 translate-middle-y","bottom-start":"bottom-0 start-0","bottom-center":"bottom-0 start-50 translate-middle-x","bottom-end":"bottom-0 end-0"},we=o.forwardRef(({bsPrefix:r,position:i,containerPosition:n,className:m,as:g="div",...h},_)=>(r=B(r,"toast-container"),e.jsx(g,{ref:_,...h,className:Q(r,i&&Pa[i],n&&`position-${n}`,m)})));we.displayName="ToastContainer";const ae={company_id:"",name:"",location:"",vendedor_id:"",laboratorio_id:"",requiere_laboratorio:!1,requiere_ingenieria:!1,contact_name:"",contact_phone:"",contact_email:""};function Qa(){var xe,pe,ge,je;const[r,i]=o.useState(!1),[n,m]=o.useState(null),[g,h]=o.useState(null),[_,j]=o.useState(!1),[C,I]=o.useState(!1),[A,te]=o.useState(!1),[U,b]=o.useState(!1),[l,N]=o.useState(null),[V,T]=o.useState("view"),[t,c]=o.useState({}),[D,P]=o.useState(!1),[H,L]=o.useState(""),[w,Me]=o.useState("success"),[O,K]=o.useState(1),[oe,Fe]=o.useState(""),[ie,Ie]=o.useState(""),[re,Ae]=o.useState(""),[ne,De]=o.useState(""),[Le,le]=o.useState(!1);aa();const x=(xe=sa().state)==null?void 0:xe.selectedClient,W=ta(),{data:d,isLoading:ce,refetch:Re}=be(["projects",O,oe,ie,re,ne],()=>Ca({page:O,limit:20,search:oe,status:ie,company_id:re,project_type:ne}),{keepPreviousData:!0,refetchOnWindowFocus:!1,refetchOnMount:!1,staleTime:3e4,cacheTime:3e5,retry:2,retryDelay:1e3}),{data:v,isLoading:R}=be(["projectStats"],Sa,{refetchOnWindowFocus:!1,refetchOnMount:!1,staleTime:6e4,cacheTime:3e5,retry:1}),S=a=>{W.invalidateQueries("projects"),W.invalidateQueries("projectStats"),i(!1),m(null),h(null)},de=(a,s="success")=>{L(a),Me(s),P(!0)},Ge=a=>{console.log("üîç handleSearch - B√∫squeda:",a),Fe(a),K(1),le(!0),setTimeout(()=>le(!1),1e3)},ze=a=>{console.log("üîç handleFilter - Filtros:",a),Ie(a.status||""),Ae(a.company_id||""),De(a.project_type||""),K(1)},$e=[{title:"Por Estado",options:[{label:"Pendientes",filter:{status:"pendiente"}},{label:"Activos",filter:{status:"activo"}},{label:"Completados",filter:{status:"completado"}},{label:"Cancelados",filter:{status:"cancelado"}}]},{title:"Por Tipo de Proyecto",options:[{label:"An√°lisis de Suelos",filter:{project_type:"An√°lisis de Suelos"}},{label:"Estudio Geot√©cnico",filter:{project_type:"Estudio Geot√©cnico"}},{label:"Evaluaci√≥n Ambiental",filter:{project_type:"Evaluaci√≥n Ambiental"}},{label:"Control de Calidad",filter:{project_type:"Control de Calidad"}},{label:"An√°lisis de Agua",filter:{project_type:"An√°lisis de Agua"}},{label:"Estudio de Impacto",filter:{project_type:"Estudio de Impacto"}},{label:"An√°lisis Qu√≠mico",filter:{project_type:"An√°lisis Qu√≠mico"}},{label:"Pruebas de Laboratorio",filter:{project_type:"Pruebas de Laboratorio"}},{label:"Inspecci√≥n T√©cnica",filter:{project_type:"Inspecci√≥n T√©cnica"}},{label:"Certificaci√≥n de Materiales",filter:{project_type:"Certificaci√≥n de Materiales"}}]}],me=f(ba,{onSuccess:()=>S(),onError:a=>console.error("Error creating project:",a)}),ue=f(va,{onSuccess:()=>S(),onError:a=>console.error("Error updating project:",a)}),Be=f(ja,{onSuccess:()=>S(),onError:a=>console.error("Error deleting project:",a)}),X=f(({id:a,...s})=>Na(a,s),{onSuccess:a=>{N(a),c(a),S()},onError:a=>console.error("Error updating project status:",a)}),q=f(({id:a,...s})=>fa(a,s),{onSuccess:a=>{console.log("‚úÖ updateCategoriesMutation - Success:",a),N(a),c(a),de("‚úÖ Categor√≠as guardadas correctamente!","success"),W.invalidateQueries("projects")},onError:a=>{console.error("‚ùå updateCategoriesMutation - Error:",a),de("‚ùå Error al guardar categor√≠as","danger")}}),Y=f(({id:a,...s})=>ya(a,s),{onSuccess:a=>{N(a),c(a),S()},onError:a=>console.error("Error updating project queries:",a)}),Z=f(({id:a,...s})=>_a(a,s),{onSuccess:a=>{N(a),c(a),S()},onError:a=>console.error("Error updating project mark:",a)}),Qe=()=>{const a=x?{...ae,company_id:x.id,name:`${x.sector||"Proyecto"} - ${x.name}`,location:x.city||"",contact_name:x.contact_name||"",contact_phone:x.phone||"",contact_email:x.email||""}:ae;m(a),i(!0)},Ue=a=>{m(a),i(!0)},he=a=>{window.confirm(`¬øEst√°s seguro de que quieres eliminar el proyecto "${a.name}"?`)&&Be.mutate(a.id)},Ve=a=>{console.log("üîç handleViewProject - Project recibido:",a),console.log("üîç handleViewProject - Project.id:",a==null?void 0:a.id),console.log("üîç handleViewProject - Type of project.id:",typeof(a==null?void 0:a.id)),N(a);const s={...a,requiere_laboratorio:a.requiere_laboratorio||!1,requiere_ingenieria:a.requiere_ingenieria||!1,requiere_consultoria:a.requiere_consultoria||!1,requiere_capacitacion:a.requiere_capacitacion||!1,requiere_auditoria:a.requiere_auditoria||!1,marked:a.marked||!1,priority:a.priority||"normal",queries:a.queries||"",contact_name:a.contact_name||"",contact_phone:a.contact_phone||"",contact_email:a.contact_email||""};console.log("üîç handleViewProject - editingData inicializado:",s),c(s),T("view"),b(!0)},He=async a=>{n.id?await ue.mutateAsync({id:n.id,...a}):await me.mutateAsync(a)},Oe=a=>{const F={activo:{bg:"success",text:"Activo"},pendiente:{bg:"warning",text:"Pendiente"},completado:{bg:"primary",text:"Completado"},cancelado:{bg:"danger",text:"Cancelado"}}[a]||{bg:"secondary",text:a};return e.jsx(u,{bg:F.bg,className:"status-badge",children:F.text})},Ke=[{header:"ID",accessor:"id",width:"80px"},{header:"Proyecto",accessor:"name",render:(a,s)=>e.jsxs("div",{children:[e.jsx("div",{className:"fw-medium",children:s.name}),s.location&&e.jsxs("small",{className:"text-muted",children:[e.jsx(ua,{size:12,className:"me-1"}),s.location]})]})},{header:"Tipo de Proyecto",accessor:"project_type",render:(a,s)=>{const F=s.project_type||"General";let p="secondary";switch(F){case"An√°lisis de Suelos":p="success";break;case"Estudio Geot√©cnico":p="primary";break;case"Evaluaci√≥n Ambiental":p="info";break;case"Control de Calidad":p="warning";break;case"An√°lisis de Agua":p="info";break;case"Estudio de Impacto":p="danger";break;case"An√°lisis Qu√≠mico":p="primary";break;case"Pruebas de Laboratorio":p="success";break;case"Inspecci√≥n T√©cnica":p="warning";break;case"Certificaci√≥n de Materiales":p="info";break;default:p="secondary"}return e.jsx(u,{bg:p,className:"px-2 py-1",children:F})}},{header:"Empresa",accessor:"company_name",render:(a,s)=>e.jsxs("div",{children:[e.jsx("div",{className:"fw-medium",children:s.company_name||"Sin empresa"}),s.company_ruc&&e.jsxs("small",{className:"text-muted",children:["RUC: ",s.company_ruc]})]})},{header:"Estado",accessor:"status",render:a=>Oe(a||"activo")},{header:"Servicios Requeridos",accessor:"services",render:(a,s)=>e.jsxs("div",{className:"d-flex flex-wrap gap-1",children:[s.requiere_laboratorio&&e.jsxs(u,{bg:"info",className:"px-2 py-1",children:[e.jsx(E,{size:12,className:"me-1"}),"Laboratorio"]}),s.requiere_ingenieria&&e.jsxs(u,{bg:"primary",className:"px-2 py-1",children:[e.jsx(G,{size:12,className:"me-1"}),"Ingenier√≠a"]}),!s.requiere_laboratorio&&!s.requiere_ingenieria&&e.jsx(u,{bg:"secondary",className:"px-2 py-1",children:"Sin servicios"})]})},{header:"Contacto",accessor:"contacto",render:(a,s)=>e.jsxs("div",{className:"small",children:[s.contact_name&&e.jsx("div",{children:e.jsx("strong",{children:s.contact_name})}),s.contact_phone&&e.jsx("div",{className:"text-muted",children:s.contact_phone}),s.contact_email&&e.jsx("div",{className:"text-muted",children:s.contact_email}),!s.contact_name&&!s.contact_phone&&!s.contact_email&&e.jsx("span",{className:"text-muted",children:"Sin contacto"})]})},{header:"Asignado a",accessor:"vendedor_name",render:(a,s)=>e.jsxs("div",{children:[s.vendedor_name&&e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx(G,{size:14,className:"me-1 text-muted"}),e.jsx("span",{children:s.vendedor_name})]}),s.laboratorio_name&&e.jsxs("div",{className:"d-flex align-items-center mt-1",children:[e.jsx(E,{size:14,className:"me-1 text-muted"}),e.jsx("span",{className:"small text-muted",children:s.laboratorio_name})]})]})},{header:"Fecha Creaci√≥n",accessor:"created_at",type:"date"}],We=[{name:"company_id",label:"Empresa/Cliente",type:"select",required:!0,options:((pe=d==null?void 0:d.companies)==null?void 0:pe.map(a=>({value:a.id,label:`${a.name} (${a.ruc||a.dni||"Sin RUC/DNI"})`})))||[],description:"Selecciona un cliente existente o crea uno nuevo desde el m√≥dulo de clientes"},{name:"name",label:"Nombre del Proyecto",type:"text",required:!0,placeholder:"Ingresa el nombre del proyecto"},{name:"location",label:"Ubicaci√≥n del Proyecto",type:"text",placeholder:"Ingresa la ubicaci√≥n del proyecto",required:!0},{name:"contact_name",label:"Persona de Contacto",type:"text",placeholder:"Nombre de la persona con quien negociar",description:"Persona responsable del proyecto en el cliente"},{name:"contact_phone",label:"Tel√©fono de Contacto",type:"text",placeholder:"Tel√©fono para comunicaci√≥n directa",description:"N√∫mero para llamadas urgentes o seguimiento"},{name:"contact_email",label:"Email de Contacto",type:"email",placeholder:"Email para comunicaci√≥n",description:"Email para env√≠o de reportes y documentos"},{name:"vendedor_id",label:"Vendedor Asignado",type:"select",options:((ge=d==null?void 0:d.users)==null?void 0:ge.filter(a=>["vendedor_comercial","jefa_comercial"].includes(a.role)).map(a=>({value:a.id,label:`${a.name} ${a.apellido}`})))||[]},{name:"laboratorio_id",label:"Responsable de Laboratorio",type:"select",options:((je=d==null?void 0:d.users)==null?void 0:je.filter(a=>["jefe_laboratorio","usuario_laboratorio","laboratorio"].includes(a.role)).map(a=>({value:a.id,label:`${a.name} ${a.apellido}`})))||[]},{name:"requiere_laboratorio",label:"Requiere Servicios de Laboratorio",type:"checkbox",description:"Marcar si el proyecto necesita an√°lisis o pruebas de laboratorio"},{name:"requiere_ingenieria",label:"Requiere Servicios de Ingenier√≠a",type:"checkbox",description:"Marcar si el proyecto necesita estudios o consultor√≠a de ingenier√≠a"}],M=o.useMemo(()=>{if(v)return console.log("üìä Stats - Usando estad√≠sticas reales del backend:",v),{total:v.total||0,activos:v.activos||0,completados:v.completados||0,pendientes:v.pendientes||0,cancelados:v.cancelados||0};const a=(d==null?void 0:d.data)||[];return console.log("üìä Stats - Fallback: calculando desde p√°gina actual:",a),{total:a.length,activos:a.filter(s=>s.status==="activo").length,completados:a.filter(s=>s.status==="completado").length,pendientes:a.filter(s=>s.status==="pendiente").length,cancelados:a.filter(s=>s.status==="cancelado").length}},[v,d]);return e.jsx(oa,{fluid:!0,className:"py-4",children:e.jsxs("div",{className:"fade-in",children:[e.jsx(ha,{title:"Gesti√≥n de Proyectos",subtitle:x?`Crear proyecto para: ${x.name}`:"Crear, editar y gestionar proyectos del sistema",icon:E,actions:e.jsxs("div",{className:"d-flex gap-2",children:[x&&e.jsxs(u,{bg:"info",className:"px-3 py-2 d-flex align-items-center",children:[e.jsx(G,{className:"me-1"}),"Cliente: ",x.name]}),e.jsxs(y,{variant:"primary",onClick:Qe,children:[e.jsx(ia,{className:"me-2"}),x?"Crear Proyecto":"Nuevo Proyecto"]})]})}),e.jsxs(xa,{className:"g-4 mb-4",children:[e.jsx(z,{md:6,lg:3,children:e.jsx($,{title:"Total Proyectos",value:M.total,icon:E,color:"primary",subtitle:"Proyectos registrados",loading:R})}),e.jsx(z,{md:6,lg:3,children:e.jsx($,{title:"Proyectos Activos",value:M.activos,icon:ve,color:"success",subtitle:"En desarrollo",loading:R})}),e.jsx(z,{md:6,lg:3,children:e.jsx($,{title:"Completados",value:M.completados,icon:ve,color:"info",subtitle:"Finalizados",loading:R})}),e.jsx(z,{md:6,lg:3,children:e.jsx($,{title:"Pendientes",value:M.pendientes,icon:ra,color:"warning",subtitle:"Por iniciar",loading:R})})]}),e.jsxs(J,{className:"shadow-sm border-0",children:[e.jsx(J.Header,{className:"bg-white border-bottom",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("h5",{className:"mb-0",children:[e.jsx(E,{className:"me-2 text-primary"}),"Lista de Proyectos"]}),e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx(y,{variant:"outline-secondary",size:"sm",onClick:()=>Re(),className:"d-flex align-items-center",title:"Actualizar datos",children:e.jsx(na,{className:`${ce?"spinning":""}`})}),e.jsxs(u,{bg:"light",text:"dark",className:"px-3 py-2",children:[M.total," proyectos"]})]})]})}),e.jsx(J.Body,{className:"p-0",children:e.jsx(pa,{data:(d==null?void 0:d.data)||[],columns:Ke,loading:ce||Le,onEdit:Ue,onDelete:he,actions:[{label:"Gestionar",icon:Ne,onClick:Ve,variant:"outline-primary"},{label:"Eliminar",icon:la,onClick:he,variant:"outline-danger"}],emptyMessage:"No hay proyectos registrados",totalItems:(d==null?void 0:d.total)||0,itemsPerPage:20,currentPage:O,onPageChange:K,onSearch:Ge,onFilter:ze,filterOptions:$e})})]}),e.jsx(Ce,{show:r,onHide:()=>i(!1),title:n!=null&&n.id?"Editar Proyecto":"Nuevo Proyecto",data:n||ae,fields:We,onSubmit:He,loading:me.isLoading||ue.isLoading,submitText:n!=null&&n.id?"Actualizar":"Crear"}),e.jsx(Ce,{show:U,onHide:()=>b(!1),title:`Gestionar Proyecto - ${(l==null?void 0:l.name)||""}`,data:t,fields:[{name:"project_management",label:"Gesti√≥n del Proyecto",type:"custom",render:a=>e.jsxs(qa,{activeKey:V,onSelect:s=>T(s),className:"mb-3",children:[e.jsx(k,{eventKey:"view",title:e.jsxs("span",{children:[e.jsx(Ne,{className:"me-1"}),"Ver"]}),children:e.jsxs("div",{className:"row g-3",children:[e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"border rounded p-3 h-100",children:[e.jsxs("h6",{className:"text-primary mb-3",children:[e.jsx(E,{className:"me-2"}),"Datos Generales"]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"ID:"})," ",a.id]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Nombre:"})," ",a.name]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Ubicaci√≥n:"})," ",a.location]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Tipo:"}),e.jsx(u,{bg:"info",className:"ms-2",children:a.project_type})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Estado:"}),e.jsx(u,{bg:"primary",className:"ms-2",children:a.status})]})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"border rounded p-3 h-100",children:[e.jsxs("h6",{className:"text-success mb-3",children:[e.jsx(G,{className:"me-2"}),"Informaci√≥n de Contacto"]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Empresa:"})," ",a.company_name]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"RUC:"})," ",a.company_ruc]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Contacto:"})," ",a.contact_name||"Sin contacto"]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Tel√©fono:"})," ",a.contact_phone||"Sin tel√©fono"]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Email:"})," ",a.contact_email||"Sin email"]})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"border rounded p-3 h-100",children:[e.jsxs("h6",{className:"text-warning mb-3",children:[e.jsx(fe,{className:"me-2"}),"Servicios Requeridos"]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Laboratorio:"}),a.requiere_laboratorio?e.jsx(u,{bg:"info",className:"ms-2",children:"Requerido"}):e.jsx(u,{bg:"secondary",className:"ms-2",children:"No requerido"})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Ingenier√≠a:"}),a.requiere_ingenieria?e.jsx(u,{bg:"success",className:"ms-2",children:"Requerido"}):e.jsx(u,{bg:"secondary",className:"ms-2",children:"No requerido"})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Estado Lab:"}),e.jsx(u,{bg:"info",className:"ms-2",children:a.laboratorio_status})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Estado Ing:"}),e.jsx(u,{bg:"success",className:"ms-2",children:a.ingenieria_status})]})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"border rounded p-3 h-100",children:[e.jsxs("h6",{className:"text-info mb-3",children:[e.jsx(ca,{className:"me-2"}),"Asignaciones"]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Vendedor:"})," ",a.vendedor_name||"Sin asignar"]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Laboratorio:"})," ",a.laboratorio_name||"Sin asignar"]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Fecha Creaci√≥n:"})," ",new Date(a.created_at).toLocaleDateString()]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"√öltima Actualizaci√≥n:"})," ",new Date(a.updated_at).toLocaleDateString()]})]})}),a.status_notes&&e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"border rounded p-3",children:[e.jsxs("h6",{className:"text-muted mb-3",children:[e.jsx(ye,{className:"me-2"}),"Notas del Estado"]}),e.jsx("p",{className:"mb-0",children:a.status_notes})]})})]})}),e.jsx(k,{eventKey:"edit",title:e.jsxs("span",{children:[e.jsx(da,{className:"me-1"}),"Editar"]}),children:e.jsxs("div",{className:"row g-3",children:[e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Nombre del Proyecto"}),e.jsx("input",{type:"text",className:"form-control",value:t.name||"",onChange:s=>c({...t,name:s.target.value})})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Ubicaci√≥n"}),e.jsx("input",{type:"text",className:"form-control",value:t.location||"",onChange:s=>c({...t,location:s.target.value})})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Persona de Contacto"}),e.jsx("input",{type:"text",className:"form-control",value:t.contact_name||"",onChange:s=>{console.log("üîç contact_name onChange:",s.target.value),c({...t,contact_name:s.target.value})}})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Tel√©fono de Contacto"}),e.jsx("input",{type:"text",className:"form-control",value:t.contact_phone||"",onChange:s=>c({...t,contact_phone:s.target.value})})]})}),e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Email de Contacto"}),e.jsx("input",{type:"email",className:"form-control",value:t.contact_email||"",onChange:s=>c({...t,contact_email:s.target.value})})]})}),e.jsx("div",{className:"col-12",children:e.jsx(y,{variant:"primary",onClick:()=>{const s=l==null?void 0:l.id;if(!s){console.error("No se encontr√≥ el ID del proyecto");return}q.mutate({id:s,requiere_laboratorio:t.requiere_laboratorio||!1,requiere_ingenieria:t.requiere_ingenieria||!1,requiere_consultoria:t.requiere_consultoria||!1,requiere_capacitacion:t.requiere_capacitacion||!1,requiere_auditoria:t.requiere_auditoria||!1}),b(!1)},disabled:q.isLoading,children:q.isLoading?"Guardando...":"Guardar Categor√≠as"})})]})}),e.jsx(k,{eventKey:"status",title:e.jsxs("span",{children:[e.jsx(fe,{className:"me-1"}),"Estado"]}),children:e.jsxs("div",{className:"row g-3",children:[e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Estado del Proyecto"}),e.jsxs("select",{className:"form-select",value:t.status||"",onChange:s=>c({...t,status:s.target.value}),children:[e.jsx("option",{value:"pendiente",children:"Pendiente"}),e.jsx("option",{value:"en_proceso",children:"En Proceso"}),e.jsx("option",{value:"completado",children:"Completado"}),e.jsx("option",{value:"pausado",children:"Pausado"}),e.jsx("option",{value:"cancelado",children:"Cancelado"})]})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Estado del Laboratorio"}),e.jsxs("select",{className:"form-select",value:t.laboratorio_status||"",onChange:s=>c({...t,laboratorio_status:s.target.value}),children:[e.jsx("option",{value:"no_requerido",children:"No Requerido"}),e.jsx("option",{value:"pendiente",children:"Pendiente"}),e.jsx("option",{value:"en_proceso",children:"En Proceso"}),e.jsx("option",{value:"completado",children:"Completado"}),e.jsx("option",{value:"pausado",children:"Pausado"}),e.jsx("option",{value:"cancelado",children:"Cancelado"})]})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Estado de Ingenier√≠a"}),e.jsxs("select",{className:"form-select",value:t.ingenieria_status||"",onChange:s=>c({...t,ingenieria_status:s.target.value}),children:[e.jsx("option",{value:"no_requerido",children:"No Requerido"}),e.jsx("option",{value:"pendiente",children:"Pendiente"}),e.jsx("option",{value:"en_proceso",children:"En Proceso"}),e.jsx("option",{value:"completado",children:"Completado"}),e.jsx("option",{value:"pausado",children:"Pausado"}),e.jsx("option",{value:"cancelado",children:"Cancelado"})]})]})}),e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Notas del Estado"}),e.jsx("textarea",{className:"form-control",rows:"3",value:t.status_notes||"",onChange:s=>c({...t,status_notes:s.target.value}),placeholder:"Agrega comentarios sobre el cambio de estado..."})]})}),e.jsx("div",{className:"col-12",children:e.jsx(y,{variant:"success",onClick:()=>{const s=l==null?void 0:l.id;if(!s){console.error("No se encontr√≥ el ID del proyecto");return}X.mutate({id:s,...t}),b(!1)},disabled:X.isLoading,children:X.isLoading?"Actualizando...":"Actualizar Estado"})})]})}),e.jsx(k,{eventKey:"categories",title:e.jsxs("span",{children:[e.jsx(ma,{className:"me-1"}),"Categor√≠as"]}),children:e.jsxs("div",{className:"row g-3",children:[e.jsxs("div",{className:"col-12",children:[e.jsx("h6",{className:"mb-3",children:"Categor√≠as del Proyecto"}),e.jsxs("div",{className:"form-check",children:[e.jsx("input",{className:"form-check-input",type:"checkbox",id:"cat_laboratorio",checked:t.requiere_laboratorio||!1,onChange:s=>{console.log("üîç requiere_laboratorio onChange:",s.target.checked),c({...t,requiere_laboratorio:s.target.checked})}}),e.jsx("label",{className:"form-check-label",htmlFor:"cat_laboratorio",children:"Laboratorio"})]}),e.jsxs("div",{className:"form-check",children:[e.jsx("input",{className:"form-check-input",type:"checkbox",id:"cat_ingenieria",checked:t.requiere_ingenieria||!1,onChange:s=>c({...t,requiere_ingenieria:s.target.checked})}),e.jsx("label",{className:"form-check-label",htmlFor:"cat_ingenieria",children:"Ingenier√≠a"})]}),e.jsxs("div",{className:"form-check",children:[e.jsx("input",{className:"form-check-input",type:"checkbox",id:"cat_consultoria",checked:t.requiere_consultoria||!1,onChange:s=>c({...t,requiere_consultoria:s.target.checked})}),e.jsx("label",{className:"form-check-label",htmlFor:"cat_consultoria",children:"Consultor√≠a"})]}),e.jsxs("div",{className:"form-check",children:[e.jsx("input",{className:"form-check-input",type:"checkbox",id:"cat_capacitacion",checked:t.requiere_capacitacion||!1,onChange:s=>c({...t,requiere_capacitacion:s.target.checked})}),e.jsx("label",{className:"form-check-label",htmlFor:"cat_capacitacion",children:"Capacitaci√≥n"})]}),e.jsxs("div",{className:"form-check",children:[e.jsx("input",{className:"form-check-input",type:"checkbox",id:"cat_auditoria",checked:t.requiere_auditoria||!1,onChange:s=>c({...t,requiere_auditoria:s.target.checked})}),e.jsx("label",{className:"form-check-label",htmlFor:"cat_auditoria",children:"Auditor√≠a"})]})]}),e.jsx("div",{className:"col-12",children:e.jsx(y,{variant:"info",onClick:()=>{console.log("selectedProject:",l),console.log("selectedProject.id:",l==null?void 0:l.id),console.log("editingData:",t);const s=l==null?void 0:l.id;if(!s){console.error("No se encontr√≥ el ID del proyecto");return}q.mutate({id:s,requiere_laboratorio:t.requiere_laboratorio||!1,requiere_ingenieria:t.requiere_ingenieria||!1,requiere_consultoria:t.requiere_consultoria||!1,requiere_capacitacion:t.requiere_capacitacion||!1,requiere_auditoria:t.requiere_auditoria||!1})},disabled:q.isLoading,children:q.isLoading?"Guardando...":"Guardar Categor√≠as"})})]})}),e.jsx(k,{eventKey:"queries",title:e.jsxs("span",{children:[e.jsx(ye,{className:"me-1"}),"Consultas"]}),children:e.jsxs("div",{className:"row g-3",children:[e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Consultas y Dudas del Cliente"}),e.jsx("textarea",{className:"form-control",rows:"8",value:t.queries||"",onChange:s=>c({...t,queries:s.target.value}),placeholder:"Ingresa las consultas o dudas del cliente..."})]})}),e.jsx("div",{className:"col-12",children:e.jsx(y,{variant:"warning",onClick:()=>{const s=l==null?void 0:l.id;if(!s){console.error("No se encontr√≥ el ID del proyecto");return}Y.mutate({id:s,queries:t.queries||""})},disabled:Y.isLoading,children:Y.isLoading?"Guardando...":"Guardar Consultas"})})]})}),e.jsx(k,{eventKey:"mark",title:e.jsxs("span",{children:[e.jsx(_e,{className:"me-1"}),"Marcar"]}),children:e.jsx("div",{className:"row g-3",children:e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h6",{className:"mb-3",children:"Marcar Proyecto"}),e.jsx("p",{className:"text-muted mb-4",children:"Marca este proyecto para seguimiento especial o prioridad alta."}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Prioridad"}),e.jsxs("select",{className:"form-select",value:t.priority||"normal",onChange:s=>c({...t,priority:s.target.value}),children:[e.jsx("option",{value:"low",children:"Baja"}),e.jsx("option",{value:"normal",children:"Normal"}),e.jsx("option",{value:"high",children:"Alta"}),e.jsx("option",{value:"urgent",children:"Urgente"})]})]}),e.jsxs(y,{variant:"success",size:"lg",onClick:()=>{const s=l==null?void 0:l.id;if(!s){console.error("No se encontr√≥ el ID del proyecto");return}Z.mutate({id:s,marked:!t.marked,priority:t.priority||"normal"}),b(!1)},disabled:Z.isLoading,children:[e.jsx(_e,{className:"me-2"}),Z.isLoading?"Procesando...":t.marked?"Desmarcar Proyecto":"Marcar Proyecto"]})]})})})})]})}],onSubmit:()=>b(!1),submitText:"Cerrar",size:"xl"}),e.jsx(we,{position:"top-end",className:"p-3",children:e.jsxs(ee,{show:D,onClose:()=>P(!1),delay:3e3,autohide:!0,bg:w,children:[e.jsx(ee.Header,{children:e.jsx("strong",{className:"me-auto",children:w==="success"?"‚úÖ √âxito":"‚ùå Error"})}),e.jsx(ee.Body,{className:"text-white",children:H})]})})]})})}export{Qa as default};
//# sourceMappingURL=Proyectos-CURmsubT.js.map
