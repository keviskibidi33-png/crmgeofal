import{b as w,r as v,c as Ne,e as _,x as ce,j as e,a4 as le,l as fe,B as l,A as we,y as z,am as h,an as Ce,ao as S,F as C,z as Pe,ap as Fe,aq as B,f as k,$ as Ae,m as de,S as Le,a2 as Ee,_ as M,h as Te,C as me,I,G as N,H as _e,g as ze,O as Se}from"./index-ACE2z3o6.js";import{C as R,R as u}from"./Row-DR7Snyel.js";import{S as Be}from"./Spinner-CGz_3N-E.js";import{A as ke}from"./Alert-ChgNCOQW.js";import{C as n}from"./Col-DolGQwSC.js";import{C as o}from"./Card-DrK-EhIU.js";import{P}from"./ProgressBar-DxXS9ZdY.js";import{F as c}from"./Form-DLwAlTjb.js";import{I as xe}from"./InputGroup-DueyeE6m.js";import{T as Me}from"./Table-BW8--UG8.js";import{M as f}from"./Modal-C3w-lbxe.js";import{T as Ie,a as he}from"./Tabs-DjFA1zi3.js";import"./ElementChildren-DF5xNtl2.js";const Re=async(t={})=>{try{const i=new URLSearchParams;t.estado&&i.append("estado",t.estado),t.search&&i.append("search",t.search),t.page&&i.append("page",t.page),t.limit&&i.append("limit",t.limit);const s=i.toString(),b=`/api/laboratorio/proyectos${s?`?${s}`:""}`,y=new AbortController,m=setTimeout(()=>y.abort(),1e4);try{const j=await w(b,{signal:y.signal});return clearTimeout(m),j}catch(j){throw clearTimeout(m),j.name==="AbortError"?new Error("Timeout: La petici√≥n tard√≥ demasiado tiempo"):j}}catch(i){throw i}},qe=async()=>{try{const t=new AbortController,i=setTimeout(()=>t.abort(),1e4);try{const s=await w("/api/laboratorio/estadisticas",{signal:t.signal});return clearTimeout(i),s}catch(s){throw clearTimeout(i),s.name==="AbortError"?new Error("Timeout: La petici√≥n tard√≥ demasiado tiempo"):s}}catch(t){throw t}},De=async(t,i)=>{try{console.log("üîÑ actualizarEstadoProyecto - Llamando a: /api/laboratorio/proyectos/"+t+"/estado");const s=await w(`/api/laboratorio/proyectos/${t}/estado`,{method:"PUT",body:JSON.stringify(i)});return console.log("‚úÖ actualizarEstadoProyecto - Respuesta recibida:",s),s}catch(s){throw console.error("‚ùå actualizarEstadoProyecto - Error:",s),s}},Ke=async(t,i)=>{try{console.log("üìÅ subirArchivosLaboratorio - Llamando a: /api/laboratorio/proyectos/"+t+"/archivos");const s=await w(`/api/laboratorio/proyectos/${t}/archivos`,{method:"POST",body:JSON.stringify(i)});return console.log("‚úÖ subirArchivosLaboratorio - Respuesta recibida:",s),s}catch(s){throw console.error("‚ùå subirArchivosLaboratorio - Error:",s),s}},Ge=async(t,i="")=>{try{console.log("üìÇ obtenerArchivosProyecto - Llamando a: /api/laboratorio/proyectos/"+t+"/archivos");const s=new URLSearchParams;i&&s.append("tipo",i);const b=s.toString(),y=`/api/laboratorio/proyectos/${t}/archivos${b?`?${b}`:""}`,m=await w(y);return console.log("‚úÖ obtenerArchivosProyecto - Respuesta recibida:",m),m}catch(s){throw console.error("‚ùå obtenerArchivosProyecto - Error:",s),s}},rs=()=>{var Q,U,O,J,W,X,Y,Z,ee,se,ae,re,te,ie,oe,ne;const[t,i]=v.useState({estado:"",search:"",page:1}),[s,b]=v.useState(null),[y,m]=v.useState(!1),[j,q]=v.useState([]),[F,D]=v.useState(""),[K,g]=v.useState("dashboard"),A=Ne(),{data:x,isLoading:je,error:ue}=_({queryKey:["laboratorio-proyectos",t],queryFn:()=>Re(t),keepPreviousData:!0,retry:1,retryDelay:1e3,staleTime:3e4}),{data:r,isLoading:pe}=_({queryKey:["laboratorio-estadisticas"],queryFn:qe,retry:1,retryDelay:1e3,staleTime:3e4}),{data:L,isLoading:$e}=_({queryKey:["laboratorio-archivos",s==null?void 0:s.id],queryFn:()=>Ge(s.id),enabled:!!s}),E=ce({mutationFn:({proyectoId:a,nuevoEstado:d,notas:p})=>De(a,d),onSuccess:()=>{A.invalidateQueries(["laboratorio-proyectos"]),A.invalidateQueries(["laboratorio-estadisticas"]),m(!1)}}),G=ce({mutationFn:({proyectoId:a,archivos:d,notas:p})=>Ke(a,d),onSuccess:()=>{A.invalidateQueries(["laboratorio-archivos",s==null?void 0:s.id]),q([]),D("")}}),$=(a,d)=>{i(p=>({...p,[a]:d,page:a!=="page"?1:d}))},H=a=>{b(a),m(!0)},V=a=>{s&&E.mutate({proyectoId:s.id,nuevoEstado:a,notas:F})},be=a=>{const d=Array.from(a.target.files);q(d)},ye=()=>{s&&j.length>0&&G.mutate({proyectoId:s.id,archivos:j,notas:F})},T=a=>{const p={borrador:{variant:"secondary",icon:I,text:"Borrador"},en_laboratorio:{variant:"warning",icon:Se,text:"En Laboratorio"},en_proceso:{variant:"info",icon:B,text:"En Proceso"},completado:{variant:"success",icon:k,text:"Completado"},pendiente:{variant:"danger",icon:le,text:"Pendiente"}}[a]||{variant:"secondary",icon:I,text:a},ge=p.icon;return e.jsxs(me,{bg:p.variant,className:"d-flex align-items-center gap-1",children:[e.jsx(ge,{size:12}),p.text]})},ve=a=>{switch(a){case"alta":return"danger";case"media":return"warning";case"baja":return"success";default:return"secondary"}};return je||pe?e.jsx(R,{fluid:!0,className:"py-4",children:e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{minHeight:"400px"},children:e.jsxs("div",{className:"text-center",children:[e.jsx(Be,{animation:"border",variant:"primary",size:"lg"}),e.jsx("p",{className:"mt-3 text-muted",children:"Cargando datos del laboratorio..."})]})})}):ue?e.jsx(R,{fluid:!0,className:"py-4",children:e.jsxs(ke,{variant:"danger",className:"text-center",children:[e.jsx(le,{className:"me-2"}),"Error al cargar los datos del laboratorio. Por favor, intenta de nuevo."]})}):e.jsxs(R,{fluid:!0,className:"py-4",children:[e.jsx(u,{className:"mb-4",children:e.jsx(n,{children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"mb-1",children:[e.jsx(fe,{className:"me-2 text-primary"}),"Gesti√≥n de Laboratorio"]}),e.jsx("p",{className:"text-muted mb-0",children:"Administra proyectos y procesos de laboratorio"})]}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsxs(l,{variant:"outline-primary",size:"sm",children:[e.jsx(we,{className:"me-1"}),"Actualizar"]}),e.jsxs(l,{variant:"primary",size:"sm",children:[e.jsx(z,{className:"me-1"}),"Nuevo Proyecto"]})]})]})})}),e.jsx(u,{className:"mb-4",children:e.jsx(n,{children:e.jsxs(h,{variant:"tabs",defaultActiveKey:"dashboard",children:[e.jsx(h.Item,{children:e.jsxs(h.Link,{eventKey:"dashboard",onClick:()=>g("dashboard"),children:[e.jsx(Ce,{className:"me-1"}),"Dashboard"]})}),e.jsx(h.Item,{children:e.jsxs(h.Link,{eventKey:"proyectos",onClick:()=>g("proyectos"),children:[e.jsx(S,{className:"me-1"}),"Proyectos"]})}),e.jsx(h.Item,{children:e.jsxs(h.Link,{eventKey:"reportes",onClick:()=>g("reportes"),children:[e.jsx(C,{className:"me-1"}),"Reportes"]})}),e.jsx(h.Item,{children:e.jsxs(h.Link,{eventKey:"configuracion",onClick:()=>g("configuracion"),children:[e.jsx(Pe,{className:"me-1"}),"Configuraci√≥n"]})})]})})}),K==="dashboard"&&e.jsxs(e.Fragment,{children:[e.jsxs(u,{className:"mb-4",children:[e.jsx(n,{md:3,children:e.jsx(o,{className:"h-100 border-0 shadow-sm",children:e.jsxs(o.Body,{className:"text-center",children:[e.jsxs("div",{className:"d-flex align-items-center justify-content-between mb-3",children:[e.jsx("div",{className:"bg-primary bg-opacity-10 rounded-circle p-3",children:e.jsx(Fe,{className:"text-primary",size:24})}),e.jsxs("div",{className:"text-end",children:[e.jsx("h3",{className:"mb-0 text-primary",children:((Q=r==null?void 0:r.data)==null?void 0:Q.total_proyectos)||0}),e.jsx("small",{className:"text-muted",children:"Total Proyectos"})]})]}),e.jsx(P,{now:((U=r==null?void 0:r.data)==null?void 0:U.total_proyectos)||0,max:100,variant:"primary",className:"mb-2"}),e.jsx("small",{className:"text-muted",children:"Proyectos en el sistema"})]})})}),e.jsx(n,{md:3,children:e.jsx(o,{className:"h-100 border-0 shadow-sm",children:e.jsxs(o.Body,{className:"text-center",children:[e.jsxs("div",{className:"d-flex align-items-center justify-content-between mb-3",children:[e.jsx("div",{className:"bg-warning bg-opacity-10 rounded-circle p-3",children:e.jsx(B,{className:"text-warning",size:24})}),e.jsxs("div",{className:"text-end",children:[e.jsx("h3",{className:"mb-0 text-warning",children:((O=r==null?void 0:r.data)==null?void 0:O.en_proceso)||0}),e.jsx("small",{className:"text-muted",children:"En Proceso"})]})]}),e.jsx(P,{now:((J=r==null?void 0:r.data)==null?void 0:J.en_proceso)||0,max:((W=r==null?void 0:r.data)==null?void 0:W.total_proyectos)||1,variant:"warning",className:"mb-2"}),e.jsx("small",{className:"text-muted",children:"Proyectos activos"})]})})}),e.jsx(n,{md:3,children:e.jsx(o,{className:"h-100 border-0 shadow-sm",children:e.jsxs(o.Body,{className:"text-center",children:[e.jsxs("div",{className:"d-flex align-items-center justify-content-between mb-3",children:[e.jsx("div",{className:"bg-success bg-opacity-10 rounded-circle p-3",children:e.jsx(k,{className:"text-success",size:24})}),e.jsxs("div",{className:"text-end",children:[e.jsx("h3",{className:"mb-0 text-success",children:((X=r==null?void 0:r.data)==null?void 0:X.completados)||0}),e.jsx("small",{className:"text-muted",children:"Completados"})]})]}),e.jsx(P,{now:((Y=r==null?void 0:r.data)==null?void 0:Y.completados)||0,max:((Z=r==null?void 0:r.data)==null?void 0:Z.total_proyectos)||1,variant:"success",className:"mb-2"}),e.jsx("small",{className:"text-muted",children:"Proyectos finalizados"})]})})}),e.jsx(n,{md:3,children:e.jsx(o,{className:"h-100 border-0 shadow-sm",children:e.jsxs(o.Body,{className:"text-center",children:[e.jsxs("div",{className:"d-flex align-items-center justify-content-between mb-3",children:[e.jsx("div",{className:"bg-info bg-opacity-10 rounded-circle p-3",children:e.jsx(Ae,{className:"text-info",size:24})}),e.jsxs("div",{className:"text-end",children:[e.jsx("h3",{className:"mb-0 text-info",children:((ee=r==null?void 0:r.data)==null?void 0:ee.esta_semana)||0}),e.jsx("small",{className:"text-muted",children:"Esta Semana"})]})]}),e.jsx(P,{now:((se=r==null?void 0:r.data)==null?void 0:se.esta_semana)||0,max:((ae=r==null?void 0:r.data)==null?void 0:ae.total_proyectos)||1,variant:"info",className:"mb-2"}),e.jsx("small",{className:"text-muted",children:"Proyectos recientes"})]})})})]}),e.jsx(u,{children:e.jsx(n,{children:e.jsxs(o,{className:"border-0 shadow-sm",children:[e.jsx(o.Header,{className:"bg-white border-bottom",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("h5",{className:"mb-0",children:[e.jsx(S,{className:"me-2 text-primary"}),"Proyectos Recientes"]}),e.jsx(l,{variant:"outline-primary",size:"sm",onClick:()=>g("proyectos"),children:"Ver Todos"})]})}),e.jsx(o.Body,{children:(te=(re=x==null?void 0:x.data)==null?void 0:re.proyectos)==null?void 0:te.slice(0,5).map(a=>e.jsxs("div",{className:"d-flex align-items-center justify-content-between py-3 border-bottom",children:[e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"bg-light rounded-circle p-2 me-3",children:e.jsx(C,{className:"text-primary"})}),e.jsxs("div",{children:[e.jsx("h6",{className:"mb-1",children:a.proyecto_nombre}),e.jsxs("small",{className:"text-muted",children:["Cliente: ",a.cliente_nombre," ‚Ä¢ ",a.vendedor_nombre]})]})]}),e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[T(a.estado),e.jsxs(l,{variant:"outline-primary",size:"sm",onClick:()=>H(a),children:[e.jsx(de,{className:"me-1"}),"Ver"]})]})]},a.id))})]})})})]}),K==="proyectos"&&e.jsxs(e.Fragment,{children:[e.jsx(u,{className:"mb-4",children:e.jsx(n,{children:e.jsx(o,{className:"border-0 shadow-sm",children:e.jsx(o.Body,{children:e.jsxs(u,{children:[e.jsx(n,{md:4,children:e.jsxs(c.Group,{children:[e.jsx(c.Label,{children:"Buscar proyecto"}),e.jsxs(xe,{children:[e.jsx(xe.Text,{children:e.jsx(Le,{})}),e.jsx(c.Control,{type:"text",placeholder:"Nombre del proyecto o cliente...",value:t.search,onChange:a=>$("search",a.target.value)})]})]})}),e.jsx(n,{md:3,children:e.jsxs(c.Group,{children:[e.jsx(c.Label,{children:"Estado"}),e.jsxs(c.Select,{value:t.estado,onChange:a=>$("estado",a.target.value),children:[e.jsx("option",{value:"",children:"Todos los estados"}),e.jsx("option",{value:"borrador",children:"Borrador"}),e.jsx("option",{value:"en_laboratorio",children:"En Laboratorio"}),e.jsx("option",{value:"en_proceso",children:"En Proceso"}),e.jsx("option",{value:"completado",children:"Completado"}),e.jsx("option",{value:"pendiente",children:"Pendiente"})]})]})}),e.jsx(n,{md:3,children:e.jsxs(c.Group,{children:[e.jsx(c.Label,{children:"Prioridad"}),e.jsxs(c.Select,{children:[e.jsx("option",{value:"",children:"Todas las prioridades"}),e.jsx("option",{value:"alta",children:"Alta"}),e.jsx("option",{value:"media",children:"Media"}),e.jsx("option",{value:"baja",children:"Baja"})]})]})}),e.jsx(n,{md:2,className:"d-flex align-items-end",children:e.jsxs(l,{variant:"outline-secondary",className:"w-100",children:[e.jsx(Ee,{className:"me-1"}),"Filtrar"]})})]})})})})}),e.jsx(u,{children:e.jsx(n,{children:e.jsxs(o,{className:"border-0 shadow-sm",children:[e.jsx(o.Header,{className:"bg-white border-bottom",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("h5",{className:"mb-0",children:[e.jsx(S,{className:"me-2 text-primary"}),"Lista de Proyectos (",((ie=x==null?void 0:x.data)==null?void 0:ie.total)||0,")"]}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsxs(l,{variant:"outline-success",size:"sm",children:[e.jsx(M,{className:"me-1"}),"Exportar"]}),e.jsxs(l,{variant:"primary",size:"sm",children:[e.jsx(z,{className:"me-1"}),"Nuevo"]})]})]})}),e.jsx(o.Body,{className:"p-0",children:e.jsxs(Me,{hover:!0,className:"mb-0",children:[e.jsx("thead",{className:"bg-light",children:e.jsxs("tr",{children:[e.jsx("th",{children:"Proyecto"}),e.jsx("th",{children:"Cliente"}),e.jsx("th",{children:"Vendedor"}),e.jsx("th",{children:"Estado"}),e.jsx("th",{children:"Prioridad"}),e.jsx("th",{children:"Fecha"}),e.jsx("th",{children:"Acciones"})]})}),e.jsx("tbody",{children:(ne=(oe=x==null?void 0:x.data)==null?void 0:oe.proyectos)==null?void 0:ne.map(a=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("div",{children:[e.jsx("h6",{className:"mb-1",children:a.proyecto_nombre}),e.jsx("small",{className:"text-muted",children:a.description})]})}),e.jsx("td",{children:e.jsxs("div",{children:[e.jsx("div",{className:"fw-medium",children:a.cliente_nombre}),e.jsx("small",{className:"text-muted",children:a.cliente_email})]})}),e.jsx("td",{children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"bg-primary bg-opacity-10 rounded-circle p-1 me-2",children:e.jsx(Te,{className:"text-primary",size:14})}),a.vendedor_nombre]})}),e.jsx("td",{children:T(a.estado)}),e.jsx("td",{children:e.jsx(me,{bg:ve("media"),children:"Media"})}),e.jsx("td",{children:e.jsx("small",{className:"text-muted",children:new Date(a.fecha_envio_laboratorio||a.created_at).toLocaleDateString()})}),e.jsx("td",{children:e.jsxs("div",{className:"d-flex gap-1",children:[e.jsx(l,{variant:"outline-primary",size:"sm",onClick:()=>H(a),children:e.jsx(de,{})}),e.jsx(l,{variant:"outline-success",size:"sm",children:e.jsx(I,{})}),e.jsxs(N,{children:[e.jsx(N.Toggle,{variant:"outline-secondary",size:"sm",children:e.jsx(_e,{})}),e.jsxs(N.Menu,{children:[e.jsxs(N.Item,{children:[e.jsx(M,{className:"me-2"}),"Descargar"]}),e.jsxs(N.Item,{children:[e.jsx(ze,{className:"me-2"}),"Notificar"]})]})]})]})})]},a.id))})]})})]})})})]}),e.jsxs(f,{show:y,onHide:()=>m(!1),size:"lg",children:[e.jsx(f.Header,{closeButton:!0,children:e.jsxs(f.Title,{children:[e.jsx(C,{className:"me-2"}),s==null?void 0:s.proyecto_nombre]})}),e.jsx(f.Body,{children:s&&e.jsxs(Ie,{defaultActiveKey:"detalles",children:[e.jsx(he,{eventKey:"detalles",title:"Detalles",children:e.jsxs(u,{children:[e.jsxs(n,{md:6,children:[e.jsx("h6",{children:"Informaci√≥n del Proyecto"}),e.jsxs("p",{children:[e.jsx("strong",{children:"Cliente:"})," ",s.cliente_nombre]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Vendedor:"})," ",s.vendedor_nombre]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Estado:"})," ",T(s.estado)]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Descripci√≥n:"})," ",s.description]})]}),e.jsxs(n,{md:6,children:[e.jsx("h6",{children:"Acciones R√°pidas"}),e.jsxs("div",{className:"d-grid gap-2",children:[e.jsxs(l,{variant:"warning",onClick:()=>V("en_proceso"),disabled:E.isLoading,children:[e.jsx(B,{className:"me-1"}),"Marcar en Proceso"]}),e.jsxs(l,{variant:"success",onClick:()=>V("completado"),disabled:E.isLoading,children:[e.jsx(k,{className:"me-1"}),"Completar Proyecto"]})]})]})]})}),e.jsxs(he,{eventKey:"archivos",title:"Archivos",children:[e.jsxs("div",{className:"mb-3",children:[e.jsxs(c.Group,{children:[e.jsx(c.Label,{children:"Subir Archivos"}),e.jsx(c.Control,{type:"file",multiple:!0,onChange:be})]}),e.jsxs(c.Group,{className:"mt-3",children:[e.jsx(c.Label,{children:"Notas"}),e.jsx(c.Control,{as:"textarea",rows:3,value:F,onChange:a=>D(a.target.value),placeholder:"Agrega notas sobre el proyecto..."})]}),e.jsxs(l,{variant:"primary",className:"mt-2",onClick:ye,disabled:j.length===0||G.isLoading,children:[e.jsx(z,{className:"me-1"}),"Subir Archivos"]})]}),e.jsx("h6",{children:"Archivos del Proyecto"}),L==null?void 0:L.map((a,d)=>e.jsxs("div",{className:"d-flex align-items-center justify-content-between p-2 border rounded mb-2",children:[e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx(C,{className:"me-2 text-primary"}),e.jsx("span",{children:a.nombre})]}),e.jsx(l,{variant:"outline-primary",size:"sm",children:e.jsx(M,{})})]},d))]})]})}),e.jsx(f.Footer,{children:e.jsx(l,{variant:"secondary",onClick:()=>m(!1),children:"Cerrar"})})]})]})};export{rs as default};
//# sourceMappingURL=Laboratorio-CDC0qs2E.js.map
