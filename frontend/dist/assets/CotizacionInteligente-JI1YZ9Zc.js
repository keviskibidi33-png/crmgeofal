import{r as n,e as ta,j as e,C as ue,F as oa,W as na,ab as sa,o as ca,Q as ra,a6 as Ce,K as la,n as ia,X as da,B as se,a7 as ma,y as Ee,ac as ua,a5 as pa}from"./index-Bcrgukx7.js";import{M as ha}from"./ModuloBase-D0nbhoFs.js";import{g as ga,u as xa,c as ja}from"./quotes-BsLwC50y.js";import{s as Oe,l as fa,c as ba}from"./projects-CVN8cRbd.js";import{l as Na,f as ya}from"./companies-CT3vhc5O.js";import{s as va}from"./subservices-DgJgMyJ3.js";import{S as pe}from"./Spinner-jUAz7otr.js";import{F as Se}from"./Form-DBWuP9iW.js";import{S as _a}from"./SuccessModal-Brilhozx.js";import{M as J}from"./Modal-CPMvw6Im.js";import{A as ce}from"./Alert-C1-1JEUj.js";import{L as Ae}from"./ListGroup-DSlLuzI7.js";/* empty css                     */import"./ElementChildren-BWXp08bt.js";import"./Col-C5Zwr_ej.js";const Ca=({value:f="",onChange:h,onSelect:d,placeholder:C="Buscar servicio...",disabled:G=!1,size:E="sm"})=>{const[b,s]=n.useState(f),[u,m]=n.useState(!1),[w,r]=n.useState({top:0,left:0,width:0}),x=n.useRef(null),N=n.useRef(null),[I,k]=n.useState(b);n.useEffect(()=>{const i=setTimeout(()=>k(b),400);return()=>clearTimeout(i)},[b]);const{data:R,isLoading:P}=ta(["subservices",I],()=>va(I),{enabled:I.length>=2,staleTime:10*60*1e3,keepPreviousData:!0,refetchOnWindowFocus:!1}),l=(R==null?void 0:R.data)||[],y=()=>{if(x.current&&u){const i=x.current.getBoundingClientRect();r({top:i.bottom+window.scrollY+2,left:i.left+window.scrollX,width:i.width})}};n.useEffect(()=>{if(u){y();const i=()=>{u&&y()},v=()=>{u&&y()};return window.addEventListener("scroll",i,!0),window.addEventListener("resize",v),()=>{window.removeEventListener("scroll",i,!0),window.removeEventListener("resize",v)}}},[u]);const Y=i=>{const v=i.target.value;s(v),h==null||h(v),v.length>=2?m(!0):m(!1)},Z=()=>{b.length>=2&&(m(!0),y())},re=i=>{s(i.display_text),m(!1),d==null||d(i)},he=()=>{s(""),m(!1),h==null||h(""),d==null||d(null)};n.useEffect(()=>{const i=v=>{x.current&&!x.current.contains(v.target)&&N.current&&!N.current.contains(v.target)&&m(!1)};if(u)return document.addEventListener("mousedown",i),()=>document.removeEventListener("mousedown",i)},[u]);const H=i=>i===0?"Sujeto a evaluaci√≥n":`S/ ${i.toFixed(2)}`,ge=i=>({"ENSAYO EST√ÅNDAR":"primary","ENSAYOS ESPECIALES":"success","ENSAYOS DE CAMPO":"info","ENSAYO AGREGADO":"warning"})[i]||"secondary",Q=u&&b.length>=2&&e.jsxs("div",{ref:N,style:{position:"absolute",top:`${w.top}px`,left:`${w.left}px`,width:`${w.width}px`,zIndex:999999,maxHeight:"300px",overflowY:"auto",backgroundColor:"white",border:"1px solid #dee2e6",borderRadius:"4px",boxShadow:"0 4px 12px rgba(0,0,0,0.15)"},onMouseDown:i=>i.preventDefault(),children:[P&&e.jsxs("div",{className:"p-3 text-center text-muted",children:[e.jsx(pe,{animation:"border",size:"sm",className:"me-2"}),e.jsx("small",{children:"Buscando..."})]}),!P&&l.length===0&&e.jsx("div",{className:"p-3 text-center text-muted",children:e.jsx("small",{children:"No se encontraron resultados"})}),!P&&l.length>0&&l.map(i=>e.jsx("div",{className:"p-2 border-bottom",onClick:()=>re(i),style:{cursor:"pointer",transition:"background-color 0.15s"},onMouseEnter:v=>v.currentTarget.style.backgroundColor="#f8f9fa",onMouseLeave:v=>v.currentTarget.style.backgroundColor="white",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-start",children:[e.jsxs("div",{className:"flex-grow-1",children:[e.jsx("div",{className:"d-flex align-items-center gap-2 mb-1",children:e.jsx(ue,{bg:ge(i.service_name),className:"small",children:i.codigo})}),e.jsx("div",{className:"fw-bold small text-dark",children:i.descripcion}),i.norma&&i.norma!=="-"&&e.jsxs("div",{className:"text-muted",style:{fontSize:"0.75rem"},children:[e.jsx(oa,{size:10,className:"me-1"}),i.norma]})]}),e.jsx("div",{className:"text-end ms-2",children:e.jsxs("div",{className:"fw-bold text-success small",children:[e.jsx(na,{size:12}),H(i.precio)]})})]})},i.id))]});return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"position-relative",children:e.jsx(Se.Group,{className:"mb-0",children:e.jsxs("div",{className:"position-relative",children:[e.jsx(Se.Control,{ref:x,type:"text",value:b,onChange:Y,onFocus:Z,placeholder:C,disabled:G,size:E,className:"pe-5",autoComplete:"off"}),e.jsxs("div",{className:"position-absolute top-50 end-0 translate-middle-y pe-3 d-flex align-items-center gap-2",children:[P&&e.jsx(pe,{animation:"border",size:"sm",variant:"primary"}),!P&&b&&e.jsx(ca,{className:"text-muted",onClick:he,onMouseDown:i=>i.preventDefault(),style:{cursor:"pointer"}}),!P&&!b&&e.jsx(ra,{className:"text-muted"})]})]})})}),typeof document<"u"&&Q&&sa.createPortal(Q,document.body)]})},Ea=({show:f,onHide:h,projectName:d,companyId:C,onSelectExisting:G,onCreateNew:E})=>{const[b,s]=n.useState([]),[u,m]=n.useState(!1),[w,r]=n.useState(null);n.useEffect(()=>{console.log("üîç ProjectSelectionModal - useEffect triggered:",{show:f,projectName:d,companyId:C}),f&&d&&d.trim().length>=2&&x()},[f,d,C]);const x=async()=>{try{console.log("üîç ProjectSelectionModal - Iniciando b√∫squeda:",{projectName:d,companyId:C}),m(!0),r(null);const l=await Oe(d,C);console.log("‚úÖ ProjectSelectionModal - Proyectos encontrados:",l),s(l||[])}catch(l){console.error("‚ùå ProjectSelectionModal - Error searching projects:",l),r("Error al buscar proyectos existentes")}finally{m(!1)}},N=l=>{G(l),h()},I=()=>{E(),h()},k=()=>{const l=b.length+1,y=`${d} (${l})`;E(y),h()},R=l=>{const y=prompt(`Editar nombre del proyecto "${l.name}":`,l.name);y&&y.trim()!==l.name&&(console.log("Editar proyecto:",l.id,"nuevo nombre:",y),alert(`Funcionalidad de edici√≥n en desarrollo. Proyecto: ${l.name} ‚Üí ${y}`))},P=l=>new Date(l).toLocaleDateString("es-PE");return e.jsxs(J,{show:f,onHide:h,size:"lg",centered:!0,style:{zIndex:9999},children:[e.jsx(J.Header,{closeButton:!0,children:e.jsxs(J.Title,{children:[e.jsx(Ce,{className:"me-2"}),'Proyectos Existentes: "',d,'"']})}),e.jsxs(J.Body,{children:[u&&e.jsxs("div",{className:"text-center py-4",children:[e.jsx(pe,{animation:"border"}),e.jsx("p",{className:"mt-2",children:"Buscando proyectos existentes..."})]}),w&&e.jsx(ce,{variant:"danger",children:w}),!u&&!w&&b.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(ce,{variant:"warning",className:"mb-3",children:e.jsxs("div",{children:[e.jsxs("strong",{children:["‚ö†Ô∏è Se encontraron ",b.length,' proyecto(s) con el nombre "',d,'" en esta empresa.']}),e.jsx("br",{}),"Para evitar confusiones, el sistema sugiere diferenciarlos autom√°ticamente."]})}),e.jsx(ce,{variant:"info",className:"mb-3",children:e.jsxs("div",{children:[e.jsx("strong",{children:"üí° Opciones disponibles:"}),e.jsxs("ul",{className:"mb-0 mt-2",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Continuar con proyecto existente:"})," Usar uno de los proyectos listados"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Crear nuevo diferenciado:"}),' El sistema agregar√° autom√°ticamente "(2)", "(3)", etc.']}),e.jsxs("li",{children:[e.jsx("strong",{children:"Editar manualmente:"})," Puedes cambiar el nombre despu√©s de crear el proyecto"]})]})]})}),e.jsx(Ae,{children:b.map(l=>e.jsxs(Ae.Item,{className:"d-flex justify-content-between align-items-start",style:{cursor:"pointer"},onClick:()=>N(l),children:[e.jsxs("div",{className:"ms-2 me-auto",children:[e.jsxs("div",{className:"fw-bold",children:[e.jsx(Ce,{className:"me-1"}),l.name]}),e.jsxs("div",{className:"text-muted small",children:[e.jsx("strong",{children:"Empresa:"})," ",l.company_name," (RUC: ",l.company_ruc,")"]}),e.jsxs("div",{className:"text-muted small",children:[e.jsx(la,{className:"me-1"}),l.location||"Sin ubicaci√≥n"]}),e.jsxs("div",{className:"text-muted small",children:[e.jsx(ia,{className:"me-1"}),"Vendedor: ",l.vendedor_name||"No asignado"]}),e.jsxs("div",{className:"text-muted small",children:[e.jsx(da,{className:"me-1"}),"Creado: ",P(l.created_at)]})]}),e.jsxs("div",{className:"text-end",children:[e.jsx("div",{className:"mb-2",children:e.jsxs(se,{variant:"outline-secondary",size:"sm",onClick:y=>{y.stopPropagation(),R(l)},title:"Editar nombre para unificar proyectos",children:[e.jsx(ma,{className:"me-1"}),"Editar"]})}),e.jsxs("div",{children:[e.jsxs(ue,{bg:"secondary",className:"me-2",children:[l.quotes_count," cotizaci√≥n(es)"]}),e.jsx(ue,{bg:l.status==="activo"?"success":"warning",children:l.status})]})]})]},l.id))})]}),!u&&!w&&b.length===0&&e.jsxs(ce,{variant:"success",children:[e.jsx("strong",{children:"No se encontraron proyectos con ese nombre."}),e.jsx("br",{}),"Puedes crear un nuevo proyecto sin problemas."]})]}),e.jsxs(J.Footer,{children:[e.jsx(se,{variant:"outline-secondary",onClick:h,children:"Cancelar"}),e.jsxs(se,{variant:"warning",onClick:k,children:[e.jsx(Ee,{className:"me-1"}),'Crear "',d," (",b.length+1,')"']}),e.jsxs(se,{variant:"primary",onClick:I,children:[e.jsx(Ee,{className:"me-1"}),"Crear Nuevo (Nombre Original)"]})]})]})},we={company_name:"",ruc:"",contact_name:"",contact_phone:"",contact_email:"",project_location:"",project_name:""},Sa={request_date:"",issue_date:"",commercial_name:"",commercial_phone:"",payment_terms:"adelantado",reference:"",reference_type:["email","phone"],igv:!0,delivery_days:4,category_main:"laboratorio"},de={code:"",description:"",norm:"",unit_price:0,quantity:1};function De(f){const h=Number(f.unit_price||0),d=Number(f.quantity||0);return Number((h*d).toFixed(2))}function Aa(){const f=new Date().getFullYear(),h=String(new Date().getMonth()+1).padStart(2,"0"),d=String(new Date().getDate()).padStart(2,"0"),C=Math.floor(Math.random()*1e3).toString().padStart(3,"0");return`COT-${f}${h}${d}-${C}`}const M=(f="")=>(f||"").normalize("NFD").replace(/[\u0300-\u036f]/g,"").toUpperCase().trim(),me={[M("MUESTRA DE SUELO Y AGREGADO")]:`CONDICIONES ESPEC√çFICAS:
- El cliente debe enviar al laboratorio, para los ensayo en suelo y agregados, la cantidad minima de 100 kg por cada muestra.
- El cliente deber√° de entregar las muestras debidamente identificadas.
- El cliente deber√° especificar la Norma a ser utilizada para la ejecuci√≥n del ensayo, caso contrario se considera Norma ASTM o NTP vigente de acuerdo con el alcance del laboratorio.
- El cliente deber√° entregar las muestras en las instalaciones del LEM, ubicado en la Av. Mara√±√≥n N¬∞ 763, Los Olivos, Lima.`,[M("PROBETAS")]:`CONDICIONES ESPEC√çFICAS:
- El cliente debe proporcionar las probetas antes del ingreso a obra.
- El cliente deber√° de entregar las muestras debidamente identificadas.
- El cliente deber√° especificar la Norma a ser utilizada para la ejecuci√≥n del ensayo, caso contrario se considera Norma ASTM o NTP vigente de acuerdo con el alcance del laboratorio.
- El cliente deber√° entregar las muestras en las instalaciones del LEM, ubicado en la Av. Mara√±√≥n N¬∞ 763, Los Olivos, Lima.`,[M("DENSIDAD DE CAMPO Y MUESTREO")]:`CONDICIONES ESPEC√çFICAS:
- El cliente deber√° enviar al laboratorio, para los ensayo en suelo y agregados, la cantidad minima de 100 kg por cada muestra.
- Para el ensayo de Densidad de campo, la cantidad de puntos/salida minimo 4 und.
- El cliente deber√° de programar el servicio, Densidad de campo, con 24 horas de anticipaci√≥n.
- El cliente deber√° especificar la Norma a ser utilizada para la ejecuci√≥n del ensayo, caso contrario se considera Norma ASTM o NTP vigente de acuerdo con el alcance del laboratorio.
- El cliente deber√° entregar las muestras en las instalaciones del LEM, ubicado en la Av. Mara√±√≥n N¬∞ 763, Los Olivos, Lima.`,[M("EXTRACCI√ìN DE DIAMANTINA")]:`CONDICIONES ESPEC√çFICAS:
- Movilizaci√≥n y desmovilizaci√≥n de equipos y del personal t√©cnico, estara a cargo de GEOFAL.
- Resane de estructura de concreto con sika rep 500 y Sikadur 32, estara a cargo de GEOFAL.
- El servicio no incluye trabajos de acabados como pintura, mayolica y otros.
- El area de trabajo, zona de extracci√≥n de diamantina, tiene que estar libre de interferencia.
- La extracci√≥n de diamantina se realizara en 2 dia en campo, en laboratorio se realizar√° el tallado y refrentado de diamantina, el ensayo de resistencia a la compresi√≥n de testigo de diamantina se realizara en 5 dias (el tiempo de ensayo obedece a la normativa vigente).
- Costo de resane insumos 250 soles, este costo se distribuira de acuerdo con el numero de perforaciones Donde se hara las extracciones de diamantina`,[M("DIAMANTINA PARA PASES")]:`CONDICIONES ESPEC√çFICAS:
- El cliente deber√° de programar el servicio, Extracci√≥n diamantina, con 24 horas de anticipaci√≥n.
- El area de trabajo, zona de extraccion de diamantina, debera estar libre de interferencia.
- Para extraer la diamantina, se ubicara el acero con un escaneador.
- Movilizacion y desmovilizacion de equipos y del personal tecnico, estara a cargo de Geofal.`,[M("ALBA√ëILER√çA")]:`CONDICIONES ESPEC√çFICAS:
- El cliente deber√° enviar al laboratorio, 20 ladrillo de cada tipo, en buen estado y sin presentar fisuras.
- El cliente deber√° de entregar las muestras debidamente identificadas.
- El cliente deber√° especificar la Norma a ser utilizada para la ejecuci√≥n del ensayo, caso contrario se considera Norma ASTM o NTP vigente de acuerdo con el alcance del laboratorio.
- El cliente deber√° entregar las muestras en las instalaciones del LEM, ubicado en la Av. Mara√±√≥n N¬∞ 763, Los Olivos, Lima`,[M("VIGA BECKELMAN")]:`CONDICIONES ESPEC√çFICAS:
- El cliente deber√° de programar el servicio, Ensayo de Deflexi√≥n, con 24 horas de anticipaci√≥n.
- El area de trabajo tiene que estar habilitado.
- El cliente deber√° especificar la Norma a ser utilizada para la ejecuci√≥n del ensayo, caso contrario se considera Norma ASTM o NTP o MTC vigente de acuerdo con el alcance del laboratorio.
- Especificar las caracteristicas del camion`,[M("CONTROL DE CALIDAD DE CONCRETO FRESCO EN OBRA")]:`CONDICIONES ESPEC√çFICAS:
- El cliente deber√° de programar el servicio, con 24 horas de anticipaci√≥n.
- Para el ensayo de control de calidad de concreto fresco en obra, se moldeara 6 probetas, ensayo slump, control de temperatura, en laboratorio las probetas se colocara en camara de curado, el ensayo de compresi√≥n de las probetas seran 3 a 7 dias y 3 a 28 dias.
- El control de calidad del concreto fresco se sacara cada 50m3 a uno de los mixer donde se hara todos los ensayos respectivos mencionados, o por dia asi no se halla llegado los 50m3.
- El cliente deber√° especificar la Norma a ser utilizada para la ejecuci√≥n del ensayo, caso contrario se considera Norma ASTM o NTP vigente de acuerdo con el alcance del laboratorio.`},L=f=>{const h=M((f==null?void 0:f.title)||"");if(me[h])return me[h];const d=Object.entries(me).find(([C])=>h.includes(C)||C.includes(h));return d?d[1]:""};function Ga(){var _e;const[f]=ua(),h=pa(),d=f.get("edit"),[C,G]=n.useState([]),[E,b]=n.useState(""),[s,u]=n.useState(we),[m,w]=n.useState({company_id:null,project_id:null,company:null,project:null}),[r,x]=n.useState(Sa),[N,I]=n.useState([{...de}]),[k,R]=n.useState(!1),[P,l]=n.useState(""),[y,Y]=n.useState(""),[Z,re]=n.useState(null),[he,H]=n.useState([]),[ge,Q]=n.useState([]),[i,v]=n.useState(!1),[Ie,wa]=n.useState(""),[Pe,xe]=n.useState(!1),[S,je]=n.useState(null),[F,fe]=n.useState([]),[q,be]=n.useState([]),[ee,$]=n.useState(""),[A,z]=n.useState(null),[Ne,X]=n.useState(!1),[Te,ye]=n.useState(!1),[Le,Me]=n.useState(null),[Re,ve]=n.useState(!1),[Fe,ze]=n.useState(""),[ke,qe]=n.useState(null),[le,Da]=n.useState(null),[K,V]=n.useState(null);n.useEffect(()=>{const a=[{id:"V1",code:"V1",title:"MUESTRA DE SUELO Y AGREGADO",description:L({title:"MUESTRA DE SUELO Y AGREGADO"})},{id:"V2",code:"V2",title:"PROBETAS",description:L({title:"PROBETAS"})},{id:"V3",code:"V3",title:"DENSIDAD DE CAMPO Y MUESTREO",description:L({title:"DENSIDAD DE CAMPO Y MUESTREO"})},{id:"V4",code:"V4",title:"EXTRACCI√ìN DE DIAMANTINA",description:L({title:"EXTRACCI√ìN DE DIAMANTINA"})},{id:"V5",code:"V5",title:"DIAMANTINA PARA PASES",description:L({title:"DIAMANTINA PARA PASES"})},{id:"V6",code:"V6",title:"ALBA√ëILER√çA",description:L({title:"ALBA√ëILER√çA"})},{id:"V7",code:"V7",title:"VIGA BECKELMAN",description:L({title:"VIGA BECKELMAN"})},{id:"V8",code:"V8",title:"CONTROL DE CALIDAD DE CONCRETO FRESCO EN OBRA",description:L({title:"CONTROL DE CALIDAD DE CONCRETO FRESCO EN OBRA"})}];G(a)},[]),n.useEffect(()=>{(async()=>{try{const t=(await fa({page:1,limit:100})).data||[];H(t),Q(t)}catch(a){console.warn("No se pudieron cargar proyectos existentes:",a),H([]),Q([])}})()},[]),n.useEffect(()=>{m.company&&u(a=>{var t,o;return{...a,company_name:m.company.name||a.company_name,ruc:m.company.ruc||a.ruc,contact_name:m.company.contact_name||a.contact_name,contact_phone:m.company.phone||a.contact_phone,contact_email:m.company.email||a.contact_email,project_location:((t=m.project)==null?void 0:t.location)||a.project_location,project_name:((o=m.project)==null?void 0:o.name)||a.project_name}})},[m.company,m.project]),n.useEffect(()=>{(async()=>{try{const t=localStorage.getItem("token");if(!t)return;const o=await fetch("http://localhost:4000/api/auth/me",{headers:{Authorization:`Bearer ${t}`}});if(o.ok){const c=await o.json();c.user&&(je(c.user),x(p=>({...p,commercial_name:c.user.name||p.commercial_name,commercial_phone:c.user.phone||p.commercial_phone,issue_date:p.issue_date||new Date().toISOString().slice(0,10),request_date:p.request_date||new Date().toISOString().slice(0,10)})))}}catch(t){console.warn("No se pudo obtener datos del usuario:",t)}})()},[]),n.useEffect(()=>{if(!E)return;const a=(C||[]).find(c=>String(c.id)===String(E));if(!a)return;const t=a.conditions||{};x(c=>({...c,payment_terms:t.default_payment_terms||c.payment_terms,igv:typeof t.default_igv=="boolean"?t.default_igv:c.igv,reference:t.default_reference||c.reference}));const o=L(a)||a.description||"";o&&Y(o)},[E]);const U=n.useMemo(()=>N.reduce((a,t)=>a+De(t),0),[N]),ae=n.useMemo(()=>r.igv?Number((U*.18).toFixed(2)):0,[U,r.igv]),ie=n.useMemo(()=>Number((U+ae).toFixed(2)),[U,ae]),$e=()=>I([...N,{...de}]),Ve=a=>I(N.filter((t,o)=>o!==a)),B=(a,t)=>I(N.map((o,c)=>c===a?{...o,...t}:o)),Ue=async()=>{try{console.log("üîç fetchClients - Llamando a /api/companies");const a=await Na({limit:500});console.log("üîç fetchClients - Respuesta recibida:",a);const t=(a==null?void 0:a.data)||a||[];console.log("üîç fetchClients - Lista de clientes:",t.length,"clientes"),fe(t)}catch(a){console.error("‚ùå Error fetching clients:",a),l("Error al cargar los clientes: "+(a.message||"Error desconocido")),fe([])}},Be=a=>{if(console.log("üîç handleClientSearch - T√©rmino de b√∫squeda:",a),$(a),!a.trim()){be([]),X(!1);return}const t=a.toLowerCase();console.log("üîç handleClientSearch - B√∫squeda en min√∫sculas:",t);const o=F.filter(c=>{var O,te,oe,W,ne;const p=(O=c.name)==null?void 0:O.toLowerCase().includes(t),j=(te=c.ruc)==null?void 0:te.toLowerCase().includes(t),g=(oe=c.email)==null?void 0:oe.toLowerCase().includes(t),_=(W=c.phone)==null?void 0:W.toLowerCase().includes(t),T=(ne=c.name)==null?void 0:ne.toLowerCase().split(" ").some(aa=>aa.includes(t)),D=p||j||g||_||T;return D&&console.log("‚úÖ Cliente encontrado:",c.name,"- Match:",{nameMatch:p,nameWordsMatch:T,rucMatch:j,emailMatch:g,phoneMatch:_}),D});console.log("üîç handleClientSearch - Resultados encontrados:",o.length),be(o),X(!0)},Ge=a=>{console.log("üîç handleClientSelect - Cliente seleccionado:",a.name,"ID:",a.id),z(a),$(a.name),X(!1),u(t=>({...t,company_name:a.name||"",ruc:a.ruc||"",contact_name:a.contact_name||"",contact_phone:a.phone||"",contact_email:a.email||"",project_location:a.address||""})),console.log("‚úÖ Campos del cliente llenados autom√°ticamente:",{company_name:a.name,ruc:a.ruc,contact_name:a.contact_name,contact_phone:a.phone,contact_email:a.email,project_location:a.address})},Ye=()=>{console.log("üîç handleClientClear - Limpiando selecci√≥n de cliente"),z(null),$(""),X(!1),u(we)};n.useEffect(()=>{d&&F.length>0&&Qe(d)},[d,F]);const Qe=async a=>{xe(!0);try{console.log("üîÑ Cargando cotizaci√≥n existente:",a);const t=await ga(a);if(console.log("‚úÖ Cotizaci√≥n cargada:",t),!S)try{const c=localStorage.getItem("token");if(c){const p=await fetch("http://localhost:4000/api/auth/me",{headers:{Authorization:`Bearer ${c}`}});if(p.ok){const j=await p.json();j.user&&(je(j.user),console.log("‚úÖ Usuario cargado para edici√≥n:",j.user))}}}catch(c){console.warn("No se pudo obtener datos del usuario para edici√≥n:",c)}if(t.meta&&typeof t.meta=="string")try{t.meta=JSON.parse(t.meta),console.log("‚úÖ Meta parseado correctamente:",t.meta)}catch(c){console.error("‚ùå Error parseando meta:",c),t.meta={}}if(t.client_contact||t.company_name){const c=t.company_name||t.client_company||t.client_contact||"",p=t.client_contact||"";u(g=>({...g,company_name:c,ruc:t.company_ruc||t.client_ruc||"",contact_name:p,contact_phone:t.client_phone||"",contact_email:t.client_email||"",project_location:t.project_location||"",project_name:t.project_name||""})),$(c),console.log("üîç Configurando b√∫squeda de cliente:",c),console.log("üîç RUC del cliente:",t.company_ruc||t.client_ruc),console.log("üîç Tel√©fono del cliente:",t.client_phone);const j=t.company_ruc||t.client_ruc;if(j){console.log("üîç Buscando cliente por RUC:",j);const g=F.find(_=>_.ruc===j);if(g)console.log("‚úÖ Cliente encontrado:",g),z(g);else{console.log("‚ùå Cliente no encontrado en la lista, creando cliente simulado");const _={id:"existing",name:c,ruc:j||"",email:t.client_email||"",phone:t.client_phone||"",contact_name:p,address:t.project_location||""};z(_),console.log("‚úÖ Cliente simulado creado:",_)}}else{const g={id:"existing",name:c,ruc:"",email:t.client_email||"",phone:t.client_phone||"",contact_name:p,address:t.project_location||""};z(g),console.log("‚úÖ Cliente simulado creado (sin RUC):",g)}}x(c=>{var p,j,g,_;return{...c,request_date:((j=(p=t.meta)==null?void 0:p.quote)==null?void 0:j.request_date)||t.request_date||new Date().toISOString().slice(0,10),issue_date:t.issue_date||new Date().toISOString().slice(0,10),commercial_name:t.commercial_name||(S==null?void 0:S.name)||"",commercial_phone:t.commercial_phone||(S==null?void 0:S.phone)||"",payment_terms:t.payment_terms||"adelantado",reference:t.reference||"",reference_type:t.reference_type||["email","phone"],igv:t.igv!==!1,delivery_days:((_=(g=t.meta)==null?void 0:g.quote)==null?void 0:_.delivery_days)||t.delivery_days||4,category_main:t.category_main||"laboratorio"}});let o=[];t.meta&&t.meta.items&&t.meta.items.length>0?(o=t.meta.items,console.log("‚úÖ Cargando √≠tems desde meta.items:",o.length)):t.items&&t.items.length>0&&(o=t.items,console.log("‚úÖ Cargando √≠tems desde items directo:",o.length)),o.length>0?(I(o),console.log("üì¶ √çtems cargados para edici√≥n:",o)):(console.log("üì¶ No hay √≠tems para cargar, usando √≠tem vac√≠o por defecto"),I([{...de}])),t.variant_id&&(b(t.variant_id),console.log("üîÑ Variante cargada:",t.variant_id)),t.meta&&t.meta.conditions_text&&(Y(t.meta.conditions_text),console.log("üìù Condiciones espec√≠ficas cargadas")),console.log("‚úÖ Datos de cotizaci√≥n cargados para edici√≥n")}catch(t){console.error("‚ùå Error cargando cotizaci√≥n:",t),l("Error al cargar la cotizaci√≥n existente: "+(t.message||"Error desconocido"))}finally{xe(!1)}};n.useEffect(()=>{Ue()},[]),n.useEffect(()=>{var a;if((a=h.state)!=null&&a.selectedClient&&F.length>0){const t=h.state.selectedClient;console.log("üéØ Cliente pre-seleccionado desde navegaci√≥n:",t);const o=F.find(c=>c.id===t.id);o?(console.log("‚úÖ Cliente encontrado en la lista, pre-llenando datos"),z(o),$(o.name),u(c=>({...c,company_name:o.name||"",ruc:o.ruc||o.dni||"",contact_name:o.contact_name||"",contact_phone:o.phone||"",contact_email:o.email||"",project_location:o.address||""}))):(console.log("‚ö†Ô∏è Cliente no encontrado en la lista, usando datos de navegaci√≥n"),z(t),$(t.name),u(c=>({...c,company_name:t.name||"",ruc:t.ruc||t.dni||"",contact_name:t.contact_name||"",contact_phone:t.phone||"",contact_email:t.email||"",project_location:t.address||""})))}},[(_e=h.state)==null?void 0:_e.selectedClient,F]),n.useEffect(()=>()=>{le&&clearTimeout(le)},[le]);const Xe=async a=>{var t,o,c;a.preventDefault(),R(!0),l("");try{if(!s.company_name)throw new Error("Debe ingresar al menos el nombre de la empresa");let p=((t=m.project)==null?void 0:t.id)||m.project_id,j=(o=m.company)==null?void 0:o.id;if(!j){if(!s.ruc)throw new Error("Debe ingresar el RUC de la empresa");const O=await ya({type:"empresa",ruc:s.ruc,name:s.company_name,address:s.project_location||"",email:s.contact_email||"",phone:s.contact_phone||"",contact_name:s.contact_name||"",city:s.project_location||"",sector:"servicios"});j=O.id,console.log("‚úÖ Empresa obtenida/creada:",O)}if(!p){const O=await ba({company_id:j,name:s.project_name||`Proyecto ${s.company_name}`,location:s.project_location||"Por definir",contact_name:s.contact_name,contact_phone:s.contact_phone,contact_email:s.contact_email,status:"activo",priority:"normal",vendedor_id:(S==null?void 0:S.id)||null,requiere_laboratorio:r.category_main==="laboratorio",laboratorio_status:r.category_main==="laboratorio"?"pendiente":"no_requerido"});p=O.id,console.log("‚úÖ Proyecto creado autom√°ticamente:",O),console.log("üë§ Vendedor asignado:",S==null?void 0:S.name)}const g=Aa(),_={project_id:p,variant_id:E||null,client_contact:s.contact_name,client_email:s.contact_email,client_phone:s.contact_phone,client_company:s.company_name,client_ruc:s.ruc,project_name:s.project_name,project_location:s.project_location,request_date:r.request_date||new Date().toISOString().slice(0,10),issue_date:r.issue_date||new Date().toISOString().slice(0,10),subtotal:U,igv:ae,total:ie,status:"borrador",reference:r.reference,reference_type:JSON.stringify(r.reference_type),category_main:r.category_main,quote_code:g,meta:JSON.stringify({customer:s,quote:{...r,request_date:r.request_date||new Date().toISOString().slice(0,10),delivery_days:r.delivery_days||4,reference:r.reference,category_main:r.category_main,quote_code:g},items:N,conditions_text:y,payment_terms:r.payment_terms,file_name:Ie||`Cotizaci√≥n ${new Date().getFullYear()}-${String(new Date().getMonth()+1).padStart(2,"0")}${String(new Date().getDate()).padStart(2,"0")} LEM-GEOFAL-${((c=s.company_name)==null?void 0:c.toUpperCase())||"CLIENTE"}`})};let T,D;d?(T=await xa(d,_),D="Cotizaci√≥n actualizada exitosamente",console.log("‚úÖ Cotizaci√≥n actualizada:",T)):(T=await ja(_),D="Cotizaci√≥n creada exitosamente",console.log("‚úÖ Nueva cotizaci√≥n creada:",T)),Me({code:g,category:r.category_main==="laboratorio"?"üß™ Laboratorio":"‚öôÔ∏è Ingenier√≠a",itemsCount:N.length,total:ie.toLocaleString(),isEdit:!!d,message:D}),ye(!0),re(T.id)}catch(p){console.error("Error:",p),l(p.message||"Error al crear cotizaci√≥n")}finally{R(!1)}},Ke=async()=>{try{const a=Z;if(!a)return alert("Guarde la cotizaci√≥n antes de generar el borrador");const t="http://localhost:4000/api".replace(/\/$/,"")||"",o=`/api/quotes/${a}/export/pdf-draft`,c=t&&/\/api$/i.test(t)?`${t}${o.replace(/^\/api/,"")}`:`${t}${o}`,p=localStorage.getItem("token");if(!p)throw new Error("No se encontr√≥ token de autenticaci√≥n");const j={variant_id:E,delivery_days:r.delivery_days,meta:{customer:s,quote:{...r,delivery_days:r.delivery_days,variant_id:E},items:N,conditions_text:y,payment_terms:r.payment_terms},items:N};console.log("üîç exportDraft - Enviando datos:",j);const g=await fetch(c,{method:"POST",headers:{Authorization:`Bearer ${p}`,"Content-Type":"application/json"},body:JSON.stringify(j)});if(!g.ok)throw new Error(`Error ${g.status}: ${g.statusText}`);const _=await g.blob(),T=window.URL.createObjectURL(_),D=document.createElement("a");D.href=T;const O=new Date,te=String(O.getDate()).padStart(2,"0"),oe=String(O.getMonth()+1).padStart(2,"0"),W=String(O.getFullYear()).slice(-2),ne=`COT-${te}${oe}${W}-${W}.pdf`;D.download=ne,document.body.appendChild(D),D.click(),document.body.removeChild(D),window.URL.revokeObjectURL(T)}catch(a){console.error("Error al exportar borrador:",a),alert(`No se pudo exportar borrador: ${a.message}`)}},We=a=>{var t;if(u({...s,project_name:a}),a&&a.trim().length>=3){const o=((t=m.company)==null?void 0:t.id)||(A==null?void 0:A.id);o&&Je(a.trim(),o)}},Je=async(a,t)=>{try{const o=await Oe(a,t);o&&o.length>0?V({count:o.length,suggestedName:`${a} (${o.length+1})`}):V(null)}catch(o){console.error("Error verificando proyectos duplicados:",o),V(null)}},Ze=async()=>{var o,c;const a=(o=s.project_name)==null?void 0:o.trim();if(!a||a.length<3){alert("Por favor ingresa al menos 3 caracteres en el nombre del proyecto");return}let t=(c=m.company)==null?void 0:c.id;if(!t&&A&&(t=A.id),!t){alert("Por favor selecciona una empresa primero usando el buscador de clientes");return}console.log("üîç Verificando proyectos existentes para:",a,"empresa:",t),console.log("üîç selectedClient:",A),console.log("üîç selection.company:",m.company),ze(a),qe(t),ve(!0)},He=a=>{console.log("üîÑ Seleccionando proyecto existente:",a),w(t=>({...t,project:a,project_id:a.id})),u(t=>({...t,project_name:a.name,project_location:a.location||t.project_location})),V(null),console.log("‚úÖ Proyecto existente seleccionado y estado actualizado:",a)},ea=(a=null)=>{console.log("üîÑ Creando nuevo proyecto:",a),w(t=>({...t,project:null,project_id:null})),a?(u(t=>({...t,project_name:a})),console.log("‚úÖ Se crear√° un nuevo proyecto con nombre diferenciado:",a)):console.log("‚úÖ Se crear√° un nuevo proyecto con nombre original"),V(null)};return e.jsxs(ha,{titulo:d?"üìù Editar Cotizaci√≥n":"üìã Cotizaci√≥n Inteligente",descripcion:d?"Edita una cotizaci√≥n existente con nueva fecha":"Formulario unificado para crear cotizaciones de forma r√°pida e intuitiva",children:[Pe&&e.jsx("div",{className:"alert alert-info",children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"spinner-border spinner-border-sm me-2",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Cargando..."})}),"Cargando cotizaci√≥n existente..."]})}),P&&e.jsx("div",{className:"alert alert-danger",children:P}),e.jsxs("form",{onSubmit:Xe,className:"intelligent-quote-form",children:[e.jsxs("div",{className:"alert alert-light border mt-3 intelligent-intro",children:[e.jsx("h5",{children:"üöÄ Flujo Simplificado"}),e.jsx("p",{className:"mb-0",children:'Completa los datos del cliente, proyecto y cotizaci√≥n. Usa el bot√≥n "üíæ GUARDAR COTIZACI√ìN" para guardar tu trabajo.'})]}),e.jsxs("div",{className:"intelligent-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("span",{className:"section-icon",children:"üè¢"}),e.jsx("h4",{children:"CLIENTE"}),e.jsx("span",{className:"section-status",children:s.company_name?"‚úÖ Cliente configurado":"‚è≥ Pendiente"})]}),e.jsxs("div",{className:"section-content",children:[e.jsx("div",{className:"row g-3 mb-4",children:e.jsxs("div",{className:"col-md-12",children:[e.jsx("label",{className:"form-label",children:"Buscar Cliente Existente"}),e.jsxs("div",{className:"position-relative",children:[e.jsx("input",{type:"text",className:"form-control",value:ee,onChange:a=>Be(a.target.value),onFocus:()=>X(!0),placeholder:"Buscar por nombre, RUC, email o tel√©fono..."}),A&&e.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm position-absolute end-0 top-50 translate-middle-y me-2",onClick:Ye,children:"‚úï"})]}),ee&&Ne&&q.length>0&&e.jsxs("div",{className:"border rounded mt-2",style:{maxHeight:"200px",overflowY:"auto"},children:[e.jsx("div",{className:"p-2 bg-light border-bottom",children:e.jsxs("small",{className:"text-muted",children:[q.length," cliente",q.length!==1?"s":""," encontrado",q.length!==1?"s":""]})}),q.map(a=>e.jsxs("div",{className:"p-2 border-bottom cursor-pointer hover-bg-light",onClick:()=>Ge(a),style:{cursor:"pointer"},children:[e.jsx("div",{className:"fw-bold",children:a.name}),e.jsxs("small",{className:"text-muted",children:["RUC: ",a.ruc," | Email: ",a.email,a.phone&&` | Tel: ${a.phone}`]})]},a.id))]}),ee&&Ne&&q.length===0&&e.jsx("div",{className:"border rounded mt-2 p-3 text-center",children:e.jsxs("small",{className:"text-muted",children:['No se encontraron clientes con "',ee,'"']})}),A&&e.jsxs("div",{className:"mt-2 p-2 bg-light rounded",children:[e.jsx("strong",{children:"Cliente seleccionado:"})," ",A.name,e.jsx("br",{}),e.jsxs("small",{className:"text-muted",children:["RUC: ",A.ruc," | Email: ",A.email,A.phone&&` | Tel: ${A.phone}`]})]})]})}),e.jsxs("div",{className:"row g-3",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"Empresa"}),e.jsx("input",{className:"form-control",value:s.company_name,onChange:a=>u({...s,company_name:a.target.value}),required:!0,placeholder:"Nombre de la empresa"})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"R.U.C. *"}),e.jsx("input",{className:"form-control",value:s.ruc,onChange:a=>u({...s,ruc:a.target.value}),placeholder:"RUC de la empresa",required:!0})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"Contacto"}),e.jsx("input",{className:"form-control",value:s.contact_name,onChange:a=>u({...s,contact_name:a.target.value}),required:!0,placeholder:"Nombre del contacto"})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"Tel√©fono"}),e.jsx("input",{className:"form-control",value:s.contact_phone,onChange:a=>u({...s,contact_phone:a.target.value}),placeholder:"Tel√©fono del contacto"})]}),e.jsxs("div",{className:"col-md-12",children:[e.jsx("label",{className:"form-label",children:"Correo"}),e.jsx("input",{type:"email",className:"form-control",value:s.contact_email,onChange:a=>u({...s,contact_email:a.target.value}),placeholder:"Correo del contacto"})]})]})]})]}),e.jsxs("div",{className:"intelligent-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("span",{className:"section-icon",children:"üìÅ"}),e.jsx("h4",{children:"PROYECTO"}),e.jsx("span",{className:"section-status",children:s.project_name?"‚úÖ Proyecto configurado":"‚è≥ Pendiente"})]}),e.jsx("div",{className:"section-content",children:e.jsxs("div",{className:"row g-3",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsxs("label",{className:"form-label",children:["Nombre del Proyecto",m.project&&e.jsx("span",{className:"badge bg-success ms-2",children:"‚úÖ Proyecto existente seleccionado"})]}),e.jsxs("div",{className:"input-group",children:[e.jsx("input",{className:`form-control ${K?"is-warning":m.project?"is-success":""}`,value:s.project_name,onChange:a=>We(a.target.value),required:!0,placeholder:"Nombre del proyecto"}),e.jsx("button",{type:"button",className:"btn btn-outline-info",onClick:Ze,title:"Verificar si ya existen proyectos con este nombre",children:"üîç Verificar"})]}),K&&e.jsxs("div",{className:"alert alert-warning mt-2 mb-0",children:[e.jsx("strong",{children:"‚ö†Ô∏è Advertencia:"})," Se encontraron ",K.count," proyecto(s) con este nombre.",e.jsx("br",{}),e.jsxs("small",{children:["Sugerencia: ",e.jsx("code",{children:K.suggestedName}),e.jsx("button",{type:"button",className:"btn btn-sm btn-outline-warning ms-2",onClick:()=>{u(a=>({...a,project_name:K.suggestedName})),V(null)},children:"Usar sugerencia"})]})]}),m.project&&e.jsx("div",{className:"alert alert-success mt-2 mb-0",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-start",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"‚úÖ Proyecto existente seleccionado:"})," ",m.project.name,e.jsx("br",{}),e.jsxs("small",{children:["Ubicaci√≥n: ",m.project.location||"No especificada"," | Vendedor: ",m.project.vendedor_name||"No asignado"," | Cotizaciones: ",m.project.quotes_count||0]})]}),e.jsx("button",{type:"button",className:"btn btn-sm btn-outline-danger",onClick:()=>{w(a=>({...a,project:null,project_id:null})),console.log("üîÑ Proyecto existente deseleccionado")},title:"Deseleccionar proyecto existente",children:"‚úï"})]})})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"Ubicaci√≥n"}),e.jsx("input",{className:"form-control",value:s.project_location,onChange:a=>u({...s,project_location:a.target.value}),placeholder:"Ubicaci√≥n del proyecto"})]})]})})]}),e.jsxs("div",{className:"intelligent-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("span",{className:"section-icon",children:"üìã"}),e.jsx("h4",{children:"COTIZACI√ìN"}),e.jsx("span",{className:"section-status",children:E?"‚úÖ Variante seleccionada":"‚è≥ Pendiente"})]}),e.jsxs("div",{className:"section-content",children:[e.jsxs("div",{className:"row g-3",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"Fecha de Solicitud"}),e.jsx("input",{type:"date",className:"form-control",value:r.request_date,onChange:a=>x({...r,request_date:a.target.value})})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"Fecha de Emisi√≥n"}),e.jsx("input",{type:"date",className:"form-control",value:r.issue_date,onChange:a=>x({...r,issue_date:a.target.value})})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"Comercial"}),e.jsx("input",{className:"form-control",value:r.commercial_name,onChange:a=>x({...r,commercial_name:a.target.value}),placeholder:"Nombre del comercial"})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"Tel√©fono Comercial"}),e.jsx("input",{type:"tel",className:"form-control",value:r.commercial_phone,onChange:a=>x({...r,commercial_phone:a.target.value}),required:!0,placeholder:"Tel√©fono del comercial"})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"Variante"}),e.jsxs("select",{className:"form-select",value:E,onChange:a=>b(a.target.value),children:[e.jsx("option",{value:"",children:"Seleccionar variante"}),(C||[]).map(a=>e.jsxs("option",{value:a.id,children:[a.code," - ",a.title]},a.id))]})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"Forma de Pago"}),e.jsxs("select",{className:"form-select",value:r.payment_terms,onChange:a=>x({...r,payment_terms:a.target.value}),children:[e.jsx("option",{value:"adelantado",children:"Adelantado"}),e.jsx("option",{value:"50%",children:"Adelanto 50% y saldo previo al informe"}),e.jsx("option",{value:"credito7",children:"Cr√©dito 7 d√≠as con OS"}),e.jsx("option",{value:"credito15",children:"Cr√©dito 15 d√≠as con OS"}),e.jsx("option",{value:"credito30",children:"Cr√©dito 30 d√≠as con OS"})]})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"D√≠as H√°biles"}),e.jsx("input",{type:"number",className:"form-control",value:r.delivery_days,onChange:a=>x({...r,delivery_days:parseInt(a.target.value)||4}),min:"1",max:"30"})]}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"form-check mt-4",children:[e.jsx("input",{className:"form-check-input",type:"checkbox",id:"igv",checked:r.igv,onChange:a=>x({...r,igv:a.target.checked})}),e.jsx("label",{className:"form-check-label",htmlFor:"igv",children:"Aplicar IGV 18%"})]})})]}),e.jsxs("div",{className:"mt-3",children:[e.jsx("label",{className:"form-label",children:"Referencia"}),e.jsx("input",{className:"form-control",value:r.reference,onChange:a=>x({...r,reference:a.target.value}),placeholder:"SEG√öN LO SOLICITADO V√çA CORREO ELECTR√ìNICO / LLAMADA TELEF√ìNICA"})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"form-label",children:"Categor√≠a Principal"}),e.jsxs("div",{className:"row g-3",children:[e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"form-check",children:[e.jsx("input",{className:"form-check-input",type:"radio",name:"categoryMain",id:"laboratorio",value:"laboratorio",checked:r.category_main==="laboratorio",onChange:a=>x({...r,category_main:a.target.value})}),e.jsx("label",{className:"form-check-label",htmlFor:"laboratorio",children:"üß™ Laboratorio"})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"form-check",children:[e.jsx("input",{className:"form-check-input",type:"radio",name:"categoryMain",id:"ingenieria",value:"ingenieria",checked:r.category_main==="ingenieria",onChange:a=>x({...r,category_main:a.target.value})}),e.jsx("label",{className:"form-check-label",htmlFor:"ingenieria",children:"‚öôÔ∏è Ingenier√≠a"})]})})]}),e.jsx("div",{className:"alert alert-info mt-2",children:e.jsxs("small",{children:[e.jsx("strong",{children:"üí° Importante:"})," Selecciona la categor√≠a principal para que el sistema pueda categorizar autom√°ticamente los √≠tems y alimentar el embudo de ventas."]})})]}),e.jsxs("div",{className:"mt-3",children:[e.jsx("label",{className:"form-label",children:"Condiciones Espec√≠ficas"}),e.jsx("textarea",{className:"form-control",rows:4,placeholder:"Las condiciones se auto-completan seg√∫n la variante seleccionada",value:y,onChange:a=>Y(a.target.value)})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"form-label",children:"√çtems de la Cotizaci√≥n"}),e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-bordered table-striped",children:[e.jsx("thead",{className:"table-dark",children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:"10%"},children:"C√≥digo"}),e.jsx("th",{style:{width:"35%"},children:"Descripci√≥n"}),e.jsx("th",{style:{width:"15%"},children:"Norma"}),e.jsx("th",{style:{width:"12%"},children:"Precio Unit."}),e.jsx("th",{style:{width:"10%"},children:"Cantidad"}),e.jsx("th",{style:{width:"12%"},children:"Parcial"}),e.jsx("th",{style:{width:"6%"}})]})}),e.jsx("tbody",{children:N.map((a,t)=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("input",{className:"form-control form-control-sm",value:a.code,onChange:o=>B(t,{code:o.target.value}),placeholder:"C√≥digo"})}),e.jsx("td",{children:e.jsx(Ca,{value:a.description,onChange:o=>B(t,{description:o}),onSelect:o=>{o&&B(t,{code:o.codigo,description:o.descripcion,norm:o.norma,unit_price:o.precio})},placeholder:"Buscar servicio...",size:"sm"})}),e.jsx("td",{children:e.jsx("input",{className:"form-control form-control-sm",value:a.norm,onChange:o=>B(t,{norm:o.target.value}),placeholder:"Norma"})}),e.jsx("td",{children:e.jsx("input",{type:"number",step:"0.01",className:"form-control form-control-sm",value:a.unit_price,onChange:o=>B(t,{unit_price:o.target.value}),placeholder:"0.00"})}),e.jsx("td",{children:e.jsx("input",{type:"number",className:"form-control form-control-sm",value:a.quantity,onChange:o=>B(t,{quantity:o.target.value}),min:"1"})}),e.jsx("td",{children:e.jsxs("span",{className:"fw-bold text-success",children:["S/ ",De(a).toFixed(2)]})}),e.jsx("td",{children:e.jsx("button",{type:"button",className:"btn btn-sm btn-outline-danger",onClick:()=>Ve(t),disabled:N.length===1,title:"Eliminar √≠tem",children:"üóëÔ∏è"})})]},t))})]})}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center mt-3",children:[e.jsx("button",{type:"button",className:"btn btn-outline-primary",onClick:$e,children:"‚ûï Agregar √≠tem"}),e.jsxs("div",{className:"text-end",children:[e.jsxs("div",{className:"h6 mb-1",children:["Subtotal: ",e.jsxs("span",{className:"text-primary",children:["S/ ",U.toFixed(2)]})]}),e.jsxs("div",{className:"h6 mb-1",children:["IGV 18%: ",e.jsxs("span",{className:"text-primary",children:["S/ ",ae.toFixed(2)]})]}),e.jsxs("div",{className:"h5 mb-0",children:["Total: ",e.jsxs("span",{className:"text-success fw-bold",children:["S/ ",ie.toFixed(2)]})]})]})]})]})]})]}),e.jsxs("div",{className:"intelligent-actions",children:[e.jsx("button",{type:"submit",className:"btn btn-success btn-lg",disabled:k||!s.company_name||!s.ruc,children:k?d?"üîÑ Actualizando...":"üíæ Guardando...":d?"üîÑ GUARDAR CAMBIOS":"üíæ CREAR COTIZACI√ìN"}),e.jsx("button",{type:"button",className:"btn btn-outline-warning btn-lg",onClick:Ke,disabled:!Z,children:"üìÑ Generar cotizaci√≥n"})]})]}),e.jsx(_a,{show:Te,onHide:()=>ye(!1),data:Le,buttonText:"Aceptar"}),e.jsx(Ea,{show:Re,onHide:()=>ve(!1),projectName:Fe,companyId:ke,onSelectExisting:He,onCreateNew:ea})]})}export{Ga as default};
//# sourceMappingURL=CotizacionInteligente-JI1YZ9Zc.js.map
