import{r as A,aa as de,j as e,ab as oe,ac as Xe,ad as Ye,ae as Ze,af as es,ag as ss,b as _,e as X,Q as W,B as w,n as V,$ as Ce,a2 as Ne,p as b,y as U,m as Ae,C as ve,o as H,S as O,N as as,l as B,s as M,x as ee,P as R,ah as k,ai as ye,aj as be,W as Se,w as ts,h as se,ak as Ee,a5 as ns,c as rs,H as is,L as le,f as ze,al as cs,J as fe}from"./index-D5j7Etbr.js";import{a as ls}from"./users-BLxU4hTQ.js";import{P as ds}from"./PageHeader-BAMnoJ00.js";import{a as l,R as T,C as g}from"./Row-BbCd5WYq.js";import{F as x,I as $}from"./InputGroup-CuAl69_P.js";import{M as I}from"./Modal-BtZGspVd.js";import{A as ae}from"./Alert-5CgP0oJh.js";import{P as K}from"./ProgressBar-rK63zS-N.js";import{S as te}from"./Spinner-DkvOZ9XA.js";import"./ElementChildren-BZ8oKQvH.js";const me=A.forwardRef(({bsPrefix:s,size:n,vertical:t=!1,className:r,role:N="group",as:p="div",...v},h)=>{const u=de(s,"btn-group");let j=u;return t&&(j=`${u}-vertical`),e.jsx(p,{...v,ref:h,role:N,className:oe(r,j,n&&`${u}-${n}`)})});me.displayName="ButtonGroup";const Fe=A.forwardRef(({bsPrefix:s,active:n,disabled:t,eventKey:r,className:N,variant:p,action:v,as:h,...u},j)=>{s=de(s,"list-group-item");const[d,i]=Xe({key:Ye(r,u.href),active:n,...u}),f=Ze(z=>{if(t){z.preventDefault(),z.stopPropagation();return}d.onClick(z)});t&&u.tabIndex===void 0&&(u.tabIndex=-1,u["aria-disabled"]=!0);const C=h||(v?u.href?"a":"button":"div");return e.jsx(C,{ref:j,...u,...d,onClick:f,className:oe(N,s,i.isActive&&"active",t&&"disabled",p&&`${s}-${p}`,v&&`${s}-action`)})});Fe.displayName="ListGroupItem";const ke=A.forwardRef((s,n)=>{const{className:t,bsPrefix:r,variant:N,horizontal:p,numbered:v,as:h="div",...u}=es(s,{activeKey:"onSelect"}),j=de(r,"list-group");let d;return p&&(d=p===!0?"horizontal":`horizontal-${p}`),e.jsx(ss,{ref:n,...u,as:h,className:oe(t,j,N&&`${j}-${N}`,d&&`${j}-${d}`,v&&`${j}-numbered`)})});ke.displayName="ListGroup";const D=Object.assign(ke,{Item:Fe}),_e=(s={})=>{const n=new URLSearchParams;s.page&&n.set("page",s.page),s.limit&&n.set("limit",s.limit),s.search&&n.set("search",s.search),s.action&&s.action!=="all"&&n.set("action",s.action),s.user&&s.user!=="all"&&n.set("user",s.user),s.date&&s.date!=="all"&&n.set("date",s.date),s.dateStart&&n.set("dateStart",s.dateStart),s.dateEnd&&n.set("dateEnd",s.dateEnd),s.timeStart&&n.set("timeStart",s.timeStart),s.timeEnd&&n.set("timeEnd",s.timeEnd);const t=n.toString(),r=t?`/api/audit?${t}`:"/api/audit";return _(r)},os=async(s,n)=>await _(`/api/audit/${s}`,{method:"PUT",body:JSON.stringify(n)}),ms=async s=>await _(`/api/audit/${s}`,{method:"DELETE"}),xs=async s=>await _("/api/audit/bulk-delete",{method:"POST",body:JSON.stringify({ids:s})}),hs=async s=>await _("/api/audit/archive",{method:"POST",body:JSON.stringify({ids:s})}),us=async(s={})=>{const n=new URLSearchParams;return Object.keys(s).forEach(r=>{s[r]&&s[r]!=="all"&&n.append(r,s[r])}),await _(`/api/audit/analytics?${n.toString()}`)},js=async()=>await _("/api/audit/active-users"),gs=async(s=24)=>await _("/api/audit/cleanup",{method:"POST",body:JSON.stringify({hours:s})}),ps=async()=>await _("/api/audit/cleanup-stats"),Ns=async(s=24)=>await _(`/api/audit/hourly-distribution?hours=${s}`),vs=()=>X(["audit-stats-global"],async()=>{try{const[s,n]=await Promise.all([us().catch(()=>null),js().catch(()=>null)]);if(s&&s.data)return{...s.data,activeUsers:(n==null?void 0:n.data)||[]};const t=await _e({page:1,limit:1e4}),r=Array.isArray(t==null?void 0:t.data)?t.data:(t==null?void 0:t.rows)||t||[],N=Number((t==null?void 0:t.total)||r.length||0),p=new Date;p.setHours(0,0,0,0);const v=r.filter(o=>new Date(o.performed_at||o.created_at)>=p).length,h=[...new Set(r.map(o=>o.user_name||o.performed_by||o.user_id))].length,u=[...new Set(r.map(o=>o.action))].length,j=r.reduce((o,F)=>(o[F.action]=(o[F.action]||0)+1,o),{}),d=Object.entries(j).reduce((o,F)=>j[o[0]]>j[F[0]]?o:F,["N/A",0]),i=new Date;i.setHours(i.getHours()-24);const f=r.filter(o=>new Date(o.performed_at||o.created_at)>=i).length,C=new Date;C.setDate(C.getDate()-7);const z=r.filter(o=>new Date(o.performed_at||o.created_at)>=C).length,m=(n==null?void 0:n.data)||[];return{total:N,todayActivities:v,uniqueUsers:h,uniqueActions:u,mostCommonAction:d[0],mostCommonCount:d[1],recentActivities:f,weekActivities:z,actionCounts:j,activeUsers:m}}catch(s){return console.error("Error obteniendo estadísticas:",s),{total:0,todayActivities:0,uniqueUsers:0,uniqueActions:0,mostCommonAction:"N/A",mostCommonCount:0,recentActivities:0,weekActivities:0,actionCounts:{},activeUsers:[]}}},{staleTime:0,cacheTime:1*60*1e3,refetchOnWindowFocus:!0,refetchOnMount:!0}),we=async(s={})=>{const n=new URLSearchParams;return Object.keys(s).forEach(r=>{s[r]&&s[r]!=="all"&&n.append(r,s[r])}),await _(`/api/audit/export/excel?${n.toString()}`,{method:"GET",responseType:"blob"})},ys=async(s={})=>{const n=new URLSearchParams;return Object.keys(s).forEach(r=>{s[r]&&s[r]!=="all"&&n.append(r,s[r])}),await _(`/api/audit/export/pdf?${n.toString()}`,{method:"GET",responseType:"blob"})},bs=async(s={})=>{const n=new URLSearchParams;return Object.keys(s).forEach(r=>{s[r]&&s[r]!=="all"&&n.append(r,s[r])}),await _(`/api/audit/export/csv?${n.toString()}`,{method:"GET",responseType:"blob"})},Z=(s,n)=>{const t=window.URL.createObjectURL(s),r=document.createElement("a");r.href=t,r.download=n,document.body.appendChild(r),r.click(),document.body.removeChild(r),window.URL.revokeObjectURL(t)};function fs({filters:s,onFiltersChange:n,onClearFilters:t,uniqueUsers:r=[],uniqueActions:N=[]}){const[p,v]=A.useState(!1),h=(i,f)=>{n({...s,[i]:f})},u=(i,f)=>{const C={...s};i==="start"?C.dateStart=f:i==="end"&&(C.dateEnd=f),n(C)},d=(()=>{let i=0;return s.search&&s.search!==""&&i++,s.action&&s.action!=="all"&&i++,s.user&&s.user!=="all"&&i++,s.dateStart&&i++,s.dateEnd&&i++,s.dateRange&&s.dateRange!=="all"&&i++,i})();return e.jsxs(l,{className:"mb-4",children:[e.jsxs(l.Header,{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("h6",{className:"mb-0",children:[e.jsx(W,{className:"me-2"}),"Filtros de Auditoría",d>0&&e.jsxs(b,{bg:"primary",className:"ms-2",children:[d," activos"]})]}),e.jsxs("div",{children:[e.jsxs(w,{variant:"outline-secondary",size:"sm",onClick:()=>v(!p),className:"me-2",children:[e.jsx(V,{className:"me-1"}),p?"Ocultar":"Avanzados"]}),d>0&&e.jsxs(w,{variant:"outline-danger",size:"sm",onClick:t,children:[e.jsx(U,{className:"me-1"}),"Limpiar"]})]})]}),e.jsxs(l.Body,{children:[e.jsxs(T,{className:"mb-3",children:[e.jsx(g,{md:4,children:e.jsxs(x.Group,{children:[e.jsx(x.Label,{children:"Buscar:"}),e.jsxs($,{children:[e.jsx($.Text,{children:e.jsx(Ce,{})}),e.jsx(x.Control,{type:"text",placeholder:"Buscar en auditoría...",value:s.search||"",onChange:i=>h("search",i.target.value)})]})]})}),e.jsx(g,{md:2,children:e.jsxs(x.Group,{children:[e.jsx(x.Label,{children:"Acción:"}),e.jsxs(x.Select,{value:s.action||"all",onChange:i=>h("action",i.target.value),children:[e.jsx("option",{value:"all",children:"Todas"}),N.map(i=>e.jsx("option",{value:i,children:i},i))]})]})}),e.jsx(g,{md:2,children:e.jsxs(x.Group,{children:[e.jsx(x.Label,{children:"Usuario:"}),e.jsxs(x.Select,{value:s.user||"all",onChange:i=>h("user",i.target.value),children:[e.jsx("option",{value:"all",children:"Todos"}),r.map(i=>e.jsx("option",{value:i,children:i},i))]})]})}),e.jsx(g,{md:2,children:e.jsxs(x.Group,{children:[e.jsx(x.Label,{children:"Rango de Fecha:"}),e.jsxs(x.Select,{value:s.dateRange||"all",onChange:i=>h("dateRange",i.target.value),children:[e.jsx("option",{value:"all",children:"Todas"}),e.jsx("option",{value:"today",children:"Hoy"}),e.jsx("option",{value:"yesterday",children:"Ayer"}),e.jsx("option",{value:"week",children:"Esta semana"}),e.jsx("option",{value:"month",children:"Este mes"}),e.jsx("option",{value:"quarter",children:"Este trimestre"}),e.jsx("option",{value:"year",children:"Este año"}),e.jsx("option",{value:"custom",children:"Personalizado"})]})]})}),e.jsx(g,{md:2,className:"d-flex align-items-end",children:e.jsx(me,{className:"w-100",children:e.jsxs(w,{variant:"outline-primary",onClick:()=>v(!p),children:[e.jsx(W,{className:"me-1"}),p?"Menos":"Más"]})})})]}),p&&e.jsxs(T,{className:"border-top pt-3",children:[e.jsx(g,{md:3,children:e.jsxs(x.Group,{children:[e.jsx(x.Label,{children:"Fecha Inicio:"}),e.jsxs($,{children:[e.jsx($.Text,{children:e.jsx(Ne,{})}),e.jsx(x.Control,{type:"date",value:s.dateStart||"",onChange:i=>u("start",i.target.value)})]})]})}),e.jsx(g,{md:3,children:e.jsxs(x.Group,{children:[e.jsx(x.Label,{children:"Fecha Fin:"}),e.jsxs($,{children:[e.jsx($.Text,{children:e.jsx(Ne,{})}),e.jsx(x.Control,{type:"date",value:s.dateEnd||"",onChange:i=>u("end",i.target.value)})]})]})}),e.jsx(g,{md:2,children:e.jsxs(x.Group,{children:[e.jsx(x.Label,{children:"Hora Inicio:"}),e.jsx(x.Control,{type:"time",value:s.timeStart||"",onChange:i=>h("timeStart",i.target.value)})]})}),e.jsx(g,{md:2,children:e.jsxs(x.Group,{children:[e.jsx(x.Label,{children:"Hora Fin:"}),e.jsx(x.Control,{type:"time",value:s.timeEnd||"",onChange:i=>h("timeEnd",i.target.value)})]})}),e.jsx(g,{md:2,className:"d-flex align-items-end",children:e.jsxs(w,{variant:"outline-success",className:"w-100",onClick:()=>{console.log("Aplicando filtros personalizados...")},children:[e.jsx(W,{className:"me-1"}),"Aplicar"]})})]}),d>0&&e.jsx(T,{className:"mt-3",children:e.jsx(g,{children:e.jsxs("div",{className:"d-flex flex-wrap gap-2",children:[e.jsx("small",{className:"text-muted me-2",children:"Filtros activos:"}),s.search&&e.jsxs(b,{bg:"info",className:"d-flex align-items-center",children:["Búsqueda: ",s.search,e.jsx(U,{className:"ms-1",style:{cursor:"pointer"},onClick:()=>h("search","")})]}),s.action&&s.action!=="all"&&e.jsxs(b,{bg:"primary",className:"d-flex align-items-center",children:["Acción: ",s.action,e.jsx(U,{className:"ms-1",style:{cursor:"pointer"},onClick:()=>h("action","all")})]}),s.user&&s.user!=="all"&&e.jsxs(b,{bg:"success",className:"d-flex align-items-center",children:["Usuario: ",s.user,e.jsx(U,{className:"ms-1",style:{cursor:"pointer"},onClick:()=>h("user","all")})]}),s.dateStart&&e.jsxs(b,{bg:"warning",className:"d-flex align-items-center",children:["Desde: ",s.dateStart,e.jsx(U,{className:"ms-1",style:{cursor:"pointer"},onClick:()=>h("dateStart","")})]}),s.dateEnd&&e.jsxs(b,{bg:"warning",className:"d-flex align-items-center",children:["Hasta: ",s.dateEnd,e.jsx(U,{className:"ms-1",style:{cursor:"pointer"},onClick:()=>h("dateEnd","")})]})]})})})]})]})}function ws({show:s,onHide:n,auditRecord:t,onExport:r,onEdit:N,onDelete:p}){if(!t)return null;const v=d=>d?new Date(d).toLocaleString("es-ES",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"}):"—",h=d=>{switch(d){case"crear":case"create":return e.jsx(ee,{className:"text-success"});case"actualizar":case"update":return e.jsx(ee,{className:"text-primary"});case"eliminar":case"delete":return e.jsx(R,{className:"text-danger"});case"login":return e.jsx(H,{className:"text-info"});case"logout":return e.jsx(H,{className:"text-secondary"});case"actualizar_estado":return e.jsx(B,{className:"text-warning"});case"actualizar_categorias":return e.jsx(B,{className:"text-info"});default:return e.jsx(B,{className:"text-muted"})}},u=d=>{switch(d){case"crear":case"create":return"success";case"actualizar":case"update":return"primary";case"eliminar":case"delete":return"danger";case"login":return"info";case"logout":return"secondary";case"actualizar_estado":return"warning";case"actualizar_categorias":return"info";default:return"dark"}},j=d=>({crear:"creó",create:"creó",actualizar:"actualizó",update:"actualizó",eliminar:"eliminó",delete:"eliminó",login:"inició sesión",logout:"cerró sesión",actualizar_estado:"actualizó el estado",actualizar_categorias:"actualizó las categorías",marcar_proyecto:"marcó el proyecto",exportar:"exportó",importar:"importó",configurar:"configuró",asignar:"asignó",desasignar:"desasignó"})[d]||d;return e.jsxs(I,{show:s,onHide:n,size:"lg",centered:!0,children:[e.jsx(I.Header,{closeButton:!0,children:e.jsxs(I.Title,{children:[e.jsx(Ae,{className:"me-2"}),"Detalles de Auditoría"]})}),e.jsxs(I.Body,{children:[e.jsxs(T,{children:[e.jsx(g,{md:8,children:e.jsxs(l,{className:"mb-3",children:[e.jsx(l.Header,{children:e.jsxs("h6",{className:"mb-0",children:[e.jsx(ve,{className:"me-2"}),"Información del Registro"]})}),e.jsx(l.Body,{children:e.jsxs(T,{children:[e.jsxs(g,{md:6,children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"ID del Registro:"}),e.jsxs("div",{className:"text-muted",children:["#",t.id]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"Acción Realizada:"}),e.jsxs("div",{className:"d-flex align-items-center mt-1",children:[h(t.action),e.jsx(b,{bg:u(t.action),className:"ms-2",children:j(t.action)})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"Usuario:"}),e.jsxs("div",{className:"d-flex align-items-center mt-1",children:[e.jsx(H,{className:"me-2 text-muted"}),e.jsx("span",{children:t.user_name||t.performed_by||t.user_id||"Sistema"})]})]})]}),e.jsxs(g,{md:6,children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"Fecha y Hora:"}),e.jsxs("div",{className:"d-flex align-items-center mt-1",children:[e.jsx(O,{className:"me-2 text-muted"}),e.jsx("span",{children:v(t.performed_at||t.created_at)})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"IP del Usuario:"}),e.jsx("div",{className:"text-muted",children:t.ip_address||"No disponible"})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"User Agent:"}),e.jsx("div",{className:"text-muted small",children:t.user_agent||"No disponible"})]})]})]})})]})}),e.jsx(g,{md:4,children:e.jsxs(l,{className:"mb-3",children:[e.jsx(l.Header,{children:e.jsxs("h6",{className:"mb-0",children:[e.jsx(as,{className:"me-2"}),"Contexto"]})}),e.jsx(l.Body,{children:e.jsxs(D,{variant:"flush",children:[e.jsxs(D.Item,{className:"d-flex justify-content-between",children:[e.jsx("span",{children:"Módulo:"}),e.jsx(b,{bg:"info",children:t.module||"Sistema"})]}),e.jsxs(D.Item,{className:"d-flex justify-content-between",children:[e.jsx("span",{children:"Entidad:"}),e.jsx(b,{bg:"secondary",children:t.entity||"N/A"})]}),e.jsxs(D.Item,{className:"d-flex justify-content-between",children:[e.jsx("span",{children:"ID Entidad:"}),e.jsx(b,{bg:"light",text:"dark",children:t.entity_id||"N/A"})]}),e.jsxs(D.Item,{className:"d-flex justify-content-between",children:[e.jsx("span",{children:"Estado:"}),e.jsx(b,{bg:"success",children:"Completado"})]})]})})]})})]}),e.jsxs(l,{children:[e.jsx(l.Header,{children:e.jsxs("h6",{className:"mb-0",children:[e.jsx(B,{className:"me-2"}),"Detalles Adicionales"]})}),e.jsxs(l.Body,{children:[t.notes?e.jsxs("div",{children:[e.jsx("strong",{children:"Notas:"}),e.jsx("div",{className:"mt-2 p-3 bg-light rounded",children:t.notes})]}):e.jsxs(ae,{variant:"info",className:"mb-0",children:[e.jsx(ve,{className:"me-2"}),"No hay notas adicionales para este registro."]}),t.changes&&e.jsxs("div",{className:"mt-3",children:[e.jsx("strong",{children:"Cambios Realizados:"}),e.jsx("div",{className:"mt-2",children:e.jsx("pre",{className:"bg-light p-3 rounded small",children:JSON.stringify(t.changes,null,2)})})]})]})]})]}),e.jsxs(I.Footer,{children:[e.jsxs(w,{variant:"outline-secondary",onClick:n,children:[e.jsx(U,{className:"me-1"}),"Cerrar"]}),e.jsxs(w,{variant:"outline-primary",onClick:()=>r&&r(t),children:[e.jsx(M,{className:"me-1"}),"Exportar"]}),N&&e.jsxs(w,{variant:"outline-warning",onClick:()=>N(t),children:[e.jsx(ee,{className:"me-1"}),"Editar"]}),p&&e.jsxs(w,{variant:"outline-danger",onClick:()=>p(t),children:[e.jsx(R,{className:"me-1"}),"Eliminar"]})]})]})}function Cs({selectedItems:s=[],onBulkExport:n,onBulkDelete:t,onBulkArchive:r,onClearSelection:N}){const[p,v]=A.useState(!1),[h,u]=A.useState(null),[j,d]=A.useState(!1),[i,f]=A.useState(0),C=s.length,z=async S=>{C!==0&&(u(S),v(!0))},m=async()=>{if(h){d(!0),f(0);try{const S=setInterval(()=>{f(L=>L>=100?(clearInterval(S),d(!1),v(!1),u(null),100):L+10)},200);switch(h){case"export":await(n==null?void 0:n(s));break;case"delete":await(t==null?void 0:t(s));break;case"archive":await(r==null?void 0:r(s));break}N==null||N()}catch(S){console.error("Error en acción masiva:",S),d(!1)}}},o=S=>{switch(S){case"export":return"Exportar Registros Seleccionados";case"delete":return"Eliminar Registros Seleccionados";case"archive":return"Archivar Registros Seleccionados";default:return"Acción Masiva"}},F=S=>{switch(S){case"export":return`Se exportarán ${C} registros de auditoría en formato Excel.`;case"delete":return`Se eliminarán permanentemente ${C} registros de auditoría. Esta acción no se puede deshacer.`;case"archive":return`Se archivarán ${C} registros de auditoría. Los registros archivados no aparecerán en las búsquedas normales.`;default:return""}},ne=S=>{switch(S){case"export":return e.jsx(M,{className:"text-success"});case"delete":return e.jsx(R,{className:"text-danger"});case"archive":return e.jsx(be,{className:"text-warning"});default:return e.jsx(ye,{})}};return C===0?null:e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"d-flex align-items-center gap-2 mb-3",children:[e.jsxs(b,{bg:"primary",className:"fs-6",children:[C," seleccionado",C!==1?"s":""]}),e.jsxs(k,{children:[e.jsxs(k.Toggle,{variant:"outline-primary",size:"sm",children:[e.jsx(ye,{className:"me-1"}),"Acciones Masivas"]}),e.jsxs(k.Menu,{children:[e.jsxs(k.Item,{onClick:()=>z("export"),children:[e.jsx(M,{className:"me-2"}),"Exportar Seleccionados"]}),e.jsxs(k.Item,{onClick:()=>z("archive"),children:[e.jsx(be,{className:"me-2"}),"Archivar Seleccionados"]}),e.jsx(k.Divider,{}),e.jsxs(k.Item,{onClick:()=>z("delete"),className:"text-danger",children:[e.jsx(R,{className:"me-2"}),"Eliminar Seleccionados"]})]})]}),e.jsxs(w,{variant:"outline-secondary",size:"sm",onClick:N,children:[e.jsx(U,{className:"me-1"}),"Limpiar Selección"]})]}),e.jsxs(I,{show:p,onHide:()=>v(!1),centered:!0,children:[e.jsx(I.Header,{closeButton:!0,children:e.jsxs(I.Title,{children:[ne(h),e.jsx("span",{className:"ms-2",children:o(h)})]})}),e.jsxs(I.Body,{children:[e.jsxs(ae,{variant:"info",className:"mb-3",children:[e.jsx(Se,{className:"me-2"}),F(h)]}),j&&e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"d-flex justify-content-between mb-2",children:[e.jsx("span",{children:"Procesando..."}),e.jsxs("span",{children:[i,"%"]})]}),e.jsx(K,{now:i,animated:!0})]}),e.jsxs("div",{className:"text-muted small",children:[e.jsx("strong",{children:"Registros seleccionados:"}),e.jsxs("ul",{className:"mt-2 mb-0",children:[s.slice(0,5).map((S,L)=>e.jsxs("li",{children:["#",S.id," - ",S.action," - ",S.user_name||S.user_id]},L)),s.length>5&&e.jsxs("li",{children:["... y ",s.length-5," más"]})]})]})]}),e.jsxs(I.Footer,{children:[e.jsxs(w,{variant:"outline-secondary",onClick:()=>v(!1),disabled:j,children:[e.jsx(U,{className:"me-1"}),"Cancelar"]}),e.jsx(w,{variant:h==="delete"?"danger":"primary",onClick:m,disabled:j,children:j?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"spinner-border spinner-border-sm me-1",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Procesando..."})}),"Procesando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ts,{className:"me-1"}),"Confirmar"]})})]})]})]})}function As({analyticsData:s={},isLoading:n=!1}){const{total:t=0,todayActivities:r=0,weekActivities:N=0,uniqueUsers:p=0,uniqueActions:v=0,recentActivities:h=0,actionCounts:u={},activeUsers:j=[]}=s,{data:d,isLoading:i}=X(["audit-hourly-distribution"],()=>Ns(24),{staleTime:5*60*1e3,cacheTime:10*60*1e3}),f=Object.entries(u).map(([m,o])=>({name:m,count:o})).sort((m,o)=>o.count-m.count).slice(0,5),C=j.map(m=>({name:m.name||m.user_name||m.username||`Usuario ${m.id}`,actions:m.action_count||0})).sort((m,o)=>o.actions-m.actions).slice(0,5),z=(d==null?void 0:d.data)||Array.from({length:24},(m,o)=>({hour:o,count:0}));return n?e.jsx(T,{children:[1,2,3,4].map(m=>e.jsx(g,{md:3,className:"mb-3",children:e.jsx(l,{children:e.jsx(l.Body,{className:"text-center",children:e.jsx("div",{className:"spinner-border spinner-border-sm text-primary",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Cargando..."})})})})},m))}):e.jsxs("div",{children:[e.jsxs(T,{className:"mb-4",children:[e.jsx(g,{md:3,children:e.jsx(l,{className:"text-center border-primary",children:e.jsxs(l.Body,{children:[e.jsx(B,{className:"text-primary mb-2",size:24}),e.jsx("h5",{className:"mb-1",children:t.toLocaleString()}),e.jsx("small",{className:"text-muted",children:"Total de Acciones"}),e.jsx("div",{className:"mt-2",children:e.jsxs(b,{bg:"info",className:"fs-6",children:[r," hoy"]})})]})})}),e.jsx(g,{md:3,children:e.jsx(l,{className:"text-center border-success",children:e.jsxs(l.Body,{children:[e.jsx(se,{className:"text-success mb-2",size:24}),e.jsx("h5",{className:"mb-1",children:p}),e.jsx("small",{className:"text-muted",children:"Usuarios Activos"}),e.jsx("div",{className:"mt-2",children:e.jsx(b,{bg:"success",className:"fs-6",children:"Únicos"})})]})})}),e.jsx(g,{md:3,children:e.jsx(l,{className:"text-center border-info",children:e.jsxs(l.Body,{children:[e.jsx(Ee,{className:"text-info mb-2",size:24}),e.jsx("h5",{className:"mb-1",children:N}),e.jsx("small",{className:"text-muted",children:"Esta Semana"}),e.jsx("div",{className:"mt-2",children:e.jsxs(b,{bg:"info",className:"fs-6",children:["+",Math.round(N/7*100)/100,"/día"]})})]})})}),e.jsx(g,{md:3,children:e.jsx(l,{className:"text-center border-warning",children:e.jsxs(l.Body,{children:[e.jsx(O,{className:"text-warning mb-2",size:24}),e.jsx("h5",{className:"mb-1",children:h}),e.jsx("small",{className:"text-muted",children:"Últimas 24h"}),e.jsx("div",{className:"mt-2",children:e.jsx(b,{bg:"warning",className:"fs-6",children:"Activo"})})]})})})]}),e.jsxs(T,{children:[e.jsx(g,{md:6,className:"mb-4",children:e.jsxs(l,{children:[e.jsx(l.Header,{children:e.jsxs("h6",{className:"mb-0",children:[e.jsx(ns,{className:"me-2"}),"Acciones Más Frecuentes"]})}),e.jsx(l.Body,{children:f.length>0?e.jsx(D,{variant:"flush",children:f.map((m,o)=>e.jsxs(D.Item,{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx(b,{bg:"primary",className:"me-2",children:o+1}),e.jsx("span",{className:"fw-medium",children:m.name})]}),e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"me-3",children:e.jsx(K,{now:m.count/f[0].count*100,style:{width:"100px",height:"8px"},variant:"primary"})}),e.jsx(b,{bg:"secondary",children:m.count})]})]},o))}):e.jsxs("div",{className:"text-center text-muted py-3",children:[e.jsx(B,{size:32,className:"mb-2"}),e.jsx("p",{className:"mb-0",children:"No hay datos de acciones disponibles"})]})})]})}),e.jsx(g,{md:6,className:"mb-4",children:e.jsxs(l,{children:[e.jsx(l.Header,{children:e.jsxs("h6",{className:"mb-0",children:[e.jsx(se,{className:"me-2"}),"Actividad por Usuario"]})}),e.jsx(l.Body,{children:C.length>0?e.jsx(D,{variant:"flush",children:C.map((m,o)=>e.jsxs(D.Item,{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx(b,{bg:"success",className:"me-2",children:o+1}),e.jsx("span",{className:"fw-medium",children:m.name})]}),e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"me-3",children:e.jsx(K,{now:m.actions/C[0].actions*100,style:{width:"100px",height:"8px"},variant:"success"})}),e.jsx(b,{bg:"secondary",children:m.actions})]})]},o))}):e.jsxs("div",{className:"text-center text-muted py-3",children:[e.jsx(se,{size:32,className:"mb-2"}),e.jsx("p",{className:"mb-0",children:"No hay datos de usuarios disponibles"})]})})]})})]}),e.jsx(T,{children:e.jsx(g,{md:12,children:e.jsxs(l,{children:[e.jsx(l.Header,{children:e.jsxs("h6",{className:"mb-0",children:[e.jsx(O,{className:"me-2"}),"Distribución de Actividad por Hora (Datos Reales)",i&&e.jsx(te,{animation:"border",size:"sm",className:"ms-2"})]})}),e.jsx(l.Body,{children:i?e.jsxs("div",{className:"text-center py-4",children:[e.jsx(te,{animation:"border",variant:"primary"}),e.jsx("p",{className:"mt-2 text-muted",children:"Cargando distribución horaria..."})]}):z.length>0?e.jsx("div",{className:"row",children:z.map((m,o)=>e.jsx("div",{className:"col-md-2 mb-3",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"fw-medium",children:[m.hour,":00"]}),e.jsx("div",{className:"mt-2",children:e.jsx(K,{now:m.count/Math.max(...z.map(F=>F.count),1)*100,variant:"info",style:{height:"20px"}})}),e.jsx("div",{className:"text-muted small mt-1",children:m.count})]})},o))}):e.jsxs("div",{className:"text-center text-muted py-3",children:[e.jsx(O,{size:32,className:"mb-2"}),e.jsx("p",{className:"mb-0",children:"No hay datos de distribución horaria disponibles"})]})})]})})})]})}function Ss(){const[s,n]=A.useState(!1),[t,r]=A.useState(0),N=rs(),{data:p,isLoading:v}=X(["cleanup-stats"],ps,{refetchInterval:3e4,staleTime:0}),h=is(gs,{onSuccess:()=>{N.invalidateQueries(["audit"]),N.invalidateQueries(["audit-stats-global"]),n(!1),r(0)},onError:d=>{console.error("Error en limpieza:",d),n(!1),r(0)}}),u=async(d=24)=>{n(!0),r(0);const i=setInterval(()=>{r(f=>f>=100?(clearInterval(i),100):f+10)},200);try{await h.mutateAsync(d)}catch(f){console.error("Error en limpieza:",f)}},j=(p==null?void 0:p.data)||{};return e.jsxs(l,{className:"mb-4",children:[e.jsx(l.Header,{children:e.jsxs("h6",{className:"mb-0",children:[e.jsx(R,{className:"me-2"}),"Limpieza Automática de Registros"]})}),e.jsxs(l.Body,{children:[e.jsxs(T,{children:[e.jsx(g,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx("h6",{children:"Estado del Sistema"}),v?e.jsx("div",{className:"text-center",children:e.jsx("div",{className:"spinner-border spinner-border-sm text-primary",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Cargando..."})})}):e.jsxs("div",{children:[e.jsxs("div",{className:"d-flex justify-content-between mb-2",children:[e.jsx("span",{children:"Registros antiguos (>24h):"}),e.jsx(b,{bg:"warning",children:j.oldRecords||0})]}),e.jsxs("div",{className:"d-flex justify-content-between mb-2",children:[e.jsx("span",{children:"Registros totales:"}),e.jsx(b,{bg:"info",children:j.totalRecords||0})]}),e.jsxs("div",{className:"d-flex justify-content-between mb-2",children:[e.jsx("span",{children:"Última limpieza:"}),e.jsx(b,{bg:"secondary",children:j.lastCleanup?new Date(j.lastCleanup).toLocaleString():"Nunca"})]})]})]})}),e.jsx(g,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx("h6",{children:"Acciones de Limpieza"}),e.jsxs("div",{className:"d-grid gap-2",children:[e.jsx(w,{variant:"outline-danger",size:"sm",onClick:()=>u(24),disabled:s,children:s?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"spinner-border spinner-border-sm me-1",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Limpiando..."})}),"Limpiando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(R,{className:"me-1"}),"Limpiar registros >24h"]})}),e.jsxs(w,{variant:"outline-warning",size:"sm",onClick:()=>u(168),disabled:s,children:[e.jsx(O,{className:"me-1"}),"Limpiar registros >7 días"]}),e.jsxs(w,{variant:"outline-info",size:"sm",onClick:()=>u(720),disabled:s,children:[e.jsx(O,{className:"me-1"}),"Limpiar registros >30 días"]})]})]})})]}),s&&e.jsxs(ae,{variant:"info",className:"mt-3",children:[e.jsxs("div",{className:"d-flex align-items-center mb-2",children:[e.jsx(le,{className:"me-2"}),e.jsx("strong",{children:"Limpiando registros antiguos..."})]}),e.jsx(K,{now:t,animated:!0}),e.jsxs("small",{className:"text-muted mt-1",children:[t,"% completado"]})]}),e.jsxs(ae,{variant:"warning",className:"mt-3",children:[e.jsx(Se,{className:"me-2"}),e.jsx("strong",{children:"Nota:"})," La limpieza automática elimina permanentemente los registros antiguos. Esta acción no se puede deshacer. Se recomienda hacer una copia de seguridad antes de proceder."]}),e.jsx("div",{className:"mt-3",children:e.jsxs("small",{className:"text-muted",children:[e.jsx(ze,{className:"me-1"}),"La limpieza automática se ejecuta cada 24 horas para mantener el sistema optimizado."]})})]})]})}function Us(){const[s,n]=A.useState(1),[t,r]=A.useState(20),[N,p]=A.useState(""),[v,h]=A.useState("all"),[u,j]=A.useState("all"),[d,i]=A.useState("all"),[f,C]=A.useState(!1),[z,m]=A.useState([]),[o,F]=A.useState(!1),[ne,S]=A.useState(null),[L,xe]=A.useState({search:"",action:"all",user:"all",dateRange:"all",dateStart:"",dateEnd:"",timeStart:"",timeEnd:""}),{data:E,isLoading:re,refetch:q,isFetching:he}=X(["audit",{page:s,limit:t,searchQuery:N,actionFilter:v,userFilter:u,dateFilter:d,filters:L}],async()=>{const a={page:s,limit:t,search:N,action:v!=="all"?v:void 0,user:u!=="all"?u:void 0,date:d!=="all"?d:void 0,dateStart:L.dateStart,dateEnd:L.dateEnd,timeStart:L.timeStart,timeEnd:L.timeEnd};Object.keys(a).forEach(ce=>{(a[ce]===void 0||a[ce]==="")&&delete a[ce]});const c=await _e(a),y=Array.isArray(c==null?void 0:c.data)?c.data:(c==null?void 0:c.rows)||c||[],ie=Number((c==null?void 0:c.total)||y.length||0);return{rows:y,total:ie}},{keepPreviousData:!0,refetchOnWindowFocus:!0,refetchOnMount:!0}),{data:ue}=X(["users-for-audit"],ls,{staleTime:5*60*1e3,cacheTime:10*60*1e3}),{data:P}=vs(),Le=a=>{switch(a){case"crear":case"create":return e.jsx(fe,{className:"text-success"});case"actualizar":case"update":return e.jsx(ee,{className:"text-primary"});case"eliminar":case"delete":return e.jsx(R,{className:"text-danger"});case"login":return e.jsx(H,{className:"text-info"});case"logout":return e.jsx(H,{className:"text-secondary"});case"actualizar_estado":return e.jsx(V,{className:"text-warning"});case"actualizar_categorias":return e.jsx(V,{className:"text-info"});case"marcar_proyecto":return e.jsx(ze,{className:"text-primary"});case"exportar":return e.jsx(M,{className:"text-success"});case"importar":return e.jsx(fe,{className:"text-info"});case"configurar":return e.jsx(V,{className:"text-warning"});case"asignar":return e.jsx(H,{className:"text-primary"});case"desasignar":return e.jsx(cs,{className:"text-secondary"});default:return e.jsx(B,{className:"text-muted"})}},Te=a=>({crear:"creó",create:"creó",actualizar:"actualizó",update:"actualizó",eliminar:"eliminó",delete:"eliminó",login:"inició sesión",logout:"cerró sesión",actualizar_estado:"actualizó el estado",actualizar_categorias:"actualizó las categorías",marcar_proyecto:"marcó el proyecto",exportar:"exportó",importar:"importó",configurar:"configuró",asignar:"asignó",desasignar:"desasignó"})[a]||a,Pe=a=>{if(a.user_name&&a.user_name!==a.user_id)return a.user_name;if(a.performed_by)return a.performed_by;if(a.user_id&&ue){const c=ue.find(y=>y.id===a.user_id);if(c)return c.name||c.full_name||c.username||`Usuario ${a.user_id}`}return a.user_id&&typeof a.user_id=="number"?{1:"Administrador",2:"Jefe de Laboratorio",3:"Jefa Comercial",4:"Gerencia",5:"Sistemas",6:"Admin",7:"Usuario",8:"Operador"}[a.user_id]||`Usuario ${a.user_id}`:"Sistema"},Be=a=>{switch(a){case"crear":case"create":return"success";case"actualizar":case"update":return"primary";case"eliminar":case"delete":return"danger";case"login":return"info";case"logout":return"dark";case"actualizar_estado":return"warning";case"actualizar_categorias":return"info";case"marcar_proyecto":return"primary";case"exportar":return"success";case"importar":return"info";case"configurar":return"warning";case"asignar":return"primary";case"desasignar":return"secondary";default:return"dark"}},Ie=a=>a?new Date(a).toLocaleString("es-ES",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}):"—",je=A.useMemo(()=>{var c;return[...new Set(((c=E==null?void 0:E.rows)==null?void 0:c.map(y=>y.action))||[])].sort()},[E==null?void 0:E.rows]),ge=A.useMemo(()=>{var c;return[...new Set(((c=E==null?void 0:E.rows)==null?void 0:c.map(y=>y.user_name||y.performed_by||y.user_id))||[])].sort()},[E==null?void 0:E.rows]),J=(E==null?void 0:E.total)||0,G=(E==null?void 0:E.rows)||[],Y=Math.max(1,Math.ceil(J/t)),Ue=(P==null?void 0:P.total)||0,Me=(P==null?void 0:P.uniqueUsers)||0,De=(P==null?void 0:P.uniqueActions)||0,pe=()=>{p(""),h("all"),j("all"),i("all")},$e=()=>{q()},Oe=a=>{xe(a),p(a.search||""),h(a.action||"all"),j(a.user||"all"),i(a.dateRange||"all")},He=()=>{xe({search:"",action:"all",user:"all",dateRange:"all",dateStart:"",dateEnd:"",timeStart:"",timeEnd:""}),p(""),h("all"),j("all"),i("all")},Q=async(a="excel")=>{try{let c;const y={search:N,action:v,user:u,date:d,...L};switch(a){case"excel":c=await we(y),Z(c,`auditoria_${new Date().toISOString().split("T")[0]}.xlsx`);break;case"pdf":c=await ys(y),Z(c,`auditoria_${new Date().toISOString().split("T")[0]}.pdf`);break;case"csv":c=await bs(y),Z(c,`auditoria_${new Date().toISOString().split("T")[0]}.csv`);break}}catch(c){console.error("Error al exportar:",c)}},Re=a=>{S(a),F(!0)},qe=(a,c)=>{m(c?y=>[...y,a]:y=>y.filter(ie=>ie.id!==a.id))},Ge=a=>{m(a?G:[])},Je=async a=>{try{const c=await we({selectedIds:a.map(y=>y.id)});Z(c,`auditoria_seleccionados_${new Date().toISOString().split("T")[0]}.xlsx`)}catch(c){console.error("Error en exportación masiva:",c)}},Qe=async a=>{if(window.confirm(`¿Estás seguro de eliminar ${a.length} registros? Esta acción no se puede deshacer.`))try{const c=a.map(y=>y.id);await xs(c),q(),m([])}catch(c){console.error("Error eliminando elementos:",c)}},Ve=async a=>{try{const c=a.map(y=>y.id);await hs(c),q(),m([])}catch(c){console.error("Error archivando elementos:",c)}},We=async(a,c)=>{try{await os(a.id,c),q(),F(!1)}catch(y){console.error("Error editando registro:",y)}},Ke=async a=>{if(window.confirm(`¿Estás seguro de eliminar el registro #${a.id}?`))try{await ms(a.id),q(),F(!1)}catch(c){console.error("Error eliminando registro:",c)}};return e.jsxs("div",{className:"fade-in",children:[e.jsx(ds,{title:"Auditoría del Sistema",subtitle:"Registro completo de actividades y acciones del sistema",icon:B,actions:e.jsxs("div",{className:"d-flex gap-2",children:[e.jsxs(k,{children:[e.jsxs(k.Toggle,{variant:"outline-success",size:"sm",children:[e.jsx(M,{className:"me-1"}),"Exportar"]}),e.jsxs(k.Menu,{children:[e.jsxs(k.Item,{onClick:()=>Q("excel"),children:[e.jsx(M,{className:"me-2"}),"Excel (.xlsx)"]}),e.jsxs(k.Item,{onClick:()=>Q("pdf"),children:[e.jsx(M,{className:"me-2"}),"PDF"]}),e.jsxs(k.Item,{onClick:()=>Q("csv"),children:[e.jsx(M,{className:"me-2"}),"CSV"]})]})]}),e.jsxs(w,{variant:"outline-info",size:"sm",onClick:()=>C(!f),children:[e.jsx(Ee,{className:"me-1"}),f?"Ocultar":"Analytics"]}),e.jsx(w,{variant:"outline-primary",onClick:$e,disabled:he,children:he?e.jsxs(e.Fragment,{children:[e.jsx(te,{animation:"border",size:"sm",className:"me-1"}),"Actualizando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(le,{className:"me-1"}),"Actualizar"]})})]})}),f&&e.jsx("div",{className:"mb-4",children:e.jsx(As,{analyticsData:P,isLoading:!P})}),e.jsx(Ss,{}),e.jsx(fs,{filters:L,onFiltersChange:Oe,onClearFilters:He,uniqueUsers:ge,uniqueActions:je}),e.jsx(Cs,{selectedItems:z,onBulkExport:Je,onBulkDelete:Qe,onBulkArchive:Ve,onClearSelection:()=>m([])}),e.jsxs(T,{className:"mb-4",children:[e.jsx(g,{md:3,children:e.jsx(l,{className:"text-center border-primary",children:e.jsxs(l.Body,{children:[e.jsx(B,{className:"text-primary mb-2",size:24}),e.jsx("h5",{className:"mb-1",children:Ue}),e.jsx("small",{className:"text-muted",children:"Total de Acciones"})]})})}),e.jsx(g,{md:3,children:e.jsx(l,{className:"text-center border-success",children:e.jsxs(l.Body,{children:[e.jsx(se,{className:"text-success mb-2",size:24}),e.jsx("h5",{className:"mb-1",children:Me}),e.jsx("small",{className:"text-muted",children:"Usuarios Activos"})]})})}),e.jsx(g,{md:3,children:e.jsx(l,{className:"text-center border-info",children:e.jsxs(l.Body,{children:[e.jsx(V,{className:"text-info mb-2",size:24}),e.jsx("h5",{className:"mb-1",children:De}),e.jsx("small",{className:"text-muted",children:"Tipos de Acciones"})]})})}),e.jsx(g,{md:3,children:e.jsx(l,{className:"text-center border-warning",children:e.jsxs(l.Body,{children:[e.jsx(O,{className:"text-warning mb-2",size:24}),e.jsx("h5",{className:"mb-1",children:Math.ceil(J/t)}),e.jsx("small",{className:"text-muted",children:"Páginas"})]})})})]}),e.jsxs(l,{className:"mb-4",children:[e.jsx(l.Header,{children:e.jsxs("h6",{className:"mb-0",children:[e.jsx(W,{className:"me-2"}),"Filtros y Búsqueda"]})}),e.jsx(l.Body,{children:e.jsxs(T,{children:[e.jsx(g,{md:4,children:e.jsxs(x.Group,{children:[e.jsx(x.Label,{children:"Buscar en auditoría:"}),e.jsxs($,{children:[e.jsx($.Text,{children:e.jsx(Ce,{})}),e.jsx(x.Control,{type:"text",placeholder:"Buscar por acción, usuario, notas...",value:N,onChange:a=>p(a.target.value)})]})]})}),e.jsx(g,{md:2,children:e.jsxs(x.Group,{children:[e.jsx(x.Label,{children:"Tipo de acción:"}),e.jsxs(x.Select,{value:v,onChange:a=>h(a.target.value),children:[e.jsx("option",{value:"all",children:"Todas las acciones"}),je.map(a=>e.jsx("option",{value:a,children:a},a))]})]})}),e.jsx(g,{md:2,children:e.jsxs(x.Group,{children:[e.jsx(x.Label,{children:"Usuario:"}),e.jsxs(x.Select,{value:u,onChange:a=>j(a.target.value),children:[e.jsx("option",{value:"all",children:"Todos los usuarios"}),ge.map(a=>e.jsx("option",{value:a,children:a},a))]})]})}),e.jsx(g,{md:2,children:e.jsxs(x.Group,{children:[e.jsx(x.Label,{children:"Fecha:"}),e.jsxs(x.Select,{value:d,onChange:a=>i(a.target.value),children:[e.jsx("option",{value:"all",children:"Todas las fechas"}),e.jsx("option",{value:"today",children:"Hoy"}),e.jsx("option",{value:"week",children:"Esta semana"}),e.jsx("option",{value:"month",children:"Este mes"})]})]})}),e.jsx(g,{md:2,className:"d-flex align-items-end",children:e.jsxs(me,{className:"w-100",children:[e.jsxs(w,{variant:"outline-secondary",onClick:pe,children:[e.jsx(W,{className:"me-1"}),"Limpiar"]}),e.jsxs(w,{variant:"outline-primary",onClick:()=>q(),children:[e.jsx(le,{className:"me-1"}),"Actualizar"]})]})})]})})]}),e.jsxs(l,{children:[e.jsxs(l.Header,{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("h6",{className:"mb-0",children:[e.jsx(B,{className:"me-2"}),"Registro de Actividades",e.jsxs(b,{bg:"info",className:"ms-2",children:[G.length," de ",J," registros"]})]}),e.jsx("div",{children:e.jsxs(w,{variant:"outline-success",size:"sm",onClick:Q,children:[e.jsx(M,{className:"me-1"}),"Exportar"]})})]}),e.jsx(l.Body,{children:re?e.jsxs("div",{className:"text-center py-4",children:[e.jsx(te,{animation:"border",variant:"primary"}),e.jsx("p",{className:"mt-2 text-muted",children:"Cargando registros de auditoría..."})]}):G.length>0?e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-hover",children:[e.jsx("thead",{className:"table-light",children:e.jsxs("tr",{children:[e.jsx("th",{width:"5%",children:e.jsx(x.Check,{type:"checkbox",checked:z.length===G.length&&G.length>0,onChange:a=>Ge(a.target.checked)})}),e.jsx("th",{width:"8%",children:"ID"}),e.jsx("th",{width:"20%",children:"Acción"}),e.jsx("th",{width:"15%",children:"Usuario"}),e.jsx("th",{width:"20%",children:"Fecha y Hora"}),e.jsx("th",{width:"25%",children:"Notas"}),e.jsx("th",{width:"12%",children:"Acciones"})]})}),e.jsx("tbody",{children:G.map(a=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx(x.Check,{type:"checkbox",checked:z.some(c=>c.id===a.id),onChange:c=>qe(a,c.target.checked)})}),e.jsx("td",{children:e.jsxs(b,{bg:"secondary",className:"fs-6",children:["#",a.id]})}),e.jsx("td",{children:e.jsxs("div",{className:"d-flex align-items-center",children:[Le(a.action),e.jsx(b,{bg:Be(a.action),className:"ms-2 fs-6",children:Te(a.action)})]})}),e.jsx("td",{children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx(H,{className:"me-2 text-muted"}),e.jsx("span",{className:"fw-medium",children:Pe(a)})]})}),e.jsx("td",{children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx(O,{className:"me-2 text-muted"}),e.jsx("small",{className:"text-muted",children:Ie(a.performed_at||a.created_at)})]})}),e.jsx("td",{children:e.jsx("span",{className:"text-muted",children:a.notes||"Sin notas adicionales"})}),e.jsx("td",{children:e.jsxs(w,{variant:"outline-primary",size:"sm",onClick:()=>Re(a),children:[e.jsx(Ae,{className:"me-1"}),"Ver"]})})]},a.id))})]})}):e.jsxs("div",{className:"text-center py-4",children:[e.jsx(B,{size:48,className:"text-muted mb-3"}),e.jsx("h6",{className:"text-muted",children:"No hay registros de auditoría"}),e.jsx("p",{className:"text-muted small",children:N||v!=="all"||u!=="all"||d!=="all"?"No se encontraron registros con los filtros aplicados.":"Los registros de auditoría aparecerán aquí cuando se realicen acciones en el sistema."}),(N||v!=="all"||u!=="all"||d!=="all")&&e.jsx(w,{variant:"outline-primary",onClick:pe,children:"Limpiar filtros"})]})})]}),Y>1&&e.jsx(l,{className:"mt-3",children:e.jsx(l.Body,{className:"py-2",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{className:"text-muted",children:["Mostrando ",(s-1)*t+1," a ",Math.min(s*t,J)," de ",J," registros"]}),e.jsxs("div",{className:"btn-group",children:[e.jsx(w,{variant:"outline-secondary",disabled:s<=1||re,onClick:()=>n(a=>Math.max(1,a-1)),children:"Anterior"}),e.jsxs(w,{variant:"outline-secondary",disabled:!0,children:[s," de ",Y]}),e.jsx(w,{variant:"outline-secondary",disabled:s>=Y||re,onClick:()=>n(a=>Math.min(Y,a+1)),children:"Siguiente"})]})]})})}),e.jsx(ws,{show:o,onHide:()=>F(!1),auditRecord:ne,onExport:a=>Q("excel"),onEdit:We,onDelete:Ke})]})}export{Us as default};
//# sourceMappingURL=Auditoria-AUoXpcQG.js.map
