import{r as l,u as Se,P as Pe,E as ke,c as J,G as p,j as e,H as qe,h as g,n as r,m as C,B as j,I as Ee,d as X,Q as Me,K as we,k as Y,O as Fe,l as Z,f as Ae,R as ee,v as Ie,S as Te,t as ae,M as Le}from"./index-sJ-fqi2A.js";import{P as De,R as Re,C as S}from"./PageHeader-CKES-3QI.js";import{D as Ge}from"./DataTable-BkIUefh0.js";import{M as se}from"./ModalForm-DaUBSj0Z.js";import{S as P}from"./StatsCard-BK0WfEEV.js";import{d as ze,c as Qe,u as $e,a as Ue,b as Ke,e as Ve,f as Be,l as Oe,g as He}from"./projects-CKlDxMsN.js";import{C as A}from"./Card-fwrWtkyO.js";import{T as We,a as v}from"./Tabs-D6Ihojr8.js";import"./InputGroup-CuakKslC.js";import"./Form-CC49TUrP.js";import"./Spinner-ROzCSctr.js";const I={company_id:"",name:"",location:"",vendedor_id:"",laboratorio_id:"",requiere_laboratorio:!1,requiere_ingenieria:!1,contact_name:"",contact_phone:"",contact_email:""};function pa(){var B,O,H,W;const[oe,y]=l.useState(!1),[m,k]=l.useState(null),[Je,ie]=l.useState(null),[Xe,Ye]=l.useState(!1),[Ze,ea]=l.useState(!1),[aa,sa]=l.useState(!1),[te,u]=l.useState(!1),[i,le]=l.useState(null),[re,T]=l.useState("view"),[o,c]=l.useState({}),[q,E]=l.useState(1),[L,ce]=l.useState(""),[D,ne]=l.useState(""),[R,de]=l.useState(""),[G,me]=l.useState(""),[ue,z]=l.useState(!1);Se();const n=(B=Pe().state)==null?void 0:B.selectedClient,Q=ke(),{data:t,isLoading:$,refetch:he}=J(["projects",q,L,D,R,G],()=>Oe({page:q,limit:20,search:L,status:D,company_id:R,project_type:G}),{keepPreviousData:!0,refetchOnWindowFocus:!0,refetchOnMount:!0,staleTime:0,cacheTime:0}),{data:h,isLoading:_}=J(["projectStats"],He,{refetchOnWindowFocus:!0,refetchOnMount:!0,staleTime:3e4,cacheTime:6e4}),x=a=>{Q.invalidateQueries("projects"),Q.invalidateQueries("projectStats"),y(!1),k(null),ie(null)},xe=a=>{console.log("ðŸ” handleSearch - BÃºsqueda:",a),ce(a),E(1),z(!0),setTimeout(()=>z(!1),1e3)},pe=a=>{console.log("ðŸ” handleFilter - Filtros:",a),ne(a.status||""),de(a.company_id||""),me(a.project_type||""),E(1)},je=[{title:"Por Estado",options:[{label:"Pendientes",filter:{status:"pendiente"}},{label:"Activos",filter:{status:"activo"}},{label:"Completados",filter:{status:"completado"}},{label:"Cancelados",filter:{status:"cancelado"}}]},{title:"Por Tipo de Proyecto",options:[{label:"AnÃ¡lisis de Suelos",filter:{project_type:"AnÃ¡lisis de Suelos"}},{label:"Estudio GeotÃ©cnico",filter:{project_type:"Estudio GeotÃ©cnico"}},{label:"EvaluaciÃ³n Ambiental",filter:{project_type:"EvaluaciÃ³n Ambiental"}},{label:"Control de Calidad",filter:{project_type:"Control de Calidad"}},{label:"AnÃ¡lisis de Agua",filter:{project_type:"AnÃ¡lisis de Agua"}},{label:"Estudio de Impacto",filter:{project_type:"Estudio de Impacto"}},{label:"AnÃ¡lisis QuÃ­mico",filter:{project_type:"AnÃ¡lisis QuÃ­mico"}},{label:"Pruebas de Laboratorio",filter:{project_type:"Pruebas de Laboratorio"}},{label:"InspecciÃ³n TÃ©cnica",filter:{project_type:"InspecciÃ³n TÃ©cnica"}},{label:"CertificaciÃ³n de Materiales",filter:{project_type:"CertificaciÃ³n de Materiales"}}]}],U=p(Qe,{onSuccess:()=>x(),onError:a=>console.error("Error creating project:",a)}),K=p($e,{onSuccess:()=>x(),onError:a=>console.error("Error updating project:",a)}),be=p(ze,{onSuccess:()=>x(),onError:a=>console.error("Error deleting project:",a)}),M=p(({id:a,...s})=>Ue(a,s),{onSuccess:()=>x(),onError:a=>console.error("Error updating project status:",a)}),b=p(({id:a,...s})=>Ke(a,s),{onSuccess:()=>x(),onError:a=>console.error("Error updating project categories:",a)}),w=p(({id:a,...s})=>Ve(a,s),{onSuccess:()=>x(),onError:a=>console.error("Error updating project queries:",a)}),F=p(({id:a,...s})=>Be(a,s),{onSuccess:()=>x(),onError:a=>console.error("Error updating project mark:",a)}),ge=()=>{const a=n?{...I,company_id:n.id,name:`${n.sector||"Proyecto"} - ${n.name}`,location:n.city||"",contact_name:n.contact_name||"",contact_phone:n.phone||"",contact_email:n.email||""}:I;k(a),y(!0)},ve=a=>{k(a),y(!0)},V=a=>{window.confirm(`Â¿EstÃ¡s seguro de que quieres eliminar el proyecto "${a.name}"?`)&&be.mutate(a.id)},Ne=a=>{console.log("ðŸ” handleViewProject - Project recibido:",a),console.log("ðŸ” handleViewProject - Project.id:",a==null?void 0:a.id),console.log("ðŸ” handleViewProject - Type of project.id:",typeof(a==null?void 0:a.id)),le(a),c(a),T("view"),u(!0)},fe=async a=>{m.id?await K.mutateAsync({id:m.id,...a}):await U.mutateAsync(a)},ye=a=>{const f={activo:{bg:"success",text:"Activo"},pendiente:{bg:"warning",text:"Pendiente"},completado:{bg:"primary",text:"Completado"},cancelado:{bg:"danger",text:"Cancelado"}}[a]||{bg:"secondary",text:a};return e.jsx(r,{bg:f.bg,className:"status-badge",children:f.text})},_e=[{header:"ID",accessor:"id",width:"80px"},{header:"Proyecto",accessor:"name",render:(a,s)=>e.jsxs("div",{children:[e.jsx("div",{className:"fw-medium",children:s.name}),s.location&&e.jsxs("small",{className:"text-muted",children:[e.jsx(Le,{size:12,className:"me-1"}),s.location]})]})},{header:"Tipo de Proyecto",accessor:"project_type",render:(a,s)=>{const f=s.project_type||"General";let d="secondary";switch(f){case"AnÃ¡lisis de Suelos":d="success";break;case"Estudio GeotÃ©cnico":d="primary";break;case"EvaluaciÃ³n Ambiental":d="info";break;case"Control de Calidad":d="warning";break;case"AnÃ¡lisis de Agua":d="info";break;case"Estudio de Impacto":d="danger";break;case"AnÃ¡lisis QuÃ­mico":d="primary";break;case"Pruebas de Laboratorio":d="success";break;case"InspecciÃ³n TÃ©cnica":d="warning";break;case"CertificaciÃ³n de Materiales":d="info";break;default:d="secondary"}return e.jsx(r,{bg:d,className:"px-2 py-1",children:f})}},{header:"Empresa",accessor:"company_name",render:(a,s)=>e.jsxs("div",{children:[e.jsx("div",{className:"fw-medium",children:s.company_name||"Sin empresa"}),s.company_ruc&&e.jsxs("small",{className:"text-muted",children:["RUC: ",s.company_ruc]})]})},{header:"Estado",accessor:"status",render:a=>ye(a||"activo")},{header:"Servicios Requeridos",accessor:"services",render:(a,s)=>e.jsxs("div",{className:"d-flex flex-wrap gap-1",children:[s.requiere_laboratorio&&e.jsxs(r,{bg:"info",className:"px-2 py-1",children:[e.jsx(g,{size:12,className:"me-1"}),"Laboratorio"]}),s.requiere_ingenieria&&e.jsxs(r,{bg:"primary",className:"px-2 py-1",children:[e.jsx(C,{size:12,className:"me-1"}),"IngenierÃ­a"]}),!s.requiere_laboratorio&&!s.requiere_ingenieria&&e.jsx(r,{bg:"secondary",className:"px-2 py-1",children:"Sin servicios"})]})},{header:"Contacto",accessor:"contacto",render:(a,s)=>e.jsxs("div",{className:"small",children:[s.contact_name&&e.jsx("div",{children:e.jsx("strong",{children:s.contact_name})}),s.contact_phone&&e.jsx("div",{className:"text-muted",children:s.contact_phone}),s.contact_email&&e.jsx("div",{className:"text-muted",children:s.contact_email}),!s.contact_name&&!s.contact_phone&&!s.contact_email&&e.jsx("span",{className:"text-muted",children:"Sin contacto"})]})},{header:"Asignado a",accessor:"vendedor_name",render:(a,s)=>e.jsxs("div",{children:[s.vendedor_name&&e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx(C,{size:14,className:"me-1 text-muted"}),e.jsx("span",{children:s.vendedor_name})]}),s.laboratorio_name&&e.jsxs("div",{className:"d-flex align-items-center mt-1",children:[e.jsx(g,{size:14,className:"me-1 text-muted"}),e.jsx("span",{className:"small text-muted",children:s.laboratorio_name})]})]})},{header:"Fecha CreaciÃ³n",accessor:"created_at",type:"date"}],Ce=[{name:"company_id",label:"Empresa/Cliente",type:"select",required:!0,options:((O=t==null?void 0:t.companies)==null?void 0:O.map(a=>({value:a.id,label:`${a.name} (${a.ruc||a.dni||"Sin RUC/DNI"})`})))||[],description:"Selecciona un cliente existente o crea uno nuevo desde el mÃ³dulo de clientes"},{name:"name",label:"Nombre del Proyecto",type:"text",required:!0,placeholder:"Ingresa el nombre del proyecto"},{name:"location",label:"UbicaciÃ³n del Proyecto",type:"text",placeholder:"Ingresa la ubicaciÃ³n del proyecto",required:!0},{name:"contact_name",label:"Persona de Contacto",type:"text",placeholder:"Nombre de la persona con quien negociar",description:"Persona responsable del proyecto en el cliente"},{name:"contact_phone",label:"TelÃ©fono de Contacto",type:"text",placeholder:"TelÃ©fono para comunicaciÃ³n directa",description:"NÃºmero para llamadas urgentes o seguimiento"},{name:"contact_email",label:"Email de Contacto",type:"email",placeholder:"Email para comunicaciÃ³n",description:"Email para envÃ­o de reportes y documentos"},{name:"vendedor_id",label:"Vendedor Asignado",type:"select",options:((H=t==null?void 0:t.users)==null?void 0:H.filter(a=>["vendedor_comercial","jefa_comercial"].includes(a.role)).map(a=>({value:a.id,label:`${a.name} ${a.apellido}`})))||[]},{name:"laboratorio_id",label:"Responsable de Laboratorio",type:"select",options:((W=t==null?void 0:t.users)==null?void 0:W.filter(a=>["jefe_laboratorio","usuario_laboratorio","laboratorio"].includes(a.role)).map(a=>({value:a.id,label:`${a.name} ${a.apellido}`})))||[]},{name:"requiere_laboratorio",label:"Requiere Servicios de Laboratorio",type:"checkbox",description:"Marcar si el proyecto necesita anÃ¡lisis o pruebas de laboratorio"},{name:"requiere_ingenieria",label:"Requiere Servicios de IngenierÃ­a",type:"checkbox",description:"Marcar si el proyecto necesita estudios o consultorÃ­a de ingenierÃ­a"}],N=l.useMemo(()=>{if(h)return console.log("ðŸ“Š Stats - Usando estadÃ­sticas reales del backend:",h),{total:h.total||0,activos:h.activos||0,completados:h.completados||0,pendientes:h.pendientes||0,cancelados:h.cancelados||0};const a=(t==null?void 0:t.data)||[];return console.log("ðŸ“Š Stats - Fallback: calculando desde pÃ¡gina actual:",a),{total:a.length,activos:a.filter(s=>s.status==="activo").length,completados:a.filter(s=>s.status==="completado").length,pendientes:a.filter(s=>s.status==="pendiente").length,cancelados:a.filter(s=>s.status==="cancelado").length}},[h,t]);return e.jsx(qe,{fluid:!0,className:"py-4",children:e.jsxs("div",{className:"fade-in",children:[e.jsx(De,{title:"GestiÃ³n de Proyectos",subtitle:n?`Crear proyecto para: ${n.name}`:"Crear, editar y gestionar proyectos del sistema",icon:g,actions:e.jsxs("div",{className:"d-flex gap-2",children:[n&&e.jsxs(r,{bg:"info",className:"px-3 py-2 d-flex align-items-center",children:[e.jsx(C,{className:"me-1"}),"Cliente: ",n.name]}),e.jsxs(j,{variant:"primary",onClick:ge,children:[e.jsx(Ee,{className:"me-2"}),n?"Crear Proyecto":"Nuevo Proyecto"]})]})}),e.jsxs(Re,{className:"g-4 mb-4",children:[e.jsx(S,{md:6,lg:3,children:e.jsx(P,{title:"Total Proyectos",value:N.total,icon:g,color:"primary",subtitle:"Proyectos registrados",loading:_})}),e.jsx(S,{md:6,lg:3,children:e.jsx(P,{title:"Proyectos Activos",value:N.activos,icon:X,color:"success",subtitle:"En desarrollo",loading:_})}),e.jsx(S,{md:6,lg:3,children:e.jsx(P,{title:"Completados",value:N.completados,icon:X,color:"info",subtitle:"Finalizados",loading:_})}),e.jsx(S,{md:6,lg:3,children:e.jsx(P,{title:"Pendientes",value:N.pendientes,icon:Me,color:"warning",subtitle:"Por iniciar",loading:_})})]}),e.jsxs(A,{className:"shadow-sm border-0",children:[e.jsx(A.Header,{className:"bg-white border-bottom",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("h5",{className:"mb-0",children:[e.jsx(g,{className:"me-2 text-primary"}),"Lista de Proyectos"]}),e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx(j,{variant:"outline-secondary",size:"sm",onClick:()=>he(),className:"d-flex align-items-center",title:"Actualizar datos",children:e.jsx(we,{className:`${$?"spinning":""}`})}),e.jsxs(r,{bg:"light",text:"dark",className:"px-3 py-2",children:[N.total," proyectos"]})]})]})}),e.jsx(A.Body,{className:"p-0",children:e.jsx(Ge,{data:(t==null?void 0:t.data)||[],columns:_e,loading:$||ue,onEdit:ve,onDelete:V,actions:[{label:"Gestionar",icon:Y,onClick:Ne,variant:"outline-primary"},{label:"Eliminar",icon:Fe,onClick:V,variant:"outline-danger"}],emptyMessage:"No hay proyectos registrados",totalItems:(t==null?void 0:t.total)||0,itemsPerPage:20,currentPage:q,onPageChange:E,onSearch:xe,onFilter:pe,filterOptions:je})})]}),e.jsx(se,{show:oe,onHide:()=>y(!1),title:m!=null&&m.id?"Editar Proyecto":"Nuevo Proyecto",data:m||I,fields:Ce,onSubmit:fe,loading:U.isLoading||K.isLoading,submitText:m!=null&&m.id?"Actualizar":"Crear"}),e.jsx(se,{show:te,onHide:()=>u(!1),title:`Gestionar Proyecto - ${(i==null?void 0:i.name)||""}`,data:o,fields:[{name:"project_management",label:"GestiÃ³n del Proyecto",type:"custom",render:a=>e.jsxs(We,{activeKey:re,onSelect:s=>T(s),className:"mb-3",children:[e.jsx(v,{eventKey:"view",title:e.jsxs("span",{children:[e.jsx(Y,{className:"me-1"}),"Ver"]}),children:e.jsxs("div",{className:"row g-3",children:[e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"border rounded p-3 h-100",children:[e.jsxs("h6",{className:"text-primary mb-3",children:[e.jsx(g,{className:"me-2"}),"Datos Generales"]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"ID:"})," ",a.id]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Nombre:"})," ",a.name]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"UbicaciÃ³n:"})," ",a.location]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Tipo:"}),e.jsx(r,{bg:"info",className:"ms-2",children:a.project_type})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Estado:"}),e.jsx(r,{bg:"primary",className:"ms-2",children:a.status})]})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"border rounded p-3 h-100",children:[e.jsxs("h6",{className:"text-success mb-3",children:[e.jsx(C,{className:"me-2"}),"InformaciÃ³n de Contacto"]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Empresa:"})," ",a.company_name]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"RUC:"})," ",a.company_ruc]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Contacto:"})," ",a.contact_name||"Sin contacto"]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"TelÃ©fono:"})," ",a.contact_phone||"Sin telÃ©fono"]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Email:"})," ",a.contact_email||"Sin email"]})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"border rounded p-3 h-100",children:[e.jsxs("h6",{className:"text-warning mb-3",children:[e.jsx(Z,{className:"me-2"}),"Servicios Requeridos"]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Laboratorio:"}),a.requiere_laboratorio?e.jsx(r,{bg:"info",className:"ms-2",children:"Requerido"}):e.jsx(r,{bg:"secondary",className:"ms-2",children:"No requerido"})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"IngenierÃ­a:"}),a.requiere_ingenieria?e.jsx(r,{bg:"success",className:"ms-2",children:"Requerido"}):e.jsx(r,{bg:"secondary",className:"ms-2",children:"No requerido"})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Estado Lab:"}),e.jsx(r,{bg:"info",className:"ms-2",children:a.laboratorio_status})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Estado Ing:"}),e.jsx(r,{bg:"success",className:"ms-2",children:a.ingenieria_status})]})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"border rounded p-3 h-100",children:[e.jsxs("h6",{className:"text-info mb-3",children:[e.jsx(Ae,{className:"me-2"}),"Asignaciones"]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Vendedor:"})," ",a.vendedor_name||"Sin asignar"]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Laboratorio:"})," ",a.laboratorio_name||"Sin asignar"]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Fecha CreaciÃ³n:"})," ",new Date(a.created_at).toLocaleDateString()]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Ãšltima ActualizaciÃ³n:"})," ",new Date(a.updated_at).toLocaleDateString()]})]})}),a.status_notes&&e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"border rounded p-3",children:[e.jsxs("h6",{className:"text-muted mb-3",children:[e.jsx(ee,{className:"me-2"}),"Notas del Estado"]}),e.jsx("p",{className:"mb-0",children:a.status_notes})]})})]})}),e.jsx(v,{eventKey:"edit",title:e.jsxs("span",{children:[e.jsx(Ie,{className:"me-1"}),"Editar"]}),children:e.jsxs("div",{className:"row g-3",children:[e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Nombre del Proyecto"}),e.jsx("input",{type:"text",className:"form-control",value:o.name||"",onChange:s=>c({...o,name:s.target.value})})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"UbicaciÃ³n"}),e.jsx("input",{type:"text",className:"form-control",value:o.location||"",onChange:s=>c({...o,location:s.target.value})})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Persona de Contacto"}),e.jsx("input",{type:"text",className:"form-control",value:o.contact_name||"",onChange:s=>c({...o,contact_name:s.target.value})})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"TelÃ©fono de Contacto"}),e.jsx("input",{type:"text",className:"form-control",value:o.contact_phone||"",onChange:s=>c({...o,contact_phone:s.target.value})})]})}),e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Email de Contacto"}),e.jsx("input",{type:"email",className:"form-control",value:o.contact_email||"",onChange:s=>c({...o,contact_email:s.target.value})})]})}),e.jsx("div",{className:"col-12",children:e.jsx(j,{variant:"primary",onClick:()=>{const s=i==null?void 0:i.id;if(!s){console.error("No se encontrÃ³ el ID del proyecto");return}b.mutate({id:s,requiere_laboratorio:o.requiere_laboratorio||!1,requiere_ingenieria:o.requiere_ingenieria||!1,requiere_consultoria:o.requiere_consultoria||!1,requiere_capacitacion:o.requiere_capacitacion||!1,requiere_auditoria:o.requiere_auditoria||!1}),u(!1)},disabled:b.isLoading,children:b.isLoading?"Guardando...":"Guardar CategorÃ­as"})})]})}),e.jsx(v,{eventKey:"status",title:e.jsxs("span",{children:[e.jsx(Z,{className:"me-1"}),"Estado"]}),children:e.jsxs("div",{className:"row g-3",children:[e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Estado del Proyecto"}),e.jsxs("select",{className:"form-select",value:o.status||"",onChange:s=>c({...o,status:s.target.value}),children:[e.jsx("option",{value:"pendiente",children:"Pendiente"}),e.jsx("option",{value:"en_proceso",children:"En Proceso"}),e.jsx("option",{value:"completado",children:"Completado"}),e.jsx("option",{value:"pausado",children:"Pausado"}),e.jsx("option",{value:"cancelado",children:"Cancelado"})]})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Estado del Laboratorio"}),e.jsxs("select",{className:"form-select",value:o.laboratorio_status||"",onChange:s=>c({...o,laboratorio_status:s.target.value}),children:[e.jsx("option",{value:"no_requerido",children:"No Requerido"}),e.jsx("option",{value:"pendiente",children:"Pendiente"}),e.jsx("option",{value:"en_proceso",children:"En Proceso"}),e.jsx("option",{value:"completado",children:"Completado"}),e.jsx("option",{value:"pausado",children:"Pausado"}),e.jsx("option",{value:"cancelado",children:"Cancelado"})]})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Estado de IngenierÃ­a"}),e.jsxs("select",{className:"form-select",value:o.ingenieria_status||"",onChange:s=>c({...o,ingenieria_status:s.target.value}),children:[e.jsx("option",{value:"no_requerido",children:"No Requerido"}),e.jsx("option",{value:"pendiente",children:"Pendiente"}),e.jsx("option",{value:"en_proceso",children:"En Proceso"}),e.jsx("option",{value:"completado",children:"Completado"}),e.jsx("option",{value:"pausado",children:"Pausado"}),e.jsx("option",{value:"cancelado",children:"Cancelado"})]})]})}),e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Notas del Estado"}),e.jsx("textarea",{className:"form-control",rows:"3",value:o.status_notes||"",onChange:s=>c({...o,status_notes:s.target.value}),placeholder:"Agrega comentarios sobre el cambio de estado..."})]})}),e.jsx("div",{className:"col-12",children:e.jsx(j,{variant:"success",onClick:()=>{const s=i==null?void 0:i.id;if(!s){console.error("No se encontrÃ³ el ID del proyecto");return}M.mutate({id:s,...o}),u(!1)},disabled:M.isLoading,children:M.isLoading?"Actualizando...":"Actualizar Estado"})})]})}),e.jsx(v,{eventKey:"categories",title:e.jsxs("span",{children:[e.jsx(Te,{className:"me-1"}),"CategorÃ­as"]}),children:e.jsxs("div",{className:"row g-3",children:[e.jsxs("div",{className:"col-12",children:[e.jsx("h6",{className:"mb-3",children:"CategorÃ­as del Proyecto"}),e.jsxs("div",{className:"form-check",children:[e.jsx("input",{className:"form-check-input",type:"checkbox",id:"cat_laboratorio",checked:o.requiere_laboratorio||!1,onChange:s=>c({...o,requiere_laboratorio:s.target.checked})}),e.jsx("label",{className:"form-check-label",htmlFor:"cat_laboratorio",children:"Laboratorio"})]}),e.jsxs("div",{className:"form-check",children:[e.jsx("input",{className:"form-check-input",type:"checkbox",id:"cat_ingenieria",checked:o.requiere_ingenieria||!1,onChange:s=>c({...o,requiere_ingenieria:s.target.checked})}),e.jsx("label",{className:"form-check-label",htmlFor:"cat_ingenieria",children:"IngenierÃ­a"})]}),e.jsxs("div",{className:"form-check",children:[e.jsx("input",{className:"form-check-input",type:"checkbox",id:"cat_consultoria"}),e.jsx("label",{className:"form-check-label",htmlFor:"cat_consultoria",children:"ConsultorÃ­a"})]}),e.jsxs("div",{className:"form-check",children:[e.jsx("input",{className:"form-check-input",type:"checkbox",id:"cat_capacitacion"}),e.jsx("label",{className:"form-check-label",htmlFor:"cat_capacitacion",children:"CapacitaciÃ³n"})]}),e.jsxs("div",{className:"form-check",children:[e.jsx("input",{className:"form-check-input",type:"checkbox",id:"cat_auditoria"}),e.jsx("label",{className:"form-check-label",htmlFor:"cat_auditoria",children:"AuditorÃ­a"})]})]}),e.jsx("div",{className:"col-12",children:e.jsx(j,{variant:"info",onClick:()=>{console.log("selectedProject:",i),console.log("selectedProject.id:",i==null?void 0:i.id),console.log("editingData:",o);const s=i==null?void 0:i.id;if(!s){console.error("No se encontrÃ³ el ID del proyecto");return}b.mutate({id:s,requiere_laboratorio:o.requiere_laboratorio||!1,requiere_ingenieria:o.requiere_ingenieria||!1,requiere_consultoria:o.requiere_consultoria||!1,requiere_capacitacion:o.requiere_capacitacion||!1,requiere_auditoria:o.requiere_auditoria||!1}),u(!1)},disabled:b.isLoading,children:b.isLoading?"Guardando...":"Guardar CategorÃ­as"})})]})}),e.jsx(v,{eventKey:"queries",title:e.jsxs("span",{children:[e.jsx(ee,{className:"me-1"}),"Consultas"]}),children:e.jsxs("div",{className:"row g-3",children:[e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Consultas y Dudas del Cliente"}),e.jsx("textarea",{className:"form-control",rows:"8",value:o.queries||"",onChange:s=>c({...o,queries:s.target.value}),placeholder:"Ingresa las consultas o dudas del cliente..."})]})}),e.jsx("div",{className:"col-12",children:e.jsx(j,{variant:"warning",onClick:()=>{const s=i==null?void 0:i.id;if(!s){console.error("No se encontrÃ³ el ID del proyecto");return}w.mutate({id:s,queries:o.queries||""}),u(!1)},disabled:w.isLoading,children:w.isLoading?"Guardando...":"Guardar Consultas"})})]})}),e.jsx(v,{eventKey:"mark",title:e.jsxs("span",{children:[e.jsx(ae,{className:"me-1"}),"Marcar"]}),children:e.jsx("div",{className:"row g-3",children:e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h6",{className:"mb-3",children:"Marcar Proyecto"}),e.jsx("p",{className:"text-muted mb-4",children:"Marca este proyecto para seguimiento especial o prioridad alta."}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Prioridad"}),e.jsxs("select",{className:"form-select",value:o.priority||"normal",onChange:s=>c({...o,priority:s.target.value}),children:[e.jsx("option",{value:"low",children:"Baja"}),e.jsx("option",{value:"normal",children:"Normal"}),e.jsx("option",{value:"high",children:"Alta"}),e.jsx("option",{value:"urgent",children:"Urgente"})]})]}),e.jsxs(j,{variant:"success",size:"lg",onClick:()=>{const s=i==null?void 0:i.id;if(!s){console.error("No se encontrÃ³ el ID del proyecto");return}F.mutate({id:s,marked:!o.marked,priority:o.priority||"normal"}),u(!1)},disabled:F.isLoading,children:[e.jsx(ae,{className:"me-2"}),F.isLoading?"Procesando...":o.marked?"Desmarcar Proyecto":"Marcar Proyecto"]})]})})})})]})}],onSubmit:()=>u(!1),submitText:"Cerrar",size:"xl"})]})})}export{pa as default};
//# sourceMappingURL=Proyectos-C05ukTwl.js.map
