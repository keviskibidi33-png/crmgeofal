import{b as E,R as u,e as v,j as e}from"./index-Dcu-y_Nk.js";import{M as N}from"./ModuloBase-BRrzUyey.js";import{D as C}from"./DataTable-CjnbP6zW.js";import{T as R}from"./TableEmpty-fPco6Lgm.js";const h={};async function S({type:o="leads"}={}){const n=((h==null?void 0:h.VITE_API_URL)||"").replace(/\/$/,""),a="/api/export/excel?type="+encodeURIComponent(o),i=n?n+a:a,r=localStorage.getItem("token"),c=await fetch(i,{method:"GET",headers:r?{Authorization:`Bearer ${r}`}:{}});if(!c.ok)throw new Error("No se pudo exportar Excel");const l=await c.blob(),s=document.createElement("a");s.href=URL.createObjectURL(l),s.download=`reporte_${o}.xlsx`,document.body.appendChild(s),s.click(),s.remove()}async function T({type:o="leads"}={}){const n=((h==null?void 0:h.VITE_API_URL)||"").replace(/\/$/,""),a="/api/export/pdf?type="+encodeURIComponent(o),i=n?n+a:a,r=localStorage.getItem("token"),c=await fetch(i,{method:"GET",headers:r?{Authorization:`Bearer ${r}`}:{}});if(!c.ok)throw new Error("No se pudo exportar PDF");const l=await c.blob(),s=document.createElement("a");s.href=URL.createObjectURL(l),s.download=`reporte_${o}.pdf`,document.body.appendChild(s),s.click(),s.remove()}const D=(o={})=>{const n=new URLSearchParams;o.page&&n.set("page",o.page),o.limit&&n.set("limit",o.limit),o.q&&n.set("q",o.q),o.type&&n.set("type",o.type),o.range&&n.set("range",o.range);const a=n.toString();return E("/api/export/history"+(a?`?${a}`:""))};function L(){const[o,n]=u.useState(""),[a,i]=u.useState(""),[r,c]=u.useState("30"),[l,s]=u.useState(!1),[x,p]=u.useState(1),[m]=u.useState(10),{data:d,isLoading:b}=v(["export-history",{page:x,limit:m,q:o,type:a,range:r}],async()=>{const t=await D({page:x,limit:m,q:o,type:a,range:r}),f=Array.isArray(t==null?void 0:t.data)?t.data:(t==null?void 0:t.rows)||t||[],k=Number((t==null?void 0:t.total)||f.length||0);return{rows:f,total:k}},{keepPreviousData:!0}),j=(d==null?void 0:d.rows)||[],y=(d==null?void 0:d.total)||0,g=Math.max(1,Math.ceil(y/m)),w=()=>{n(""),i(""),c("30"),p(1)};return e.jsxs(N,{titulo:"Exportaciones",descripcion:"Historial de exportaciones realizadas (PDF/Excel/CSV).",children:[e.jsx(R,{compact:!0,left:e.jsxs(e.Fragment,{children:[e.jsx("input",{className:"form-control",style:{minWidth:220},placeholder:"Buscar por recurso o usuario",value:o,onChange:t=>n(t.target.value)}),e.jsxs("select",{className:"form-select",value:a,onChange:t=>i(t.target.value),children:[e.jsx("option",{value:"",children:"Todos los tipos"}),e.jsx("option",{value:"pdf",children:"PDF"}),e.jsx("option",{value:"xlsx",children:"Excel"}),e.jsx("option",{value:"csv",children:"CSV"})]}),e.jsxs("select",{className:"form-select",value:r,onChange:t=>c(t.target.value),children:[e.jsx("option",{value:"7",children:"Últimos 7 días"}),e.jsx("option",{value:"30",children:"Últimos 30 días"}),e.jsx("option",{value:"90",children:"Últimos 90 días"}),e.jsx("option",{value:"all",children:"Todo"})]})]}),right:e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"btn btn-outline-secondary",onClick:w,children:"Limpiar"}),e.jsx("div",{className:"vr mx-2"}),e.jsx("button",{className:"btn btn-success",disabled:!a||l,onClick:async()=>{try{s(!0),await S({type:a})}finally{s(!1)}},children:l?"Descargando...":"Exportar Excel"}),e.jsx("button",{className:"btn btn-danger",disabled:!a||l,onClick:async()=>{try{s(!0),await T({type:a})}finally{s(!1)}},children:l?"Descargando...":"Exportar PDF"})]})}),e.jsx(C,{columns:[{header:"ID",key:"id",width:80},{header:"Tipo",key:"type"},{header:"Recurso",key:"resource"},{header:"Fecha",key:"created_at",render:t=>t.created_at?String(t.created_at).slice(0,19).replace("T"," "):"—",width:160},{header:"Usuario",key:"user_name"}],rows:j,loading:b}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center mt-2",children:[e.jsxs("div",{className:"text-muted small",children:["Total: ",y]}),e.jsxs("div",{className:"btn-group",children:[e.jsx("button",{className:"btn btn-outline-secondary",disabled:x<=1||b,onClick:()=>p(t=>Math.max(1,t-1)),children:"Anterior"}),e.jsxs("span",{className:"btn btn-outline-secondary disabled",children:[x,"/",g]}),e.jsx("button",{className:"btn btn-outline-secondary",disabled:x>=g||b,onClick:()=>p(t=>Math.min(g,t+1)),children:"Siguiente"})]})]})]})}export{L as default};
//# sourceMappingURL=Exportaciones-BYYLMKZS.js.map
